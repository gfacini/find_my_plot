CERN-PPE/97-144

20 October 1997

**Evaluation of FERMI Read-out of the ATLAS Tilecal Prototype**

S. Agnvall\({}^{x}\), Z. Ajaltouni\({}^{e}\), F. Albiol\({}^{z}\), A. Alifanov\({}^{o}\), P. Amaral\({}^{l,}\)\({}^{1,}\)\({}^{12}\), D. Amelin\({}^{v}\), A. Amorim\({}^{l,}\)\({}^{12}\), K. Anderson\({}^{c}\), C. Angelini\({}^{i}\), A. Antola\({}^{n}\), F. Astesan\({}^{p}\), A. Astvatsaturov\({}^{g}\), D. Autiero\({}^{s}\), F. Badaud\({}^{e}\), G. Barreira\({}^{l}\)\({}^{1}\), R. Benetta\({}^{f}\), S. Berglund\({}^{x}\), G. Blanchot\({}^{b}\), E. Blucher\({}^{c}\), C. Blaj\({}^{d}\), P. Bod\({}^{b}\), A. Bogush\({}^{o}\), C. Bohm\({}^{x}\), V. Boldea\({}^{d}\), O. Borisov\({}^{g}\), M. Bosman\({}^{b}\), N. Bouhemaid\({}^{e}\), P. Brette\({}^{e}\), L. Breveglieri\({}^{n}\), C. Bromberg\({}^{m}\), M. Brossard\({}^{e}\), J. Budagov\({}^{g}\), L. Caloba\({}^{w}\), J. Carvalho\({}^{l3}\), P. Casado\({}^{b}\), A. Castera\({}^{p}\), P. W. Cattaneo\({}^{1}\)\({}^{,}\)\({}^{q}\), M. Cavalli-Sforza\({}^{b}\), V. Cavasinni\({}^{s}\), R. Chadelas\({}^{e}\), J.-C. Chevaleyre\({}^{e}\), I. Chirikov-Zorin\({}^{g}\), G. Chlachidze\({}^{g}\), M. Cobal\({}^{f}\), F. Cogswell\({}^{h}\), F. Colaco\({}^{l}\)\({}^{4}\), S. Constantinescu\({}^{d}\), D. Costanzo\({}^{s}\), M. Crotau\({}^{e}\), L. Dadda\({}^{n}\), F. Daudon\({}^{e}\), J. David\({}^{p}\), M. David\({}^{l,}\)\({}^{1,}\)\({}^{12}\), T. Davidek\({}^{t}\), J. Dawson\({}^{a}\), K. De\({}^{aa}\), T. Del Prete\({}^{s}\), A. De Santo\({}^{s}\), B. Di Girolamo\({}^{s}\), S. Dita\({}^{d}\), J. Dolejsi\({}^{t}\), Z. Dolezal\({}^{t}\), R. Downing\({}^{h}\), J.-J. Dugne\({}^{e}\), I. Efthymiopoulos\({}^{b}\), M. Engstrom\({}^{x}\), D. Errede\({}^{h}\), S. Errede\({}^{h}\), H. Evans\({}^{c}\), A. Fenyuk\({}^{e}\), A. Ferrer\({}^{s}\), V. Flaminio\({}^{s}\), A. Fristedt\({}^{x}\), E. Gallas\({}^{aa}\), M. Gaspar\({}^{w}\), O. Gildemeister\({}^{f}\), M. Givoletto\({}^{bb}\), V. Glagolev\({}^{g}\), V. G. Goggi\({}^{q}\), A. Gomes\({}^{l,}\)\({}^{1,}\)\({}^{l2}\), S. Gong\({}^{k}\), Y. Gouz\({}^{v}\), V. Grabsky\({}^{cc}\), M. Grieco\({}^{bb}\), H. Hakopian\({}^{cc}\), M. Haney\({}^{h}\), M. Hansen\({}^{f}\), S. Hellman\({}^{x}\), A. Henriques\({}^{l}\)1, H. Hentzell\({}^{k}\), T. Holmberg\({}^{j}\), S. Holmgren\({}^{x}\), P.F. Honore\({}^{e}\), J. Huston\({}^{m}\), Yu. Ivanyushenkov\({}^{b}\), K. Jon-And\({}^{x}\), A. Juste\({}^{b}\), S. Kakurin\({}^{g}\), G. Karapetian\({}^{f}\), A. Karyukhin\({}^{n}\), A. Kerek\({}^{y}\), Yu. Khokhlov\({}^{v}\), S. Kopikov\({}^{v}\), M. Kostrikov\({}^{v}\), V. Kostyukhin\({}^{v}\), V. Kukhtin\({}^{g}\), Y. Kulchitsky\({}^{o}\), \(g\), W. Kurzbauer\({}^{f}\), S. Lami\({}^{i}\), C. Landi\({}^{b}\), V. Lapin\({}^{v}\), C. Lazzeroni\({}^{i}\), A. Lebedev\({}^{g}\), R. Leitner\({}^{f}\), J. Li\({}^{aa}\), M. Lippi\({}^{bb}\), O. Ledortz\({}^{p}\), B. Lofstedt\({}^{f}\), Yu. Lomakin\({}^{g}\), O. Lomakina\({}^{g}\), M. Lokajicek\({}^{u}\), B. Lund-Jensen\({}^{y}\), A. Maio\({}^{1,}\)\({}^{12}\), S. Malyukov\({}^{g}\), R. Mariani\({}^{r}\), F. Marroquin\({}^{w}\), J.P. Martins\({}^{l,}\)\({}^{1,}\)\({}^{12}\), E. Mazzoni\({}^{i}\), F. Merritt\({}^{c}\), B. Michel\({}^{e}\), R. Miller\({}^{m}\), I. Minashvili\({}^{g}\), Ll. Miralles\({}^{b}\), E. Mnatsakanian\({}^{cc}\), G. Montarou\({}^{e}\), S. Motto\({}^{r}\), G.S. Muanza\({}^{e}\), S. Nemecek\({}^{u}\), M. Nessi\({}^{f}\), A. Odmark\({}^{j}\), A. Onofre\({}^{l3,}\)\({}^{14}\), S. Orteu\({}^{b}\), C. Padilla\({}^{b}\), D. Pallin\({}^{e}\), D. Pantea\({}^{d,}\)\({}^{g}\), J. Patriarca\({}^{l1}\), A. Pereira\({}^{w}\), J.A. Perlas\({}^{b}\), S. T. Persson\({}^{h}\), P. Petit\({}^{b}\), J. Pilcher\({}^{e}\), J. Pinhao\({}^{l3}\), L. Poggioli\({}^{f}\), S. Poirot\({}^{e}\), G. Polesello\({}^{q}\), L. Price\({}^{a}\), J. Proudfoot\({}^{a}\), O. Pukhov\({}^{g}\), G. Reinmuth\({}^{e}\), G. Renzoni\({}^{s}\), R. Richards\({}^{m}\), I. Riu\({}^{b}\), V. Romanov\({}^{g}\), B. Ronceux\({}^{b}\), V. Rumyantsev\({}^{o}\), N. Russakovich\({}^{g}\), M. Sami\({}^{n}\), H. Sanders\({}^{c}\), J. Santos\({}^{11}\), A. Savoy-Navarro\({}^{p}\), L. Sawyer\({}^{aa}\), L.-P. Says\({}^{e}\), Ph. Schwemling\({}^{p}\), J.M. Seixas\({}^{w}\), B. Sellden\({}^{x}\), A. Semenov\({}^{g}\), A. Shchelchkov\({}^{g}\), M. Shochet\({}^{c}\), V. Simaitis\({}^{h}\), A. Sissakian\({}^{g}\), A. Solodkov\({}^{v}\), O. Solovianov\({}^{v}\), P. Sonderegger\({}^{f}\), K. Soustruznik\({}^{k}\), R. Stanek\({}^{a}\), E. Starchenko\({}^{v}\), R. Stefanelli\({}^{n}\), R. Stephens\({}^{aa}\), M. Suk\({}^{k}\), R. Sundblad\({}^{j}\), C. Svensson\({}^{i}\), F. Tang\({}^{c}\), S. Tardell\({}^{x}\), P. Tas\({}^{t}\), F. Teubert\({}^{b}\), J. Thaler\({}^{h}\), S. Tokar\({}^{d}\)\({}^{d}\), N. Topilin\({}^{g}\), Z. Trka\({}^{t}\), A. Turcot\({}^{c}\), M. Turcotte\({}^{aa}\), S. Valkar\({}^{t}\), M.J. Varandas\({}^{l,}\)\({}^{1,}\)\({}^{12}\), A. Vartapetian\({}^{cc}\), F. Vazeille\({}^{e}\), V. Vinogradov\({}^{g}\), F. Vivaldi\({}^{r}\), S. Vorozhtsov\({}^{g}\), D. Wagner\({}^{c}\), A. White\({}^{aa}\), H.

\({}^{a}\) Argonne National Laboratory, USA \({}^{b}\) Institut de Fisica d'Altes Energies, Universitat Autonoma de Barcelona, Spain \({}^{c}\) University of Chicago, USA \({}^{d}\) Institute of Atomic Physics, Bucharest, Romania \({}^{e}\) LPC Clermont-Ferrand, Universite Blaise Pascal / CNRS-IN2P3, France \({}^{f}\) CERN, Geneva, Switzerland \({}^{g}\) JINR Dubna, Russia \({}^{h}\) University of Illinois, USA \({}^{i}\) University of Linkoping, Sweden \({}^{j}\) SiCon AB, Linkoping, Sweden \({}^{k}\) Industrial Microelectronics Center, University of Linkoping, Sweden \({}^{l}\) 1) LIP-Lisbon, 2) FCUL-Univ. of Lisbon, 3) LIP and FCTUC-Univ. of Coimbra, 4) Univ. Catolica Figueira da Foz, Portugal \({}^{m}\) Michigan State University, USA \({}^{n}\) Politecnico di Milano, and INFN, Pavia, Italy \({}^{o}\) Institute of Physics ASB, Minsk, Belarus \({}^{p}\) LPNHE Universites Paris VI-VII, Paris, France \({}^{q}\) Pavia University and INFN, Pavia, Italy \({}^{r}\) C.A.E.N. Microelectronics, Pisa, Italy \({}^{s}\) Pisa University and INFN, Pisa, Italy \({}^{t}\) Charles University, Prague, Czech Republic \({}^{u}\) Academy of Science, Prague, Czech Republic \({}^{v}\) Institute for High Energy Physics, Protvino, Russia \({}^{w}\) COPPE/EE/UFRJ, Rio de Janeiro, Brazil \({}^{y}\) Royal Institute of Technology, Stockholm, Sweden \({}^{x}\) Stockholm University, Sweden \({}^{z}\) IFIC Valencia, Spain \({}^{aa}\) University of Texas at Arlington, USA \({}^{bb}\) C.A.E.N. S.p.A., Viareggio, Italy \({}^{cc}\) Yerevan Physics Institute, Armenia \({}^{dd}\) Comenius Univ. Bratislava, Slovakia

###### Abstract

Prototypes of the FERMI system have been used to read out a prototype of the ATLAS hadron calorimeter in a beam test at the CERN SPS. The FERMI read-out system, using a compressor and a 40 MHz sampling ADC, is compared to a standard charge integrating read-out by measuring the energy resolution of the calorimeter separately with the two systems on the same events.

Signal processing techniques have been designed to optimize the treatment of FERMI data. The resulting energy resolution is better than the one obtained with the standard read-out.

Calorimetry; Signal processing; Read-out electronicsIntroduction

This paper summarizes the evaluation of the FERMI system prototypes used to read out a prototype of the ATLAS hadronic barrel calorimeter, Tilecal, during the July 1995 beam tests at the CERN SPS.

Tilecal is an iron-scintillator sampling hadron calorimeter with the distinctive feature that the scintillating tiles are oriented parallel to the impinging particles.

The major goals of the calorimeter are to identify jets and to measure their energy and direction, to measure the total missing energy and to enhance the particle identification of the electromagnetic calorimeter by measuring energy leakage and shower isolation. Additionally, the hadronic calorimeter should absorb all showering particles before they reach the muon chamber system, and provide low \(p_{T}\) muon identification.

To meet these goals the design aims at a resolution of \(50\%/\sqrt{E}\oplus 3\%\), a linearity of 1-2% up to a few TeV with a granularity in pseudo-rapidity and azimuthal angle of \(\Delta\eta\times\Delta\phi=0.1\times\,0.1\).

The need to resolve low energy muons sets the lower end of the dynamic range, 15 ADC counts are required for a muon depositing 0.5 GeV per read-out cell. From simulations, the maximum expected energy per cell in Tilecal is about 2 TeV, at a rate of a few events per year. This gives a required dynamic range of approximately \(2^{16}\).

The overall performance of the Tilecal prototype is reported in [1, 2, 3, 4] and the current status of the project is described in detail in the ATLAS Tile Calorimeter Technical Design Report [5].

The FERMI prototypes consist of an analog compressor and a 10 bits sampling ADC operating at 40 MHz on a custom VME board.

## 2 The FERMI Analog Channel

The FERMI project [6, 7] was started in 1990 with the aim to design a read-out system for calorimetry at high luminosity hadron machines, based on the concept of fast digitization of the analog signal followed by digital signal processing. For applications at the LHC, the basic requirement is to match the dynamic range implied by the physics (15-16 bits) with the ADC range (10-12 bits) technically feasible at the required digitization rate (40 MHz). This is achieved by a dynamic non-linear compressor. A schematic layout of the system is shown in Fig. 1.

The shaper takes input from either the photo-multiplier or the charge injection circuitry and delivers a 200 ns wide pulse (FWHM) in the 0-2 V range on the output. The compressor, schematically shown in Fig. 2, subsequently takes this signal and performs a non-linear

Figure 1: Block scheme of the read-out system. The digital pipeline has not been part of these tests.

transformation, compressing the signal according to an approximately piecewise linear transfer function, producing on the output a signal in the 0-2 V range.

The compressed signal is sampled at 40 MHz frequency by a custom designed 10 bit sampling ADC [8], which feeds a 256 sample FIFO register. A trigger starts the digitization at the next ADC clock cycle. The timing of the trigger is such that approximately twenty samples are taken before the peak. In total sixty consecutive ADC samples are taken to contain the pulse. The FIFO is then read out by the standard data acquisition system and data are stored on tape.

In Fig. 3 four single charge injection events of different amplitudes are shown. The regions of different gain are clearly shown on the two largest pulses, while the smallest is uncompressed, being totally within the first linear region of the compressor.

Figure 3: Example of four single charge injection events. Amplitude 3 is in the first linear region; amplitude 6 peaks at the first “knee”, 9 at the second and 15 in the third region. Note the different scales.

Figure 2: Concept of the compressor. This circuitry forms a sum of the outputs from four linear amplifiers with gains approximately 18.5, 1.3, 0.14 and 0.09 and upper cutoffs on the input voltage of 60, 470 and 1200 mV respectively. The fourth amplifier spans the full 2000 mV input range of the compressor. To the right, a typical transfer function as measured in the laboratory.

The compressed signals have to be decompressed before reconstruction of the calorimeter showers. This is conveniently done by mean of a lookup table for each channel. One of the main goals of this study is to devise and evaluate algorithms for the construction of these lookup tables from charge injection data. The design of the FERMI system foresees implementation of the lookup tables in hardware, thus allowing an online linearization and correction of the data.

## 3 Testing FERMI in a Particle Beam with Tilecal

A small number of prototypes of the FERMI analog channels were tested in 1994 in 300 GeV beams with both hadronic and electromagnetic barrel calorimeter prototypes [9, 10, 11]. In July 1995 a stack of five prototype modules of the ATLAS - Tilecal Calorimeter was tested in beams at the CERN SPS.

### Description of the One Meter Tilecal Prototype

Each prototype module (see Fig. 4) corresponds to a \(2\pi/64\) slice in azimuth (\(\phi\)), with a front face of \(\pm 50\) cm in \(z\) (horizontal direction, perpendicular to the beam) and \(\pm 10\) cm in the \(\phi\) direction. In the radial direction (along the beam) the modules measure 180 cm, corresponding to 9 nuclear interaction lengths, \(\lambda\). The five modules were stacked, covering together a \(\phi\)-angle of approx. \(26^{\circ}\). Each module has four radial (depth) segmentations corresponding to 1.5, 2.0, 2.5 and 3.0 \(\lambda\) (30, 40, 50 and 60 cm). In the \(z\)-direction each sampling is divided into five cells. Towers are defined as cells with the same \(z\) and \(\phi\). Fig. 4 shows a sketch of the cell layout for one module.

Each cell is read out independently from both sides, giving a total of 40 read-out channels per module. The central module in the stack was equipped with active splitters and double sets of read-out electronics, one based on standard integrating 12-bit ADCs, and one based on the FERMI concept. The numbers in Fig. 4 correspond to channel numbers in the central module. Four channels (117-120) were not equipped with FERMI, furthermore nine channels (82, 83, 90, 91, 92, 109, 110, 111, 112) were faulty or not well calibrated, leaving 27 FERMI channels for this analysis.

Figure 4: Cell layout and dimensions of a 1 m Tilecal prototype module. Numbers refer to the PMT (channel) numbers of the central module.

### Beam Line

Measurements were performed in the H8 beam line of the SPS at CERN. The stack of five prototype modules was mounted on a scanning table which allowed precise movements in \(\theta\), \(\phi\) and \(z\). The beam line (Fig. 5) was instrumented with two beam chambers defining the impact point and three scintillators for triggering.

The runs considered for the analysis are described in Table 1 and in Fig. 7.

### Precision Pulse Generator

The Precision Pulse Generator (PPG) used for the 1995 run was designed for the calorimeter of the UA2 experiment [12]. Three eight-channel PPG-modules are fed a 100 V DC voltage. This voltage can be subdivided in 14 steps, using a resistor ladder, according to a logarithmic scale. The PPG high voltage feeds a capacitor on each channel which, on a remote command, is shorted by an Hg relay. Each channel is connected to a PPG box which in turn either connects ten PMTs to their respective ADC-channels or distribute the signal from one PPG channel to ten ADC-inputs (see Fig. 6).

## 4 Techniques for FERMI Calibration

In the 1994 beam tests the number of calorimeter channels equipped with FERMI was not large enough to exploit the energy resolution of the calorimeter as a tool to measure the performance of the FERMI electronics. Therefore other techniques were developed to infer the behaviour of FERMI. Several of these techniques provide valuable information on the detailed features of single channels and have been refined in the subsequent analysis [13, 14].

\begin{table}
\begin{tabular}{||l|c|c|c|c||} \hline run & \# events & Beam type & \(\theta\) [deg] & \(z\) [cm] \\ \hline
33484 & 15205 & 300 GeV \(\pi^{-}\) & \(+10\) & \(-6\) \\
33485 & 15143 & 300 GeV \(\pi^{-}\) & \(+10\) & \(-8\) \\
33486 & 15172 & 300 GeV \(\pi^{-}\) & \(+20\) & \(-18\) \\
33487 & 15150 & 300 GeV \(\pi^{-}\) & \(+20\) & \(-20\) \\
33489 & \(\approx\)15000 & 300 GeV \(\pi^{-}\) & \(+30\) & \(-36\) \\ \hline \end{tabular}
\end{table}
Table 1: Runs and orientations of the calorimeter.

Figure 5: Test beam layout for the 1995 standalone test beam.

The standard read-out system, using charge integrating ADCs, provides a single number for the estimation of the energy per read-out channel. To calibrate these electronics it is sufficient to measure for each channel the pedestal and a calibration curve, by injecting a set of pulses of known charge.

The FERMI read-out system is different in two respects: the signal is sampled every 25 ns, providing information on the pulse amplitude as a sequence of numbers, and the measurements are not linear due to the signal compression. In the present system, the trigger is not synchronized with the ADC clock, so that the time jitter is uniformly distributed in a clock period. In future applications at collider experiments, the clock will be phase locked with the beam crossing time so that the jitter will be much reduced.

The analysis thus requires two steps. The first step is to construct a lookup table for each channel to linearize the measurements. The construction of lookup tables requires a detailed pulse shape reconstruction. This is described in the remainder of this section. The second step is to combine the samples of one channel to obtain an estimate of the energy released in each channel. This is discussed in the next section.

The calibration was performed using charge injection pulses. During the data taking period there was one dedicated run taken with PPG charge injection with 14 different pulse amplitudes. A few cuts were applied to the raw data to remove events with a pulse peak outside sample 17 through 24 and with amplitudes far from the mean or too small (\(<5\) ADC counts). Approximately 600 events per PPG amplitude were recorded for channels 81 through 116, 500-550 of which survived the cuts.

### Pulse Shape Reconstruction

Provided that the shaper is sufficiently linear, and that neither the shaper nor the compressor exhibits time slewing effects, the shape of the pulse is independent of the amplitude.

Figure 6: Layout of the PPG system.

By "shape" we denote the functional form of the pulse, modulo scaling in amplitude and translation in time. The scaling corresponds to different released charge, and the translation to different time of flights (depending on different orientations of the calorimeter). These two quantities can be estimated for each event and in the following we concentrate on the measurement of the scaling factor, that can be unambiguously converted to energy.

In this analysis the stored samples per event (time frames) are assembled to obtain the average pulse shape following an algorithm first used in [13].

Fig. 8 shows the average time frames for each amplitude for a given channel, before and after decompression with a preliminary lookup table measured in the laboratory. Pedestals are calculated from a few (8-10) samples preceding the pulse and subtracted from the compressed measurements. The sampling of the pulse shape in Fig. 8 is rather coarse compared to the width of the pulse and the distributions of the sample amplitudes are widened because of the random phase of the FERMI internal clock with respect to the trigger. A much finer sampling of the shape can be obtained using a phase estimator and rebinning the samples accordingly.

The phase estimator is constructed by computing the slope between two samples straddling the peak. We take our phase estimator as \(S=(s(19)-s(23))/s(21)\) where \(s(n)\) indicates the amplitudes of the samples \(n\). The choice of 21 as the peak sample is dictated by the delay fixed by the hardware. The resolution of this estimator of the phase is limited by the quantization of the ADC (times the derivative of the pulse at each point along the curve), statistics and noise. We have, somewhat arbitrarily, chosen to subdivide the bins into subbins of 1 ns.

Fig. 9 shows the amplitude-phase correlation in a 25 ns interval around the peak for two PPG levels, for compressed and decompressed data. Such correlations are used to construct Fig. 10, where we see the same data as in Fig. 8 reconstructed with a binning of 1 ns for all amplitudes. We note that all curves cross the zero line at the same point. In the lower two plots the pulses have been normalized to the same peak value to illustrate the similaritites of the shapes after decompression. More information on this approach can be found in [13].

### Methods for Deriving the Lookup Tables

The lookup table should provide an inverse of the compression function so as to restore linearity with quantization errors small compared to the resolution of the calorimeter.

The most straightforward approach is to perform quasi-static measurements in the labo

Figure 7: Impact points and direction of the beam in the five runs considered in this analysis.

ratory using a step function at the input and recording the step amplitude at the output. If the input can be controlled with sufficient precision, the full lookup table can be reconstructed.

An implicit assumption underlying this approach is that the value of the compressor output at a given time depends only on the value of the compressor input at the same time. That is in general not true because of the bandwidth limitation of the compressor and, more important, of its slew rate limitation. This implies that the compressor has a non-trivial and non-linear transfer function and that a quasi-static measurement may not be adequate, since the compression function could depend on the input pulse shape. Another approach is therefore to pulse in situ the electronics chain with a charge injection system that closely mimics the pulses from actual data.

If we could choose the amplitudes of the charge injection system with adequate granularity and control the phase of the injected pulse with respect to the ADC clock with arbitrary precision, the amplitude and shape dependence of the compression function could be studied with great precision.

In the present set-up there were however only 14 different amplitude settings and the timing between the pulse and the ADC clock could not be fixed or measured directly, but only estimated with help of the phase estimator defined in 4.1. We had thus to use more advanced methods, using the entire pulse, to extract the required information from the calibration data.

Two methods have been tested for reconstruction of the lookup tables, the Three Parameter Fit and the Pulse Shape Comparison.

#### 4.2.1 A Three Parameter Fit

The different gains of each individual compressor could vary slightly due to spread in component values, mostly in the supporting circuits. The values of the cutoff voltages could

Figure 8: Average time frames for compressed (left) and decompressed (middle and right) PPG pulses.

also vary. To the first order these effects can be taken into account by taking a model lookup table \(V_{\mathrm{model}}\) measured in the laboratory quasi-statically as mentioned above and distorting it slightly, by stretching and translating.

In this method we use only the peak amplitude values and the nominal charge of the PPG pulses. A parabolic fit is made to the peak region of the pulse shape to find an estimate of the peak value at zero phase. The extrapolation of the PPG peak amplitudes towards zero intercepts the charge axis at a non-zero value, \(q_{0}\), which is the first parameter. The model lookup table, converting ADC-values into charge, is then linearly stretched in the charge and ADC variables, defining two more parameters, \(\alpha\) and \(\beta\), respectively. The distance between the stretched lookup table \(V(k)=\alpha V_{\mathrm{model}}(\beta k)+q_{0}\) and the PPG points is minimized with respect to these three parameters

\[\min_{\alpha,\beta,q_{0}}\chi^{2}=\sum_{n}\,(\alpha V_{\mathrm{model}}(\beta k_{ \mathrm{PP}\,Gn})-(q_{\mathrm{PP}\,Gn}-q_{0}))^{2}.\]

The result is displayed in Fig. 11 where the unstretched and stretched model lookup table are plotted together with the measured PPG mean pulse peaks. The PPG data do not span the dynamic range of the compressors as well as the test beam, thus the lookup table is linearly extrapolated up to the highest values. This introduces an additional uncertainty for the channels measuring the highest energy in the test beam.

#### 4.2.2 Pulse Shape Comparison

A more sophisticated method uses the fact that in a perfectly linear system the shapes of the pulses are identical, modulo a scaling factor. In case of the PPG data the scaling factor is known as the charge injected; it is labelled \(E_{n}\).

Figure 9: Peak amplitude versus slope (phase estimator) for compressed (left, in ADC counts) and decompressed (right, in pC) PPG pulses 6 (top) and 15 (bottom).

In the procedure outlined below we assume a knowledge a priori of the lookup table \(V(k)\) for a limited range of ADC counts. For this we use laboratory measurements of a typical channel. This choice is not critical, since for low values of the ADC counts the lookup table is linear.

Denote the pulse shapes, reconstructed as described in section 4.1, \(s_{n}(i)\), where \(i\) indexes the time in bins of 1 ns, and \(n\) enumerates the different PPG amplitudes. We need to choose one such pulse as our reference, small enough to reside entirely within the first slope of the lookup table but large enough to stand clear of noise; this pulse is referred to as \(s_{\mathrm{ref}}(i)\).

Divide the ADC-axis into intervals between successive peak values of \(s_{n}\), \(k_{\max,n}=\left|\max_{i}s_{n}(i)\right.\), where \(\left|s_{n}(i)\right.\) represents the ADC quantized value corresponding to \(s_{n}(i)\). For each such interval \((k_{\max,n-1},\,k_{\max,n}]\) we use \(s_{n}\) and \(s_{\mathrm{ref}}\) to determine the updated lookup table.

The reference pulse \(s_{\mathrm{ref}}(i)\) is scaled up to the scale of the pulse under consideration. Because of shape invariance, this should correspond to the compressor input when it produces the compressed pulse \(s_{n}\) on the output:

\[V(\left|s_{n}(i)\right.)=\frac{E_{n}}{E_{\mathrm{ref}}}V(\left|s_{\mathrm{ref} }(i)\right.),\]

where \(V\) denotes the true (ideal) lookup table, and \(E_{\mathrm{ref}}\) the (injected) charge of the reference pulse.

To build the modified lookup table, \(V_{\mathrm{new}}(k)\), we need to average over all time steps (\(i\)) such that \(\left|s_{n}(i)\right.=k\). We require at least one value from the leading edge and one from the trailing edge to contribute to the determination of each ADC value. Since \(s_{n}(i)\) is discrete in

Figure 10: Reconstructed pulse shapes. Compressed (top left) and decompressed (top right). The decompressed pulses are normalized to their peak values (bottom). Due to noise, the peak value is not sharply defined for low amplitudes, thus the discrepancy between the curves in the lower left plot.

\(i\), it might skip ADC-values on either edge of the pulse. Therefore we define the extension of \(s_{n}(i)\) into the continuous domain by interpolation, \(\mathrm{s}_{n}(t)\). Finally we get:

\[V_{\mathrm{new}}(k)=\frac{1}{2}\frac{E_{n}}{E_{\mathrm{ref}}}\left(V(\mathrm{s}_ {\,ref}(t_{\mathrm{leading}}\,))+V(\mathrm{s}_{\,ref}(t_{\mathrm{ trailing}}\,))\right).\]

Because of slew rate problems present in the compressor used in the 1995 test beam run, the invariance of the pulse shape for different amplitudes is only approximate. Parts of the pulse rising or falling at different rates are compressed slightly differently. The effect is to give separate compression functions for the rising and falling edges of the pulse and to add amplitude dependent distorsions.

The lookup table built above is the one minimizing the pulse shape dependence on the amplitude, according to the least square minimization method.

The residual dependence of the pulse shape on the amplitude might give a non-linearity for any given amplitude estimator which may take different forms for different estimators. The approach taken here is to compute the value of a given estimator for each PPG step using the \(V_{\mathrm{new}}\) above. The values so calculated (\(F_{n}\)) are used to iteratively refine the correction factors for the lookup table (applicable for the given amplitude estimator):

\[V_{\mathrm{lin}}(k)=V_{\mathrm{new}}(k)L_{n}\qquad\qquad k\in\,(k_{\mathrm{ max},n\,-1},\,k_{\mathrm{max},n}],\]

where

\[L_{n}=\frac{F_{\mathrm{ref}}}{E_{\mathrm{ref}}}\frac{E_{n}}{F_{n}}.\]

As a result of this operation, discontinuities may appear in the lookup tables at the interface point between the ADC values linearized with two different pulse levels, as the factors

Figure 11: Model LUT (higher curve) compared to stretched LUT (lower curve) from three parameter fit in linear (top) and logarithmic scale (below). PPG pulses are shown as fat dots.

and \(L_{n-1}\) are in general not equal. In order to correct for this effect, a factor \(\alpha_{n}\) is defined as:

\[\alpha_{n}\,=\,\frac{V_{\mathrm{lin}}(\,k_{\max,n})-V_{\mathrm{lin}}(\,k_{\max, n-1})}{V_{\mathrm{new}}(\,k_{\max,n})-V_{\mathrm{new}}(\,k_{\max,n-1})}\]

and \(V_{\mathrm{lin}}\) is recalculated iteratively as:

\[V_{\mathrm{lin}}(\,k)\,=\,V_{\mathrm{lin}}(\,k-1)\,+\,\alpha_{n}\,(V_{\mathrm{ new}}\,(k)-V_{\mathrm{new}}(\,k-1)).\]

When the full \(V_{\mathrm{lin}}\) has been recomputed, new values for the \(F_{n}\) are obtained.

Using the new \(F_{n}\), the above procedure is repeated, always starting from the original \(V_{\mathrm{new}}\). After three iterations, the \(V_{\mathrm{lin}}\) obtained is taken as final result.

## 5 Energy Estimation

The energy content (or pulse amplitude) of each single cell is estimated from a subset of the sixty samples of a FERMI time frame; this procedure is called filtering. The optimum filtering algorithms both with linear and non-linear filters have been studied in detail in [14, 15, 16, 17, 18, 19]. Linear FIR (Finite Impulse Response) filters consist of a finite number of coefficients multiplying the samples. Here we consider only adders, filters with unit coefficients.

In general there are four dominant sources of degradations in the energy measurements of a sampled system: the electronic noise, the quantization error, the time jitter of the event and the pile-up coming from other events. In the condition of a test beam, the last term can be made negligible, controlling the beam intensity and removing overlapped events. For pulser events, this source does not exist at all.

The measurement of energy in presence of different sources of noise may lead to conflicting requirements on the filters. Long filters are required to suppress the contribution from jitter, while shorter filters may be more appropriate to suppress the electronic noise. The quantization error in presence of a non-linear quantization function follows a complex pattern strongly dependent on the details of the pulse and of the filter.

Figure 12: Resolution vs. adder length for three different PPG amplitudes, using pulse shape comparison lookup tables.

A simple, but quite effective, approach is the use of adders, varying the filter length. An adder suppresses the time jitter influence if it is long enough to include both the leading and the trailing edge of the pulse.

Therefore, for each event, the samples are decompressed using the lookup table. Then the pedestal is calculated from the average of the first few (8-10) samples. After pedestal subtraction, the adder is slid along the decompressed pulse until it reaches the maximum. Adders of length 1 through 25 have been considered.

## 6 Measurement of Resolution

### Single Channel Resolution

The intrinsic resolution of the two calibration methods is measured through the resolution of the charge injection data, using the energy estimates described above. We also look at the

Figure 14: Resolution for all channels with adders of length 11 using three parameter fit (left) or pulse shape comparison (right). PPG pulses below an amplitude of 0.07 pC have been cut.

Figure 13: Resolution vs. PPG amplitude for adders of lengths 5 and 11.

deviations from linearity of charge injection data, defined as the residuals of a fit of the averages of the energy estimates versus the charge injection amplitude. In Fig. 12 the resolution is plotted versus adder length for three different amplitudes, using pulse shape comparison lookup tables. The dependence of the resolution on the adder length is different for different amplitudes, due to different combination of the above mentioned error sources. For low amplitudes, the dominant source of uncertainty is noise, that grows with the adder length. For larger pulses noise is less significant, hence time jitter and quantization errors are predominant.

In Fig. 13 the resolution is plotted versus amplitude for adder lengths of 5 and 11. Except for the smallest amplitudes, the intrinsic resolution is always below 0.44 %. It is difficult to discern any difference between the three parameter fit method (\(\circ\)) and the pulse shape comparison method (\(*\)).

In Fig. 14 the resolution of all channels is histogrammed, for the case of an adder of length 11, using the two different lookup tables. The distributions are not significantly different.

In Fig. 15 the deviation from linearity vs. amplitude for a few channels is plotted for the two methods. In Fig. 16 the deviations from linearity for all channels are histogrammed for both methods. The pulse shape comparison clearly gives a better linearization than the three parameter fit.

### Event Sample Selection

For the analysis the \(\pi^{-}\) runs at 300 GeV that were best contained within the FERMI-equipped channels were chosen. These gave the smallest intrinsic fluctuations (due to leakage and sampling statistics) and made the most sensitive comparison of the two read-out systems.

In order to remove the electron and muon contaminations from the beam we demand that between 60% and 95% of the energy be deposited in the first two sampling depths of the calorimeter and that the total energy be above a threshold.

### Resolution with FERMI and the Standard Electronics

The most straightforward method of comparing the two read-out systems would use the energy resolutions obtained using the channels that were equipped with both types of electron

Figure 15: Deviation from linearity vs. amplitude for three different channels.

ics. Due to the large leakage into channels not equipped with FERMI electronics (mostly into the neighbouring modules) the fluctuations of the deposited energy is quite large.

To account for the leakage we reconstruct the energy released in the 173 channels with standard read-out electronics only, in addition to the 27 equipped with FERMI. In all runs the fraction of the total energy deposited in the FERMI equipped channels varies between 75 and 90%.

The resolution in both cases can be written as a quadratic sum of one energy dependent term and three or four constant terms. The energy dependent term is the intrinsic spread in the measurements, depending mainly on the calorimeter, and the constant terms are contributions from leakage, from the electronics calibration errors, and, when considering the sum of standard and FERMI channels, from interchannel calibration errors. Noise contribution is small at the energies considered and therefore is not included:

\[R_{S} = \frac{\sigma}{E}\bigg{|}_{S}=\frac{a}{\sqrt{E}}\oplus\,C_{\rm{lea\, kg}}\oplus\,C_{S1\,73}\oplus\,C_{S27},\] \[R_{\!F} = \frac{\sigma}{E}\bigg{|}_{F}=\frac{a}{\sqrt{E}}\oplus\,C_{\rm{ leakage}}\oplus\,C_{S1\,73}\oplus\,C_{F2\,7}\oplus\,C_{\rm{misintercalib.}},\]

where the subscript \(S\) denotes standard read-out electronics and \(F\) denotes FERMI.

When comparing only 27 channels, the \(C_{S1\,73}\) term does not contribute while lateral leakage in the \(\phi\) direction makes \(C_{\rm{lea\,age}}\) large; this term is however in common between the two different read-out electronics. When summing 200 channels the \(C_{S173}\) term gives a sizeable contribution while \(C_{\rm{lea\,age}}\) is smaller.

The quality of the electronics and our calibration methods is measured with the signed quadratic difference, \(\delta=\pm\sqrt{\left|\left(\left.\frac{\sigma}{E}\right|_{F}\right)^{2}- \left(\left.\frac{\sigma}{E}\right|_{S}\right)^{2}\right|}\), between the resolutions, where negative sign of \(\delta\) indicates that the standard term under the square root is larger than the FERMI term. This gives an estimate of the FERMI electronics contribution to the resolution. In order to assign

Figure 16: Deviations from linearity for all channels. PPG pulses with an amplitude below 0.025 pC are removed.

an error to \(\delta\), the high correlation between the measurements with FERMI and the standard electronics has to be taken into account.

### Measured Resolutions

In Table 2 and Table 3 we see that the three parameter fit method ("stretching") is slightly worse compared with the standard read-out electronics. Most likely that is due to the limitation of linearity in the lookup table shown in Fig. 16. On the other hand, the method based on linearized pulse shape comparison performs significantly better than the standard electronics, at least for an adequate filter length. This is demonstrated in Table 3. The main reason is likely to be the higher control on linearity guaranteed by this method.

The performance of FERMI can be summarized in a quadratic reduction of 1% of the constant term in the resolution.

Similar analyses at lower energies confirm this result.

## 7 Summary

A module of the prototype of the ATLAS hadronic calorimeter has been succesfully tested with a prototype version of the FERMI read-out system including a compressor and a sampling ADC.

A charge injection system has been used to calculate separately for each channel lookup tables that minimize amplitude dependent distortions and non-linearity.

These techniques in conjunction with the use of linear adders to process the sampled data, reduce the constant term in the energy resolution as compared to the one obtained with standard integrating ADCs.

The FERMI readout system performs well and is a good candidate for a calorimeter read-out system at LHC. For an optimal energy determination the system requires a detailed pulse shape calibration.

## References

* [1] M. Bosman _et al._, Developments for a scintillator tile sampling hadron calorimeter with "longitudinal" tile configuration, CERN/DRDC/93-3, 1993.
* [2] F. Ariztizabal _et al._, Nucl. Instr. and Meth. **A349**, 384 (1994).
* [3] E. Berger _et al._, Construction and performance of an iron-scintillator hadron calorimeter with longitudinal tile configuration, CERN/LHCC/95-44, 1994.
* [4] Z. Ajaltouni _et al._, Response of the ATLAS Tile Calorimeter prototype to muons, CERN/PPE/173-96, 1996, accepted for publication in Nucl. Instr. and Meth. A.
* [5] ATLAS Tile Collaboration, The ATLAS Tile Calorimeter Technical Design Report, CERN/LHCC/96-42, ATLAS TDR 3.

\begin{table}
\begin{tabular}{||l c|c c c|c c c|c c c||} \hline run & \multicolumn{3}{c|}{33484} & \multicolumn{3}{c||}{33485} & \multicolumn{3}{c||}{33486} & \multicolumn{3}{c||}{33487} & \multicolumn{3}{c||}{33489} \\ \hline stand. & & 5.16 \(\pm\) & 0.06 & 5.73 \(\pm\) & 0.08 & 4.36 \(\pm\) & 0.05 & 4.36 \(\pm\) & 0.05 & 4.67 \(\pm\) & 0.06 \\ \hline
3PF & 5 & 5.55 \(\pm\) & 0.07 & 6.13 \(\pm\) & 0.09 & 4.84 \(\pm\) & 0.06 & 4.75 \(\pm\) & 0.06 & 4.73 \(\pm\) & 0.06 \\
3PF & 11 & 5.39 \(\pm\) & 0.07 & 5.96 \(\pm\) & 0.09 & 4.61 \(\pm\) & 0.05 & 4.58 \(\pm\) & 0.05 & 4.69 \(\pm\) & 0.05 \\ \hline PSC & 5 & 5.14 \(\pm\) & 0.06 & 5.81 \(\pm\) & 0.08 & 4.41 \(\pm\) & 0.05 & 4.42 \(\pm\) & 0.05 & 4.71 \(\pm\) & 0.05 \\ PSC & 11 & 5.04 \(\pm\) & 0.06 & 5.59 \(\pm\) & 0.07 & 4.31 \(\pm\) & 0.05 & 4.32 \(\pm\) & 0.05 & 4.61 \(\pm\) & 0.05 \\ \hline \end{tabular}
\end{table}
Table 2: Resolutions (in %) for standard electronics (stand.), and FERMI with the look-up tables reconstructed with the three parameter fit (3PF) and the pulse shape comparison (PSC) methods for 5-adder and 11-adder for five runs (cf. Fig. 7), using 200 channels.