2004 ATLAS Combined Testbeam:

Computation and Validation

of the Electronic Calibration Constants

for the Electromagnetic Calorimeter

M. Aleksa\({}^{\,a}\), M. Delmastro\({}^{\,b,\,a}\), M. Fanti\({}^{\,b}\), R. Lafaye\({}^{\,c,\,a}\),

W. Lampl\({}^{\,a,\,1}\), S. Laplace\({}^{\,c}\), D. Prieur\({}^{\,c,\,a}\), F. Tarrade\({}^{\,c}\)

I. Wingerter-Seez\({}^{\,c}\)

\({}^{a}\) _CERN_

_CH-1211 Geneve 23, Switzerland_

\({}^{b}\) _Dipartimento di Fisica dell'Universita di Milano and INFN_

_I-20133 Milano, Italy_

\({}^{c}\) _Laboratoire d'Annecy-Le-Vieux de Physique des Particules (LAPP),_

_9 Chemin de Bellevue, BP 110, F-74941 Annecy-le-Vieux Cedex, France_

\({}^{1}\) _Now at University of Arizona,Tucson, AZ, 85721, USA_

**Abstract**

From July to November 2004, a full slice of the ATLAS barrel detector was studied in testbeam. A complete electromagnetic barrel module was used, read by the final electronics and operated by ATLAS TDAQ software. This note describes in details the electronic calibration procedure and the cell energy reconstruction: each step of the procedure and its associated software is explicitly described. The general calibration procedure is very similar to the one applied in previous barrel and endcap standalone testbeams. Emphasis is put on tools developed in the context of the combined testbeam which can be used for commissioning and operation of the calorimeters in ATLAS. Many validation studies were performed on each calibration constant. Previously unobserved effects such as the FEB temperature dependence of some constants were observed. Overall, the calibration performances are at the expected level.

[MISSING_PAGE_EMPTY:2]

###### Contents

* 1 Testbeam Set-up
	* 1.1 LAr Electromagnetic Module
	* 1.2 Cryostat and Feedthroughs
	* 1.3 Cabling Configurations
	* 1.4 Electronics Cooling
* 2 Calibration Board and Calibration Generated Signal
	* 2.1 General Description
	* 2.2 Laboratory Measurements on the Calibration Boards
* 3 Energy Reconstruction of a Single Cell
	* 3.1 Readout of the Induced Signal in the Calorimeter
	* 3.2 Obtaining \(ADC_{\mbox{peak}}\) with Optimal Filtering
		* 3.2.1 The Optimal Filtering Method
		* 3.2.2 Offline Software Implementation
		* 3.2.3 The Timing Issues
		* 3.2.4 TDC reconstruction
		* 3.2.5 Choosing the Right Set of OFC: the Time Offsets
		* 3.2.6 Reconstruction of Very Early or Very Late Pulses
		* 3.2.7 Iterative Time Adjustment and Time Offsets Computation
	* 3.3 Alternative Methods to Calculate \(ADC_{\mbox{peak}}\)
	* 3.4 The Ramp Factors
	* 3.5 The \(F_{\mbox{$DAC$}\to\mu\mbox{A}}\) Factor
	* 3.6 The \(\mu A\) to \(MeV\) Translation Factors
		* 3.6.1 Accordion
		* 3.6.2 Pre-Sampler
		* 3.6.3 Numerical Values for \(F_{\mu\mbox{A}\to\mbox{MeV}}\)
	* 3.7 Cross-Talk
* 4 Computation of Calibration Constants
	* 4.1 Pedestal, Autocorrelation Matrix and Noise
		* 4.1.1 Pedestal
		* 4.1.2 Autocorrelation Matrix
		* 4.1.3 Noise
	* 4.2 Delay Waves
		* 4.2.1 Principle of Computation
	* 4.3 Ramps
		* 4.3.1 Principle of Computation
		* 4.3.2 Obtaining \(ADC_{\mbox{peak}}\): Parabolic Interpolation
		* 4.3.3 Obtaining \(ADC_{\mbox{peak}}\): Pseudo Optimal Filtering Coefficients
	* 4.4 Optimal Filtering Coefficients
		* 4.4.1 Principles of computation
		* 4.4.2 Detector Model and Ionization Signal Prediction
		* 4.4.3 The \(\frac{M^{\mbox{\scriptsize phys}}}{M^{\mbox{\scriptsize cali}}}\) factor
* 5

[MISSING_PAGE_EMPTY:4]

## Introduction

The goal of the 2004 combined testbeam (CTB) was to demonstrate that all the ATLAS sub-detectors (barrel slice) can take combined data using ATLAS-like (prototypes and/or series production) read-out electronics and software. The set-up of the combined testbeam is shown on the sketch 1 and the photography 2, and is described in details in the Ref.[1]. For the LAr collaboration this testbeam was the first opportunity to test with real beam data the full read-out chain (Front end electronics, back end electronics, online software, DAQ) using ATLAS components. For online monitoring and offline reconstruction the ATLAS software framework, ATHENA was used.

The aim of this note is to summarize the electronics readout, the energy reconstruction and the electronics calibration of the electromagnetic LAr calorimeter as used in the combined testbeam 2004.

Figure 1: Schematic view of the H8 CTB setup, including the inner detector components and the LAr and Tile calorimeters.

[MISSING_PAGE_EMPTY:6]

Testbeam Set-up

### LAr Electromagnetic Module

Since at the time of the combined testbeam the series production modules had already been assembled into calorimeter wheels that were being integrated into their cryostats, one additional EM barrel module was stacked using the absorbers from an old prototype module and electrodes that were left over from the series production. All the cold electronics (summing boards, mother boards) and the cabling were identical to the ATLAS components. The module was stacked at LAPP, Annecy, one of the series module production sites of the ATLAS LAr collaboration.

### Cryostat and Feedthroughs

In former testbeams excessive resistive crosstalk [2] was measured in part of the cells and identified to stem from a bad ground connection of one of the two feedthroughs (lower feedthrough) of the testbeam cryostat. In order to reduce this crosstalk contribution it was decided to exchange this feedthrough before inserting the module into the cryostat. A spare production barrel feedthrough was used for this purpose. The module was then integrated into the cryostat and cabled. In order to be able to use a production LAr front end crate, the pedestal on the feedthroughs had to be modified and a new base-plane had to be installed. Again, all the components used (warm cables, base-plane) were spares.

The LAr testbeam cryostat containing the calorimeter module was lifted onto a table that was constructed for this purpose and was linked to the table accommodating the hadronic calorimeter. Both tables could be turned together in the horizontal plane and translated perpendicularly to the beam axis in order to be able to receive beam particles in different pseudo-rapidity (\(\eta\)) regions of the calorimeter 1. It was not possible to change the \(\phi\) position 2 of the modules, the beam impact in \(\phi\) was therefore close to \(\phi=0\) for most of the runs 3.

Footnote 1: The \(\eta\) range of the beam impact point was determined by the mechanics of the combined tables and was limited to \(0\leq\eta\leq 1.2\). Note that the \(\eta\) coordinate is also often expressed in units of Middle layer cell \(\eta_{\rm cell}=\mbox{int}\left(\frac{\eta}{0.025}\right)\).

Footnote 2: Note that the \(\phi\) coordinate is also often expressed in units of Middle layer cell \(\phi_{\rm cell}=\mbox{int}\left(\frac{\phi}{0.025}\right)\).

Footnote 3: Some runs were taken with a switched-on dipole magnet located in front of the calorimeter, thus deflecting the beam particles to cell positions with \(\phi\neq 0\).

The cryostat was filled with liquid argon cooled down to 89.7 K. This temperature was very stable throughout the data taking apart from two days (July 27 to July 29, 2004) where the temperature was 89.6 K.

### Cabling Configurations

One LAr barrel EM calorimeter module (3424 read-out channels, 256 calibration channels) is read out by 28 Front End Boards (FEBs) that are plugged into the front end crate and connected to the base-plane. The cables going through one feedthrough (corresponding to the signals of half a front end crate) serve half of the module 4 in \(\phi\). Only 16 FEBs were available at the time of the CTB. In order to have sufficient lateral containment in \(\phi\) for pions, it was decided to prepare three different front end board configurations that would cover the whole EM calorimeter module in \(\phi\) and three different regions in \(\eta\).

* high \(\eta\) configuration: \(-0.2<\phi<0.2\), \(0.8<\eta<1.4\)
* low \(\eta\) configuration: \(-0.2<\phi<0.2\), \(0.0<\eta<0.8\)
* intermediate \(\eta\) configuration: \(-0.2<\phi<0.2\), \(0.6<\eta<1.2\)

Figures 3 and 4 show the different FEB configurations that were used during the CTB. Period 1 and 7 are high \(\eta\) configurations, periods 2 and 3 are intermediate \(\eta\) configurations, and the rest, periods 4, 5, 6, and 8 are low-\(\eta\) configurations. The numbers in the horizontal slots of the figures denote the coverage of the board in \(\eta\), the feedthrough and slot numbers (FTn-Slmm _e.g._FT1-Sl12), the online FEB identifier (8 hexadecimal digits _e.g._390d8000), the actual FEB position (_e.g._MID1), the FEB type-serial number (_e.g._MID1-137316). In the header on the left hand side of each figure, the corresponding calibration runs are indicated (apart from period 1).

### Electronics Cooling

An under-pressure water cooling system was used to cool the FEBs and the calibration boards. Unfortunately, during the testbeam, there were certain periods with incomplete cooling leading to changing temperatures (and hence changing properties) of the FEBs. Different problems were identified:

* The water was contaminated with organic pollution thus blocking the water flow in individual FEBs; affected FEBs were usually taken out of the front end crate, and the cooling plates were dismounted and cleaned.
* Air leaks of the water cooling system lead to air inclusions in the water tubes blocking the water flow; a higher pressure difference between the water input and output was applied to restart the water flow.

The FEBs temperature also varied until September 8, 2004 because, for this period, the FEBs voltage regulators were switched on at the start of each run and off at the end.

## 2 Calibration Board and Calibration Generated Signal

There is one calibration board per half crate _i.e._ for a full module in \(\eta\) and half a module in \(\phi\) (8 middle cells): there were thus two calibration boards used during the whole data dating period, called CALIB02 (FT1) and CALIB03 (FT0).

The calibration board principle has been extensively described in [3]. The two boards used in 2004 were from the ATLAS production pre-series; there are differences with the ones used in previous testbeams which are described [3]. The main differences, apart from the radiation hardness, are:

* The parasitic injected charge has been reduced by a factor 10.
* The board is not configured for the full sequence at the start of the calibration run but reloaded after each step.

Figure 3: FEB cabling configurations. top left: period 1, from July 1 to July 12, top right: period 2, from July 12 to July 16, bottom left: period 3, from July 26 to August 4, bottom right: period 4, from August 4 to August 6.

Figure 4: FEB cabling configurations. top left: period 5, from August 6 to August 23, top right: period 6, from August 23 to September 15, bottom left: for period 7, from September 15 to September 25, bottom right: period 8, from September 25 until the end of the run (Nov. 15).

The two boards are not identical as it was decided to change the inductance values between CALIB02 and CALIB03: the inductance chosen for the latter board (CALIB03) was changed from 10 to 12 nH to better match the drift time of physics pulses (the boards produced for ATLAS also have 12 nH inductance). Nominal parameters of these two boards are given in table 1.

### General Description

One calibration board has 128 calibration lines; each line pulses between 8 and 32 channels depending on the layer. Table 2 lists the correspondence between calibration line and detector region, for each layer. Figure 5 shows a simple graphical representation from [4] of the way detector cells are pulsed.

The signal produced by the calibration board is an exponential pulse, with a decay time \(\tau_{\rm cali}\) chosen to match the physics signal triangular shape for the nominal high voltage. In Fig. 26 of section 4.4.2 the calibration and physics pulses after shaping are shown.

The amplitude of the signal is controlled by a 16 bit \(DAC\), providing a voltage between 0 and 1 V by step of 15.26 \(\mu V\). The precise input current is generated from the DAC voltage through a voltage to current converter, using a low offset operational amplifier (OpAmp), providing a uniform DC current. The current is distributed to the readout channel via a resistor network, precise at the per mil level, located on the detector motherboard. The amplitude of the injected current is

\[F_{DAC\rightarrow\mu\rm A}=\frac{76.295\ \mu V}{R_{inj}}, \tag{1}\]

\begin{table}
\begin{tabular}{|c|c|c|} \hline  & FT0 & FT1 \\ \hline Calib. boards & CALIB03 & CALIB02 \\ inductances & 12 nH & 10 nH \\ \(\tau_{\rm cali}\) & \(\simeq\)480 ns & \(\simeq\)400 ns \\ \hline \end{tabular}
\end{table}
Table 1: Nominal parameters for the two calibration boards used during the CTB. Measurements done on the final calibration boards (equiped with 12nH inductances) give \(\simeq 430ns\) to be compared to 480 ns nominal.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|} \hline \(|\eta|\) & PS & Strips & Middle & Back & Barrel-End \\ \hline
0.0-0.2 & 120 & 0-3 & 4-11 & 12-15 & - \\
0.2-0.4 & 121 & 16-19 & 20-27 & 28-31 & - \\
0.4-0.6 & 122 & 32-35 & 36-43 & 44-47 & - \\
0.6-0.8 & 123 & 48-51 & 52-59 & 60-63 & - \\
0.8-1.0 & 124 & 64-67 & 68-75 & 76-79 & - \\
1.0-1.2 & 125 & 80-83 & 84-91 & 92-95 & - \\
1.2-1.4 & 126 & 96-99 & 100-107 & 108-111 & 112-119 \\ \hline \hline Number of detector cells & & & & & \\ pulsed by ONE & 16 & 32 & 8 & 8 & 8 \\ calibration line & & & & & \\ \hline \end{tabular}
\end{table}
Table 2: Correspondence between calibration lines and detector cells.

Figure 5: Description of the pattern pulsed by each calibration line from [4].

where \(R_{inj}\) is the injection resistor.

Each board is equipped with two 4-channels delay chips, each channel controlling 16 calibration lines (delay channel = calibration line index/16). Each delay channel can be set between 0 and 24 ns by steps of 1 ns; its function is to allow the relative adjustment between regions (16 calibration lines) of the calorimeter while pulsing the detector. This chip was not used during the CTB (contrary to the 2001/2002 periods where it was used for delay runs).

In contrast to what was done in previous testbeams, the timing scan was provided by the TTCrx chip which allows to move the calibration pulse between 0 and 24.95 ns by steps of 104 ps, for the entire calibration board. During the CTB, this chip was used by steps of 1.04 ns.

The calibration boards parameters DAC, delay, pattern are loaded on the boards via the SPAC protocol (interfaced to the I2C bus on the board) the TTCrx chip via the TTC system or the I2C/SPAC. These parameters are:

* the pattern _i.e._ the set of calibration lines to be turned ON. Each pattern is a set of 128 bits (four 32 bit words) (_cf_ Table 3)
* the \(DAC\) to be chosen between 0 and 65535,
* the delay value for the 8 channels of the delay chips (8 values between 0 and 24),
* the delay values of the TTCrx chip (0-240).

The parameters used for typical ramp runs are listed in table 3

### Laboratory Measurements on the Calibration Boards

The performance of the calibration boards has been measured on test-benches in laboratories. These measurements consisted of the following:

* Amplitude linearity: the integral non-linearity is defined in the following way: \[I_{NL}=\frac{ADC_{meas}-ADC_{fit}}{ADC_{max}},\] (2) where \(ADC_{meas}\) is the maximum of the delay curve, \(ADC_{fit}\) is obtained from the linear ramp fit and \(ADC_{max}\) is the \(ADC\) value corresponding to the maximum \(DAC\) value (655, 6553, 65535 depending on the gain range). The three plots of Fig. 6 show the measurement for a typical calibration board: the resulting non-linearity is better than \(10^{-3}\).
* Amplitude uniformity: Figure 7 shows the response over 128 channels in high gain. The non-uniformity is around \(10^{-3}\).
* Decay time: On Fig. 8 is shown the measured exponential decay time \(\tau_{\rm cali}\) for CALIB03.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|} \hline First DAC & & Last DAC & & Nb DACs & \\
[0-35565] & 0 & [0-35565] & 1600 & [1-100]” & 16 \\ \hline \hline First Delay & & Last Delay & & Nb Delays & \\
[0-240] & 0 & [0-240] & 0 & [1-25] & 1 \\ \hline \hline N Patterns & & & & & \\
[1-17] & 16 & & & & \\ \hline Pattern \# & 0 & 1 & 2 & 3 & \\ Bit Range & 31-0 & 63-32 & 95-64 & 127-96 & \\ \hline Pattern1 & 00010001 & 00010001 & 00010001 & 00000001 & Strips \\ Pattern 2 & 00020002 & 00020002 & 00020002 & 00000002 & Strips \\ Pattern 3 & 00040004 & 00040004 & 00040004 & 00000004 & Strips \\ Pattern 4 & 00080008 & 0008008 & 0008008 & 00000008 & Strips \\ Pattern 5 & 00100010 & 00100010 & 00100010 & 00010010 & Middle+BE \\ Pattern 6 & 00200020 & 00200020 & 00200020 & 00020020 & Middle+BE \\ Pattern 7 & 00400040 & 00400040 & 00400040 & 00040040 & Middle+BE \\ Pattern 8 & 00800080 & 0080080 & 00800080 & 00080080 & Middle+BE \\ Pattern 9 & 01000100 & 01000100 & 01000100 & 00100100 & Middle+BE \\ Pattern 10 & 02000200 & 02000200 & 02000200 & 00200200 & Middle+BE \\ Pattern 11 & 04000400 & 04000400 & 04000400 & 00400400 & Middle+BE \\ Pattern 12 & 08000800 & 08000800 & 08000800 & 00800800 & Middle+BE \\ Pattern 13 & 10001000 & 10001000 & 10001000 & 00001000 & Back \\ Pattern 14 & 20002000 & 20002000 & 20002000 & 00002000 & Back \\ Pattern 15 & 40004000 & 40004000 & 4000400 & 00004000 & Back \\ Pattern 16 & 80008000 & 8000800 & 8000800 & 0000800 & Back \\ \hline Pattern 17 & 00000000 & 00000000 & 00000000 & ff000000 & PS \\ \hline \hline \end{tabular}
\end{table}
Table 3: Summary of calibration parameters used in ramp and delay runs. The patterns are defined on 128 bits (1 bit per calibration line) represented by 4 words of 32 bits; the pattern are displayed in hexadecimal format. Line 0 is ON if the first bit of the first pattern word is set. Line 2 is ON if the 2nd bit (bit 1) of the first pattern is set. Example of calibration parameters used for a High Gain Ramp run, for the accordion calorimeter (patterns 1 to 16) and the presampler (pattern 17).

Figure 6: Integral non-linearity, \(I_{NL}\) defined in Eq. 2 for the three gain ranges. The left plots show the \(I_{NL}\) as a function of the DAC values and the right are the projections, showing an \(I_{NL}\lesssim 0.1\%\). The top row is for DAC values corresponding to High Gain, the middle to Medium Gain and the bottom raw to Low Gain.

Figure 8: Exponential decay time \(\tau_{\rm cali}\) as a function of the calibration line, for the calibration board CALIB03

Figure 7: Signal uniformity as a function of the calibration line number, for DAC=9830 (Medium Gain). The RMS of the distribution is 0.12% when the specifications are 0.2%.

Figure 9: Timing non-linearity with TTCrx chip.

* Time linearity: Figure 9 shows the timing linearity as a function of the TTCrx step and the jitter measured on the test-bench. The residuals between the timing measurements and fitted slope are less then 200 ps, and the jitter is better than 70 ps.
* Time uniformity: Figure 10 shows as a function of the calibration line the time of the output signal. One can observe a 1 ns amplitude variation depending on the calibration channel position on the board. This effect is currently not taken into account, but should be in the future.

## 3 Energy Reconstruction of a Single Cell

### Readout of the Induced Signal in the Calorimeter

On the Front End Boards (FEBs), the signal is passed through a pre-amplifier and a shaper and is subsequently sampled by a 12 bit \(ADC\). The \(ADC\) has a pedestal of about 1000 \(ADC\) counts to accommodate the undershoot of the shaper. During the CTB, six points5 were sampled and digitized by the \(ADC\). Figure 11 shows the triangular shape as well as the shaped signal with a few samples. The samples are sent via an optical link (GLINK) from the FEB to the Read-Out Driver (ROD) that is located in the counting room.

Figure 10: Time non-uniformity between the 128 channels of a board. Two effects are visible: a periodic structure for eight channels of a pulser row, due to the path length from the pulser to the output connector and a double banana effect coming from the path length to the two output connectors. No correction to take into these effects has been implemented yet.

In contrast to what is planned in normal ATLAS data-taking, during the testbeams, the RODs acted in transparent mode, meaning that no energy computation was done and the samples passed through without transformation. The energy computation was thus done offline in the following way:

\[E=F_{\mbox{\small{$DAC$}}\rightarrow\mu\mbox{A}}\cdot F_{\mu\mbox{A} \rightarrow\mbox{MeV}}\cdot\frac{1}{\mbox{M}_{\mbox{\tiny{phx}}}}\sum_{j=1,2} R_{i}\left[\mbox{\small{$ADC$}}_{\mbox{peak}}\right]^{j}, \tag{3}\]

where

* the factors \(F_{\mbox{\small{$DAC$}}\rightarrow\mu\mbox{A}}\) and \(F_{\mu\mbox{A}\rightarrow\mbox{MeV}}\) are converting the \(DAC\) into MeV.
* the factor \(\frac{\mbox{M}_{\mbox{\tiny{phx}}}}{\mbox{M}_{\mbox{\tiny{cali}}}}\) corrects the ramp factors for the difference between the calibration and physics signal heights 6. Footnote 6: The \(\frac{\mbox{M}_{\mbox{\tiny{phx}}}}{\mbox{M}_{\mbox{\tiny{cali}}}}\) factor is obtained during the physics waveform prediction procedure described in Section 4.4, and in the present implementation of the reconstruction software is factorized in the Optimal Filtering Coefficients (Section 3.2.1).
* the factors \(R_{i}\) are the second order electronics ramps converting the \(ADC\) to \(DAC\).
* the factor \(\mbox{\small{$ADC$}}_{\mbox{peak}}\) is the peak of the shaped ionization signal computed by optimal filtering or by some alternative methods described later.

The following sections describe how these various factors are computed.

Figure 11: Form of the ionization signal (a) and the shaped ionization signal (b). The samples are also indicated [5].

### Obtaining \(\mathit{ADC}_{\text{peak}}\) with Optimal Filtering

#### 3.2.1 The Optimal Filtering Method

The Optimal Filtering (OF) method [6] is an elegant way to compute the peak of a shaped ionization signal by minimizing the electronics noise contribution.

The amplitude \(A\) and the time offset \(\tau\) of such a signal can be computed using a weighted sum:

\[A=\sum a_{i}s_{i}, \tag{4}\]

\[A\tau=\sum b_{i}s_{i}, \tag{5}\]

where \(a_{i}\) and \(b_{i}\) respectively are the energy and time Optimal Filtering Coefficients (OFC) and \(s_{i}\) are the pedestal-subtracted \(ADC\) samples. Note that the time information is only meaningful if the ionization signal is sufficiently above noise.

The OFC are computed for each cell and gain using the following ansatz for the signal:

\[S(t)=A\cdot(g(t)-\tau g^{\prime}(t)+n(t)), \tag{6}\]

where \(g(t)\) is the normalized shape of the ionization signal, \(g^{\prime}(t)\) is its first derivative and \(n(t)\) is the noise component given by the noise autocorrelation matrix. Sections 4.2 and 4.4 explain how these different inputs are derived.

#### 3.2.2 Offline Software Implementation

The algorithms computing the energy of a single cell are located in the package LArROD (containing software that emulates the ROD). The algorithm LArRawChannelBuilder [7] takes as input a LArDigitContainer containing the \(ADC\) counts (usually read from the byte stream file) and produce a LArRawChannelContainer containing the energy. The calibration data needed for the energy reconstruction are read from the conditions database.

#### 3.2.3 The Timing Issues

Eq. (6) implies that the ionization signal and the reference signal shape used to calculate the OFC are in phase up to a small deviation \(\tau\), which can be estimated by the formula (5). If the timing is off by more than 2 or 3 ns, the resulting amplitude will be wrong.

In ATLAS, where the bunch crossings and the readout clock are synchronous the pulses get always sampled at the same position and one set of OFC is sufficient. In the test beam environment this is not the case since the beam is asynchronous to the readout clock. Depending on the phase shift between the clock and the particle arrival, a different fraction of the pulse is sampled. To cope with this situation, multiple sets of OF coefficients are calculated spanning the region between two \(ADC\) samples in bins of \(\Delta t\sim\)1 ns, each set being identified by an index \(t_{\text{bin}}^{\text{OFC}}\) defined between 0 and \(N_{\text{phases}}-1\) (see Section 4.4). The right set of coefficients is selected using the information coming from and external Time-to-Digits Converter (TDC) that measures the time between the CTB master trigger and the readout clock.

#### 3.2.4 TDC reconstruction

The TDC measures a quantity \(\mathrm{tdc_{raw}}\) in \(\mathrm{tdc_{tick}}\) units; \(\mathrm{tdc_{raw}}\) is directly proportional to the time elapsed between the TDC start (triggered by the CTB master trigger) and the TDC stop (triggered by the nearest LHC clock cycle)7. A proper calibration of \(\mathrm{tdc_{raw}}\) is necessary to obtain a sizable \(t_{\mathrm{phase}}\) time information to be used later in reconstruction:

Footnote 7: This setting is of course arbitrary: a sensible time information would be obtained as well by triggering the TDC start by the LHC clock, and TDC stop by the CTB master trigger. This would only change the sign of the \(\alpha_{\mathrm{tdc\rightarrow\mathrm{ns}}}\) calibration constant.

\[t_{\mathrm{phase}}=\left\{\begin{array}{ll}\alpha_{\mathrm{tdc\rightarrow \mathrm{ns}}}(\mathrm{tdc_{raw}}-wac)&,\mathrm{tdc_{raw}}\geq wac\\ \alpha_{\mathrm{tdc\rightarrow\mathrm{ns}}}(\mathrm{tdc_{raw}}-wac)+T_{ \mathrm{samp}}&,\mathrm{tdc_{raw}}<wac\end{array}\right. \tag{7}\]

which yields \(t_{\mathrm{phase}}\in[0,T_{\mathrm{samp}}]\).

Both the TDC calibration constants (\(\alpha_{\mathrm{tdc\rightarrow\mathrm{ns}}}\), \(wac\)) are obtained from the analysis of the correlation between \(\mathrm{tdc_{raw}}\) and the time \(t_{\mathrm{cubic}}\) of the signal peak with respect to the first digitized sample, as reconstructed with a cubic fit of the signal samples. This correlation is shown on Figure 12 (left).

The \(\alpha_{\mathrm{tdc\rightarrow\mathrm{ns}}}\) sign is chosen in a way that \(\mathrm{tdc_{raw}}\) and the reconstructed \(t_{\mathrm{phase}}\) are directly correlated as shown on Figure 12 (right). The factor \(\alpha_{\mathrm{tdc\rightarrow\mathrm{ns}}}\) is related only to the intrinsic characteristics of the TDC module, thus it is stable in time and setup-independent. The TDC counter used during the 2004 CTB had \(\alpha_{\mathrm{tdc\rightarrow\mathrm{ns}}}\) = -0.036 ns/\(\mathrm{tdc_{tick}}\).

The "wrap-around constant" (\(wac\)) accounts for the discontinuity in \(t_{\mathrm{cubic}}\) when plotted with respect to \(\mathrm{tdc_{raw}}\). The origin of the wrap-around constant is explained in Figure 13: although in the sketch particle 2 arrives later than particle 1, and has therefore a larger value of \(\mathrm{tdc_{raw}}\), the reconstructed time \(t_{\mathrm{cubic}}\) is smaller for particle 2.

The \(wac\) value is measured in \(\mathrm{tdc_{tick}}\) units, and depends on the trigger setting: each time a different latency is introduced between the CTB master trigger and the LAr readout a new \(wac\) value has to be computed. During the CTB, 10 different \(wac\) values were identified from the TDC data analysis.

For events with \(\mathrm{tdc_{raw}}\) too close to the \(wac\) value, \(t_{\mathrm{phase}}\) can be ambiguously reconstructed, its value being estimated to be close to the wrong extrema of \([0,T_{\mathrm{samp}}]\). Since this wrong

Figure 12: TDC calibration using data from CTB run 1000993. Left: reconstructed peak time \(t_{\mathrm{cubic}}\) vs. \(\mathrm{tdc_{raw}}\). Right: reconstructed peak time \(t_{\mathrm{cubic}}\) vs. reconstructed \(t_{\mathrm{phase}}\).

attribution would strongly affect the OF reconstruction of these events (the OF reconstruction at the CTB relies of the knowledge of \(t_{\rm phase}\), see Section 3.2.5), a "guard region" cut \(\delta\) is applied to reject all those LAr events for which \(|{\rm tdc}_{\rm raw}-wac|<\delta\). During the CTB, the TDC "guard region" cut was \(\delta~{}=~{}10~{}{\rm tdc}_{\rm tick}\), compatible with the resolution of the master trigger scintillator.

The TDC reconstruction is performed by the TBPhaseRec algorithm in the TBRec package. The H8PhaseCalib.txt file in the same package contains the values of the TDC calibration constants with the relative IOVs. The "guard region" cut is applied through the GuardRegion job option.

#### 3.2.5 Choosing the Right Set of OFC: the Time Offsets

The OFC subsets are indexed in a way that a later fraction of the pulse is associated with a higher \(t_{\rm bin}^{\rm OFC}\) (see Section 4.4). Since the read-out clock is fixed and the particle arrival time varies, a pulse arriving late implies that an earlier fraction of it is sampled (and the other way round). Because \(t_{\rm phase}\) is reconstructed to be directly proportional to \({\rm tdc}_{\rm raw}\)  and \({\rm tdc}_{\rm raw}\) measures the time between the particle arrival time and the read-out clock, \(t_{\rm phase}\) is _anti-correlated_ to \(t_{\rm bin}^{\rm OFC}\). For this reason, when an OFC set is to be chosen for a given event according to the reconstructed \(t_{\rm phase}\), one uses \(t_{\rm phase}{}^{\prime}=T_{\rm samp}-t_{\rm phase}\) in order to restore a direct correlation 8.

Footnote 8: Since the anti-correlation between \(t_{\rm phase}\) and \(t_{\rm bin}^{\rm OFC}\) is a reconstruction artifact, related both to the (arbitrary) sign of \(\alpha_{\rm tdc\to nS}\) in the tdc reconstruction, and to the tdc cabling settings (it can measure the time between the particle trigger and the readout-clock, or the inverse as well), the \(t_{\rm phase}\) inversion is configurable in the LArRawChannelBuilder using the InvertPhase job option.

The exact time when the ionization signal is sampled depends also on cabling delays on the signal line and trigger latencies. In the test beam setup, these values changed from time to time because of modifications to the trigger setup. To cope with this situation, time

Figure 13: Sketch explaining the reason of the wrap around constant (\(wac\)). The dash-pointed vertical lines (1) indicate the 25 ns clock, the uppermost horizontal line (2) indicates the time axis of the master trigger TDC (\({\rm tdc}_{\rm raw}\)), and the line (3) denotes the time axis of the digitization of the calorimeter signal (defining \(t_{\rm cubic}\)). Particle 1 passes the master trigger at time (4), and gets digitized in the calorimeter at time (5), for particle 2 the corresponding times are (6) and (7)). Since we measure the time from the last 25 ns clock cycle, there is a discontinuity in \(t_{\rm cubic}\) between the particles 1 and 2. The time value of the discontinuity (\(wac\)) is drawn as a vertical dashed line (8).

correction constants have been introduced. The total time shift used to pick a set of OFC is computed as:

\[t_{\rm bin}^{\rm OFC}={\rm int}\left[(T_{\rm samp}-t_{\rm phase})+T_{\rm FEB}^{\rm offset }+T_{\rm global}^{\rm offset}\right], \tag{8}\]

with:

* \(T_{\rm FEB}^{\rm offset}\) (FEB to FEB time offset) accounts for FEB-dependent timing differences due to different cable lengths. For a given cabling of the LAr calorimeter module there is a \(T_{\rm FEB}^{\rm offset}\) value per installed FEB.
* \(T_{\rm global}^{\rm offset}\) (global time offset) accounts for changes in the latency between the readout and the master trigger, and in the master trigger cabling. This number changed frequently (_e.g._ each time a new sub-detector was added or removed from the global CTB readout, or the cabling of the trigger was modified) 9. Footnote 9: For practical reason the \(T_{\rm global}^{\rm offset}\) computation can be skipped, and its value absorbed in the \(T_{\rm FEB}^{\rm offset}\) ones. This was the approach followed during the debugging procedure of the OFC reconstruction. The time \(t_{\rm bin}^{\rm OFC}\) is then always positive, since \((T_{\rm samp}-t_{\rm phase})\) is always defined between 0 and \(T_{\rm samp}\), and \(T_{\rm global}^{\rm offset}\) and \(T_{\rm FEB}^{\rm offset}\) are requested to be positive.

#### 3.2.6 Reconstruction of Very Early or Very Late Pulses

In case of very early or very late pulses 10, the optimal \(t_{\rm bin}^{\rm OFC}\) may exceed the maximum number of OFC sets computed to cover a sampling period \(T_{\rm samp}\). Such events can still be reconstructed if:

Footnote 10: This situation is verified when the latencies of the readout FEBs have not been properly tuned with respect to the master trigger, _e.g._ when the maximum sample of a pulse being digitized is not the third one.

* more than five \(ADC\) samples are available;
* the available sets of OFC \(N_{\rm phases}\) span a larger range than the sampling period.

The second option implies that the fraction of the pulse used for peak reconstruction is not centered around the peak: the OF reconstruction still allows a peak reconstruction, but the signal to noise ratio deteriorates. It is therefore better to take more \(ADC\) samples: at the CTB 6 \(ADC\) samples were usually taken.

The current implementation of the LArRawChannelBuilder assumes that the number or \(ADC\) samples is greater or equal to the number of OFC. The InitialTimeSampleShift job option the number of leading \(ADC\) samples to be skipped: if the total time offset \(t_{\rm bin}^{\rm OFC}\) is found to be too large, this number is increased by one and the sampling period \(T_{\rm samp}\) is subtracted from the total time offset. On the other hand, if the total time offset is too small (negative), this number is decreased by one and the sampling period \(T_{\rm samp}\) added to the current \(t_{\rm bin}^{\rm OFC}\).

Additionally, in order to account for all the possible positive and negative latencies, \(N_{\rm phases}\)= 50 OFC sets have been computed for each cell starting from the baseline section of the each predicted physics pulses, thus covering a \(N_{\rm phases}\times\Delta t\simeq 52{\rm ns}>2\)\(T_{\rm samp}\) (see Section 4.4 for details).

#### 3.2.7 Iterative Time Adjustment and Time Offsets Computation

Since the time deviation of the physics from the reference signal is accessible via the OF time coefficients (\(b_{i}\) in Eq. 5), the exact timing can be found by an iterative procedure, provided there is sufficient signal in the channel 11.The algorithm LArTimeTuning performs such iterations to obtain the corrections \(T_{\rm FEB}^{\rm offset}\) and \(T_{\rm global}^{\rm offset}\) mentioned above, according to the job option settings.

Footnote 11: If the \(ADC\) samples are dominated by noise, the equation (5) does not give any useful result.

During the data reconstruction the \(T_{\rm global}^{\rm offset}\) and \(T_{\rm FEB}^{\rm offset}\) constants are loaded from job options into memory by LArEventTest/FakeLAtTimingOffset, so that the LArRawChannelBuilder can access them as they were imported from the conditions database. The \(T_{\rm global}^{\rm offset}\) and \(T_{\rm FEB}^{\rm offset}\) values for the different CTB data-taking periods are located in the LArTBRec package.

### Alternative Methods to Calculate \(\mathbf{ADC}_{\mbox{peak}}\)

The algorithm LArRawChannelSimpleBuilder implements the following alternative methods to reconstruct \(\mathbf{ADC}_{\mbox{peak}}\): they can be used if all calibration constants are not yet available (for example, at the monitoring stage).

**Highest Sample:**: use the highest \(ADC\) sample. This leads to a positive bias since the noise does not cancel out.
**Fixed Sample:**: use a sample which index is defined by job options.
**Cubic or Parabolic Interpolation:**: interpolate a \(2^{nd}\) or \(3^{rd}\) order polynomial on 3 or 4 samples respectively (if the maximum is above a given threshold). Since the signal shape is not parabolic neither cubic around the maximum, these interpolations lead to biased results. One can derive corrections to these biases using the delay waves: for historical reasons, this has been done for the parabolic case, but not the cubic one. Therefore, one mainly use the parabolic bias-corrected method as an alternative reconstruction method when OFC are not available.

### The Ramp Factors

The relation of \(ADC\) counts to \(DAC\) is measured on a regular basis by the electronic calibration system.

The \(ADC\) to \(DAC\) can be either linear or polynomial to take possible non-linearities of the electronic chain into account. the polynomial ramp is used. Note that in this case, the intercept is not used for all gains: analysis of previous testbeams suggests that using the intercept in medium gain (and not in high gain) improves the linearity [8].

The LArRawChannelSimpleBuilder can use a hard-coded ramp as fall-back solution in case the electronic calibration is not available. There is one such number per gain and per layer of the calorimeter except of the middle compartment where two numbers per gain are necessary to take the changing thickness of the absorber at \(\eta\)=0.8 into account.

The ramp computation procedure is described in more detail in section 4.3.

### The \(F_{dac\rightarrow\mu\rm A}\) Factor

This factor is determined by the calibration board specificities (see Section 2.1) and the injection resistor on the motherboard.

\[F_{DAC\rightarrow\mu\rm A}(\mu A/DAC)=\frac{76.295\mu V}{R_{inj}}, \tag{9}\]

where \(R_{inj}\) is the injection resistor.

### The \(\mu A\) to \(MeV\) Translation Factors

The factor \(F_{\mu\rm A\rightarrow\rm MeV}\) converts the current (\(\mu A\)) into energy (\(MeV\)). It is different for the accordion and presampler parts of the calorimeter.

#### 3.6.1 Accordion

For the accordion calorimeter, which is a sampling calorimeter, \(F_{\mu\rm A\rightarrow\rm MeV}\) can be estimated using the following formula:

\[F_{\mu\rm A\rightarrow\rm MeV}_{acc}(MeV/\mu A)=\frac{1}{I/E\times f_{sampl}}, \tag{10}\]

where:

* \(I/E\) is the energy to current conversion factor given by 12: Footnote 12: In this prediction of \(I/E\), the following effect is being neglected: the ratio between the high voltage capacitance between the Cu layer of the electrodes and the capacitance in the gap leads to a few % reduction of the signal. \[I/E=\frac{q_{0}}{W_{0}}f_{recomb}(\xi)V_{d}(\xi)\frac{\xi}{U},\] (11) where:
* \(q_{0}=1.6\times 10^{-19}\) C is the electric unit charge.
* \(W_{0}=23.6\) eV is the ionization potential of the LAr.
* \(\xi\) is the electric field.
* \(f_{recomb}(\xi)\) takes into account recombination effects (typically a few % for \(\xi=10~{}\rm{kV\cdot cm^{-1}}\)).
* \(V_{d}(\xi)\) is the drift velocity.
* \(U=2000\) V is the potential difference between the two electrodes. In the straight sections of the accordion calorimeter, we have \(\xi=U/g\) where \(g\) is the gap width (2.12 mm). Defining \(t_{drift}=g/V_{d}\), we can express \(I/E\) in the straight sections as: \[I/E_{straight}=\frac{q_{0}}{W_{0}}f_{recomb}(\xi)\frac{V_{d}(\xi)}{g}=\frac{q_ {0}}{W_{0}}f_{recomb}(\xi)t_{drift}.\] (12)
In the bent parts of the accordion, the electric field behaves differently (the charge collection is different) and the formula \(\xi=U/g\) does not hold anymore. To account for this different charge collection in the ratio \(I/E\), one needs to integrate Eq. 11 for charges deposited in the straight sections and for charges in the accordion folds. The size of the effect on \(I/E\) coming from the different charge collection in the folds is around 7% (see later in the text). The predicted value of \(I/E\) in the straight parts from the simulation (GEANT v4.7) taking into account the electric field effects is [9]: \[I/E^{sim}_{straight}=14.2\ \mbox{nA/MeV}.\] (13) One can extract also \(I/E\) from the data by comparing the measured \(I\) to the value of \(E\) that is predicted by the simulation (including the electric field effects), thus deducing \(I/E\) in the straight parts. From the 2002 testbeam data, one finds [10]: \[I/E^{data}_{straight}=16\ \mbox{nA/MeV}.\] (14) Note that the difference between \(I/E^{sim}_{straight}\) and \(I/E^{data}_{straight}\) is reduced when using the version v4.8 of GEANT 13: the simulation value gets closer to the measured one [11]. Footnote 13: The main improvement of the version v4.8 compared to the version v4.7 of GEANT concerns the multiple scattering effects.
* \(f_{sampl}\) is the sampling fraction for electrons which translates the visible energy deposited in the LAr (\(E^{act}\)) into the total deposited energy (\(E^{tot}\)): \[f_{sampl}=E^{act}/E^{tot}.\] (15) It can be estimated knowing the energy deposited by ionization \(dE/dx\) (deposited by a MIP) and the additional energy \(e/\mu\) deposited by radiation by an electron : \[f_{sampl}=\frac{e}{\mu}\times\frac{dE/dx|_{act}}{dE/dx|_{act}+dE/dx|_{gas}}.\] (16) The additional effect of the electric field in the folds is taken into account by computing the visible energy from the simulated current \(I_{sim}\) using \(I/E_{straight}\): \[E^{act}=I_{sim}/(I/E_{straight}),\] (17) which leads to a value of \(f_{sampl}\) 7% lower than with Eq. 16: \[f_{sampl} = 0.1667\ \ \mbox{for}\ \eta<0.8\] \[= 0.1959\ \ \mbox{for}\ \eta>0.8\] The sampling fraction depends on the shower depth. This depth dependence is taken into account at the cluster level.

#### 3.6.2 Pre-Sampler

The PS is not a sampling calorimeter, thus in the expression of \(F_{\mu\mbox{A}\rightarrow\mbox{MeV}}\) given in Eq. 10, one replaces \(f_{sampl}\) by a PS-specific factor \(F_{PS}\) that will be described in the following:

\[F_{\mu\mbox{A}\rightarrow\mbox{MeV}}_{PS}=\frac{1}{I/\times F_{PS}}. \tag{18}\]

Since there is no bending in the PS, the PS \(I/E\) factor does not suffer from any electric field effect as in the accordion. Oppositely to the accordion, the gap width varies along \(\eta\) between 1.9 and 2.0 mm, introducing an \(\eta\) dependence in \(I/E\) and a higher value for \(I/P_{PS}\) than \(I/E_{acc}\). Though, for simplification, only one value is used for \(I/E\) for the whole PS, averaging over the gap widths.

The active layer of the PS physically measures 13 mm, but only 11 mm are exposed to the electric field. The present G4 simulation does not take this effect into account: a factor 11/13 has to be applied to the predicted \(I/E\). The simulation shall be soon modified in order to fix this problem.

The \(I/E\) value for the PS can be deduced from the accordion by multiplying by the ratio of the gap width:

\[I/E_{PS}^{comp}=I/E_{acc}\times\frac{g_{acc}}{g_{PS}}=16\times\frac{2.12}{1.95} =17.4\mbox{ nA/MeV}. \tag{19}\]

The value extracted from the data is identical to the one of the accordion (16 nA/MeV), not showing this difference due to gap width. Though, as it is obtained using the simulation with the active layer length problem, it must be reduced by 11/13.

The computed value \(I/E_{PS}^{comp}\) shall be used in the following (since it derives from "first principles" and since the value extracted from the data does not show the gap width dependency).

The current value of the \(F_{PS}\) factor is 0.05, which allows to roughly go from the visible energy deposited in the PS into the total energy deposited in the PS and upstream. Of course, the upstream energy losses due to dead material are complicated to evaluate, and a detailed correction of this effect is done at the cluster level (the longitudinal weights). But this 0.05 factor allows to obtain already at the cell level a decent energy scale for electrons with an energy greater than 25 GeV.

#### 3.6.3 Numerical Values for \(F_{\mu\mbox{A}\rightarrow\mbox{MeV}}\)

Table 4 summarizes the numerical values of the factors described above leading to the final values of \(F_{\mu\mbox{A}\rightarrow\mbox{MeV}}\) used for the 2004 testbeam.

### Cross-Talk

The readout signal of the calorimeter cells is affected by mostly capacitive cross-talk. Detailed measurements have been performed during previous beam tests [12, 13] and a cross-talk map (see figure 14) has been produced. The biggest cross-talk (about 7%) can be observed between neighbouring strip cells.

The cross-talk has two major effects on the readout signal: first, a fraction of the energy of a cell is spread out to its neighbors and second, the pulse shape is distorted. Since neighboringcells will be contained in the same cluster the loss of signal to the neighbors does not change the cluster energy significantly. But the situation for calibration runs is different: every cell is pulsed individually and independently from its neighbors, so signal gets lost to the neighbors and the reconstructed calibration pulse peak is lower. The reconstructed ramp coefficients are therefore higher by this fraction (they compensate the cross talk induced loss of signal). This effect is relevant in the strips and has to be corrected but no correction is available yet.

## 4 Computation of Calibration Constants

### Pedestal, Autocorrelation Matrix and Noise

Dedicated runs without beam or injected charge are used to monitor the noise level as well as measuring the pedestal and autocorrelation matrix needed for the energy reconstruction. Alternatively during _physics_ runs, random triggers can be used to obtain the same

\begin{table}
\begin{tabular}{|l|c|c|c|} \hline Compartment & \(I/E\) & \(f_{sampl}\) & \(F_{\mu\mathrm{A}\rightarrow\mathrm{MeV}}=1/(I/E\times f_{sampl})\) \\  & (\(\mu A/MeV\)) & (or \(F_{PS}\)) & (\(MeV/\mu A\)) \\ \hline Accordin \(\eta<0.8\) & 0.016 & 0.1667 & 375 \\ Accordin \(\eta>0.8\) & 0.016 & 0.1959 & 320 \\ PS \(\eta<0.8\) & 0.0174 & 0.05 & 1149 \\ PS \(\eta>0.8\) & 0.0174 & 0.05 & 1149 \\ \hline \end{tabular}
\end{table}
Table 4: Values of \(I/E\) and \(f_{sampl}\) (or \(F_{PS}\) for the PS) and \(F_{\mu\mathrm{A}\rightarrow\mathrm{MeV}}\).

Figure 14: Cross-talk measured in module M13 [12][13]

information.

#### 4.1.1 Pedestal

The pedestal is computed for each cell and shaper gain by an average over a given number of periodic triggers (typically 1000 during the 2004 CTB) and over the number of samples (typically 7) leading to an uncertainty of \(\simeq\sigma/84\ ADC\) counts. This assumes that the pedestal is independent from the FEB SCA pipeline cell, where the analog signal is stored before digitization [14], and that the individual time samples are not correlated14. The pedestal distribution for one channel is not exactly Gaussian as shown in Figure 15: some peaks are present for multiples of 64. This might be due to a charge loss in the ADC lower stage (\(0\to 63\)) creating a shift downward, thus populating more the lower bits. As it is only due to a slight shift, the effect on the physics is believed to be negligible.

Footnote 14: This assumption is of course not true (see later in the text), but good enough for the above error estimation.

The pedestals stored in the databases were measured every 8 hours with dedicated runs. In addition and when available, pedestals from random triggers taken during physics runs were added. As described in section 5.1.2, these last entries were added to cope with the FEB temperature instability.

#### 4.1.2 Autocorrelation Matrix

The autocorrelation matrix \(V_{ij}\) is an essential input to the OF coefficients computation. The matrix is computed from the product of the pedestal in each of the samples from the following formula:

\[V_{ij}=\left\langle s_{i}*s_{j}\right\rangle,\]

where \(s_{i}\) is the pedestal subtracted ADC count in sample \(i\) and \(\left\langle\right\rangle\) stands for the mean value over the total number of events. The matrix obtained is symmetrical and time translation invariant. Thus only a \(\sigma=\left\langle s_{i}*s_{j}\right\rangle\) normalized row of \(n_{samples}-1\) is saved in the database. The autocorrelation values are shown for one cell of each layer in Figure 16.

Figure 15: Pedestal distribution for one channel over 6 samples and 2000 events, HIGH gain run 4462. A spike, probably due to the charge loss in the ADC lower stage, can be clearly seen around 1024. There is no tail in this distribution.

Figure 16: Autocorrelation for one channel of FEBs of different layers, HIGH gain run 4462 with 6 samples and 2000 events. The first bin is the pedestal RMS squared and the others are determined mainly by the shaper transfer function. In this example, only the last 5 quantities square roots normalized by the pedestal RMS would be saved in the database.

#### 4.1.3 Noise

The total noise level (\(\sigma\)) is computed from the RMS of the pedestal. Figure 17 shows typical values of the RMS for each of the 4 layers at low \(\eta\).

This noise level includes both channels, coherent and incoherent noise. In order to study the contribution of both, coherent and incoherent noise, we used the alternate-sum method on the 128 channels of a FEB:

\[\sigma_{SUM}=\sigma\left(\sum_{channel=1}^{128}s_{channel}\right), \tag{20}\]

and

\[\sigma_{ALT}=\sigma\left(\sum_{channel=1}^{128}(-1)^{channel}s_{channel} \right). \tag{21}\]

Thus, there is one entry per event and per sample. These sums are shown on Figure 18.

Assuming the sign of the coherent noise is the same in all channels, in \(\sigma_{ALT}\), the coherent noise will cancel, leaving only the incoherent noise contribution. While, in \(\sigma_{SUM}\) both contributions will add up. We then estimated the coherent and incoherent noise contributions as:

\[\sigma_{COH}=\frac{\sqrt{\sigma_{SUM}^{2}-\sigma_{ALT}^{2}}}{128}, \tag{22}\]

and

\[\sigma_{UNC}=\frac{\sigma_{ALT}}{128}. \tag{23}\]

Figure 17: Typical pedestal RMS distributions for low \(\eta\) FEBs, HIGH gain run 5079. See appendices A.2 and A.3 for the RMS of all channels. The preamplifier of channel 69 of Front3 being dead, only the quantization noise of the ADC is measured.

Of course if the above assumption is wrong, then \(\sigma_{SUM}-\sigma_{ALT}\) can be negative. In this case we swapped the role of \(\sigma_{ALT}\) and \(\sigma_{SUM}\) using the complementary assumption. Hopefully, this was only the case for rather small coherent noise (see figure 18). But a deeper analysis following channel patterns or with a full \(128\times 128\) correlation matrix would be needed.

The coherent noise was especially high in the presampler FEB. Triggering on the noise spikes with a 27 samples run, we see a 2.5 MHz noise wave as shown on figure 19. The source of this noise was never identified. But trying to suppress this noise, we found a 20 kHz noise induced by the tower builder board on FT1 (old version of this board) and a 500 kHz noise created by the Tiles low voltage cooling system. The compressor outlet was removed from the calorimeters table plug and the 500 kHz spikes disappeared but the tower builder board was in use so we could not turn it off.

Figure 18: Normal (Eq. 20) and alternate (Eq. 21) sums distributions for low \(\eta\) FEBs configuration (HIGH gain, run 3193).

### Delay Waves

#### 4.2.1 Principle of Computation

Each cell is pulsed \(N\) times (typically \(N=100\)) with a given input current (\(DAC\) value) at a given time _delay_ between the calibration pulser and the data acquisition system. For each trigger, the \(ADC\) value of each of the \(N_{\rm samples}\) samples is read, the mean and RMS of these \(ADC\) values over the \(N\) triggers for each sample are computed. The delay is sequentially increased in steps until the sampling period 15 is covered. The averaged samples are arranged in time according to the delay value, eventually one obtains an averaged profile of the response of the cell to the input \(DAC\). The readout pedestal is finally subtracted to restore the proper baseline.

Footnote 15: The time interval between two consecutive samples, corresponding to the LHC bunch-crossing period of 24.95 ns.

Let \(N_{\rm delay}\) being the number of delay steps in a sampling period \(T_{\rm samp}\), the time pitch between two consecutive points in a delay wave is \(T_{\rm samp}/N_{\rm delay}\), the total number of points in a delay profile is \(N_{\rm delay}\times\)\(N_{\rm samples}\). During the testbeam, the delay step was set to \(\Delta t=\)1.04 ns, corresponding to 10 TTCrx steps of 100 ps. The maximum number of registrable samples is 27 (32) at the testbeam (ATLAS) 16, thus the delay waves are 648 (800) points long.

Footnote 16: At the time of the CTB, the code running in the DSP processors of the ROD were not yet able to deal with more than 27 samples, this number being limited by the size of the output FIFO of the ROD.

For a given cell, delay waves are acquired at different \(DAC\) values, chosen accordingly to the gain of the readout in order not to saturate it. They are used to study in details the linearity of the electronics, to compute the Master Waveforms [15] and to complete the ramps computation using the pseudo optimal filtering technique (see Section 4.3.3). Delay waves at very low \(DAC\) value and at \(DAC=0\) are also acquired to study in details the

Figure 19: Noise shape for low \(\eta\) FEB, HIGH gain run 3260 with 27 samples. These plots are obtained summing all channels of a FEB and then looking for the lowest sample \(i_{min}\). All samples are then shifted by \(i_{min}\) before filling the histogram, thus reproducing a 40.08 MHz sampling oscilloscope. The central part is the mean noise level convoluted with the shaper transfer function. A 2.5 MHz frequency noise can be clearly seen on the PS.

possible effects of the parasitic injected charge on the calibration board. Examples of delay waves acquired at the CTB are shown in Figure 20.

The delay pulse reconstruction is implemented in LArCalibUtils/LArCaliWaveBuilder.

### Ramps

#### 4.3.1 Principle of Computation

Each cell is pulsed \(N\) times (typically \(N=100\)) with a set of given input currents (\(DAC\) values, typically 16 values from 0 to 1500(0) depending on the gain of the readout 17). The delay of the calibration system is kept equal to 0. For each trigger, the \(ADC\) value of each of the \(N_{\text{samples}}\) samples is read. One then computes the mean and RMS of these \(ADC\) values over the \(N\) triggers for each sample. One thus obtains an averaged calibration wave for each \(DAC\).

Footnote 17: During the testbeam, only the HIGH and MEDIUM gains were treated, given than the testbeam energies would never trigger the LOW gain.

The wave corresponding to \(DAC=0\) is subtracted to all the other waves, in order to remove possible effects for parasitic injection charge 18. Finally, the peak ADC value, \(ADC_{\text{peak}}\), is computed on each wave with one of the two methods described in the next sections (depending on what other calibration constants are already available at the time of the analysis 19).

Footnote 18: The parasitic injection charge used to yield effects up to 10 \(ADC\) counts with prototype calibration boards, but is now down to 1 \(ADC\) count with the final version of the calibration board used at the testbeam (see Section 2).

Footnote 19: Indeed, the pseudo optimal filtering method needs the delay waves as input which were not yet available at the beginning of the combined testbeam.

Figure 20: Example of delay profiles corresponding to different injected DAC values, as acquired in High Gain from Middle cell \(\eta_{\text{ cell}}=30\), \(\phi_{\text{ cell}}=2\). DAC values span from 0 to 1500.

One then obtains the \(ADC_{\mbox{peak}}\) versus \(DAC\) curves, examples of which are shown Fig. 21, from which the ramps will be extracted. In this figure, one observes a saturation plateau for \(ADC_{\mbox{peak}}\) corresponding to the maximum 12-bits \(ADC\) value (4096) minus the pedestal value (around 1000), yielding saturation values of around 3000 \(ADC\) counts. Only values below the saturation plateau are used to extract the ramps. One can also observe on these plots a few dead channels (\(ADC\) values remains around 0 for every \(DAC\) value) and mis-behaving channels (which curve does not resemble those of the bulk of the data).

A parabolic interpolation on the non-saturating points is then used to extract the \(ADC_{\mbox{peak}}\) to \(DAC\) relation:

\[DAC=R_{0}+R_{1}ADC_{\mbox{peak}}+R_{2}ADC_{\mbox{peak}}^{2}. \tag{24}\]

The parameters \(R_{0}\), \(R_{1}\) and \(R_{2}\) are the ramp coefficients. They are shown for a low \(\eta\) cabling high-gain run on Fig. 22, 23 and 24. The middle layer feedthrough 0 was equipped with FEBs that had different components than for feedthrough 1 (see Section 1.3), which explains the

Figure 21: \(ADC_{\mbox{peak}}\) versus \(DAC\) curves obtained in a high gain ramp run for the 4 layers of the module (low \(\eta\) cabling). Because of the shortage of FEBs MID2 and MID3 FEBs were used for MID0 and MID1 cells; this explains the two slopes observed in the distribution for the Middle layer as the preamplifiers have different gains.

difference in the values for the ramp coefficients \(R_{1}\). Note also that the coefficients \(R_{1}\) of the back layer raise with \(\eta\) because the length of back cells (and thus the capacitance) gets bigger. Finally, the \(2^{nd}\) order coefficients \(R_{2}\) are of the order of \(10^{-6}\).

#### 4.3.2 Obtaining \(\boldsymbol{ADC_{\mbox{peak}}}\): Parabolic Interpolation

At the beginning of data taking, when no other calibration constants were available apart from pedestals, we had to calculate the maximum of the calibration curve, \(\boldsymbol{ADC_{\mbox{peak}}}\), by using a parabolic interpolation on the 3 samples at the maximum of the curve.

Because the calibration curve does not have exactly a parabolic shape at the maximum, this interpolation yields a biased peak time and \(\boldsymbol{ADC_{\mbox{peak}}}\). The biases depend on the time at which the maximum is sampled. One can obtain the values of these biases (and thus correct for them) by performing a parabolic interpolation on a calibration wave and comparing the results to the true maximum time and \(\boldsymbol{ADC}\) values. This was done during the 2002 testbeam [16] and the results are shown on Fig. 25. The left plot shows the computed

Figure 22: Ramp coefficient \(R_{0}\) as a function of the \(\eta\) index for each of the 4 module layer in a high gain run. Note the factor 10 in the presampler coefficient scale.

Figure 23: Ramp coefficient \(R_{1}\) as a function of the \(\eta\) index for each of the 4 module layer in a high gain run. Note the factor 10 in the presampler coefficient scale.

[MISSING_PAGE_EMPTY:38]

maximum time versus the true maximum time: one observes that the computed time is lower than the true one by up to 5 ns. The computed time is corrected using a look-up table containing the values of the biases 20. One then applies a correction (as a %, shown on the right plot) on the computed \(ADC_{\mbox{peak}}\) as a function of the corrected time. This correction is up to 15% for the back layer and less than 10% for the other layers.

Footnote 20: The look-up tables for the time and \(ADC\) corrections are respectively in **LArCalibUtilis/parabola_Shape.dat** and **LArCalibUtils/parabola_adccor.dat**. They have been obtained for one middle cell using single modules data; the values used here have been copied from EMTB software.

Note that these corrections do not completely remove the bias as they are computed per layer, and not per cells, thus not taking into account cell to cell differences in the calibration shapes.

Technically speaking, the parabolic interpolation described in this section is performed in the tool LArRecUtils/LArParabolaPeakRecoTool.

#### 4.3.3 Obtaining \(ADC_{\mbox{peak}}\): Pseudo Optimal Filtering Coefficients

The method to obtain an unbiased \(ADC_{\mbox{peak}}\) from the samples is to use optimal filtering coefficients 3.2.1 computed from the calibration wave (so called "calibration" OFCs). For historical reasons mainly, we used instead the "pseudo OFCs" for which the autocorrelation matrix is neglected (the effect of this latter being indeed small). It consists of using directly the calibration wave points as OF coefficients. To do this, one needs to adjust the normalization of the wave to the samples by minimizing the following quantity:

\[\chi^{2}=\sum_{i=0}^{N_{\mbox{\scriptsize samples}}}\left(y_{i}^{2}-\frac{( \sum y_{i}g_{i})^{2}}{\sum g_{i}^{2}}\right), \tag{25}\]

Figure 25: Left: time of the maximum obtained from the parabolic interpolation (\(y\)-axis) versus the true maximum time (\(x\)-axis) for each layer of the module. The computed time is lower by up to 5 ns than the true time. Right: correction (in %) to apply on the computed \(ADC_{\mbox{peak}}\) as a function of the corrected time for each layer of the module.

where \(y_{i}\) are the samples of the ramp shape and \(g_{i}\) the samples of the delay shape at a given delay. The \(\chi^{2}\) is minimized over the 24 delays (by step of 1.04 ns).

The value \(ADC_{\mbox{peak}}\) is thus given by the following formula where \(ibest\) correspond to the best \(\chi^{2}\) point and \(g_{max}\) to the maximum of the calibration shape:

\[ADC_{\mbox{peak}}=\frac{\sum y_{ibest}g_{ibest}}{\sum g_{ibest}^{2}}g_{max}. \tag{26}\]

If this method has the advantage to only necessitate delay waves and not OFC computation, it is nevertheless memory-consuming (as delay waves are large objects) and more CPU-consuming than using OFCs (because of the minimization described above). Therefore, one should rather use calibration OFCs.

The pseudo-OF method was used to obtain the final version of the ramp coefficients.

Technically speaking, the pseudo-OFC computation described in this section is performed in the tool LArRecUtils/LArShapePeakRecTool.

### Optimal Filtering Coefficients

#### 4.4.1 Principles of computation

Optimal Filtering coefficients (OFC) are computed through a Lagrange multiplier technique by minimizing the noise contribution (see Section 3.2.1 and [6] for details). In order to perform this computation, the knowledge of the normalized shape of the ionization signal \(g_{\rm phys}\), its derivative \(g^{\prime}_{\rm phys}\) and the noise autocorrelation matrix \(V_{ij}\) is required for each cell.

The noise autocorrelation matrix \(V_{ij}\) has dimension \(N_{\rm samples}\times N_{\rm samples}\), and is obtained as described in Section 4.1.2. The ionization signal \(g_{\rm phys}\) is predicted for each cell from the corresponding normalized calibration pulse according to the model described in Section 4.4.2. The ionization pulse derivative \(g^{\prime}_{\rm phys}\) is numerically computed from the predicted \(g_{\rm phys}\) using a 7 points Savitsky-Golay smoothing filtering of order 3 [17], implemented in LArRawConditions/LArWaveHelper.

Since the calibration pulse is known on a grid of \(N_{\rm delay}\times N_{\rm samples}\) points spaced by \(\Delta t\) (see Section 4.2), the predicted ionization pulse \(g_{\rm phys}\) and its derivative \(g^{\prime}_{\rm phys}\) replicate this structure (Figure 26). When completing the OFC computation, \(N_{\rm phases}\) sets \(\left\{G\right\}_{k}\) (\(\left\{G^{\prime}\right\}_{k}\)) of \(N_{\rm samples}\) points inter-spaced by a sampling period \(T_{\rm samp}\) are chosen from the \(\Delta t\)-spaced \(g_{\rm phys}\) (\(g^{\prime}_{\rm phys}\)):

\[G^{(^{\prime})}(i)_{k}=g^{(^{\prime})}_{\rm phys}\left(i\times\frac{T_{\rm samp }}{\Delta t}+k\right)\quad i=0,\ldots,N_{\rm samples}\quad k=0,\ldots,N_{\rm phases}, \tag{27}\]

in order to match the dimension and time spacing of the autocorrelation matrix \(V_{ij}\) and of the sampling points \(s_{i}\) to which the OFC are to be applied (see Section 3.2.1). \(N_{\rm phases}\) sets of OFC \(\left\{a\right\}_{k}\) and \(\left\{b\right\}_{k}\) are computed, in order to cover a \(N_{\rm phases}\times\Delta t\) interval of possible arrival time of the asynchronous particles. The right set of OFC is selected using the value of the TDC, as discussed in Section 3.2.1. The OFC computation is implemented in LArCalibUtils/LArOFCAlg.

#### 4.4.2 Detector Model and Ionization Signal Prediction

In the frequency region corresponding to the readout electronics bandwidth, each LAr calorimeter readout cell can be described with a simple lumped model based on a few electrical components [18]. The simplest model for a detector cell is shown in Figure 28: the LAr gap is described as a capacitor \(C\) between the absorber (ground reference) and the readout electrode, \(L\) is the total inductance of the readout path on the electrode, including signals summing board (SB) and the signals collection board (Mother Board, MB) inductive contributions. The connection between the detector cell and the readout line has a small resistive component that is modeled by a lumped resistor \(r\).

The ionization current has a ionization-chamber triangular shape with a rise time of the order of 1 ns followed by a linear decay for the duration of the maximum drift time \(T_{\rm d}\):

\[I_{\rm inj}^{\rm phys}(t)=I_{0}^{\rm phys}g^{\rm phys}(t)=I_{0}^{\rm phys} \left(1-\frac{t}{T_{\rm d}}\right)\theta(t)\ \theta(T_{\rm d}-t), \tag{28}\]

where \(I_{0}^{\rm phys}\) is the value of the current extrapolated to \(t=0\). In the lumped model this signal is generated between the two capacitor plates

The calibration signal has an exponential shape with decay time \(\tau_{\rm cali}\sim 450\) ns (measured on CALIB03; _cf_ Fig 8, which has been chosen to mimic the ionization signal decay slope. This signal is generated by the calibration boards (CB) whose pulser is based on an \(RL\)-circuit; the resistive component of the inductance in this circuit alters the exponential waveform:

\[I_{\rm inj}^{\rm cali}(t)=I_{0}^{\rm cali}g^{\rm cali}(t)=I_{0}^{\rm cali} \left[\left(1-f_{\rm step}\right)e^{-\frac{t}{\tau_{\rm cali}}}+f_{\rm step} \right], \tag{29}\]

where \(f_{\rm step}\in[0,1]\sim 0.07\) measures the residual baseline as the fraction of the pulse amplitude; it is due to the resistive component of the calibration inductance. In the lumped model this signal is injected on the MB, thus between the effective inductance \(L\) and the readout cables.

The normalization of the ionization signal used to compute the OFC must be such that the amplitude of the injected current is the same as for the corresponding calibration pulse used to compute the gain of the readout channel, thus correcting for the distortion introduced by the different injection point on the detector. The normalized ionization signal is then expressed as a function of the calibration signal, factorizing the effect of the (common)

Figure 26: Example of calibration signal and corresponding predicted ionization signal for a Middle cell at \(\eta_{\rm\ cell}=20\), \(\phi_{\rm\ cell}=8\), Medium gain (left: full 27–samples pulses; right: detail of peaks’ region.

Figure 27: Example of OF coefficients \(a_{i}\) and \(b_{i}\) as function of \(t_{\rm bin}^{\rm OFC}\), as computed from the predicted ionization of Middle cell at \(\eta_{\rm\ cell}=20\), \(\phi_{\rm\ cell}=8\), Medium gain, using the RTM parameters.

readout lines and electronics transfer functions \(H^{\rm readout}\), by means of two different time-domain convolutions:

\[g^{\rm phys}(t) = g^{\rm cali}(t)*\underbrace{{\cal L}^{-1}\left\{\frac{I_{\rm inj}^ {\rm phys}(s)}{I_{\rm inj}^{\rm cali}(s)}\right\}}_{g^{\rm exp\ \to\ tri}(t)}*\underbrace{{\cal L}^{-1}\left\{\frac{1}{1+s\tau_{r}+s^{2}\tau_{ 0}^{2}}\right\}}_{g^{\rm MB}\ \to\ \det}\ast\delta(t-\tau_{\rm diff}), \tag{30}\] \[g^{\rm exp\ \to\ tri}(t) = \delta(t)+\left[\frac{1-f_{\rm step}}{\tau_{\rm cali}}e^{-f_{\rm step }\frac{t}{\tau_{\rm cali}}}-\frac{1-f_{\rm step}}{f_{\rm step}}\left(e^{-f_{ \rm step}\frac{t}{\tau_{\rm cali}}}-1\right)\right]\theta(t),\] (31) \[+\frac{1-f_{\rm step}}{f_{\rm step}}\left(e^{-f_{\rm step} \frac{t-T_{0}}{\tau_{\rm cali}}}-1\right)\theta(t-T_{\rm d}),\] \[g^{\rm MB\ \to\ \det}(t) = \frac{2}{\tau_{a}}e^{-\frac{\tau_{\rm r}}{2\tau_{0}^{2}}t}\sin \left(\frac{\tau_{a}}{2\tau_{0}^{2}}t\right)\theta(t), \tag{32}\]

where \(\tau_{\rm r}=rC\) and \(\tau_{0}=\sqrt{LC}\). The time shift introduced by \(\delta(t-\tau_{\rm diff})\) is supposed to take into account the time difference \(\tau_{\rm diff}\) between the ionization and the calibration pulse introduced by the calibration cables.

#### 4.4.3 The \(\frac{M^{\rm phys}}{M^{\rm cali}}\) factor

As a result of imposing that \(I_{0}^{\rm phys}=I_{0}^{\rm cali}\), the peak amplitudes of \(g^{\rm phys}\) and \(g^{\rm cali}\) differ (see Figure 26), mainly because of the presence of the inductance \(L\) between the injection points of the two currents. Equation (30) naturally includes this effect, and allows to directly incorporate this correction in the OFC computation by using a \(g^{\rm phys}(t)\) shape as obtained when \(\max(g^{\rm cali}(t))\ =\ 1\). In this case, the electronics gain evaluated with the calibration pulses can be directly applied to the ionization signals.

An alternative approach consists in normalizing to unity the ionization pulses \(g^{\rm phys}(t)\) predicted with equation (30) before computing the OFC. In this case, the reconstructed signal peak must be corrected by the \(\frac{M^{\rm phys}}{M^{\rm cali}}\) factor (where \(M^{\rm phys}=\max(g^{\rm phys}(t))\) and \(M^{\rm cali}=\max(g^{\rm cali}(t))\)) before applying the electronic gain computed with the ramps. The potential advantage of this second approach is that the correction for the different injection points can be taken into account even when the signal peak is evaluated by other means than the OF, e.g. as the peak of a polynomial interpolation of the signal samples.

The correction for the \(\frac{M^{\rm phys}}{M^{\rm cali}}\), either directly embedded in the OFC or applied later in the reconstruction chain, is essential if a proper equalization of the cell responses is to be achieved, since the electrical properties of the readout cells vary consistently along the detector extension. This is especially true for the Middle layer, where the \(\frac{M^{\rm phys}}{M^{\rm cali}}\) factor may differ up to \(\sim\)10% (Figure 29).

Figure 28: Basic equivalent circuit of the LAr detector readout cell.

#### 4.4.4 Parameter Evaluation Methods

In order to complete the computation of (30), the knowledge of the parameter set

\[\left\{\tau_{\rm cali},\ f_{\rm step},\ \tau_{0}=\sqrt{LC},\ \tau_{\rm r}=rC,\ T_{ \rm d}\right\} \tag{33}\]

is required. Table 5 lists typical values of these parameters for the ATLAS EM Barrel.

In the last years, different approaches to obtain the parameters in (33) have been developed and are described in the following.

**Analysis of cumulated ionization pulses (a.k.a. semi-predictive method)**

This technique relies on the knowledge of the ionization pulse shape, as it can be obtained by averaging the signal induced in the endcap by electrons above a given energy threshold, impacting the detector at different time with respect to the sampling clock [19]. Being known the ionization pulse \(g^{\rm phys}(t)_{\rm data}\) from data, a fit is performed with respect to the of the parameters in (33), using a function \(g^{\rm phys}(t)_{\rm pred}\) computed as in (30) with an additional normalization factor \(\frac{M^{\rm phys}}{M^{\rm can}}\) (the fitting function is computed using time-domain convolutions, thus the method name Time Convolutions Method, TCM). In order to assure the convergence of the TCM fit, only \(\tau_{0}\), \(\tau_{\rm r}\) and \(\tau_{phys}\), the time shift between the physics and the calibration curves, are actually used as independent variables, while the other entering the fit are fixed to their nominal values. \(\frac{M^{\rm phys}}{M^{\rm can}}\) is computed once the previous parameters have been fit, as the ratio between the amplitude of the predicted physics curve and the calibration curve.

Since at the CTB only the central part of the barrel module was exposed to high energy electron beam, it was possible to obtain an estimate of the ionization pulses from data only for a small fraction of the readout cells. As the OFC are needed for all the module (_e.g_. for reconstruction of large hadronic showers), this approach was not used in the official CTB data reconstruction.

Figure 29: \(\frac{M^{\rm phys}}{M^{\rm can}}\) factor as obtained from the RTM parameters for Middle layer cells, High gain.

The TCM fit is implemented in LArCalorimeter/LArTCMPhysWavePredictor, also including the physics pulse prediction (30).

**Analysis of calibration pulses (a.k.a. fully predictive method).**

This technique computes the parameters \(\tau_{\rm cali}\), \(f_{\rm step}\),\(\tau_{0}\) and \(\tau_{\rm r}\) solely from the information contained in the calibration signal alone. As this technique relies on a detailed analysis of the calibration signal tail, delay runs with the maximum number of samples (\(N_{\rm samples}=27\)) are needed to observe signals for a duration of 675 ns. Several calibration signals obtained by injecting current pulses of different amplitude are combined into a _"master waveform"_[15]: this procedure provides signal shapes that are less sensitive to calibration-board-induced offsets and that can naturally incorporate the linear electronic gain of the channel.

The strategy to retrieve the needed parameters is based on the computation and analysis of what would be the response of the system (detector cell + readout system) to a signal different from the standard "exponential" calibration pulse (Response Transformation Method, RTM): the system response can in fact be sensitive to a particular injected waveform, the output showing in some case easily recognizable characteristics. The following recipes are applied (see [15] for details) to obtain the different parameters:

* \(\tau_{\rm cali}\): exponential fit of the calibration signal tail;
* \(f_{\rm step}\): step response analysis;
* \(\tau_{0}\): cosine response analysis;
* \(\tau_{\rm r}\): minimization of residual oscillation after injection point correction.

The RTM algorithms are implemented in LArCalorimeter/LArRTMPhysWavePredictor, that also includes the physics pulse prediction (30).

The RTM approach is able to predict reliable physics pulses for all the cells pulsed with a calibration signal: for this reason the RTM parameters were used to compute the OFCs used in the official CTB data reconstruction, using the \(T_{\rm d}\) nominal values.

\begin{table}
\begin{tabular}{|c|c|l|} \hline Parameter & Value & Description \\ \hline \(\tau_{\rm cali}\) & \(\approx 350\) ns & calibration pulse decay constant \\ \hline \(f_{\rm step}\) & \(\sim 0.07\) & offset in the injected calibration signal \\ \hline \(C\) & \(1.2\div 2\) nF & channel capacitance (Middle compartment) \\  & \(100\div 200\) nF & channel capacitance (Front compartment) \\  & \(0.2\div 2\) nF & channel capacitance (Back compartment) \\ \hline \(L\) & \(10\div 35\) nH & channel inductance for Middle compartment [21] \\ \hline \(\tau_{0}\) & \(\lesssim 10\) ns & \(=\sqrt{LC}\) \\ \hline \(\tau_{\rm r}\) & \(\lesssim 1\) ns & \(=rC\) \\ \hline \(T_{\rm d}\) & \(\simeq 420/475\) ns & ionization \(e^{-}\) maximum drift time in the LAr gap \\  & & (Presampler/Accordion) \\ \hline \end{tabular}
\end{table}
Table 5: Relevant quantities for a readout channel to be used in the ionization signal prediction, with their typical values for the ATLAS EM calorimeter barrel.

#### Direct measurement

The parameters in (33), apart from \(T_{\rm d}\), are also directly obtained by means of electrical measurements on the calibration boards (\(\tau_{\rm cali}\), \(f_{\rm step}\)) [20] and on the assembled detector at cold (\(\tau_{0}\), \(\tau_{\rm r}\)) [21]. The use of the directly-measured parameters in the physics pulse prediction (30) was not possible at CTB because of software limitation. On the other hand, the comparison between between the measured and RTM-extracted parameters showed an agreement at the % level (Figure 30), well compatible with the precision required by the physics pulse prediction [15].

### Summary of Calibration Constants Values

Table 6 summarizes the numerical values of the factors converting the ADC counts to energy and of the noise for each calorimeter layer.

## 5 Validation Issues

This section aims at summarizing the validation studies performed on the CTB calibration constants, such as stability of constants over time, temperature dependence, non-linearities, etc...

### Stability of Constants over Time

A determining factor of the constants stability at the CTB was the FEBs temperature. These temperatures were unstable for some period of the data taking because of various reasons exposed in Section 1.4. These variations induced instabilities in the pedestal and

Figure 30: \(\omega_{0}=\frac{1}{\tau_{0}}\) as a function of \(\eta_{\rm cell}\) for Middle layer cells, as extracted with the RTM algorithm from Medium gain MWs and directly measured from the detector. The values show a systematic difference of 1%, with a RMS of 3%.

ramp values as will be shown in the following sections. Outside these periods, the constants stability was good.

#### 5.1.1 FEB Temperature Probes

Four temperature probes were available on each FEB, three on the top side and one on the bottom side:

* top side: PCB near the G-link,
* top side: PCB near a +5V Digital regulator,
* top side: DCU near the -3V regulators,
* bottom side: DCU near the -1.7V regulators.

Figure 31 shows the location of the three top side temperature probes.

The temperature was recorded regularly starting from September 29, 2004. A measurement was done around every minute. Figure 32 shows the evolution of the measured temperature on one of the unstable FEB (left) and one of the stable FEB (right).

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|} \hline Layers & PS & Strips & Middle \(\eta<0.8\) & Middle \(\eta>0.8\) & Back \\ \hline \multicolumn{6}{|c|}{ Gain-Independent Quantities} \\ \hline \(R_{inj}\) (\(k\Omega\)) & \(\simeq\)2.000 & 3.022 & 1.015 & 0.508 & 1.015 \\ \hline \(F\!DAC\)\(\rightarrow\)\(\mu\)A (\(\mu A/DAC\)) & 0.002284 & 0.025464 & 0.150127 & 0.0751078 & 0.0751078 \\ \hline \(F_{\mu\mbox{A}}\)\(\rightarrow\)MeV (\(MeV/\mu A\)) & 1149 & 375 & 375 & 320 & 375(320) \\ \hline \hline \multicolumn{6}{|c|}{ High Gain} \\ \hline DAC/ADC & 2.55 &.25 &.35(.55) &.55/(.35) & \(.23\rightarrow.32\) \\ \hline MeV/ADC & & 2.3 & \(\simeq 10\) & & 7 \\ \hline noise(ADC count) & 8 & 8 & 3.4 & 5. & 5. \\ \hline noise(MeV) & & 18 & 35 & & 35 \\ \hline \hline \end{tabular} Medium Gain

\begin{tabular}{|c|c|c|c|c|} \hline DAC/ADC & 25.2 & 2.5 & 3.5 (5.5) & 5.5(3.5) & \(2.3\rightarrow\) 3.2 \\ \hline MeV/ADC & & 2.3 & \(\simeq 10\) & & 7 \\ \hline noise(ADC counts) & 1.3 & 1.3 & 1.1 & 1.1 & 1. \\ \hline noise(MeV) & & 18 & 35 & & 35 \\ \hline \end{tabular}
\end{table}
Table 6: Typical calibration constants values. The first set of rows correspond to gain-independent quantities such as \(R_{inj}\), \(F\!DAC\)\(\rightarrow\)\(\mu\)A and \(F\!_{\mu\mbox{A}}\)\(\rightarrow\)MeV. The second and third sets of rows correspond to gain-Dependant quantities such as DAC/ADC (ramp factor), the final conversion factor MeV/ADC (product of the three precedent factors), and the noises values in ADC counts and MeV.

For the unstable FEB, the probe next to the GLINK shows the largest variations, followed by the probe next to the +5V digital regulator. Though, one does not expect the GLINK temperature to modify the ramp and pedestal constants, but the regulators temperature might.

#### 5.1.2 Pedestal Stability

Figure 33 shows the stability of pedestal as a function of time in 4 FEBs. For the stability of all FEBs, see appendix A.4.

During the first period (before August \(27^{th}\)), the FEBs were turned off after each runs,

Figure 31: Top side of a FEB: the three temperature probes available on this side are located by yellow rectangles.

Figure 32: Temperature measured by the 4 probes on the FEB for an unstable FEB (left) and a stable one (right). The GLINK temperature is the one varying the most, followed from the +5V digital regulator one. The two other probes do not show any significant variations.

and as a consequence the temperature of some FEBs varies a lot from one run to another. There was no FEB temperature measurement for this period, but the effect can clearly be seen on the pedestal variations. In October, some FEBs started to have cooling problems and in this period the correlation between temperature and pedestal variation is obvious.

To correct from these temperature variations, we produced pedestal databases using the random triggers from the physics run. Unfortunately, there was no random triggers starting from the end of October.

#### 5.1.3 Ramp Stability

Figure 34 shows the stability over the full CTB period of the \(1^{rst}\) order ramp coefficient (computed using the pseudo-OF method) as a function of the date for 4 FEBs (low \(\eta\) cabling). The other FEBs plots are located in appendix B.

One can distinguish two different cases:

* stable FEBs (left plot) at the few per mil level. This is the case for the majority of the FEBs.
* unstable FEBs such as the one of FT 0, Slot 5 (right plot). This is due to temperature instabilities on these FEBs. The figures 60 and 61 in the appendix show a zoom on the ramp variations correlated with the FEB temperature measurement starting from the time the temperature was regularly measured (29/09). These figures clearly demonstrate the effect of FEB temperature on the ramp coefficients.

Figure 33: Stability of pedestal (in ADC counts) over time, averaged on the 128 channels of a FEB. The reference runs are 3688, 3693, 3734 and 3738 taken on October 24 and 25, 2004. The blue vertical line indicates a change in the trigger timing. The blue hashed area is a period where there was no data taking. The red hash area were periods with high \(\eta\) cabling.

### Non-Linearities

#### 5.2.1 Integral Non-Linearities Measured on Delay Curves

The integral non-linearity is defined in Eq. 2. The figures 35 and 36 show the values of \(I_{NL}\) computed on the delay curves for the four layers, respectively in gain HIGH and MEDIUM. The \(I_{NL}\) remains below 0.1%, as required and as measured on the calibration test bench (see Section 2.2).

#### 5.2.2 Induced Biases on Ramps

In the ramp pseudo optimal filtering method (_cf_ Sec. 4.3.3), one uses delay waves to reconstruct \(ADC_{\mbox{peak}}\) from the \(N_{\mbox{samples}}\). One has the choice to use a unique \(DAC\) wave for all the ramp \(DAC\) values (called "single \(DAC\)" method), or to use the corresponding \(DAC\) wave for each \(DAC\) ramp value (called "all \(DAC\)" method). For non-zero non-linearities, these two methods can yield different results (where the "all \(DAC\)" method produces unbiased results and the "single DAC" method produces biased ones).

To evaluate the bias induced on the ramps by the non-linearities, the delay waves are sampled every 25 ns (to mimic the ramps) for different delay value (from 1 to 24 ns). One then reconstructs \(ADC_{\mbox{peak}}\) with the two methods described above, computes the ramp coefficients and finally one compares the results of the "single \(DAC\)" method (possibly biased) with the "all \(DAC\)" method (unbiased). This comparison is shown on Fig. 37 for each FEB of the two FT in the low \(\eta\)-cabling as a function of the delay value.

The induced bias remains below 0.1% for the PS and Middle FEBs, below 0.2% for the Front FEBs and is up to 0.4% for the back FEB. The bias remains small enough to ignore it: the "single \(DAC\)" method is performing well enough.

Figure 34: Stability of \(1^{rst}\) order ramp coefficients over time in the low \(\eta\) cabling for the FEBs 5, 9 (left plots), 11 and 12 (right plots) in FT0. The reference runs are 5129, 5130 and 5131 taken on November 14, 2004. The blue vertical line indicates a change in the trigger timing \({}^{22}\). The blue hashed area is a period where there was no data taking. The red hash area were periods with another cabling that the low \(\eta\) one thus not treated on this plot.

Figure 35: Integral non-linearity (in %) measured on the delay curves for the four layers in gain HIGH.

[MISSING_PAGE_EMPTY:52]

Figure 37: Biased induced on the ramps when using the “single \(DAC\)” method compared to the “all \(DAC\)” method for the FEB of FT=0 (up) and FT=1 (down).

[MISSING_PAGE_EMPTY:54]

## Conclusion

From July to November 2004, a full slice of the ATLAS barrel detector was studied in a combined testbeam. From the electromagnetic calorimeter point of view, besides the physics studies that will allow a better understanding of the sub-detectors performances (in particular the performance with an amount of material on the particle's path close to the ATLAS case, the performance for particles with very low energy, photon reconstruction, combined reconstruction with the inner detector and the hadronic calorimeter),the CTB constituted a realistic calibration test-bench. In particular, the computation and monitoring of the calibration constants was performed within ATHENA (which was not the case in previous standalone testbeams). This required many new software developments that will directly be used in ATLAS. The persistification of calibration constants was not using the final ATLAS system (NOVA instead of POOL/COOL), but still, a lot of understanding was gained in the functionalities that the ATLAS-type calorimeter storage should have.

It is worth noting though that the CTB environment - despite the much smaller scale - is in some sense a more difficult one than ATLAS, mainly because of the asynchronous beam and the FEB temperature instabilities. These two points triggered a large amount of work (computation of OFC timings, pedestal computed from random triggers) that should not be needed in ATLAS.

One can conclude, that the calibration performances are at the expected level: the constant stability is better than 0.1% outside the FEB temperature instability periods and the obtained resolution and linearity correspond to the ATLAS requirements.

## Acknowledgments

We are very grateful to all the people who made the 2004 combined testbeam a success. In particular we would like to thank B. Di Girolamo, and the sub detector coordinators. The setting up of the online software was a challenging task and we are very indebted to H. Wilkens, A. Bazan, F. Bellachia and G. Ionescu. The data taking would not have been possible without the deep implication of several LAr run coordinators: B. Lund-Jensen, P. Puzo and Ph. Schwemling. We owe thanks to T. Carli, L. Serin and G. Unal for many fruitful discussions. Last but not least we would like to thank R. McPherson, H. Ma, M. Ridel and C. Bourdarios for all their help on the ATHENA software.

Pedestal and Noise

### Pedestal Mean Values

Figure 38 shows the pedestal mean value per channel for a few FEBs in HIGH gain. Other FEBs behave the same.

Figure 38: Pedestal mean value for each FEB channel in HIGH gain, for the low \(\eta\) cabling.

[MISSING_PAGE_EMPTY:57]

Figure 41: Pedestal rms value for each FEB channel in HIGH gain, for the low \(\eta\) cabling (3/3).

Figure 40: Pedestal rms value for each FEB channel in HIGH gain, for the low \(\eta\) cabling (2/3).

Figure 42: Pedestal rms value for each FEB channel in MEDIUM gain, for the low \(\eta\) cabling (1/3).

Figure 44: Pedestal rms value for each FEB channel in MEDIUM gain, for the low \(\eta\) cabling (3/3).

Figure 43: Pedestal rms value for each FEB channel in MEDIUM gain, for the low \(\eta\) cabling (2/3).

[MISSING_PAGE_EMPTY:61]

Figure 46: Pedestal rms value as a function of \(\eta\) and \(\phi\) in HIGH gain, for the high eta cabling.

Figure 47: Pedestal rms value as a function of \(\eta\) and \(\phi\) in MEDIUM gain, for the low eta cabling.

Figure 48: Pedestal rms value as a function of \(\eta\) and \(\phi\) in MEDIUM gain, for the high eta cabling.

[MISSING_PAGE_EMPTY:65]

Figure 51: Stability of pedestal over time. See caption of Fig. 49 for more details.

Figure 52: Stability of pedestal over time. See caption of Fig. 49 for more details.

Figure 53: Stability of pedestal over time. See caption of Fig. 49 for more details.

Figure 54: Stability of pedestal over time. See caption of Fig. 49 for more details.

Figure 55: Stability of pedestal over time. See caption of Fig. 49 for more details.

[MISSING_PAGE_EMPTY:68]

Figure 58: Stability of \(1^{rst}\) order ramp coefficients over time in the low \(\eta\) cabling for the FEBs 0, 1, 2 and 4 in FT1. See caption of Fig. 56 for more details.

Figure 59: Stability of \(1^{rst}\) order ramp coefficients over time in the low \(\eta\) cabling for the FEBs 5, 9, 11 and 12 in FT1. See caption of Fig. 56 for more details.

[MISSING_PAGE_EMPTY:70]

## Appendix C List of Problems

### Dead HV Channels

The ATLAS electromagnetic calorimeter modules consist of a sandwich of 64 unit cells made up by an absorber, a LAr gap, an electrode (3 layers, two HV layers and one signal layer in the middle), and again a LAr gap. We therefore distinguish the two HV sides of each electrode by denoting them with upper gap and lower gap. Each HV line in a module supplies 4 electrodes in an eta region of \(\Delta\eta=0.2\), but only one LAr gap (out of the two surrounding the electrode) is connected to this HV line. The other gap is connected to another independent HV line. The different regions in \(\eta\) are called sectors, where the \(i^{\rm th}\) sector covers \((i-1)\cdot 0.2<\eta<i\cdot 0.2\). The electrodes are counted from the bottom \((1\ldots 64)\).

We distinguish electrodes that produced shorts during the warm tests after the module stacking, and shorts that appeared at cold only.

* In the first case the concerned electrodes were isolated and connected to a spare HV line, hence leading to the situation that out of 4 electrodes (each two sides), 3 electrodes work completely (full signal), and 1 electrode has HV applied only on one of the two sides (half signal). A correction for this effect can be applied during the energy reconstruction by scaling the measured energy by 8/7. By setting the job option "DoHVCorrection" true, this correction is automatically applied.

Figure 61: Variation of the \(1^{rst}\) order ramp coefficient (left scale) with the FEB temperature (right scale) for each FEB of the low \(\eta\) cabling, FT=1.

* In the second case the short appeared after cool down of the module. A short of one electrode therefore lead to one shorted HV sector (one side of each of the 4 electrodes in the sector shorted). A correction for this effect can be applied during the energy reconstruction by scaling the measured energy in the concerned read-out cell by 2.

A description of the HV corrections and a discussion of the impact of HV problems on the detector performance can be found in [22].

During the data taking period we had the following HV problems:

* Presampler: FT1, sector:5-6, gap 1, (HV Mod 50, channel 05). This short has been burnt off on July 22. After that the sector worked.
* Accordion: FT0, sector:6, upper gap, (HV Mod 49, channel 05)
* Some disconnected electrodes:
* Possible problem on the Presampler: FT1, sector:5-6, unknown gap, (short on the whole sector was burnt off on July 22, either the short circuit was burnt off, or the HV resistor of the HV electrode, needs to be verified with data)
* Accordion: FT0, sector:4, upper gap, electrode:27, (HV Mod 49, channel 07)
* Accordion: FT0, sector:4, lower gap, electrode:27, (HV Mod 49, channel 15)
* Accordion: FT0, sector:7, lower gap, electrodes: 2,4,6, (HV harness 8, not connected)
* Accordion: FT1, sector:4, upper gap, electrode:34, (HV Mod 48, channel 07)
* Accordion: FT1, sector:2, lower gap, electrode:47, (HV Mod 48, channel 15)

### Dead Cells

Table 7 gives the list of dead cells observed in the CTB 2004.

\begin{table}
\begin{tabular}{|c|c|c|c|} \hline Layer & \(\eta\) & \(\phi\) & FT \\ \hline
1 & 110 & 0 & 0 \\ \hline
1 & 197 & 1 & 0 \\ \hline
1 & 206 & 1 & 0 \\ \hline
1 & 110 & 1 & 0 \\ \hline \hline Calibration & line & - & FT \\ \hline  & 25 & - & 1 \\ \hline  & 63 & - & 1 \\ \hline  & 120 & - & 0 \\ \hline \end{tabular}
\end{table}
Table 7: List of dead cells

## References

* [1] B. Di Girolamo et al. Beamline instrumentation in the 2004 combined ATLAS testbeam. _ATLAS Internal Note_, ATL-TECH-PUB-2005-001, 2005.
* [2] R. Lafaye and L. Serin. Private communication.
* [3] J. Colas et al. The LARG Calorimeter Calibration Board. _ATLAS Internal Note_, ATL-LARG-2000-006, 2000.
* [4] B. Cleland et al. Cabling of the ATLAS liquid argon calorimeters. _ATLAS Internal Note_, ATL-AL-ES-0004, 2003.
* [5] The ATLAS collaboration. Liquid Argon Calorimeter Technical Design Report. Technical Report CERN/LHCC/96-41, CERN, 1996.
* [6] W.E. Cleland and E.G. Stern. Signal processing considerations for liquid ionization calorimeter in a high rate environment. _NIM A_, 338, 1984.
* [7]. [https://uimon.cern.ch/twiki/bin/view/Atlas/RawChannelCreation](https://uimon.cern.ch/twiki/bin/view/Atlas/RawChannelCreation).
* [8] G. Graziani. Linearity of the response to test beam electrons for EM Barrel module P13. _ATLAS Internal Note_, ATL-LARG-2004-001, 2004.
* [9] G. Unal. Private communication.
* [10] T. Carli. Linearity of the response to test beam electrons for EM Barrel module P13. _NIM A_, In preparation, 2005.
* [11] T. Carli. Update of Response of Electrons in the ATLAS LAr Barrel Calorimeter. [http://agenda.cern.ch/fullAgenda.php?ida=a06408](http://agenda.cern.ch/fullAgenda.php?ida=a06408).
* [12] F. Hubaut, B. Laforge, D. Lacour, F. Orsini. Test beam Measurement of the Crosstalk in the EM Barrel Module 0. _ATLAS Internal Note_, ATL-LARG-2000-007, 2000.
* [13] F. Hubaut. Crosstalk Measurements in the EM Barrel Module 0 from 99', May 00' and July 00' Beam Tests. _ATLAS Internal Note_, ATL-LARG-2000-009, 2000.
* [14] R. Zitoun. Study of noise in the November 1998 barrel run. _ATLAS Internal Note_, ATL-LARG-99-006, 1999.
* [15] D. Banfi, M. Delmastro and M. Fanti. Cell response equalization of the ATLAS electromagnetic calorimeter without the direct knowledge of the ionization signals. _ATLAS Internal Note_, ATL-LARG-2004-007, 2004.
* [16] D. Zerwas. results included in the EMTB software..
* [17] W. Press, B. Flannery, S. Teukolsky, W. Vetterling, William T. _Numerical Recipes: the art of scientific computing_. Cambridge Univ. Press, 1998.
* [18] M. Citterio, M. Delmastro and M. Fanti. _A study of the electrical properties and of the signal shapes in the ATLAS Liquid ARgon Accordion Calorimeter using a hardware model_. _ATLAS Internal Note_, ATL-LARG-2001-018, 2001.