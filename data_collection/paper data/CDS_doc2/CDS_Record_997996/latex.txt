# ATLAS Logical File Name and Directory Paths convention

**Meris, M.Branco, D.Cameron, S.Campana, A.Klimentov, D.Liko, P.Nevski, T.Wenaus ATL-COM-SOFT-2006-017 December 1st, 2006 revised Feb 12, 2009**

**Logical File Name (LFN)**

The following convention is used to form local files entries in file catalogs for data processed or simulated using ATLAS Production System. ATLAS online files naming convention isn't covered by this document.

**Logical File Name** (LFN) will have 2 parts separated by '_' (dot-underscore) symbols. The first part of LFN corresponds to the DDM dataset name, as it is described in [1]. The first part contains two fields separated by dot, data type (dataset field 6, f.e. 'AOD') and production task unique id used to produce file f.e 022009.), the second part is the file name. In this case the catalog entry looks like :

_datasetType.TaskID_fileName_.

LFN is defined during the first file registration in the catalog.

LFN is not modified if the file is added to more than one dataset.

Data reprocessing and MC production follows this convention, and production LFNs have format :

_AOD.022009_00293.pool.root.1_

### Output Directory Path

Since year 2008 ATLAS uses _LFC_ (Local File Catalog) for all Grid flavours. LFC has a hierarchical namespace with a directory structure. The physical storage at sites also has a hierarchical structure, which means that for this and LFC we need to provide a convention on directory structure for physical and logical file names created by DDM.

On LFC the output directory path is always preceeded by the path _/grid/atlas/dq2_. On storages the output directory path is always preceeded by the path for the storage defined in Tiers of ATLAS.

#### Current Conventions

All files (MC, DAQ, etc) are registered in LFC and stored by DDM system under the directory tree

_/project/datasetType/datasetName/fileName_, where

* name of project (f.e. _csc11, mc12, larg,..._), the first field in dataset name,
* dataset type (f.e. _RDO, AOD, RAW,..._), the 5th field in dataset name,
* DDM dataset name. In the case of a catalog registration following a subscription, the dataset name is the name of the dataset that was subscribed that led to this file being replicated,
* For LFC: the DDM "flat" LFN. For storage: the physical file name of the original source file.

#### Example

If we take the example LFN above _LFN : AOD.022009_00293.pool.root.1_ in the dataset _mc08.007447.singlepart_mupt50.recon.AOD.e315_s422_r408_tid022009_ the output directory path becomes

_/mc08/AOD/mc08.007447.singlepart_mupt50.recon.AOD.e315_s422_r408_tid022009/ AOD.022009_00293.pool.root.1_

### Datasets outside convention

Any dataset with 5 or more dots in the name is assumed to follow the convention described above, where _project_ is the first field and _dataset type_ is the fifth field.

Datasets with between 1 and 4 dots inclusive will have the following output directory path:

_/project/datasetName/filename_

where these terms have the same meaning as above.

Datasets with no dots will have the following output directory path:

_/other/datasetname/filename_

where these terms have the same meaning as above.

#### Examples

A file with the physical and logical name _joetesffile.1_ in a dataset named _user.joeuser.dataset1_ has the output directory path_/user/user.joeuser.datasettest1/joetesffile.1_

A file with the physical and logical name _file1_ in a dataset named _mydataset1_ has the output directory path

_/other/mydataset1/file1_

## Proposed Conventions

### Increasing granularity for Tape Families

In order to increase the granularity for tape families at some sites, it has been proposed to extend the current convention to include an extra level of hierarchy in the directory structure. The proposal is to modify the current convention above and register in LFC and store via DDM system under the following directory tree:

_/project/datasetType/physicStream/datasetName/fileName_, where

* name of project (f.e. _csc11, mc12, larg,..._), the first field in dataset name,
* dataset type (f.e. _RDO, AOD, RAW,..._), the 5th field in dataset name,
* the physics stream (f.e. _physics_IDCosmic, calibration_LArCells..._), the 3rd field in dataset name,
* DDM dataset name. In the case of a catalog registration following a subscription, the dataset name is the name of the dataset that was subscribed that led to this file being replicated,
* For LFC: the DDM "flat" LFN. For storage: the physical file name of the original source file.

_concerns : it may be useful for ATLAS RAW data staging from tape, if it will be implemented by the majority of Tier-1s. For the moment only one Tier-1 is willing to implement such tape family. At the same time, the second field of MC dataset name is the longest field, there are up to 100 characters, and using it as directory and LFC path will increase complexity of using any CLI commands._

### Increasing granularity

In order to increase the granularity and to reduce number of subdirectories associated with project and data type (now we have up to 5000 subdirectories), it has been proposed to extend the current convention to include an extra level of hierarchy in the directory structure. The proposal is to modify the current convention above and register in LFC and store via DDM system under the following directory tree:

_/project/datasetType/DSN/RunNumber/datasetName/fileName_, where

* name of project (f.e. _cc11, mc12, larg,..._), the first field in dataset name,
* dataset type (f.e. _RDO, AOD, RAW,..._), the 5th field in dataset name,
* dataset number or run number (f.e. _007447_, the 2nd field in dataset name,
* DDM dataset name. In the case of a catalog registration following a subscription, the dataset name is the name of the dataset that was subscribed that led to this file being replicated,
* For LFC: the DDM "flat" LFN. For storage: the physical file name of the original source file.

_concerns : this convention won't help to group files on tapes, but it will decrease number of sub-directories and it may be useful in the future when number of datasets per (project)/(data type) will increase_

### Group and User Datasets

To place datasets used by different ATLAS groups or/and users the following convention is proposed for _group_ and _user_ datasets.

_/project/(Group or User)info/datasetName/fileName_, where

* name of project (f.e. _group08, user08, user,..._), the first field in dataset name,
* the second field in dataset name (f.e. _JohnBakken_ or _EGamma_)
* DDM dataset name.
* For LFC: the DDM "flat" LFN. For storage: the physical file name of the original source file.

### Transient (_sub,_dis) datasets

Directory and LFC path of datasets with limited lifetime (f.e. PanDA _dis and _sub_ datasets) is formed differently. Only basic part of dataset name (everything before _dis or _sub subfields) is used to form directory and LFC path.

F.e. file _AOD.022009_00293.pool.root.1_

from dataset

_/mc08/AOD/mc08.007447.singlepart_mupt50.recon.AOD.e315_s422_r408_tid022009_sub0123455_

will be stored in directory

_/mc08/AOD/mc08.007447.singlepart_mupt50.recon.AOD.e315_s422_r408_tid022009/_

and _subXX part will be also removed from LFC path

### Time scale

The proposed new convention will be used starting from Mar 1st 2009.

## References

* [1] "ATLAS Dataset Definition". ATLAS SWING internal note 8 Mar 2006;