## 1 Expected Size and Read-out Rate of the Data of the ATLAS ITk Pixel Detector

The ATLAS Collaboration

The High-Luminosity LHC with its large number of collisions per proton-proton bunch crossing every 25 ns will present a challenging environment for particle detectors. The ATLAS Upgrade Program foresees the complete replacement of the current tracking system with a full-silicon Inner Tracker (ITk) made of Pixel and Strip subdetectors. The ITk data are read out for the bunch crossings which are selected by the first level (L0) of the trigger, at an average rate of 1 MHz. Estimating the data rates for the ITk subdetectors is essential to make sure the detector read-out system can read out data at the design L0 trigger frequency. This document presents the most recent calculation of the data read-out rates of the ITk Pixel detector and discusses available handles to allow recovering the target trigger rate if this is not reached.

## 1 Introduction

The High-Luminosity LHC (HL-LHC) is expected to operate from the second half of 2027 and will provide proton-proton collisions with a maximum instantaneous luminosity of \(7.5\times 10^{34}\) cm\({}^{-2}\)s\({}^{-1}\) corresponding to on average 200 inelastic proton-proton interactions per bunch crossing. In order to track charged particles produced in these challenging data taking conditions, the ATLAS Inner Detector [1] will be replaced by a new all-silicon Inner Tracker (ITk) [2; 3; 4].

The HL-LHC bunch crossing frequency is 40 MHz, producing an amount of data which far exceeds the computing storage and processing capabilities, thus a two-level trigger system [5] will be used to select data. The ITk data are read out for the bunch crossings which are selected by the first level (L0) of the trigger, at an average rate of 1 MHz. They are then used in the second level of the trigger which reduces the selected data rate further to an average frequency of 10 kHz.

Data from pixel and strip channels whose signal is above a discriminator threshold are read out. The amount of non-sensitive material in the detector volume, such as cooling and cables, strongly affects the number of detector elements that need to be read out at every L0 trigger accept: the more material one has the more secondary particles are produced by the interaction with the detector material. The number of radiation lengths of the detector support structures, cooling and cabling needs to be minimized while the detector read-out system needs to be capable to cope with the expected data rates. The estimation of the data rate (the number of bits which are read out at every L0 accept signal) is therefore essential to design the detector and make sure data can be read out at the design L0 trigger frequency.

In this note, the most recent calculations of the data read-out rate of the ITk Pixel detector are presented and discussed.

The note is organised as follows: Section 2 presents the ITk detector layout; Section 3 describes the characteristics of the read-out chip and the RD53B data output format; Section 4 introduces the simulation model, the Monte Carlo samples used as well as the frameworks developed to estimate data read-out rates and trigger rate limits reported then in Section 5. Results are summarised in Section 6.

## 2 Layout of the ITk Pixel Detector

The ITk is a tracking detector composed of a Pixel Detector [3] surrounded by a Strip Detector [2]; it provides tracking acceptance up to a pseudorapidity 1\(|\eta|=4\).

Footnote 1: ATLAS uses a right-handed coordinate system with its origin at the nominal interaction point in the centre of the detector and the \(z\)-axis along the beam pipe. Cylindrical coordinates \((r,\phi)\) are used in the transverse plane, \(\phi\) being the azimuthal angle around the \(z\)-axis. The pseudorapidity is defined in terms of the polar angle \(\theta\) as \(\eta=-\ln[\tan(\theta/2)]\).

The full ITk Layout used for the results presented in this note is labelled as 23-00-03 and is shown in Figure 1[4] while a detailed view of the ITk Pixel Detector is shown in Figure 2. It includes five layers made of a flat barrel section, where the detector elements (modules) are mounted on staves arranged cylindrically around the beam line, and multiple inclined ring-shaped barrel disks and/or vertical ring-shaped end-cap disks. The inner two pixel layers are separated from the outer three layers by an Inner Support Tube (IST), that facilitates a replacement of the inner system part way through the lifetime of the HL-LHC due to radiation damage. Each barrel layer contains a flat and a (vertical or inclined) ring section. The numbering scheme and position of the barrel layers are reported in Table 1 while Table 2 summarisesthe numbering scheme and the position of the end-cap rings. The three regions, flat barrel, barrel rings and end-cap rings, are depicted with different colors in Figure 2.

Over the last year, the amount of material in the Pixel and Strip subsystems underwent a scrutiny procedure to precisely estimate the contribution of active and passive material of both subdetectors. Additional details on the detector material can be found in [4].

The innermost layer, corresponding to barrel layer 0 and ring layer 0, uses smaller modules with 3D pixel sensor technology, made of a single active element whose front-end (FE) read-out chip (bump-bonded to the sensors) are linked in triplets. All other layers use 'quad' planar modules in which four FE chips are bump-bonded to the silicon sensor. The pixel pitch is \(50\times 50\)\(\mu\)m\({}^{2}\) except in the flat region of the

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|} \hline Barrel & Radius & Number & Flat & Flat & Inclined & Inclined & Vertical & Vertical & Module \\ Layer & [mm] & of & Barrel & Sensors & Rings & Rings & Rings & Rings & Type \\  & & Staves & \(|z|\) [mm] & per Stave & \(|z|\) [mm] & & \(|z|\) [mm] & & \\ \hline
0 & 34 & 12 & 0-245 & 24 & - & - & 263-1142 & \(2\times 15\) & triplets \\
1 & 99 & 20 & 0-245 & 12 & - & - & 263-1142 & \(2\times 15\) & quads \\
2 & 160 & 32 & 0-372 & 18 & 380-1035 & \(2\times 6\) & - & - & quads \\
3 & 228 & 44 & 0-372 & 18 & 380-1035 & \(2\times 8\) & - & - & quads \\
4 & 291 & 56 & 0-372 & 18 & 380-1035 & \(2\times 9\) & - & - & quads \\ \hline \end{tabular}
\end{table}
Table 1: Parameters for the ITk pixel flat barrel and barrel rings in the 23-00-03 layout. The number of flat sensors per stave refers to the flat part of the barrel where sensors are placed parallel to the beam line. The number of barrel rings refers to both sides of the detector. Triplets consist of three read-out chips, each with a separate \(2\times 2\) cm\({}^{2}\) sensor, while ‘quad’ modules are made of four connected read-out chips associated with a single \(4\times 4\) cm\({}^{2}\) sensor.

Figure 1: A schematic depiction of the ITk Layout 23-00-03 [4]. Only one quadrant and only active detector elements are shown. The active elements of the Strip Detector are shown in blue, and those of the pixel detector are shown in red. The horizontal axis is along the beam line with zero being the nominal interaction point. The vertical axis is the radius measured from the interaction point.

inermost barrel layer where it is \(25\times 100\)\(\mu\)m\({}^{2}\). Given the difference in the pixel pitch, sensors belonging to the innermost barrel layer consist of \(768\times 200\) pixels. All other sensors consist of \(384\times 400\) pixels. Additionally, the active area of sensors in layer 1 is \(100\)\(\mu\)m thick, while all other sensors have a thickness of \(150\)\(\mu\)m.

The same FE read-out chip is used for all modules in the ITk Pixel Detector, whose size is \(20.1\times 21.05\) mm\({}^{2}\). Each pixel has a free-running amplifier followed by a discriminator that is always live. The discriminator threshold is chosen to accept more than \(99\%\) of signals from charged particles while keeping the noise firing rate (dark counts) at approximately \(10^{-6}\) per pixel per bunch crossing. For each pixel above the threshold the time stamp, row and column number, and a 4-bit measurement of the signal amplitude (time-over-threshold, ToT) is digitised and recorded. This information is stored until a signal from the Level-0 trigger is received, and the data corresponding to the triggered bunch crossing are then transmitted from the modules off-detector via electrical links running at 1.28 Gb/s. The number of links per FE chip has been optimised in order to guarantee a sufficient bandwidth to read out the detector at an average trigger rate of 1 MHz.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|} \hline Ring Layer & Inner Radius [mm] & \(|z|\) [mm] & Rings & Sensors per Ring & Module Type \\ \hline
0 & 58.70 & 1103-1846 & \(2\times 6\) & 30 & triplets \\
1 & 80.00 & 1280-2621 & \(2\times 8\) & 20 & quads \\
2 & 154.50 & 1145.5-2850 & \(2\times 11\) & 32 & quads \\
3 & 214.55 & 1145.5-2850 & \(2\times 8\) & 44 & quads \\
4 & 274.60 & 1145.5-2850 & \(2\times 9\) & 52 & quads \\ \hline \end{tabular}
\end{table}
Table 2: Parameters for the ITk pixel end-caps in the 23-00-03 layout. The inner radius refer to the innermost point of the sensors on a ring. The number of rings refers to both sides of the detector. Triplets consist of three read-out chips, each with a separate \(2\times 2\) cm\({}^{2}\) sensor, while ‘quad’ modules are made of four connected read-out chips associated with a single \(4\times 4\) cm\({}^{2}\) sensor.

Figure 2: A zoomed-in view of the Pixel Detector of the ITk Layout 23-00-03. Only one quadrant and only active detector elements are shown. Three different colors are used to highlight the three detector regions: the flat barrel is shown in red, vertical and inclined barrel rings are shown in green and the end-cap rings are shown in blue. The horizontal axis is along the beam line with zero being the nominal interaction point. The vertical axis is the radius measured from the interaction point.

More details on the read-out chip of the ATLAS ITk Pixel Detector are given in the next section.

## 3 ITkPix Data Output

The read-out chip for the ATLAS ITk Pixel Detector is designated ITkPix and is produced by the RD53 Collaboration using a common ATLAS-CMS design framework. This is based on the RD53A integrated circuit [6], but evolved to incorporate all production requirements defined by the experiments.

The ITkPix chip consists of a pixel matrix and a chip bottom. The pixel matrix contains \(50\times 48\) basic units called cores, each \(400~{}\mu\)m \(\times\) 400 \(\mu\)m core serving 64 sensor pixels. For the purposes of read-out formatting, each chip consists of 50 core-columns, each column containing 192 quarter-cores. A quarter core is connected to either \(2\times 8\) pixels or \(4\times 4\) pixels for \(50~{}\mu\)m \(\times\) 50 \(\mu\)m and \(25~{}\mu\)m \(\times\) 100 \(\mu\)m pixel-pitch sensors, respectively.

The data output format and configuration have significant flexibility. Here, the baseline configuration that will be adopted for the ITk is summarised, as this is also used for the simulation results presented in this document. Each chip has available four serial output links, but different numbers are used depending on the location in the detector as given in Table 3. Each link will drive a 100 \(\Omega\) impedance differential cable. All links sending data off-module run at 1.28 Gb/s. Some links are used to send data between chips and are operated at a lower bit rate. Thus, a number of links per chip value of 0.5 means that one chip sends its data to another chip, and that this other chip sends the data from both chips off-module at 1.28 Gb/s, while a value of 0.25 means that 3 chips each send their data to a fourth chip, and that the fourth chip uses one 1.28 Gb/s link to send its data off-module. The ITkPix chip supports these link sharing modes.

The encoding of the data on the output links is always the same regardless of link sharing mode or not. The Aurora 64b/66b protocol is the highest level of encoding, providing framing and DC balance with low overhead. Within the Aurora 64-bit blocks a custom encoding is used, along with custom start and end of event markers. With an event one means all data from a given triggered bunch crossing for a given chip. Each event occupies one or more whole Aurora 64-bit blocks. From this fact it follows that events will be padded with gist to make a multiple of 64, and, therefore, each event (each trigger) will "waste" 32 bits of padding on average if the event length is random (an option allows sending multiple events in an integer number of 64-bit blocks, but is not the ATLAS baseline). Each chip sends out its events in the sequence in which they were triggered. When using data merging, i.e when link sharing between chips is configured, whole Aurora 64-bit blocks from different chips are interleaved, and each block is labelled with a 2-bit chip identifier. Monitoring data shares the same link as hit data, occupying a programmable, but constant fraction of the whole Aurora 64-bit blocks. These are distinguished from the hit data blocks taking advantage of different Aurora header types.

Within an event, hit data is organised as a stream of quarter-core variable-length records. Each record contains the position of the quarter-core in the pixel matrix (often relative to the previous one), the hit map of the 16 pixels in the quarter-core, indicating which ones fired, and the 4-bit ToT values for all the fired pixels. The hit maps are compressed using a binary tree algorithm resulting in significantly less than 16 bits per map on average. The ToT values are not compressed.

## 4 Data rates calculation

### ITk simulation and digitisation

The ITk full simulation [7] is based on the Geant4 toolkit [8]. The simulation software has been updated to implement the latest iteration of the ITk layout as described in [4] and presented in Section 2. The description of the Pixel and Strip subsystems has been significantly improved in the recent years in order to represent in greater detail and accuracy the distribution of passive material within the ITk volume and closely match the precise description provided by the subdetector engineering groups.

During the simulation step particles are propagated through the detector volume and various physics processes, caused by the interaction of the particles with the detector material, are simulated. The energy depositions obtained by Geant4 are processed in a subsequent subdetector-specific digitisation step to emulate the detector electronics output and generate read-out signals. In the following only the pixel digitisation will be described.

For each particle traversing a pixel module, Geant4 determines the path within the module as well as the amount of energy being deposited due to interaction with materials. At this point the pixel sensor segmentation is not yet exploited. The pixel digitisation uses a Bichsel Model [9] to describe how deposited charges are distributed along the path inside the pixel layer. Charges are then drifted towards the electrodes of the pixel module due to the external electric field and magnetic field. Several random effects, such as thermal diffusion and trapping effect from irradiation, can affect the drift process. After charges are drifted to the read-out surface, the layout of pixel sensors is taken into account in order to determine if a pixel is fired or not based on its IoT [10].

Specific to the ITk Pixel Detector, two discriminator thresholds are implemented to account for the use of different pixel sensor pitches. A discriminator threshold of 900 \(e\) is used for modules belonging to the

\begin{table}
\begin{tabular}{|c|c|c|} \hline Layer & Section & Number of Links/FE \\ \hline  & Flat barrel & 4 \\
0 & Barrel rings & 3 \\  & End-cap rings & 2 \\ \hline  & Flat barrel & 0.5 \\
1 & Barrel rings & 1 \\  & End-cap rings & 1 \\ \hline  & Flat barrel & 0.5 \\
2 & Barrel rings & 0.5 \\  & End-cap rings (1-5) & 0.5 \\  & End-cap rings (6-11) & 1 \\ \hline  & Flat barrel & 0.25 \\
3 & Barrel rings & 0.25 \\  & End-cap rings & 0.5 \\ \hline  & Flat barrel & 0.25 \\
4 & Barrel rings & 0.25 \\  & End-cap rings (1-7) & 0.25 \\  & End-cap rings (8-9) & 0.5 \\ \hline \end{tabular}
\end{table}
Table 3: Number of links/FE for the different regions of the pixel detector. A fractional number of links/FE means that the same link is shared between multiple chips to send data out.

flat barrel of the innermost layer, equipped with \(25\times 100\)\(\mu\)m\({}^{2}\) pixels, while 600 \(e\) is used elsewhere. A gaussian distributed noise contribution is added to the charge induced by the particle. The noise RMS is 110 \(e\) for the flat barrel of the innermost layer and 75 \(e\) elsewhere. All hits with a charge above threshold are assigned to the bunch crossing to which the particle which has contributed the most to the charge belongs. The digitisation of 3D pixel sensors on the innermost layer is approximated using planar sensor digitisation with the 3D sensor design emulated switching off the Lorentz effects in the charge drifting.

#### 4.1.1 Simulation samples

The evaluation of the data rates for the ITk Pixel Detector is done using a \(t\bar{t}\) sample at \(\sqrt{s}=14\) TeV at an average pileup value \(\langle\mu\rangle\) of 200. This sample was generated using Powheg Box[11, 12, 13] interfaced to the Pythia8[14] parton shower model with the A14 set of tuned parameters. The effect of pileup was modelled overlaying on the \(t\bar{t}\) events minimum-bias interactions generated using Pythia8 with the A3 set of tuned parameters [15]. \(t\bar{t}\) events at \(\langle\mu\rangle=200\) are considered to provide a representative measurement of both on-detector occupancy and bandwidth occupancy.

Dedicated samples were produced in order to study the effect of the material on the data rates and trigger rate limits. For those samples the material within the ITk pixel volume was increased by 20% in order to account for uncertainties on the material estimates provided by the pixel subdetector engineering group and on the detector description in simulation. In addition, the effect of the pixel chip discriminator threshold on data rates has been studied by digitising the simulated samples with higher threshold than nominal. For these samples a pixel chip discriminator threshold of 2.5 k\(e\) was used.

#### 4.1.2 Approximated or neglected effects

Non-guassian noiseSince the noise is modelled as a gaussian contribution, with an RMS which is eight times smaller than the discriminator threshold, it can push some pixel charges above or below threshold but not create noise hits with no charge from collision particles. In the real detector, a non-gaussian tail from noisy pixels can be expected. The worst offenders will be identified and masked, but a small residual contribution will remain. The noise rate would also have a component proportional to the real hit rate, since the effective threshold is lowered immediately after the registration of a real hit (after-pulsing).

Noise occupancyIn the current detector the noise occupancy is of the order of \(10^{-5}\) per bunch crossing, and between 1% and 3% of the collision rate, depending on the layer [16]. A contribution of a few percent from noise would be compatible with the safety scale factors used in this document, but it is not included explicitly.

Time walkThe charge produced by particles is assigned to the bunch crossing where the particle was produced. In reality, when the charge is just above the discriminator threshold, it might be detected in the next bunch crossing. This effect is known as time-walk and is currently not simulated. Anyhow it would have a negligible effect on the data rates, since the number of hits lost from the triggered events would be compensated by a nearly equal number of hits from the previous bunch crossing, the total data rate being dominated by the pileup contribution.

AfterglowThe simulated afterglow contribution is based on measurements performed in Run 1[17] and corresponds to about 1% of the collision rate.

BeamspotFor HL-LHC upgrade studies both ATLAS and CMS agreed to adopt a bunch structure with a gaussian beamspot profile and a fixed collision region length of 50 mm [18]. Some variation across the fill is expected in reality [19] but has not been accounted for in the present document.

3D modulesAs mentioned in Section 4.1, the 3D structure of electrodes in the innermost layer has not been implemented yet in the simulation of the sensor charge collection. This is a conservative assumption as 3D sensors have a slightly lower charge collection efficiency than planar sensors before irradiation, but the difference is small with both kinds of sensor having more than 97% detection efficiency [3].

ITkPix featuresIt is assumed that the nominal configuration of the read-out electronics is used. The ITkPix read-out chip comes with useful features that would affect the data rate if used. The Precision ToT module would allow measurements of Time of Arrival (ToA) and ToT at 1280 MHz effective rate. The ability of tuning the chip while taking data (Trickle Tuning) would add a 1% contribution to the data rate when in use. A discussion of the usage scenarios of these features goes beyond the scope of this note.

### Detailed simulation of the ITkPix read-out chip

VEPIX53 (Verification Environment for pixel chips) [20] is a UVM (Universal Verification Methodology) [21] based simulation and verification framework developed by the RD53 Collaboration. It incorporates virtual components (trigger, DAQ, hit generation etc.) emulating a physics run so hit data can be captured and processed by the ITkPix chip. Functional components are shown in top level architect of this framework in Figure 3.

This framework is configurable to generate random hit data or feeding from the Monte Carlo data file of specific modules or layers for a given detector. Trigger rate and duration of the run are also configured based on test requirements complying with specifications. Reports generated by VEPIX53 include lane data rate, read-out latency and hit loss ratio between hits injected and received over the link.

VEPIX53 framework runs on state-of-the-art simulation tool named as "Xcelium Logic Simulation" by Cadence [22]. It's equally compatible and has been utilised on a different simulator known as Questa by Mentor Graphics [23]. These tools are designed and optimised for complete logic simulations, debug and verification with UVM methodology.

Using simulation tools to run extensive performance characterizations at module level may require large virtual memories and long simulation time. For example, a complete simulation run with link sharing between four chips requires up to 96 GB of virtual memory (RAM) and 4 instances of complete ITkPix chips are required. Similarly, a single chip simulation of 50,000 bunch-crossing clocks duration (1.25 msec) requires 36 hours. Due to long duration of simulations and requiring large RAM a software-based simulation methodology, described in the next section, is developed for evaluation of data rates from the complete detector.

Data rates obtained from VEPIX53 for certain modules at different locations in the Pixel Detector are compared with the ones obtained with the software-based simulation of the ITkPix using simulated events from a \(t\overline{t}\) sample at \(\langle\mu\rangle=200\). These have been shown to agree to an acceptable level.

### Software simulation of the ITkPix read-out chip

A dedicated algorithm has been implemented within the ATLAS software to simulate the encoding of the information on the fired pixels for sensors according to the ITkPix data output format, providing the data rate per event for all ITk pixel modules.

the hit data which encodes hierarchical column and row addresses of the quarter-core, the 16 pixels quarter-core compressed hit map, followed by the ToT values for all hit pixels in the quarter-core. Data are then split in 64-bit blocks adding, if needed, zeros (orphan bits) between the end of the hit data and end of the last 64 bit frame.

The algorithm successfully manages to reproduce the same hit data as encoded using the ITkPix data output format. However it doesn't have any knowledge of the Aurora 64b/66b transmission protocol, i.e. monitoring data and Aurora headers are not included in the simulated output data. To correctly account for the protocol overhead a scale factor is evaluated to inflate the stream lengths obtained with the software-based simulation of the ITkPix. It is obtained by comparing the size of the ITkPix data output evaluated with the detailed and the software-based simulation for a set of chips at different locations in the Pixel Detector. Service blocks are estimated to correspond to 4% of the output bandwidth.

If the link sharing mode is enabled additional service blocks are needed to determine which Aurora block belongs to which chip. A second scale factor is therefore evaluated to take this into account. Results are shown in Figure 4 for the two link-sharing configurations, 0.5 and 0.25 links/FE, adopted in the ITk Pixel Detector. The length of the ITkPix output data from chips where link sharing is required is scaled up by an additional 3%, which corresponds to the mean of the evaluated scale factors.

For the results presented in this note single-event streams are simulated, with hit map compression. Two main configurations of the output stream suppressing or not the ToT block from the hit data are investigated. The algorithm evaluates the length of the ITkPix output data for each read-out chip, applying as well the aforementioned scale factors, in \(t\bar{t}\) events with an average of 200 proton-proton interactions per bunch

Figure 3: Functional top level view of RD53B chip verification framework

crossing. The distribution of stream sizes is averaged over all chips sharing the same \(z\) location in the detector. This is then averaged over the number of events in the sample to provide an average stream size per event for a chip at each \(z\) position. Finally, the average stream size per event is scaled by the chip read-out frequency, set to 1 MHz as required by the L0 trigger, to give a final average data rate per chip.

A safety scale factor of 20% is applied on the estimated data rates. This safety factor is supposed to cover a combination of multiple factors, like uncertainty on the Pixel Detector material, physics effects that are not properly simulated and possibly overoptimistic assumptions on the link occupancy. This safety factor also includes the fluctuation of the link sharing scale factors, shown in Figure 4, around the mean value. Thanks to the recent close examination of the ITk pixel material, both on the engineering and simulation sides, a more accurate and precise estimation and description of the several contributions have been obtained. Therefore the data rate uncertainty due to the knowledge of the detector material has been reduced with respect to previous evaluations and is assumed to be 5% (see also Section 5.4).

The data rate for a chip at a given \(z\) location is hence:

\[\text{data rate }[\text{b}/\text{s}]=\text{SF}_{\text{A}}\cdot\text{SF}_{ \text{l.s.}}\cdot\text{stream length }[\text{b}]\cdot f_{\text{read-out}}[\text{Hz}]\cdot\text{SF}_{\text{ saf}} \tag{1}\]

where stream length is the average stream size per event in bits; \(\text{SF}_{\text{A}}\) and \(\text{SF}_{\text{l.s.}}\) are the scale factor to account for the Aurora overhead and link sharing, respectively; \(f_{\text{read-out}}\) is the chip read-out frequency, set to 1 MHz; and \(\text{SF}_{\text{saf}}\) is the safety scale factor described above. For 'quad' modules, the data rate per chip is eventually averaged over the four chips.

Trigger rate limits are estimated from the obtained data rates defining a maximum link occupancy for the pixel links. A maximum average link occupancy of 80% is chosen in order to keep the amount of hit data that cannot be transferred from the read-out chips to the DAQ system within the latency limit at an acceptable level (\(<1\%\)). The maximum trigger rate is hence obtained as follows:

\[\text{trigger rate}_{max}=\frac{\#\text{links}/\text{FE}\cdot f_{\text{ link}}^{max}\ [\text{b}/\text{s}]}{\text{data rate }[\text{b}/\text{s}]}\cdot f_{\text{read-out}}[\text{Hz}] \tag{2}\]

where \(\#\text{links}/\text{FE}\) refers to the number of links per FE as reported in Table 3; \(f_{\text{link}}^{max}\) [Hz] is the maximum bit rate frequency of the link, assumed to be 80% of 1.28 Gbps; and \(f_{\text{read-out}}\) is the chip read-out frequency as defined above.

## 5 Results

### Data rates and Trigger rate limitations

Data rates for the full pixel detector are evaluated with the athena-based full simulation using \(t\bar{t}\) with \(\langle\mu\rangle\ =\ 200\). As described in the previous section, input quantities are hits on pixel sensor matrix. Figures 5, 6 and 7 show the average number of hits per chip, the average number of quarter-cores per chip and the average number of hits per quarter-core per chip. Figure 8 shows the chip occupancy. All distributions are per event and are shown separately for the inner and outer pixel system.

Results on data rates are summarized in Table 4 and visualised in Figure 9 and Figure 10. Trigger rate limits are reported in Table 5 and visualised in Figure 12 and Figure 13. As indicated in Table 5 a few barrel and end-cap rings are just below the target trigger rate of 1 MHz and only the two far-out layer-3 end-cap rings miss the target trigger rate by more than 10%2.

Footnote 2: It should be noted that the estimated trigger rate limits have been calculated under the assumption that no pixels in the read-out chips will be masked.

Data rates and trigger rate limits are also shown in a detector-display mode in Figure 14.

Data rates at 1 MHz read-out frequency are also used to estimate the event size for the ITk Pixel Detector. For each event, a measurement of the total amount of data is obtained and converted from bits to bytes, removing as well the Aurora encoding contribution. The final event size will correspond to the size of the ITk pixel raw data byte stream as decoded and propagated to downstream clients. The distribution of the pixel event size is shown in Figure 11 for \(t\bar{t}\) events with \(\langle\mu\rangle=200\). The average event size results to be 1.73 MB (including 20% safety factor). The ITkPix read-out chip provides 25% reduction to the pixel average event size compared to the value obtained extrapolating from Run 2 data to the Phase-II conditions, including the new detector systems introduced by Phase-I and Phase-II upgrades [5].

Figure 4: Additional scale factor for link sharing evaluated comparing the size of the ITkPix data output obtained with the detailed and the software-based simulation for a set of chips at different locations in the Pixel Detector as a function of the average number of fired pixels. The scale factors are evaluated for 0.5 and 0.25 links/FE. The dashed green line corresponds to the mean of the evaluated scale factors.

Figure 5: Average number of hits per chip for (a) the inner and (b) outer pixel system.

Figure 6: Average number of quarter-cores per chip with at least one hit for (a) the inner and (b) outer pixel system.

Figure 8: Average chip occupancy for (a) the inner and (b) outer pixel system.

Figure 7: Average number of hits per quarter-core per chip for (a) the inner and (b) outer pixel system.

\begin{table}

\end{table}
Table 4: Estimated data rates for the ITk Pixel Detector. Columns correspond to chips located on modules at increasing \(|\text{z}|\) from left to right for each layer. Numbers are including a 20% safety factor for all layers and sections.

## 6 Conclusion

Figure 9: Estimated data rates in the inner pixel system. Plots show results for (a) the innermost and (b) next-to-innermost layers reporting the rates for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor for all layers and sections. The dashed red line correspond to a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio of estimated data rates with respect to the maximum link occupancy.

Figure 10: Estimated data rates in the outer pixel system. Plots show results for (a) layer 2, (b) layer 3 and (c) layer 4 reporting the rates for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor for all layers and sections. The dashed red line correspond to a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio of estimated data rates with respect to the maximum link occupancy.

[MISSING_PAGE_FAIL:17]

Figure 12: Estimated trigger rate limits in the inner pixel system. Plots show results for (a) the innermost and (b) next-to-innermost layers reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are evaluated from Table 4 assuming a maximum link occupancy of 80% for the pixel links for all layers and sections.

Figure 13: Estimated trigger rate limits in the outer pixel system. Plots show results for (a) layer 2, (b) layer 3 and (c) layer 4 reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are evaluated from Table 4 assuming a maximum link occupancy of 80% for the pixel links for all layers and sections.

Figure 14: Estimated (a) data rates and (b) corresponding trigger rate limits in the ITk Pixel Detector. Data rate numbers are including the 20% safety factor for all layers and sections. Trigger rate limits are evaluated from the data rate estimates assuming a maximum link occupancy of 80% for the pixel links.

### Dependence on threshold and ToT suppression

In order to recover the target trigger rate of 1 MHz, other handles rather than adding additional services need to be explored. The main possible handles studied in this document are the increase in the chip discriminator threshold and the suppression of the ToT block in the data output stream.

The effect of increasing the chip discriminator threshold from the nominal values - 900 \(e\) is used for modules belonging to the innermost layer while 600 \(e\) is used elsewhere - to 2.5 k\(e\) for all pixel FE read-out chips on trigger rate limits is shown in Figures 15 and 16 for the inner and outer pixel system, respectively. The maximum trigger rate varies between 7 and 15% depending on the distance from the beam line and the detector region. The largest increase is seen for the flat barrel region on layer 1, as shown in Figure 15(b). Compared to the results shown in Table 5, only the last layer-3 end-cap ring still reports a trigger rate below the target value, missing the target trigger rate by 5%. For all other modules the target trigger rate of 1 MHz is fully recovered.

A much more significant reduction in data rates with consequent increase in maximum trigger rates can be achieved when the ToT information is not included in the output stream, as shown in Figures 17 and 18. The increase in the achievable trigger rate is also a reflection of the number of pixels contributing to the data information per quarter-core, shown in Figure 7. The effect is indeed overall larger in the flat barrel region (especially in the inner layers) and increases up to 60% along the barrel staves. For barrel and end-cap ring regions the variation is between 25 and 35% depending on the layer. This option being the most efficient in terms of bandwidth reduction can adversely affect tracking performance, as the analogue clustering calibration exploits the charge distribution in the clusters, evaluated from the ToT of each channel, to allow for a more accurate evaluation of the position of the clusters and its resolution [24]. Hence dropping the ToT is strongly disfavoured, except in extreme cases and for modules where the average cluster size is small, e.g. for outer end-cap rings.

Tables 6 and 7 summarise the results described above as variation with respect to those reported in Table 5.

Figure 15: Estimated trigger rate limits in the inner pixel system with the nominal and increased pixel chip discriminator threshold. Plots show results for (a) the innermost and (b) next-to-innermost layers reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor applied on the data rates for all layers and sections and assuming a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio between the two configurations.

Figure 16: Estimated trigger rate limits in the outer pixel system with the nominal and increased pixel chip discriminator threshold. Plots show results for (a) layer 2, (b) layer 3 and (c) layer 4 reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor applied on the data rates for all layers and sections and assuming a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio between the two configurations.

\begin{table}

\end{table}
Table 6: Summary table of the variation of the maximum trigger rate with the increased pixel chip discriminator threshold with respect to results obtained with the nominal configuration (Table 5). Columns correspond to chips located on modules at increasing \(|\mathsf{z}|\) from left to right for each layer.

## 6 Conclusion

Figure 17: Estimated trigger rate limits in the inner pixel system including or removing the ToT information from the data output stream. Plots show results for (a) the innermost and (b) next-to-innermost layers reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor applied on the data rates for all layers and sections and assuming a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio between the two configurations.

Figure 18: Estimated trigger rate limits in the outer pixel system including or removing the ToT information from the data output stream. Plots show results for (a) layer 2, (b) layer 3 and (c) layer 4 reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor applied on the data rates for all layers and sections and assuming a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio between the two configurations.

\begin{table}

\end{table}
Table 7: Summary table of the variation of the maximum trigger rate removing the ToT information from the data output stream with respect to results obtained with the nominal configuration (Table 5). Columns correspond to chips located on modules at increasing \(|\mathsf{z}|\) from left to right for each layer.

### Impact of other data format options on data rates

Increased occupancyEffects on data rates from a range of sources (e.g. afterglow, after-pulsing, chip noise and material showering) have been qualitatively studied by modelling increased chip occupancies from single isolated pixel hits (noise-like) and grouped pixel hits (cluster-like). In both cases, for a moderate increase of 10% in hit occupancy the greatest effect on the data rate is observed in the inner layers. For high occupancy inner layers, both in the barrel and end-cap, the increase in occupancy lengthens the data stream, producing a corresponding increase of up to 10% in data rates. In contrast, low occupancy regions have a greater proportion of data overhead from the stream protocol (pixel addressing and unused bits). Hence, a small increase in occupancy contributes relatively less to the stream length, which mitigates an increase in data rate. For the outer barrel layers an increase of a few percent is observed. Studies increasing noise-like occupancy suggest the effects of removing isolated pixels will be correspondingly similar.

Events per streamThe effect of increasing the number of events per stream has also been qualitatively studied. Though a decision has been taken not to use event merging it remains a potential handle to control data rates if ever required. It was found that increasing the event number lowers the data rate significantly outside the inner layers. Savings come from the loss of data overhead from the stream protocol and the reduction of orphan bits, since these two effects are more important for low occupancy modules. A limit to the benefit of merging events was found, even for low occupancy modules, in increasing the number of events per stream beyond single digits. Using 10 events per stream provides a reduction of data rates of up to 20% (10%) in the outer barrel (end-cap) layers. Discussion on the effects on data integrity when increasing the stream length goes beyond the scope of this note.

Further modifications in the data protocol (e.g. number of events per stream, ToT omission, event size limitation) can be considered to reduce data rates when needed. They must be balanced against the consequences for event information and hence for tracking performance, as already happens for the current Inner Detector.

### Dependence on material increase

The increase in the amount of non-sensitive material in the detector volume, such as cooling and cables, causes the production of additional secondary particles due to the interactions with the detector material. As a consequence more hits are produced on the active sensors, which induce an increase in the data rates. Since the description of the detector material is constantly under evolution, both in terms of engineering evaluation and software implementation, it is important to understand how much data rates are concerned, especially, by an increase in material. In order to study this effect, data rates and trigger rate limits have been evaluated considering an increase of 20% of the material within the pixel detector which is reasonably accounting for uncertainties on the material estimates provided by the pixel subdetector engineering group and on the detector description in simulation. Results are reported in Figures 19 and 20 for the inner and outer pixel system, respectively.

As expected, the additional material, and hence radiation levels inside and outside the ITk volume, leads to more data to read out compared to the nominal material configuration and hence to more modules being below the target trigger rate. The decrease on trigger rate limits stays below 3% and 5% for the flat barrel of the inner and outer system, respectively. A larger effect is seen on data read out from the end-cap rings, especially for the outer system where also the rate of production of secondary particles increases. Formodules in the end-cap rings the maximum trigger rate decreases by up to 10%. Table 8 reports the results as variation with respect to those presented in Table 5.

In large part of the pixel detector the component of the scale factor associated to the detector material uncertainty, estimated to be 5%, is compatible with the variation of the data rates observed for an increase of 20% of the material within the pixel detector.

Figure 19: Estimated trigger rate limits in the inner pixel system with the nominal and +20% increased material of the pixel detector. Plots show results for (a) the innermost and (b) next-to-innermost layers reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor applied on the data rates for all layers and sections and assuming a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio between the two configurations.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|} \hline \multicolumn{11}{|c|}{Variation with respect to nominal configuration for} \\ \multicolumn{11}{|c|}{Maximum Trigger Rate for the **flat barrel** section} \\ \hline Layer 0 & 0.01 & 0.01 & 0.00 & 0.00 & 0.00 & 0.00 & -0.01 & -0.01 & 0.00 & -0.01 & -0.01 & -0.01 \\ \hline Layer 1 & -0.02 & -0.02 & -0.02 & -0.02 & -0.02 & -0.03 & -0.02 & & & & & & \\ \hline Layer 2 & -0.05 & -0.03 & -0.04 & -0.03 & -0.03 & -0.03 & -0.03 & -0.05 & -0.04 & & & \\ \hline Layer 3 & -0.04 & -0.04 & -0.03 & -0.04 & -0.04 & -0.04 & -0.04 & -0.04 & -0.04 & & & \\ \hline Layer 4 & -0.04 & -0.03 & -0.04 & -0.03 & -0.03 & -0.03 & -0.03 & -0.04 & -0.03 & & & \\ \hline \end{tabular}
\end{table}
Table 8: Summary table of the variation of the maximum trigger rate with +20% increased material of the pixel detector with respect to results obtained with the nominal configuration (Table 5). Columns correspond to chips located on modules at increasing \(|z|\) from left to right for each layer.

Figure 20: Estimated trigger rate limits in the outer pixel system with the nominal and +20% increased material of the pixel detector. Plots show results for (a) layer 2, (b) layer 3 and (c) layer 4 reporting the maximum allowed trigger rate for flat barrel modules, barrel rings and end-cap rings. Numbers are including a 20% safety factor applied on the data rates for all layers and sections and assuming a maximum link occupancy of 80% for the pixel links. The bottom panel shows the ratio between the two configurations.

## 6 Conclusion

This note summarises the most recent calculation of data read-out rates and corresponding trigger rate limits of the ITk Pixel Detector. The ITkPix read-out chip has been emulated using a dedicated algorithm and the size of the output data has been compared to the full chip simulation in order to correctly account for protocol overheads.

Simulation studies conclude the detector read-out system as designed is generally able to cope with the expected data rates: a few barrel and end-cap rings are just below the target trigger rate of 1 MHz and only the two far-out layer-3 end-cap rings miss the target trigger rate by more than 10%.

Data read out from the detector are used to estimate the average event size which corresponds to 1.78 MB (including 20% safety factor) for \(t\overline{t}\) events with \(\langle\mu\rangle=200\). The data format of the ITkPix read-out chip allows for 25% reduction to the average event size with respect to what obtained extrapolating from Run 2 data to the Phase-II conditions [5].

In order to recover the target trigger rate of 1 MHz, two main handles have been explored. Increasing the pixel chip discriminator threshold from the nominal value to 2.5 k\(e\) allows to increase the maximum trigger rate by 7-15% depending on the detector region and to fit all the modules within 5% to the target trigger rate. In extreme cases, a much more significant reduction in data rates, between 20 and 60%, can be obtained dropping the ToT information from the output stream.

Dedicated studies have also shown the effect of the ITk pixel material on the data rates. A recent scrutiny process allowed to precisely estimate the contribution of active and passive material of the pixel detector and improve the material description within the ITk volume in simulation. The increase observed on the expected data rates confirm that in large part of the ITk Pixel Detector the component of the scale factor associated to the detector material uncertainty, estimated to be 5%, covers the variation of the data rates observed for an increase of up to 20% of the pixel detector material.

## References

* [1] ATLAS Collaboration, _The ATLAS Experiment at the CERN Large Hadron Collider_, JINST **3** (2008) S08003 (cit. on p. 2).
* [2] ATLAS Collaboration, _ATLAS Inner Tracker Strip Detector: Technical Design Report_, ATLAS-TDR-025; CERN-LHCC-2017-005, 2017, URL: [https://cds.cern.ch/record/2257755](https://cds.cern.ch/record/2257755) (cit. on p. 2).
* [3] ATLAS Collaboration, _ATLAS Inner Tracker Pixel Detector: Technical Design Report_, ATLAS-TDR-030; CERN-LHCC-2017-021, 2017, URL: [https://cds.cern.ch/record/2285585](https://cds.cern.ch/record/2285585) (cit. on pp. 2, 8).
* [4] ATLAS Collaboration, _Expected tracking and related performance with the updated ATLAS Inner Tracker layout at the High-Luminosity LHC_, ATL-PHYS-PUB-2021-024, 2021, URL: [http://cds.cern.ch/record/2776651](http://cds.cern.ch/record/2776651) (cit. on pp. 2, 3, 6).
* [5] ATLAS Collaboration, _ATLAS TDAQ Phase-II Upgrade: Technical Design Report_, ATLAS-TDR-029; CERN-LHCC-2017-020, 2017, URL: [https://cds.cern.ch/record/2285584](https://cds.cern.ch/record/2285584) (cit. on pp. 2, 11, 32).
* [6] M. Garcia-Sciveres, _RD53A Integrated Circuit Specifications_, tech. rep., CERN, 2015, URL: [https://cds.cern.ch/record/2113263](https://cds.cern.ch/record/2113263) (cit. on p. 5).
* [7] ATLAS Collaboration, _The ATLAS Simulation Infrastructure_, Eur. Phys. J. C **70** (2010) 823, arXiv: 1005.4568 [physics.ins-det] (cit. on p. 6).
* _a simulation toolkit_, Nucl. Instrum. Meth. A **506** (2003) 250 (cit. on p. 6).
* [9] F. Wang, S. Dong, B. Nachman, M. Garcia-Sciveres and Q. Zeng, _The Impact of Incorporating Shell-corrections to Energy Loss in Silicon_, Nucl. Instrum. Meth. A **899** (2018) 1, arXiv: 1711.05465 [physics.ins-det] (cit. on p. 6).
* [10] A. Collaboration, _Modelling radiation damage to pixel sensors in the ATLAS detector_, Journal of Instrumentation **14** (2019) P06012, issn: 1748-0221, url: [http://dx.doi.org/10.1088/1748-0221/14/06/P06012](http://dx.doi.org/10.1088/1748-0221/14/06/P06012) (cit. on p. 6).
* [11] P. Nason, _A new method for combining NLO QCD with shower Monte Carlo algorithms_, JHEP **11** (2004) 040, arXiv: hep-ph/0409146 (cit. on p. 7).
* [12] S. Frixione, P. Nason and C. Oleari, _Matching NLO QCD computations with parton shower simulations: the POWHEG method_, JHEP **11** (2007) 070, arXiv: 0709.2092 [hep-ph] (cit. on p. 7).
* [13] S. Alioli, P. Nason, C. Oleari and E. Re, _A general framework for implementing NLO calculations in shower Monte Carlo programs: the POWHEG BOX_, JHEP **06** (2010) 043, arXiv: 1002.2581 [hep-ph] (cit. on p. 7).
* [14] T. Sjostrand et al., _An introduction to PYTHIA 8.2_, Comput. Phys. Commun. **191** (2015) 159, arXiv: 1410.3012 [hep-ph] (cit. on p. 7).
* [15] ATLAS Collaboration, _The Pythia 8 A3 tune description of ATLAS minimum bias and inelastic measurements incorporating the Donnachie-Landshoff diffractive model_, ATL-PHYS-PUB-2016-017, 2016, url: [https://cds.cern.ch/record/2206965](https://cds.cern.ch/record/2206965) (cit. on p. 7).