ATLAS Internal Note

DAQ-NO-0XX

22 February 1996

**Description of the TRT track trigger simulation in ATRIG**

P. Eerola

_CERN, Geneva, Switzerland_

22 February 1996

This note describes the current implementation of the level-2 Transition Radiation

Tracker (TRT) track trigger in the ATRIG trigger simulation package.

## 1 Introduction

The Transition Radiation Tracker (TRT) is a tracking device consisting of stacked straw drift tubes interleaved with radiator material. A charged particle track leaves typically more than 30 hits in the detector, enabling a fast track search using a histogramming method. Transition radiation produced by electrons with \(p_{\rm T}\raisebox{-3.01pt}{$\stackrel{{>}}{{\sim}}$}0.5\) GeV/\(c\) can be used for electron/hadron separation.

This note describes the current implementation of the level-2 TRT track trigger. The track search is performed only in the Regions of Interest (Rol) defined by the level-1 calorimeter or muon triggers. The algorithm is designed for the high-luminosity operation of LHC, where the main aim of the level-2 track trigger is to reject jet background to electron triggers. In addition, level-1 muon triggers can be confirmed by associating a track candidate in the inner detector to a muon track element in the muon spectrometer. Similarly, single hadron triggers can be confirmed by matching the data from the tracking system and the calorimeters.

The TRT measures the track \(p_{\rm T}\) (\(p_{\rm L}\) in the forward TRT) and the azimuthal angle \(\phi\). In order to construct the full three-momentum of a particle, space-points measured in the high-precision tracking layers have to be associated with the TRT track element.

For the low-luminosity operation of LHC it is envisaged to make a stand-alone track search in the TRT at level-2, without using the RoI's defined in the level-1. The physics justification is the need to collect low-\(p_{\rm T}\) bb -events such as \(\bar{\rm B}^{0}_{\rm d}\to{\rm J}/\psi K^{0}_{\rm S}\) or \(\bar{\rm B}^{0}_{\rm d}\to\pi^{+}\pi^{-}\). The TRT level-2 trigger should give a track-RoI to initiate the track search in the high-precision tracking layers. A full TRT scan is considered feasible given the relatively low occupancy of the detector at low luminosity, and lower level-1 trigger output rate (10 kHz vs 100 kHz) [1].

The present implementation of the TRT trigger in the ATRIG considers only the high-luminosity case, and the track trigger search is performed in the barrel part of the TRT.

## 2 The TRT detector

The layout of the inner detector, as it was at the time of the Technical Proposal [2], is shown in Fig. 1.

### The TRT straw properties

The 0.4 cm diameter straws (cylindrical drift tubes) are interleaved with radiators to produce X-rays from ultrarelativistic particles (\(\gamma\gtrsim 1000\)). The readout scheme includes two signal thresholds: 0.2 KeV for measuring signals from charged particles, and 5 KeV for measuring X-rays from transition radiation. For charged particle tracking, drift-time information can be used with an inherent left-right ambiguity. The maximum drift-time is 38 ns for the nominal gas mixture and operating voltage in a 2 T magnetic field [2]. The read-out thus has to integrate the straw signals over two beam crossings. The position accuracy per straw has been measured to be about 150 \(\mu\)m.

### The TRT geometry in the present ATRIG code

The current ATRIG code refers to an old inner detector layout ('Cosener's House' layout), since the large simulated jet sample used for trigger studies was made using that TRT layout. In principle, the change to another TRT layout should be possible without changes in the ATRIG code, because the TRT geometry is loaded in from the simulated data tape by using a standard interface subroutine (XMYGEO in DICE/TRD).

The barrel TRT consists of four parts. The large barrel consists of two concentric cylinders, with radii \(55.3-76.7\) cm and \(82.3-103.7\) cm. The full length of both cylinders

Figure 1: Layout of the inner detector

is 190 cm. There are 60 straw layers parallel to the beam direction and to the 2 T axial magnetic field. Each wire is divided into two at the centre. In addition, there are two small cylinders to cover the transition region from barrel to end-cap at \(r\)=\(31.8-50.2\) cm, \(z\)=\(45.0-95.0\) cm (\(z\)=\(.45.0-.95.0\) cm). Each part contains 26 straw layers parallel to the beam. These two small parts are not taken into account in the trigger simulation.

The end-cap TRT consists of 14 modules in each end-cap. The straw layers are oriented perpendicular to the beam direction. The detector occupies radii between 49.8 and 104.0 cm in \(|z|=110.0-323.2\) cm.

### The TRT geometry in the Technical Proposal

The barrel TRT consists of one single cylinder, with 64 straw layers parallel to the beam direction. The layers are divided in three superlayers with 18, 21 and 25 straw layers in each superlayer. Each superlayer is divided into 34 modules around the beam. The geometry of the barrel TRT is shown in Fig. 2. The detector occupies radii between 63 and 107 cm, and the full length is 160 cm. Each wire is divided into two at the centre.

The end-cap TRT consists of 224 straw layers in each end

Figure 2: The geometry of the barrel TRT (Technical Proposal).

direction. The layers are divided in three sets of modules at each end. The first six modules are at \(z=89.0\), 102,6, 116.1, 130.5, 144.9 and 159.3 cm. Each module contains 16 layers of straws. The next seven modules are at \(z=173.7\), 187.2, 201.6, 215.1, 228.6, 242.1 and 255.6 cm. Each module contains eight layers of straws. The last four full-length modules are at \(z=270.0\), 283.5, 297.0 and 310.5 cm. Each module contains 16 layers of straws. The last shorter wheel is at \(z=324.0\) cm, consisting of eight layers of straws. The detector occupies radii between 64 and 103 cm in \(|z|=80\) - 265 cm, and between 50 and 103 cm in \(|z|=267\) - 327 cm.

### The TRT geometry (the Morges layout)

After the Technical Proposal, the geometry has been revised due to the change in the available space in the barrel.

The main changes are in the barrel region. The barrel contains 73 straw layers at radii between 59 and 107 cm. The layers are divided in three superlayers, each with 32 modules around the beam. The first superlayer contains 19 layers, the second superlayer 24 layers, and the third superlayer 30 layers.

The number of end-cap detector layers is the same, as well as the radii covered. The end-cap wheels are at \(z\)-positions from 89 cm to 331 cm.

More detailed information on the Morges TRT geometry can be found for example in ref. [3].

### Track measurement in the TRT

In a uniform axial magnetic field, charged particle tracks originating from the primary vertex appear as almost straight lines in the \((\phi,r)\) plane in the barrel and in the \((r,z)\) plane in the end-caps. Tracks are exactly straight lines in the \((\phi,z)\) plane in the end-caps.

The barrel TRT measures hit coordinates \(\phi\) (azimuthal angle) and \(r\) (radius). When the track trajectory hit coordinates are plotted as \(\phi\) versus \(r\), the slope of the track with respect to the horizontal axis, \(C_{\rm T}\), measures the \(p_{\rm T}\) of the track. The track trajectory is described by [4]:

\[qC_{\rm T}r = \sin(\phi-\phi_{0})\] \[\Leftrightarrow \phi \simeq \phi_{0}+qC_{\rm T}r(1+\frac{1}{6}(C_{\rm T}r)^{2}) \tag{1}\]

where \(\phi_{0}\) is the initial azimuthal angle of the particle, \(q\) is the particle charge, \(r\) is the radius of the particle [cm] and \(C_{\rm T}=1/(2\cdot R_{\rm T})=(0.3\cdot B)/(2\cdot 100\cdot p_{\rm T})=B/(666 \cdot p_{\rm T})\) with \(R_{\rm T}=\) the radius of curvature in the transverse plane [cm], \(B=\) the magnetic field [T], \(p_{\rm T}=\) the transverse momentum [GeV/\(c\)].

The end-cap TRT measures hit coordinates \(\phi\) (azimuthal angle) and \(z\) (\(z\)-coordinate). Plotting the track trajectory hit coordinates in the end-cap as \(\phi\) versus \(z\), the slope of the track with respect to the horizontal axis, \(C_{\rm L}\), measures the \(p_{\rm L}\) of the track. Furthermore, in the end-cap TRT, the \(p_{\rm T}\) of the track can be measured simultaneously, since the \(r\)-coordinate can be estimated from the position of the first and the last radial straw which contribute to the measurement. In the end-caps, the track trajectory is described by [4]:

\[\phi = \phi_{0}+qC_{\rm L}(z-z_{0}) \tag{2}\] \[qC_{\rm T}r = \sin(\phi-\phi_{0})=\sin(qC_{\rm L}(z-z_{0}))\simeq qC_{\rm L}(z-z_ {0})\] \[\Leftrightarrow r \simeq C_{\rm L,T}(z-z_{0}) \tag{3}\]

where \(z_{0}\) is the vertex \(z\)-coordinate, \(z\) is the actual \(z\)-coordinate of the track trajectory, \(C_{\rm L}=B/(666\cdot p_{\rm L})\) with \(p_{\rm L}=\) the longitudinal momentum \([{\rm GeV}/c]\). \(C_{\rm L,T}=C_{\rm L}/C_{\rm T}=\tan\theta\), where \(\theta\) is the polar angle.

The pattern recognition is based on a variable slope histogramming method, which searches for peaks in the distribution of hits as a function of \(\phi_{0}\) along roads defined by Eq. 1 in the barrel (Eq. 2 in the end-caps). The search for track candidates is carried out by scanning successive track roads along the \(\phi\)-direction using each hit straw in the RoI as a possible initiator of the road.

For each hit with coordinates \((\phi,r)\), the starting angle \(\phi_{0}\) is calculated by trying different slopes \(qC_{\rm T}\) (\(qC_{\rm L}\) in the end-caps): \((-C_{\rm T}^{\rm max},-C_{\rm T}^{\rm max}+\Delta C_{\rm T},...,C_{\rm T}^{ \rm max}-\Delta C_{\rm T},C_{\rm T}^{\rm max})\), where \(\Delta C_{\rm T}\) is the slope step and \(C_{\rm T}^{\rm max}=B/(666\cdot p_{\rm T}^{\rm min})\) is the maximum slope corresponding to the minimum \(p_{\rm T}\). Hits with the same \(\phi_{0}\) within an angular range corresponding to one straw diameter (0.4 cm) are assigned belonging to the same track. Each hit can define the angular range, i.e. each hit can initiate a track road. No drift-time information is used at this stage, but the straw coordinates are used.

The slope with maximum number of hits is retained for further consideration if the number of hits exceeds a pre-defined limit, unless the same slope with the next starting position yields more hits. The road is considered to contain a track candidate with initial track parameters \(\phi_{0},C_{\rm T}\) (\(\phi_{0},C_{\rm L},C_{\rm L,T},z_{0}=0\) in the end-caps). For more details of the end-cap algorithm, see Ref. [4].

In the fine-tuning phase, the hit search roads are expanded to \(\pm 1.4\) cm = \(\pm(1.2\) cm defined in \({\rm CONB}(14)+0.2\) cm straw radius). For each straw row, hits with \(\phi\)-values within the angular range corresponding to the enlarged track road are assigned to the track candidate. The \(\phi\)-limits of the road are calculated using Eq. 1 with initial parameters \(\phi_{0},C_{\rm T}\) obtained from the track research. Track candidates with more than three unique hits, i.e. hits assigned to one track only, in the narrow road (\(\pm 0.2\) cm) are kept for the track fit.

A circle is fitted to the track using a conformal mapping of the coordinates. For each hit, six different positions are used in the fit: two positions corresponding to the extreme boundaries of the straw (\(\pm r_{\rm straw}\)), two positions corresponding to the maximum drift time (\(\pm(\)drift distance + \(2\cdot\sigma)\)) and two positions corresponding to the minimum drift time (\(\pm(\)drift distance - \(2\cdot\sigma)\)). The relative weights of the hits are set to 10 for the hits corresponding to the straw boundaries, and 9 for the others.

A parabolic fit is then performed, once with a vertex constraint, and once without. The hit roads are expanded to \(\pm 2.0\) cm (defined in \({\rm CONB}(13)\)). Only the fit results with a vertex constraint are retained.

## 3 Simulation of the level-2 TRT track trigger

### Program structure

The TRT trigger code resides in the patch T2TR of ATRIG CMZ file, and the common blocks are defined in the patch T2TRCDE. The program structure conforms to the conventions used in ATRIG.

#### 3.1.1 Initialization

The TRT trigger code is initialized in the subroutine T2TRINI, called from T2SUINI via T2ZZINI. The initialization is done once in the beginning of the program execution. The minimum \(p_{\rm T}\) of tracks is defined by hand by setting the parameter T2PTMIN. The subroutine then calls T2TRSTART(T2PTMIN,IER) which reads in the TRT geometry and defines the main track reconstruction parameters. After the call to T2TRSTART, the subroutine T2TRINI fills in the common T2TRT, which defines the TRT parts and their rapidity coverage. The number of TRT parts is set in X2TRT_N_parts=4. The arrays T2TRT_ETALOEDGE and T2TRT_ETAHIEDGE define the rapidity coverage for each part, and the array T2TRT_parts gives the DICE number for each part: 1 for left end-cap (negative \(\eta\)), 3 for left barrel (negative \(\eta\)), 4 for right barrel (positive \(\eta\)), and 6 for right end-cap (positive \(\eta\)).

The subroutine T2TRSTART reads in the TRT geometry by calling the subroutine XMYGEO (in DICE/TRD). Calls to XMYGEO fill in internal arrays representing the TRT straws in terms of

* NROW number of straw rows (a row is defined as a group of straws at a fixed radius around the beam pipe)
* RROW(I) radius of the i'th row
* NSTR(I) number of straws in the i'th row
* FSTRAW(K,I) azimuthal angles of the straws in ascending order, K=(1,...,NSTR(I)), I=row

These arrays are stored in the common block T2BRSTR.

The subroutine T2TRSTART defines the track reconstruction parameters and stores them in the array CONB (equivalent ICONB), which can be accessed via the common block T2CONRECB. These parameters are 'hard-wired' in the program by defining them via a data-statement, which defines the local array PAR(20). The parameters and their default values are

* CONB(1) = 2. magnetic field [T]
* CONB(2) = PAR(2) = 0.195 radius of a straw [cm]
* CONB(3) = PAR(3) = 0.2 low energy threshold for hits [keV] (not used)
* CONB(4) = PAR(4) = 5.5 high energy threshold for hits [keV] (not used)* C O NB(5) = PAR(5) = 0.0001 slope step for track search (corresponds to 13 slopes with the default minimum \(p_{T}\))
* I CO NB(6) = PAR(6) = 15 minimum number of hits per track for research
* C O NB(7) = PAR(7) = 0.78 minimum ratio of hits to the total number of straws which can be crossed along a road
* C O NB(8) = PAR(8) = 0.50 minimum fraction of hits belonging to only one track
* C O NB(9) = PAR(9) = 0.185 effective straw radius [cm]
* C O NB(10) = PAR(10) = 0.017 effective point measurement error including multiple scattering [cm]
* C O NB(11) = PAR(11) = 0.30 minimum ratio of hits within a time-road (hits which have a timing information and which originate from the correct time-window inside a straw) to the total number of hits
* C O NB(12) = PAR(12) = 100 \(\chi^{2}\)-cut of the track fit
* C O NB(13) = PAR(13) = 2. the width of the track road for fitting [cm]
* C O NB(14) = PAR(14) = 1.2 the width of the hit search region [cm]
* C O NB(15) = T2PTMIN = 5. minimum \(p_{T}\) of the tracks to be searched for [GeV/\(c\)]
* C O NB(16) = PAR(16) = 0.0025 vertex accuracy [cm]
* I CO NB(17) = PAR(17) = 15 minimum number of hits per track

The subroutine T2FCOR is called to store the slope parametrizations for each slope I and for each straw row K. The possible slopes range from -CTMAX to CTMAX, where the CTMAX is defined by

CTMAX = \(C_{T}\) = CONB(1)/(666 \(\cdot\) CONB(15)).

The slope step DC is defined in CONB(5). The slope parameters are stored in the array

\[\mbox{CCOR(I)}=\mbox{$qC_{T}$}=-\mbox{CTMAX},-\mbox{CTMAX}+\mbox{DC},...,\mbox {CTMAX}-\mbox{DC},\mbox{CTMAX},\]

where I ranges from 1 to NCOR, which is the total number of slopes. Using Eq. 1, the array FCOR(K,I) is filled as

\[\mbox{FCOR(K,I)}=\mbox{$\phi$}-\mbox{$\phi_{0}$}=\arcsin(\mbox{$qC_{T}$}r)= \arcsin(\mbox{CCOR(I)}\cdot\mbox{RROW(K)})\]

and the array DCO R(K,I) as

\[\mbox{DCO R(K,I)}=\frac{1}{\cos(\mbox{$\phi$}-\mbox{$\phi_{0}$})}\frac{r_{ straw}}{r}=\frac{1}{\sqrt{1-(\mbox{CCOR(I)}\cdot\mbox{RROW(K)})^{2}}}\frac{ \mbox{CONB(2)}}{\mbox{RROW(K)}}.\]

#### 3.1.2 Data retrieval

The subroutine T2TRGET(IROI,IRAW) is called once per event in order to get the TRT 'raw' data corresponding to the RoI IROI. The subroutine is called by T2SUPER via T2ZGET. IROI is an input parameter giving the RoI number, and IRAW is an output parameter giving the address of the TRT manager bank. The address is generated by a function T2TRROI(IROI), which checks for the relevant TRT part and then uses a function T2TRBAR(IROI,TRT_MANAGER_BANK_INDEX,TRTPART) for the barrel (T2TREND for the forward parts) to generate the actual T2 TRT RoI banks. The T2 TRT RoI banks are T2TR, which contains local geometrical information about the RoI, and the array T2TD_Data, which contains the actual data.

The bank T2TR is defined in the common block T2TR, and it contains

* T2TR_part the DICE part number of the TRT part containing the RoI: 1 = left end-cap (negative \(\eta\)), 3 = left barrel, 4 = right barrel, 6 = right end-cap
* T2TR_data_bank_size actual size of the stored data bank
* T2TR_max_phi_straw_l = NDF total number of straws in \(\phi\) at R1 (smallest TRT radius)
* T2TR_phi_straw_lo_l = T2ZD_Phimin/DF0 minimum possible \(\phi\)-index of a straw within the RoI at R1, DF0 = \(\Delta\phi\) of straws
* T2TR_phi_straw_hi_l = T2ZD_Phimax/DF0 maximum possible \(\phi\)-index of a straw within the RoI at R1
* T2TR_phi_straw_2 same as _l but at R2 (largest TRT radius)
* T2TR_phi_straw_lo_2 same as _l but at R2 (largest TRT radius)
* T2TR_phi_straw_hi_2 same as _l but at R2 (largest TRT radius)
* T2TR_z_r_straw_lo minimum row number of a straw within the RoI
* T2TR_z_r_straw_hi maximum row number of a straw within the RoI
* T2TR_z_r_lo minimum \(r\) (\(z\)) of a straw within the RoI
* T2TR_z_r_hiSome of these arrays duplicate the information given in the common T2BRSTR. The arrays in T2BRSTR are used in the actual track reconstruction, whereas the variables in T2TR are used rather in the parts of the program which handle the data management, RoI definition and histogramming. This overlap is there due to 'historical' reasons, because the actual reconstruction part was originally written for a different environment.

The array T2TD_Data is defined in the sequence T2TD, and the array is stored in a bank structure hanging from the TRT RoI manager bank by using RBSTORE. The data are

* T2TD_Data(1,I) = RSTRAW row number of the straw for hit number I
* T2TD_Data(2,I) = PHISTRAW phi index of the straw for hit number I
* T2TD_Data(3,I) = IDIGI digitized signal for hit number I

and they are obtained from a call to GFDIG1, which gives access to the raw digitized data. The 31 bits of IDIGI are time slices in ns: T = MAX(0, (2 NBIT -1) - 4) = 0, 0, 1, 3,...,57. The least-significant non-zero bit is the correct time slice of the signal. A 32-bit dynamic range is required in the read-out electronics in order to integrate over two beam crossings (2.25 ns), since the maximum drift-time in the TRT is 38 ns. The sign of IDIGI indicates whether the hit was a low- or a high-energy hit: positive sign means a low-energy hit, and negative sign a high-energy hit.

#### 3.1.3 Feature extraction

After the TRT RoI data has been loaded in, the subroutine T2TRFEX (IROI,IMTR,IFEX) is called from T2SUPER via T2ZZFEX to perform 'feature extraction', i.e. track reconstruction. Input parameters are IROI, which is the T2 supervisor RoI bank number, and IMTR, which is the TRT RoI manager bank number. The extra level of TRT manager banks is introduced since there might be several TRT RoI's per one T2 supervisor RoI. The IFEX is an output parameter giving the TRT feature bank number. If it is set to zero, there are no banks. In case of multiple TRT RoI banks per TRT manager bank IFEX index gives the bank number of the last bank saved.

T2TRFEX loops over the TRT RoI's, given by the parameter T2TM_NtrtRois in the common T2TM (set in T2TRROI). For each RoI, the subroutine T2TRREC(IROI,IMTR,Trt_Roi_Bank_Index, feature_bank_index,IER) is called. This subroutine supervises the actual track reconstruction.

The subroutine T2TRREC first calls the subroutine T2FILSTR(roi_id,IER), which fills information about hits. For each TRT RoI bank, information is retrieved into the data array T2TD_Data. The number of lines ('size') required by T2TD_Data is calculated as size=T2TR_data_bank_size/X2TRT_data_dim. The constant X2TRT_data_dim = 3 is defined in the common T2TD. The data are then put into local arrays KTRAW(NS), which is an indicator whether the hit was a low or a high energy hit (1 for low-energy hit, 2 for high-energy hit), and ITRAW(NS), which contains the drift distance in \(\mu\)m (obtained by using the function XTRDIST from ATRECON/IRECON, which calculates the distance using drift velocity of 56 \(\mu\)m/ns). The unique straw index NS is calculated from the row and straw indeces. For example, for a hit in a row K, straw J, the index is (NS = number of straws in lines (1,..,K-1) + J).

For each hit, the subroutine T2BUFHIT(NS,K,J) is called to fill in array T2BUFRE. The histogramming method searches for an accumulation of hits with similar \(\phi_{0}\)'s (see Eq. 1). Therefore, for each hit with coordinates \(\phi\) and \(r\), one calculates the corresponding \(\phi_{0}\) as

\[\phi_{0}=\phi-\arcsin(qC_{\rm T}r)\pm\Delta\phi\]

\[\Leftrightarrow\rm{F}HIT(NHIT)=FSTRAW(NS)-FCOR(K,I)\pm{\rm{D}COR(K,I)}.\]

The slope number I=1,...,NCOR, which indicates which slope \(qC_{\rm T}\) to choose, is set to one at this stage. The \(\phi_{0}\) is corrected later in the loop over possible slopes (T2TRAN) to correspond to the actual slope parameter.

Each hit is stored twice in the array T2BUFRE, corresponding to the \(\phi_{0}\) minimum and maximum values due to the finite straw size. The hit running number is NHIT (twice the actual number of hits), FHIT(NHIT) is the hit \(\phi_{0}^{\rm min(max)}\), NUHIT(NHIT) is the hit running number NHIT, NUMST(NHIT) is the unique straw number NS, KHT(NHIT) is the index indicating which side of the straw is taken as the reference when calculating the \(\phi_{0}\) (1 for \(\phi_{0}^{\rm min}\), -1 for \(\phi_{0}^{\rm max}\)), KHT(NHIT) is the row number K.

The subroutine T2TRREC continues by looping over possible slopes I=1,..,NCOR. For each slope, the T2TRAN is first called to correct the \(\phi_{0}\) value in FHIT(NHIT) to correspond to the actual slope. The correction is performed incrementally with respect to the previous slope. At the end of the subroutine T2TRAN, the hits are ordered according to the \(\phi_{0}\) value (ascending order).

The subroutine T2PRESL is then called to perform the initial track search. The initial track search is does not use the drift-time information of hits, but the coordinates calculated from the straw walls, \(\phi_{0}^{\rm min}\) and \(\phi_{0}^{\rm max}\), are used instead. Hits, which are now ordered with ascending \(\phi_{0}\) values, are accumulated belonging to the same track candidate as long as the \(\phi_{0}\) value of the hit, given in FHIT(NHIT), corresponds to the \(\phi_{0}^{\rm min}\). The search road width is thus equal to the straw diameter (2CONB(2)). The average \(\phi_{0}\) value is updated and stored in the variable FMHIT(NHIT) together with the slope value: FMHIT(NHIT) = \(<\phi_{0}>+10\). NC, where NC=slope number. The number of hits belonging to the track candidate is stored in KHT(NHIT). Each hit can initiate a search road. The number of hits belonging to the track candidate must exceed a limit defined in ICONB(6).

In the second phase, a track fit is performed starting from the found track candidates. The drift-time information is used at this phase. The track fit is steered by the subroutine T2FTRK. The subroutine T2SORT is first called to sort track candidates according to the number of hits. For each track candidate, the subroutine T2FILT is called to select hits in a wide road \(\pm 1.4\) cm = \(\pm(1.2\) cm defined in CONB(14) + 0.2 cm straw radius). For each straw row, hits with \(\phi\)-values within the angular range corresponding to the enlarged track road are assigned to the track candidate. If the \(\phi\)-value of a hit falls within the narrow road \(\pm 0.2\) cm, the hit is counted as 'unique' unless it belongs simultaneously to two or more track roads. The number of 'unique' hits is NH-NJ, where NH is the number of hits within the narrow road \(\pm 0.2\) cm and NJ is the number of hits belonging to more than one track road.

[MISSING_PAGE_EMPTY:11]

coordinates \(x^{\prime}=x/(x^{2}+y^{2})\). The relative weights of the hits are set to 10 for the hits corresponding to the straw boundaries, and 9 for the others.

The subroutine T2STBL prepares the data for the circle fit. The subroutines T2STB0 is called to select the best track for the circle fit. The best track is the track with minimum distance to the circle \((\delta y/\delta x\simeq\delta\phi)\). The hits are sorted according to the \(\delta y/\delta x\) by calling T2SORT. The subroutine T2POLIG is called to obtain the circle parameters.

A parabolic fit is then performed by calling the subroutine T2POLIT. The road width is expanded to \(\pm 2\) cm (defined in CONB(13)). The subroutine performs the fit twice, once with a vertex constraint, and once without. Only the fit results with a vertex constraint are retained.

Returning back to the subroutine T2FTRK, the local track arrays PTRK are filled with track parameters. Subroutine T2RDTR is called to get hit information for each track. In the end of the routine T2FTRK, track quality cuts are made to the tracks:

* NHITS/NSTRAW \(\geq\) CONB(7)
* NTIMEHITS/NHITS \(\geq\) CONB(11)
* \(\chi^{2}\leq\)CONB(12)
* NHITS \(\geq\)ICONB(17)

Steering is then given back to the subroutine T2TRREC Correlations (hits belonging to more than one track) are removed by T2CORL. In order to obtain the track intersection with calorimeters, the subroutine T2KCIRC is called.

Results are stored in the banks T2TF. In the case that more than one track is found, parameters for each track are stored, up to a maximum of T2TF_size. The constant T2TF_size is set to track limit MTRACK=2195. The actual number of tracks found, NTRK, is stored in T2TF_Ntracks. The bank contents are:

* T2TF_ntracks Number of reconstructed tracks (NTRK)
* T2TF_module TRT Module number
* T2TF_sign Sign of the particle charge
* T2TF_lowhit Number of TRT hits above the low energy threshold
* T2TF_highhit Number of TRT hits above the high energy threshold
* T2TF_empty Number of empty straws
* T2TF_unique Number of unique hits
* T2TF_timehit Number of hits within drift-time road (\(\pm 2\cdot\sigma\) within the drift-distance)
* T2TF_pt Estimated \(p_{\rm T}\) of track [GeV/c]
* T2TF_invpterr Error on \(1/p_{\rm T}\) [\(1/\)GeV/c]* T2TF_phierr Error on \(\phi\) [rad]
* T2TF_covptphi Error correlation of \(1/p_{\text{T}}\) and \(\phi\), \(\text{Cov}(1/p_{\text{T}}\), \(\phi)\)
* T2TF_chi2 \(\chi^{2}\) of track fit
* T2TF_phiv \(\phi\) at the primary vertex [rad]
* T2TF_phic \(\phi\) at the calorimeter inner surface [rad]
* T2TF_etamin Minimum value of \(\eta\)
* T2TF_etamax Maximum value of \(\eta\)
* T2TF_minzv Minimum value of \(z\) at the vertex (obsolete, set to -7 cm)
* T2TF_maxzv Maximum value of \(z\) at the vertex (obsolete, set to 7 cm)
* T2TF_minzc Minimum value of \(z\) at the barrel calorimeter inner surface (obsolete, set to 0)
* T2TF_maxzc Maximum value of \(z\) at the barrel calorimeter inner surface (obsolete, set to 0)
* T2TF_minrc Maximum value of \(r\) at the end-cap calorimeter inner surface (obsolete, set to 0)

#### 3.1.4 Histogramming

After feature extraction, the subroutine T2TRHIS(IROI,IRAW,IFEX) is called from T2SUPER via T2ZZHIS for histogramming the results. The arguments are: IROI=RoI number, IRAW=TRT RoI manager bank number, IFEX=extracted feature bank number. The TRT ntuples and histograms are stored in the histogram directory //PAWC/T2TR. The ntuple 5003 gives information per each TRT RoI (an external RoI can define two RoI's in the TRT if the road crosses two TRT parts). The contents of the ntuple are:

* EventNum Event number
* RoiNum RoI number (external RoI)
* ObjType Object type
* nttroi Number of TRT RoI's (per external RoI)
* partnum TRT part of the RoI
* nhits Number of hits in the TRT RoI* phiwidth \(\phi\)-width of the RoI (in units of straws, defined at the outer radius of the TRT)
* zrwidth \(r(z)\)-width of the RoI (in units of straw rows)

The ntuple 5004 gives information per each reconstructed track in the TRT. The contents are:

* EventNum Event number
* TrackNum Track number
* Module TRT module number of the track
* Sign Track sign
* Low Hit Number of low-energy hits
* High Hit Number of high-energy hits
* Empty Number of empty straws in the track road
* TimeHit Number of hits within the correct time window
* Pt Reconstructed \(p_{\mathrm{T}}\) [GeV/c]
* Inv Pt Err Error of \(1/p_{\mathrm{T}}\) [\(1/\)GeV/c]
* PhiErr Error of \(\phi\) [rad]
* ChiSq \(\chi^{2}\) of the track fit
* PhiVtx Reconstructed \(\phi\) at vertex [rad]
* PhiCalo Reconstructed \(\phi\) at the calorimeter surface [rad]
* Eta \(\eta\) of the track (set to the average \(\eta\) of the full module)
* ZVtx Reconstructed \(z\) at vertex (set to 0)
* ZCalo Reconstructed \(z\) at the calorimeter surface (set to zero, relevant for the barrel part)
* RCalo Reconstructed \(r\) at the calorimeter surface (set to zero, relevant for the forward part)

## 4 Results

The performance of the algorithm has been tested with 2000 20 GeV/\(c\) electrons (tape 106494), both without minimum bias events, and with 18 minimum bias events superimposed (tape 106493). Note that the 2000 electrons give 1887 electromagnetic RoI's. Out of these external RoI's, 1543 define one RoI in the TRT, and 344 define two separate RoI's in the TRT. The total number of TRT RoI's is thus 2231. Out of the 1887 e.m. RoI's, 915 define one TRT RoI, or both TRT RoI's, within the TRT barrel rapidity coverage (in 743 cases one RoI in the TRT barrel, and in 172 cases two RoI's in the TRT barrel). The total number of TRT RoI's (barrel) is thus 1087.

The datacards for the job without minimum bias events are listed in Appendix A.1. The datacards for the job with minimum bias events are the same except for the cards defining the background input stream.

The listing from the TRT initialization phase is given in Appendix A.2. An example of a TRT feature extraction listing, when processing one RoI, is given in Appendix A.3, together with the listing from the global level-2 trigger.

The timing results are summarized in Table 1. The results are averaged over all the RoI's within the TRT barrel rapidity coverage. Time for data access is the time needed for manipulating data already in the T2TD banks, and does not include the time to access GEANT hit data. The access time is calculated as the time spent in the subroutine T2FILSTR subtracting the time taken for filling the data buffer T2BUFRE. Filling time is the time taken in T2FILSTR for filling the buffer T2BUFRE representing the straw data. Track search time is the time in T2TRREC needed for the presearch phase. Track fit time is the time taken by T2FTRK. Time for removing correlations is the time taken by T2CORL.

The timing tests were performed on HP735 (the SHIFT-cluster at CERN). While it is unclear how the performance should be compared to the processors foreseen for the level-2 computing in terms of absolute time and code optimization, the timing results give an indication that most of the time is spent in the track fitting part, and in case of problems with the execution time this part should be re-optimized and/or reconsidered. The time needed to access the actual read-out buffer, and data preprocessing, is not considered here.

The time distributions are shown in Fig. 3 (no minimum bias) and Fig. 4 (18 min bias

\begin{table}
\begin{tabular}{|l|c|c|} \hline \hline Processing step & Time (no min bias) [ms] & Time (18 min bias) [ms] \\ \hline Data access & 8 & 14 \\ Fill hit banks & 2 & 20 \\ Track search & 2 & 13 \\ Track fit & 20 & 61 \\ Remove correlations & \(<1\) & \(<1\) \\ \hline \hline \end{tabular}
\end{table}
Table 1: TRT LVL2-code timing test on HP735 for single 20 GeV/\(c\) electrons. The time given is the average time per RoI within the barrel TRT rapidity coverage.

events overlapped).

Basic properties of the found tracks are shown in Figs. 5, 6, 7 and 8. In these figures, the upper row shows the reconstructed tracks in the TRT in case of no pile-up. The lower row shows the same events with 18 minimum bias events overlapped. In both cases, the same algorithm and cuts are used; for the high-luminosity electron trigger, the cuts could be optimized for example by making a cut on the number of high-energy hits. In Fig. 9, the effect of requiring at least 10 high-energy hits is shown.

Figure 3: Timing of TRT LVL2 code for 20 GeV/\(c\) electrons, no minimum bias events overlapped.

Figure 4: Timing of TRT LVL2 code for 20 GeV/\(c\) electrons, 18 minimum bias events overlapped.

Figure 5: \(p_{\rm T}\) distribution of reconstructed tracks. The data consists of 20 \(\rm GeV/c\) electrons. In the upper figure, no minimum bias events are overlapped. In the lower figures, 18 minimum bias events are overlapped to the signal. Note that the lower three figures represent the same distribution with different \(p_{\rm T}\) ranges.

Figure 6: Number of reconstructed tracks and the \(\chi^{2}\) of the reconstructed tracks. The data consists of 20 GeV/\(c\) electrons. In the upper figures, no minimum bias events are overlapped. In the lower figures, 18 minimum bias events are overlapped to the signal.

Figure 7: The total number of hits in the reconstructed tracks, the number of high energy hits in reconstructed tracks, and the number of empty straws (straws which should have been crossed by the reconstructed track but did not give any signal) in the reconstructed tracks. The data consists of 20 GeV/\(c\) electrons. In the upper figures, no minimum bias events are overlapped. In the lower figures, 18 minimum bias events are overlapped to the signal.

Figure 8: The total number of hits, the number of high-energy hits and the number of empty straws over the total number of straws which could have been crossed by the reconstructed track. The data consists of 20 GeV/\(c\) electrons. In the upper figures, no minimum bias events are overlapped. In the lower figures, 18 minimum bias events are overlapped to the signal.

Figure 9: The \(p_{\rm T}\) distribution of reconstructed tracks without any cuts (the left-most figures), and after requiring at least 10 high-energy hits (the middle figures). The right-most figures show the distribution of the number of reconstructed tracks after the cut on the number of high-energy hits. The data consists of 20 GeV/\(c\) electrons. In the upper figures, no minimum bias events are overlapped. In the lower figures, 18 minimum bias events are overlapped to the signal. In the figures which include minimum bias events, there is an additional cut \(p_{\rm T}\)\(<\) 200 GeV/\(c\) in order to show better the \(p_{\rm T}\) distribution in the low-momentum range.

## 5 Future developments

The future work consists of:

* Implementation of track trigger in the end-cap TRT
* Implementation of a more realistic data presentation (read-out buffers, RoB) and data preprocessing
* Use of DICE95, new geometry
* Testing and optimizing the code
* Use of standard software for input (data cards or equivalent), description of variables (DDL), documentation, and overall code "cleaning"
* Integration of low and high-luminosity TRT algorithms

## References

* [1] M. Smizanska, 'Second Level TRT Trigger for B Physics', ATLAS Inter DAQ note in preparation.
* [2] ATLAS Coll., 'ATLAS Technical Proposal', CERN/LHCC/94-43, LHCC/P2, 15 December 1994.
* [3] R. Bock and P. LeDu, 'Detector and readout specifications for the level-2 trigger', ATLAS Internal DAQ note in preparation.
* [4] I. Gavrilenko, 'Pattern recognition in TRD/Tracker (TRD/T)', Atlas Internal Note INDET-NO-016, 21 October 1992.