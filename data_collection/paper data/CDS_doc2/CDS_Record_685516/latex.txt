Network Performance Investigation for the ATLAS Trigger/DAQ

S. Stancu, Ch. Haeberli, M. Ciobotaru, M.J. LeVine, R. Beuran, C. Meirosu, R.W. Dobinson, B. Martin, E. Knezo, M. Zurek, H.-P. Beck, on behalf of the ATLAS Data Collection GroupPrincipal features of ATLAS TDAO

* 100 Mbit and GBE
* 1628 data sources (ROBs)
* Several hundred L2PUs
* \(\sim\)80 SFIs (Event Builders)

Using ROB emulators

No final version of ROBs exist

Need to create \(\sim\)10% model of system

Must be able to test the Data Collection

software

- Help to locate performance problems

- Help to decide between message scenarios

Keeps track of missing messages

PC emulators

- Too expensive 

## FPGA ROB emulator

* Mission redefined to emulate ATLAS ROBs
* Programmed in Handel-C
- Host connection via parallel port
* Raw ethernet
* Fully compliant with DC message passing & event format
* Flow control, VLAN, aliasing
* Single frame responses only
* 128 ports constructed

[MISSING_PAGE_EMPTY:21]

[MISSING_PAGE_FAIL:28]

MAC address table size:

the measurement

Alteon sends up to 4096 requests w/ different MAC addresses to switch

2nd Alteon responds using destination address on request as source MAC address in response

3rd Alteon snoops switch to detect flooding

For a given pattern of addresses, determine the max # addresses before flooding occursMeasurement results
* The MAC address table (FDB = Forwarding database) contains the correspondence between the MAC addresses and the switch's ports. In order to avoid flooding, the size of the MAC address table must be large enough to accommodate all the MAC addresses from the DataCollection network.
* Results of tests performed on one specific switch model

MAC address pattern **What** **FDB size**

00:00:1a:35:xx:xx

ROBs =4096

00:1a:35:xx:xx:00

ROBs 70

00:00:xx:xx:1a:35

ROBs 80

00:1a:35:yy:yy:yy, 0:00:1a:35:xx:xx

PCs, ROBs = 4096

* (xx stands for linear generation, yy stands for random generation).

These switches have the MAC address table optimized for addresses from a real LAN: manufacturer code (first 4 bytes) and random lower 2 bytes.

# Event Building System Test Running multiple SFIs against FPGA _or_ ALTEON emulators
* Running n SFIs against 1600 data sources
* Looking for interference effects
* Exploring the limits of trunking
* Exploring the limits of the emulators

M.J. LeVine BNL/CERN* Staging factor means #ROB/ROS
* The event size is constant (2.2 MB).
* CPUs not fully loaded anymore
* 34% performance gain due to staging

M.J. LeVine BNL /CERNFuture plans
* [10] Emulators are being used in 10% system test
* Dual GBE PCI card
- Much larger FPGA than current FPGA emulator
- Large onboard memories
- Will support UDP, multiple frames
- 96 channels will be constructed

## Summary

* Hardware ROB emulators have been used in ATLAS network studies
* Many details of switch behavior have been learned
* Not sufficient time to present studies for VLAN, flow control
* Optimal software configurations have evolved from early system tests with emulators
* Being used to implement 10% scale test bed
* Event building system tests show encouraging results