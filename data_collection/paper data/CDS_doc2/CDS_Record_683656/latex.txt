## 1 ATLAS Internal Note

**DAQ-Note 106**

Version 1.11

June 12, 1998

## 2 Architecture C Performance from Paper Models

A. Amadon, J. Bystricky, D. Calvet, R. Hubbard, M. Huet, P. Le Du, I. Mandjavidze

_CEA/Saclay-DAPNIA, 91191 Gif-sur-Yvette Cedex, France_

M. Abolins

_Michigan State University, East Lansing, MI 48824-1321, USA_

## 3 Introduction

Paper models of the ATLAS Trigger/DAQ system were developed to provide a quick assessment of different LVL2 trigger strategies and architectures. The first paper model [1] was based on hand calculations and evaluated the performance of the single-farm architecture (Architecture C), including a brief comparison with the local/global option in Architecture B. The method was extended to cover Architecture B and put into EXCEL form by S. George and J. Vermeulen [2].

A new spreadsheet model of Architecture C has now been implemented, as an extension of the EXCEL version written by J. Vermeulen. This Architecture C model assumes that :

* for each event, the Feature Extraction and Global algorithms are processed in sequence in a single processor,
* these processors request RoI data and execute event selection algorithms sequentially,
* the RSI/SFI switch interfaces act as concentrators/dispatchers for data transiting through the network

The LVL2 trigger is more complex at low luminosity than at high luminosity, because B physics algorithms are included in the low-luminosity menu. The present study focuses on the low luminosity conditions.

## 4 Low Luminosity Trigger Menu and RoI rates

Low-luminosity trigger menus taken from DAQ-Note-54 [3] have been used in this study. The LVL2 trigger menu used here includes the b-jet vertex tag and missing-Et algorithms listed as LVL3 items in Ref. [3]. Inclusive event rates and sequential rejection steps are used to calculate the RoI rates in each of the subdetectors. The set of LVL2 acceptance factors used is presented in Table 1 (the acceptance factor is the inverse of the rejection factor). Most factors are cited in Ref. [2], except the values for JET15 confirmation, isolated muons, and b-jet vertex tags.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|} \hline
**LVL2 acceptance factors** & MU & Isol. EM & TAU & JET15 & JET50 \\ \hline Confirm LVL1 RoI & 0.75 & 0.30 & 0.05 & 0.71 & 0.50 \\ \hline... + track match & 0.50 & 0.04 & 0.01 & & \\ \hline... + isolation & 0.05 & & & & \\ \hline b-jet secondary vertex tag & & & & 0.10 \\ \hline \end{tabular}
\end{table}
Table 1: LVL2 trigger acceptance factorsThe tau selection used at LVL1 in Ref. [3] did not include isolation cuts; the TAU acceptance factor for confirmation of the LVL1 RoI used here is small because it includes isolation cuts as well as the normal LVL1 confirmation.

Table 2 shows the LVL2 trigger menu used for this study, along with the associated RoI rates. The processing steps are taken from Ref. [1]. As an example, consider the EM20I LVL1 trigger object with a rate of 10 kHz (first line of the second part of the table). The calorimeter components associated with this RoI are processed at the 10 kHz rate with the EM-confirm algorithm. Since 30% of the events survive the calorimeter cuts, TRT and SCT/PIX data are required at a 3 kHz rate to perform the EM track-match algorithm. After the track cuts, only 4% of the initial events remain with a track matching the EM shower, identifying a good electron candidate. The missing-Et (MET) algorithm is performed at this 0.4 kHz rate for these 20 GeV isolated electron candidates.

For B physics purposes, the TRT full scan is performed for every confirmed trigger muon; its rate is thus 4 kHz. After the full scan, an average of 5 track RoIs are selected for further study by the SCT/PIX as potential B decay products; this accounts for the 20 kHz RoI rate labelled "B tracks " in Table 2 ("SCT/PIX", wherever referred to in this note, includes the silicon and pixel precision trackers).

The total LVL1 accept event rate is 38.7 kHz in Table 2. This leaves a safety factor of about 2 with respect to the maximum LVL1 rate of 75-100 kHz. A 1% LVL2 acceptance is assumed.

\begin{table}
\begin{tabular}{|l|c|c|c|c|c c|c c c|c|} \hline
**LVL1 menu item** & \multicolumn{1}{c|}{**Incl. evt rate (Hz)**} & \multicolumn{1}{c|}{**RoI rate (Hz)**} & \multicolumn{1}{c|}{**Comments**} \\ \hline
**Muons** & & mu & TRT & Full & EM & Jet & MET & SCT/ & B & b-jet & \\  & & system & RoI & Scan & (.4x.4) & (.8x.8) & & PIX & tracks & vtx tag & \\ \hline MU6 & 8000 & 8000 & 6000 & 4000 & 4000 & & 6000 & 20000 & & Scan leads to potential \\  & & & & & & & & & & B-decay product tracks \\
2 MU6 & 400 & 400 & 300 & 400 & & 300 & & & \\
3 MU6 & 20 & 20 & 15 & 20 & & & 15 & & \\ MU6 + EM15I & 800 & & 12 & 40 & & & 12 & & Only isolated mu6 \\  & & & & & & & & & & considered \\ MU6 + 2 EM15I & 40 & & 0.6 & 2.0 & & 0.6 & & Same here and below \\ MU6 + 2 J15 & 5674 & & & & 567 & & & 401 & \\ MU6 + 3 J15 & 4024 & & & & 201 & & & 101 & \\ MU6 + 4 J15 & 2854 & & & & 143 & & & 50 & \\ MU6 + 5 J15 & 2024 & & & & 101 & & & 25 & \\ MU6 + 6 J15 & 1435 & & & & 72 & & & 13 & \\ MU20 & 400 & & & & & 20 & & & RoIs included in earlier \\  & & & & & & & & & rates \\ MU20 + EM15I & 40 & & 5.4 & 18 & & & 5.4 & Isolated mu20 already \\  & & & & & & & & & included earlier \\  & & & & & & & & & & included earlier \\ MU20 + TAU40 & 120 & & 3.0 & 60 & & & 3.0 & & \\ MU20 + 1 J15 & 400 & & & & 59 & & & 59 & Consider 1 and only 1 \\  & & & & & & & & & & jet here \\ MU20 + 2 J15 & 283 & & & & 255 & & & 180 & Isolated mu20 already \\  & & & & & & & & & & included earlier \\ MU20 + 3 J15 & 200 & & & & 90 & & & 45 & Same here and below \\ MU20 + 4 J15 & 141 & & & & 64 & & & 22 & \\ MU20 + 5 J15 & 100 & & & & 45 & & & 11 & \\ MU20 + 6 J15 & 71 & & & & 32 & & & 5.6 & \\ MU40 & 50 & & & & & & 25 & & \\ \hline
**Muon trigger** & & **8420** & **6336** & **4000** & **4540** & **1628** & **45** & **26336** & \({}^{\dashv}\) & **913** & \\
**total RoI rate** & & & & & & & & & & \\ \hline \end{tabular}
\end{table}
Table 2: Input trigger menu and associated RoI rates involved in each sub-detector.

Table 3 gives an overview of the RoI rates computed for each subsystem when the total LVL1 trigger rate is 38.7 kHz.

### Input parameters for the LVL2 trigger model

The input parameters of the LVL2 paper model are taken from DAQ-note 70 [2], except when explicitly mentioned below. Table 4 shows the number of ROBs and RSIs per sub-detector. The number of ROBs per RSI is set to one for the hadron calorimeter to avoid an important bottleneck. Figure 1 shows the mapping of the RSIs, SFIs, supervisor, and monitor on the switching network.

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|c|} \cline{2-7} \multicolumn{1}{c|}{} & \multicolumn{1}{c|}{Muon-} & \multicolumn{1}{c|}{muon-} & \multicolumn{1}{c|}{e.m. cal} & \multicolumn{1}{c|}{hadron} & \multicolumn{1}{c|}{SCT/} & \multicolumn{1}{c|}{TRT} & \multicolumn{1}{c|}{Total} \\ \cline{2-7} \multicolumn{1}{c|}{MDT} & \multicolumn{1}{c|}{trig} & \multicolumn{1}{c|}{cal} & \multicolumn{1}{c|}{PIX} & \multicolumn{1}{c|}{} & \multicolumn{1}{c|}{} & \multicolumn{1}{c|}{} \\ \hline Number of ROBs & 192 & 24 & 432 & 48 & 256 & 512 & 1462 \\ \hline Number of ROBs per RSI & 3 & 4 & 4 & 1 & 4 & 2 & \\ \hline Number of RSIs & 64 & 6 & 108 & 48 & 64 & 256 & 546 \\ \hline \end{tabular}
\end{table}
Table 4: Number of ROBs and RSIs per sub-detector

Figure 1: Switching network configuration used in the Architecture C Modelling.

The number of SFIs available for LVL2 and EF processors is 438; this results from subtracting the number of RSI, monitor, supervisor and LVL1 links from the 1024-port total.

For the b-jet vertex tag, we take jet RoIs of 0.8 x 0.8 in \(\eta\),\(\varphi\) space for the SCT/PIX, and find that an average of 10.2 ROBs are 'hit' per jet; this represents 4% of the total number of SCT/PIX ROBs. Moreover, a new LVL2 b-jet vertex tag has now been developed using only pixel data [5]. The execution time for this new algorithm has been measured to be 1 ms [6]. To improve the tracking accuracy, we can extend the tracks identified by the PIX detector into the SCT, and run SCT track algorithms as well for b-tagging. Assuming 20 such tracks show up on average, with an SCT track algorithm taking less than 500 \(\mu\)s, a 10 ms b-tagging algorithm is obtained for the full SCT/PIX detector. This number is used here for the modelling.

In the message processing overhead times, we now make the distinction between I/O overhead and context switching. The I/O overhead applies to both source and destination, but the context switch occurs only when the message is received at the destination. Thus overheads differ for sources (10 \(\mu\)s) and destinations (10 + 40 \(\mu\)s). Exchanges with the RSIs do not induce any context switching in the RSI processors because they are dedicated exclusively to I/O handling. Thus the RSI overhead time is always 10 \(\mu\)s, regardless of whether the message is sent or received.

Data merging was not included in the RSI processing because it is performed via DMA. On the other hand, the RoI data transfer time by DMA between ROBs and RSIs may take longer than the time needed by the RSI processor to receive and respond to requests. In that case the RSI occupancy is totally dependent on the PCI-bus data transfer rate (assumed to be 50 Mbyte/s). For the set of input parameters chosen in the present modelling, it was checked that this actually does not happen.

The transfer of all event data to the Event Filter processors (EF) through the same switching network was included as an option.

This study is intended to explore the levels of occupancy of the various system components rather than the overall decision latency. Longer latencies can easily be compensated by increasing the ROB buffer depth (current studies assume 4 MB ROBs, which would hold roughly 4,000 events, allowing average latencies of up to 40 ms at a 100 kHz rate). Only average occupancies were computed in the paper models. The design goals were set to 60% maximum occupancy for the ROB and RSI processors, and 55% for the network links, because of queuing requirements. The influence of queuing will be studied soon using computer modelling.

### Occupancy results

Occupancies were evaluated for the ROBs and RSIs as well as for the network links. The ROB occupancy takes account of pre-processing time (cf. DAQ-Notes 55 and 70) and I/O overheads. The RSI occupancies come from I/O overheads alone and vary linearly with them. The network link occupancy is the RoI data rate per RSI divided by the allowed link bandwidth.

The occupancy results shown in Table 5 were found assuming the maximum 100 kHz LVL1 rate, 500 MIPS LVL2 processors, and a 15 Mbyte/s network link bandwidth (corresponding to a nominal 155 Mbit/s). The TRT full scan is shown separately from the TRT RoI processing. Occupancies for the calorimeter ROBs and RSIs and for the TRT RSIs (full scan) exceed our 60% design goals; they constitute hot spots in the present modelling. The network occupancies respect the design goals for LVL2 traffic, but the ECAL links exceed the limits when EF traffic is added. Including EF data transfer traffic through the same switching network yields the results shown in Table 6 for a LVL2 accept rate of 1 kHz.

* ROB occupancies presented at the Feb. 98 review were higher because an unnecessary RoI fragment transfer time was included as CPU rather than DMA usage.

** RSI occupancies presented at the Feb. 98 review were higher because an unnecessary context switch was included for messages received from the network.

*** The number of LVL2 processors presented at the Feb. 98 review was much higher because an unnecessary 250 ms was taken for the b-jet vertex tag algorithm (rather than 10 ms).

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|c|c|} \hline  & muon- & muon- & e.m. cal & hadron & SCT/ & TRT & TRT \\  & MDT & trig & & cal & PIX & & scan \\ \hline Data request rate per ROB (kHz) & 1,37 & 3,41 & 6,44 & 11,11 & 2,56 & 1,53 & 10,34 \\ Data rate per ROB (Mbyte/s) & 0,83 & 0,42 & 2,97 & 8,93 & 0,92 & 0,44 & 3,22 \\ Average ROB occupancy* (\%) & 16,8 & 25,4 & 73,2 & 85,1 & 21,8 & 17,5 & 43,6 \\ \hline Data request rate per RSI (kHz) & 1,48 & 5,59 & 8,99 & 11,11 & 6,81 & 1,57 & 10,34 \\ Data rate per RSI (Mbyte/s) & 2,50 & 1,67 & 11,88 & 8,93 & 3,69 & 0,89 & 6,45 \\ Average RSI occupancy** (\%) & 11,2 & 38,5 & 69,5 & 44,5 & 34,1 & 9,2 & 62,0 \\ Switch occupancy per RSI port (\%) & 16,6 & 11,2 & 79,2 & 59,6 & 24,6 & 48,9 & \(\dashv\) \\ \hline \end{tabular} 
\begin{tabular}{|l|l|l|} \hline Total data rate (Mbyte/s) & 3995 \\ \hline Number of SFIs & 438 \\ Total data rate per SFI (Mbyte/s) & 9,12 \\ Switch occupancy per SFI port (\%) & 60,8 \\ Average SFI occupancy (\%) & 91,8 \\ \hline Minimum number of LVL2 processors required*** & 777 \\ Number of LVL2 processors per SFI & 2 \\ Average LVL2 processor occupancy (\%) & 88,7 \\ \hline \end{tabular}
\end{table}
Table 6: Results when EF control and data messages transit through the same network.

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|c|c|} \hline  & muon- & muon- & e.m. cal & hadron & SCT/ & TRT & TRT \\  & MDT & trig & & cal & PIX & & scan \\ \hline RoI request rate per ROB (kHz) & 0,37 & 2,41 & 5,44 & 10,11 & 1,56 & 0,53 & 10,34 \\ RoI data rate per ROB (Mbyte/s) & 0,23 & 0,32 & 1,67 & 8,04 & 0,58 & 0,16 & 3,22 \\ Average ROB occupancy* (\%) & 13,7 & 22,3 & 70,0 & 82,0 & 18,7 & 14,3 & 43,6 \\ \hline RoI request rate per RSI (kHz) & 0,48 & 4,59 & 7,99 & 10,11 & 5,81 & 0,57 & 10,34 \\ RoI data rate per RSI (Mbyte/s) & 0,70 & 1,27 & 6,68 & 8,04 & 2,33 & 0,33 & 6,45 \\ Average RSI occupancy** (\%) & 7,2 & 33,5 & 64,5 & 42,5 & 29,1 & 6,2 & 62,0 \\ \hline Switch occupancy per RSI port (\%) & 4,6 & 8,5 & 44,5 & 53,6 & 15,5 & 2,2 & 43,0 \\ \hline \end{tabular} 
\begin{tabular}{|l|l|l|} \hline Total Rol data rate (Mbyte/s) & 3043 \\ \hline Number of SFIs & 438 \\ RoI data rate per SFI (Mbyte/s) & 6,95 \\ Switch occupancy per SFI port (\%) & 46,3 \\ Average SFI occupancy (\%) & 84,2 \\ \hline Minimum number of LVL2 processors required*** & 777 \\ Number of LVL2 processors required*** & 777 \\ Average RSI occupancy** (\%) & 777 \\ Average RSI occupancy** (\%) & 2 \\ \hline Minimum number of LVL2 processors required*** & 777 \\ Number of LVL2 processors per SFI & 2 \\ Average LVL2 processor occupancy (\%) & 88,7 \\ \hline \end{tabular}
\end{table}
Table 5: Processor and switch port occupancies without EF traffic (scaled to a 100 kHz LVL1 rate).

## Discussion

The results shown in Tables 5 and 6 do not strictly satisfy all of our occupancy requirements. Some modifications of the process model, the system parameters, or the trigger menus are needed. The parameters in DAQ-NO-70 should be updated, in particular in order to take account of present and future advances in technology. It seems reasonable to assume that by the year 2002, the estimated purchase date for the LVL2 processors, 2000 MIPS processors will be available at a unit cost compatible with the T/DAQ costing model. This represents a gain of a factor 4 with respect to the 500 MIPS used to calculate the results given above. Similar gains are to be expected for the other hardware performance parameters.

Optimization of the system performance can take several forms. Each system component should be studied to eliminate bottlenecks and improve robustness and cost-effectiveness. One component with a high occupancy is the calorimeter ROB. The processors in the calorimeter ROBs spend much of their time pre-processing RoI data (performing calibration for all RoIs and Et sums for jet RoIs). This situation can be improved either by increasing the processor speed (from 100 MIPS to 400 MIPS) or by moving the calorimeter pre-processing upstream to the readout drivers (RODs) or down-stream to the LVL2 processors.

Higher-speed switching networks are already on the market. Small ATM units operating at 60 MByte/s (nominal 622 Mbit/s) are available now. Once again, this represents an increase in performance by a factor 4. The availability of large switches with this capability will be a question of cost, rather than technology. Gigap Ethernet, with 1000 Mbit/s links, presents the possibility of a less-expensive alternative for a high-speed network.

The load on the SFIs can be reduced by increasing the speed of the SFI processors and/or by reducing the communications overheads. The 40 us context-switching time assumed above already appears obsolete compared to performances obtained on present-day processors. A projected context-switching time of 10 us would not seem unreasonable.

If fewer SFIs are required, the load on the ECAL RSIs can be reduced without increasing the size of the switching network. Some of the ports released due to the reduction in the number of SFIs can be used to increase (double) the number of ECAL RSIs. Each RSI would then serve 2 ECAL ROBs instead of 4, decreasing the RSI occupancy.

Another way to improve the system performance is the use of special co-processors. FPGA processors are foreseen as an alternative technology that could speed up the TRT full scan. Special data links could be associated with the FPGAs to reduce the load on the TRT RSIs.

Some of the improvements discussed above have been included in a special run using the paper model. The improved parameters are shown in the following list:

* Context switching time : 10 us
* Data transfer in ROBs : 80 Mbyte/s
* SFI merging speed : 80 Mbyte/s
* LVL2 processor speed : 2000 MIPS
* Network link bandwidth : 60 Mbyte/s
* Number of ECAL RSIs : 216 (2 ROBs/RSI)

The results obtained with this high-performance system are shown in Table 7.

## Conclusion

LVL2 system performance at low luminosity has been studied using a simple paper model of the LVL2 system.

Low-luminosity trigger menus including the complex algorithms foreseen for missing-Et recalculation and for b-jet vertex tags were used for these studies. Encouraging results were obtained within the framework of Architecture C using a 1024-port switching network. However, high occupancies are found for the calorimeter and TRT RSIs. On the other hand, a new estimation of the technological progress expected by the year 2002 suggests a gain in computing and networking performance of a factor 4 over our previous estimates. These improvements lead to a reduction in the calorimeter source occupancies to an acceptable level (<50% for a 100 kHz LVL1 rate). This result is obtained even when the Event Filter traffic uses the same RSIs and the same switching network as LVL2. For the TRT, the load remains above 60%, but it can be reduced if special data links are used to transport data to FPGA processors for the TRT full scan. This would in turn further reduce the SFI and LVL2 processor occupancies, to levels below 60%. We conclude that the system design associated with Architecture C should be able to handle the data-transfer and processing needs of LVL2, as well as the data-transfer requirements of the Event Filter (assuming a 1 kHz rate out of LVL2). To confirm these results, implementation of the SFI and LVL2 processor models is foreseen in the near future as part of the SIMDAQ computer model.

## Acknowledgements

We wish to thank greatly J.C.Vermeulen for his Excel paper modelling tool which was used as the basis for this work.

## References

* (1) ATLAS Internal Note DAQ-NO-55, by J.Bystricky et al., "A Model for Sequential Processing in the ATLAS LVL2/LVL3 Trigger", June 96.
* (2)

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|c|c|} \hline  & muon- & muon- & e.m. cal & hadron & SCT/ & TRT & TRT \\  & MDT & trig & & cal & PIX & & scan \\ \hline Data request rate per ROB (kHz) & 1,37 & 3,41 & 6,44 & 11,11 & 2,56 & 1,53 & 10,34 \\ Data rate per ROB (Mbyte/s) & 0,83 & 0,42 & 2,97 & 8,93 & 0,92 & 0,44 & 3,22 \\ Average ROB occupancy (\%) & 16,2 & 21,4 & 37,9 & 47,9 & 19,2 & 16,6 & 26,4 \\ \hline Data request rate per RSI (kHz) & 1,48 & 5,59 & 7,31 & 11,11 & 6,81 & 1,57 & 10,34 \\ Data rate per RSI (Mbyte/s) & 2,50 & 1,67 & 5,94 & 8,93 & 3,69 & 0,89 & 6,45 \\ Average RSI occupancy (\%) & 11,2 & 38,5 & 40,4 & 44,5 & 34,1 & 9,2 & 62,0 \\ \hline Switch occupancy per RSI port (\%) & 4,2 & 2,8 & 9,9 & 14,9 & 6,1 & 12,2 & \(\cdot^{1}\) \\ \hline \end{tabular} 
\begin{tabular}{|l|c|} \hline Total data rate (Mbyte/s) & 3995 \\ \hline Number of SFIs & 330 \\ Total data rate per SFI (Mbyte/s) & 12,1 \\ Switch occupancy per SFI port (\%) & 20,2 \\ Average SFI occupancy (\%) & 68,2 \\ \hline Minimum number of LVL2 processors required & 200 \\ Number of LVL2 processors per SFI & 1 \\ Average LVL2 processor occupancy (\%) & 60,6 \\ \hline \end{tabular}
\end{table}
Table 7: Results from enhanced hardware (with EF traffic).