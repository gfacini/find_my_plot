# A program to calculate the ATLAS magnetic field

T.Nikitina

**Universite de Franche Comte, Besancon, France**

F.Bergsma

**CERN, Geneva, Switzerland**

###### Abstract

A program to calculate the magnetic field of the ATLAS-detector was written. Two models are presented. One with all coils active and a high density mesh which, due to the application of symmetry, covers only 1/16 of total space. This model offers high precision magnetic field reconstruction. The influence of girder and tile calorimeter on the magnetic field can be studied in detail, field maps are available.

Another model is discussed with one or one half barrel toroid coil missing, in order to study field deterioration and forces in case of a broken coil. This model has a mesh which covers 1/2 of total space and is less dense than that of the first model.

Maximum force on the girder and tile calorimeter in case of one missing toroid coil is about 1500 kN with the muon spectrometer almost blind in 60 degrees of azimuth angle. Field maps are available.

Future extensions are discussed.

## 1 Introduction

Using programs like TOSCA [9] or ANSYS [10] to calculate the magnetic field of the ATLAS-detector, a need for more facilities was felt, see for example [6].

An adequate model of the tile calorimeter needs the possibility of non-zero off-diagonal components in the permeability tensor, accessible on an element by element base (see Appendix II).

One wants to estimate the error. To keep the error below a certain level and to obtain a compact model the mesh should be adapted to the field. To make this possible in an iterative process access to the solver and intermediate solutions are necessary.

For fast track reconstruction access to the shape-functions is needed.

It would be advantageous to include in the calculation the results of the fixed B-monitors.

To calculate the effect of relative small objects, not too close to the bulk of the iron, it would be interesting to be able to use the solution of one problem as driving field for the second. In this case only a small mesh around the particular object would be necessary, and, if the influence on the bulk iron would not be negligible, iterations could be made.

Above points are only realizable if one has, at least partial, access to the source code of the program. Since this is impossible with commercial programs it was decided to write an in-house program for the ATLAS-detector.

In order to keep the amount of work limited, no attempt was made to write a general purpose field reconstruction program. The current program is suited to the ATLAS-geometry and will be indicated by ATLM.

## 2 Fem Model of Atlas

All figures in this report are made with MATLAB [8].

The figure on the front page shows the main magnetizing and magnetizable components of the ATLAS-detector: solenoid, barrel toroid, forward toroids, girder and tile-calorimeter.

It is assumed that the beam-axes coincides with the z-axes, the x-axes is horizontal and the y-axes vertical. The origin is in the centre of the detector. When cylinder-coordinates are used \(\mathrm{r}=\sqrt{\mathrm{x}^{2}+\mathrm{y}^{2}}\), \(\mathrm{\phi}=\mathrm{angle}\) of \(\mathrm{r}\) with positive x-axes, z=z.

One can see that every rotation of 45 degrees around the beam-axes maps the detector onto itself, with conservation of current and field direction. This makes it possible to mesh only \(1/8^{\mathrm{th}}\) of the total space. A rotation of 180 deg. around an axes through the center of the detector, perpendicular to the beam-axes and making an angle of n x 22.5 deg. with the x-axes, maps the detector also back onto itself, but with current and field directions inverted. This makes it possible to reduce the mesh further to \(1/16^{\mathrm{th}}\) of total space using negative symmetry.

If the current of a barrel toroid coil is different from that of the others, the \(1/8^{\mathrm{th}}\) reduction is not possible. The second reduction is still possible if the axes of rotation hits the deviating toroid coil.

### mesh and materials

With the method used here in the air regions only the field generated by the polarized iron has to be reproduced by the elements. For this reason the mesh becomes less dense when getting away from the iron. The coil contribution in the air regions is directly calculated by the Biot and Savart law.

In fig. 1 the mesh in the x,y-plane and y,z-plane are shown in case of 1/16\({}^{\text{th}}\) symmetry.

It is build from non regular hexahedrons (8 nodes) and prisms (6 nodes). The holes in the girder in between the two tilecal segments ('fingers') are also modelled but not visible in the figures. This model has about 64000 nodes.

In fig. 2 the mesh in the x,y-plane and y,z-plane are shown in case of 1/2 symmetry.

It is build from non regular hexahedrons only. Girder and 'fingers' are not modelled in detail but homogenized, as described below, in order to reduce the amount of nodes. The model is turned by 22.5 degrees over the z-axes compared with the real detector and has about 30000 nodes.

For all solid iron components the \(\mu\)-H table of fig. 3 was used.

This curve was derived from measurements done on samples of tilecal iron [7] and interpolation with the help of B-splines. As soon as more data on permeabilities are available, they will be used.

### girder

The lower part of the girder does not form a closed loop in the \(\phi\)-direction, but has 64 air-gaps of 21 mm, regularly spaced in \(\phi\). These gaps were taken into account by introducing a lamination factor of 0.942 in the \(\phi\)-direction, see appendix I.

As an alternative to the discrete meshing of the connection plates and tubes between upper and lower layers of the girder ('spokes' ) shown in fig. 1, also here a lamination factor in the \(\phi\)-direction was introduced, conserving the regular mesh. The differences in the two approaches are compared in section 5.2.

The same technique was used with the 'fingers', introducing locally also a lamination factor in the upper part of the girder.

Even though the use of a lamination factor gives only an average field, it is always possible to derive from this the local field in iron or air ( see appendix I). The used lamination factors are listed in table 1.

### tile calorimeter

The tile calorimeter was not meshed in detail but emulated with the help of lamination factors in z and \(\phi\)-direction, as explained in appendix I. Better would be to apply an homogenization according to appendix II, which is planned for the future.

The z factors are taken from [7] section 4. The tile calorimeter is composed of 64 segments in the \(\phi\)-direction. For the \(\phi\)-lamination factors an air gap of 1.5 mm was assumed between two adjacent segments. The effect of this air gap is discussed in section 6.1. The \(\mu\)-H curve of fig.3 was used. The lamination factors are given in table 1.

### 2.4 coils

All coil fields were calculated with TOSCA [9]. The TOSCA conductor file is given in appendix III. The current x turns product in a barrel toroid coil was 2.46 MA, in an endcap coil 2.32 MA and in the solenoid 9.30 MA.

## 3 Solver

The magnetic field was calculated with the help of a two-valued scalar potential as described in [1] and used in TOSCA [9]. In the regions with currents a'reduced' scalar potential is used, the divergence of which gives the magnetic field caused by magnetized material only. In permeable regions a 'total' scalar potential was used, the divergence of which gives the magnetic field caused by both magnetized material and currents. The use of the reduced scalar potential is necessary to guarantee everywhere \(\nabla\!\times\!\!{\rm H}\ =\ \nabla\!\times\!\nabla\Phi\equiv 0\). The total scalar potential is used to avoid cancellation errors due to the occurrence of high magnitude and opposite sign of the coil and material field.

The total potential area was contained between the surface formed by the outer part of the girder and the inner part of the itecal, plus the remaining part of the iron shielding plate.

With this choice the method used here is very similar to the DSP-solver of ANSYS [10]. The continuity corrections described below are here calculated directly from the coil fields and not found by an intermediate solution with all permeabilities set to a very high value, as in the case of the DSP-method. Because of this intermediate solution the DSP-method is in principle less precise.

Galerkin weighting was used to form a symmetric set of linear equations.The non regular elements were transformed by isoparametric mapping [2].

On the boundary between total and reduced potential regions continuity corrections to

\begin{table}
\begin{tabular}{|c|c|c|} \hline
**material** & \(\mathbf{f_{\phi}}\) & \(\mathbf{f_{z}}\) \\ \hline tile 1 & 0.993 & 0.956 \\ \hline tile 2 & 0.994 & 0.947 \\ \hline tile 3 & 0.995 & 0.941 \\ \hline tile 4 & 0.996 & 0.930 \\ \hline lmn 1 & 0.996 & 0.990 \\ \hline girder in & 0.942 & 1.0 \\ \hline spokes & 0.177 & 1.0 \\ \hline fingers inside & 0.653 & 1.0 \\ \hline fingers outside & 0.609 & 1.0 \\ \hline \end{tabular}
\end{table}
Table 1: Used lamination factorsthe right hand side of the system equations are necessary. They are composed of line integrals of the tangential component of the coil field and surface integrals of its normal component. As approximation for these integrals 1-point and 4-point gaussian quadrature formulas were used respectively. For the volume integrals in the left hand side of the system equations 8-point and 6-point gaussian quadrature formulas were used for hexahedrons and prisms respectively (see [2]).

The x,y-plane at z=0 got negative symmetry boundary conditions, the symmetry axes were set to zero. The model with 1/16\({}^{\rm th}\) of space meshed got positive symmetry conditions on the \(\phi\),z-planes at \(\phi=90\) and 45 degrees. The r,z-plane at r=15 m and the x,y-plane at z=-15 m got \(\frac{\rm d\Phi}{\rm dn}=0\).

The system equations were solved directly by the Cholesky method for positive definite band matrices. To find the right permeability for non-linear materials, iterations were made on the \(\mu\)-H curve with appropriate relaxation factors.

For a model with 64000 nodes and bandwidth of 1000 each iteration took about 15 minutes on a 500 Mhz Pentium III with 256 MB RAM.

## 4 Postprocessor

A separate program to analyze the solution was written. Main part is a routine which calculates the field value for a given point. Since this program is dedicated to the ATLAS-geometry it is fast. E.g. the element in which the point resides is quickly found. The field values can be smoothed by nodal averaging. At every node the field is calculated in the surrounding elements and averaged, weighted by the solid angle in each element. If the elements around the nodes consist of different materials, an average is stored for each of them.

Forces and torques on an object are calculated by integration of the contracted max-well stress tensor with the normal vector on a surface surrounding the object [5].

\[\rm F_{i}\,=\,\int\limits_{S}\!\!\left(B_{i}(H\cdot n)-\frac{1}{2\mu}(B\cdot B )n_{i}\right)dS\]

For the integration a 4-points gauss quadrature formula [2] was used.

## 5 Checks

### comparison with TOSCA

As a check on the reliability of the code a comparison was made with the commercial program TOSCA [9], using the same mesh and tilecal approximation. In fig.4 field values for the 1/16 model with discrete fingers and spokes are shown. The results of ATLM are indicated with a blue dashed line, that of TOSCA with a red dotted line. In fig.4a the value of \(\sqrt{B_{x}^{2}+B_{y}^{2}}\) as a function of azimuth-angle is compared at the centre of the upper girder layer (r=4.18 m) at z=0. One sees perfect agreement. The peaksin this figure are caused by the spokes of the girder.

In fig.4b the z-component of B is compared at the same place. One sees a small but non-negligible difference of about 2.5%. This difference will be investigated in future and is probably caused by a different number of gauss-points in the line-integrals described in section 3.

In fig.4d the value of \(\rm{B_{z}}\) is given as function of z at r=4.18m and \(\rm{\phi}\)=90 deg. The same difference as in fig.4b is observed.

In fig.4c the value of \(\rm{\sqrt{B_{x}^{2}+B_{y}^{2}}}\) as function of azimuth-angle is compared at r=4.5m and z=0, approximately the place of the first muon station. Only the contribution from the iron is given. One sees agreement within 2.5 mT.

In fig.5 field values for the 1/2 model are shown with one missing toroid coil. In fig.5a the value of \(\rm{\sqrt{B_{x}^{2}+B_{y}^{2}}}\) as function of \(\rm{\phi}\) is compared at r=4.18m and z=0. In fig.5c one sees the same plot for r=4.5 m (only iron contribution). In fig.5b the \(\rm{B_{z}}\) components are compared at r=4.18 m and z=0. In fig.5d the value of \(\rm{B_{z}}\) is given as function of z at r=4.18m and \(\rm{\phi}\)=90 deg. The agreement is good, except for a small difference in \(\rm{B_{z}}\), to be investigated.

[MISSING_PAGE_EMPTY:8]

### 5.2 check on girder homogenization

To check if the in section 2.2 described homogenization of the girder is allowed, two models with 1/16 symmetry were compared. One had discrete spokes, in the other the spoke/air region was replaced by laminated iron with lamination factor of 0.177 (see appendix I) and laminations in the \(\phi\)-direction.

In fig.6a and 6c one sees the values of \(\sqrt{\text{B}_{\text{x}}^{2}+\text{B}_{\text{y}}^{2}}\) as function of \(\phi\) at z=0 for r=4.18 m ( upper part girder ) and r=4.5 m (first muon station) respectively. The result with homogenized spokes is indicated with a blue continuous line, that of the discrete model with a red dotted line. In fig.6b the B\({}_{\text{z}}\)-component is given as function of \(\phi\) at r=4.18m and z=0. The difference between the two models is smaller than the error caused by the finite dimension of the mesh. With this method a complicated structure, consisting of a tube and welded subsections can be parametrized by one BH-curve and a lamination factor, which makes the adaptation of the calculations to the measurements easier.

## 6 Results

The results of the program are ready to be used for track reconstruction, to calculate forces, stray fields, etc.

### model 1/16

In the figures of this section the coil field is not added for the reduced potential areas, see section 3.

In fig.7 the value of \(\sqrt{\text{B}_{\text{x}}^{2}+\text{B}_{\text{y}}^{2}}\) is given in the tile-calorimeter and girder for the 1/16 model at z=0. Fig.7a shows the result for the case that the tile modules are continuous in the \(\phi\)-direction. Fig.7b gives the result if one assumes a 1.5 mm wide gap between two adjacent tile-segments. In the latter case the field from the barrel toroid coils penetrates much deeper into the tile calorimeter. The 1.5 mm gap has been implemented by introducing a second lamination factor in the \(\phi\)-direction as described in section 2.3. This is not possible with existing commercial software [9, 10]. In fig.7c one sees the field at z=-1 m, in fig.7d at z=-2 m, both with 1.5 mm gap in the \(\phi\)-direction. The asymmetry is caused by the interference of barrel toroid and solenoid.

In fig.8 the absolute value of the field is given in the r,z-plane, fig.8a for \(\phi\)=56.25 deg., fig.8b for \(\phi\)= 78.75 deg. In both cases the 1.5 mm gap between the tile segments was present. Again the asymmetry is caused by the interference of barrel toroid and solenoid.

From figure 7 and 8 one can see that the field inside the tile calorimeter fluctuates heavily from one place to another, amplified by the air gaps between the tile segments,which cannot be reduced to zero. With the program here presented it is possible to investigate wether this has an influence on the track matching from inner region to muon spectrometer.

Another point to investigate is if the field inside the tile calorimeter has an influence on its energy resolution. The field inside the tiles can reach locally very high values, see [7], which could trap secondaries inside the iron.

In fig.9 the absolute value of the field in the inner tracker region is given in the y,zplane. Only the contribution from the polarized iron is shown. The iron contributes up to about 4.5 % of the total field. This contribution will depend on the permeability of the tile calorimeter.

### model 1/2

#### 6.2.1 field

In fig.10 the value of \(\sqrt{\mbox{B}_{\rm x}^{\ 2}+\mbox{B}_{\rm y}^{\ 2}}\) is given in the x,y-plane at z=0 for a, b and c and z=-1.5 m for d. In all cases a 1.5mm gap between the tile segments is assumed. In fig10.a, b and c the coil fields are added. The barrel and endcap toroid are rotated over the z-axes by an angle of 45/2 deg. with respect to the ATLAS configuration.

In fig.10a all barrel toroid coils are active, in fig.10b the coil at -90 degrees has only half of its normal current and in fig.10 c and d it has no current.

As one can see the field in the spectrometer region changes drastically and the deterioration of momentum resolution can be studied. In case of no current in one coil the spectrometer is probably blind in a region of 60 deg. in azimuth angle. In fig.10d at z=-1.5 the asymmetry of the field with respect to the y,z-plane can be clearly seen.

Here only the contribution from the iron is given.

As one can see from fig.10 the field inside the tile calorimeter, just above the deviating coil, increases disproportional with the decrease in current of that coil.

#### 6.2.2 forces

To make an estimate of the force and torque on the girder and tile calorimeter caused by the toroids, several cases have been tried of which the results can be seen in table 2.

The force given in table 2 is in the direction of the deviating coil.

The forces on girder, tile calorimeter and shielding plate were calculated by integrating the contracted maxwell stress tensor with the normal vector over a surface surrounding them (see section 4).

As integration surface was chosen the sum of the outer surfaces of the elements in the first layer outside the iron. It represents approximately the surface of a cylinder around the tilecal with R=4.4 m and Z=0 to -7.63 m and a distance of 0.17 m to the iron.

As a check the stress integration was also done on the iron surfaces, approximately the surface of a cylinder around the tilecal with R=4.23 m and Z=0 to -7.63 m. The results are given in the table 2 with notation 'R=4.23'.

\begin{table}
\begin{tabular}{|l|c|} \hline \multicolumn{1}{|c|}{**model**} & \multicolumn{1}{|c|}{**force [ kN ]**} \\ \hline
**With all coils** & & \\ ATL (2.1f.) & 0.7 & \\ \hline
**With 7 coils on** & & \\ ATL (1.1f.) & -1503.8 & \\ \hline ATL (2.1f.) & -1476.1 & \\ \hline ATL (2.1f., no solenoid) & -1480.4 & \\ \hline ATL (2.1f., no solenoid, refined) & -1488.9 & \\ \hline ATL (2.1f., no solenoid) & -1370.7 & \\ \hline ATL (2.1f., no solenoid, R=4.23) & -1294.4 & \\ \hline TOSCA & -1562.4 & \\ \hline TOSCA (refined) & -1417.1 & \\ \hline TOSCA (no solenoid) & -1557.6 & \\ \hline \end{tabular}
\end{table}
Table 2: Forces on girder and tile calorimeter caused by the toroid coilsIn this table lines starting with ATLM give the result of the model with 1/2 of total space meshed as explained in section 2. Lines starting with TOSCA give the result of [6], using the same mesh as ATLM.

The influence of the solenoid field on the force is small. Without solenoid it is possible to mesh only 1/4 of the total space, using reflection symmetry in the y,z-plane. The model marked ATLM 1/4 in table 2 has no solenoid and twice the amount of nodes in the \(\phi\)-direction. To see the effect of the missing solenoid also the force in the 1/2 model has been calculated for this case.

The predicate "refined" in table 2 refers to the case in which two more layers of elements are added in the region of the integration surface ( two in r-direction and two in z-direction).

In case of TOSCA "refined" means four subdivisions added in r-direction, eight in z-direction and double (128) the amount of subdivisions in the \(\phi\)-direction.

Further, "1 l.f." refers to the approximation of the tilecal using one lamination factor and "2 l.f." refers to the approximation of the tilecal using 2 different lamination factors in z- and \(\phi\)-direction, ATLM only ( see section 2.3 ).

From table 2 we claim a force on the girder/tilecal in the direction of the deviating coil of -650 +/- 200 kN for half current and +1500 +/- 150 kN for zero current. A remarkable fact is the change of sign of the force. This change of sign has also been seen if one calculates the forces on the coils by integrating J x B\({}_{\rm Fe}\). The precision of the latter result is lower than that of the Maxwell-stress integration due to the coarser mesh around the coils (see section 2.1).

The change of sign of the force is caused by the disproportional increase of magnetic flux which passes through the tilecal with respect to the decrease of current in the deviating coil, as can be seen in fig.10.

From table 3 we claim a torque in the y-direction of -50 +/- 10 kNm for half current and -95 +/- 10 kNm for zero current.

\begin{table}
\begin{tabular}{|l|c|} \hline
**With 7.5 coils** & \\ ATLM (1 l.f.) & 550.0 \\ \hline ATLM (2 l.f.) & 555.0 \\ \hline ATLM (2 l.f., no solenoid, refined) & 590.6 \\ \hline ATLM (2 l.f.,no solenoid,ref.,R=4.23) & 475.2 \\ \hline ATLM (2 l.f., no solenoid) & 667.0 \\ \hline ATLM (2 l.f., no solenoid, refined) & 677.5 \\ \hline ATLM (2 l.f.,no solenoid,ref.,R=4.23) & 508.4 \\ \hline TOSCA & 589.0 \\ \hline TOSCA (refined) & 781.2 \\ \hline TOSCA (no solenoid) & 573.3 \\ \hline \end{tabular}
\end{table}
Table 2: Forces on girder and tile calorimeter caused by the toroid coils

## 7 Next

Work will continue on the optimization of the model ( better solver, homogenization, adaptive mesh ) and on the preparation of the model and the solver for different uses (tracking, B-monitors, influence of inserted small objects).

### work in progress

To be able to solve the problem with much more nodes in a limited period of time a new solver using a fast iterative method is in preparation. The existing solver uses the direct Cholesky method for positive definite band matrices to solve the system of equations in each iteration. The new solver will use a conjugate gradient method with preconditioning. More economic storage of only non-zero elements for sparse band matrices will be included.

Another point being developed is tileal homogenization according to appendix II.

### to be done

Error estimation and the analysis of different tileal approximations must be carried out. It would allow to build an optimal mesh adapted to the field. Two ways will be studied. Local refinement of the mesh if the error is too big or to find the optimal position for a fixed number of nodes by changing their position during solving. Mixing of both methods is also possible.

A correction of the calculated field using results from the B-monitors and other measurements will be implemented. Simple but efficient parametrization of girder and tile calorimeter permit easy tuning to the measurements.

As discussed in paragraph 5.1 the influence of the number of Gauss points for line and surfaces integrals will be investigated.

\begin{table}
\begin{tabular}{|l|c|} \hline \multicolumn{1}{|c|}{**model**} & \multicolumn{1}{c|}{**torque [kNm]**} \\ \hline
**With 7 coils on** & \\ ATLM (1 l.f.) & -90.6 \\ \hline ATLM (2 l.f.) & -106.5 \\ \hline TOSCA & -83.6 \\ \hline
**With 7.5 coils on** & \\ ATLM (1 l.f.) & -53.8 \\ \hline ATLM (2 l.f.) & -57.4 \\ \hline TOSCA & -47.5 \\ \hline \end{tabular}
\end{table}
Table 3: Torque in y-direction on girder and tileal caused by the toroids

## 8 Conclusions

The program in its current state is able to reproduce the magnetic field of the ATLAS detector for all design purposes. For momentum reconstruction in the real data analysis more precision is needed, which will be accomplished by applying homogenization theory on the tileal permeability, adaptation of the mesh to reduce discretization errors and integration of measurements.

The program is particularly suited to study the influence of the field in the tile calorimeter on the track matching between inner tracker and muon spectrometer.

Also deterioration of the energy resolution of the tile calorimeter due to trapping can be investigated.

The influence of magnetized iron in girder and tile calorimeter on the field in the inner tracker, about 5 % of the total, can be calculated.

The extra forces on the girder and tile calorimeter in case of a missing toroid coil or pancake seem to be relatively small compared to the forces during normal operation. A continuation of data taking in case a coil malfunctioning occurs appears feasible, though less efficient because of decreased momentum resolution of the muon spectrometer.

This decrease can be studied in detail with the here described program.

## Appendix I

### Approximation of the Tile Calorimeter using Laminated Materials

**1 formulas for the permeability tensor in case of uni-directional lamination**

For the component of the magnetic induction perpendicular to the laminations and the component of the magnetic field parallel to the laminations one has

\[\mathrm{B}_{\perp}\,=\,\mathrm{B}_{\mathrm{Fe\perp}}\,=\,\mathrm{B}_{\mathrm{ Air\perp}}\qquad\mathrm{H}_{//}\,=\,\mathrm{H}_{\mathrm{Fe\//}}\,=\,\mathrm{H}_{ \mathrm{Air\//}}\]

and

\[\mathrm{H}_{\perp}\,=\,\mathrm{f}\cdot\mathrm{H}_{\mathrm{Fe\perp}}+(1-\mathrm{ f})\cdot\mathrm{H}_{\mathrm{Air\perp}}\,=\,\mathrm{f}\cdot\mathrm{H}_{\mathrm{Fe\perp}}+(1- \mathrm{f})\cdot\mathrm{H}_{\mathrm{Fe\perp}}\cdot\frac{\mu_{\mathrm{Fe}}}{ \mu_{0}}\]

\[\mathrm{B}_{//}\,=\,\mathrm{f}\cdot\mathrm{B}_{\mathrm{Fe\//}}+(1-\mathrm{f}) \cdot\mathrm{B}_{\mathrm{Air\//}}\]

where f is the lamination factor, equal to the ratio of length of iron over total length. When the laminated material is replaced by homogeneous anisotropic material, for the homogeneous permeability tensor the following formulas are used ( see also [1] ):

\[\mu\,=\,\begin{bmatrix}\mu_{\perp}&0\\ 0&\mu_{//}\end{bmatrix}\qquad\mu_{\perp}\,=\,\frac{\mathrm{B}_{\perp}}{\mathrm{H }_{\perp}}\,=\,\frac{\mu_{0}\cdot\mu_{\mathrm{Fe}}}{\mathrm{f}\mu_{0}+(1- \mathrm{f})\cdot\mu_{\mathrm{Fe}}}\qquad\mu_{//}\,=\,\mathrm{f}\cdot\mu_{ \mathrm{Fe}}+(1-\mathrm{f})\cdot\mu_{0}\]

**2 formulas for the permeability tensor in case of two orthogonal laminations**

Let \(\phi\) and z be the directions of lamination, (r, \(\phi\), z) are cylinder coordinates.

From the uni-directional case given above the followings formulas for the homogeneous permeability tensor were developed:

\[\mu_{\mathrm{r}}\,=\,\mu_{\mathrm{Fe}}\cdot\mathrm{f}_{\phi}\cdot\mathrm{f}_{ \mathrm{z}}+(1-\mathrm{f}_{\phi}\cdot\mathrm{f}_{\mathrm{z}})\cdot\mu_{0}\]

\[\mu\,=\,\begin{bmatrix}\mu_{\mathrm{r}}&0&0\\ 0&\mu_{\phi}&0\\ 0&0&\mu_{\mathrm{z}}\end{bmatrix}\qquad\mu_{\phi}\,=\,\mathrm{f}_{\mathrm{z}} \cdot\frac{\mu_{0}\cdot\mu_{\mathrm{Fe}}}{\mathrm{f}_{\phi}\cdot\mu_{0}+(1- \mathrm{f}_{\phi})\cdot\mu_{\mathrm{Fe}}}+(1-\mathrm{f}_{\mathrm{z}})\cdot\mu_{0}\]

As can be seen, if one or both of the lamination factors are equal to zero, \(\mu_{\mathrm{r}}\,\mu_{\phi}\) and \(\mu_{\mathrm{z}}\) become equal to \(\mu_{0}\). If one of the lamination factors is equal to 1, the formulas of the uni-directional lamination are obtained.

If both lamination factors are equal to 1, \(\mu_{\mathrm{r}}\), \(\mu_{\phi}\) and \(\mu_{\mathrm{z}}\) become equal to \(\mu_{\mathrm{Fe}}\).

The tensor \(\mu\) is diagonal in ( r, \(\phi\), z ), but will be non-diagonal in ( x, y, z ).

For the macroscopic field one has

\[\mathrm{H_{r}}\,=\,\mathrm{H_{Fer}}\qquad\mathrm{H_{\phi}}\,=\,\mathrm{H_{Fe\phi} }\cdot\mathrm{f_{\phi}}+(1-\mathrm{f_{\phi}})\cdot\mathrm{H_{Air\phi}}\]

\[\mathrm{H_{z}}\,=\,\mathrm{H_{Fez}}\cdot\mathrm{f_{z}}+(1-\mathrm{f_{z}})\cdot \mathrm{H_{Airz}}\]

For the reconstruction of the microscopic field

\[\mathrm{H_{Fe\phi}}\,=\,\frac{\mathrm{H_{\phi}}}{\mathrm{f_{\phi}}+(1-\mathrm{ f_{\phi}})\cdot\frac{\mathrm{\mu_{Fe}}}{\mathrm{\mu_{0}}}}\qquad\mathrm{H_{Fez}}\,=\, \frac{\mathrm{H_{z}}}{\mathrm{f_{z}}+(1-\mathrm{f_{z}})\cdot\frac{\mathrm{\mu_ {Fe}}}{\mathrm{\mu_{0}}}}\]

## Appendix II The homogenization of composite materials with periodical structure

The major difficulty for a numeric simulation of the tile calorimeter is its composite structure. Exact meshing needs too many nodes and is impossible with current computers. The idea is to replace the tilecal by homogeneous anisotropic material. In the present program the tilecal is already emulated in this way using lamination factors (see appendix I).

Using the theory of homogenization will permit a better representation of the tilecal permeability and will give non-diagonal components in the homogeneous permeability tensor.

Since the tilecal has a periodical structure, it can be represented as a set of local cells Y with the same properties. To work with periodical materials in homogenization theory two scales are used :

-macroscopic level, using variable X=(x\({}_{1}\),x\({}_{2}\),x\({}_{3}\)), corresponding to global characteristics of material (equations, comportment law)

-microscopic level, using variable Y=(y\({}_{1}\),y\({}_{2}\),y\({}_{3}\)), corresponding to the heterogeneous properties of materials in local cell Y ( tiles, spacers, glue layers).

Suppose that the dimension of period Y is small compared to the size of the region in which the system will be studied.

Suppose also that the permeabilities \(\mu_{kj}\)(y) are known for each material in the 'local' cell Y.

The idea of homogenization is to prolong the \(\mu_{kj}\)(y) by periodicity on the global space X and to find the corresponding form of the macroscopic problem when the dimension of Y is decreasing to zero. For details of this method see [3].

Using this technique the components of the homogeneous tensor \(M_{k}\) can be obtained in two steps:

1) resolution of the 'local' problem on the cell Y:

find Y-periodic functions of influence \(X^{r}\)(y) in Y=(y\({}_{1}\),y\({}_{2}\),y\({}_{3}\)), r=1,2,3

\[\sum_{k\ =\ 1}^{3}\frac{\partial}{\partial y_{k}}\sum_{j\ =\ 1}^{3}\mu_{kj}(y)\cdot\frac{\partial X^{r}}{ \partial y_{j}}\ =\ \sum_{k\ =\ 1}^{3}\frac{\partial}{\partial y_{k}}\mu_{kr}(y)\]

Functions of influence have no physical sense, they are used for the calculation of the homogeneous tensor. These functions can be found using a finite element method.

2) calculation of the components of the homogeneous tensor \(M_{kj}\) using following formula:\[\mathrm{M_{kj}}\,=\,\frac{1}{|Y|}\cdot\int\limits_{Y}\left[\mu_{kj}(y)-\sum_{l\,=\, 1}^{3}\mu_{kl}(y)\cdot\frac{\partial X^{r}}{\partial y_{1}}\right]dy\]

Once the \(M_{kj}\) are known one can replace the problem by the 'equivalent' homogeneous problem in the global space X:

Find the scalar potential \(\Phi\)_(X)_ in X=(x\({}_{1}\),x\({}_{2}\),x\({}_{3}\)) :

\[\sum_{k\,=\,1}^{3}\frac{\partial}{\partial x_{k}}\sum_{j\,=\,1}^{3} \mathrm{M_{kj}}\frac{\partial\Phi}{\partial x_{j}}\,=\,0\] \[+\mathrm{boundary\ conditions}\]

The solution of the homogeneous problem gives the macroscopic field.

For the 'local' field in the cell Y the following formulas can be used :

\[\mathrm{H_{k}(x,y)}\,=\,\frac{\partial\Phi}{\partial x_{k}}-\frac{\partial}{ \partial y_{k}}\sum_{j\,=\,1}^{3}X^{r}(y)\cdot\frac{\partial\Phi}{\partial x _{j}}\]

\[\mathrm{B_{k}(x,y)}\,=\,\sum_{j\,=\,1}^{3}\frac{\partial\Phi}{\partial x_{j}} \cdot\left(\mu_{kj}(y)-\sum_{l\,=\,1}^{3}\mu_{kl}(y)\cdot\frac{\partial X^{j} }{\partial y_{1}}\right)\]

\[\mathrm{for\ fixed\ values\ of\ x}\]

Since the permeability of iron depends on H also the influence functions \(X^{r}\) will depend on H and have to be found in a separate step.

## Appendix III Tosca Conductor File

$cons #ret 1.-415.e-5

COND

DEFI GSOL

0.0 0.0 0.0 0.0

0.0 0.0 0.0

90.0 90.0 90.0

1.218 2.65 1.218 -2.65

1.24 -2.65 1.24 2.65

0.0 0.0 0.0 0.0

79.75e6 1 0.0

0 0 0

DEFI GRAC

0.0 0.0 0.0 22.5

0.0 7.365*#ret 0.0

0.0 90.0 0.0

0.386*#ret 0.2882*#ret

2.103*#ret -b/2.

11.088*#ret 1.00*#ret

20500.*30*4/(a*b) symm=8, phas=0

0 0 0

0.001

DEFI GRAC

0.0 0.0 0.0 0.0

0.3.1095 -10.33

0.0 90.0 0.0

0.3625 0.218

1.5370 -0.109

1.2125 0.600

29.358e6 8 0.0

-1 0 0

0.001

QUIT

## References

* [1] 'The analytical and numerical solution of electric and magnetic fields' K. J. Binns, P. J. Lawrenson, C. W. Trowbridge John Wiley & Sons, 1994
* [2] 'The finite element method', volume 1 O. C. Zienkiewicz, R. L. Taylor McGraw-Hill Book Company, 1994
* [3] 'Asymptotic analysis for periodic structures' A. Bensoussan, J. L. Lions, G. Papanicolaou North-Holland Publishing Company, 1978
* [4] 'Numerical analysis of symmetric matrices' H. R. Schwarz, H. Rutishauser, E. Stiefel, translated by P. Hertelendy Prentice-Hall,INC. 1973
* [5] 'Classical Electrodynamics' J. D. Jackson John Wiley & Sons, 1975
* [6] Atlas internal note TILECAL-N0-54
* [7] Calculation of the average magnetic permeability of the ATLAS tile calorimeter /afs/cern.ch/user/b/bergsma/public/atlas/tilemu.ps
* [8] MATLAB, The MathWorks, Inc. www.mathworks.com
* [9] OPERA-3d reference manual Vector Fields Limited, 24 Bankside, Kidlington, Oxford, OX5 1JE, England
* [10] ANSYS Theory Reference ANSYS, Inc., www.ansys.com