ATLAS Internal Note

CAL - NO - 024 Erratum

25 August 1993

**Noise Improvement with multiple samples**

Nathalie LAUNAY, Christophe de la TAILLE and Louis FAYARD

* On caption of fig 7 should be added : " The curve and the associated crosses correspond to the electronic noise, the other crosses to the pile-up noise "
* On paragraph 8 ( Quantization noise )

- The last two numbers of the page (.1579 9.954 ) should be replaced by.1747 and 9.881

- Fig 19 should be replaced by the following one

Fig 19 Reconstructed Energy of a 10 GeV electron 

**ATLAS Internal Note**

**CAL-NO-024**

**12 July 1993**

**Noise improvement with multiple samples**

N. LAUNAY, C. de la TAILLE and L. FAYARD

Laboratoire de l'Accelerateur Lineaire, IN2P3-CNRS

et Universite de Paris-Sud, F-91405 Orsay Cedex, FRANCE

In the present note, the results of the effect of thermal and pile-up noises in liquid ionization calorimeters are presented. The method of optimal filtering of multiply-sampled signals, which can be used to improve the amplitude resolution is described and some results based on noise and signal simulations are given.

[MISSING_PAGE_EMPTY:3]

## 1 Introduction

The total noise in some calorimeter area is the sum of the electronic noise and of the pile-up noise which both depend on the time constant \(\tau\) of the filter used in the front end electronic chain of the calorimeter. Whereas the electronic noise decreases when \(\tau\) grows longer, the pile-up noise increases. There is an optimal value for \(\tau\) which minimizes the total noise : \(\tau_{\mathrm{opt}}\)

However, the pile-up noise varying with the luminosity, the value of \(\tau_{\mathrm{opt}}\) becomes a function of the luminosity. Unfortunately, it has not been possible to vary the shaper time constant mainly because of the very large dynamic range required for the calorimeter.

The focus of the present study is to evaluate what can be gained on the noise for different luminosities,while an optimum corresponding to a certain luminosity has been fixed.We present the results obtained by a Monte-Carlo simulation performed by assuming the case of a nonet of the central electromagnetic liquid argon calorimeter of ATLAS. This study is done using the method of optimal filtering of multiply-sampled signals pioneered by Cleland and collaborators [1].

## 2 Pile-up and electronic noises

Two types of noises spoil the resolution at low energy : on one hand, the pile-up noise, on the other hand, the electronic noise intrinsic to the calorimeter.

The electronic noise is determined by a large number of parameters, such as the detector capacitance, the technology used for the preamplifiers. Most of those parameters are frozen.

The pile-up noise depends on the luminosity.

Before considering the pile-up noise, it is necessary to recall a few characteristics of the signal collected in the ionization chamber calorimeter ( see appendix 1 for more details) :

a. Signal :

The particles of the EM shower lose part of their energy ionizing the liquid Argon creating electron-ion pairs.

The motion of the electrons under an applied electric field creates a current in the external circuit whose waveform is given by :

\[\mathrm{i(t)=\frac{Q}{t_{dr}}\left(1\ -\frac{t}{t_{dr}}\right)} \tag{1}\]

in which Q is the number of ionization electrons and \(t_{dr}\) the drift time ( 400 ns in this case).

The time between two collisions being much shorter than the drift time, the triangles add themselves ; it is the pile-up effect.

b. Electronic chain :

The electronic chain consists of a preamplifier and a shaper to enhance the signal to noise ratio. The preamplifiers are traditionnally of the charge sensitive type ( current integrated devices ) although when the pulse shaping is faster than the signal duration, a current sensitive device seems better to handle the wide dynamic range.

The shaper is advantageously designed to have area balance between positive and negative lobes ; so it avoids baseline variation with the mean energy deposited.

For a charge preamplifier the shaper is bipolar, made of 2 differenciations and of n integrations, often noted CR \({}^{2}\) RC\({}^{n}\).

A good compromise between efficiency and power dissipation is n = 3, which is the value that was chosen in the following calculations. For a current preamplifier, the output waveform is exactly the same when using a unipolar CR RC n+1 filter, so that all the following calculations literally apply to both types. We continue with the well-known charge preamplifier.

Figure 2: Response to a triangle for different \(\tau\) as a function of time

The overall transfer function of the system preamplifier and shaper is given by (in the frequency domain) :

\[\frac{\mathrm{V_{out}}}{\mathrm{I_{in}}}=\frac{1}{\mathrm{s}\ \mathrm{C_{f}}} \frac{\mathrm{\tau^{2}\ s^{2}}}{\left(\ 1+\mathrm{\tau\ s}\right)^{5}}\quad(2)\]

where \(\mathrm{C_{f}}\) is the feedback capacitor of the charge preamplifier (supposed infinitely fast ) and \(\mathrm{\tau}\) is the shaper time constant.

The response to the triangle is given by ( cf appendix 1 ) :

\[\mathrm{x}\leq\rho\qquad\mathrm{g(x)}=\frac{\mathrm{v_{1}\ (x)}}{\mathrm{v_{max}}}\ \mathrm{with\ v_{1}(x)}= \ \mathrm{-\ 1+\sum_{k\ =\ 0}^{3}\frac{x^{k}}{k\ l}\ e^{-x}+(\ 1+\rho\ )\frac{x^{4}}{24}\ e^{-x}\]

\[\mathrm{x}>\rho\qquad\mathrm{g(x)}=\frac{\mathrm{v_{2}\ (x)}}{\mathrm{v_{max}}} \ \mathrm{with\ v_{2}(x)}=\left(\rho\ \frac{x^{4}}{24}+\sum_{k\ =\ 0}^{4}\frac{x^{k}\ -(x\ -\rho)^{k}\rho}{k\ l}\right)\ e^{-x}\]

\[\mathrm{where\ \rho=\frac{t_{d}}{\tau}\,\ x=\frac{t_{d}}{\tau}\ and\ v_{max}=v_{1} \left(\frac{4\ t_{d}}{\tau+t_{d}}\right)}\]

One sees that the peaking time of this signal is \(t_{p}\) ( triangle ) = 4 \(\mathrm{\tau}\) while ( see appendix 1 ) the peaking time of an impulse is \(t_{p}\) (\(\delta\)) = 2 \(\mathrm{\tau}\).

Figure 1 shows the current waveform of the detector and the impulse and triangle responses. Figure 2 shows the response to a triangle input for different values of \(\mathrm{\tau}\).

c. Electronic noise :

The electronic noise is dominated by the preamplifier noise, that can be represented as 2 generators of current impulses at the input : a voltage one in series with the input ( series noise ) and a current one in parallel with the input. The voltage impulses can be transformed in current doublets \(\delta^{\mathrm{s}}\) ( t ) on the input as the detector is purely capacitive. This allows to apply eq. (2) to both sources of noise and deduce the temporal waveform for the noise, and run Monte-Carlo simulations including the noise.

A global variation with the shaper time constant can also be calculated, knowing the noise spectra in the frequency domain and it leads to :

\[\mathrm{B_{e}=\frac{B}{\tau^{3\ /2}}\quad\mathrm{for\ the\ series\ noise}}\]

whereas for the pile -up noise the application of Campbell's theorem leads to :

\[\mathrm{B_{p}=A\ \sqrt{\mathrm{\tau}}\ \ \mathrm{where\ A\ is\ a\ factor\ depending\ on\ the\ luminosity\ (\ A\approx\mathrm{\tau}\mathrm{\Gamma}\ )}\]

To find the optimal shaping time, in the presence of those two noises, we minimize the total noise \(\sigma\) where :

\[\sigma=\sqrt{\mathrm{B_{e}}^{2}+\mathrm{B_{p}}^{2}}=\sqrt{\mathrm{A}^{2}\ \mathrm{\tau}+\frac{\mathrm{B}^{2}}{\tau^{3}}}\]Figure 3 : Value of the total noise ( in GeV ) for L = 16 10\({}^{33}\) cm\({}^{\cdot}\)2 s\({}^{\cdot}\)1

Figure 4 : Distribution of the noise ( in GeV ) for L = 16 10\({}^{33}\) cm\({}^{\cdot}\)2 s\({}^{\cdot}\)1

Figure 5: Total noise in Gev as a function of \(\tau\) for different luminosities

We find for the optimal value of \(\tau:\)

\[\tau_{opt}=\sqrt{3}\sqrt{\frac{B}{A}}\]

We can notice that \(\tau\) depends on the luminosity.

This optimal value of \(\tau\) being fixed for a certain luminosity, we will see in the following how to gain on the signal to noise ratio at other luminosities, whereas this value of \(\tau\) is no longer the optimal value. In the following, the results shown are obtained with the noise simulated by a Monte-Carlo program (see appendix 2). The time and amplitude dependences of the pile-up noise and of the electronic serie noise (taken as an incoherent sum of positive and negative \(\delta^{*}\) (t ) ) is taken into account.

Figure 3 shows the value of the noise for \(L=16\,10\,^{33}\,cm\,^{-2}\,s\,^{-1}\) and figure 4 shows the distribution of this noise sampled each 25 ns.

Both figures correspond to \(\tau=\tau_{opt}\)( \(16\,10\,^{33}\,cm\,^{-2}\,s\,^{-1}\) ) = 17.6 ns

In figure 5 the total noise obtained is plotted as a function of \(\tau\) for different luminosities. Figure 6 shows an example of response to a \(\delta^{*}\) (t ).

## 3 Description of the method

a. Optimal filtering:

The signal is sampled many times, giving each 25 ns bunch crossing a set of measurements \(S_{1}\),...,\(S_{n}\) with one sample around the maximum.

We set:

\[S_{i}=A\ g\left(t_{i}\right)+n\left(t_{i}\right)\]

where g (t) is the signal waveform normalized to 1 as defined in SS 2, n (t) is the function giving the total noise.

Optimal filtering [1] refers to the formation of linear combinations of signal samples to recover the signal parameters.

We define coefficient \(a\) and form a weighting sum of the samples which correspond to the signal:

\[u=\sum_{i}\ a_{i}\ S_{i}\]

The variance of \(u\) is ( cf appendix 3 for demonstration ):

\[\sigma_{u}^{2}=\sum_{i,j}\ a_{i}a_{j}R_{ij}=\sum_{i,j}\ a_{i}a_{j}\left(\ n_{i}n _{j}\right)\]

\(R_{ij}\) being the noise autocorrelation function at time \(t_{i}\) - \(t_{j}\).

The \(a_{i}\) are given by:

\[\vec{a}=R\,^{-1}\,\vec{g}\]

The autocorrelation matrices are evaluated for a certain luminosity and a certain \(\tau\) and calculated by a Monte-Carlo program including pile-up and electronic noises.

b. Factor of merit :

We first recall that the signal over noise ratio (for N samples) is :

\[\frac{\mathrm{S}}{\mathrm{B}}=\mathrm{A}\times\frac{\sum_{\mathrm{i}}\mathrm{a_{i }g_{i}}}{\sqrt{\sum_{\mathrm{i}}\mathrm{a_{i}a_{j}R_{ij}}}}\]

It has to be compared with the signal over noise ratio (S'/B') for one sample (at the peak):

\[\frac{\mathrm{S}\,^{\prime}}{\mathrm{B}\,^{\prime}}=\mathrm{A}\times\frac{ \mathrm{g_{0}}}{\tau\,\mathrm{R_{00}}}\]

We have verified that, in the case where the noise is only the electronic noise, the Monte - Carlo method ( crosses ) gives the same result as the integration method (curve on fig.7) described in appendix 1.

We also define the factor of merit G as being :

\[\mathrm{G}=\frac{\mathrm{S}\,\,/\,\,\mathrm{B}}{\mathrm{S}\,\,^{\prime}\,/\, \,\mathrm{B}^{\prime}}\]

## 4. Results for \(\tau=17.6\) ns

The value of \(\tau\) is the optimum value corresponding to \(\mathrm{L_{o}}=16\,\,10^{33}\) cm \(\cdot\,^{2}\) s \(\cdot\,^{1}\) (see fig. 5).

In the numerical examples chosen, for 5 samples spaced at \(\Delta=25\) ns intervals, starting at t = -50 ns, we find the following values for the autocorrelation matrix coefficients :

In the case of a luminosity of \(64\,\,10^{33}\) cm \(\cdot\,^{2}\) s \(\cdot\,^{1}\), the matrix R is :

\[\begin{array}{ccccc}1.000&0.813&0.504&0.257&0.081\\ 0.813&1.000&0.813&0.504&0.257\\ 0.504&0.813&1.000&0.813&0.504\\ 0.257&0.504&0.813&1.000&0.813\\ 0.081&0.257&0.504&0.813&1.000\\ \end{array}\]

In the case of a luminosity of \(16\,\,10^{33}\) cm \(\cdot\,^{2}\) s \(\cdot\,^{1}\), the matrix R is :

\[\begin{array}{ccccc}1.000&0.643&0.313&0.157&0.061\\ 0.643&1.000&0.643&0.313&0.157\\ 0.313&0.643&1.000&0.643&0.313\\ 0.157&0.313&0.643&1.000&0.643\\ 0.061&0.157&0.313&0.643&1.000\\ \end{array}\]

In the case of a luminosity of \(10^{33}\) cm \(\cdot\,^{2}\) s \(\cdot\,^{1}\), the matrix R is :

\[\begin{array}{ccccc}1.000&0.156&-0.293&-0.154&-0.004\\ 0.156&1.000&0.156&-0.293&-0.154\\ -0.293&0.156&1.000&0.156&-0.293\\ -0.154&-0.293&0.156&1.000&0.156\\ -0.004&-0.154&-0.293&0.156&1.000\\ \end{array}\]Figure 7 : Autocorrelation function for \(\tau=11.5\) ns

The crosses correspond to the results of the Monte-Carlo program, the curve to the analytical method At high luminosity, where the pile-up noise ( with long distance correlation, see fig. 7 ) dominates, the non-diagonal terms of the matrix are important. At low luminosity where the electronic noise dominates there are some negative terms.

On Fig.8, the value of G is plotted as a function of the number of samples, on Fig.9,we give the coefficients \(g_{i}\) and \(a_{i}\) for different luminosities ( for 7 and 3 samples used).

It is clear that since for \(L<16\ 10^{33}\) cm\(\cdot\ ^{2}\) s\(\cdot\ ^{1}\) we want to slow down the signal, hence the \(a_{i}\) coefficient will be important. This can be seen on Fig. 9. Figure 10 is like figure 5 apart that the gain (for 7 samples) in Signal / Noise is shown. It can be noticed that :

i) we recover a large part of the additional noise ( due to the fact that we are not at the optimum \(\tau\) ) for \(L\neq L_{0}\) with this method.

ii) even at the optimum \(\tau\), Signal / Noise can be a little bit better.

This is because the CR \({}^{2}\) RC \({}^{3}\) shaping does not have exactly the optimum shape.

We plot on figure 11 the value of G as a function of the number of samples if the coefficients \(a_{i}\) are equal to 1.

We lose at high luminosity but gain at low luminosity, because in that case the optimal \(a_{i}\) are close to constant (see fig. 9).

**5. Results for \(\tau=12.43\) ns**

This value of \(\tau\) is the optimum value corresponding to \(L_{0}=64\ 10^{33}\) cm\(\cdot\ ^{2}\) s\(\cdot\ ^{1}\).

In the case of a luminosity of \(64\ 10^{33}\) cm\(\cdot\ ^{2}\) s\(\cdot\ ^{1}\), the matrix R is :

\[\begin{array}{cccc}1.000&0.521&0.191&0.067&-0.004\\ 0.521&1.000&0.521&0.191&0.067\\ 0.191&0.521&1.000&0.521&0.191\\ 0.067&0.191&0.521&1.000&0.521\\ -0.004&0.067&0.191&0.521&1.000\\ \end{array}\]

In the case of a luminosity of \(16\ 10^{33}\) cm\(\cdot\ ^{2}\) s\(\cdot\ ^{1}\), the matrix R is :

\[\begin{array}{cccc}1.000&0.344&0.097&0.057&0.008\\ 0.344&1.000&0.344&0.097&0.057\\ 0.097&0.344&1.000&0.344&0.097\\ 0.057&0.097&0.344&1.000&0.344\\ 0.008&0.057&0.097&0.344&1.000\\ \end{array}\]

In the case of a luminosity of \(10^{33}\) cm\(\cdot\ ^{2}\) s\(\cdot\ ^{1}\), the matrix R is :

\[\begin{array}{cccc}1.000&-0.221&-0.245&-0.008&0.040\\ -0.221&1.000&-0.221&-0.245&-0.008\\ -0.245&-0.221&1.000&-0.221&-0.245\\ -0.008&-0.245&-0.221&1.000&-0.221\\ 0.040&-0.008&-0.245&-0.221&1.000\\ \end{array}\]

Since \(\tau\) is smaller than in SS 4, at high luminosity the correlation is at distance.

The curves plotting a function of the number of samples ( figure 12) and the coefficients \(g_{i}\) and \(a_{i}\) (figure 13) are shown.

Figure 8: Value of G as a function of the number of samples!! for \(\tau\) = 17.6 ns

Figure 9 : Coefficients \(g_{i}\) and \(a_{i}\) for different luminosities and for \(\tau=17.6\) ns

For the \(a_{i}\) coefficients the full ( dotted ) line corresponds to 7 ( 3 ) samplesFigure 11 : Value of G as a function of the number of samples if the coefficients ai are equal to 1

Figure 10: Total noise as a function of \(\tau\) for different luminosities and gain in Signal / Noise ratio

Figure 12: Value of G as a function of the number of samples at \(\tau=12.4\) ns

Figure 13: Coefficients \(g_{\rm j}\) and \(a_{\rm j}\) for different luminosities at \(\tau\) = 12.43

## 6. Results for \(\tau=24.9\) ns

The value of \(\tau\) is the optimum value corresponding to L\({}_{0}=4\ 10^{33}\) cm\({}^{\cdot\,2}\) s\({}^{\cdot\,1}\).

In the case of a luminosity of 64 \(10^{33}\) cm\({}^{\cdot\,2}\) s\({}^{\cdot\,1}\), the matrix R is :

\begin{tabular}{c c c c c}
1.000 & 0.910 & 0.701 & 0.465 & 0.255 \\
0.910 & 1.000 & 0.910 & 0.701 & 0.465 \\
0.701 & 0.910 & 1.000 & 0.910 & 0.701 \\
0.465 & 0.701 & 0.910 & 1.000 & 0.910 \\
0.255 & 0.465 & 0.701 & 0.910 & 1.000 \\ \end{tabular}

In the case of a luminosity of 16 \(10^{33}\) cm\({}^{\cdot\,2}\) s\({}^{\cdot\,1}\), the matrix R is :

\begin{tabular}{c c c c c}
1.000 & 0.881 & 0.646 & 0.417 & 0.224 \\
0.881 & 1.000 & 0.881 & 0.646 & 0.417 \\
0.646 & 0.881 & 1.000 & 0.881 & 0.646 \\
0.417 & 0.646 & 0.881 & 1.000 & 0.881 \\
0.224 & 0.417 & 0.646 & 0.881 & 1.000 \\ \end{tabular}

In the case of a luminosity of 10\({}^{33}\) cm\({}^{\cdot\,2}\) s\({}^{\cdot\,1}\), the matrix R is :

\begin{tabular}{c c c c c}
1.000 & 0.596 & 0.109 & -0.060 & -0.057 \\
0.596 & 1.000 & 0.596 & 0.109 & -0.060 \\
0.109 & 0.596 & 1.000 & 0.596 & 0.109 \\ -0.060 & 0.109 & 0.596 & 1.000 & 0.596 \\ -0.057 & -0.060 & 0.109 & 0.596 & 1.000 \\ \end{tabular}

Figure 14 represents the curve plotting G as a function of the number of samples, fig. 15 the coefficients a\({}_{\rm i}\) and g\({}_{\rm i}\).

Figure 16 is similar to figure 10 and shows the gain at different luminosities.

## 7. Inclusion of parallel noise

Up to now, all the results correspond to an electronic noise which is only series noise.

At \(\tau=17.6\) ns, we have added parallel noise which corresponds to the sum of positive and negative 8 (t ). Two cases appear :

In the first case, we consider the parallel noise due to the current amplifier which represents a quarter of the serie noise.

In the second case, we consider the parallel noise due to the "0T" scheme [8 ] which is the series noise divided by 1.5.

We find the following values for the autocorrelation matrices at the luminosity 10\({}^{33}\) cm\({}^{\cdot\,2}\) s\({}^{\cdot\,1}\):

In the first case R is :

\begin{tabular}{c c c c c}
1.000 & 0.197 & -0.245 & -0.154.-0.022 \\
0.197 & 1.000 & 0.197 & -0.245 & -0.154 \\ -0.245 & 0.197 & 1.000 & 0.197 & -0.245 \\ -0.154 & -0.245 & 0.197 & 1.000 & 0.197 \\ -0.022 & -0.154 & -0.245 & 0.197 & 1.000 \\ \end{tabular}

Figure 14: Value of G as a function of the number of samples at \(\tau=24.9\) ns

Figure 15: Coefficients \(\mathbf{g_{i}}\) and \(\mathbf{a_{i}}\) for different luminosities at \(\tau=24.9\) ns

Figure 16 : Gain in Signal / Noise at \(\tau\) = 24.9 ns

[MISSING_PAGE_FAIL:22]

Figure 17: Value of G as a function of the number of samples at \(\tau=17.6\) ns including the whole parallel noise

Figure 18 : Coefficients \(g_{i}\) and \(a_{i}\) for different luminosities and for \(\tau=17.6\) ns including the whole parallel noise

Figure 19: Reconstructed Energy of a 10 GeV electron

[MISSING_PAGE_EMPTY:26]

## 9 Conclusion

We have shown by Monte-Carlo that the method of optimal filtering of multiply-sampled signals can be used in order to improve the Signal on Noise ratio, when we are working at a luminosity different from the one used to determine the hardware shaping time.

**References :**

[1] W. E. Cleland and E. G. Stern talk presented at the Corpus Christi Conference (Sept. 92)

[2] ATLAS Letter of Intent CERN / LHCC / 92-4 (October 1992 )

[3] C de la Taille RD3 meeting (October 1990)

[4] C de la Taille RD3 note 45 (May 1993 )

[5] see for instance S. Brambilla RD3 meeting (May 1993 )

[6] Y. Zolnierowski CAL-NO-014 (Sept. 1992 )

[7] P. Battaglia and L. Perini CAL-NO-018 (Feb. 1993 )

[8] R. L. Chase, C. de la Taille, S. Rescia and N. Seguin

Nucl. Instum. Methods A 330 ( 1993 ) 228.

## Appendix 1 : Signal waveform

This appendix is taken mainly from [3, 4]

## 1 Signal

The current waveform created by an ionizing particle in a sampling calorimeter has a triangular form and is given by :

\[\mathrm{i}\left(t\right)\mathrm{=}\frac{Q}{t_{dr}}\left(1\mathrm{-}\frac{t}{t_{dr }}\right)\]

in which

Q is the number of ionization electrons.

\(t_{dr}\mathrm{=}\frac{d}{v_{e}}\) is the drift time.

For RD3 geometry : Q = 6000e- / Mev,

d=1.9 mm,

t\({}_{dr}\mathrm{=}\) 400 ns,

The integration of the current equation during the drift time gives the collected charge equal to : Q / 2 = 3000 e- / MeV.

In frequency, taking the Laplace transformation of i (t), we obtain :

\[\mathrm{I}\left(s\right)=\frac{2\,Q_{0}}{t_{d}^{2}}\ \frac{st_{d}\mathrm{-}1 \mathrm{+}e^{-st_{d}}}{s^{2}}\]

### Bipolar filter

The role of "signal filtering" is to minimize the effects of pulse pile-up and the measurement error with respect to noise. As a typical bipolar impulse has a zero area (that is to say area balance between negative and positive lobes), the pile-up does not produce a net shift in the measurement of high energy events in the presence of a high rate of low energy background events. That is why the preamplifier is followed by a bipolar filter which consists in two derivatives and n integrations and which can be realized by cascading 2 high-pass (CR) and n low-pass filters (RC).

Its transfer function is given by :

\[\mathrm{H}(s)=\frac{\tau^{2}s^{2}}{\left(1\mathrm{+}\mathrm{cs}\right)^{2}} \frac{1}{\left(1\mathrm{+}\mathrm{cs}\right)^{n}}=\frac{\tau^{2}s^{2}}{\left(1 \mathrm{+}\mathrm{cs}\right)^{n+2}}\]

in which \(\tau=\mathrm{RC}\) is the time constant of the filter.

[MISSING_PAGE_FAIL:29]

[MISSING_PAGE_FAIL:30]

[MISSING_PAGE_EMPTY:31]

If there is only electronic noise (i. e. when the luminosity is zero) then the autocorrelation function can be easily computed.

\[R_{i}(t)\ \alpha\int_{-}^{-}h^{\prime}(t+u)\ h^{\prime}(u)\ du\]

In the general case the autocorrelation function takes into account the pile-up and the electronic noise.

We minimize the variance of \(u\) by using Lagrange multipliers.

The function to minimize is :

\[I_{u}=\sum_{i,j}\ R_{ij}\ a_{i}\ a_{j}-\lambda\left(\sum_{i}\ a_{i}g_{i}-1\ \right)\]

\(\lambda\) is the Lagrange multiplier.

The contraint is :

\[\sum_{i}\ a_{i}g_{i}=1\]

The partial derivative with respect to \(a_{i}\) is:

\[\frac{\partial I_{u}}{\partial a_{i}}=-\lambda g_{i}+2\sum_{j}\ R_{ij}a_{j}=0\]

\[So\ \ \ \ \ \ \lambda g_{i}=2\sum_{j}\ R_{ij}a_{j}\]

In matrix notation, it gives:

\[\lambda\vec{g}=2\ R\ \vec{a}\]

\[\vec{a}=\frac{1}{2}\lambda\ R\cdot^{-1}\vec{g}\]

Autocorrelation matrices have been calculated for different luminosities, then inversed.

According to above,the multiplicative factor being unimportant : \(\vec{a}=R\cdot^{-1}\vec{g}\)

So the coefficients \(a_{i}\) have been found, the Signal / Noise ratio S / B has been evaluated and compared to S'/B' where :

\[B^{2}=\sum_{i,j}\ a_{i}g_{j}R_{ij}\]

\[S\ \alpha\ \sum_{i}\ a_{i}g_{i}\]

\[B^{*2}=a_{i}^{2}R_{00}\ \ \ \text{and}\ \ S^{\prime}\ \alpha\ a_{0}g_{0}\]