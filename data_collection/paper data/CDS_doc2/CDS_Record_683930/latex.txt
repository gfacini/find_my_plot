# Design and performance of an integrated pulse generator for the LARG calibration system

E.Marschalkowski, V.Gartner,

K. Jakobs, U.Schaler

University of Mainz, Germany

_Mainz, September 22, 1999_

###### Abstract

In the present note the design and the results on the performance of an integrated version of the pulse generator of the liquid argon calibration system are presented. The pulse generator consists of a differential amplifier with automatic offset compensation, a current mirror and a switching logic. These components are integrated on an ASIC chip in CMOS technology. The chip has been tested in the laboratory and during testbeam measurements of the hadronic endcap calorimeter. In addition, the radiation hardness has been investigated under neutron irradiation at a nuclear power station.

Introduction

Strict requirements have been imposed on the performance of the liquid argon calibration system. They are described in detail in the Liquid Argon Calorimeter Technical Design Report [1].

A VLSI integration of the calibration pulse generator offers new opportunities for its design. In the present note a novel technical solution is presented for an integrated version of the pulse generator. The system presented is designed in AMS1 0.8 \(\mu\)m CMOS technology. The integration allows to reduce the complexity of the system compared to conventional approaches. The advantages of CMOS transistors can be exploited to increase the linearity and the stability of the system.

Footnote 1: Austria Mikro Systeme International AG

The present work has been initiated in the framework of the hadronic endcap community, with the original intention to reduce significantly the _clock feed-through_, which is particularly disturbing for the calibration of the small signals in the hadronic end-cap. The design has however been made with the aim to fulfill, if possible, also the stricter requirements in terms of dynamic range of the electromagnetic calorimeter, such that a unified approach could be used within the whole ATLAS liquid argon calorimetry.

In Section 2 the requirements on the ATLAS calibration system for the liquid argon calorimeters are briefly summarized. The principle of the calibration is presented in Section 3. Details on the layout together with results of test measurements are described in Sections 4 and 5 for the various components of the integrated pulse generator. The performance of the full system is discussed in Section 6.

## 2 Requirements on the calibration system

The main requirements on the calibration system, as specified in the TDR[1], are the following:

* The integral nonlinearity of the pulser system should be less than 0.1% over the full dynamic range. A dynamic range of \(10^{5}\) has to be covered. This range is determined at the lower end by the requirement to measure the signal of a minimum ionizing particle, corresponding to a current in the order of 200 nA, in the hadronic endcap calorimeters. The maximum value is determined from the energy measurement of high energy electromagnetic particles. For example, a 2 TeV electron produces an ionisation current of 10 mA in a cell of the electromagnetic calorimeter. It should be noted, that it is foreseen to subdivide the full dynamic range into three gain regions. In each of these the requirement on the integral nonlinearity has to be fulfilled.
* The channel-to-channel uniformity is required to be better than 0.25%.
* The calibration pulse should reproduce the shape of the detector signal over the time interval relevant for the subsequent signal shaping[1]. The detector signal has a triangular shape with a rise time in the order of about one nanosecond and a decay time corresponding to the maximal drift time (\(\sim 400\) ns).

* Since the calibration electronics will be located close to the experiment, it has to be radiation tolerant. Over a period of operation of 10 years, the electronics will be exposed to an integrated neutron flux of \(\sim 10^{13}\) n/cm\({}^{2}\) with an equivalent energy of 1 MeV(Si) and a gamma dose of 200 Gy.

In addition, the clock feed through should be kept as small as possible.

## 3 Principle of the Calibration

The principle of the calibration of liquid argon calorimeters is described elsewhere [2]. A current is generated from a DAC voltage through a voltage-to-current converter and is sent through an inductance \(L\). By interrupting this current a voltage pulse with a fast rise-time is generated. This voltage pulse is fed via a terminated cable to injection resistors (see Fig.1). These resistors are located in the liquid argon cryostat, close to the electrode structures, where the physical calorimeter signals are produced. The decay time of the pulse is determined by the time constant of the pulser circuit.

In the case of the ATLAS calorimeters, the maximum required output currents are 2 mA for the high gain region, 20 mA for the medium gain region and 200 mA for the low gain region. This maximum current is a factor of 20 higher than the required current per readout channel, since one calibration pulse generator serves up to 10 calorimeter cells in parallel. In addition, the termination of the cable divides the pulse amplitude by a factor of two.

The voltage-to-current converter, the so called pulse generator, has been realised as an integrated circuit. The basic building blocks are a differential amplifier, a current mirror and a switching logic. These blocks are shown in Fig.1 together with the described transmission into the detector system. In order to fulfill the stringent requirements on the linearity of the system, the offset voltage of the differential amplifier has to be kept as small as possible (see below). To achieve this, an automatic offset compensation has been developed. The voltage-to-current conversion is done by feeding back the differential amplifier with a p-channel transistor to its non-inverting input. The difference of the input voltage \(\Delta V_{\rm IN}\) drops off over the input resistor \(R_{\rm IN}\) and is converted linearly into the input current \(I_{I\,N}\). This current is sent through a current mirror with a gain factor \(g_{I}\) to the switching node \(N_{0}\). At this node a p-channel transistor is used to cascade the current mirror and to conduct the current to the output through an external inductance. In addition, two n-channel transistors are connected to the node \(N_{0}\) to switch the current \(I_{\rm OUT}\) from the output to ground.

## 4 The tuneable differential amplifier

### Requirements on the offset voltage

Two parameters, the offset voltage and the gain of the differential input stage, limit the linearity of the system. To reach an integral non-linearity of 0.1% over the dynamic range required, the gain of the amplifier has to be larger than 1000. The maximum offset volt age which can be tolerated is given by:

\[V_{\mathrm{offset}}^{max}=\frac{I_{\mathrm{out}}^{min}}{g_{I}}\ R_{\mathrm{in}}. \tag{1}\]

For an integral linearity of 0.1% the absolute deviation at the lower end of the scale may be as large as 100%. The maximum value of the input resistance is defined by the maximal input difference voltage \(\Delta V_{in}^{max}\) and the maximal output current: \(R_{\mathrm{in}}<g_{I}\cdot\Delta V_{\mathrm{in}}^{max}/I_{\mathrm{out}}^{max}\). With eq.(1) it follows that the maximum offset voltage which can be tolerated depends on the total dynamic range of the system and the maximum input voltage difference:

\[V_{\mathrm{offset}}^{max}=\frac{I_{\mathrm{out}}^{min}}{I_{\mathrm{out}}^{max}} \ \Delta V_{\mathrm{in}}^{max} \tag{2}\]

Assuming 5 V for \(\Delta V_{\mathrm{in}}^{max}\)and the present value of \(10^{-5}\) for the ratio of the minimal to maximal current, the maximum offset voltage amounts to 50 \(\mu\)V. Since this small offset voltage can hardly be realised in a CMOS design, an automatic offset compensation has been designed.

Figure 1: _Principle of the calibration system, together with the basic building blocks of the integrated pulse generator._

### The Offset compensation

The proposed version of the integrated calibration system uses a special tuneable differential amplifier to compensate the offset voltage. Figure 2 shows the schematic of the tuneable differential input stage. It consists of a n-channel source coupled pair, which is realised with the transistors N1 and N2, a common current sink N3 and two p-channel load transistors P1 and P2 for the differential pair. In this configuration the input stage compares to any regular differential input stage with one inverting and one non-inverting input. With the implementation of an additional p-channel transistor \(P_{T}\) a second inverting input is realised. This second inverting input can be used to measure and to store the offset voltage of the input stage. At this point it has to be taken into account, that the p-channel load transistors have to be mismatched to allow for offset compensation of either polarity.

A source follower is added to the output node \(O_{1}\) of the differential pair, to allow the amplifier to drive high loads. In addition, several switches have been introduced to allow to switch the circuit from the normal operation mode into the so called 'tune-mode'.

During normal operation the switches S1, S2, and S3 are closed, all other switches are open and the amplifier behaves as any regular differential amplifier. At the beginning of the tuning phase the switches S1, S2 and S3 are opened and the two inputs I1 and I2 are shorted by closing the switches S4 and S5. At this time a reference voltage \(V_{\mathrm{ref}}\) is supplied to the input transistors \(N_{1}\) and \(N_{2}\). The second inverting input is connected to the output \(O_{2}\) by closing switch S6. Due to the inverting feedback, the output volt age

Figure 2: _The schematic of the tuneable differential amplifier including the source follower and the switches, together with the equivalent schematic._

[MISSING_PAGE_EMPTY:6]

### Performance of the tuneable amplifier

As shown in the previous section, the differential amplifier needs to have a high gain to fulfill the requirements on the linearity and on the offset voltage. The open loop gain has been measured indirectly in a closed loop operation mode. For this measurement the transfer function of the feedback transistor was used to recalculate the voltage at the output \(O_{2}\) for different input currents. The gain has been calculated by the direct measurement of the difference input voltage at the input nodes of the differential amplifier. Using this procedure, a gain of about 3000 has been determined. This gain factor is large enough to reach the desired linearity and the required offset voltage.

Another point of interest is the stability of the stored offset voltage with time. This voltage is expected to change with time due to leakage currents at the storage capacitance. In addition, it is expected to be affected by transistor damages which might occur if the circuit is operated in a radiation environment.

The time stability of the offset compensation has been investigated. The results obtained at room temperature are shown in Fig.4a. The measured offset voltage is shown as a function of time. After tuning the offset voltage is found to drift with a gradient of 0.3 \(\mu\)V/sec. This value is small enough, such that in an application of the present design in a calibration system, tuning could be done with a frequency of a few Hertz or less. In

Figure 4: _a) Time dependence of the offset voltage at \(20^{0}\)C, b) at \(85^{0}\)C. Tuning is performed at the time positions indicated by the dashed lines_Fig.4a it can also be seen that the tuning procedure works. After tuning, which has been performed at the time positions indicated by the dashed lines, the offset voltage can be reset to zero.

The same measurement has been repeated for an increased temperature of the chip of 85\({}^{0}\)centigrade. The results are shown in Fig.4b. As expected, a larger gradient for the change of the offset voltage is found. After a few hundred seconds the storage capacitor is discharged. Even under these extreme conditions the tuning works and the offset of the differential amplifier can be compensated. The built-in tuning mechanism gives also confidence that the amplifier can be used to some extent, if the calibration system has to work in a radiation environment (see below).

A typical distribution of the offset voltage measured after tuning is shown in Fig.5. The rms value of the distribution is found to be 10 \(\mu\)V. The mean value of the offset volt age for this chip is found to be 24 \(\mu\)V. In total a sample of 12 chips has been measured. For all of them the mean value of the residual offset voltage has been found to be below the required value of 50 \(\mu\)V.

In conclusion, these measurements show that the principle of the tuning mechanism works and that the requirements for an application in the ATLAS calorimeters are met.

## 5 The Charge Compensating switch

For the generation of the calibration pulses a fast switching of the output current \(I_{OUT}\) is required. In the present design a switch configuration is used, where a p-channel transistor is combined with a n-channel transistor. This is shown in Fig.6.

The combination of n- and p-channel transistors has some advantages over a differential pa

Figure 5: _Distribution of the residual offset voltage measured after tune cycles._

transistors only. The main advantage is the higher velocity resulting from the higher \(g_{m}\) of the n-channel transistor. In the present application, the p-channel transistor can be used in addition as a cascade for the output side of the current mirror. This leads to an improved performance of the mirror.

Due to the high speed switching the capacities of the transistors cannot be neglected. They will lead to charge injection effects resulting in distortions of the output signal pulses. In order to compensate for such effects, an additional transistor \(N_{D}\) has been introduced. The charge which is injected into the node \(N_{0}\) by switching transistor \(N_{S}\) with the signal \(CLK\) can be canceled exactly by switching \(N_{D}\) simultaneously with a signal of the opposite polarity \(\overline{\rm{CLK}}\). A precise cancellation is however only achieved, if the transistors \(N_{S}\) and \(N_{D}\) are exactly matched in dimensions and if both transistors are switched at exactly the same time.

Figure 7a shows the effect of the injected charge through the gate-drain capacity of the transistor \(N_{S}\). The switching leads to an additional output current \(+\delta I_{\rm{OUT}}\), which causes a small positive spike at the beginning of a calibration pulse. If the transistor \(N_{D}\) is used, but not switched simultaneously, an additional current \(-\delta I_{\rm{OUT}}\) is added to the output current. It causes a small negative spike at the beginning of the calibration pulse. This is shown in Fig.7b. Only if the control signals \(CLK\) and \(\overline{\rm{CLK}}\) are in time, the charge will be compensated precisely (see Fig.7c).

Figure 6: _Switching circuit built from a combination of p-channel and n-channel transistors._

Another smaller effect, which distorts the calibration pulse especially for small amplitudes, is the charge coupling via the gate of transistor \(P_{S}\) to the output. This coupling can only be minimized if the gate resistance is designed as small as possible. For the present design this resistance has been estimated to be in the order of \(5\Omega\). The importance of this has been investigated during a test of the system in the environment of the ATLAS hadronic endcap calorimeter at CERN and will be discussed in Section 6.2.

Figure 7: _a) Effect of the charge injected through the transistor \(N_{S}\). R1 is the clock signal, R2 is the calibration pulse. b) Calibration pulse and induced signals (A1) for the situation where the clock signals CLK and \(\overline{\rm CLK}\) (R1 and R2) are out of phase. c) Demonstration of the charge compensation with exact timing between the clock signals CLK and \(\overline{\rm CLK}\). The calibration pulse (A1) is not affected by the switching._

Performance of the integrated calibration system

### Laboratory Tests

The linearity of the integrated system is limited by the performance of the differential amplifier as well as by the transfer characteristic of the current mirror. The combined performance of these elements has been determined by measuring the DC-transfer characteristic of the whole system. The results are shown in Fig.8, where the output current is shown as a function of the input voltage difference. For the present measurement the range up to 200 mA has been covered for the output current. Figure 9 shows the integral non-linearity of the output current for the full system, split into the three gain regions.

The linearity is normalised to the respective maximum current in each gain region. It can be seen, that the integral non-linearity is in the order of the required 0.1% for nearly the full dynamic range up to 200 mA.

Figure 8: _DC-transfer characteristic of the whole system for the full dynamic range from 2 \(\mu\)A to 200 mA._

The chip-to-chip variations of the output current have been measured by applying a constant input voltage. The normalised chip-to-chip variations of the output current are shown in Fig. 10 for a nominal output current of 200 mA. The ATLAS requirement of \(\pm 0.25\%\) is indicated by the dashed lines in the figure. About 2/3 of the chips are found to be inside the required tolerance.

Figure 10: _Normalised chip-to-chip variations of the output current at a nominal current of 200 mA._

Figure 9: _Integral non-linearity of the whole system for the full dynamic range, split into three gain regions, from 2 \(\mu\)A to 200 mA._

### Measurements in a testbeam environment

A sample of four integrated calibration pulsers has been operated during a technical run in the testbeam environment of the hadronic endcap calorimeter at CERN. During this test the dynamic range relevant for an application in the hadronic endcap of the ATLAS calorimeter has been investigated. Figure 11a shows the signal which has been obtained for an equivalent calibration current of 12 \(\mu\)A. It should be noted that the exponential calibration signal is sent through the same electronics chain as the real calorimeter signal.

This chain consists of a current sensitive preamplifier, a shaper and an ADC [1]. For this small signal, which results in only four ADC counts, a fit of the response function of the readout chain has been performed and is superimposed on the figure. The response function has been computed as a convolution of the current signal input with the transfer function of the system. The current signal is assumed to be a superposition of the exponential calibration signal and a potential clock-feedthrough signal. The time structure of the clock-feedthrough signal is assumed to be a delta function. For the transfer function a general ansatz is chosen [3], which depends on one free parameter, the time constant \(\tau\). In the fit to the signal both the parameter \(\tau\) and the amplitude of the clock-feedthrough signal are determined. The fit delivers for the remaining clock-feedthrough a contribution of about 2 ADC counts, which corresponds to a calibration current of 6 \(\mu\)A. Part of this is due to the direct coupling through the gate of the p-channel transistor mentioned in section 5.

Figure 11b shows the calibration signal after shaping for a calibration current of 1.8 mA. This corresponds to the maximum current which was used during the testbeam measurements.

Figure 11: _a) Calibration signal after shaping for an equivalent calibration current of 12 \(\mu\)A. b) Calibration signal after shaping for an equivalent calibration current of 1.8 mA._

### Performance under irradiation

Two ASIC chips have been irradiated at the CEA2 reactor Prospero at Dijon. The DC-characteristics of individual n- and p-channel transistors and the transfer characteristics of the full calibration chip have been measured during and after the irradiation. A neutron flux of \(9\cdot 10^{12}\)n/cm\({}^{2}\) (1 MeV equivalent for Si) has been accumulated during a mesurement time of one day. This is equivalent to a total flux accumulated in ATLAS over a period of \(\sim\)10 years. During the measurements the chips were also exposed to the accompanying \(\gamma\)-radiation from the reactor. The accumulated dose corresponds to 17 Gy, which is however only equivalent to about 10% of the expected 10 years ATLAS dose. The variation of the threshold voltage of the p-MOS and n-MOS transistors are shown as a function of time in Fig.12a and b.

Footnote 2: Commissariat à l’Energie Atomique

The time intervals during which the reactor was operated are indicated on the figure. It has been observed that the threshold variation is larger for the p-channel than for the n-channel transistor. Concerning the full calibration circuit, the performance of the differential amplifier should however not be affected by such variations.

Figure 12: _a) Behaviour of the threshold voltage of a p-channel MOSFET during irradiation. b) Behaviour of the threshold voltage of an n-channel MOSFET during irradiation. c) Ratio of the input voltage \(\Delta V_{\rm DAC}\) to the output current \(I_{\rm OUT}\) during irradiation._A possible drift of the offset voltage which could be caused by irradiation effects should be compensated in the automatic tuning procedure.

The stability of the calibration circuit during irradiation is demonstrated in Fig.12c. The ratio between the input voltage \(\Delta V_{DAC}\) and the measured output current \(I_{out}\), multiplied by the nominal gain factor \(g_{I}\) of the current mirror, is plotted as a function of time. If the performance of the calibration chip is not disturbed, this ratio is expected to be constant and should correspond to the value of the input resistor, which has a nominal value of 27 k\(\Omega\). During the irradiation only a small variation of this ratio, which is in the order of 0.04%, has been observed.

## 7 Conclusions

A new technical solution has been presented for a CMOS integrated version of the pulse generator of the liquid argon calibration system. It consists of a differential amplifier where the offset voltage can be compensated automatically, a current mirror and a special switching logic to suppress switching noise. The performance of the developed ASIC has been investigated in laboratory tests and testbeam measurments. It has been shown that the offset compensation works and a residual offset voltage below 50 \(\mu\)V can be achieved. Together with the high gain of the amplifier this is sufficient to achieve nearly an integral nonlinearity of the full calibration system of 0.1% over a dynamic range of \(10^{5}\). The residual non-linearity are limited by the performance of the current mirror.

The performance of the calibration circuit has also been found to be stable over the full period of irradiation, where a total neutron flux of \(9.1\cdot 10^{12}\)n/\(cm^{2}\) 1 MeV (Si) has been accumulated. Additional tests under \(\gamma\)-irradiation will be carried out in the future.

As described in [4], the next steps will be directed towards the design of a final calibration board.

**Acknowledgements**

We wish to thank J.Ban and C. de la Taille for stimulating and fruitful discussions.

## References

* [1] ATLAS Collaboration, Liquid Argon Calorimeter Technical Design Report, CERN/LHCC/96-41. (1996).
* [2] D.M.Gingrich et al., RD3 Collaboration, Nucl. Instrum. Methods A364 (1995) 290.
* [3] W.E.Cleland and E.G.Stern, Nucl. Instrum. Methods A338 (1994) 467.
* [4]_Developments towards the final LARG calorimeter calibration board_, J.Colas et al., ATLAS internal note, ATLAS-AL-EN-0006 (June 1999).