**Global \(\chi^{2}\) approach to the Alignment of the ATLAS Silicon Tracking Detectors**

**P. Bruckman**

University of Oxford

DWB, Keble Road

Oxford OX1 3RH, UK

and

Institute of Nuclear Physics PAN

ul. Radzikowskiego 152 Krakow 31-342, Poland

e-mail: P.Bruckman1@physics.ox.ac.uk

**A.Hicheur, S.Haywood**

Rutherford Appleton Laboratory

Chilton DIDCOT

OX11 0QX, UK

e-mails: A.Hicheur@rl.ac.uk, S.Haywood@rl.ac.uk

The fundamental linear expansion formalism proposed for the offline alignment of the ATLAS silicon tracking system is presented.

###### Contents

* 1 Introduction
* 2 The Least Squares Linear Expansion
* 3 Fitting a Common Event Vertex
* 4 Adding External Constraints
* 5 Derivatives of the residuals
	* 5.1 General formalism
	* 5.2 Derivatives with respect to the track parameters
	* 5.3 Derivatives with respect to the alignment parameters
	* 5.4 Derivatives with respect to the common vertex coordinates
	* 5.5 Derivatives with respect to the scattering angles
	* 5.6 Comments about the derivatives
* 6 Conclusions
* A The reference solution for the most general case including the common vertex fit per event and various external constraints
* without and with the explicit fit of MCS deflection angles
* C Some comments on the linear approximation
* D An approximate solution

Introduction

Alignment of the ever growing tracking systems of the modern HEP experiments becomes more and more challenging. Not only do numbers of degrees of freedom rapidly grow but the requirements for the final alignment accuracy get more ambitous due to the desire for greater measurement precision.

The silicon tracking system of the ATLAS detector consists of two subsystems: the PIXel detector and the SCT silicon strip detector. The subsystems are composed of 1744 and 4088 individual modules respectively. The entire system involves nearly 35,000 DoF's! Additional difficulty arises from the fact that the magnetic field in the corresponding tracking volume will be highly nonuniform making all tracking-related calculations (e.g. track extrapolations) nonanalytic and therefore complicated. The basic assessment of the alignment challenge together with physics motivated requirements were formulated in [1] and [2].

In this paper we present the fundamental algebraic formalism at the heart of the current base-line alignment algorithms proposed for the ATLAS silicon. Its main advantage is simplicity and elegance while the major drawback might turn out to be the natural limitation of the linear approximation adopted here and the difficulty of the numerical calculations.

## 2 The Least Squares Linear Expansion

The alignment algorithm is based on the minimization of a "giant \(\chi^{2}\)" defined as:

\[\chi^{2}=\sum_{tracks}r^{T}V^{-1}r\quad\mbox{where}\quad r_{i}\equiv(\vec{m} _{i}-\vec{e}_{i}(\pi,a)).\hat{k} \tag{1}\]

Here \(\vec{e}_{i}\) denotes the \(i\)'th intersection point of the extrapolated track with a sensor plane and \(\vec{m}_{i}\) is the position of the associated detector hit. \(\hat{k}\) is the unit vector defining the measurement direction for the sensor plane1. The intersection point depends on both track parameters (\(\pi\)) as well as on the subset of alignment parameters related to the intersected module (\(a\)). \(r\) is the vector of residuals for a given track. \(V\) is the covariance matrix of \(r\). Generally \(V\) is not diagonal due to contribution from the Multiple Coulomb Scattering (\(V=V_{\rm meas}+V_{\rm MCS}\)). The notation is, however, equally valid for the case when a track is defined not only by its five perigee parameters but also by the set of MCS deflection angles on the measurement planes. See Appendix B for the details.

Footnote 1: Recall that for a PIXel detector, each physical hit corresponds to two distinct measurements (2D) and therefore gives rise to two residuals along two measurement directions.

We are looking for the solution of the minimisation problem with respect to the alignment parameters. Therefore, we require that the minimum satisfies:

\[\frac{d\chi^{2}}{da}=0\quad\Longrightarrow\quad\sum_{tracks}\frac{dr^{T}}{da }V^{-1}r=0 \tag{2}\]

As a first step, we need to find the solution for track parameters for any arbitrary alignment. This is nothing else but an ordinary track fit:

\[\frac{\partial\chi^{2}}{\partial\pi}=0\quad\Longrightarrow\quad\frac{ \partial r}{\partial\pi}^{T}V^{-1}r=0 \tag{3}\]To find the solution we must expand the residuals around their initial values \(r_{0}\). We use the first linear term only under the assumption: \(\frac{\partial^{2}r}{\partial\pi_{0}\partial\pi_{j}}\to 0\), i.e the extrapolated points are a linear function of track parameters, for small changes (see Appendix C for more detailed discussion of the validity of the above assumption). Having expanded around the initial value \(\pi_{0}\), we have:

\[\frac{\partial r}{\partial\pi_{0}}^{T}V^{-1}(r(\pi_{0},a)+\frac{\partial r}{ \partial\pi_{0}}\delta\pi)=0 \tag{4}\]

where \(\frac{\partial r}{\partial\pi_{0}}\equiv\frac{\partial r}{\partial\pi}|_{\pi= \pi_{0}}\). We then get the solution for the track parameters:

\[\pi=\pi_{0}+\delta\pi=\pi_{0}-\left(\frac{\partial r^{T}}{\partial\pi_{0}}V^{ -1}\frac{\partial r}{\partial\pi_{0}}\right)^{-1}\frac{\partial r^{T}}{ \partial\pi_{0}}V^{-1}r(\pi_{0},a) \tag{5}\]

Effectively, this provides a solution for \(\pi\) as a function of \(a\), which can be reinserted implicitly into the global \(\chi^{2}\) definition. Now let us get back to Equation 2. In exact analogy to the solution for track parameters, we can write down the set of linear equations defining the solution for the alignment:

\[\left(\sum_{tracks}\frac{dr^{T}}{da_{0}}V^{-1}\frac{dr}{da_{0}}\right)\delta a +\sum_{tracks}\frac{dr^{T}}{da_{0}}V^{-1}r(\pi_{0},a_{0})=0 \tag{6}\]

Because \(r\) is a function of \(\pi\) and \(a\) the full derivative from Eq. 6 can be written as:

\[\frac{dr}{da_{0}}=\frac{\partial r}{\partial a_{0}}+\frac{\partial r}{ \partial\pi_{0}}\frac{d\pi}{da_{0}} \tag{7}\]

\(\frac{d\pi}{da_{0}}\) is obtained by differentiating Equation 5.

From Eq. 5 and Eq. 7 we get the final expression for the full derivative:

\[\frac{dr}{da_{0}}=\left(\mathbbm{1}-\mathds{E}(\mathds{E}^{T}V^{-1}\mathds{E} )^{-1}\mathds{E}^{T}V^{-1}\right)\frac{\partial r}{\partial a_{0}}\quad\text{ where}\quad\mathds{E}\equiv\frac{\partial r}{\partial\pi_{0}}, \tag{8}\]

which together with Equation 6 gives us the corrections to the alignment parameters which satisfy Eq. 2:

\[\delta a=-\underbrace{\left(\sum_{tracks}\frac{\partial r^{T}}{\partial a_{ 0}}W\frac{\partial r}{\partial a_{0}}\right)}_{\mathcal{M}}-\underbrace{ \sum_{tracks}\frac{\partial r^{T}}{\partial a_{0}}Wr(\pi_{0},a_{0})}_{ \mathcal{V}} \tag{9}\]

where we substituted:

\[W\equiv V^{-1}\hat{W}\equiv V^{-1}-V^{-1}E(E^{T}V^{-1}E)^{-1}E^{T}V^{-1} \tag{10}\]

and use the relation:

\[\hat{W}V^{-1}\hat{W}=W. \tag{11}\]

\(\frac{\partial r}{\partial a_{0}}\equiv\frac{\partial r}{\partial a}|_{\pi= \pi_{0},\ a=a_{0}}\). \(\mathcal{M}\equiv\left(\sum_{tracks}\frac{\partial r^{T}}{\partial a_{0}}W \frac{\partial r}{\partial a_{0}}\right)\) is a symmetric \(n\times n\) matrix where \(n\) is the number of alignment DoF's. At this point, one expects that many elements of matrix \(\mathcal{M}\) will be null since there is no connection between modules which are well separated in \(\eta\) and \(\phi\).

Fitting a Common Event Vertex

In the previous section we presented the basic calculation leading to the Least Squares solution for alignment parameters with an implicit refit of all considered tracks. A natural and very powerful extension to this formalism comes from the requirement of a common origin (vertex) for certain subsamples of tracks. For simplicity hereafter, they will be denoted as belonging to a common "event". As before we start from the expression for the global \(\chi^{2}\) (equation 1) but now the we have double summation over the events and tracks within an event. Tracks are no more described by their usual five perigee parameters. Only three independent parameters per track remain (\(\pi=(\phi,\ \cot\!\theta,\ Q/p_{\rm T})\)). Impact parameters are replaced by the common vertex for the event (\(b=(x_{0},y_{0},z_{0})\)). The residuals take the form:

\[r\equiv(\vec{m}-\vec{e}(\pi,b,a)).\hat{k} \tag{12}\]

and depend explicitely on three different sets of parameters:

1. \(\pi\) - individual track parameters,
2. \(b\) - vertex position common for an event,
3. \(a\) - alignment parameters common to all events in the dataset.

Let us first find the position of the vertex itself given an arbitrary but fixed alignment. In exact analogy to the solution for \(a\) in section 2 we obtain:

\[b=b_{0}+\delta b=b_{0}-\underbrace{\left(\sum_{tk}^{ev}{\rm F}^{T}W{\rm F} \right)}_{M_{b}}-^{1}\sum_{tk}^{ev}{\rm F}^{T}Wr(\pi_{0},b_{0},a)\quad\mbox{ with}\quad{\rm F}\equiv\frac{\partial r}{\partial b} \tag{13}\]

It should be noted that in order for this formalism to work, all tracks used within an event must originate from the same \(b_{0}\).

The generic form of the solution for alignment parameters resulting from Eq. 12 is:

\[\delta a=-\left(\sum_{ev}\sum_{tk}^{ev}\frac{dr}{da_{0}}^{T}V^{-1}\frac{dr}{ da_{0}}\right)^{-1}\left(\sum_{ev}\sum_{tk}^{ev}\frac{dr}{da_{0}}^{T}V^{-1}r( \pi_{0},b_{0},a_{0})\right) \tag{14}\]

but now \(\frac{dr}{da}\) has more complicated structure.

\[\begin{array}{l}\frac{dr}{da}=\frac{\partial r}{\partial a}+{\rm E}\frac{d \pi}{da_{0}}+{\rm F}\frac{db}{da}\\ \frac{db}{da}=-({\rm E}^{T}V^{-1}{\rm E})^{-1}{\rm E}^{T}V^{-1}(\frac{\partial r }{\partial a}+{\rm F}\frac{db}{da})\\ \frac{db}{da}=-M_{b}^{-1}\left(\sum_{tk}^{ev}{\rm F}^{T}W\frac{\partial r}{ \partial a}\right)\end{array} \tag{15}\]

where E, F and \(W\) are defined as before. From Eq. 15 we further find:

\[\frac{dr}{da}=\hat{W}\alpha_{a}^{r}\quad\mbox{where}\quad\alpha_{a}^{r}\equiv \frac{\partial r}{\partial a}-{\rm F}M_{b}^{-1}\left(\sum_{tk}^{ev}{\rm F}^{ T}W\frac{\partial r}{\partial a}\right) \tag{16}\]

Equation 14 and Eq. 16 combined yeld the solution for the alignment:

\[\delta a=-\underbrace{\left(\sum_{ev}\sum_{tk}^{ev}{\alpha_{a}^{r}}^{T}W \alpha_{a}^{r}\right)}_{\mathcal{M}}-\underbrace{\sum_{ev}\sum_{tk}^{ev}{ \alpha_{a}^{r}}^{T}Wr(\pi_{0},b_{0},a_{0})}_{\mathcal{V}} \tag{17}\]where we used again the identity 11. Note that with the imposed common vertex, the solution again includes the \(n\times n\) symmetric error matrix \(\mathcal{M}^{-1}\). However, this time, none of the matrix elements are identically zero. Given a large number of tracks, the matrix will be fully populated.

Correlations have three sources:

1. DoF's of a single module,
2. correlations through a common track,
3. tracks emerging from a common vertex!

## 4 Adding External Constraints

The solutions presented so far do not allow for any external constraints imposed on the solution. In the most general case we could have constraints on:

1. track parameters (\(\pi\)),
2. beam constraint (\(b\)),
3. alignment parameters (\(a\)).

The above should be thought of as additional bi-linear terms in the \(\chi^{2}\) expression. The contraints in general may not be linear but these have to be linearised before they can enter the proposed formalism. In the following we sketch an example of a constraint on track parameters within the formalism without the vertex fit. To start with, let us recall the implication of the constraints on the individual track fit.

\[\chi^{2}=r(\pi)^{T}V^{-1}r(\pi)+(\pi-x)^{T}S^{-1}(\pi-x), \tag{18}\]

where vector \(x\) and covariance matrix \(S\) define the constraint of \(\pi\). The linear expansion of the \(\chi^{2}\) expression 18 leads to the solution:

\[\delta\pi=-\left(\mathds{E}^{T}V^{-1}\mathds{E}+S^{-1}\right)^{-1}\left( \mathds{E}^{T}V^{-1}r(\pi_{0},a)+S^{-1}(\pi_{0}-x)\right) \tag{19}\]

Propagation of the constraint to the global alignment fit does not present any major complication. Let us start from the modified \(\chi^{2}\) definition:

\[\chi^{2}=\sum_{tracks}\left(r(\pi,a)^{T}V^{-1}r(\pi,a)+(\pi-x)^{T}S^{-1}(\pi- x)\right), \tag{20}\]

The following lines show briefly how the final solution is obtained using the first order linear expansion of the \(\chi^{2}\) expression around the minimum. For brevity we adopt the simplified notation: \(J\equiv\mathds{E}^{T}V^{-1}\mathds{E}+S^{-1}\), \(r_{0}\equiv r(\pi_{0},a_{0})\) & \(\frac{\partial r}{\partial a}\equiv\frac{\partial r}{\partial a_{0}}\) in all cases.

\[\begin{array}{l}\frac{d\chi^{2}}{da}=0\\ \Downarrow\\ \sum_{tracks}\left(\frac{d\pi}{da}^{T}V^{-1}(r_{0}+\frac{dr}{da}\delta a)+ \frac{d\pi}{da}^{T}S^{-1}(\pi_{0}+\frac{d\pi}{da}\delta a-x)\right)=0\\ \frac{dr}{da}=\frac{\partial r}{\partial a}+\mathds{E}\frac{d\pi}{da}\quad \text{and}\quad\frac{d\pi}{da}=-J^{-1}\mathds{E}^{T}V^{-1}\frac{\partial r}{ \partial a}\end{array} \tag{21}\]

[MISSING_PAGE_EMPTY:7]

Derivatives of the residuals

In the global \(\chi^{2}\) minimisation detailed in the previous sections, one can see that the main ingredients to derive the alignment parameters are error matrices and the derivatives of residuals with regard to track and alignment parameters, vertex coordinates, and scattering angles. The error matrices are inputs from measurements or fits performed earlier in the reconstruction chain (e.g scattering angles RMS). The aim of this section is to explain how the different derivatives of the residuals are obtained.

### General formalism

Consider \(\hat{X},\hat{Y},\hat{Z}\)-the unit vectors defining the module local frame. \(\hat{X}\) is in the direction crossing the strips and \(\hat{Y}\) is along the strips. \(\hat{Z}\) is the normal to the plane.

The two residuals, in the detector plane, are then defined by:

\[res_{X} =(\vec{m}-\vec{e}).\hat{X} \tag{26}\] \[res_{Y} =(\vec{m}-\vec{e}).\hat{Y}\]

The derivatives of these quantities wrt a given parameter \(p\) are:

\[\frac{\partial res_{X}}{\partial p} =-\frac{d\vec{e}}{dp}.\hat{X} \tag{27}\] \[\frac{\partial res_{Y}}{\partial p} =-\frac{d\vec{e}}{dp}.\hat{Y}\]

The position of a point on the trajectory is characterised by \(l\), the path length. The intersection point is defined by \((\vec{e}-\vec{m}).\hat{Z}=0\). Usually, this equation is solved by iteration, as it cannot be solved analytically.

From this equation, we extract \(l_{int}\), i.e the path length at the intersection point. Note that this quantity is an implicit function of \(p\).

Now we can compute \(\frac{d\vec{e}}{dp}\):

\[\frac{d\vec{e}}{dp}=\frac{\partial\vec{e}}{\partial p}+\frac{\partial\vec{e}} {\partial l_{int}}.\frac{dl_{int}}{dp} \tag{28}\]

where \(\frac{\partial\vec{e}}{\partial l_{int}}\equiv\frac{\partial\vec{e}}{\partial l }|_{l=l_{int}}\) and \(\frac{dl_{int}}{dp}\) is derived by differentiating the intersection equation, \((\vec{e}-\vec{m}).\hat{Z}=0\), with respect to \(p\) and taking into account the fact that \(l_{int}\) is an implicit function of \(p\):

\[\frac{d((\vec{e}-\vec{m}).\hat{Z})}{dp}=\frac{d(\vec{e}.\hat{Z})}{dp}=\frac{ \partial(\vec{e}.\hat{Z})}{\partial p}+\frac{\partial(\vec{e}.\hat{Z})}{ \partial l_{int}}\frac{dl_{int}}{dp}=0\]

And then:

\[\frac{dl_{int}}{dp}=-\frac{\frac{\partial(\vec{e}.\hat{Z})}{\partial p}}{ \frac{\partial(\vec{e}.\hat{Z})}{\partial l_{int}}} \tag{29}\]

Then, the final formulae for the residual derivatives are:\[\frac{\partial res_{X}}{\partial p}=-(\frac{\partial\vec{e}}{\partial p}-\frac{ \partial\vec{e}}{\partial l_{int}}\frac{\frac{\partial(\hat{e}.\hat{Z})}{ \partial p}}{\partial l_{int}}).\hat{X} \tag{30}\]

\[\frac{\partial res_{Y}}{\partial p}=-(\frac{\partial\vec{e}}{\partial p}-\frac {\partial\vec{e}}{\partial l_{int}}\frac{\frac{\partial(\hat{e}.\hat{Z})}{ \partial p}}{\frac{\partial(\hat{e}.\hat{Z})}{\partial l_{int}}}).\hat{Y}\]

which can be rewritten:

\[\frac{\partial res_{\alpha}}{\partial p}=-\frac{\partial\vec{e}}{\partial p}.(\hat{\alpha}-\frac{\frac{\partial\vec{e}}{\partial l_{int}}.\hat{\alpha}}{ \frac{\partial\vec{e}}{\partial l_{int}}.\hat{Z}}\hat{Z}) \tag{31}\]

where \(\alpha=X,Y\).

\(\frac{\partial\vec{e}}{\partial l_{int}}\) is the tangent to the track at the intersection point: in other words, it gives the direction of the straight line representing the local approximation of the track.

In the local module frame, we define the direction of the track as \((\Phi,\Theta)\). Then, the above equation becomes:

\[\frac{\partial res_{X}}{\partial p}=-\frac{\partial\vec{e}}{ \partial p}.(\hat{X}-cos(\Phi)tan(\Theta)\hat{Z}) \tag{32}\] \[\frac{\partial res_{Y}}{\partial p}=-\frac{\partial\vec{e}}{ \partial p}.(\hat{Y}-sin(\Phi)tan(\Theta)\hat{Z})\]

The vectors \(\overrightarrow{proj}_{X}\equiv\hat{X}-cos(\Phi)tan(\Theta)\hat{Z}\) and \(\overrightarrow{proj}_{Y}\equiv\hat{Y}-sin(\Phi)tan(\Theta)\hat{Z}\) are the projection directions along which the change of the extrapolation is computed.

### Derivatives with respect to the track parameters

The track parameters are denoted by \(\pi=\{a_{0},z_{0},\phi_{0},cotan(\theta),q/p_{T}\}\). From the results found before, the derivatives of the residuals can be written as:

\[\frac{\partial res_{\alpha}}{\partial\pi}=-\frac{\partial\vec{e}}{\partial \pi}.\overrightarrow{proj}_{\alpha} \tag{33}\]

where \(\alpha=X,Y\).

### Derivatives with respect to the alignment parameters

The vision we adopt here is that the hit is "stuck" to the module and we study the effect of the translations and rotations of the module on the intersection with the extrapolated track, and therefore on the residuals. Note that here, we are defining partial derivatives that only involve residuals of hits belonging to the module being displaced. Generally, the motion of a given module can have an influence on residuals calculated in other modules and this is taken into account in the total derivative of the residuals, \(\frac{dr}{da}\), defined in the equations 7 and 15.

Let's call \(T_{X},\ T_{Y},\ T_{Z}\) the translation parameters and \(R_{X},\ R_{Y},\ R_{Z}\) the rotation parameters.

Following the same methodology developped in the previous subsection, we find:

\[\frac{\partial res_{\beta}}{\partial T_{\alpha}} = \hat{\alpha}.\overrightarrow{proj}_{\beta} \tag{34}\] \[\frac{\partial res_{\beta}}{\partial R_{\alpha}} = (\hat{\alpha}\times\overrightarrow{lever}).\overrightarrow{ proj_{\beta}}\]

where \(\alpha=X,Y,Z;\ \beta=X,Y,\ \overrightarrow{lever}=\overrightarrow{OM}\), \(O\) being the centre of the module and \(M\) is the intersection point of the track.

### Derivatives with respect to the common vertex coordinates

Let \((v_{x},v_{y},v_{z})\) be the primary vertex position in the global frame.

The derivatives of the residuals with regard to the primary vertex coordinates are therefore:

\[\frac{\partial res_{\alpha}}{\partial v_{i}}=\hat{n}_{i}. \overrightarrow{proj_{\alpha}} \tag{35}\]

where \(\alpha=X,Y\), \(i=x,y,z\), and \(\hat{n}_{x}=(1,0,0),\ \hat{n}_{y}=(0,1,0),\ \hat{n}_{z}=(0,0,1)\), in the global frame.

### Derivatives with respect to the scattering angles

Consider two scattering planes (i.e modules) \(a\) and \(b\). We study the effect of the scattering occuring through plane \(a\) on the residuals computed in plane \(b\).

If \(a\geq b\), i.e the track passes through plane \(b\) before plane \(a\), then the answer is trivial: the derivatives of the residuals computed in plane \(b\) with regard to the scattering occuring later in plane \(a\) are null.

If \(a<b\): following the same formalism used in the previous paragraphs, we get:

\[\frac{\partial res^{b}_{\alpha}}{\partial\Psi^{a}}=-\frac{\partial \bar{e}^{b}}{\partial\Psi^{a}}\overrightarrow{proj_{\alpha}^{b}} \tag{36}\]

where \(\Psi=\Theta,\Phi\) are the scattering angles.

The quantity \(\frac{\partial\bar{e}^{b}}{\partial\Psi^{a}}\) represents the rate of the variation \(\delta\bar{e}^{b}\) of the intersection point of the track with plane \(b\), given a change in the scattering angle in plane \(a\), \(\delta\Psi^{a}\) (the path length is fixed here).

Changing the angle \(\Theta^{a}\) by \(\delta\Theta^{a}\) is equivalent to a rotation of angle \(\delta\Theta^{a}\) about the axis \(\vec{u}^{a}_{\phi}\) whose centre is \(\vec{e}^{u}\), where \((\vec{u}^{a}_{r},\vec{u}^{a}_{\phi},\vec{u}^{a}_{\theta})\) are the local axes corresponding to the local frame of module \(a\), in spherical coordinates (\(\vec{u}^{a}_{r}\) is along the track direction at the point \(\vec{e}^{u}\)). Thus, the variation of the position of the intersection point in plane \(b\) is:

\[\delta\vec{e}^{b} = \delta\Theta^{a}\vec{u}^{a}_{\phi}\times(\vec{e}^{b}-\vec{e}^{a})\] \[= \delta\Theta^{a}(-sin(\Phi^{a})\hat{X}^{a}+cos(\Phi^{a})\hat{Y}^{ a})\times(\vec{e}^{b}-\vec{e}^{a})\]In the same way, changing the angle \(\Phi^{a}\) by \(\delta\Phi^{a}\) is equivalent to a rotation of angle \(\delta\Phi^{a}\) about the axis \(\hat{Z}^{a}\) whose centre is \(\vec{e}^{a}\):

\[\delta\vec{e}^{b}=\delta\Phi^{a}\hat{Z}^{a}\times(\vec{e}^{b}-\vec{e}^{a}) \tag{38}\]

Equation 36 becomes then:

\[\frac{\partial res^{b}_{\alpha}}{\partial\Theta^{a}} = -[(-sin(\Phi^{a})\hat{X}^{a}+cos(\Phi^{a})\hat{Y}^{a})\times(\vec{ e}^{b}-\vec{e}^{a})].\overrightarrow{proj^{b}_{\alpha}} \tag{39}\] \[\frac{\partial res^{b}_{\alpha}}{\partial\Phi^{a}} = -[\hat{Z}^{a}\times(\vec{e}^{b}-\vec{e}^{a})].\overrightarrow{ proj^{b}_{\alpha}}\]

### Comments about the derivatives

A certain number of points are worth being mentionned about these derivatives:

* The formulae shown in equation 32 are general and do not depend on any assumption about the trajectory.
* However, for the derivatives with regard to track parameters, one needs underlying assumptions, such as constant magnetic field, to get them analytically. The possible concern is that the non-uniformity of the magnetic field will have to be taken into account, particularly in the endcaps region where the field varies more rapidly.
* Following the comments in the previous point, the alternative we envisage is that the derivatives with respect to the track parameters may be calculated numerically or semi-numerically since from equation 32, only \(\frac{\partial\vec{e}}{\partial p}\) would have to be calculated numerically. We can hope that the analytical derivatives will be precise enough, at least for the barrel region, and we will try to avoid, whenever it is possible, to use a numerical derivation, to save computing time.

Conclusions

A simple, generic formalism to solve an arbitrary track alignment problem has been presented. The solution is based on the minimisation of the generalised \(\chi^{2}\) and uses the first order linear expansion of the latter. The formalism has number of apparent features: Good points:

* It makes maximal use of the reconstruction information, in a well defined way allowing all the DoF to be fitted (apart from few degenerate modes).
* In principal, it converges in one pass (provided that the update required to the alignment is not too big)
* It can deal with the non-uniform B-field.
* Possibility of adding constraints: \(E/p\) comes as a natural constraint, adding the following term to the \(\chi^{2}\): \((E/p-1)^{2}/\sigma^{2}\), as well as \(Z\rightarrow\mu^{+}\mu^{-}\) for the alignment-dependent mass scale calibration, adding \((m_{\mu\mu}-m_{Z})^{2}/\Gamma^{2}\) to the global \(\chi^{2}\).

Points of concern:

* The solution requires solving a system of \(n\) linear equations with \(n\) parameters where \(n\) is the number of DoF's of the system. The task is numerically challenging. Some considerations about possible strategies are given in Appendix D.
* may require iterations.

## References

* [1] S. Haywood, _Offline Alignment and Calibration of the Inner Detector'_, ATLAS Internal Note, ATL-COM-INDET-99-001 (1999)
* [2] ATLAS Collaboration, ATLAS Detector and Physics Performance TDR, ATLAS TDR 15, CERN/LHCC/99-15, 25 May 1999.