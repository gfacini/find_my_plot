ATLAS Internal Note

C AL-NO-084

April 2, 1996

**A Study of Pileup Noise in the Barrel and Endcap Calorimetry**

**R.A. Davis**

**Centre for Subatomic Research**

**University of Alberta**

**Edmonton, Alberta**

**Canada**

**T6G 2N5**

**P. Savard**

**Laboratoire de Physique Nucleaire**

**Universite de Montreal**

**Montreal, Quebec**

**Canada**

**H3C 3J7**

**April 2, 1996**

###### Abstract

Analysis of some 1000 fully simulated pileup events in the barrel and endcap calorimeters is presented. The rms of the energy distribution for cones of various areas centred at different values of \(\eta\) are shown. The longitudinal dependence of the pileup noise is also studied along with the correlation of cells in common longitudinal towers. Fully simulated pileup results are compared to particle level results and other approximations of the pileup noise. Finally, the difficulties in creating fully simulated pileup events are described and suggestions for more efficient pileup event production are discussed.

Introduction

As the ATLAS detector simulations become more sophisticated, the addition of minimum bias pileup noise will become necessary for precise modelling of the detector response. For some physics channels, the reduction of high luminosity pileup noise through suitable cuts at the cell level or by a given choice of jet cone size will have a significant impact on how the analyses of the signal and backgrounds are carried out.

Inclusion of pileup noise in fully simulated physics events is severely hampered by the amount of memory necessary to handle pileup events in a detailed manner. At high luminosity (\(10^{34}\) cm\({}^{-2}\) s\({}^{-1}\)), an average of about 23 minimum bias events per bunch crossing is expected. Generation of pileup _events_ requires the combination of a number of bunch crossings that depends on the assumed response for the various detectors in question. In particular, for the liquid argon calorimeter system, the bipolar shaping functions have a response to a triangular signal that lasts for over 500 ns. Thus, over 20 bunch crossings must be taken into account which results in an average pileup event being made up of about 500 minimum bias events. This results in the vast majority of calorimeter cells receiving some energy deposition and causes the size of the GEANT HITS bank to become very large. To bypass this difficulty, various approximations have been used in the past and are compared to fully simulated pileup events in this note. Some strategies are also proposed to more efficiently allow the production and merging of pileupevents.

This note begins with a description of the methods used to generate the pileup events in the barrel and endcap calorimeters. This is followed by a study of the rms of the pileup energy as a function of area in both the barrel and endcap calorimeters. The dependence of the pileup energy rms on longitudinal depth and the associated longitudinal cell energy correlations are also studied. An evaluation of the probability of jets being reconstructed from pileup noise is performed. A comparison of the fully simulated results with particle level pileup and the equivalent in-time bunch crossing approximation is made. Finally, a discussion of the results including suggestions for the improvement of pileup event generation is presented.

## 2 Generation of Pileup Events

### Generation and Simulation of Minimum Bias Events

Minimum bias events were generated using ATGEN/PYTHIA version 5.7 with the data cards shown in table 1. A total of 16000 minimum bias events were generated for the particle level study while 5000 were produced for the full simulation study.

The output of the generator was read by the ATLAS simulation program DICE version 1.09 which used GEANT 3.2130. Two geometries were used depending on the pileup generation method. The first method used the standard TP0 geometry while the second method used a modified version of the TP3 geometry where the endcap preshower was removed and the electromagnetic endcap and hadronic endcap calorimeters were moved 7 cm closer to the interaction point in \(z\). This placed the front face of the electromagnetic endcap at 357.6 cm from the interaction point in \(z\). All detector components used in the TP3 method conformed to the standard ATL-TP3 geometries except for a refined hadronic endcap module. This modified hadronic endcap geometry included all cracks as well as the copper/kapton electrodes inside the liquid argon. The definition of individual detector elements in the hadronic endcap geometry allowed the use of real calorimeter cells and not the perfectly projective \((\eta,\phi)\) towers present in the TP0 geometry. The hadronic endcap geometry used is essentially identical to the one included in the present version of DIC E95 and followed the specifications of the engineering diagram shown in figure 1.

The GEANT default kinematic cuts were applied during the generation

\begin{table}
\begin{tabular}{||c|c||} \hline MSEL=1 & Jet production \\  & 2 \(\rightarrow\) 2 processes. \\ \hline MSTP(2)=2 & 2\({}^{nd}\) Order running \(\alpha_{s}\). \\ \hline MSTP(33)=3 & K-factor. \\ \hline MSTP(81)=1 & Multiple interactions with \\ MSTP(82)=4 & varying impact point. \\ \hline MSTJ(22)=2 & Particle decays only if \(\tau\geq 10\)nm. \\ \hline \end{tabular}
\end{table}
Table 1: Data cards used in the production of minimum bias events using ATGEN/Pythia.

Figure 1: A cross section of the hadronic endcap geometry which was simulated in the TP3 pileup production method of this note. This geometry is essentially identical to the present DICE95 implementation of the hadronic endcap and includes all inter-plate gaps and Cu/Kapton electrodes.

for both methods of fully simulated pileup production. The hadronic transport package used during the generation for both methods was GEANT-FLUKA.

### 2.2 Production of Pileup Events

Two different software procedures were used to produce pileup events from the fully simulated minimum bias events described in the previous section. The first method was used for hits produced in the TP0 geometry and will be referred to in this work as the TP0 method. In this method, the SLUG software was modified to produce minimum bias events directly in a much more memory efficient manner than was previously possible. This method was also used for studies that required data from both the endcap and barrel calorimeters simultaneously such as the pileup energy distribution in the transition region between the endcap and the barrel.

The second method was used only in the endcap region and consisted of a stand-alone program which created pileup events from a \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) energy matrix produced for each minimum bias event. The minimum bias events used for this method were simulated using the modified TP3 geometry with the non-projective towers as described in the previous section. This method will be referred to in the rest of this note as the TP3 method.

There were several reasons for using two geometries and the resulting two methods for fully simulated pileup production. As the main goal of the present study was to make a detailed evaluation of the pileup noise in the endcap region using the currently proposed readout structure and an up to date and very detailed geometry, the TP3 geometry with the modified hadronic endcap was selected for generation in the endcap region. However, in order to merge physics signals with fully simulated pileup noise in the ATRECON reconstruction software, a compatible (TP0) geometry had to be used for generation. Since physics events had already been generated in the TP0 geometry for an upcoming study requiring pileup, it wasnatural to also produce pileup in the TP0 geometry in order to study merging methods that could be used in later work.

Pileup events were also generated at particle level directly from the ATGEN output mentioned above. These events were analysed to provide a comparison and consistency check for the fully simulated results. A more detailed description of each of the pileup production methods is presented below.

#### 2.2.1 Production of Particle Level Pileup Events

For the production of particle level pileup events, the energy deposited by particles from minimum bias events was binned in a \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) array. The number of bunch crossings was determined so as to span the temporal interval for which the shaping response returned a non zero value. This corresponded to 22 bunch crossings in the past and one in the future in addition to the in-time bunch crossing for a total of 24 bunch crossings. For every bunch crossing a random number (taken from a Poisson distribution with a mean of 23) was obtained to determine how many minimum bias events were to be included in that bunch crossing.

The calorimeter was divided into barrel (\(0<|\eta|<1.5\)) and endcap (\(1.5<|\eta|<3.2\)) regions. The electromagnetic liquid argon shaping function was used for the entire barrel region and the hadronic liquid argon shaping function was used for the entire endcap region. Suitable shaper functions are used and are shown in table 2 and figure 2. The energy deposited in each cell by every minimum bias event contained in a given bunch crossing was multiplied by the shaper response function for the time corresponding to the bunch crossing in question and added in a cumulative manner into the energy array. When all bunch crossings comprising a pileup event were completed, the energy array was written to a ntuple.

For the production of particle level pileup events, it was only possible to use only one shaping function for each longitudinal tower as there was no longitudinal information in the particle level data. As can be seen in figure 2, the electromagnetic liquid argon and the hadronic liquid argon calorimeter shaping functions used are quite similar. Although the use of only one shaping function per tower is perhaps of less importance in the endcap region because of the similar shaping functions for the electromagnetic and hadronic endcap calorimeters, this is not the case for the barrel region where the tile calorimeter has a very different shaping function. The particle level results are compared to those of the full simulation in section 4 below.

#### 2.2.2 Production of Fully Simulated Pileup Events: TP0 Geometry

The current SLUG software allows the user to merge minimum bias events with physics events but does not allow the use of negative values once the energy deposition is convoluted with a bipolar shaper response. Secondly, the merging of minimum bias events into bunch crossings is performed in a linear chain. This means that the hits from each of the 23 minimum bias events in each of the 22 bunch crossings are stored one after the other in memory instead of only keeping track of the total energy deposited in a given cell by all minimum bias events in a pileup event. For 500 events this clearly requires enormous amounts of memory from the working machine. The current SLUG software was therefore modified to remedy these two problems.

The production method followed the one used for particle level pileup except that the shaping functions of individual calorimeters were considered since access to longitudinal information was available in the fully simulated data. The energy arrays were written on the GEANT HITS bank with a modification to allow negative values. Thus, the new HITS banks consisted of true _pileup events_ and therefore could be more accurately described as DIGITS. A total of 500 pileup events in the TP0 geometry were created using this method.

#### 2.2.3 Production of Fully Simulated Pileup Events: Modified TP3 Geometry

The procedure for producing pileup eventsintheendcapandbarreladimeters differed from each other only in that a standalone procedure was used in the former case rather than a modification of the SLUG software.

An array containing the energy deposited in each cell in the endcap region was filled for each fully simulated minimum bias event. This array was then used as input to the stand alone pileup production routine. This routine first generated a random number (again taken from a Poisson distribution with a mean of 23) and added the given number of minimum bias events together on a cell by cell basis in order to produce one bunch crossing. The energy in each cell of this bunch crossing was then multiplied by the shaping function for the appropriate calorimeter and bunch crossing time and added to the energy array. The electromagnetic and hadronic shaping functions used in the endcap were again taken from table 2 and figure 2.

When a sufficient number of bunch crossings had been added to the temporary array to account for the entire temporal response of the calorimeter (24 bunch crossings in total) the energy array of \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) cells was written out as a complete _pileup event_. The energy array was then cleared and another pileup event created. A total of 1000 pileup events were created in the endcap region in this way.

As a check of the validity of the endcap results, the rms of energy deposited in a \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) cell per bunch crossing at various \(\eta\) values was calculated for the four longitudinal sections of the hadronic endcap. These values are compared to the similar results from reference [3] in figure 3. The results of reference [3] were calculated using a mean of 17.5 minimum bias events per bunch crossing as compared to a mean of 23 minimum bias events per bunch crossing in the current work. As can be seen in figure 3, where the previous results were rescaled to 23 events per bunch crossing, the agreement between the results of reference [3] and the present work is good up to \(\eta=3.05\). The discrepancy at high \(\eta\) can be attributed to the use of an older electromagnetic endcap calorimeter geometry in reference [3] which did not provide full coverage of the hadronic endcap at high \(\eta\).

## 3 Analysis of the Fully Simulated Pileup Events

In the endcap, the digitised energy from each pileup event was binned in an array with a \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) granularity and seven longitudinal segments. The seven longitudinal segments were comprised of three electromagnetic layers and four hadronic layers. In the barrel region the granularity was \(\Delta\eta\times\Delta\phi=0.025\times\pi/128\) and two longitudinal segments were considered: one for the preshower and the electromagnetic calorimeter combined, and one for the tile calorimeter. The standard ATRECON type 2 calibration was used in the barrel. The tile calorimeter calibration constant used was 38.67. The electromagnetic endcap used a calibration constant of 6.0 while 

\begin{table}
\begin{tabular}{||c|c|c|c|c||} \hline Time & EM LAr & Hadronic LAr & Barrel & Tile \\ (ns) & Calorimeters & Calorimeters & Preshower & Calorimeter \\ \hline -25 &.48 &.52 &.42 & 0.50 \\ \hline

[MISSING_PAGE_POST]

0 & 0.00 \\ \hline \end{tabular}
\end{table}
Table 2: Shaping weights applied to each bunch crossing in a pileup event for each of the calorimeters. The electromagnetic shaping function was used for the electromagnetic calorimeters in both the barrel and the endcap regions. For the particle level pileup study, the electromagnetic liquid argon shaping function was used for the barrel region and the hadronic liquid argon shaping function was used for the endcap region.

Figure 2: Response of the bipolar (LAr) and unipolar (tile) shapers versus time for each of the calorimeters used in this study.

Figure 3: Comparison of the energy rms per bunch crossing in \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) cells at various etas in each layer of the hadronic endcap. The circles indicate the results using a detailed endcap geometry while the squares denote the results of reference [3] rescaled to a mean of 23 minimum bias events per bunch crossing.

\begin{tabular}{||c|c|c|c|c||} \hline \multicolumn{2}{||c|}{Barrel} & \multicolumn{2}{c|}{Transition} & \multicolumn{2}{c||}{Endcap} \\ \hline \multicolumn{2}{||c|}{\(\eta<0.6\)} & \multicolumn{2}{c|}{\(0.9<\eta<1.5\)} & \multicolumn{2}{c||}{\(\eta>1.5\)} \\ \hline EM & Hadronic & EM & Hadronic & EM & Hadronic \\ \hline.32 &.06 &.26 &.06 &.25 &.11 \\ \hline \end{tabular}

the hadronic endcap used a constant of 26.0. The same calibration constant was used for each longitudinal sub-layer of a given calorimeter in the endcap.

Table 3 shows the pileup \(E_{\rm T}\) rms per \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) tower as a function of \(\eta\) for three regions. This table uses only the results of the TP0 method of pileup production. The transition from the scintillator tile calorimeters to the liquid argon endcap calorimeters can be seen from the hadronic pileup \(E_{\rm T}\) rms around \(\eta=1.5\). The decrease in the pileup \(E_{\rm T}\) rms for the electromagnetic calorimeters over the three regions reflects the \(\eta\) dependence of the transverse energy of minimum bias events.

As can be seen in figure 4, the agreement between the TP0 and TP3 pileup production methods is very good in the endcap region.

Figure 5 shows the pileup \(E_{\rm T}\) rms as a function of the square root of the cone area for two \(\eta\) centres, one at \(\eta=2.3\) using the TP3 method and the other at \(\eta=0.3\) using the TP0 method. Both the endcap and the barrel results correspond to the pileup \(E_{\rm T}\) rms in the entire depth of

\begin{table} \end{table}
Table 3: Average pileup \(E_{\rm T}\) rms in \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) towers in different \(\eta\) regions for the entire calorimetry system using the TP0 pileup production method. The separate contributions of the electromagnetic and hadronic components of the calorimetry are shown.

Figure 4: Transverse energy rms in \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) towers as a function of the square root of the cone area for the endcap region. The two methods of pileup production using different geometries are compared. The circles are the result of the TP0 geometry production and the squares are the result of the TP3 geometry production using a detailed hadronic endcap simulation with deletion of the endcap preshower.

[MISSING_PAGE_EMPTY:18]

Figure 5: Transverse energy rms versus the square root of the cone area for the barrel (triangles) and endcap (circles) regions of the calorimeter. The barrel region used the TP0 pileup production method with cones centred at \(\eta=0.3\) and the endcap region used the TP3 pileup production method with cones centred at \(\eta=2.3\). The lateral cell uncorrelation limit is plotted as the dotted line.

\begin{table}
\begin{tabular}{||c|c||} \hline Area & \% & Difference \\ \hline \(0.025\,\times\pi/128\) Cell & \(0.8\) \\ \hline \(0.05\,\times\pi/64\) Cell & \(1.8\) \\ \hline \(0.1\,\times\pi/32\) Cell & \(3.1\) \\ \hline \(4\,\,0.1\,\times\pi/32\) Cells & \(5.0\) \\ \hline \(16\,\,0.1\,\times\pi/32\) Cells & \(12.1\) \\ \hline \(36\,\,0.1\,\times\pi/32\) Cells & \(7.6\) \\ \hline \(64\,\,0.1\,\times\pi/32\) Cells & \(7.4\) \\ \hline \(100\,\,0.1\,\times\pi/32\) Cells & \(9.0\) \\ \hline \(144\,\,0.1\,\times\pi/32\) Cells & \(9.6\) \\ \hline \end{tabular}
\end{table}
Table 4: Percent difference between the measured rms \(E_{\text{T}}\) and the longitudinally uncorrelated result for different areas centred at \(\eta=0.3\) using the TP0 pileup production method.

Figure 6: Transverse energy rms versus square root of the cone area for the electromagnetic endcap (circles), hadronic endcap (squares), and the endcap calorimeter as a whole (triangles) using the TP3 pileup production method. The cones were centred at \(\eta=2.3\). The rms was found to increase as area\({}^{0.84}\) for the endcap as a whole, as area\({}^{0.84}\) for the electromagnetic endcap, and as area\({}^{0.74}\) for the hadronic endcap. The uncorrelation limit (addition in quadrature of the EM and hadronic endcap rms values) is also shown by the diamonds.

Figure 7: Transverse energy rms versus square root of the cone area for the electromagnetic portion of the barrel (circles), the hadronic portion of the barrel (squares), and the barrel calorimeter as a whole (triangles) using the TP0 pileup production method. The cones were centred at \(\eta=0.3\). The uncorrelation limit (addition in quadrature of the rms values for the electromagnetic and hadronic portions of the calorimeter) is also shown by the diamonds.

reverse of what would be expected using single particles of a given energy; the deposition of more energy in one segment would imply less energy deposition in another leading to a longitudinal anti-correlation. The fact that a positive correlation is observed with minimum bias events means that the energy fluctuations in the events dominate over the negative correlation. Therefore if a minimum bias event deposits more energy than average in one segment, the other segments will probably have more energy than average as well. The presence of real jets in the minimum bias sample will also contribute to the longitudinal correlation. The positive correlation is also due to the fact that the shaping functions for the different calorimeters are similar enough that their respective weights almost always have the same signs for the duration of the shaping.

To evaluate the probability of finding jets due to pileup noise, the proba

\begin{table}
\begin{tabular}{||c|c||} \hline Area & \% Difference \\ \hline \(1\ 0.1\times\pi\,/\,32\) Cells & 10.8 \\ \hline \(12\ 0.1\times\pi\,/\,32\) Cells & 17.0 \\ \hline \(32\ 0.1\times\pi\,/\,32\) Cells & 19.0 \\ \hline \(52\ 0.1\times\pi\,/\,32\) Cells & 20.0 \\ \hline \(80\ 0.1\times\pi\,/\,32\) Cells & 20.2 \\ \hline \(112\ 0.1\times\pi\,/\,32\) Cells & 19.0 \\ \hline \(156\ 0.1\times\pi\,/\,32\) Cells & 21.0 \\ \hline \end{tabular}
\end{table}
Table 5: Percent difference between the measured rms \(E_{\mathrm{T}}\) and the longitudinally uncorrelated result for different areas centred at \(\eta=2.3\) using the TP3 pileup production method.

Figure 8: Pileup \(E_{\rm T}\) rms versus longitudinal segment for \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) cells at \(\eta=2.3\) using the TP3 pileup production method. Segments 1-3 belong to the electromagnetic endcap and segments 4-7 belong to the hadronic endcap.

Figure 9: Pileup \(E_{\rm T}\) rms versus the square root of the cone area for the seven longitudinal layers of the endcap calorimeter and for the endcap calorimeter as a whole. The cones were centred at \(\eta=2.3\). The uncorrelation limit (dotted line, addition in quadrature) of the seven longitudinal segments is also compared to the rms \(E_{\rm T}\) of the pileup noise in the entire calorimeter in the lower right hand plot.

[MISSING_PAGE_FAIL:26]

Comparison of Full Simulation to Approximation Methods

In order to reduce the computational difficulty and time required to produce fully simulated pileup events for physics analysis, several approximation methods have been used in past studies to account for pileup noise. Two of these methods are compared to the fully simulated results in this note.

The first approximation method considered was _particle level_ pileup noise as described in section 2.2.1. Figure 10 shows the good agreement between particle level results and fully simulated results for the endcap region. As can be seen from the dashed line in figure 10, the particle level results in the endcap agree well with full simulation for larger areas but there is a discrepancy for smaller areas, almost a factor two for a single \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) cell. This discrepancy is considered in section 5 below.

As can be seen in figure 11, the particle level method overestimates the fully simulated pileup \(E_{\mathrm{T}}\) rms in the barrel region by 20-25% because it supposes the same shaping function for both hadronic and electromagnetic calorimeters. This discrepancy occurs despite the fact that relatively more energy is deposited in the electromagnetic than the hadronic calorimetry in the barrel region because of the lower average energy (not \(E_{\mathrm{T}}\)) of minimum bias particles at low \(\eta\).

The second approximation method or _equivalent minimum bias_ method neglects shaping entirely and finds the equivalent number of minimum bias events considered in a single bunch crossing which reproduces the variance of the shaped distribution in a single calorimeter cell. Following the method of [4], we used 2.18 times the number of events per crossing, here 23, giving 50 minimum bias events in a single bunch crossing. The results of this method for the barrel and the endcap are also shown in figures 10 and 11. Figures 12 and 13 show the energy spectrum for different cone areas centred at \(\eta=0.3\) and \(\eta=2.3\). Though the mean and variance of the fully simulated distributions are reproduced, it can be seen that the higher moments are not. This is especially true for smaller cone sizes. However, when the cone area gets larger, the shape of the distribution becomes more Gaussian and the agreement between the fully simulated and equivalent minimum bias distributions becomes better. Figures 10 and 11 confirm that the lateral and longitudinal cell correlations are still present and similar in the equivalent minimum bias approximation.

The probability of a cone containing more than a certain \(E_{\text{T}}\) is compared for the fully simulated and equivalent minimum bias methods in tables 7, 8, and 9. Again the agreement between the two methods is limited. This disagreement is due to the large number of events far in the tails of the equivalent minimum bias distributions as can be seen in figures 12 and 13. These large tails pose a problem for the determination of the rms since the values obtained are very sensitive to the far tails. Truncating the far tails produces rms values that are much lower than the results obtained with the 

\begin{table}
\begin{tabular}{||c|c|c|c||} \hline \(\geq\)_E_T (GeV) & Full Sim. Pileup & Equiv. Min. Bias \\ \hline
0.02 & 17.3\% & 11.3\% \\ \hline
0.04 & 12.8\% & 7.5\% \\ \hline
0.1 & 3.2\% & 3.2\% \\ \hline
0.2 & 0.9\% & 1.3\% \\ \hline
0.4 & 0.3\% & 0.8\% \\ \hline \end{tabular}
\end{table}
Table 7: Probability of a \(\Delta\eta\times\Delta\phi=0.025\times\pi/128\) cone containing more than a given \(E_{\text{T}}\) at \(\eta=0.3\) for the full simulation and equivalent minimum bias methods.

Figure 10: Pileup \(E_{\rm T}\) rms versus the square root of the cone area for cones centred at \(\eta=2.3\) in the endcap calorimeter using the TP3 pileup production method (triangles). Particle level results (squares) and the results of the equivalent minimum bias approximation (circles) are also plotted.

Figure 11: Pileup \(E_{\rm T}\) rms versus the square root of the cone area for cones centred at \(\eta=0.3\) for the barrel calorimeter using the TP0 pileup production method (triangles). Particle level results (squares) and the results of the equivalent minimum bias approximation (circles) are also plotted.

Figure 12: Pileup \(E_{\rm T}\) rms spectrum for various conc areas at \(\eta=0.3\) using the TP0 pileup production method. The solid histogram is for shaped pileup noise while the dashed histogram is for the equivalent minimum bias method where the distribution has been shifted to have a mean of zero.

Figure 13: Pileup \(E_{\rm T}\) rms spectrum for two cone areas at \(\eta=2.3\) using the TP3 pileup production method. The solid histogram is for shaped pileup noise while the dashed histogram is for the equivalent minimum bias method where the distribution has been shifted to have a mean of zero.

## 5 Evaluation of Pileup Approximation and Generation Methods

In this section, an evaluation of the various alternatives to full simulation of pileup events is made along with suggestions to improve the production of fully simulated pileup.

As was shown here and in previous papers [4],the approximation of using an equivalent number of in-time minimum bias events instead of convolution with a shaping function has some drawbacks. While the mean and variance of the fully simulated pileup energy distributions are reproduced, the higher moments of the distributions are not and this has an effect on some physics measurements as was shown in reference [4]. Furthermore, as was shown in tables 7, 8, and 9, the probability of measuring an energy deposition greater than a certain threshold is not accurately reproduced by this method which means that the optimal cuts for pileup noise reduction will differ between

\begin{table}
\begin{tabular}{||r|r|r|r|r||} \hline \(\geq E_{\text{T}}\) & Full Sim. Pileup & Equiv. Min. Bias \\ \cline{2-5} (\(\,\text{GeV}\)) & \(\eta=0.3\) & \(\eta=2.3\) & \(\eta=0.3\) & \(\eta=2.3\) \\ \hline
5.0 & 25.0\% & 32.0\% & 25.6\% & 20.4\% \\ \hline
10.0 & 13.3\% & 15.7\% & 14.0\% & 10.4\% \\ \hline
20.0 & 3.8\% & 2.5\% & 4.2\% & 3.0\% \\ \hline
40.0 & 0.9\% & 0.0\% & 1.2\% & 1.8\% \\ \hline \end{tabular}
\end{table}
Table 9: Probability of a \(\Delta\)R\(=\)0.45 cone containing more than a given \(E_{\text{T}}\) for two central \(\eta\) values using the full simulation and equivalent minimum bias methods.

the shaped pileup and equivalent minimum bias methods.

Another possible alternative to fully simulated pileup is to reproduce the pileup energy distribution shape at the cell level and generate a random pileup noise value for each cell using this distribution. This would be performed in a similar manner to the addition of electronic noise when neglecting crosstalk. Although this would be very fast and easily implemented, the loss of the longitudinal and lateral cell correlation information makes this alternative unattractive, especially when jets are being considered.

As was shown in figures 10 and 11, the particle level pileup \(E_{\mathrm{T}}\) rms correctly convoluted with the shaping functions agrees quite well with full simulation for areas equivalent to a \(\Delta\)R=0.3 cone and upwards. The observed discrepancy for small areas may be explained by the fact that, in the full simulation, a good fraction of the energy exits the small \((\eta,\phi)\) tower as the showering process takes place whereas the energy remains in the tower in the particle level model. By considering larger cone areas, most of this energy is contained. When considering adding pileup noise to signal jets, this alternative would seem attractive because of its good agreement with full simulation and the fact that it takes much less time to produce. However, as in the equivalent minimum bias method, the discrepancy observed for small cones will have an impact on the determination of the optimal cell cuts to be used in pileup noise reduction. The most significant disadvantage in using particle level pileup, however, comes from the impossibility of usinglongitudinally dependent cuts to reduce the pileup noise. For particle level pileup, we must rely only on one cut per tower. Nonetheless, the efficiency of reducing pileup by making use of longitudinal cuts may be somewhat limited by the fact that the pileup noise is positively correlated in depth. A quantitative evaluation of the effect of longitudinally dependent cell cuts on jet energy resolution in the presence of pileup is treated in another note [2]. In the barrel region, longitudinal information remains important as the shaping of the tile calorimeter is very different from the electromagnetic and preshower calorimeters. Shaping the energy of hadronic particles differently from electromagnetic particles in minimum bias events might solve the problem.

Complete simulation of pileup events would be made easier through the use of direct access when combining minimum bias events to create pileup events. In the present version of DICE, events are read in a sequential manner and a random number of events are skipped between each event included in a bunch crossing. The average number of events skipped is proportional to the time needed to generate one bunch crossing. To speed up the process, smaller average numbers of events could be skipped, but this can introduce correlations between pileup events. With the use of a large minimum bias event bank this would be of no concern, but the generation of large event banks is hampered by the large CPU investment needed to generate minimum bias events over the full \(\eta\) range of ATLAS. The use of direct access would allow smaller banks of events to be used and has the potential to be appreciably faster than the sequential method. Direct access would also allow the addition of pileup for a particular detector or group of detectors where the addition of fully simulated pileup is important for a detailed analysis. The implementation of this method is being investigated.

Another possible improvement would be to use GEANT digits instead of hits for storage of pileup energy deposition. Shaped pileup noise lends itself to description by GEANT digits as it is actually a processed signal having passed through the shapers. Digits contain much less information than hits as they correspond to the readout structure of the detector and not the full sensitive volume. Thus, use of digits instead of hits to store pileup information could greatly reduce the time and storage space necessary to process pileup noise.

Even with the above suggestions, the inclusion of fully simulated pileup noise for the calorimeter system remains a problem in terms of the disk space needed to store all the digit or hit information. Fully simulated pileup is nevertheless desirable for dedicated studies or for the study of physics signals where the handling of pileup noise is critical. However, should longitudinally varying cuts prove to be of marginal use in reducing the pileup noise, the use of banks of fully simulated pileup energy towers would reduce the memory space requirements needed for pileup events by a factor of at least seven, making the integration of pileup to physics signals much easier.

Conclusions

Full simulation of pileup noise in the ATLAS calorimetry has been performed from \(\eta=0\) to \(\eta=3.2\). Results for the \(E_{\rm T}\) rms per pileup event in \(\Delta\eta\times\Delta\phi=0.1\times\pi/32\) cells over this \(\eta\) range exhibit a downward slope with \(\eta\) as well as a longitudinal evolution which shows a decrease in the pileup \(E_{\rm T}\) rms with depth. A positive energy correlation was also demonstrated between calorimeter cells both laterally and longitudinally.

The particle level approximation of the pileup noise was shown to agree well with the fully simulated results except in extremely small cone areas. If the use of longitudinally varying cuts proves to be of limited applicability in reducing the pileup noise, particle level pileup may provide an adequate description of the noise except in the barrel where a method of incorporating the different shaping functions of the electromagnetic and tile calorimeters needs to be developed.

The equivalent minimum bias method of approximating pileup noise also proved to emulate the fully simulated pileup noise. The mean and variance of the pileup energy distribution were reasonably well rendered by this method, but the higher moments of the shaped energy distribution were not reproduced well for small cone areas. Also, the probability of exceeding a certain \(E_{\rm T}\) threshold in a given cone when using the equivalent minimum bias distribution did not agree with the fully shaped results for small cone areas.

Several options for making pileup production and integration more efficient were discussed. Further study of the effects of longitudinal cuts on physics processes and development of direct access techniques must be performed in order to efficiently include pileup noise in the ATLAS physics simulation.

## Acknowledgements

* The authors would like to sincerely thank Michel Lefebvre for providing the shaping functions used in this work as well as for his generous help in editing and commenting on this note and for many helpful discussions on the topic of pileup noise.
* The authors also thank B. Lorazo for his authorship of the detailed hadronic endcap geometry used in this work as well as G. Azuelos, M. Bosman, M. Fincke-Keeler, L. Perini and J. Pinfold for their assistance and useful comments.

## References

* [1] J.C. Chollet, ATLAS Internal Note CAL-NO-75 (1995).
* [2] R. A. Davis, D O'Neil, and P. Savard, ATLAS Internal Note in preparation.
* [3] A. Kiryunin, M. Lefebvre, et al., ATLAS Internal Note CAL-NO-62 (1994).
* [4] L. Serin and V. Tisserand, ATLAS Internal Note CAL-NO-73 (1995).