**Clock and Control Transmission**

_R.B.Nickerson, A.R.Weidberg Oxford University, 05 April 1994_

**Content**

There are several possible approaches to the distribution and transmission of clock and control signals within the ATLAS detector. Within ATLAS a well known example is that of Taylor et. al.[1] who have described a system that utilises high speed fibre optic links. The scheme is particularly well suited to clock and control distribution external to the detector itself. Here we outline a scheme based on the use of low-speed fibre optic links (125Mbit/s) which is particularly suited to transmission of clock and control into the detector per-se. This scheme is modelled on that of French et al.[2], who utilise separate links for clock and for control. It is possible, however, to design a simple scheme in which all clock and control information, including L-1 triggers, can be transmitted to a region of the detector down a single slow fibre link.

**Basic Scheme**

The essence of the scheme is to use many inexpensive LED-PIN diode links to transmit the clock at 40MHz into the detector. The multiplicity of the links ensures a robust system, the simplicity of the links ensures a minimum of electronics at the detector end and a minimum power consumption.

Rather than a square wave, the clock has a duty factor of 32%, as shown in fig. 1. Control information may be transmitted simultaneously down the fibre by interpreting the 8ns period immediately after the clock pulse as a logic 0 control bit. To transmit a logic 1 the clock pulse is lengthened to 16 ns. The receiving logic must generate an internal strobe edge 15ns\(\pm\)2ns after the rising edge of the clock pulse and test the logic state of the clock signal. This is shown schematically in figure 2.

After the logic of figure 2, the control data stream is a 40Mbit/s link independent of the clock. This link can be used to transmit both the L-1 triggers and the controlinformation. A single 1 bit would identify the beam crossing in which there was a L-1 trigger. A string of several (for example 5) consecutive L-1 triggers would be interpreted as the header for a control data word, which would arrive serially as the following several (for example 32) bits. During the control header and control word it would not be possible to send L-1 triggers. In the scheme developed by French et. al. it is possible to send all the required control signals, with the exception of analogue voltages for calibration pulsing, via this method. The analogue voltages can be sent DC, with the pulse generation and pattern control again via the serial 40Mbit/s link.

The basic philosophy is that the functionality and control protocol of such a link needs to be defined, preferably across all of ATLAS. The implementation, however, should be left free to the designer employing the link. Generic microchip circuit blocks suited to the clock/control split and the basic header detector for the serial control link should be made available to any designer employing such links. An example of the parallel to serial converter for the control word could also be made available, however the actual functions required by any given system can be very different and the interpretation of the serial control word should be system dependent.

Beyond the header detection, it is very difficult to design a single receiver chip that will do any job required by any system. On-detector, power and mass are at a premium in several systems and attempting to standardise beyond the basic functionality and protocols is potentially expensive in terms of these. In fact it is possible that a separate chip is not required at all; the clock/control decoding logic could simply be built into any chip requiring clocks or control; this has the advantage that only a single signal needs to be routed around the front-end chip substrate.

Functional standardisation in the clock/control system cannot easily be separated from functional standardisation in the rest of the front-end architecture. A minimal set of standard control functions is probably desirable. Some of these involve the data transmission off-detector, at least partially tangling the issues of data transmission, clock/control and system architecture. Rationalisation alone demands that some instruction sub-set be common (for example resets), but the most profound effect on DAQ systems would result from a standard inter-element time synchronisation scheme. It is proposed to follow the scheme of French et al. which at least partially addresses the issue of how to cross-synchronise elements within a detector. The scheme imposes requirement on the global architecture of the detector read-out. In particular it relies on the highly parallel clock and control structure implied by the use of low-cost, low-speed links.

**Time Synchronisation & Cosmic Ray Data Taking**

Each pipeline in a detector must receive the clock at the appropriate time. The time relative to the machine RF, \(\tau_{i}\), will depend on many factors such as location with respect to the interaction point and propagation delay through the electronics. A scheme must be employed to allow all the detector elements to be clocked at the correct time. It is also required that the L-1 triggers and control signals identify the correct bunch crossing. (In the scheme here there is no phase shift between clock and control to consider since they are the same signal).

A method to do this is to scan the time of each clock line when there are collisions in the machine and use some feature of the data to decide the correct phase. Whilst ideal for final tuning, this scheme requires beam and potentially individual attention to data plots. A further disadvantage of this scheme is that it does not obviously adapt to use with cosmic rays. The rate of suitable cosmics through the detector is insufficient to allow the correct timing for cosmics to be established with any precision on a reasonable time scale. A sample of a few thousand Cosmic Rays would be very useful for debugging purposes but it would not give enough statistics to adjust the clock phase for each module.

_Method of Synchronisation_

One architectural feature that can be required in a highly parallel system is that \(\tau_{i}\) is a constant for a given fibre link. This is a statement about the minimum parallelism that must be employed and allows all phase adjustment electronics to be outside the detector in the control room. Since the phase adjustment electronics is outside the detector it is easy to ensure that the propagation delay during fan-out of the master clock is identical for each clock/control link. Given this and knowledge of \(\tau_{i}\) it is possible to cut all the fibres to the correct length to ensure the correct clock timing at all detector elements. Assuming the fibre lengths can be controlled to 5 cm and that the uncertainty in the propagation delays through the LED and PIN (plus the driver and receiver electronics) is less than 4 ns, all the clocks will arrive within 5 ns of the correct time (\(\pm\)2.5 ns), modulo one overall global shift in the master clock. Clearly if an entire region of the detector physically requires fibres an integral number of clock cycles shorter than the longest, the additional delay is provided electronically.

It is worth noting that in the systems currently under design one goal is to minimise the spread in propagation delay through the LED/PIN electronics and that 1 ns is the target spread, rather than the 4 ns above. Given that the correct bunch crossing is identified in this manner, it remains to tune the phase of the clocks to be correct to within the requirements of the particular detector element.

To improve system robustness it is desirable that each front-end chip receive two copies of the clock and control signal. These would be ORed inside the chip so that if one failed (logic 0, DC) at most simple phase shift in the incoming signal would allow the second copy to be used. (More sophisticated methods allow use for either high or low DC failure) If the two copies are interleaved, as shown in figure 3, it is now possible to use the out-going data links to cross-synchronise detector elements without the need for collisions in the machine.

To do this it is required that it be possible to instruct the front-end chip that is connected to an out going data link to simply transmit the clock back out the data link. The phase of the returning clock is measured with respect to the transmitted clock at the data receiver. By measuring the phase for each of the two clocks received at a given front-end chip, an absolute measure of the relative time of arrival of the two clocks is possible. Since the clocks are interleaved it is possible to measure the relative phases of all adjacent pairs of clocks and therefore of all clocks.

There are many practical problems, for example interleaving clocks from regions of different \(\tau_{i}\) value requires that an appropriate delay be employed between regions. However the scheme offers the possibility of aligning the clocks on the detector to better than 1 ns.

_Use With Cosmics_

With a system were the fibres are cut to approximately the correct length and the relative phases of modules is adjusted as described above then the timing would be good enough to take reasonable Cosmic Ray data. A specific example for the case of the silicon tracker is given below.

**Drifts and Jitter**

The jitter in the arrival time of the clock relative to the transmitted clock has been measured for one particular design of LED-PIN link. It is important to recall that for optical signals being transmitted into the detector the optical power can be high (10\(\upmu\)W). For the particular system measured the jitter was less than 400 ps full width at the base of the distribution (sigma less than 100 ps), which is acceptable for most systems. Over a period of several hours the drift in transmission time over a 50m long link was \(<\)100 ps. Both the jitter and longer term drift are functions of the electronics design; the systems tested were extremely simple and no attempt had been made to control these parameters. Considerable improvement is to be expected in carefully designed electronics. The expansion coefficient of glass is typically one part in 10\({}^{5}\), so that for 50m of fibre a temperature change of 10C results in a 25 ps

Figure 3: Synchrotisation Architecture

change in transmission time. The temperature dependence of the refractive index is similarly small. These are encouraging numbers for the ATLAS application.

**Clock Reconstruction**

In some systems a square wave clock is required. To reconstruct an accurate square wave from the 32% clock requires use of a phase lock loop. A suitable circuit has been designed and simulated in CMOS for use at the speeds required by the low speed links. A layout is underway and the circuit will be fabricated. There is every reason to suppose that a similar circuit would be possible in a bulk CMOS rad-hard process.

**Radiation Tolerance & Lifetime.**

The radiation tolerance of GaAlAs diodes to neutrons has been measured. After 10\({}^{14}\)n/cm\({}^{2}\) slightly over 30% of the light output remains (depends on the forward current). The lifetime of the LEDs is adequate before irradiation, and tests are underway to measure their lifetimes after irradiation. Of primary relevance here however are the PIN diodes. Manufacturers data shows that the PIN diodes are also highly radiation tolerant, after 10\({}^{14}\)n/cm\({}^{2}\) it is possible to retain over 80% of the responsivity (depends on the reverse voltage employed). The dark current increases by more than a factor of 100, but this is acceptable. These measurements have not yet been confirmed by us.

**Mass**

The lowest mass package currently available for the PIN diodes is made primarily of silicon. It has 60 mg of Si, \(<\)10 mg of Cu/Au. Each link requires such a diode plus approximately 1 mm\({}^{2}\) of silicon chip for the amplifier and discriminator. The fibre consists of 27 mg/m of glass and 40 mg/m of plastic. In one implementation under development, two control links and two data links are packaged together, reducing the diode mass by a factor of four. In another development several multi quantum well modulators are effectively packaged with a PIN diode so that the mass contribution from the PIN is negligible. In any of these options, the mass of fibre plus diode can be made very small in comparison with the detector that is being serviced.

**Example Application to ATLAS**

In the case of the silicon detector, this scheme would involve one clock/control signal per module with connections between adjacent modules. It is therefore necessary that the difference in flight path for particles across one silicon module is acceptably small. Consider the longest length for a module to be 24 cm and take the worst case layer, which is at r=20 cm. Assume that the clock propagation speed along the module is 0.6c. If the clock is delivered at the centre of the module, then the worst case phase difference is less than \(\pm\)1 ns and therefore is not a significant problem. If better precision is required, then the clock distribution signal paths must be adjusted on the module or by delay in the ROC.

For the barrel silicon detector one would require clock connections between neighbouring modules at the same radius at a given \(\phi\) to provide redundancy and to enable the relative phase adjustments to be made. It would also be desirable to have a connection between end modules at different \(\phi\) to enable the phase adjustments to be made for many modules. In the case of clock failure, the clock arrival times for the module above would be +1.3 ns in the worst case. Again, this could be reduced by appropriate routing of signals on the module or by delay in the ROC.

In the case of cosmic rays, it is necessary to adjust the relative timing of modules at different radius. Since the relative phases are measured during the synchronisation process at a single radius and \(\phi\) the procedure effectively measures the mean time at which the clock arrives at the radius with a precision given by the \(\pm\)2 ns variation assumed above divided by the square root of the number of clocks synchronised. Hence the timing of different groups of 12 modules will be known to about \(\pm\)0.7 ns. Even better precision is obtained when there are \(\phi\) connections at a given radius.

**Cost**

GaAlAs LEDs and Si PIN diodes are mature devices. The bulk of the costs associated with purchase of suitable radiation hard devices is in the special, low-mass non-magnetic packaging that is required in the ATLAS application. Such packages are being developed in conjunction with two companies, GCA and GEC. Prototypes have been made and based on these the manufacturers have quoted prices for quantities of 10,000 pieces. The cost of rad-hard electronics has been taken from vendor quotes obtained by UCSC for the UTMC bulk CMOS process. In conjunction with Oxford, Fujikura has developed a low-cost multi-mode radiation hard fibre well suited to ATLAS. We use prices for such fibre quoted for lengths of 2000 km.

In quantities of 10k, the cost for a 50m long link electrical-in to electrical-out is estimated at 98 SF including power supplies etc.. This is based on price quotes and can instructively be compared with the early 25 SF estimate made on the basis of the original vendor cost estimates.

**Conclusions**

A simple, highly parallel clock and control architecture suited to the ATLAS detector has been outlined. No attempt has been made to define the details since doing so must be the task of the overall ATLAS electronics group. However the case has been made for a particular functional architecture on the basis that it allows transmission of L-1 triggers and control information and allows the primary time-synchronisation to be performed in a simple way. Such a scheme allows use of cosmic ray data for debugging the experiment.

It has been argued that by defining functionality, rather than trying to supply a particular chip, flexibility inside the detector itself is maintained (where it is most crucially required), but complete uniformity is possible external to the detector (where it is most crucially required).

**References**

1. B.G.Taylor, "Timing, Trigger and Control Distribution for LHC Detectors", working review document, CERN/ECP-RA.
2. M.French et. al., _The SDC silicon tracker DAQ_ NIM A 342(1994)214