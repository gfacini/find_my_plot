**Local Hadronic Calibration**

T. Barillari, E. Bergeaas Kuutmann, T. Carli, J. Erdmann, P. Giovannini, K.J. Grahn, C. Issever, A. Jantsch, A. Kiryunin, K. Lohwasser, A. Maslennikov, S. Menke, H. Oberlack, G. Pospelov, E. Rauter, P. Schacht, F. Spano, P. Speckmayer, P. Stavina, P. Strizenec

**ATLAS Collaboration**A scheme to calibrate energy depositions from hadrons based on calorimeter signals only and the observed shower topology is presented. Such a calibration scheme can be used to calibrate jets and the missing transverse energy in the ATLAS detector. Based on the cluster reconstruction an effective noise suppression is achieved. In a first step clusters are classified as electromagnetic or hadronic clusters. A weighting scheme corrects for the different e/\(\pi\) response in the ATLAS calorimeter. Dead material corrections and out of cluster corrections yield finally a signal which is rather close to the energy deposited by the final state particles in the ATLAS calorimeter. The constants and algorithms are derived using MC simulation of single pions and tested with pions and jets.

First steps towards a validation of the scheme using testbeam data corresponding to the region \(|\eta|=0.45\) in ATLAS for pion energies from 20 GeV to 180 GeV are presented. Similar studies using testbeam data corresponding to \(2.5<|\eta|<4.0\) are in preparation. The deviation of the reconstructed energy from the beam energy is still at the level of few percents, as well as the difference between the data and MC expectation. The energy resolution is indeed improved, but again some difference between data and MC is observed. These effects can be attributed to a partial understanding of the proton contamination in the pion testbeam and to present shortcomings in the simulation.

In addition alternative weighting schemes have been studied for single pions in test-beams, yielding similar results. These schemes need still to be compared to the standard method using MC jets prior to drawing any final conclusions.

## Introduction

The ATLAS calorimeter is non-compensating, i.e. the response for electrons (electromagnetic scale) and hadrons (hadronic scale) differs. The calibration of energy deposits from the electromagnetic scale to the hadronic scale can either be done in the context of jets (global method) or independent of any jet algorithm (local method) on the cluster level.

This note describes the local hadron calibration (LC ) starting from three dimensional topological clusters [1], which are optimized to suppress electronics noise as well as pile up from minimum bias events by grouping together neighbouring energy deposits based on their significance. In a second pass over the clustered cells local energy maxima are identified and the clusters are re-arranged (split) around these local maxima. In a typical QCD di-jet simulation each cluster corresponds to \(\sim 1.6\) stable particles (mostly charged pions and photons) after splitting.

Cluster shape variables are used to classify the clusters as "em-like" or "hadron-like". The classification procedure is subject of section 2. The "hadron-like" clusters receive H1-style [2] cell-weights to compensate for the lower response of the calorimeters to hadronic deposits. The aim is to correct to the true deposited level of energy in each cell including invisible and absorber deposits. The weights are based on detailed Geant4 simulations of charged single pions. Section 3 describes the weighting procedure.

After the weighting out-of-cluster corrections on the cluster level are applied to correct for energy deposits in the calorimeters but outside reconstructed clusters -- typically due to the noise thresholds in the clustering as detailed in section 4.

Finally both the "em-like" and "hadron-like" clusters are corrected for energy deposits outside the calorimeters, based again on detailed Geant4 simulations of neutral and charged pions, respectively. This is described in section 5. The resulting calibrated clusters should have energies corresponding to the particle level.

The performance for single pions and jets is shown in section 6.

A slight variant of the default LC method is the cone method, which uses also the energy density of cells, but rather than using the cluster energy as a further input parameter for the weights, a global energy scale is used. Here the global energy is obtained from the energy of clusters whose energy centre-of-mass fall within a cone of opening angle 11 degrees formed around the most energetic cluster (the cone method). This method has been tested with testbeam data (see section 8) only and yields rather similar results as the default LC method for the weighting step.

Finally an alternative method has been tested with testbeam data - the layer correlation weighting method. This method exploits correlations in the longitudinal shower development. The results are presented in section 9.

The default LC method is so far the only one applied to single pions and jets in ATLAS using MC data. Only this method is committed to the ATLAS reconstruction code since release 11.0.0.

Simulation of the full ATLAS set-up

The classification and calibration methods described in this note are based on detailed simulations of charged and neutral single pions. The most recent set of constants has been obtained from \(10^{6}\) neutral and \(2\cdot 10^{6}\) charged pions (50% negative and 50% positive) simulated with the offline release AthenaOffline-13.0.20, the simulation package geant4.8.3.patch00.atlas02, the conditions database DBRelease-4.2-nightly-20070831, and the geometry layout ATLAS-CSC-02-00-00. The digitization was done with the offline release AthenaOffline-13.0.30, the same nightly database and the tag LArIOVDbTag = "CSC02-E-QGSP_EMV" to benefit from the latest sampling fractions in the LAr detectors. The reconstruction was done with the same release as the digitization - and in the second iteration redone with the same release but the calibration constants obtained from the first iteration.

The pion energies where generated in 1000 fixed steps: 100 from \(150\,\mathrm{MeV}\) to \(1\,\mathrm{GeV}\) and 900 from \(1\,\mathrm{GeV}\) to \(2\,\mathrm{TeV}\), logarithmically equidistant in both intervals. The \(0<\phi<2\pi\) and \(-5.5<\eta<5.5\) values for the pions where chosen from flat random distributions.

The energy steps are chosen such that they fill the phase space almost continously. The actual distance between two consecutive energy points is \(\sim 1.9\%\) for \(150\,\mathrm{MeV}<E<1\,\mathrm{GeV}\) and \(\sim 0.8\%\) for \(1\,\mathrm{GeV}<E<2\,\mathrm{TeV}\). With intrinsic fluctuations well above 5% this ensures that the weight tables are filled by quasi homogenous energy distributions ensuring bias-free and smooth distributions.

One special feature of the GEANT4 based ATLAS simulation is crucial for the method described here: the so-called calibration hits. In addition to the expected response to ionizing particles (the regular GEANT hits which are based on the visible deposited energy in the active material) the calibration hits are available for energy deposits in the active and inactive material and for the following four categories of energy deposits:

1. visible em-energy: The energy released by electrons or positrons via ionization.

Figure 1: GEANT4 simulated energy fraction as classified by the calibration hits (see text) released in active and inactive material in the endcap region by single charged pions vs. the pion energy. The error bars indicate the RMS of the related distribution

2. visible non-em-energy: The energy released by charged particles other than electrons or positrons via ionization
3. invisible energy: The energy released by non-ionizing processes such as break-up of nuclear bindings.
4. escaped energy: The energy leaving the mother volume in form of non-interacting or escaping particles like neutrinos or muons.

The figure 1 shows the fraction of each of these four categories summed over the active and inactive regions in the endcap calorimeters. The visible em-fraction raises from 38% at 10 GeV to 60% at 200 GeV, visible non-em and invisible energy fractions fall from 30% to 18% over the same range and the escaped energy accounts for \(2-4\%\) with a shallow minimum at 60 GeV.

The aim of the calibration is to estimate the lost invisible and escaped energy deposits based on the visible em and non-em deposits in the active cells. The weights are thus made by comparing the regular GEANT4 hits (visible energy in the active media scaled by the inverse sampling fraction to match the total deposited energy on the electromagnetic scale) with the sum of all calibration hits from active and inactive materials, visible and invisible sources for the current cell.

## 2 Cluster Classification

The aim of the cluster classification is to distinguish between clusters dominated by electromagnetic deposits and those dominated by hadronic interactions. For topological clusters where the correspondence of the cluster and the particle level is close (see [3]) this would lead to a separation of electrons, photons and neutral pions on one side from charged hadrons (mainly pions) and neutrons on the other side such that both particle classes can be optimally calibrated.

The classification methods discussed here are mainly based on so-called moments (shower shapes) of topological clusters and predictions for charged and neutral pions (according to phase space) from calibration hits in single pion simulations.

### Cluster Moments

Typically a cluster moment of a certain degree \(n\) in an observable \(x\) defined for cell constituent of the cluster is given by:

\[\langle x^{n}\rangle=\frac{1}{E_{\text{norm}}}\times\sum_{\{i|E_{i}>0\}}E_{i} x^{n},\quad E_{\text{norm}}=\sum_{i|E_{i}>0}E_{i}. \tag{1}\]

Here the two sums run over the cells with positive energy only, as mixing negative and positive weights could lead to unphysical behavior. Alternatively all cells could be used if the absolute value of the cell energy would enter the sums (as is done for example for \(\eta\) and \(\phi\) in the topological cluster maker). Common variables to calculate first and second moments of are \(\phi\), \(\eta\), and radial and longitudinal distances from the shower axis and the shower center, respectively.

For many of the moments the shower axis is needed as reference. This axis is calculated via a principal value analysis of the energy weighted spacial correlation of the cell members with positive energy with respect to the center of the cluster:

\[C_{xx} = \frac{1}{w}\sum_{\{i\mid E_{i}>0\}}E_{i}^{2}\left(x_{i}-\langle x \rangle\right)^{2}, \tag{2}\] \[C_{xy} = \frac{1}{w}\sum_{\{i\mid E_{i}>0\}}E_{i}^{2}\left(x_{i}-\langle x \rangle\right)\left(y_{i}-\langle y\rangle\right), \tag{3}\]

and likewise for \(C_{xz}\), \(C_{yy}\), \(C_{yz}\), \(C_{zz}\), with

\[w=\sum_{\{i\mid E_{i}>0\}}E_{i}^{2}. \tag{4}\]

The Eigenvector of the symmetric matrix

\[C=\left(\begin{array}{ccc}C_{xx}&C_{xy}&C_{xz}\\ C_{xy}&C_{yy}&C_{yz}\\ C_{xz}&C_{yz}&C_{zz}\end{array}\right), \tag{5}\]

which is closest to the direction pointing from the interaction point (IP) to the shower center is used as the shower axis. Is the deviation of this axis from the IP-to-shower-center-axis larger than 30\({}^{\circ}\) the IP-to-shower-center-axis is used as shower axis. This can happen if all cell members of the cluster are inside of one sampling and therefore the major shower axis lies in the same plane. Once the shower axis \(\vec{s}\) and the shower center \(\vec{c}\) are defined two other quantities are calculated:

\[r_{i}=|\left(\vec{x}_{i}-\vec{c}\right)\times\vec{s}| \tag{6}\]

is the distance of the cell \(i\) from the shower axis and

\[\lambda_{i}=\left(\vec{x}_{i}-\vec{c}\right)\cdot\vec{s} \tag{7}\]

is the distance of the cell \(i\) from the shower center along the shower axis.

The following list of moments (in addition to the shower center and the angular deviations of the shower axis from the IP-to-shower-center axis) are calculated:

* \(\langle\phi\rangle\): the first moment in \(\phi\)
* \(\langle\eta\rangle\): the first moment in \(\eta\)
* \(\langle r^{2}\rangle\): the second moment in \(r\)
* \(\langle\lambda^{2}\rangle\): the second moment in \(\lambda\)
* lateral = \(\frac{\text{lat}_{2}}{\text{lat}_{2}+\text{lat}_{\text{max}}}\): the normalized second lateral moment
* longitudinal = \(\frac{\text{long}_{2}}{\text{long}_{2}+\text{long}_{\text{max}}}\): the normalized second longitudinal moment
* \(\langle\rho\rangle\): the first moment in energy density \(\rho=E/V\)
* \(\langle\rho^{2}\rangle\): the second moment in energy density
* \(\lambda_{\text{center}}\): the distance of the shower center from the calorimeter front face measured along the shower axis
* \(f_{\text{em}}\): the energy fraction in EM calorimeters* \(f_{\rm max}\): the energy fraction in the most energetic cell
* \(f_{\rm core}\): the sum of the energy fractions in the most energetic cells per sampling
* isolation: the layer energy weighted fraction of non-clustered neighbor cells on the outer perimeter of the cluster

The quantities without pointed brackets \((\langle\ldots\rangle)\) are strictly speaking not moments since they are calculated differently, but since they also describe the shower shape and since they are closely related to the real moments they are provided by the same tool.

For the two moments, the lateral and longitudinal moment, the following definitions are used:

* \(\mathrm{lat}_{2}=\langle r^{2}\rangle\), with \(r=0\,\mathrm{cm}\) for the two most energetic cells
* \(\mathrm{lat}_{\rm max}=\langle r^{2}\rangle\), with \(r=4\,\mathrm{cm}\) for the two most energetic cells and \(r=0\,\mathrm{cm}\) for all other cells
* \(\mathrm{long}_{2}=\langle\lambda^{2}\rangle\), with \(\lambda=0\,\mathrm{cm}\) for the two most energetic cells
* \(\mathrm{long}_{\rm max}=\langle\lambda^{2}\rangle\), with \(\lambda=10\,\mathrm{cm}\) for the two most energetic cells and \(\lambda=0\,\mathrm{cm}\) for all other cells

This gives normalized distributions between 0 and 1 for the two moments. The fixed values in \(r\) and \(\lambda\) for the two most energetic cells need tuning.

The most promising moments for separating hadronic from electromagnetic showers are the moments describing the width and the length of the shower, \(\langle r^{2}\rangle\) and \(\langle\lambda^{2}\rangle\), the depth of the shower center \(\lambda_{\rm center}\), and the first moment in energy density \(\langle\rho\rangle\). The isolation moment is also normalized between 0 and 1 and can be used to correct for out-of-cluster energy losses. In case the isolation is small most of the out-of-cluster energy will be already accounted for in other clusters, while in case the isolation is large most of the out-of-cluster energy has to be corrected for.

### Default Method

The current (rel 13) default procedure in ATLAS is to classify topological clusters based on the predicted phase-space population of clusters stemming from charged and neutral pion simulations. For both particle species the 4-dimensional phase space for clusters in \(|\eta|\), \(E_{\rm cluster}\), \(\log_{10}(\lambda_{\rm center})\) and \(\log_{10}(\langle\rho\rangle)-\log_{10}(E_{\rm cluster})\) is binned and filled with simulated pions in the energy range \(E_{\rm cluster}=200\,\mathrm{MeV}-2\,\mathrm{TeV}\) and \(|\eta|<5\). Both samples are simulated with the same energy and \(\eta\) distributions. Assuming an a-priori probability ratio of \(1:2\) for observing a neutral pion over a charged pion the probabilty weight in each phase-space bin for observing a neutral pion is given by:

\[w_{i}=\frac{n_{i}^{\pi^{0}}}{n_{i}^{\pi^{0}}+2n_{i}^{\pi^{\pm}}}, \tag{8}\]

where \(n_{i}^{\pi^{0,\pm}}\) is the fraction of neutral or charged pions in a given phase-space bin \(i\) from the simulation.

A cluster is classified as electromagnetic if its falling in a phase-space bin with a weight \(w_{i}>0.5\). Figure 2 shows the classification weights obtained with this procedure for the 2 regions \(2.0<|\eta|<2.2\) and \(0.2<|\eta|<0.4\) and 2 energy ranges \(1\,\mathrm{GeV}<E_{\rm cluster}<2\,\mathrm{GeV}\) and \(8\,\mathrm{GeV}<E_{\rm cluster}<16\,\mathrm{GeV}\) on a colored scale from \(0\) (purely hadronic) to \(1\) (purely electromagnetic) as a function of the two moments \(\langle\rho\rangle\) and \(\lambda_{\rm center}\). It is clearly visible that electromagnetic showers dominate the region of high energy density and small cluster depth. It is also apparent from the plots that classification is most difficult for clusters with smaller energies as the distributions for charged and neutral pions have larger overlaps in that regime.

#### 2.2.1 Performance for single pions

Figure 3 shows the energy fractions classified as electromagnetic and hadronic for neutral and charged single pions with the classification method described in section 2.2. For neutral pions the method reaches classification efficiencies of \(80-85\%\) above \(50\,\mathrm{GeV}\), but below that energy the electromagnetic fraction drops linearly with the logarithm of the pion energy, falls to \(50\%\) at about \(5\,\mathrm{GeV}\) and \(23\%\) at \(1\,\mathrm{GeV}\). For charged pions the hadronic fraction is rather stable between \(80-90\%\) over the entire energy range

Figure 2: Default calibration scheme: Probability weights to observe a neutral pion cluster for \(0.2<|\eta|<0.4\) (left column); \(2.0<|\eta|<2.2\) (right column); \(1\,\mathrm{GeV}<E_{\rm cluster}<2\,\mathrm{GeV}\) (top row); \(8\,\mathrm{GeV}<E_{\rm cluster}<16\,\mathrm{GeV}\) (bottom row).

- at low energies due to the low classification efficiency of neutral pions and at large energies due to the better separation of neutral and charged showers.

The \(|\eta|\)-dependency of the classification method is depicted in figure 4 for single pions with \(E=(100\pm 30)\,\mathrm{GeV}\). The plot for neutral pions shows that dead material and regions with cracks degrade the classification performance from above 90% for regions with little dead material to about 60% at the barrel-endcap crack at \(|\eta|\simeq 1.5\). Charged pions suffer less from the crack regions and dead material but the overall classification efficiency drops with increasing \(|\eta|\) from 95% at the central barrel to 80% at \(|\eta|\simeq 4.5\).

### Alternative cluster classification estimating the electromagnetic fraction

An alternative option to classify clusters as electromagnetic or non-electromagnetic is based on an estimate of the eletromagnetic component of the shower using cluster moments. This procedure has been applied in individual \(|\eta|\) bins (in total 25 equidistant bins).

* The following cluster moments were used (see Figure 5):
* \(\langle r^{2}\rangle\): the second moment in

Figure 4: Default calibration scheme: energy fractions of single pions with \(70\,\mathrm{GeV}<E<130\,\mathrm{GeV}\) classified as electromagnetic (red dots) or hadronic (blue dots) for \(\pi^{0}\)’s (left), \(\pi^{\pm}\)’s (right) as function of the pion \(|\eta|\) averaged over all \(\phi\).

Figure 3: Default calibration scheme: energy fractions of single pions classified as electromagnetic (red dots) or hadronic (blue dots) for \(\pi^{0}\)’s (left), \(\pi^{\pm}\)’s (right) as function of the pion energy averaged over all \(\eta\) and \(\phi\).

* \(\langle\lambda^{2}\rangle\): the second moment in \(\lambda\)
* \(\lambda_{\rm center}\): the distance of the shower center from the calorimeter front face measured along the shower axis
* From each individual moment an estimate of the electromagnetic fraction is obtained.
* The final electromagnetic fraction is obtained from the weighted mean of the individual estimates.

These three cluster moments are explained in more detail in Figure 5. The correlation between the particular moment and the electromagnetic fraction of the deposited energy is assumed to be linear (see e.g. Figure 6). The parameters of the linear fit (slope and offset) are used to obtain the electromagnetic fraction of the deposited energy of the cluster. The weighted mean value obtained from the three results from the individual cluster moments is used to extract the final estimate. The weights were obtained from a fit minimizing the spread of the prediction.

In this procedure only clusters with \(E_{T}>E_{T}^{cut}\) are classified, with \(E_{T}^{cut}\) being an \(|\eta|\)-dependent minimal threshold. The Figures 6, 7 and 8 show the results for pions and for the bin \(2.2<|\eta|<2.4\) and the values of \(E_{T}^{cut}=1.5\) GeV resp. \(1.0,\ 0.5\ {\rm GeV}\). Shown is for each cluster moment the correlation with the true electromagnetic fraction, varying the pion energy up to \(1\ {\rm TeV}\). The line shown reflects the result of the linear fit. The finally predicted electromagnetic fraction vers. the true electromagnetic fraction is shown as well (bottom right figure). The corresponding results for electrons of \(100\ {\rm GeV}\) are shown as well (black data point in highest electromagnetic fraction bin close to one).

This classification method has been validated using electrons (see Figure 9) and QCD di-jets. In QCD di-jets in general only a small fraction of energy is deposited in clusters with very high electromagnetic fraction (e.g. clusters with electromagnetic fraction above 90%). But even for lower values of

Figure 5: The three moments used to estimate the electromagnetic fraction.

electromagnetic fraction the prediction might be useful in more sophisticated cluster weighting schemes. In general, the performance of this classification method is slightly worse in comparison to the default method.

Figure 6: Dependence of the cluster moments on the electromagnetic fraction and the final prediction vers. the true value for \(\pi^{-}\) with \(E_{T}>1500\,\mathrm{MeV}\). The error bars show the spread of the related distribution.

Figure 8: Alternative cluster classification: dependence of the cluster moments on the electromagnetic fraction and the final prediction vers. the true value for \(\pi^{-}\) with \(E_{T}>500\,\)MeV

Figure 7: Alternative cluster classification: dependence of the cluster moments on the electromagnetic fraction and the final prediction vers. the true value for \(\pi^{-}\) with \(E_{T}>1000\,\)MeV

Figure 9: Alternative cluster classification: classification efficiency for electrons for the electromagnetic estimation method

## 3 Weighting

Using the calibration hits explained in the section 1 weights for cells or layers in the calorimeter can be derived to recover the invisible and escaped energy fractions.

In the weighting approach cell-based weights can be calculated to correct for the invisible and escaped energy fractions. First all clusters from simulated charged single pion events are classified as electromagnetic or hadronic as described in section 2. The following cuts need to be satisfied by cells belonging to clusters classified as hadronic in order to enter the weight tables:

\[E_{\rm cell}^{\rm reco} > 2\sigma_{\rm noise}, \tag{9}\] \[E_{\rm cell}^{\rm calib} > \sigma_{\rm noise},\] (10) \[V_{\rm cell} > 0,\] (11) \[0.5<E_{\rm cell}^{\rm calib}/E_{\rm cell}^{\rm reco} < (3_{\rm EMB,\;EMEC,\;FCal.},5_{\rm HEC},10_{\rm Tile}). \tag{12}\]

Here \(E_{\rm cell}^{\rm reco}\) is the regular reconstructed energy based on the visible energy in the active media including noise, \(E_{\rm cell}^{\rm calib}\) is the sum of all calibration hits belonging to the cell, \(V_{\rm cell}\) is the cell volume, and \(\sigma_{\rm noise}\) is the electronics noise. The first two cuts prevent noise to enter the weights in a dominant way. The threshold for the calibration hit energy sum is lower than that for the reconstructed cell energy since noise is not added to the calibration hits and both upward and downward fluctuations in the reconstructed energy are thus accounted for at the \(1\sigma\) level starting at the \(2\sigma\) threshold. The volume cut serves basically to exclude cells which do not belong to the calorimeter proper - such as presampler cells and gap scintillation counters. In recent releases some of these cells got volumes corresponding to their active material attached

Figure 10: Default calibration scheme: hadronic cell weights for \(0.2<|\eta|<0.4\). The top row shows the samplings 1 - 3 in the LAr barrel from left to right; the bottom row the samplings 1 - 3 in the Tile barrel.

to them and are excluded explicitly. They are treated in the dead-material correction step described in section 5. The last cut truncates the weight distributions again to prevent domination by noise (the lower cut) and spurious upward fluctuations (the upper cut). The actual values are not critical and somewhat arbitrary.

The weight tables (in form of TProfile2D) histograms are filled with the ratios \(E_{\rm cell}^{\rm calib}/E_{\rm cell}^{\rm reco}\) as a function of the cluster energy the cell belongs to, the energy density \(\rho_{\rm cell}=E_{\rm cell}^{\rm reco}/V_{\rm cell}\) of the cell, and the \(|\eta|\) of the cell center. There are 25 equidistant \(|\eta|\)-bins from 0.0 to 5.0, 20 logarithmic energy-density bins from \(-7<\log_{10}(\rho_{\rm cell}({\rm MeV/mm^{3}}))<1\) and 22 logarithmic cluster energy bins from \(\log_{10}(100({\rm MeV}))<\log_{10}(E_{\rm clus}({\rm MeV}))<\log_{10}(2 \cdot 10^{6}({\rm MeV}))\) with an average of 5.7 active layers per \(|\eta|\) bin. Examples of the actual weights obtained this way from \(2\cdot 10^{6}\) charged pions are shown in figures 10,11, and figure 12 for the ranges \(0.2<|\eta|<0.4\), \(2.0<|\eta|<2.2\), and \(3.8<|\eta|<4.0\), respectively.

Figure 11: Default calibration scheme: Hadronic cell weights for \(2.0<|\eta|<2.2\). The top row shows the samplings 1 - 3 in the LAr endcap from left to right; the middle row the samplings 1 and 2 for the HEC and the bottom row HEC samplings 3 and 4.

Figure 12: Default calibration scheme: hadronic cell weights for \(3.8<|\eta|<4.0\); from left to right the samplings 1 - 3 in the FCal.

Figure 13: Default calibration scheme: Performance plots for charged single pions. Top left: efficiency for reconstructing at least one cluster with positive calibration hit contents (default calibration scheme). The other plots show fractions of true calibration hit energies inside top clusters (top right), outside topo clusters but inside the calorimeters (bottom left) and outside calorimeters (bottom right).

Out-Of-Cluster Corrections

Out-of-cluster corrections (OOC) aim at recovering from the lost low energetic deposits at the tails of hadronic showers. The difficulty here is that unlike the calibration hit contents for a given cluster the amount of calorimeter energy associated to that cluster but outside of cells inside the cluster is not well defined. The total sum of calibration hit energy inside the calorimeter but outside any cluster from charged pion simulations is known but how to distribute this energy over the available number of clusters is arbitrary. One possibility would be to calculate the distance for each out-of-cluster calibration hit to the reconstructed clusters and assign it to the nearest one. This does however not help for split clusters since they are very close by definition and the assignment offers no algorithmic aid for the application of the correction. Therefore an alternative procedure has been adopted here: The total fraction of out-of-cluster energy from single pion simulations w.r.t. the weighted total energy inside clusters (but before dead-material corrections) is averaged in bins of pion energy, pion \(|\eta|\), and the pion depth \(\lambda\) in the calorimeter. The \(\lambda\) values of all clusters in a given event are combined with energy proportional weights to obtain the latter. 12 energy bins with the boundaries \(\{0,1,2,4,8,16,32,64,128,256,512,1024,2048\}\) GeV, 25 equidistant \(|\eta|\) bins from 0 to 5 and 20 equidistant bins in \(\log_{10}(\lambda/{\rm mm})\) from 0 to 4 define the profile histograms. Figure 14 shows the out-of-cluster energy fractions obtained this way for charged and neutral pions in 2 different energy bins. The total out-of-cluster energy fraction as function of pion \(|\eta|\) and for all energies up to \(\sim 1\) TeV can be seen in the lower left plot of Figure 13.

The level of isolation of each cluster is determined by the fraction of cells on its outer perimeter that are not included in other clusters. Due to the big variety in granularity this isolation is calculated for each layer separately and the layer-energy weighted average of the individual isolation ratios is taken as

Figure 14: _Out-of-cluster correction tables for \(8\,GeV\!\!<E<16\,GeV\) (top row) and \(512\,GeV\!\!<E<1024\,GeV\) (bottom row) for charged (left column) and neutral pions (right column)._

overall isolation for the cluster. An isolation of 0 means that all cells on its outer perimeter are included in neighboring clusters, a value of 1 indicates that the cluster is totally isolated - i.e. that all its neighbor cells are not part of any cluster. This isolation fraction is multiplied with the expected out-of-cluster energy fraction for each cluster as obtained from the out-of-cluster tables described above. This accounts for the fact that clusters tend to be less isolated in full events compared to single pion events from simulations or beam tests. In the crack regions and towards larger \(|\eta|\) values the level of isolation also decreases as can be seen in Figure 15 for clusters above 1 GeV in transverse energy from single pion and \(\mathrm{t\bar{t}}\)-events.

The current correction procedure for out-of-cluster energy deposits works reasonably well in case the correction is large, but tends to overestimate the missing energy in case the fraction is small. Figure 16 shows the ratio of reconstructed over true out-of-cluster energy fraction versus the true out-of-cluster fraction for charged single pions. The level of overestimation is particularly large in the crack regions where the number of clusters due to the split algorithm is largest. Nevertheless, both linearity and resolution are improved by the current procedure as shown in lower left plots of Figures 25 and 26.

Figure 16: _Default calibration scheme: Ratio of reconstructed over true out-of-cluster energy fraction vs. true out-of-cluster energy fraction (left) and vs. \(|\eta|\) (right) for charged single pion simulations._

Figure 15: _Level of isolation for clusters above 1 GeV in transverse energy versus \(|\eta|\) for single charged pion (left) and \(\mathrm{t\bar{t}}\) (right) simulations._

## 5 Dead Material Correction

Dead material (DM) corrections account for energy deposited outside of active zones of LAr and Tile calorimeters. This includes energy deposited in upstream material (Inner Detector material, magnetic coil, cryostat walls), different crack regions between calorimeter modules and material behind the calorimeter system (leakages). The correction is based on full ATLAS Monte-Carlo single pion simulation with dead material energy saved on each event via the _Calibration Hits_ mechanism. The data set used to obtain the correction coefficients was the same as described in section 1.

The correction is performed on cluster level for clusters classified as electromagnetic or hadronic on event-by-event basis. The amount of energy lost in dead material for given cluster is derived from different cluster quantities calculated at em scale. This energy is added then to the cluster by changing the cluster cells weight appropriately.

The following subjects are covered in this chapter:

* Description of dead material calibration hits.
* Amount of energy deposited in dead material by neutral and charged pions.
* Procedure for assignment of DM energy to the cluster.
* Description of the method.
* Performance.

### Dead material calibration hits.

Dead material calibration hits are intended to record four calibration energies (em, non-em, invisible and escaped) in all regions outside of the active calorimeter. Since there is no read-out cell structure, dead material calibration hits represent some virtual division of material in different detector regions into cells with a \(\eta\times\phi=0.1\times 0.1\) grid structure generally. This is in contrast to calibration hits for active/inactive material in normal read-out cells.

Figure 17 shows in the R-Z plane the average energies deposited in dead material calibration hits for 500 GeV negative single pions produced with a flat distribution in \(\eta,\phi\). The color code represents the average energy of the calibration hits given the grid structure mentioned above (averaged in \(\phi\)). The schematic of the read-out cell structure of the calorimeter system is shown as well.

There are about 82000 DM grid boxes in 114 different dead material regions (57 of them in the region \(Z>0.0\) are shown in the Figure 17 as contiguous blocks of boxes at the same \(Z\) and radius) denoted by special dead material identifiers. Thus one can study the correlation between the cluster quantities and the total energy lost in dead material nearby.

### Amount of energy deposited outside calorimeters for neutral and charged pions in ATLAS.

The amount of dead material in front of the calorimeter system could be quite significant. The variation - given in radiation length \(X_{0}\) - ranges from \(\sim 1.5X_{0}\) at \(|\eta|\sim 0.0\) till \(\sim 6X_{0}\) in the crack regions (\(|\eta|\sim 1.5\)\(|\eta|\sim 3.2\)). Figure 18 shows the relative average energy deposited in the whole dead material by neutral and charged pions of different energies as a function of (true) \(|\eta|\). The relative energy deposited in dead material by neutral pions is in comparison to charged pions generally smaller, mainly because neutral pions rarely reaches a gap between _em_ and _had_ calorimeters. However, this is not the case for the crack regions at (\(|\eta|\sim 1.5\), \(|\eta|\sim 3.2\)) where the maximum of the electromagnetic shower falls right into the crack region. Here the energy deposition of neutral pions can reach as much as 70 % of the initial energy.

Figure 19 shows the fraction of energy deposited in different DM areas relative to the total DM energy for neutral and charged pions. The DM areas are:

\begin{tabular}{l|l} label & description \\ \hline DM\_PreSamplerB & material before barrel presampler and between barrel presampler and strips, \(|\eta_{hit}|<1.5\). \\ DM\_EMB3\_TILE0 & material between last sampling of em barrel and first sampling in Tile, \(|\eta_{hit}|<1.0\) \\ DM\_SCN & material before scintillator (not including inner detector services), \(0.8<|\eta_{hit}|<1.6\) \\ DM\_EMEC\_TileExt0 & material between EMEC (HEC) and first sampling in extended tile, \(1.0<|\eta_{hit}|<1.6\) \\ DM\_PreSamplerE & material before endcap presampler and between endcap presampler and strips, \(1.5<|\eta_{hit}|<1.8\) \\ \end{tabular}

Figure 17: Average energy deposited in dead material for 500 GeV negative pions. The red numbers show dead the related region code of an individual dead material region.

The total DM energy is the sum of energies deposited in these areas. Thus all contributions shown in Figure 19 (a-d) should add up to one.

### Dead Material corrections in ATLAS

#### 5.3.1 Assignment of DM calibration hits to clusters

In the ideal case the cluster algorithm should reconstruct one cluster per particle. In practice the number of clusters is larger due to contributions from fake clusters formed around cells with occasionally high noise. Additional clusters are reconstructed from secondary particles as well as clusters from two different nearby particles where the clusters got merged. In general, the average number of clusters in an event depends on the event topology. For single pions from MC simulation the topological cluster algorithm yields 14 clusters per event on average. Most of them are noise clusters with an average energy close to zero. Figure 20 shows for charged and neutral pions the ratio of the energy contained in the three most energetic clusters relative to the total energy in all clusters as function of (true) \(|\eta|\). The ratio is shown for the average energies \(<E_{\pi}>\sim 20.2\,\mathrm{GeV}\) and \(<E_{\pi}>\sim 201.6\,\mathrm{GeV}\). The maximum cluster contains \(\sim 50-100\) % of the total energy, depending somewhat on energy and particle type. Most of the residual energy is contained typically in two additional clusters. In consequence, prior to obtaining DM corrections for clusters the proper assignment of DM calibration hits to related clusters has to be optimized.

The following approach has been chosen:

_Step 1:_

The DM calibration hit is assigned to the cluster if it is a direct neighbour of at least one cluster cell.

\[|\eta_{hit}-\eta_{cell}|<(\Delta\eta_{hit}+\Delta\eta_{cell})/2\,\ \ \ \ |\phi_{hit}-\phi_{cell}|<(\Delta\phi_{hit}+\Delta\phi_{cell})/2\]

Each DM region has a predefined set of correlated calorimeter samplings. Only cluster cells in this given samplings are used in the neighbour scan. One DM hit may be assigned to several clusters. In this case a weight is calculated according to the cluster energy contained in the related sampling. Finally \(\sim 10\%\) of the DM energy at low \(\eta\) and \(\sim 30\%\) at high \(\eta\) remain unassigned to any cluster. This out-of-cluster energy is accounted for in step 2.

\begin{table}
\begin{tabular}{l|l} DM\_EME1 & material before endcap strips and first sampling of endcap inner wheel, \(1.8<|\eta_{hit}|<3.2\) \\ DM\_EMEC\_HEC0 & material between last sampling of EMEC and first sampling of HEC, \(1.5<|\eta_{hit}|<3.2\) \\ DM\_HEC\_FCAL & material in crack between EMEC and HEC calorimeters, \(\sim\ 3.0<|\eta_{hit}|<3.4\) \\ DM\_FCAL & material before FCAL calorimeter, \(3.2<|\eta_{hit}|<5.0\) \\ DM\_LEAKAGE & material behind calorimeter system (tile girder is included), \(|\eta_{hit}|<5.0\) \\ DM\_OTHER & material not covered by previous items (between em barrel modules, between inner and outer wheels, HEC azimuthal cracks, between FCAL modules), \(|\eta_{hit}|<5.0\) \\ \end{tabular}
\end{table}
Table 1: The different dead material regions in ATLASFigure 19: Fraction of energy deposited in different DM areas relative to the total DM energy for neutral (a,b) and charged (c,d) pions as function of (true) \(|\eta|\). Two energies are shown: \(<\!E_{\pi}\!>\!\sim 20.1\,\)GeV (a,c), \(<\!E_{\pi}\!>\!\sim 201.2\,\)GeV (b,d).

Figure 18: Ratio of energy deposited in dead material by single neutral (a) and charged (b) pions versus (true) \(|\eta|\)

_Step 2_:

The DM calibration hits, which could not be assigned to clusters in step 1, are assigned to all clusters found with weights depending on the cluster energy \(E_{clust}\) and the distance \(D\) from the hit position to the cluster:

\[weight=E_{clust}^{\alpha}\cdot exp(-D/R_{0})\]

The optimal parameters \(\alpha=0.5\) and \(R_{0}=0.2\) have been determined from special assignment procedure performance studies.

#### 5.3.2 Determination of DM correction parameters.

Three different approaches have been chosen to obtain the DM correction for the various regions shown in Table 1.

_1. TProfile approach_

This approach concerns the DM areas where there is a good correlation between well established cluster quantities and DM energy losses \(E_{[area]}\). These losses are parameterized with a first oder polyno

Figure 20: Default calibration scheme: ratio of the energy contained in the three most energetic clusters relative to the total energy in all clusters for for neutral (a,b) and charged (c,d) pions as a function of (true) \(|\eta|\). Two pion energies are shown: \(<E_{\pi}>\sim 20.2\) GeV (a,c), \(<E_{\pi}>\sim 201.6\) GeV (b,d).

mial as shown below:

\[E_{[DM\_PreSamplerB]} = offset(C_{flag},E_{clust},|\eta_{clust}|)+slope(C_{flag},E_{clust},| \eta_{clust}|)\cdot E_{PreSamplerB}\] \[E_{[DM\_EMB3\_TILE0]} = offset(C_{flag},E_{clust},|\eta_{clust}|)+slope(C_{flag},E_{clust},| \eta_{clust}|)\cdot\sqrt{E_{EMB3}\cdot E_{TILE0}}\] \[E_{[DM\_SCN]} = offset(C_{flag},E_{clust},|\eta_{clust}|)+slope(C_{flag},E_{clust},| \eta_{clust}|)\cdot E_{TileGap3}\] \[E_{[DM\_PreSamplerE]} = offset(C_{flag},E_{clust},|\eta_{clust}|)+slope(C_{flag},E_{clust},| \eta_{clust}|)\cdot E_{PreSamplerE}\] \[E_{[DM\_EME3\_HEC0]} = offset(C_{flag},E_{clust},|\eta_{clust}|)+slope(C_{flag},E_{clust},| \eta_{clust}|)\cdot\sqrt{E_{EME3}\cdot E_{HEC0}}\]

Thus, either the energy deposited in the preshower or a simple square root ansatz of the energies in the neighbouring calorimeter samplings are used as cluster quantities correlating well with DM energy deposits.

The individual coefficients, \(offset\) and \(slope\), depend on the classification flag \(C_{flag}\), cluster energy \(E_{clust}\) and cluster position in \(\eta_{clust}\). A grid of 7 energy bins (logarithmic) [3.3, 3.9, 4.3, 4.7, 5.1, 5.5, 5.9, 6.3] and 50 uniform \(|\eta|\) bins in the range \(0<|\eta|<5.0\) has been used to determine the parameters.

Figure 21a shows the dependence of energy deposited in front of the em calorimeter as a function of energy measured in the presampler for neutral pions. Only clusters with energies in the bin \(4.7<log10(E_{clust})<5.1\) are considered here. The DM correction coefficients are obtained from the linear fit of the \(TProfile\) histogram shown in Figure 21b. Finally the Figures 21(c,d) show the dependence of the fit parameters on the cluster energy.

From the \(offset\) it is visible that sometimes quite a significant amount of energy is deposited in front of calorimeter but no energy is measured in the presampler, i.e. \(E_{PreSamplerB}=0\), \(offset>0.0\)

Figure 21: Default calibration scheme: a,b) Energy lost in front of the barrel em calorimeter for \(\pi_{0}\)’s as a function of the energy measured in the presampler for clusters with energies in the range \(4.7<log10(E_{clust})<5.1\);

c,d) Dependence of the _offset_ and _slope_ parameter on the average cluster energy.

Figure 22: Default calibration scheme: a,b) Energy lost in front of the barrel em calorimeter for \(\pi_{\pm}\)’s as a function of the energy measured in the presampler for clusters with energies in the range \(4.7<log10(E_{clust})<5.1\);

c,d) Dependence of the _offset_ and _slope_ parameter on the average cluster energy.

Moreover, this amount increases with cluster energy. This could be explained by missing energy in the whole cluster (and also in presampler) due to the out-of-cluster effects. An indirect confirmation might be that no offset is obtained (within fit errors) when all active calibration hits in the presampler are used, irrespective of any cluster correlation (i.e. avoiding any clustering or out-of-cluster effects).

Figure 22(a-d) is very similar to Figure 21 but for charged pions. Comparing neutral with charged pions a different behaviour of the \(offset\) and \(slope\) parameters is observed: now the \(offset\) is bigger for the same cluster energy and the \(slope\) decreases with increasing cluster energy. A possible explanation could be that for charged hadrons the measured energy in the cluster is effectively smaller due to the invisible energy fraction. But as this fraction decreases with increasing hadron energy the \(slope\) coefficient decreases as well.

#### 2.2.2 Function minimization approach

The second approach is used to recover the energy deposited in the material before the FCAL calorimeter (FCAL nose, polyboron shield) and in the crack between the HEC and FCAL calorimeters. This is a rather difficult region for DM corrections due to the lack of any preshower. Further the first samplings of the FCAL and EMEC inner wheel are too thick to provide a good correlation with any dead material energy losses.

The approach here is to use new sampling weights providing this correction. Thus the reconstructed DM energy may be written as

\[E_{[DM\_FCAL]}^{reco}=\sum_{i}^{N_{c}}\ \sum_{j}^{N_{s}}E_{j}\cdot(w_{j}^{ new}-w_{j}^{old}),\]

where the summation \(i=1,N_{c}\) is performed over all clusters in the event and the summation \(j=1,N_{s}\) runs over all samplings for a given cluster. These weights depend on \(|\eta|\) but are independent of the cluster energy. They are derived from a \(\chi^{2}\):

\[\chi^{2}=\frac{1}{N}\sum_{i=0}^{N}\frac{(E_{DM\_FCAL}^{reco}-E_{DM\_FCAL}^{ true})^{2}}{\sqrt{E_{DM\_FCAL}^{true}}},\]

where sum runs over all events \(N\) of a given sample.

Figure 23 shows the dependence of sampling weights found as a function of \(|\eta|\) (cluster coordinate) for charged and neutral pions.

#### 2.2.3 Lookup approach

A third method is used to correct DM energy losses in following cases:

* The DM energy was deposited in different regions between calorimeter modules, e.g. in the material in front of the EMEC at \(1.8<|eta|<3.2\), in the gap between the EMEC and the extended TILE calorimeter and energy leakage beyond the calorimeter system (i.e. calorimeter areas where the _minimization_ and _TProfile_ corrections are not applied).

* low energetic clusters (\(log10(E_{clust})<3.2\)).
* no energy was measured in the presampler for a given cluster, or the algorithm failed to obtain a cluster quantity like \(\sqrt{E_{emb3}\cdot E_{tile0}}\).

Four dimensional lookup tables are used to store the average ratio \(<E_{DM}/E_{clust}>\), where \(E_{DM}\) is the dead material related to a cluster in the areas discussed above. The average of the ratio is obtained discarding the 2% upper tail. The four dimensions and the related binning are:

* 1D: 2 bins for _em-like_ and _had-like_ clusters.
* 2D: 50 bins in cluster energy \(2.0<log10(E_{clust})<6.3\).
* 3D: 20 bins in cluster depth \(0.0<log10(\lambda_{clust}<4.0\).
* 4D: 50 bins in cluster coordinate \(0.0<|\eta_{clust}|<5.0\).

Figure 23: Dependence of optimal sampling weights on cluster coordinate \(\eta\) for charged and neutral pions.

[MISSING_PAGE_EMPTY:28]

Figure 25: _Default calibration scheme: Linearity for different stages of the calibration for single charged pions. Top left: on the em-scale; top right: after weighting; bottom left: after weighting and out-of-cluster corrections; bottom right: after weighting, out-of-cluster corrections and dead material corrections_

Figure 26: _Default calibration scheme: resolution spread (RMS) for different stages of the calibration for single charged pions. Top left: on the em-scale; top right: after weighting; bottom left: after weighting and out-of-cluster corrections; bottom right: after weighting, out-of-cluster corrections and dead material corrections_

## 7 Performance for the 2004 combined test beam

The calibration procedure is fully based on MC simulation. Therefore the ability of the MC to describe the data is a critical issue. The available data are from beamtests which have been undertaken in the past: the ATLAS Barrel Combined Testbeam 2004 (CTB 2004) and the ATLAS Endcap Combined Testbeam 2004 (CTBEC2 2004). The analysis of the CTBEC2 2004 data is still in progress. Therefore the CTB 2004 data have been chosen to validate the calibration scheme in a first step. In the CTB 2004 beamtest a full slice of the ATLAS detector has been operated with all the related subdetector systems.

### Performance for the ATLAS Barrel Combined Testbeam 2004

As for ATLAS, all parameters for the individual calibration steps have been derived from MC, simulating here the beam set-up in all details. Pions as well as protons have been simulated to follow closely the particle mix given in the testbeam. The energies used in the simulation were close to those used in the testbeam (see Table 2). The interval around the nominal energy was typically \(\pm\)30%. All simulations have been done with Athena, version 12.0.6 and Geant4, version 4.7 using QGSP_BERT as physics list.

#### 7.1.1 Weighting

The weighting is done as described in Section 3. Figure 27 shows the difference between the total reconstructed energy (blue circles) and the true deposited energy (red squares) in all clusters for simulated pions of 100 GeV. Before the weighting, the mean value of the reconstructed energy is on average about 12 GeV lower than the true energy. After weighting the reconstructed energy is close to the true energy and the RMS improves from 5.31 GeV to 5.17 GeV.

Figure 28(a) and (b) show the effect of the weighting for pions of 20, 50, 100 and 180 GeV. A good agreement of reconstructed and true energy is observed. The relative deviation of the reconstructed energy from the true energy is below 1% for the whole energy range. The improvement of the resolution (RMS) of the relative deviation is about 15% at 20 GeV and 25% at 180 GeV.

\begin{table}
\begin{tabular}{c c} \hline \hline energies & run-number for geometry \\ (GeV) & \\ \hline
15, 17, 20, 22, 25 & 2392 \\
35, 40, 45, 50, 55, 60, 65 & 2343 \\
70, 80, 90, 100, 110, 120, 130 & 2355 \\
130, 150, 170, 180, 190, 210, 230 & 2225 \\ \hline \hline \end{tabular}
\end{table}
Table 2: Energies and run-numbers for the derivation of weights and corrections.

#### 7.1.2 Out-of-cluster corrections

The out-of-cluster (OOC) correction accounts for all energy depositions outside of the clusters and the dead material (see Section 4). Figure 29 shows the difference between reconstructed and true out-of-cluster energy.

The peak at \(\sim 1.3\)GeV when no correction has been applied is significantly reduced after the correction. However an asymmetric shape with a double peak structure can be observed where the peaks are slightly shifted to higher values. At the same time a shoulder starts to evolve at lower values. This asymmetry is not observed when the OOC corrections derived from ATLAS have been used. The main difference between the CTB derived and the ATLAS derived OOC corrections is the range of beam energies used to compute the corrections (logarithmic in ATLAS, in CTB see tab. 2). Hence, in the CTB more runs with high beam energy compared to runs with low energy are taken to derive the OOC corrections. This might cause the difference in the reconstructed OOC energy.

In Figure 28(c) and 28(d) the relative deviation of the reconstructed from the true out-of-cluster energy and the resolution thereof are shown. The out-of-cluster energy reduces the relative deviation for 20 GeV from about \(-4\)% to \(-2\)%, but over-corrects at 180 GeV from \(-1\)% to \(+0.5\)%. With the OOC corrections derived from the CTB 2004 no improvement of the linearity can be achieved. The resolution of the deviation between reconstructed and true OOC energy worsens. Since the asymmetric shape and the worsening of the resolution of the difference between reconstructed and true OOC energy is neither observed for the CTB when the ATLAS derived OOC corrections are used nor in full ATLAS simulations, this problem seems to be a particular problem for the test beam only.

Figure 27: Difference between the total reconstructed energy and the true deposited energy in all clusters for simulated pions of 100 GeV.

Figure 28: Default calibration scheme: Blue circles, red squares, green triangles pointing upwards and black triangles pointing downwards indicate the energy response at the electromagnetic scale, after the weighting correction, after the out-of-cluster correction and after the dead material correction respectively. The figures on the left hand side show the relative differences of the reconstructed (\(E_{\text{reco}}\)) and the true (\(E_{\text{true}}\)) value of (a) the cluster energy (\(E_{\text{cl}}\)), (c) the out-of-cluster correction (\(E_{\text{ooc}}\)) and (e) the dead material correction (\(E_{\text{DM}}\)). The figures on the right hand side (b), (d) and (f) show the respective resolutions of the relative differences.

#### 7.1.3 Dead material corrections

The performance for dead material corrections shown in this section have been obtained with a layer-based parameterization using the energies deposited in the adjacent layers to estimate the energy lost in the dead material (see Section 9.3.1). This method turned out to be more appropriate for the testbeam set-up and thus different from the ATLAS approach. The effect of the dead material correction for pions of 100 GeV can be seen in Figure 30. The distribution without dead material corrections shows two peaks. The peak at zero results from events where no energy is deposited in the dead material, in contrast to normal events. After the correction the double peak structure is reduced to a single peak close to zero. Also the mean is only slightly below zero. The RMS is reduced significantly reflecting in a remarkable improvement of the resolution. The effect of dead material corrections is shown in Figure 28(c) and (d) for beam energies of 20, 50, 100 and 180 GeV. At 20 GeV the dead material correction is underestimated by about 3%. This value decreases with increasing energy (see Figure 28(c)). The resolution is improved by \(\sim 15\%\) at 20 GeV and \(\sim 30\%\) at 180 GeV (see Figure 28(d)).

#### 7.1.4 Combined corrections applied on MC

The subsequent application of all three correction steps is shown in Figure 31. The energy distribution on the electromagnetic scale is indicated by blue circles. The energy distribution after the weighting step is shown with red squares, green triangles indicate the status after the out-of-cluster correction and finally black triangles (pointing down) show the energy distribution after all corrections applied. The reconstructed energy after all corrections is approximately equal to the beam energy and the shape of the distribution is narrower and more Gaussian when comparing to the em-scale.

Figure 32 shows the linearity and the resolution as function of energy for pions at the electromagnetic scale and after each step of correction. Blue circles show the result on the electromagnetic scale,

Figure 29: Difference between the reconstructed (\(E_{\rm OOC,reco}\)) and the true (\(E_{\rm OOC,true}\)) out-of-cluster energy in MC simulations of pions of 100 GeV.

Figure 31: Distributions of the reconstructed energy at the em-scale (blue circles), after weighting (red squares), out-of-cluster correction (green triangles) and dead material correction (black triangles) respectively.

Figure 30: Difference between the reconstructed (\(E_{\rm DM,reco}\)) and the true (\(E_{\rm DM,true}\)) dead material energy for pions of 100 GeV.

red squares after the weighting step, green triangles after the out-of-cluster correction and finally black triangles (pointing down) show the result after the dead material correction. At low energies the reconstructed energy is about 3% low. At high energies the deviation of the reconstructed from the true energy is within 1%. The resolution improves up to 17% at 20 GeV and 6.5% at 180 GeV. The energy resolution may be parameterized as:

\[\frac{\sigma}{E}=\frac{s}{\sqrt{E}}\oplus\frac{n}{E}\oplus c \tag{13}\]

where the symbol \(\oplus\) denotes a quadratic sum. The first term is the _stochastic term_, the second denotes the _noise term_ and the third one is the _constant term_[4, 5]. This function is fitted to the energy resolution for the energies of 20, 50, 100 and 180 GeV after all steps of hadronic calibration. A sampling term of 73.5%/\(\sqrt{E}\) and a constant term of 4% is found.

#### 7.1.5 Results for data

For the evaluation of the calibration scheme on data, the proton admixture in the pion beam has to be taken into account. Therefore the MC simulations mentioned above have been redone with protons as well and the related weights and corrections have been obtained. For each data run the weight files derived from pions and protons have been mixed with a pion/proton fraction according to the specific proton contamination in the pion beam. For pions the total energy is deposited within the hadronic shower. Due to the baryon number conservation, in a proton induced shower one baryon is left at the end of the shower development that has not deposited its energy in the calorimeter. Hence, there is a difference of the total deposited energy (visible and invisible) of one proton mass between a proton induced shower and a pion induced shower. To correct for this, all weights which were created with protons have been re-weighted with a factor \(E_{\rm beam}/(E_{\rm beam}-{\rm m_{p}})\) where \({\rm m_{p}}\) is the proton mass. Figure 33 shows the result on the data at 100 GeV after each step. After weighting the energy distribution is asymmetric with a large tail at high energies. The OOC-correction shifts the distribution slightly to higher energies, but does not change the shape. The dead material correction reduces the asymmetry, but a large tail remains which deteriorates the resolution. As for the MC simulation, a fit using (see eq. 13) has been applied to the data. But since for the data the proton contamination varies strongly with energy

Figure 32: Response and resolution as a function of energy for simulated pions at the electromagnetic scale and for each step of correction.

Figure 34: Default calibration scheme: linearity and resolution for the reconstructed energy of data at the em-scale, after weighting, out-of-cluster correction and dead material correction respectively.

Figure 33: Distributions of the reconstructed energy at the em-scale, after weighting, out-of-cluster correction and dead material correction respectively.

and the energy resolutions for pions and protons have a different energy dependence, the values obtained for the sampling term, noise term and constant term should be taken as guide only.

#### 7.1.6 Discussion

In comparison to MC the energy resolution for the data is worse. But this is the case already at the electromagnetic scale prior to the hadronic calibration. Some improvement of the MC prediction for the data is expected in future versions of Geant4. The deviation of the reconstructed from the true energy is 2% for MC (with all corrections applied) for energies above 20 GeV and 5% at 20 GeV. The corresponding numbers for the data are 5% for energies above 20 GeV and 7% at 20 GeV.

The validation of the hadronic calibration with the CTB 2004 data has shown, that the calibration scheme improves the linearity and resolution of MC simulations and testbeam data. This is important since the calibration parameters have been extracted from the MC. The fact that the linearity in the response can be obtained for the data proves that the quality of the MC simulations is sufficient to ensure a pion calibration to within a few percent.

Hadronic Calibration using the cone method

The cone method (for details see [6]) is a variant of the default hadronic calibration method. As in the default calibration approach, the weights are parameterized with the cell energy density, \(\rho_{E}\) and a global energy scale, \(E_{global}\). The global energy is in this approach not the energy of the cluster but the energy of the clusters which are within a cone of opening angle 11 degrees around the most energetic cluster. If some of the clusters fall outside the most energetic cone, secondary cones are opened.

### Monte Carlo samples for the cone method

The cone variant has been studied only for the combined barrel testbeam data CTB 2004. Thus the \(\eta\) range is restricted to typically \(|\eta|<0.8\). The Monte Carlo was using the simulation toolkit Geant4[7] within the Athena framework [8], version 11.0.421. The Monte Carlo samples generated were typically \(10,000\) events from 53 different energies in the range \(0.5-316.23\) GeV.

Footnote 1: The full version number for the Geant4 release used by default in Athena version 11.0.4 is GEANT 4.7.1.p01.clhep1.9.2.1, see [9].

### Weighting

When computing the weights, only the primary, i.e. most energetic cone is considered. This is different from the default method where all clusters are used. Separate look-up weight tables for each calorimeter sampling layer were created. To reduce the influence from noise, the ratios entered into the tables were restricted to the range \(0.6<E_{cell}^{truth}/E_{cell}^{0}<3\), where \(E_{cell}^{truth}\) is the total energy deposited in the cell as given from the simulation truth. Also only cells with an energy density more than \(3\sigma\) above the expected noise level were weighted. A version of the cone method has been successfully applied in H1 [2]. As in the default method the weighted hadronic scale energy, \(E_{weighted}\), is computed as the sum of the weighted energy of all cells within a topological cluster:

\[E_{weighted}=\sum_{cells\in clusters}w_{cell}\cdot E_{cell}^{0}. \tag{14}\]

In the default method the weights are applied to the hadronic clusters only. Clusters classified as electromagnetic are kept on the electromagnetic scale. However, this separation is not done for the single pions in the cone method.

### Dead Material corrections

Energy losses in four regions of dead material relevant for the testbeam set-up are [10]: the cryostat before the LAr pre-sampler (\(E_{upstream}^{est.}\)), energy lost between the pre-sampler and the LAr strips (\(E_{presamp/LAr}^{est.}\)), energy lost in the cryostat between LAr and Tile (\(E_{LAr/Tile}^{est.}\)) and energy lost due to leakage (\(E_{leak}^{est.}\)). The total weighted and corrected energy, \(E_{DMcorr}\), is given as

\[E_{DMcorr}=E_{weighted}+(E_{upstream}^{est.}+E_{presamp}^{est.})+E_{presamp/LAr }^{est.}+E_{LAr/Tile}^{est.}+E_{leak}^{est.}-E_{presamp}^{0} \tag{15}\]

\(E_{presamp}^{est.}\) and \(E_{presamp}^{0}\) are the estimated and the electromagnetic scale energies deposited in the LAr pre-sampler, respectively. The pre-sampler must be calibrated separately, since the amount of absorber material belonging to the pre-sampler cells (which in effect is the inner detector and the dead material in front of the pre-sampler) is heterogeneous and not well-described by a single volume number.

The estimated energy losses in the dead regions are given as

\(E^{est.}_{upstream}+E^{est.}_{presamp}=C_{upstream}\cdot E^{0}_{presamp}\)

\(E^{est.}_{presamp/LAr}=C_{presamp/LAr}\cdot\sqrt{E^{0}_{presamp}\cdot E^{0}_{LAr1}}\)

\(E^{est.}_{LAr/Tile}=C_{LAr/Tile}\cdot\sqrt{E^{0}_{LAr3}\cdot E^{0}_{TileA}}\)

\(E^{est.}_{leak}=C_{leak}\cdot E^{0}_{total}\)

where the factors \(C\) are the dead material correction factors for the related regions. The superscript 0 indicate energy on the electromagnetic scale. \(E^{0}_{total}\) is the total deposited electromagnetic scale energy in all clusters of a given event. The values of the dead material correction factors have been computed from the same Monte Carlo samples that were used for deriving the weights (see above). Figure 35 shows the correction factors as function of the beam energy. In the figure, the average corrections when including beam energies equal to or larger than 10 GeV are also indicated. These corr ections are (all dimensionless)

\(C_{upstream}=1.5023\pm 0.0022\)

Figure 35: Dead material correction factors as a function of beam energy.The top left plot shows the correction factors for the upstream energy losses, before the LAr pre-sampler. The top right plot shows the correction factors for the region between the pre-sampler and the LAr barrel. The bottom left plot shows the dead material correction factors for the region between LAr and Tile, and the bottom right plot shows the correction factors for leakage. The horizontal lines indicate the constant value when computed for all beam energies above and including 10 GeV. The values are given in the text.

\(C_{premap/LAr}=0.38399\pm 0.00049\)

\(C_{LAr/Tile}=1.7014\pm 0.0011\)

\(C_{leak}=(8.729\pm 0.085)\cdot 10^{-3}\).

The average correction factors for energies above 10 GeV are shown as well. Not knowing the beam energy a priori this would be the correction to be used in a bias free approach. But clearly some of the correction factors are beam energy dependent as seen in Figure 35. Especially at low energies the variations are quite strong.

### Linearity and energy resolution

The linearity of the weighted and dead material corrected energy is obtained from the mean of a Gaussian fit to the energy distribution \(E_{fit}\) divided by the beam energy \(E_{beam}\). Figure 36 shows the comparison of the unweighted and weighted energy, as well as the comparison between the cone method and the default method.

Both methods yield rather similar results. Figure 36 shows rather good agreement between the data and the Monte Carlo in the linearity of the weighted energy. Whenever there is a difference, a similar difference can be seen in the unweighted energy already. For the runs with positive particles (50 and 100 GeV, the response for the data is somewhat lower in comparison to MC. This is expected, since the runs with positive particles contain some proton contamination and the visible energy fraction from protons is lower than for pions. Obviously the weighting scheme cannot compensate for this effect. For the calibration of jets in ATLAS this will not be a problem, since the expected proton

Figure 36: Cone calibration scheme: linearity of weighted and dead material corrected energy (Monte Carlo and data) as function of beam energy. For comparison the results from the default method are shown as well. The errors indicated are the statistical errors only. The systematical uncertainties from cuts and corrections are indicated in Figure 37.

content of a jet is much lower than in these runs. The overcompensation at energies of 180 and 250 GeV is most likely an effect of the Monte Carlo not properly reproducing the shower development in the calorimeter system. The energy deposited in the Tile calorimeter is underestimated in MC. This results in an overcompensation in the data when the larger Tile weights are applied [11]. The MC does not describe the data for the lowest data point at \(9\,\mathrm{GeV}\). This holds already for the response at em scale. Partly the disagreement can be an effect of the systematic uncertainties introduced by the electron removal cut, as shown in Figure 37 (potentially some residual electron contamination). Another possibility is a problem in the Monte Carlo description of the data in this particular energy region, which is a transition region between different theoretical models [12]. The deviation from linearity (i.e. one) is especially significant at low energies. This is largely an effect of energy being deposited outside the topological clusters [13, 14, 3]. The out-of-cluster corrections, as described in Section 4 would take care of this missing energy, but they are not applied here. Partly this is also an effect of the energy dependence of the dead material corrections, as described in Section 8.3. Figure 37 shows the systematic uncertainties in the linearity from dead material corrections and the electron removal cuts. It is clear that the systematic effects from the dead material corrections are not enough to explain the low response. In addition to energy deposited outside the clusters, the very simple dead material corrections used here may not be enough to retrieve all energy lost in inactive layers.

The energy resolution is obtained from \(\sigma/E_{fit}\) of a Gaussian fit to the energy distribution. The resolution as function of \(1/\sqrt{E_{beam}}\) is given in Figure 38. The energy resolution for the Monte Carlo has been fitted with the function \(r=\frac{a}{\sqrt{E}}\oplus b\). The parameters obtained from the fit are given in Table 3. The related fit is not done for the data, as the proton contamination in the positive beams affects the energy resolution. This result would then not easily be comparable with the energy resolution for negative pions. The systematic uncertainties in the resolution, from dead material corrections and cuts, are of the same

Figure 37: Cone calibration scheme: linearity of weighted and dead material corrected energy (simulation) as function of beam energy. The errors indicated are the combination of the statistical errors and the systematical uncertainties from the dead material corrections and the electron removal cuts.

[MISSING_PAGE_EMPTY:43]

Hadronic Calibration using the layer correlation method

### Data and Monte Carlo

As an alternative to the default method the layer correlation method has been tested using testbeam data (CTB04) [15] and the related MC simulating the single particle response in the testbeam set-up ranging in energy from 1 to 350\(\mathrm{GeV}\). The reconstructed energy in layer L is obtained by building all the 3D topoclusters in the event and summing only the energy of the cells in layer L that belong to a topocluster. The total reconstructed energy is then derived by summing over the \(N_{lay}\) longitudinal layer in the calorimeter:

\[E_{L}^{rec} =\sum_{cell\_x3D}E_{cell\_x3D,L}^{rec} \tag{16}\] \[E_{tot}^{rec} =\sum_{L}E_{L}^{rec} \tag{17}\]

The beam of positive pions was impinging on the calorimeter at \(\phi=0\) and \(\eta=0.45\). The positive pion beams are known to have a sizable proton contamination, increasing from 0% at 20\(\mathrm{GeV}\) up to 75% at 180\(\mathrm{GeV}\). Monte Carlo samples were produced simulating both pions and protons with the same impact point on the calorimeter as the data. The interaction of the particles was simulated with GEANT4.7 [16] using both QGSP [17] and QGSP_BERT [18] physics lists. The full reconstruction of the events used the CTB04 geometry and the full simulation of the detector read-out in the ATLAS Athena Software version 12.0.6. Two sets of statistically independent samples were produced: a highly populated set ("correction" samples in the following) was used to derive weights and dead material corrections (see sections 9.2.1 and 9.3), while a less populated set was used as simulated data to derive the performance expectation ("signal" samples in the following).

### Weighting Method

The layer correlation method aims at deriving an event-by-event correction to the energy deposited in each longitudinal calorimeter layer on the basis of Monte Carlo simulated events. Events with different invisible energy content have different energy fluctuations, while shower development fluctuations affect dead material losses. For these reasons the corrections to recover invisible energy and dead material losses should be derived as a function of variables that are sensitive to energy fluctuations. This procedure should provide a unified treatment for compensation and dead material correction variables by capturing their correlation. The energy in each layer (see 17) is corrected by a weight and an additive correction to account for compensation and dead material effects

\[w(L)= <\frac{E_{L}^{true}}{E_{L}^{rec}}> \tag{18}\] \[E_{L}^{weighted} =w(L)E_{L}^{rec}\] (19) \[E_{tot}^{weighted} =\sum_{L}E_{L}^{weighted}\] (20) \[E_{tot}^{corr} =E_{tot}^{weighted}+E^{DM} \tag{21}\]

where \(w_{L}\) is the weight correcting for invisible energy in layer L. \(N_{lay}\) weighting functions are derived. In order to derive the corrections a fully simulated sample of single particles (pions and/or protons) impinging on the calorimeter is used. The true deposited energy by the pions or protons in each layer of the calorimeter is available with its break-up according to the calibration hits definition of section 1. The events in a fully simulated Monte Carlo sample are generated at a fixed beam energy. The resulting corrections are, in principle, dependent on the beam energy. The derivation of compensation weights assumes that simulated events have a fixed beam energy. Sample mixing and iteration techniques are used to overcome such dependence by using only the visible energy in the calorimeter. This is discussed in section 9.3.4 after the dead material corrections are considered in section 9.3.

#### 9.2.1 Compensation weights

Each event is associated to

* a set of the N layer energy deposits (\(E_{1}\),...,\(E_{N}\)), representing a point in an N dimensional vector space. In principle, it is not necessary to consider all the layers, so N can even be smaller than the total number of layers.
* the corresponding N coefficients necessary to re-weight each reconstructed layer energy deposit to the true deposited energy known in Monte Carlo i.e. \[w(L,i)=E_{L,i}^{true}/E_{L,i}^{rec},\] (22) where \(w(L,i)\) is the weight for the L\({}^{\rm th}\) layer in the i\({}^{\rm th}\) event, \(E_{L}^{true}\) is the true total deposited energy in the L\({}^{\rm th}\) layer and \(E_{L,i}^{rec}\) is the reconstructed energy in layer L for event i as defined in equation 17.

An average weight \(w_{k}(L)\) can be defined for each layer L in any bin k of a given subspace of the layer energy deposits:

\[w_{k}(L)=<w_{k}(L,i)>=\frac{\sum_{i}w_{k}(L,i)}{N_{k}}, \tag{23}\]

where the weights \(w_{k}(L,i)\) are those derived for the \(N_{k}\) events in bin k. If the events themselves have a weight 2, the functions are modified accordingly:

Footnote 2: For instance, to equalize the number of events for all data sets.

\[w_{k}^{we}(L)=<w_{k}(L,i)>^{we}=\frac{\sum_{i}w_{i}w_{k}(L,i)}{ \sum_{i}we_{i}}, \tag{24}\]

where \(we_{i}\) is the weight assigned to event i. The average weight distribution for a given layer \(w_{k}(L)\) can be calculated for bins of any P-dimensional subspace of the layer energy deposits. The choice of the suitable subspace and of the correct base are critical to achieve the best performance. Important criteria are a good separation of events with different content of invisible energy or the possibility to obtain the maximal information without having to resort to the full N dimensions. To meet these requirements a new basis for the energy deposit vector space is derived. The N-dimensional covariance matrix of the layer energy deposits is calculated as:

\[Cov(M,L)=\left\langle E_{M}^{rec}E_{L}^{rec}\right\rangle-\left\langle E_{M}^{ rec}\right\rangle\left\langle E_{L}^{rec}\right\rangle, \tag{25}\]

where

\[<E_{M}^{rec}E_{L}^{rec}>=\frac{\sum_{i}E_{M,i}^{rec}E_{L,i}^{rec }}{N}\text{ and }<E_{M}^{rec}>=\frac{\sum_{i}E_{M,i}^{rec}}{N}, \tag{26}\]where the sums are performed over all the \(N\) events in the sample and \(E_{M,i}^{rec}\) is the energy deposited in layer M in the i\({}^{\rm th}\) event. In principle, one can choose to look at the correlations of any given number of layers (i.e. the matrix can be N-dimensional with N\(\leq\)\(N_{lay}\)). Each event's coordinates can then be expressed in the new eigenvector basis as follows:

\[E_{M}^{rec}=\sum_{eig}\alpha_{M,eig}^{rec}E_{eig}^{rec}, \tag{27}\]

where \(\alpha_{M,eig}\) is the matrix that performs the rotation to the new orthogonal basis of the eigenvector in the N-dimensional vector space. The \(w_{k}\) functions can then be obtained by choosing P-dimensional bins (with P\(\leq\)N) in the new eigenvector's basis and calculating the averages over the events as shown in equation 23. The eigenvectors can be ordered according to the size of their eigenvalues and their directions are those of the independent fluctuations in the N-dimensional space. The eigenvectors with the largest eigenvalues determine the directions along which most of the fluctuations of the total energy take place. Thus \(w_{k}\) can be determined by the distribution of the events in the lower-dimensional space of such directions.

#### 9.2.2 Implementation

Five steps are necessary to derive the compensation weights from simulated Monte Carlo samples

* define the samples for weights generation and performance study (section 9.2.3)
* provide the energy deposited in each layer at the electromagnetic scale (section 9.2.4)
* calculate the covariance matrix (section 9.2.5)
* extract the eigenvectors and eigenvalues (section 9.2.6)
* build the compensation weights look-up tables (section 9.2.7)

#### 9.2.3 Samples definition

The "corrections" Monte Carlo samples are used to build a _"mixed"_ sample which is input to constructing the weight tables. In order to account for the beam content at each energy, a pion and a proton sample generated at that energy are mixed. If the samples have different number of events a sample dependent weight is applied so that all pions and protons samples in the interval are normalized to the same size before selection cuts. Weights can be derived for each data set by taking into account the measured values of \(f_{prot}\).

#### 9.2.4 EM scale energy determination

The layer energy derived in equation 17 is expected provide the correct reconstruction of the energy electromagnetically deposited in the calorimeters. The weights are defined in formula 22 with this assumption.

#### 9.2.5 Calculation of Covariance matrix

The layer energy covariance matrix Cov(M,L) (equations 25 and 26) is calculated by using events from the "mixed" sample. The full seven dimensional covariance matrix is use i.e. N = \(N_{\it{lay}}\) = 7 (see section 9.2.1.) In any given event a symmetric energy cut is applied on each layer energy such that the energy for that layer is re-defined as \(E_{M}^{\it{rec}}\), if \(|E_{M}^{\it{rec}}|>E_{M}^{\it{thr}}\), zero otherwise. In this way the contribution to the covariance from a layer only containing noise is set to zero. The energy threshold vector is

\[\vec{E}_{\it{thr}}(GeV)=(\sigma(1),\sigma(2),\sigma(3),\sigma(4),\sigma(5), \sigma(6),\sigma(7)) \tag{28}\]

where \(\vec{\sigma}\)(GeV) = (0.032,0.108,0.03,0.150,0.039,0.070,0.042). The cuts were optimized to obtain the best expected compensation performance on fully simulated Monte Carlo samples at 50 GeV.

#### 9.2.6 Extraction and interpretation of eigenvectors and eigenvalues

The covariance matrix Cov(M,L) is then diagonalized: the normalized eigenvectors and corresponding eigenvalues are calculated. The eigenvectors' directions are observed to be stable with beam energy and choice of physics list. A physical interpretation of the eigenvalues and normalized eigenvectors is given by considering their components. In a qualitative, but suggestive way one can say that:

* \(\vec{E}_{\it{eig}\otimes}^{\it{rec}}\) = "Difference between Tile and LAr"
* \(\vec{E}_{\it{eig}\otimes}^{\it{rec}}\) = "Difference between Tile second (middle) layer and Tile first layer"
* \(\vec{E}_{\it{eig}\otimes}^{\it{rec}}\) = "Total Energy"
* \(\vec{E}_{\it{eig}\otimes}^{\it{rec}}\) to \(\vec{E}_{\it{eig}\otimes}^{\it{rec}}\) \(\approx\) "Individual layers"

#### 9.2.7 Preparation of look-up tables for compensation weights

A set of seven look-up tables is built: one for for each layer of the calorimeter. The \(w_{k}\) functions defined in equation 24 are calculated in bins of the two-dimensional space spanned by the eigenvectors corresponding to the two highest eigenvalues i.e. P =2 (see section 9.2.1). So each layer is associated with a two-dimensional look-up table. The average weight in a bin is calculated by using only the energy values that passed the cuts defined in section 9.2.5. The table has the same number of equally spaced bins along the two dimensions: 128x128. Weights for the presampler layer of the LAr are not calculated, even if the presampler is kept in the covariance matrix. No weights are applied to the energy deposited in the presampler layer. Typical compensation weight look-up tables for pion-proton mixed samples are shown in figure 39: they refer to the second (middle) layer of the LAr calorimeter and to the first and second layer of the Tile calorimeter for a pion-proton mixed sample with 41% proton contamination. The proton weights are corrected by the factor \(\frac{E_{\it{beam}}}{E_{\it{beam}}-{\it{m}}_{proton}}\) for the fact that, for a proton, the sum of the total true deposited energy in the calorimeter is \(E_{\it{beam}}\) - \({\it{m}}_{proton}\). Regions dominated by electromagnetic deposits (average weights close to unity) are separated by those where hadronic deposits are predominant (average weights significantly larger than unity). The functions are layer dependent.

### Dead Material corrections

The total weighted energy is corrected for energy loss in non-instrumented (dead) material by a global additive correction

\[E^{corr}_{tot}=E^{weighted}_{tot}+E^{DM} \tag{29}\]

where \(E^{DM}\) is the dead material correction. The energy loss between the LAr and the Tile calorimeters is expected to be the largest dead material effect. The same technique as the one used for compensation weights is developed to correct for LAr-Tile related losses. Additional energy is lost due to energy leakage, dead material upstream of the detector, dead material between the LAr presampler and the first LAr layer (_"strips"_). For these smaller corrections, a parameterization of the energy loss as a function of the best estimate of the pion energy is used.

#### 9.3.1 Dead material corrections between LAr and Tile

For energy losses between LAr and Tile, each event is associated to its N energy deposits in the active calorimeter layers (as illustrated in Section 9.2.1 and to the true total energy lost in the dead material between LAr and Tile in that event i.e. \(E^{DM}\)(i), the loss in the i\({}^{\rm th}\) event. An average dead material correction, \(E^{DMLArTile}_{k}\), is defined in any bin k of a given subspace of the energy deposits:

\[E^{DMLArTile}_{k}=<E^{DMLArTile}_{k}(i)>=\frac{\sum_{i}E^{DMLArTile}_{k}(i)}{N_ {k}}, \tag{30}\]

Figure 39: Layer correlation method: weight table for simulated pion-proton mixed events (41% proton contamination) in LAr third (middle) layer and Tile first and second layer.

[MISSING_PAGE_EMPTY:49]

where the variables have the same meaning as in equation 27 and \(E\) is the best estimate of the beam energy of the simulated single particle in that event (see below). The unique dead material look-up table is filled by including all events at all available beam energies. An iteration technique is used to determine all the dead material corrections. At each step the best estimate of the reconstructed energy, \(E_{tot}^{corr}\), after all corrections, is used to set

* the scaling factor \(1/E\) (equation 34) for LAr-Tile corrections (and consequently the bin to extract the correction from).
* the best pion energy estimate \(E\) (equation 31) in the parameterization for the other dead material corrections

Dead material corrections are then recalculated and used to derive a new estimate of \(E_{tot}^{corr}\). The initial step uses the pion energy after compensation weights are applied as the best estimate for \(E_{tot}^{corr}\).

#### 9.3.5 Preparation of look-up table for dead material corrections

The \(E_{k}^{DMLArTile}\) functions defined in equation 30 are calculated in bins of the two-dimensional space spanned by the eigenvectors corresponding to the first and third eigenvalues i.e. \(T=2\). The tables also has \(128\times 128\) equally spaced bins. The same corrections for sample size and proton weights are implemented as for the compensation weights in Section 9.2.7. The dead material look-up table is shown in Figure 40 for a pion-proton mixed samples with 41% contamination. The plot shows the distribution of the rescaled dead material energy as a function of the rescaled eigenvectors according to equation 27. The different dead material fractions are clearly separated.

### Performance of layer correlation method

#### 9.4.1 Method Validation on Monte Carlo

The weighting technique is validated on Monte Carlo samples in separate steps. The first goal is to reconstruct the true deposited energy in the calorimeters (compensation validation). Finally also the full

Figure 40: Layer correlation method: look-up table for LAr-Tile dead material corrections for 41% proton contamination

energy of the incoming particles has to be reconstructed correctly. To test the performance in particular linearity and resolution are considered. The weights and dead material corrections are derived from the "correction samples" and applied on the statistically independent "signal samples".

#### 9.4.2 Compensation

The event-by-event difference \(E_{tot}^{weighted}-E_{tot}^{true}(calo)\) is considered where \(E_{tot}^{true}(calo)\) is the true total energy deposited in the calorimeter. The bias is defined as the average value \(<E_{tot}^{weighted}-E_{tot}^{true}(calo)>\) and the resolution is obtained by calculating the standard deviation \(\sigma(E_{tot}^{weighted}-E_{tot}^{true}(calo))\) in a (-20 GeV,20 GeV) window. The performance of the LC technique is compared to a simple calibration scheme (called \(e/\pi\) in the following) which uses beam energy information: each event in the sample is weighted with the same factor \(e/\pi=<E_{tot}^{true}>\)/\(<E_{tot}^{reco}>\) where \(<E^{true}>\) (\(<E^{reco}>\)) is the average true total (reconstructed) energy deposited in the given sample in the full calorimetry, but not in the dead material. The \(e/\pi\) calibration scheme provides a reference/scale to which the improvement in resolution of the LC weighting can be compared. The results of the validation procedure are shown in table 4. The bias is consistent with zero for all re-weighting schemes (LC and \(LC_{Ebeam}\) are considered). The resolution is improved by 13% to 16% if the LC weighting is used. The \(LC_{Ebeam}\) weighting is used to derive an upper limit for the best possible LC performance: the LC weighting attains from 65% to 85% of the upper limit. The results are derived for pions only.

The improvement in resolution between \(LC_{Ebeam}\) and LC shows that it is important not to assume the beam energy to get an unbiased estimate of the resolution.

#### 9.4.3 Linearity and Resolution

The performance for the fully corrected energy reconstruction is finally assessed in terms of linearity with respect to the beam energy and relative resolution. The reconstructed energy distribution is fitted with a Gaussian distribution in the interval (\(\mu\) - 2\(\sigma\), \(\mu\) + 2\(\sigma\)), where \(\mu\) and \(\sigma\) are the mean value and the standard deviation, respectively. The mean value \(E_{fit}\) and the standard deviation \(\sigma_{fit}\) of the fitted Gaussian are used together with the beam energy \(E_{beam}\) to define the linearity and the relative resolution:

* the linearity is \(E_{fit}\)/\(E_{beam}\) as a function of \(E_{beam}\)
* the relative resolution is \(\sigma_{fit}\)/\(E_{fit}\) as a function of \(E_{beam}\).

Both linearity and relative resolution are derived for the energy distribution at four stages:

\begin{table}
\begin{tabular}{|l|c|c|c||c|c|} \hline Energy & \multicolumn{2}{c|}{bias(GeV)} & \multicolumn{2}{c|}{resol (GeV)} \\ \hline \hline  & \(LC_{Ebeam}\) & LC & \(e/\pi\) & \(LC_{Ebeam}\) & LC & \(e/\pi\) \\
20 & -0.36 & -0.34 & 0.36 & 1.77 & 1.83 & 2.18 \\
50 & -0.10 & 0.02 & 0.48 & 3.04 & 3.26 & 3.77 \\
100 & 0.35 & 0.55 & 0.61 & 4.62 & 5.1 & 6.0 \\ \hline \end{tabular}
\end{table}
Table 4: Bias and resolution for the measurement of the energy deposited in the calorimeters in simulated samples for \(e/\pi\) weighting and LC weighting in both its standard form (LC) and using beam energy information (\(LC_{Ebeam}\)).

* at the electromagnetic scale
* at the compensated scale i.e. after applying the compensation weights
* after compensating weighting and application of dead material correction for losses between LAr and Tile
* after compensation weighting and all dead material corrections

The evolution of the energy distributions after applying the subsequent corrections are shown for 20 and 180 GeV in Figure 41.

Figure 42 shows linearity and relative resolution for the (20 GeV, 180 GeV) interval for fully simulated pions. The linearity plot shows that the electromagnetic scale is reconstructing only two-thirds of the beam energy. The compensation weights push the recovery to about 90% of the beam energy. Finally the dead material corrections allow beam energy to be recovered within 1% for pion energies above 40 GeV and within 3% for lower energies 3). The relative resolution improves when applying the different correction steps.At high beam energies (above \(E_{beam}\) = 100 GeV) compensation weights contribution to resolution improvement has the same magnitude as that of LAr-Tile dead material corrections. At lower beam energies dead material corrections account for about 70% of the relative resolution improvement down to about \(E_{beam}\simeq\) 30 GeV. Below \(E_{beam}\simeq\) 30 GeV all the corrections account for a similar fraction of the improvement: other dead material corrections than those for LAr-Tile account for about 20% of the resolution improvement, they are marginal above that threshold.

Footnote 3: The apparent discontinuity between the results at energies below 150 GeV and those above might be due to a geometry change in the description of the test-beam set-up: three cm of aluminium were included in the Inner Detector system for energies larger or equal than 150 GeV.

#### 9.4.4 Results

The distributions of the fundamental inputs to the calibration corrections are compared in data and Monte Carlo. The weights and dead material corrections derived from Monte Carlo "mixed correction" samples are finally applied on both data and "mixed signal" Monte Carlo samples. The normalized energy distributions (in unit bins of energy and events) for data and Monte Carlo are compared for 20 and

Figure 41: Layer correlation method: evolution of reconstructed energy distribution at the different correction stages mentioned in the text: from electromagnetic scale to full dead material and compensation correction. The left plot shows the simulation of 20 GeV pions, while the right plots features 180 GeV pions.

180 GeV in Figure 43. The four stages of corrections are shown. The quality of the initial description of data by Monte Carlo is not modified by the application of the compensation weights and dead material corrections.

#### 9.4.5 Linearity and Resolution

Linearity and relative resolution are extracted at all energies for both data and "mixed signal" Monte Carlo samples. Figure 44 shows that weighting recovers from 80% to 90% of the incoming beam energy. The dead material between LAr and Tile accounts for an additional 5% to 8%. The remaining dead material corrections allow linearity to be recovered within 3% (within 1% above 20 GeV). Weighting results more important at high energies. Dead material effects play a more significant role at low energies particularly at 20 GeV where other corrections than LAr-Tile dead material are important to get to within 3% of the beam energy. Figure 45 shows that relative resolution is improved by about 20% to 40% in data in evolving from the em scale to the fully corrected energy scale. A similar relative improvement is obtained in the Monte Carlo expectations: from 21% to 31%. The relative resolution is however smaller in Monte Carlo than in the data: the discrepancies, at each correction stage, vary between 6% an 24% depending on the energy. The discrepancies in the shape of the total energy distribution are more pronounced at lower energies and they are already present at the electromagnetic scale (see Figure 43).

Figure 42: Layer correlation method: linearity (left) and relative resolution (right) for fully simulated pure pion samples (“wholescan” approach)

Figure 43: Layer correlation method: normalized energy distribution for \(E_{beam}\) = 20 GeV (left) and \(E_{beam}\) = 50 GeV (right) after applying subsequent corrections for compensation and dead material effect. Data (filled circles) are compared with Monte Carlo simulation (solid line).

The effect of the calibration technique on the energy reconstruction can be explored by considering the following double ratios:

\[DRatio_{Lin}=(\frac{E_{fit,data}}{E_{fit,MC}})_{rec}/(\frac{E_{fit,data}}{E_{fit,MC} })_{corr} \tag{35}\]

\[DRatio_{Res}=(\frac{(\sigma_{fit}/E_{fit})_{data}}{(\sigma_{fit}/E_{fit})_{MC}})_ {rec}/(\frac{(\sigma_{fit}/E_{fit})_{data}}{(\sigma_{fit}/E_{fit})_{MC}})_{corr} \tag{36}\]

They represent the variation in the data to Monte Carlo ratio when corrections are applied to bring the reconstructed energy from the electromagnetic (_rec_ ) scale to the fully corrected hadronic (_corr_ ) scale. The ratio is considered both for the linearity and for the relative resolution as defined in Section 9.4.3. The deviation of the double ratio from unity is a measure of the effect of the weighting technique on the description of the data by the simulation. Figure 46 shows the evolution of the double ratio at three different stages of energy correction. The double ratio for linearity and resolution are consistent with unity within 0.7% and 5% respectively.. For linearity such changes are of the same order of magnitude of the discrepancies between data and Monte Carlo at the electromagnetic scale: the agreement between data and Monte Carlo simulation is the same for all corrections stages. This means that the Monte Carlo

Figure 44: Layer correlation method: data and Monte Carlo “mixed” samples are compared for linearity at all stages of the corrections. The left plot shows the superposed absolute values, the right plot shows the evolution of the Data to Monte-Carlo ratio. See text for details.

Figure 45: Layer correlation method: data and Monte Carlo “mixed” samples are compared for relative resolution at all stages of the corrections. The left plot shows the superposed absolute values, the right plot shows the evolution of the Data to Monte-Carlo ratio. See text for details.

is able to predict the corrections that should be applied on the data. The ability of the Monte Carlo to reproduce the data at the electromagnetic scale (i.e. before any correction) seems to be the most critical limiting factor. For the relative resolution the changes are small, if compared with the discrepancies at the (_rec_ ) scale: the discrepancies do not get worse when the corrections are applied to the data. From preliminary studies the new GEANT4 version (4.9) is able to provide a better description of the resolution in the data and it should be used for future analyses.

Figure 46: Layer correlation method: double ratios of data to Monte Carlo as defined in equations 35 and 36 at three different correction stages as a function of beam energy. The uncertainties on the electromagnetic and corrected ratios are assumed to be fully correlated.

## Conclusion

The local hadron calibration scheme is described in detail. The first step in this scheme is the cluster reconstruction, a powerful tool to suppress noise efficiently. These clusters are classified as related to electromagnetic or non-electromagnetic energy deposits, using detailed information on the cluster topology. To compensate for the different response of electrons and hadrons in the ATLAS calorimeter, the weighting scheme is employed. Based on the energy density in individual cells the correction for the invisible energy deposits of hadrons is derived. The related parameters have been obtained from the simulation of single pions in the ATLAS detector. The corrections for energy losses in dead material as well as for energy deposits not included in the cluster reconstruction are also obtained from these studies.

The energy of single pions is reconstructed typically within \(\pm 2\) % for energies \(E>20\,\mathrm{GeV}\) and \(\pm 5\) % for energies \(6<E<20\,\mathrm{GeV}\). The resolution is particularly at high energies substantially improved, typically by 30 %. At low energies the improvements are rather moderate, typically at the level of 10 %. The corresponding numbers for jets are similar when restricting to the final particle energy deposits in the calorimeter. There are additional contributions from low energy particles lost in the upstream material which will be taken into account by the out-of-jet corrections.

First steps towards a validation of the scheme using testbeam data corresponding to the region \(|\eta|=0.45\) in ATLAS have been presented. The deviation of the reconstructed energy from the beam energy is still at the level of \(\pm 4\) %, as well as the difference between the data and MC expectation. The energy resolution is indeed improved, but again some difference between data and MC is observed. These effects can be partially attributed to the uncertainties in the measurement of the proton contamination in the pion testbeam and to present shortcomings in the simulation.

In addition to the default weighting scheme alternatives have been studied as well. In the cone method the energy dependence is based not on the energy of an individual cluster but rather on the total energy of a larger cone around the most energetic cluster. The results are in agreement with the default method. Also a layer weighting approach has been tested for single pions, yielding similar results.

## References

* [1] W. Lampl, S. Laplace, D. Lelas, P. Loch, H. Ma, S. Menke, S. Rajagopolan, D. Rousseau, S. Snyder, G. Unal, (2008), ATL-LARG-PUB-2008-002
* [2] C. Issever, K. Borras and D. Wegener, NIM A **545** (2005) 803-812
* [3] S. Menke, Local Hadron Calibration Session, Talk given at ATLAS Hadronic Calibration Workshop, Milan, Italy, 26 April 2007
* [4] Fabjan, Christian W. and Gianotti, Fabiola, Rev. Mod. Phys. **75** (2003) 1243-1286
* [5] Wigmans, R., Calorimetry, (Oxford University Press, 2000)
* [6] E. Bergeaas Kuutmann et al., Local Hadronic Calibration of Single Pion Data from the Combined ATLAS Testbeam of 2004, ATL-CAL-Pub-2007-001
* [7] S. Agostinelli et al., NIM A **506** (2003) 250-303* [8] ATLAS computing group, ATLAS Computing Technical Design Report, third revision, Internal Report LHCC-2005-022, CERN, 4 July 2005
* [9] ATLAS Simulation Validation, [http://atlas-computing.web.cern.ch/atlas-computing/packages/simulation/geant4/validation/Validation.html](http://atlas-computing.web.cern.ch/atlas-computing/packages/simulation/geant4/validation/Validation.html)
* [10] K-J. Grahn and T. Carli, Systematics in pion energy reconstruction using Monte Carlo, Talk given at CTB LAr+Tile pion analysis meeting at CERN, 13 December 2006
* [11] E. Bergeaas, C. Issever, K. Jon-And, B. King, K. Lohwasser, D. Milstead, Local Hadronic Calibration of Single Pion Data from the Combined ATLAS Testbeam of 2004, December 2007, ATLAS public note ATL-CAL-PUB-2007-001
* [12] T. Carli, MC problems, validation local hadron calibration in the barrel combined test-beam, Ringberg workshop on refinement of local hadron calibration and its application to top physics, Thursday 12 June 2007
* [13] S. Menke, Status of Out-Of-Cluster Corrections and other Local Hadron Calibration news, Talk given at Hadronic Calibration Meeting, CERN, February 21, 2007
* [14] S. Menke, Status of Out-Of-Cluster Corrections and other Local Hadron Calibration news, Talk given at Hadronic Calibration Meeting, CERN, March 20, 2007
* [15] Di Girolamo, B. et al., _Beamline instrumentation in the 2004 combined ATLAS testbeam_, ATL-TECH-PUB-2005-001, ATL-COM-TECH-2005-001 (CERN,2005)
* [16] S. Agostinelli et al., _GEANT4-A simulation toolkit_, Nuclear Instruments and Methods in Physics Research A 506 (2003) 250-303, J. Allison et al., _Geant4 developments and applications_ IEEE Transactions on Nuclear Science 53 No. 1 (2006) 270-278
* [17] G. Folger, J.P.Wellisch, _String Parton Models in Geant4_, in Proceedings of _Computing in High Energy and Nuclear Physics_, 24-28 March 2003, La Jolla, California and references therein. Available at [http://www.slac.stanford.edu/econf/C0303241/proc/papers/MOMT007.PDFelax](http://www.slac.stanford.edu/econf/C0303241/proc/papers/MOMT007.PDFelax)
* [18] M. P Guthrie, R.G. Alsmiller and H.W.Bertini, Nucl. Instr. and Meth. 66 (1968) 29; H.W. Bertini and P. Guthrie, Nucl. Phys. **A** 169 (1971) 670; N. V. Stepanov, Preprint: ITEP-55 (Moscow) 1988.