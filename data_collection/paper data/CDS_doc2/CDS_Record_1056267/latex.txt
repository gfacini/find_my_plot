# System Test of the

ATLAS Muon Spectrometer in the

H8 Beam at the CERN SPS

C. Adorisio

G. Aielli

T. Alexopoulos

P. Amaral

C. Amelung

G. Avolio

R. Avramidou

P. Bagnaia

M. Barisonzi

M. Barone

F. Bauer

I. Benhammou

J. Bensinger

M. Beretta

S. Bessler

G. Bobbink

A. Borisov

H. Boterenbrood

I. Boyko

S. Braccini

P. Branchini

V. Canale

M. Caprio

R. Cardarelli

G. Cataldi

F. Cerutti

J. Chapman

G. Chelkov

G. Chiodini

G. Ciapetti

M. Cirilli

D. Dedovich

M. Della Pietra

D. Della Volpe

R. De Asmundis

A. Di Ciaccio

A. Di Domenico

A. Di Simone

J. Dubbert

E. Etzion

R. Fakhrutdinov

S. Falciano

R. Ferrari

A. Formica

C. Fukunaga

G. Gaudio

E. Gazis

P. F. Giraud

E. Gorini

F. Grancagnolo

J. Gregory

H. Groenstege

C. Guyot

R. Hart

K. Hashemi

S. Hassani

S. Horvat

R. Ichimiya

P. Iengo

M. Ikeno

P. Ioannou

M. Iodice

M. Ishino

Y. Kataoka

A. Konig

O. Kortner

C. Kourkoumelis

A. Kozhin

H. Kroha

Z. Krumshteyn

H. Kurashige

E. Lancon

A. Lanza

J. F. Laporte

D. Lellouch

D. Levin

L. Levinson

F. Linde

C. Luci

N. Lupu

G. Maccarrone

T. Maeno

K. Mair

S. Maltezos

A. Manz

E. Meoni

G. Mikenberg

P. Mockett

S. Mohrdieck-Moeck

K. Nagano

K. Nikolaev

R. Nikolaidou

A. Nisati

H. Nomoto

D. Orestano

S. Palestini

E. Pasqualucci

F. Pastore

R. Perrino

F. Petrucci

G. Polesello

A. Policichio

D. Pomarede

P. Ponsot

L. Pontecorvo

M. Primavera

F. Rauscher

D. Rebuzzi

R. Richter

S. Rosati

J. Rothberg

H. Sakamoto

R. Santonico

O. Sasaki

A. Schricker

G. Schuler

P. Schune

S. Spagnolo

R. Spiwoks

A. Staude

G. Stavropoulos

Y. Sugaya

S. Tanaka

S. Tarem

R. Thun

I. Trigger

G. Tsipolitis

C. Valderanis

P. Valente

W. Vandelli

R. Vari

S. Veneziano

J. Vermeulen

T. Wengler

P. Werneke

T. Wijnen

M. Wolter

M. Woudstra

Y. Yasu

T. Wijnen

[MISSING_PAGE_FAIL:2]

## 1 Introduction

The ATLAS muon spectrometer has been designed for the stand-alone measurement of muons produced in high-energy proton-proton collisions at the CERN LHC with a resolution better than 10% for transverse momenta up to 1 TeV, and to trigger on single muons with transverse momenta down to a few GeV. A detailed description of the spectrometer and of its expected performance can be found in reference [1, 2].

Since the year 2000, a large-scale system-test of the ATLAS muon spectrometer has been set up and operated in the North Area of the CERN Super-Proton-Synchrotron (SPS), at the H8 beam line. The test setup emulates one full-size projective tower of the barrel and of the end-cap spectrometer and has evolved with time, integrating more muon detectors and control devices. The main goal of the system-test was to study the integration of all the components of the ATLAS Muon Spectrometer and to evaluate the performance of the system in a configuration as close as possible to the final setup in the ATLAS experiment.

In this paper, after a general introduction to the H8 setup, performance studies of the MDT chambers are given in Section 2. The barrel and end-cap alignment systems are discussed in Sections 3 and 4. RPC performance studies are reported in Section 5, TGC and the Level-1 trigger studies are detailed in Sections 6 and 7.

### Setup overview

In the ATLAS experiment, the muon momentum is determined by measuring the track curvature in a toroidal magnetic field provided by three superconducting air-core toroid magnets, one in the barrel and one in each end-cap of the spectrometer, with a field integral in the range 2-8 Tm. The track curvature is measured with three layers of precision tracking chambers positioned along the muon trajectory. Most of the precision chambers in the muon detector are built from high-pressure drift tubes, referred to as Monitored Drift Tubes (MDT) [3]. In the end-cap inner region, for pseudorapidities greater than 2, Cathode Strip Chambers (CSC) [1, 4] are used since they are able to cope with higher background rates, at the expense of an increased electronics channel density. The expected background rates range from 10 to 100 Hz/cm\({}^{2}\) in the MDT region, increasing up to 1 kHz/cm\({}^{2}\) in the CSC region. These values have been computed by simulating high luminosity LHC running conditions and are affected by large systematic uncertainties.

Trigger chambers are based on two different technologies: Resistive Plate Chambers (RPC) [5] cover the barrel region while Thin Gap Chambers (TGC) [6] are used in the higher background environment of the end-cap region. Two RPC doublets (two gas gaps) attached to the middle barrel chambers provide the low-\(p_{T}\) trigger information. The information from a RPC doublet installed on the outer barrel chambers is combined with the signal from the middle chambers to produce the high-\(p_{T}\) trigger. RPC chambers are also used to provide the coordinate along the MDT tubes ("second coordinate"), which is not measured by the MDT chambers. Similarly in the end-cap, two TGC doublets andone triplet (three gas gaps) are installed close to the middle station and provide the low- and high-\(p_{T}\) trigger signals. The TGC also measure the coordinate of the muons in the direction of the MDT wires. For this purpose, additional TGC chambers are installed close to the inner MDTs to improve the measurement accuracy of this coordinate.

This section describes the setup during the 2003 period of data taking; a schematic overview is shown in Figure 1. The test concerned different detectors (MDT, RPC, TGC), auxiliary subsystems such as alignment or detector control systems, and key software tools (data acquisition, calibration, track reconstruction, alignment software and database).

A muon beam with momenta ranging from 20 GeV/c to 350 GeV/c was available in this area during SPS running periods. Most of the data during summer 2003 were taken with a narrow-band beam of 180 GeV central energy. At this energy, the beam profile is characterized by an intense core with an r.m.s. radius of about 3 cm and an extended beam halo with a r.m.s. radius of about 1 m. Beam triggers were made with two sets of scintillation counters: a coincidence of two 10\(\times\)10 cm\({}^{2}\) scintillators, hereafter referred to as 10\(\times\)10 trigger, to trigger on the beam core, and a coincidence of two hodoscope planes of \(100\times 60\) cm\({}^{2}\) size in anti-coincidence with the 10\(\times\)10 trigger, hereafter referred to as hodoscope trigger, to trigger on the beam halo. The time resolution of the 10\(\times\)10 trigger was better than 1 ns while the hodoscope trigger had a time resolution better than 2 ns. For some periods of the 2003 run, signals provided by the TGC and RPC trigger chambers were also used for triggering.

A SPS dipole magnet1 has been used in some runs to enhance the beam dispersion for low momentum muons, in order to emulate the angular spread of particles from the virtual interaction point in ATLAS.

Footnote 1: MBLP magnet with a maximum field integral of about 4 Tm, corresponding to a momentum kick of about 1.2 GeV

The H8 muon setup can be divided in two parts: a barrel stand consisting of six MDT chambers, reproducing the geometry of an ATLAS barrel tower (two inner large, BIL,

Figure 1: Plan of the H8 test beam lay-out in 2003. From left to right: the 10x10 trigger, the bending magnet, the hodoscope trigger, the barrel BIL, BML, BOL stations equipped with the trigger RPC, the end-cap EIL, EML and EOL MDT chambers and the trigger TGC chambers. The coordinates in capital letters are used by the alignment system; the ones in small letters are used by the offline reconstruction software.

two middle large, BML, and two outer large, BOL, chambers) and six end-cap MDT chambers reproducing the geometry of one end-cap octant (inner large-1, EIL, and inner small-1, EIS, middle large-2, EML, and middle small-2, EMS, outer large-3, EOL, and outer small-3, EOS). In the ATLAS nomenclature Inner, Middle and Outer refer to the position with respect to the interaction point. In the barrel stand the Middle and Outer stations were also equipped with RPC chambers. In the end-cap stand, one TGC triplet and two TGC doublets were installed close to the middle station. All the stations were tilted by \(15^{\circ}\) with respect to the plane perpendicular to the beam axis. Pictures of the H8 muon setup are shown in Figure 2 and 3.

Both the barrel and end-cap stands were equipped with their optical alignment systems. The principle of the alignment system [7] is to have the three stations of a trigger tower connected by optical lines emulating the trajectory of infinite momentum muons produced at the ATLAS interaction point (Figure 4). For the end-cap chambers, this principle is implemented using so-called alignment bars since in the ATLAS spectrometer the cryostat of the end-cap magnet prevents direct light paths.

### The data acquisition system

The Data Acquisition system (DAQ) used during the beam test was based on the ATLAS DAQ architecture [8]. The computing and network infrastructures were built as a prototype of the ATLAS infrastructure. This allowed for using the muon setup as basis for a "combined run" carried out in september 2003, when the ATLAS Pixel, Silicon Central Tracker, and Tile Calorimeter detectors were read out simultaneously with the muon detectors. The network was laid out as two separate private networks: a Fast

Figure 2: Picture of the end-cap test stand with six MDT chambers and two TGC stations, taken in July 2003. From right to left: EOL, EML and EIL MDT chambers; the TGC doublets are close to the middle MDT station.

Ethernet system for control messages and a Gigabit Ethernet network for data transfer. All network services have been set up in the private control network; the access to the CERN network was made possible via a dedicated gateway with a firewall. A dedicated server was set up to:

- allow for network booting of all the diskless Single Board Computers (SBC), hosted

Figure 4: Working principle of the ATLAS muon alignment system.

Figure 3: Picture of the barrel tower consisting of two Inner, two Middle and two Outer MDT. The RPC attached to the Middle (center) and Outer (left) barrel MDT are also visible.

in VME crates and dedicated to configuration and read-out of data from all the read out boards in the system;
* act as central repository for releases of the Data Acquisition software used during the beam test;
* provide a common installation of all necessary analysis tools and utilities.

The three detector technologies could be read out concurrently, together with the Muon Central Trigger Processor Interface (MuCTPI) (described in Section 7). A diagram of the DAQ system is shown Figure 5.

On each MDT chamber, data were read out by on-detector TDCs and ADCs, triggered by a signal received via the TTC (Trigger Timing and Control) [9] optical system, and collected by a Chamber Service Module (CSM) [10] prototype. An optical link connected each CSM to an MDT Read Out Driver (MROD) [11], housed in a 9U VME64X crate, together with a Single Board Computer (SBC) 2 that acted as crate controller. Each MROD can receive data from up to 6 CSMs. Two MRODs were used, for the end-cap and the barrel setup, respectively. Both MRODs sent data asynchronously via a S-link [12] to a single PC. This PC emulated the functionalities of a Read Out System (ROS), which in the final system implements the interface between the detectors' Read Out Drivers, the second level trigger farm and the event building system. At the 2003 test beam, ROSes

Figure 5: Schematic view of the data acquisition system as implemented at the 2003 H8 beam test.

were used to collect data from each detector crate and to build event fragments ready for final event building.

The RPC read-out was based on two VME modules: a data receiver module (RPC-RX) and a sector logic module (RPC-SL), collecting information from on-detector trigger electronics. Several TDCs housed in the same VME crate were used to provide an alternative read-out of RPC strips. Data were acquired by the SBC via the VME bus. In order to comply with the ATLAS standard data format, the RPC Read Out Driver was emulated by the SBC. Emulated fragments were sent to the ROS via an optical link.

TGC chambers were read out with a Read Out Driver prototype; a test ROD was also used for trigger commissioning. Both were connected to their respective ROS with optical links. For debugging purposes, they were read out in parallel and data were successfully cross-checked. The ROD prototype processed data from the front-end electronics; raw data were also copied via VME to a local buffer on the crate controller and a monitoring process checked consistency between raw data and processed events. Data collected during the spill (\(\sim\) 5 sec) could be processed during the inter-spill time (\(\sim\) 20 sec). A few thousand events were typically collected during a spill.

An additional VME crate ("beam crate") contained an I/O register3 a TDC and a SBC4. The I/O register was used to select the trigger source. During the last period of the test, when the SPS beam was bunched to simulate the LHC beam crossing period, the TDC was used to measure the phase between the beam and the trigger signal and the SBC acquired its data, acting as ROD emulator and sending data to the RPC ROS.

Footnote 3: Model V262, CAEN, Viareggio, Italy.

Footnote 4: Model RIO 8062, CES, Geneva, Switzerland.

All the data fragments built in the Read Out Systems were sent via Gigabit ethernet links to a PC for final event building and data output to the staging disk. Data files were then transferred to the remote CERN data recording facility for permanent storage.

#### 1.2.1 The online data monitoring

A monitoring service based on the ATLAS DAQ monitoring facilities was developed for MDT and RPC chambers. It was based on the Online Monitoring Service provided by the online software, allowing to interface an event provider (event sampler) with an event user (monitoring program) regardless of the actual implementation of the sampler. As a consequence, data sampling was possible at any level of the acquisition chain (ROD, ROS or event builder). A file sampler was also implemented, allowing to sample events from saved data files for code development or "a posteriori" checks.

The monitoring programs were organized as a Finite State Machine (FSM) in order to match DAQ states. State transitions could be controlled either by the user or by the DAQ itself, via a controller to interface the monitoring system to the ATLAS online communication system. The Inter Process Communication (IPC) between the monitoring controller and the monitoring applications was based on a package developed for the KLOE experiment [13]. The core software handling the Finite State Machine and the interface with the online services was detector independent; data decoding and histogramming were implemented as user plug-in libraries. Histograms were produced using the ROOT [14] package and made available online through the ATLAS Online Histogramming Service (OH). They could also be displayed via a graphical browser.

1.3 Alignment sensors

Two different types of optical alignment systems are used in the ATLAS muon spectrometer: RASNIK [24] and BCAM/SaCam [25, 26]. Both systems consist of a CCD looking through a lens at a target, the main difference being the type of target. Each system provides a CCD image, which is analyzed on-line and converted into geometrical parameters. In addition, temperature sensors are used to monitor the thermal expansion of the MDT chambers and, in the end-cap, of the alignment bars.

#### 1.3.1 Rasnik

A RASNIK (Red Alignment System of NIKHEF) sensor consists of a CCD, a lens, and a back-illuminated chessboard-like pattern on a glass slide, called mask. These three optical elements can be either placed separately in the detector, or the CCD and the lens can be integrated in a stiff tube to build a camera. The former setup can be used as a three-point straightness monitor, while the latter is a directional point-line monitor or proximity sensor. The response of the RASNIK system is given by the positions of the three elements relative to the optical axis (through CCD and lens). The four parameters provided by a RASNIK are: the translation in the two coordinates orthogonal to the optical axis, the rotation angle between the mask and the CCD around the optical axis, and the magnification at which the mask image appears on the CCD.

In the barrel alignment system, RASNIK CCDs are monochrome CMOS sensors5. These devices contain \(384\times 287\) pixels with a size of \(12\,\mu\)m. The sensitivity peak lies at \(820\,\)nm wavelength. The CMOS is embedded in a custom-made electronic board, which converts the CMOS signal into a semi-differential CCIR composite video signal sent to the outside via a RJ-45 cable. The readout frequency is \(7.37\,\)MHz. The whole electronics is mounted in an aluminum die-cast housing and the optical window is covered with an infrared filter6, in order to avoid stray light.

Footnote 5: VV5430 Monolithic Sensor, VLSI Vision Limited, Edinburgh, UK

Footnote 6: RG830 Schott filter by Bes Optics Inc., W. Warwick, RI, USA.

In the end-cap alignment system, the CCD7 has \(320\times 240\) pixels with a size of \(10\,\mu\)m being controlled and read out through the LWDAQ system. The mask is a thin (\(0.5\,\mu\)m thick) film chromium-glass slide with a modified chessboard pattern, back-illuminated by an array of 9 infrared LEDs (875 nm wavelength). The squares on the chessboard

Figure 6: Components of the basic RASNIK system.

pattern have dimensions such that a black/white square is projected onto at least 5-10 CCD pixels. Depending on the setup, a variety of square sizes in the range 85-340 \(\mu\)m are used.

The lens is usually placed approximately halfway between mask and CCD. As the mask dimensions (of order cm) are larger than those of the CCD (of order mm), the image projected onto the CCD corresponds to only a small fraction of the mask. In order to determine its location on the mask, the chessboard pattern is modified in every ninth column and row to encode coarse position information. Fine position information is obtained from an interpolation of the many black/white transitions, and should be better by a factor of \(\sqrt{N_{pixel}}\) than the CMOS pixel size of 12 \(\mu\)m.

A nice feature of the RASNIK is the decoupling of dynamic range and position resolution: the dynamic range can be increased by using a larger mask, without any loss in resolution. With this, the dynamic range of the RASNIK can be extended to several decimeters. For a symmetric RASNIK, where the lens is positioned halfway between CCD and mask, position resolutions of a few microns have been obtained for the coordinates transverse to the optical axis. The longitudinal position is measured by the magnification of the image, and the resolution is about \(10^{-5}\) times the distance between CCD and mask.

#### 1.3.2 BCAM/SaCam

The BCAM (Boston CCD Angle Monitor) used in the end-cap alignment is a camera, consisting of a CCD and a lens, which looks at a laser diode at a distance between 0.5 m and 16 m. The distance from CCD to lens is very close to the focal length of the lens, about 76 mm, and the image seen by the camera is thus a blurred circular light spot. The position of the centroid of this light spot on the CCD can be translated into a transverse angle with respect to the BCAM optical axis. The longitudinal position can be obtained, with lower precision, from the relative angle between the image of two laser diodes mounted in the same BCAM if their separation is known. One or two cameras and two or four laser diodes are integrated in one BCAM. In the case of two cameras, they are arranged next to each other facing in opposite directions.

BCAMs can be used in two configurations. Each BCAM of a pair is a directional two-point monitor, measuring the absolute angular position of its partner to an accuracy of 50 \(\mu\)rad. A triplet of BCAMs on a straight line is a three-point straightness monitor, each of the outer BCAMs measuring the relative angular positions of the two others with an accuracy of 5\(\sqrt{2}\) \(\mu\)rad. In addition, each pair of BCAMs in such a triplet also provides two-point information. The effective longitudinal precision, using the two laser diodes separated by 16 mm, ranges from 300 \(\mu\)m at 0.5 m to 75 mm at 16 m. The dynamic range of a BCAM is \(\pm 21\) mrad in horizontal and \(\pm 16\) mrad in vertical direction, given by the active area of the CCD.

The SaCam (Saclay Camera) used in the barrel alignment is very similar to the BCAM. Its CCD is of the same type as the one used for the barrel RASNIKs, and the lens is mounted at a distance of 80 mm from the CCD. The target is formed by 4 back-illuminated holes at two different spacings: \(15\times 15\) mm for standalone targets and \(35\times 50\) mm for targets mounted on a camera housing.

### The barrel alignment system setup

The H8 barrel alignment setup comprises 66 optical lines, i.e. about 1% of the optical lines of the barrel spectrometer. Important features like the data acquisition chain, calibration procedures and cabling schemes have been tested under real conditions. The 66 optical lines can be divided in different classes, as listed in Table 1.

Each MDT chamber is equipped with four in-plane RASNIK lines to monitor deformations of the chambers. The role of the projective alignment system is to provide the relative positions, later translated to sagitta corrections, of the three chamber layers. However, in ATLAS not all barrel chambers can be located on projective lines due to the lack of space. Therefore, additional systems are required to establish an optical link between the chambers with projective elements and the adjacent chambers without. These praxial and axial alignment sensors are used to align the MDT chambers within a chamber layer with respect to each other; the sensors are installed at the corners of the MDT chambers.

In ATLAS, an optical link from the MDT chambers to the barrel toroid is established by the reference system, which is divided in two parts: a set of SaCam cameras linking the coils to each other, and another set linking the coils to the chambers. All these cameras are mounted on plates, which in the test beam were fixed on external supports. The CCC (Chamber-to-Chamber Connection) systems provide links between the Small and Large chambers. BIR-BIM connections are special optical links between chambers in the two sectors where the support feet of the ATLAS structure are located. As in the test beam only Large chambers were installed, these systems have not been tested. Since the MDT wires are the reference objects for muon track measurements, all alignment sensors on chambers were positioned with respect to MDT wires by means of precise mechanical tools.

### The end-cap alignment system setup

While the barrel region can accommodate an alignment system mainly based on the measurement of relative positions of chambers in a tower, i.e. of triplets of chambers

\begin{table}
\begin{tabular}{|l l c c|} \hline Name & \multicolumn{2}{c}{sensor type number alignment type} \\ \hline In-plane & RASNIK & 24 & MDT deformations \\ Praxial & RASNIK & 12 & Plane alignment \\ Axial & RASNIK & 6 & Plane alignment \\ Projective & RASNIK & 8 & Tower alignment \\ Reference & SaCam & 16 & Link to the toroid \\ CCC & SaCam & – & Small-to-large chamber connection \\ BIR-BIM & RASNIK & – & BIR-to-BIM chamber connection \\ \hline \end{tabular}
\end{table}
Table 1: The seven classes of optical lines used in the barrel alignment system. In the test beam setup only the first five were present.

traversed by a muon, the alignment in the end-caps requires the addition of alignment bars [20]. These are hollow aluminum tubes, up to 9.6 m long, used as precision reference rulers: as for chambers, their deformation, relative position, and thermal expansion are monitored by optical and temperature sensors. The positions of the end-cap MDT chambers are monitored by optical sensors relative to the closest alignment bars, rather than to the other chambers in the same tower.

The end-cap alignment scheme has been designed as follows. The relative positions of alignment bars are measured using a grid of BCAMs. These are arranged as radial pairs (along an alignment bar) and azimuthal pairs (inside a chamber layer), and as polar triplets (connecting different layers) of BCAMs. RASNIK proximity sensors are used to monitor the positions of MDT chambers with respect to alignment bars, in addition, azimuthal BCAMs look at light sources on MDT chambers. Three-point RASNIKs measure the deformations of MDT chambers and of alignment bars. Finally, temperature sensors monitor the thermal expansion of chambers and bars.

An important feature of the end-cap system is factorization: it is possible to reconstruct the alignment in sequential steps without significant loss of precision. The shape of alignment bars and MDT chambers can be reconstructed individually, then the relative alignment of all the bars is performed, and finally the positions of pairs of chambers are determined with respect to the closest alignment bars. This reduces the required computing power, as the complexity of an alignment problem grows (for a moderate number of objects) approximately with the square of the number of objects to be aligned in one step.

### The detector control system

#### 1.6.1 The MDT control system

The Detector Control System (DCS) [15, 16] handled the configuration, readout, and monitoring of temperature sensors, alignment devices, and low voltage power for the MDT front end electronics for both the barrel and end-cap regions of the setup. The readout, monitoring, and first stage analysis tasks were distributed across seven processors linked by the DIM data transfer system [17], a client/server protocol developed at CERN. The central monitoring and user interfaces were built using the general purpose industrial control system PVSS-II8, which had been selected by CERN for the LHC experiments. PVSS can run as a distributed system and permits object-like definition of devices and components. A graphical editor and a scripting language assist in the development of monitoring code and a framework developed at CERN [18] allows for configuration of large arrays of devices.

Footnote 8: Produced by ETM AG, Eisenstadt, Austria.

The low voltage power for the readout electronics boards on each MDT chamber was fed by two power supplies9. Each of them was a node on a CANBus10 connected to a Kvaser.11 PCI CAN board in a computer running PVSS. The supplies were controlled and read by a PVSS process via the OPC12 client/server protocol.

Footnote 9: Model PL 500, Wiener, Burscheid, Germany.

Footnote 10: Controller Area Network, CAN in Automation, International Users’ and Manufacturers’ group.

Footnote 11: Kvaser, Advanced CAN Solutions, Molndal, Sweden.

Footnote 12: Open Process Control (formerly OLE Process Control), an industry-wide standard data interface.

The temperature profile of MDT chambers was monitored by a number of temperature sensors mounted on both sides of each chamber. The barrel chambers and two end-cap chambers (EO station) were equipped with NTC thermistors13 while four end-cap chambers (EI and EM stations) were equipped with TMP sensors14. The six end-cap alignment bars (two bars per chamber station) were outfitted with interior Platinum Pt-100 and Pt-1000 temperature sensors15.

Footnote 13: NTC type DC95, Thermometrics Inc., Edison NJ, USA

Footnote 14: Type TMP37, Analog Devices Inc., Norwood, MA.

Footnote 15: Produced by Pico Technology Limited, St Neots, Combridgeshire, UK.

The temperature sensors were calibrated in the laboratory and calibration constants applied at the time data were read. The sensors were read out using the Embedded Local Monitor Boards (ELMB) [19] developed for voltage measurement and control in a high radiation environment. Each ELMB is a node on a CANBus carrying control signals and data readout. Temperature values were recorded at regular intervals by a PVSS process and the data were stored for use by the global alignment programs. The ELMB's will also be used for magnetic field measurement and for configuration and monitoring of the on-chamber readout electronics.

A three-dimensional grid of optical alignment devices linked MDT chambers and, in the case of the end-cap, also the alignment bars [20]. Deformations of alignment bars and chambers were monitored by dedicated optical sensors. The alignment data acquisition system provided about 300 images for each readout cycle of about five minutes. A description of the different types of optical devices used in the alignment systems is given in Section 1.3.

Image analysis tasks ran on different processors with a rate of about one image per second. Image analysis results were stored in local files and in a common database; during normal running about 15 MB of image analysis data were generated per day.

For the barrel alignment system, control of the hardware devices was done via multiplexers and the image readout was handled by a frame grabber16 board in a computer running Windows. A server program configures the multiplexers and sends images via DIM to an analysis task. A supervisory PVSS program controls the data acquisition cycle and receives results for display and archiving.

Footnote 16: Model DT3152 for the PCI bus, Data Translation, Marlboro, MA, USA.

In the end-cap, the Long Wire Data Acquisition System (LWDAQ) [21] controlled and read out the alignment sensors. Driver boards in a VME crate implement the flashing and readout sequence digitizing and buffering the images from the sensors to which they are connected through multiplexers. The end-cap system comprised 19 multiplexers (one per chamber and two per alignment bar plus one for the muon simulator camera) and three driver boards. The driver boards are controlled by an embedded microprocessor17 in the VME crate. This processor configures the drivers with the device addresses, exposure time, and readout sequence and receives the digitized image via the VME backplane for monitoring, display, and image analysis.

Footnote 17: Type VP110, Concurrent Technologies, Essex, UK.

#### 1.6.2 The RPC control system

The purpose of the DCS system for the RPC chambers is to monitor and control crucial parameters of the detector operating conditions:* gas flow and composition, manifold pressure;
* high voltage status (voltage and current monitor);
* gap currents (measured directly on the gas gaps);
* low voltage supplying the front-end electronics.

For some of these parameters, action must be taken in order to stabilize the working point of the chambers or to shut them down in case of emergency. For instance, corrections to the high voltage settings must be applied in order to compensate for variations of environmental parameters like temperature and pressure. The high voltage on the gas gaps must be shut down in case of gas problems (anomalous flow rate, bad composition, low pressure in the manifold), or in case of over-current.

The system architecture was based on a PC running windows XP, where a PVSS-II application runs continuously. The application had been developed using the standard Joint Control Project (JCOP) Framework for LHC experiments, developed at CERN [22]. The PC was connected by a Ethernet link to a power supply mainframe 18, and via a CAN bus to a ELMB module to read the gas parameters and gap currents. Figure 7 shows a schematic view of the system. Some key characteristics are given in Table 2.

Footnote 18: System 1527, CAEN, Viareggio, Italy.

Twelve high voltage supplies were used to power 48 RPC gaps via 1:4 splitter boxes. Data was reported on a set of PVSS panels and was stored in a MySQL relational database organized as a Conditions Database. This database was structured with folders and tables for each subsystem associating an interval of validity to each detector parameter.

#### 1.6.3 The TGC control system

The TGC control system [23], shown in Figure 8, was based on a single Local Control Station (LCS), i.e. a PC running a custom control application, based in turn on the PVSS

Figure 7: Schematic view of the RPC Detector Control System

II software. This PC was connected via a CAN bus to two ELMB modules, plugged on on-detector boards (DCS-PS boards) providing support to the on-chamber and front-end electronics. A special ELMB software, specific of the TGC detector, has been developed, extending the software provided by the central ATLAS DCS group.

In the TGC control system, DCS-PS boards perform most of the DCS control work. They are plugged as mezzanine boards on the trigger electronics boards, called Patch panel and Slave (PS) boards, and interface the ELMB to the PS boards. During the test, the system controlled and monitored the following parameters on the trigger electronics boards and the TGC chambers:

* low voltage lines on the PS boards;
* temperature sensors placed on the detectors;
* the charge spectrum of seven analog wire groups, one channel per chamber;

\begin{table}
\begin{tabular}{|l|c|c|c|} \hline Item & Number & Solution & Connection \\ \hline RPC detectors & 6 & — & — \\ Gas flow rate & 3 & ELMB & CAN-Open \\ Gas pressure & 1 & ELMB & CAN-Open \\ Gap current & 48 & ELMB & CAN-Open \\ High voltage & 12 & CAEN 1527 & Ethernet \\ Low voltage & 6 & CAEN 1527 & Ethernet \\ \hline \end{tabular}
\end{table}
Table 2: DCS-controlled RPC parameters.

Figure 8: Schematic view of the TGC Detector Control System.

* the Amplifier-Shaper-Discriminator threshold voltages;
* the on-chamber ASICs, including the configuration settings;
* voltage and current for seven high voltage channels, one channel per chamber.

A power supply mainframe19, controlled by the PVSS-II application on the PC, provided high voltage to the TGC chambers.

Footnote 19: System 1527, CAEN, Viareggio, Italy.

The LCS communicated via a local area network with the data acquisition program running on the Single Board Computer20 hosted in the ROD crate, using the standard ATLAS DDC (DAQ-DCS Communications) program. It received commands from the data acquisition program to configure the front-end electronics according to parameters contained in a configuration file. At the end of each run, running condition data were stored in a MySQL relational database.

Footnote 20: Type VP110, Concurrent Technologies, Essex, UK.

## 2 Performance studies of the MDT chambers

The MDT chambers are built from multi-layers of thin wall (0.4 mm) aluminum drift tubes. Each tube has a diameter of 30 mm and the wire has 50 \(\mu\)m diameter. The drift tubes are operated at a pressure of 3 bar with a 93%Ar-7%CO\({}_{2}\) gas mixture. Each multilayer consists of three or four staggered tube layers. Typical operating high voltage is 3080 V, corresponding to a gas gain of about \(2\times 10^{4}\). Given the non-uniform electric field, the drift velocity ranges from 20 to 100 \(\mu\)m/ns. An important component of the MDTs is the tube end-plug that ensures, with a precisely machined reference surface, the positioning of the wire with the required accuracy. More details on the MDT chamber design and construction can be found in reference [1, 3].

In order to meet the physics requirements, several criteria must be fulfilled by the MDT detector. The mechanical assembly of the drift tubes in a single chamber must ensure a positioning of the wires with respect of a local reference system with an accuracy of 20 \(\mu\)m; this is achieved with monitored, highly precise assembly procedures, and is certified with a dedicated X-ray tomography facility [27]. The relation between the measured drift time and the corresponding drift radius must be known with a 20 \(\mu\)m accuracy; an iterative auto-calibration procedure [28] based on straight segment fits in a constrained multi-layer geometry has been shown to fulfill this requirement [29]. The average single-tube resolution must be better than 100 \(\mu\)m, which translates into a sagitta resolution of about 50 \(\mu\)m. The relative position of the chambers belonging to the same projective tower must be determined with an accuracy better than 40 \(\mu\)m over distances up to 15 m; requiring the alignment system described in the previous sections.

The basic design of the read-out of the chambers is as follows: groups of 24 tubes are connected to a single "hedgehog" card. This card capacitively decouples the signals from the tubes and feeds them to a "mezzanine" board, which is connected to the hedgehog card and contains the amplifiers, shapers, discriminators, and TDCs for encoding the signals of the 24 tubes connected to the hedgehog card. During the 2003 test, all MDT chambers were equipped with final electronics, with the exception of the Chamber Service Modules (CSM) [10]. These modules were prototypes, similar to the final ones.

2.1. _Electronics performance_

During the 2003 H8, individual channel performance, cross talk and noise effects have been investigated. The drift tubes are instrumented with Amplifier-Shaper-Discriminator circuits (ASD) [30] and a ATLAS Muon TDC (AMT) [31] mounted on the mezzanine on one tube end, while the other end is terminated with the tube characteristic impedance of 380 \(\Omega\). The preamplifier input impedance is relatively low (120 Ohm) in order to maximize the collected charge. The shaper has a peaking time of 15 ns. For a gas gain of \(2\times 10^{4}\) the response function of the ASD is \(\sim\)3 mV per primary electron, the nominal discriminator threshold is 44 mV corresponding to about 20 primary electrons, or to \(\sim\)5 times the r.m.s. noise.

The digital part of the front-end electronics is clocked at the bunch crossing frequency of the LHC, 40 MHz. The AMT has a 5-bit interpolator with a least significant count of 25 ns/32 = 781.25 ps and a r.m.s. resolution of 250 ps. The time window for encoding the signals is programmable within a time range of 17 bits; for the tests described here it was set to 1.6 \(\mu\)s. After shaping, the signal is converted with a logarithmic amplifier and sent to an 8-bit ADC that measures the charge in a 20 ns gate following the threshold crossing time. The charge is converted into a pulse width using the Wilkinson technique and encoded by the AMT. This information allows for improving the time resolution by applying a time-slewing correction. Since the 40 MHz clock is asynchronous with respect to the beam trigger, an additional mezzanine board was used to encode the trigger time in such a way that all drift times were corrected off-line and properly referred to the trigger.

The AMT data are read out via a serial link by a CSM [10], which buffers and multiplexes them into a single output path that is also buffered, awaiting transmission to the MDT Read-Out Driver (MROD) [11]. In total, more than 3700 channels were read out with this scheme. Single tube performance studies were based on the hit counting rate, taking into account the corresponding TDC and ADC information. A detailed survey of a large set of data for all the chambers of the setup, spanning the entire 2003 data-taking period, was performed. 99% of the 1920 end-cap channels and 1800 barrel channels behaved as expected. The few non-functioning channels were due to known problems, and were usually traced back to defects of the hedgehog cards.

For a quick estimate of the noise level, an analysis of the raw drift time distributions was done. This approach is suitable for on-line monitoring of noisy channels. The physical time spectrum is limited to the interval \([t_{0},t_{max}]\), where \(t_{0}\) is the drift time of a track crossing the wire and \(t_{max}\) the drift time of a track at maximum distance from the wire (see Figure 9).

In contrast, noise hits are uniformly distributed over the TDC range. An estimate of the noise rate can therefore be obtained from the number \(n_{noise}\) of out-of-time hits, i.e. hits with drift times smaller than \(t_{0}\) or larger than \(t_{max}\) in a sample of \(n_{sample}\) events. The hits are counted in a given time interval \(\Delta t\) before \(t_{0}\) or after \(t_{max}\) and the noise rate is computed as:

\[f_{noise}=\frac{n_{noise}}{n_{sample}\Delta t}\]

The number of hits was estimated by fitting the two edges of the time distribution with step functions convoluted with Gaussian smearing, plus a flat background. The two regions usually give very similar noise rates. Noise rates in excess of a few kHz were related to bad ground connections of the mezzanine boards, and were promptly repaired during the first period of data-taking.

From the results obtained for all layers of the six barrel MDT chambers, two main features can be noticed:

* the noise changes little from one data taking period to another, apart of few layers exhibiting a large amount of out-of-time hits for a few particular runs;
* the noise is higher for strongly illuminated tubes, ranging from 0.5 to 1 kHz, while it is at a lower level for random trigger runs, typically a few hundred Hz.

To investigate the different contributions to out-of-time hits in the raw time distribution, and in particular to estimate the cross-talk between different channels, correlations were studied between drift times of neighbouring tubes. The fraction of events in which, for a valid drift time in a given reference tube, a hit was found in a nearby tube of the same layer is \(\approx\) 8-9%. The majority of such hits is caused by genuine muon tracks crossing two adjacent tubes, such that the measured time is close to \(t_{max}\) in both tubes. From correlations between non-adjacent tubes, \(\approx\) 2% of correlated spurious hits remain. To understand the source of this noise, the same multilayer is searched for "off-time tracks", i.e. aligned doublets or triplets of tubes. Aligned off-time hits are due to real muons producing a signal in the trigger time window, in addition to the track causing the trigger. Taking into account such off-time tracks, the cross-talk between adjacent tubes is well below 1%.

In conclusion, the MDT cross-talk, defined as the probability of observing a cross-talk

Figure 9: TDC spectrum for a set of drift tubes of multilayer 2, chamber BML 2. The fit to a double Fermi-Dirac function (see section 2.2) is superimposed.

pair per event, is about 0.03%. It has been observed only between channels connected to the same mezzanine board, is highest for adjacent tubes and decreases for more distant tubes. The cross-talk does not depend on the chamber occupancy, i.e. the probability of observing a cross-talk pair does not depend on the total number of hits.

Additional information on the noise can be obtained by looking at the charge measured by the Wilkinson ADC. A typical distribution of the charge sampled by the ADC is shown in Figure 10. For genuine electronics noise, the ADC should not measure a charge above the pedestal value. Once requiring a charge below a given cut, the measured noise rate is at the level of a few hundred Hz, compatible with what is observed with a random trigger.

### Stability of drift parameters

In order to study the stability with time of the MDT drift properties, data were collected for more than one month at constant gas mixture and flow rate (of \(\sim\)1/2 volume exchange per day). The temperature variations during this period were monitored as explained in section 1.6.1.

The drift properties of the chambers were described by means of the maximum drift time variable, defined as \(t_{drift}=t_{max}-t_{0}\). Variations in the composition of the gas mixture, temperature or pressure are promptly reflected by changes of \(t_{drift}\). In this study, an offline correction was applied to account for temperature variations, according to the functional form \(\Delta t_{drift}/\Delta T=-2.4\) ns/K [29].

A typical TDC time spectrum is shown in Figure 9. The parameters \(t_{0}\) and \(t_{max}\) are determined by fitting the time distribution with an empirical functional form, consisting of a double Fermi-Dirac function, a constant term to account for noise and an exponential to reproduce the effect of variation of the drift velocity

\[\frac{dn}{dt}=P_{1}+\frac{P_{2}\ [1+P_{3}\ e^{(P_{5}-t)/P_{4}}]}{[1+e^{(P_{5}-t)/ P_{7}}]\ [1+e^{(t-P_{6})/P_{8}}]},\]

Figure 10: ADC spectrum for a set of drift tubes of multilayer 2, chamber BML 2

where \(P_{5}=t_{0}\) and \(P_{6}=t_{max}\). This function reproduces very well the rising and falling edge of the spectrum, allowing the determination of \(t_{0}\) and \(t_{max}\) with a precision of about 0.2 ns and 1 ns, respectively, for the typical statistics collected in a run. Variations of the chamber operating conditions can lead to an additional uncertainty, giving a spread of the drift times up to 2 ns, even for runs taken during the same day.

The maximum drift time for the six barrel chambers has been studied as a function of the data taking period. Within an uncertainty of about 0.04 ns/day, no long-term variation of the chamber response is observed. In addition, the response is uniform from chamber to chamber within \(\pm\)2 ns. Similar results were obtained for the end-cap chambers.

Using the RPC information, the maximum drift time as a function of the second coordinate has also been studied. In fact, impurities in the gas mixture could cause a non-uniform response along the drift tube. A region of about 1 m along the tube has been studied. Within the statistical uncertainty, no dependence along the tube was found.

Most of the MDT chambers were equipped with a parallel gas distribution, some with a partially serial distribution, with three drift tubes supplied in series. For the latter, the behavior of \(t_{drift}\) was also studied as a function of the tube position along the gas series. It has been observed to increase along the series by 2 to 4 ns, depending on the chamber volume. This effect was explained by water vapor entering from the tube end-plug (EP) and accumulating in the gas mixture, due to the permeability of the end-plug material21. From the observed difference of drift time it was estimated that the water flux per EP is about 0.0002 bar liters/day, in agreement with an estimate based on the properties of the material. The impact of this effect on the single tube resolution was evaluated using the GARFIELD [32] simulation program and found to be negligible for the gas-flow foreseen for the data taking (one volume exchange per day). A detailed study of long term stability and uniformity of the barrel chambers is reported in reference [33].

Footnote 21: The end-plugs were manufactured with Noryl type GFN3 by NIEF Plastic, Genas, France, and Savoy decolletage, Cluses, France.

### Single tube resolution

The spatial resolution of single drift tubes was determined by reconstructing straight muon tracks. In a six-layer MDT chamber, tracks are reconstructed with five out of six hits and the drift radius \(r_{drift}\) of the hit left out is then compared with the distance \(r_{track}\) of the reconstructed track from the wire. The variance of the \(r_{drift}-r_{track}\) distribution is the quadratic sum of the single-tube resolution, \(\sigma(r_{drift})\), and the accuracy \(\sigma_{track}(r_{track})\) of the track fit. As \(\sigma_{track}(r_{track})\) is a known function of the single tube resolution, \(\sigma(r_{drift})\) can be extracted from the standard deviation of the \(r_{drift}-r_{track}\) distribution.

Figure 11 shows the single tube resolution of a six-layer MDT chamber as function of the track impact parameter, \(r\). The same resolution function is obtained with an eight-layer chamber. Close to the wire, the resolution is dominated by the fluctuation of size and position of the primary ionization clusters and is about 200 \(\mu\)m. At larger radii, where diffusion plays the dominant role, the spatial resolution improves to \(\sim\)60 \(\mu\)m.

The information on the charge sampled by the ADC can be used to correct for the time slewing of the discriminator. These time-slewing corrections improve the single-tube resolution by 25 to 30 \(\mu\)m for small impact radii and by 5 \(\mu\)m at large radii. The spatial resolution obtained with time-walk corrections is indicated by the stars in Figure 11. In this case, the average spatial resolution of a drift tube is 90 \(\mu\)m which will guarantee the expected momentum resolution of the ATLAS muon spectrometer.

### Track segment efficiency

An important figure of merit of the MDT chambers is the track segment finding efficiency. After pattern recognition, the tracking program reconstructs track segments in each muon station. Track segments are then combined to form the muon trajectory and measure the muon momentum. A track segment is reconstructed from a straight line fit to the MDT hits in the plane orthogonal to the wire direction. To determine the track segment efficiency, we used the information of the RPC strips, in a sample of events selected by the hodoscope trigger, to ensure that a track was traversing the active region of an MDT chamber. A segment was reconstructed in the two RPCs close to the BML station by requiring a pair of hits in the two coordinates: \(x\) (horizontal), measured by the MDT, and \(y\) (vertical). The third coordinate, parallel to the beam axis, was given by the position of the RPC strip plane. With these two three-dimensional RPC hits a track segment was reconstructed and a fiducial region far from the transition between two adjacent MDTs was selected.

The efficiency is defined as the ratio between events with at least one reconstructed MDT track segment and the number of RPC segments reconstructed in this fiducial region. The track segments were reconstructed with the MOORE [34] reconstruction program; different parameters can be chosen to define a track segment: minimum number of hits, maximum value of chi-square, maximum distance of a hit from the expected track, called \(\delta\)-ray cut. Table 3 shows the results for the two most illuminated barrel chambers (one BIL and one BML) requiring a \(\delta\)-ray cut of 0.8 mm. The comparison with

Figure 11: Spatial resolution of a drift tube as a function of the muon impact parameter \(r\). The points with errors show the resolution obtained without time-slewing corrections; the stars indicate the resolution function after time-slewing corrections.

the efficiency obtained with the same cuts using the Geant4 simulation program [35] shows good agreement between data and simulation. When at least 5 associated hits are required, the six-layer BML chamber has an efficiency lower than the eight-layer BIL chamber. This can be explained by the number of combinations assuming that the probability to produce in a tube a secondary not passing the \(\delta\)-ray cut is of about 5%.

## 3 Test of the barrel alignment system

There are two strategies for making use of the data provided by a spectrometer alignment system. The "absolute" concept requires the alignment system to provide sagitta corrections at any time without using any external references. The other concept, called "relative", assumes that at one moment the sagitta corrections were known (e.g. the chambers of one tower were aligned with straight muon tracks and the magnetic field off), the alignment system measuring variations of the sagitta corrections from this time on. The advantage of the latter strategy is that all the errors on sensor positioning and many errors on sensor calibration parameters cancel in first order. Since in 2003 some sensors were not calibrated, only tests of the relative concept were performed.

### Analysis software

A geometry reconstruction software is needed to reconstruct the positions and orientations of chambers and reference plates from the measurements of optical and temperature sensors. Chambers are aligned comparing the values measured by sensors to those expected for a set of chamber and reference plate positions and orientations, and by minimizing the difference (defined as a \(\chi^{2}\) in the usual way) varying these assumed sets of numbers in an iterative way. A detailed description of the locations of alignment sensors, including the calibration constants obtained during production, is one of the inputs to the geometry reconstruction software.

The data to be analyzed (optical and temperature measurements) are read from the conditions database. The geometry reconstruction software reads this information, calculates the difference between the nominal and actual detector geometry and writes it back to the conditions database. After that, the alignment corrections can be used by the detector geometry model and by the track reconstruction algorithms.

For the barrel system, the Atlas Spectrometer Alignment Program (ASAP), based on the ROOT package [14] and developed at DAPNIA-Saclay, was used, which also implements the reconstruction of MDT chamber deformations. The general 3D viewer of ROOT was used to display and debug the detector description.

\begin{table}
\begin{tabular}{|l|c c|c c|} \hline  & BIL \(\geq\)4 hits & BML \(\geq\)4 hits & BIL \(\geq\)5 hits & BML \(\geq\)5 hits \\ \hline Hodoscope run & 99.8 \(\pm\) 0.1 & 99.4 \(\pm\) 0.2 & 99.5 \(\pm\) 0.3 & 96.8 \(\pm\) 0.3 \\ Geant4 simulation & 99.9 \(\pm\) 0.1 & 99.7 \(\pm\) 0.1 & 99.9 \(\pm\) 0.1 & 96.2 \(\pm\) 0.3 \\ \hline \end{tabular}
\end{table}
Table 3: Track segment efficiency, in %, for the BIL (eight-layer) and the BML (six-layer) chamber requiring at least 4 (left) or at least 5 (right) associated hits.

### Results with straight muon tracks

In order to test the relative alignment method, the geometry setup has been modified, physically displacing the MDT chambers. After this, muon tracks have been reconstructed using the geometry from the alignment sensor measurements. The muon sagittae were expected to be constant for all displacements within the expected relative accuracy of the alignment system of about 30 \(\mu\)m.

Several chamber movements were performed during the data taking period. Most of them were movements of the BIL2 and BML2 chambers; a short summary is given in Table 4. For certain runs the beam was steered with a beam magnet (see Section 1.1) to illuminate different tubes and to produce different muon incidence angles on the barrel chambers. A run is defined as a time interval where chamber positions and deformations do not vary by more than 20 \(\mu\)m relative to each other. The geometry was reconstructed using the ASAP software; the input data for ASAP were computed using the average values of the sensor measurements over the duration of the run. When the run was shorter than one acquisition cycle of typically two minutes, data from neighboring runs were used.

The reconstructed geometry was fed into the muon reconstruction software Muon-Boy [36]. The residual sagittae after muon reconstruction are shown in Figure 12. For the four chamber movements studied here, the sagitta residuals have a dispersion around 20 \(\mu\)m in relative mode. The non-zero offset is due to the precision of the initial survey in determining the absolute MDT positions.

## 4 Test of the end-cap alignment system

### Analysis software

For the end-cap alignment, the program ARAMyS (Alignment Reconstruction and Simulation for the ATLAS Myon Spectrometer) [37] was used to reconstruct the spectrometer geometry from the alignment sensor measurements. It implements the reconstruction of both MDT chambers and alignment bar deformations. The alignment reconstruction is similar to the ASAP program, the main difference being that ARAMyS

\begin{table}
\begin{tabular}{|l|l l l l|l l|} \hline Date & BIL2 & BIL2 & BIL2 & BIL2 & BML2 & BML2 \\  & \(Z[\text{mm}]\) & \(\Theta_{X}[\text{mrad}]\) & \(\Theta_{Y}[\text{mrad}]\) & \(\Theta_{Z}[\text{mrad}]\) & \(Z[\text{mm}]\) & \(\Theta_{Z}[\text{mrad}]\) \\ \hline Jul 19–21 & 0,+4 & \(-\)3,+3 & & & & \\ Aug 6–8 & 0,+5 & 0,+3 & 0,+3 & & & \\ Aug 11–12 & & & & & 0,+3 & 0,+2 \\ Aug 14–16 & 0,+5 & \(-\)3,+3 & 0.5 & & & \\ Sep 1–4 & 0,+4 & 0,+5 & \(-\)2,+3 & 0,+3 & 0,+5 & 0,+2 \\ \hline \end{tabular}
\end{table}
Table 4: Range of chamber movements performed during the data taking period, in the alignment reference system (the \(X\) axis points along the MDT tubes and \(Z\) along the mounting rails).

uses MINUIT for the \(\chi^{2}\) minimization, while ASAP relies on a proprietary method. The geometry reconstructed by ARAMyS can be interactively displayed in a dedicated viewer application based on OpenGL.

### Results with straight muon tracks

#### 4.2.1 Method

The quantitative comparison of the reconstructed track sagittae to the alignment system sagittae requires the reconstruction of the track segment in each of three chambers and, in parallel, the computation of chamber displacements based on the alignment system.

In this analysis the sagitta is defined as the distance of closest approach of the muon track segment in the middle chamber, EML2, to the straight line joining the first, EIL1, and the third chamber, EOL3. This definition is shown schematically in Figure 13. There are three relevant 2-dimensional points, called "superpoints", defined by the intersection of the track segment and the plane between the two multilayers. A superpoint specifies the location of the track segment along the longitudinal and transverse coordinates.

#### 4.2.2 Datasets

All data used in this analysis were taken with a 120 GeV/c muon beam. They were selected to establish to which extent the alignment system can provide geometrical corrections over time. The main goals are listed below.

Figure 12: Controlled movements of the barrel MDT chambers. The four plots show the reconstructed track sagittae after the alignment corrections from ASAP have been taken into account by the track reconstruction package MuonBoy. The last plot refers to a chamber movement performed in 2002.

* Determine how well smooth and continuous thermally induced shifts follow the alignment prediction, and quantify the temperature dependence of the sagitta. The data used for these measurements were a sequence of runs taken in July 2003 with the 10\(\times\)10 trigger.
* Measure the response of the alignment system to discrete, controlled chamber translations or rotations. The controlled movements of chambers were done in two phases. The first was a series of translations of EIL. The second phase was a series of translations of EML followed by a single run with a controlled rotation. The runs selected for this analysis were taken with the 10\(\times\)10 trigger in August 2003 and correspond to the same period of time analyzed with the muon simulator (see Section 4.3).
* Establish the dependence of the sagitta on the location of the track in a chamber. This is similar to the previous analysis with the important difference that this data set was taken with the hodoscope trigger: the tracks are not confined to a small region but are incident over a large area of the chambers.

The last point reveals the effects of small relative rotations of the chambers. Indeed, perfectly aligned chambers exhibit no sagitta dependence on the hit coordinate along the MDT wire. The chambers were installed with a tolerance of 2 mrad in the angle about the axis perpendicular to the chamber plane. This is also the expected limit of non-parallelism of the wires of the different chambers in the same projective tower in ATLAS. The MDT chambers provide the impact parameter along a single precision coordinate. To achieve

Figure 13: Graphical sketch of the sagitta definition. In this analysis the sagitta is defined as the distance between the superpoint in the EML2 chamber and the line joining the superpoints in EIL1 and EOL3.

full reconstruction of the space point, it is necessary to determine the track coordinate along the tube axis. The measurement of this second coordinate can be done using data from RPC chambers in the barrel stations.

#### 4.2.3 Results

Chamber movements induce a large change of the sagitta and allow for a validation of the optical alignment system over a large range. In a first phase, the inner station of the end-cap tower, EIL, was moved along the direction of the mounting rails, in steps of about 500 \(\mu\)m and 1 mm. For each position data were taken with both the 10\(\times\)10 trigger and the hodoscope trigger. The variation of the sagitta determined by the optical alignment system is plotted in Figure 14 (left); the error bars indicate the uncertainty of 14 \(\mu\)m expected for the accuracy of the alignment system. The squares show the sagitta as reconstructed by the MOORE tracking program. The errors on reconstructed sagitta is mainly statistical, depending on the number of processed events, and is about 2 \(\mu\)m; thus, it is negligible compared to the contribution of the alignment system. This result shows good agreement between tracking and alignment sagittae at the level of 14 \(\mu\)m.

In a second phase, the EML chamber was moved in many small steps along the rails and rotated around its vertical axis. The non-parallelism of the wires of different end-cap chambers (about 1 mrad) translates into a dependence of the sagitta on the track position along the second coordinate. This effect can be corrected by using the second-coordinate measurement provided by the trigger chambers as shown in Figure 14 (right). This correction, when performed over the full hodoscope height of 60 cm, introduces an additional error of 10 \(\mu\)m on the sagitta mean value.

A further, and more direct, check of the optical alignment system is to correctly position the chambers in the tracking program according to the prediction of the alignment system before performing the track reconstruction. Figure 15 shows the distribution of

Figure 14: Value of the sagitta as a function of time for three different EIL (left) and three different EML (right) chamber positions. Crosses indicate the sagitta computed by the alignment system, squares indicate the sagitta reconstructed by tracking without corrections and points the sagitta reconstructed by tracking with the second-coordinate correction applied.

the resulting sagitta for the three hodoscope runs, one for each chamber position, before and after applying the chamber alignment corrections. After corrections, the three distributions coincide within the estimated error of 14 \(\mu\)m. The offset of the sagitta mean value is due to the accuracy of the measurement of the original chamber positions, done with an optical survey.

The day-night temperature variations in the H8 hall, spanning up to 5\({}^{\circ}\)C, induced significant movements of the chambers. The resulting displacements, as determined by the tracking (using the 10\(\times\)10 trigger) and the alignment system over a 30 hour interval, are shown in Figure 16 together with the corresponding residuals. From this plot it can be derived that the alignment system can correct for these displacements within an accuracy of 20 \(\mu\)m. The temperature dependence of the end-cap sagitta was about 70 \(\mu\)m/K with a small hysteresis.

### Results with the muon simulator setup

Tests of the alignment system require a precise external reference. One possibility for implementing such an external reference (besides using muon tracks) is a so-called "muon simulator". This device consists of a camera with the optical axis pointing along the line corresponding to a hypothetical muon track, and of light sources positioned on the MDT chambers. The variations of the sagitta can be determined from the measurement of the relative movements of the light sources. As the mounting positions of camera and light sources are not known with high accuracy, this device does not provide an absolute reference and can only track variations of the alignment, i.e. be used to test the concept of relative alignment. It provides equally precise reference measurements in the precision coordinate and in the second coordinate (along the tubes); in this respect the muon simulator is superior to using muon tracks.

A muon simulator was present in the end-cap test stand during most of the beam time. Due to the presence of the barrel stand on the beam line, the camera could not be placed at the virtual ATLAS interaction point, but had to be shifted toward EIL by about 5 m. For simplicity it was decided to use BCAMs for the camera as well as for light sources; eight BCAM cameras were placed on a tripod, and the BCAM light sources were mounted on extension plates attached to the chambers, thus modeling a straight

Figure 15: Sagitta for three different positions of the EIL chamber before and after alignment corrections.

muon track that just missed the chambers by 10-20 cm. Of the eight cameras, five could be adjusted such that all light sources were visible to them. The intrinsic error of the sagitta measurement obtained from averaging over the results of the five cameras could be estimated from the data, and was about 10 \(\mu\)m.

For the tests presented here, alignment sensor measurements were recorded several times over periods of a few days, during which temperature-induced sagitta variations of up to 500 \(\mu\)m were observed. They were complemented by artificial variations of up to 5 mm shifting and/or rotating the chambers and/or the alignment bars. The comparison of variations of the sagitta in the precision coordinate (approximately horizontal in the test stand) as reconstructed by the alignment system to those measured by the muon simulator results in a r.m.s. accuracy of 15 \(\mu\)m over a continuous period of 2.5 days. The total \(\chi^{2}\)/ndf of the alignment fit varied typically in an acceptable range of 0.9-1.5. The observed resolution of the alignment system of 10-20 \(\mu\)m agrees well with the expectation from simulations for the relative alignment. The same comparison in the second coordinate yields an r.m.s. accuracy of about 125 \(\mu\)m, safely below the required accuracy of 250 \(\mu\)m in this coordinate.

## 5 Performance studies of RPC chambers

The first-level muon trigger in the ATLAS barrel [38] is based on three layers of dedicated detectors, Resistive Plate Chambers (see Figure 17), concentric with the beam axis and arranged in projective towers ("trigger towers"), covering the pseudorapidity range \(|\eta|<\)1.05. A trigger tower is made of two stations (RPC1 and RPC2) located near the center of the barrel toroid on both sides of the Middle MDT station and a third station (RPC3) mounted on the Outer MDT station. The former stations provide the

Figure 16: Sagitta reconstructed by the alignment system (small points) and by the tracking program (large squares) as a function of time measured over 30 hours (left). Data were taken with the 10\(\times\)10 trigger.

input to the "low-\(p_{T}\)" trigger (\(p_{T}>\)6 GeV/c), the latter, making use of the full detector granularity, allows to improve the \(p_{T}\) threshold to \(\sim\)20 GeV/c, thus providing input to the "high-\(p_{T}\)" trigger. Figure 17 shows the lay-out of the RPC (for the barrel) and TGC (for the end-cap) detectors for the first-level muon trigger in a large sector of the muon spectrometer. The scheme of the "low-\(p_{T}\)" and "high-\(p_{T}\)" is also shown for either charge muons.

A trigger station is made of two detector layers. The basic RPC layer consists of a narrow (2 mm) gas gap formed by two 1.8 mm parallel resistive plates of plastic laminate. Each gas gap is read out by two orthogonal series of pick-up strips of about 3 cm pitch: the \(\eta\) strips parallel to the MDT wires provide the "bending" coordinate and the \(\phi\) strips, orthogonal to the wires, provide the second, "non-bending", coordinate.

In order to reduce the rate of accidental triggers, due to low-energy background particles, the trigger is made in both \(\eta\) and \(\phi\) projections for the low-\(p_{T}\) and the high-\(p_{T}\) trigger. In a first stage, the trigger algorithm processes separately and independently the information related to the two projections. A valid trigger is generated only if trigger conditions are satisfied for both projections.

The trigger algorithm is steered by signals on the _pivot plane_, RPC2. When a hit is found on the RPC2, the low-\(p_{T}\) trigger logic searches for hits in the middle stations and requires a coincidence of three hits over four layers in a pre-calculated cone, whose center is defined by the line connecting the hit in the pivot plane to the interaction center. The width of this cone defines the \(p_{T}\) threshold and is programmable to allow

Figure 17: Schematic view of first-level muon trigger algorithm in a large sector of the muon spectrometer, both for barrel and end-cap (\(\eta\) view). The scheme of the ”low-\(p_{T}\)” and ”high-\(p_{T}\)” is also shown for either charge muons.

trigger flexibility. Three thresholds can be applied at the same time, providing event classification. The high-\(p_{T}\) trigger operates (only in presence of the low-\(p_{T}\) trigger) in a very similar way, requiring a coincidence with at least one hit in the outer layer. The \(\eta\) and \(\phi\) trigger information is combined to generate a Region-of-Interest (RoI) identifying the detector area containing the track candidate with a granularity of \(0.1\times 0.1\) in \(\eta\)-\(\phi\).

The signals of the RPC strips are amplified, discriminated and digitally shaped by on-detector electronics. In the low-\(p_{T}\) trigger, for both \(\eta\) and \(\phi\) projections, the signals of the two detector doublets are sent to a Coincidence Matrix (CM) [39] board, that contains a CM chip. This chip performs most of the functions needed for the trigger algorithm and for the read-out of the strips. It aligns the input signals in time, performs the coincidence and majority operations, and makes a \(p_{T}\) cut on three different thresholds, as described above. The CM board produces an output pattern containing the low-\(p_{T}\) trigger results and the list of hit strips for each pair of RPC doublets in the \(\eta\) or \(\phi\) projection. The information of two adjacent CM boards in the \(\eta\) projection, and the corresponding information of the two CM boards in the \(\phi\) projection, are combined together in the low-\(p_{T}\) Pad Logic (PAD) board. The low-\(p_{T}\) PAD board generates the low-\(p_{T}\) trigger and the associated RoI information.

This information is transferred, synchronously at 40 MHz, to the corresponding high-\(p_{T}\) PAD board, that collects the overall result for low-\(p_{T}\) and high-\(p_{T}\). In the high-\(p_{T}\) trigger, for each of the \(\eta\) and \(\phi\) projections, the signals from the outer doublet and the corresponding pattern result of the low-\(p_{T}\) trigger are sent to a second CM board. The high-\(p_{T}\) CM board produces an output pattern containing the high-\(p_{T}\) trigger result for a given RPC doublet in the \(\eta\) or \(\phi\) projection. The information of two adjacent CM boards in the \(\eta\) projection and in the \(\phi\) projection are combined in the high-\(p_{T}\) PAD board. The high-\(p_{T}\) PAD board combines the low-\(p_{T}\) and high-\(p_{T}\) trigger results and generates the high-\(p_{T}\) trigger.

### The RPC setup

In the beam line, two BML stations and one BOL station were equipped with four and two RPC doublets respectively. Only two PAD boards were used, one low \(p_{T}\) and one high \(p_{T}\), on a BML and a BOL station. Six dummy PAD boards were used to correctly terminate the front-end signals. Two CM boards, one \(\eta\) and one \(\phi\), were mounted on the low-\(p_{T}\) PAD box, two of them on the high-\(p_{T}\) one. The high-\(p_{T}\) PAD board was connected via an optical fiber to a data receiver board hosted in a VME crate. Data read-out was performed by a crate controller via the VME bus: the RPC Read-Out Driver (ROD) was emulated by the read-out software and data were sent to the common part of the DAQ system via an optical link [12]. The same VME crate housed a few TDC [40] used to confirm the strips read out. Data were taken during July and August 2003, both in stand-alone and in MDT-RPC combined mode, using the prototype data acquisition software. In September the first level trigger slice was tested in a so-called "25 ns run", when the SPS beam was bunched to simulate the LHC beam crossing period. During this run it was possible to test the proper synchronization of all signals produced by the front-end boards, both in stand-alone and in MDT-RPC combined mode. Detailed tests were performed on the Coincidence Matrix, proving its functionality in all possible configurations.

### The RPC performance

Data were analyzed with the track reconstruction program MOORE [34], working in the standard framework of the ATLAS software.

Using combined MDT-RPC run data, it was possible to reconstruct particle tracks and measure the detector and trigger efficiency. Figure 18 shows the beam profile obtained from trigger readout for a BOL chamber and the efficiency of RPC strips measured using tracks reconstructed from MDT data. For most strips the RPC shows efficiencies between 95 and 99%. The beam profile measured with the CM readout corresponds to the one measured with the TDCs.

The distribution of the number of strips that gave simultaneous signals, i.e. the size of the strip clusters, was measured in all gas gaps illuminated by the beam. A small cluster size is essential to reduce the probability of fake triggers. The clustering algorithm of the CM chip was tested using TDC data. Figure 19 shows the probability for a muon to

Figure 18: Number of hits (top) and RPC efficiency (bottom) as function of the strip number for 32 strips of one BOL RPC layer. The beam profile is measured both with the TDCs and the CM chip.

generate a cluster of a given size as a function of the impact point of the track on the RPC. It is observed that clusters of size larger than one occur mostly when the track crosses the RPC in the region close to strip boundaries. The average cluster size is 1.3.

The trigger efficiency of the low-\(p_{T}\) Coincidence Matrix was determined comparing the CM board output and the track position measured by the MDT extrapolated to the outer (pivot) RPC plane. The result is shown in Figure 20: the efficiency is close to one and uniform over the 24 input strips of one CM chip.

An important feature of the first-level trigger is the time resolution and, in particular, its efficiency in tagging the Bunch Crossing that originated the trigger track. The distribution of the difference between the time recorded by the CM chip and the strip TDC is shown in Figure 21-right. The CM chip uses a 3-bit time interpolator of the 40 MHz frequency (i.e. a 3.125 ns time bin) to measure the time of the strip signals. The r.m.s. width of the distribution, 1.9 ns, shows that the intrinsic time resolution of RPC and trigger logic matches the design figure. The efficiency of Bunch Crossing (BC) tagging was measured with the low-\(p_{T}\) trigger. The CM chip uses a programmable pipeline at its input to align the input signals in steps of 3.125 ns. Figure 21-left shows the fraction of events in time with the beam trigger when all input signals to the CM chip were delayed in steps of one bin in a 50 ns time range. The safe time window of 4 bins (\(\sim\)12 ns) matches the design value.

Figure 19: Impact point of the reconstructed muon track on a BOL RPC strip plane for different cluster size.

## 6 Performance studies of TGC chambers

### The TGC setup

Thin-gap proportional wire chambers (TGC) [6] are used to trigger on high \(p_{T}\) muons in the end-caps. They have trapezoidal shape, wires of different length are used to read

Figure 21: Left: Distribution of the difference between the time recorded by the CM chip (3.125 ns LSB) and by the strip TDC (1.015 ns LSB); the fit r.m.s. width is 1.9 ns. Right: efficiency of the low \(p_{T}\) trigger bunch counter as function of the signal delay; one time shift corresponds to 3.125 ns.

Figure 20: Efficiency of the low-\(p_{T}\) trigger (in the \(\eta\) projection) as function of the strip on the pivot BML plane hit by the extrapolated track reconstructed by the MDT chamberthe radial "bending" coordinate while the centroid of the charge induced on strips normal to the wire direction is used to get the azimuthal coordinate. The measurements at the H8 beam were focused on testing the functionality of trigger electronics. In particular, the "25 ns run" was very useful to check the properties of the first-level muon trigger in identifying the interaction bunch crossing.

Two TGC doublets and one triplet were installed in the beam line for a total of seven layers. Two types of chambers were used for the triplet and the doublets. The active volumes of the chambers had the same dimensions, with lateral widths of 130 cm and 150 cm, a height of 120 cm, and a thickness of 3 mm. The triplet (M1) was installed upstream of the end-cap MDT middle station (EML) and the two doublets (M2 and M3) downstream of it; the distance between M1 and M2 was 168 cm while the space between M2 and M3 was 14 cm. All TGC layers were parallel to the end-cap MDTs. For the wire readout, 24 channels per layer were used for the triplet M1 and 32 channels for the two doublets M2 and M3. For the strip readout, 32 channels per chamber were used for all layers except the middle plane of M1, where only wires are read out, as foreseen in the experiment. The wire and strip signals were amplified, shaped and discriminated with a custom designed ASD (Amplifier Shaper Discriminator) chip [41].

The TGC electronics is divided in four parts: two on-detector parts (the low-\(p_{T}\) and high-\(p_{T}\) coincidences for trigger, pipe-line and de-randomizer), one off-detector part (\(r\)-\(\phi\) coincidence and the ROD), and the Detector Control System (DCS). The technology of Application Specific Integrated Circuits (ASIC) has been employed for system implementation. In the front-end on-detector part, the Patch-panel and Slave (PS) board mounts two kinds of ASIC on a patch-panel (PP) and on a slave board (SLB). It also mounts two mezzanine boards: the first one is the on-detector DCS board linked to the ELMB, the second one receives the trigger, timing and control signals (TTC) [9] and fans them out to the relevant components of the on-detector electronics. The PP ASIC is used to adjust the signal delays at the sub-nanosecond level for bunch crossing identification. The SLB ASIC is used to make channel masks (for trigger and readout channels independently) using either wire or strip signals. This chip also has the ATLAS standard pipe-line buffer and the de-randomizer for the readout of the trigger result and of the hit map, and parallel to serial converters to send data to the readout.

The low \(p_{T}\) trigger (\(p_{T}>6\) GeV/c) is formed using signals from either the two doublets or the triplet. A high \(p_{T}\) trigger (\(p_{T}>20\) GeV/c) is obtained from combined processing of the low-\(p_{T}\) trigger information from these two sections. This is done by a third ASIC called Hi-\(p_{T}\), separately for the \(r\) and \(\phi\) projections. The Hi-\(p_{T}\) ASIC is mounted in the second on-detector part. Besides the high-\(p_{T}\) trigger logic, this second on-detector part has custom-made readout switching modules to connect several SLB ASICs to a ROD. This switching module is called Star Switch (SSW).

The off-detector electronics part comprises the \(r\)-\(\phi\) coincidence trigger logic and the ROD. A circuit in the trigger logic selects the number of the highest \(p_{T}\) muon candidates and sends the information to the muon central trigger interface (MuCTPI, see Section 7.1). This section of the trigger logic in the off-detector part is called the Sector Logic.

Tests of the connections between the on-detector and off-detector parts for both the trigger and the readout were successfully performed using test pulses in the laboratory [42], prior to the beam test. In the beam line, the DCS was used to control the chamber high and low voltage supply by a PVSS standard application, as described in Section 1.6.3. It was also used to set the ASD threshold.

### The TGC system performance

Two different triggers have been used to study TGC and trigger performance: the 10\(\times\)10 scintillator trigger and the level-1 trigger signal that is generated either by the RPC or the TGC system itself. The level-1 signals generated by the two muon trigger systems were fed to the MuCTPI which sorted the signals to build the final muon level-1 signal. The TTC [9] system numbers the Bunch Crossing (BCID) and the level-1 trigger (L1ID) identifiers and distributes them to each sub-detector over the TTC network. Beside the identifiers given by the TTC system, the SLB ASIC independently counted the triggers and made its own BCID and L1ID. A comparison between the IDs of the SLB and those given by the TTC was made in the on-line analysis. If a discrepancy was found, an error flag was set. The ID check was also done in the off-line analysis for the same event samples: no discrepancies were found, neither in the on-line check nor in the off-line analysis in a sample of \(\sim 10^{5}\) events.

For every trigger, readout data were fed into the trigger simulation program, which calculated the various TGC level-1 trigger expectation (for low-\(p_{T}\), high-\(p_{T}\) and \(r\)-\(\phi\) coincidences) from the input hit map [42]. The expectations were then compared with the trigger information from the SLB ASICs and the Sector Logic. This comparison was performed on-line by a dedicated monitoring program and no discrepancy was found.

The muon beam profile observed in the first and third layer of M1 with the 10\(\times\)10 trigger is shown in Figure 22. The distributions have a r.m.s. width of about 2.5 channels. The beam profiles of the other layers show a similar distribution with a slight shift of the peak positions due to the 15\({}^{\circ}\) angle of the TGC planes with respect to the beam axis.

After testing the basic functionality, the timing parameters controlled by the PP ASIC were adjusted. The two basic timing parameters are the delay value and the gate width. For each trigger, data from three contiguous bunches (previous, current and next) were recorded. The number of triggered events in every bunch varies with the delay value. The BCID efficiency was computed as the ratio of the number of events recorded in a bunch to the total number of events recorded. The efficiency calculated in this way is shown in Figure 23 as a function of the delay. For small delays more events are recorded in the data bank of the previous bunch while for longer delays more events are recorded in the next bunch; the optimal value corresponds to the peak position of the efficiency curve. A difference of 4 ns is observed for the optimum delay in M1 (11.7 ns) and M2 (15.6 ns) due to the 168 cm distance between M1 and M2. The gate width was also adjusted in order to maximize the number of events recorded in the data bank of the current bunch. A 30 ns optimal gate width was found for all chambers, giving a better efficiency than the bunch crossing interval of 25 ns.

With the optimized timing parameters a three-step trigger logic was set up: \(r\), \(\phi\) independent low-\(p_{T}\) and high-\(p_{T}\); \(r\)-\(\phi\) combined high \(p_{T}\). A low-\(p_{T}\) trigger was given by the trigger logic of an SLB ASIC using only the M1 triplet data or the two doublets data for \(r\) and \(\phi\) independently. The \(r\)-\(\phi\) combined high-\(p_{T}\) was given by the Sector Logic. The efficiencies measured for these triggers are summarized in Table 5.

The low-\(p_{T}\) trigger efficiency is higher than 97% for all chamber groups; the efficiency of the doublet for both wire and strip channels is systematically lower than the corresponding efficiency of the triplet. This is due to the choice of chamber types installed in the beam line where the M2 and M3 doublets have the same size as those in the M1 triplet. This implies that some dead regions of M2 and M3 overlap and that, even if the beam passes through the four gas volumes of the two doublets, signals may be produced only in two of them. In this case the low \(p_{T}\) trigger condition of 3-out-of-4 hits

\begin{table}
\begin{tabular}{|l c|} \hline \multicolumn{3}{|c|}{Trigger efficiency} \\ \hline Triplet Wire & 0.997 \(\pm\) 0.003 \\ Triplet Strip & 0.998 \(\pm\) 0.002 \\ Doublet Wire & 0.970 \(\pm\) 0.001 \\ Doublet Strip & 0.970 \(\pm\) 0.001 \\ \hline Sector Logic & 0.967 \(\pm\) 0.002 \\ \hline \end{tabular}
\end{table}
Table 5: Efficiency of the low-\(p_{T}\) trigger in the \(r\) (wire) and \(\phi\) (strip) projection and of the \(r\)-\(\phi\) combined high-\(p_{T}\) trigger (Sector Logic).

Figure 22: Beam profile measured in the first and third layer of the TGC M1 for data collected with the 10\(\times\)10 trigger; wires on the left, strips on the right.

will not be satisfied. Actually, a study of the chamber efficiencies showed that the first layer of each doublet had a lower efficiency (\(\sim\)95%) than the second layer (\(\sim\)99%). This effect can be explained by the fact that M2 and M3 do not overlap in about 3% of the region illuminated by the 10\(\times\)10 trigger. On the other hand, the efficiency of 99% for other layers suggests that the low-\(p_{T}\) trigger efficiency would have been as high as 99% if the beam line was not crossing the dead regions. The trigger efficiency measured by the Sector Logic is almost the same as in the doublets: this implies that the efficiency of the high-\(p_{T}\) is nearly 100% for both \(r\) and \(\phi\).

## 7 The first-level muon trigger processor

### The first-level trigger setup

The ATLAS first-level (LVL1) trigger decision is based on fast algorithms programmed in the Calorimeter Trigger Processor and in the Muon Trigger Processor. The logic processing of the output of these two systems to produce LVL1 triggers is done by the Central Trigger Processor (CTP). Signals from the muon trigger chambers are first sent to a Muon to Central Trigger Processor Interface (MuCTPI) before they are passed on to the CTP as input to the LVL1 decision. The MuCTPI receives trigger information from all muon trigger sectors synchronously with the 40 MHz LHC clock and computes the total multiplicity for each of six programmable \(p_{T}\) thresholds. It avoids double counting of single muons that may cross more than one trigger sector. For every LVL1 Accept (L1A) decision, the MuCTPI sends Region-of-Interest (RoI) information to the Level-2 trigger and event data to the DAQ system.

In the setup described here the full chain of trigger electronics was available for the sector muon triggers present in the beam test (as reported in previous Sections). The trigger signals from the sectors were connected to the prototype of the MuCTPI, which is fully functional, but only features two out of the 16 input boards needed for the full

Figure 23: Chamber efficiency as a function of the signal delay for the third layer of M1 and for the second layer of M2 and M3.

system. The two input boards allow for a maximum of 28 trigger sectors to be connected, sufficient for this tests. The MuCTPI prototype [43] delivers the muon candidate multiplicities to the central trigger logic; in the test beam the demonstrator module of the central trigger processor (CTPD) [44] was used. During the beam test the CTPD was configured such that any muon candidate in one of the six transverse momentum thresholds would lead to a L1A signal; no data readout was done with the CTPD.

The central trigger electronics was operated in two distinct modes. In the first mode, the first level trigger decision was not derived from the muon candidates themselves, but from the 10\(\times\)10 trigger. In this case external delays were used for the L1A signal delivered to the MuCTPI to allow the data to propagate through the trigger electronics before selecting them for readout in the pipeline buffers. The muon multiplicities were still delivered to the CTPD, and the timing of the L1A signal from the CTPD with respect to the L1A signal from the 10\(\times\)10 trigger was monitored. Each sub-system supplied a BUSY signal to inhibit the generation of L1As from the trigger in case the system was not ready to accept data. In the second mode, the L1A signal delivered by the CTPD was used to trigger the readout of the muon detectors and MuCTPI systems, and, in a separate test, the readout of the ATLAS silicon detector, which shared the same beam line. In this running mode the BUSY signals were delivered as a logical OR to the CTPD to inhibit L1A signals.

### Results of the level-1 trigger test

The MuCTPI system receives signals from the muon trigger chambers and provides multiplicities to the central trigger logic synchronous to the 40 MHz LHC clock. The phase of the trigger signals with respect to the common clock has to be adjusted to ensure the signal integrity. TDC chips near the respective inputs of the MuCTPI and the CTPD were used with programs developed in laboratory tests to adjust the signal phases and test the connections. The connection of the timing signals to the CTPD and MuCTPI was established using similar tools. All signal connections worked without problems during the beam period, demonstrating that the test facilities foreseen in both hardware and software are sufficient for integrating these systems into the ATLAS trigger.

An important aspect of the trigger system is the BUSY mechanism. Any system that cannot accept more data, because its output links are saturated or for other reasons, must assert a signal preventing the central trigger logic to issue further L1A signals until the BUSY is removed. A failure to do so would result in an incomplete event, with fragments missing from the sub-systems concerned. The readout system, which collects the various event fragments, notices an incomplete event and issues an error message after a timeout period. The MuCTPI exhibited no missing event fragments in running either with the scintillator trigger or the CTPD, demonstrating that the BUSY signal was correctly handled and propagated through the system. This test also included the handling of situations where the readout links of the MuCTPI itself were saturated and therefore issued a signal indicating that the link was unavailable. The MuCTPI has to react to this signal by stopping the readout in a controlled way, asserting the BUSY when the readout buffers are almost full, and resuming the readout without data loss once the links become available again. The MuCTPI was found to fully satisfy these requirements.

The data sent by the MuCTPI to the readout links with every L1A can be used to study the efficiency of the trigger system and the correct functioning of the electronics. When the trigger decision is made by the CTPD, each event should have at least one muon trigger candidate, as the TGC system provided the only input to the trigger decision in these tests. Events with no recorded muon trigger candidate would indicate a mismatch between the trigger path of the MuCTPI and the readout path. In many tens of thousands of events no such mismatch has been observed. In case the trigger decision is derived from the scintillator signals, the fraction of events without a muon trigger candidate is a measure for the inefficiency of the trigger system. To ensure that no additional inefficiencies were introduced by the operation of the central trigger electronics, the results derived from the MuCTPI recorded data were compared with the results obtained by the TGC system as described above. The values obtained for the trigger inefficiency were consistent between the two systems. In addition, the distribution of the muon candidates over the six possible thresholds in \(p_{T}\) and in terms of the geometrical position of the muon track in the TGC sector was studied and found to be in agreement between the two systems.

The latency of the first-level trigger was measured from the time of scintillator trigger (assuming each beam particle is at the center of the respective bunch) until the L1A signal was available at the detector front-end (FE) electronics. The FE electronic systems have to keep the event fragments in pipelines until the L1A arrives or until the maximum allowed latency of 2.5 \(\mu\)s expires. It is therefore crucial that the latency in the final system does not exceed this value. The first level trigger latency has been measured during the beam test for a complete trigger path consisting of one sector of the TGC system, the MuCTPI, and the CTPD. The signal delivered by the 10\(\times\)10 trigger was used as a reference, equivalent to the collision of protons in the LHC. These signals were compared to the L1A signals issued by the CTPD based on the muon trigger candidates sent from the TGC system via the MuCTPI.

To arrive at an estimate for the latency in the final system, several corrections had to be applied to this measurement. Firstly, the cable length will be different in the final system compared to the beam test. All relevant cables were measured and the corresponding propagation times were extrapolated to the expected length in the experiment. Secondly, the fully functional final design of the CTP will need about 2-3 bunch clock cycles (50-75 ns) more than the demonstrator module to get the trigger decision. Additional electronics needed to distribute the timing signals in the final system will introduce additional propagation delays of about 6 bunch clock cycles or 150 ns. Finally, time-of-flight differences from the collision or reference point to the muon chambers have to be considered, but were found to be small. The value obtained after applying these corrections for the latency is 2.1 \(\mu\)s. The estimated uncertainty, mainly from applying the extrapolation correction detailed above, is about 0.1 \(\mu\)s. The latency of this trigger path is therefore well inside the maximum allowed value of 2.5 \(\mu\)s.

## 8 Summary

In 2003 a large-scale system-test of the ATLAS muon detectors has been set up on the H8 beam line at the CERN Super-Proton-Synchrotron. We made a complete system-test of integration of three detector technologies, the Monitored Drift Tube tracking chambers and the trigger detectors, Resistive Plate Chambers for the Barrel, and ThinGap Chambers for the End Caps, with the Alignment System, the Detector Control System and the ATLAS Data Acquisition System.

A large setup of the MDT chambers operated with advanced prototypes of the front-end electronics has been run in stable conditions for several months. The performance, in terms of reliability, gas gain, drift properties, tracking efficiency and space resolution confirmed the results obtained with prototypes. Both the barrel and end-cap alignment systems have been tested on the real scale and proved to fulfill the ATLAS specifications in terms of relative alignment performance.The goal of attaining a precision of about 50 \(\mu\)m in the measurement of the track sagitta was met under the environment conditions of an open test beam setup.

A set of RPC and TGC trigger chambers equipped with the final front-end electronics has been operated in stable conditions together with their control devices. The logic circuits to form the first-level muon trigger have been tested and integrated with a prototype of the ATLAS level-1 trigger chain. The time resolution of the trigger response and the efficiency in identifying the interaction bunch crossing have been measured with a 25 ns bunched beam to simulate the operation at the LHC. The prototype of the ATLAS Level-1 muon trigger has been tested, both with a scintillator trigger and with the signals provided by the trigger chambers, up to the Muon to Central Trigger Processor Interface and the Central Trigger Processor Demonstrator. The results of the full trigger chain test show that the latency of the first-level muon trigger is well below the limit of 2.5 \(\mu\)s for operation in the experiment.

Besides the goal of running together the many hardware components of the muon spectrometer, and thus bringing together the many detector builders and experts, this beam system-test was also the occasion to test the software tools for the DCS, the alignment devices, the data acquisition, the on-line monitor, the data-bases and the off-line analysis, working in the general framework of the ATLAS software.

## Acknowledgments

We thank the CERN-SPS team for the efficient and smooth operation of the beam line and our friends of the ATLAS Collaboration who participated in the organization of the beam test. We express our gratitude to W. Andreazza for his continuous help during the installation and maintenance of the detectors and services. The effort of assembling together the many components of the system was made possible thanks to the dedication and skill of the technical staff of our Institutions and we are grateful for their excellent work.

**Note**: Refereed ATLAS notes are public in the web site

[http://cdsweb.cern.ch/collection/ATLAS](http://cdsweb.cern.ch/collection/ATLAS)

## References

* [1] The ATLAS Muon Spectrometer Technical Design Report, CERN-LHCC/97-22, 31.5.1997, ISBN 92-9083-108-1.
* [2] S. Palestini, Nucl. Phys. B(Proc.Suppl.) 125 (2003) 337