# Optimization of Repetition Parameters

For ABCD3T Chip Analog Tests

C. Flacco, A. Ciocio, V. Fadeyev

Lawrence Berkeley National Laboratory, Berkeley, California, 94720, USA

November 6, 2021

[MISSING_PAGE_FAIL:2]

## 1 Introduction

To measure the parameters of gain, offset, noise, and trim slope of the ABCD3T chips used in the ATLAS SCT detector, we use the method of threshold scanning [1]. Each threshold scan produces an s-curve (Figure 1) with a transition width, \(\sigma\), that characterizes the noise in the system. The mid-point of this transition is referred to as the 50% point. By scanning at different charge-injection points, we generate a response curve (Figure 2) for each channel of the chip. In this way we use the measured 50% points to extract the gain and offset. This method is necessitated by the use of binary readout in the ABCD chip design [2].

Currently, we trigger 500 events (\(N_{\it evts}=500\)) with \(N=60\) equal threshold voltage steps between \(V_{LO}=50\)mV and \(V_{HI}=500\)mV (\(\Delta V=7.5\)mV) to generate occupancy histograms for the ABCD3T chips. We scan at \(n\) different pulse amplitudes. The current default value of \(n\) is four. We would like to understand how the statistical uncertainties in noise, gain, offset depend on these three repetition parameters. We also use threshold scanning to extract the trim slope of each channel [1], and will apply the present analysis to this quantity also.

Figure 1: Illustration of an s-curve from a threshold scan occupancy histogram.

Figure 2: Illustration of a response curve. Fifty-percent point is plotted as a function of trigger pulse height. The gain and offset of the channel are the slope and intercept, respectively, of the best-fit line for the response curve.

Precision in Noise

The optimal values of the repetition parameters are constrained by the requisite level of uncertainty in the noise, \(\sigma\). The transition we are measuring has the shape of a scaled complementary error function, _erfc()_. We require an equation for the statistical error of this distribution. Our experimental constraints force us to consider only binned data, so the relation must also account for smearing effects.

We obtain such a relation using the Monte Carlo technique. This has two primary advantages: first, it allows us to study the smearing effects mentioned above; second, it permits us to understand and quantify the situation \(\sigma/\Delta V<<1\). The latter is important here because the current default values approach this regime. The function \(\delta\sigma(\sigma,N_{evts},\Delta V)\) in the standard regime obtained from this study is given here. For a description of the Monte Carlo study, see Appendix A.

We find the following relation for the usual case of \(\sigma/\Delta V>>1\):

\[\delta\sigma\Big{(}\sigma,N_{evts},\Delta V\Big{)}=\sqrt{\frac{\sigma*\Delta V }{\big{(}N_{evts}-1\big{)}}}\]

We can also express this in terms of the number of voltage steps, \(N\):

\[\delta\sigma=\sqrt{\frac{\sigma\big{(}V_{HI}-V_{LO}\big{)}}{N\big{(}N_{evts}-1 \big{)}}}\]

By imposing a bound,\(f_{\sigma}\) on fractional error in the measured values of noise, \(\sigma\), we obtain the minimum condition

\[N(N_{evts}-1)=\frac{V_{HI}-V_{LO}}{\sigma*f_{\sigma}^{2}}\]

## 3 Precision in Gain and Offset

The optimization must also consider constraints from the precision in gain and offset. The relationship between the gain, offset and 50% point is

\[(50\%\ pt)=(Gain)*Q_{inj}+(Offset)\]

The parameter \(N_{evts}\) enters the uncertainties in gain and offset through the uncertainty in the 50% point of the occupancy histogram. Specifically, the uncertainty in the 50% point has the following dependence on \(N_{evts}\)[3]:

\[\delta\Big{(}50\%\ pt\Big{)}=\sigma\sqrt{\frac{r}{N_{evts}\sqrt{\pi}}+\mu^{2 }\big{(}r\big{)}}\]

Here, \(\sigma\) is the width of the transition in the s-curve. If we define \(\Delta V=(V_{HI}-V_{LO})/N\), the parameter \(r\) is defined as \(\Delta V/\sigma\), and \(\mu(r)\) is a documented function with values \(0<\mu<0.004\) for 

[MISSING_PAGE_FAIL:5]

[MISSING_PAGE_EMPTY:6]

intercept in this fit, we do not need the level of precision here that we need for the previous calculation.

\[\delta\big{(}\mathit{Trim\_Slope}\big{)}=\sqrt{\frac{\Delta V\sigma}{N_{\mathit{ evts}}\sqrt{\pi}\,*\sum_{i=1}^{n}\big{(}\mathit{Trim\_Slope}\big{)}^{ \prime 2}}}\]

The minimum condition for the trim slope is

\[N_{\mathit{evts}}N*\sum_{i=1}^{n}\big{(}\mathit{Trim}\big{)}^{\prime}{}_{i}{}^ {2}=\frac{\sigma\big{(}V_{\mathit{H}}-V_{\mathit{LO}}\big{)}}{\sqrt{\pi}\,{f_{ \mathit{TS}}}^{2}\big{(}\mathit{Trim\_Slope}\big{)}^{2}}\]

## 5 Analysis of Two Special Cases

There are a couple of interesting special cases to consider which lead to additional inequalities that we may use to optimize our choice of scan points.

The case in which the same precision is needed on all quantities provides a guideline for choosing charge injection scan points. Since we must use sufficient statistics for the above methods to be sound anyway, we consider the approximation \(\big{(}N_{\mathit{evts}}-1\big{)}\approx N_{\mathit{evts}}\). In this case, we combine the constraints from gain offset and noise. In the case \(f_{G}=f_{\mathit{off}}\) the offset is the constraining parameter. If we now substitute the bound provided by the noise, we are left with a minimum condition in the quantities of the scan points:

\[\left(\frac{<Q_{\mathit{inj}}>^{2}}{\sum_{i=1}^{n}\big{(}Q_{\mathit{inj}} \big{)}_{i}{}^{2}}+\frac{1}{n}\right)=\frac{\big{(}\mathit{Offset}\big{)}^{2} \big{(}V_{\mathit{H}}-V_{\mathit{LO}}\big{)}}{\sigma}\]

In the second case, we consider a constraint on the trim scan points. With the restriction that Nevts and N are fixed by other considerations, the condition from the trim slope precision can be manipulated to emphasize the scan points:

\[\sum_{i=1}^{n}\big{(}\mathit{Trim}\big{)}^{\prime}{}_{i}{}^{2}=\frac{\sigma \big{(}V_{\mathit{H}}-V_{\mathit{LO}}\big{)}}{\sqrt{\pi}N_{\mathit{evts}}N*f^{ \,2}\big{(}\mathit{Trim\_Slope}\big{)}^{2}}\]

## 6 Conclusions

We have established the dependence of the precision of the measured values of noise, gain, offset, and trim slope on the repetition parameters \(N_{\mathit{evts}}\), \(N\) and \(n\), defined above, using analytic and Monte Carlo techniques. We conclude the following:

\[\delta\sigma=\sqrt{\frac{\sigma\big{(}V_{\mathit{H}}-V_{\mathit{LO}}\big{)} }{N\big{(}N_{\mathit{evts}}-1\big{)}}}\]\[\delta\big{(}Gain\big{)}=\sqrt{\frac{\Delta V\sigma}{N_{\textit{evts}}\sqrt{\pi}* \sum_{i=1}^{n}\big{(}Q_{\textit{inj}}\big{)}^{\prime 2}}}\]

\[\delta\big{(}Offset\big{)}=\sqrt{<Q_{\textit{inj}}>^{2}\delta\big{(}Gain\big{)}^ {2}+\frac{\Delta N\sigma}{N_{\textit{evts}}\sqrt{\pi}}}\]

\[\delta\big{(}Trim\_Slope\big{)}=\sqrt{\frac{\Delta V\sigma}{N_{\textit{evts}} \sqrt{\pi}*\sum_{i=1}^{n}\big{(}Trim\_Slope\big{)}^{\prime 2}}}\]

Expressed as minimum conditions in the repetition parameters, we have the following relations. From the noise, we have,

\[N(N_{\textit{evts}}-1)=\frac{V_{\textit{HI}}-V_{\textit{LO}}}{\sigma*f_{ \sigma}^{\ 2}}\]

and from gain and offset we have,

\[N_{\textit{evts}}N*\sum_{i=1}^{n}\big{(}Q_{\textit{inj}}\big{)}^{\prime}_{i }{}^{2}=\frac{\sigma\big{(}V_{\textit{HI}}-V_{\textit{LO}}\big{)}}{\sqrt{\pi} f_{\textit{G}}{}^{2}\big{(}Gain\big{)}^{2}}\]

\[\frac{1}{N*N_{\textit{evts}}\left(\frac{<Q_{\textit{inj}}>^{2}}{\sum_{i=1}^{ n}\big{(}Q_{\textit{inj}}\big{)}^{\prime}_{i}}+\frac{1}{n}\right)}=f_{\textit{ off}}{}^{2}\big{(}Offset\big{)}^{2}\]

while the trim slope gives us

\[N_{\textit{evts}}N*\sum_{i=1}^{n}\big{(}Trim\big{)}^{\prime}_{i}{}^{2}=\frac{ \sigma\big{(}V_{\textit{HI}}-V_{\textit{LO}}\big{)}}{\sqrt{\pi}f_{\textit{ TS}}{}^{2}\big{(}Trim\_Slope\big{)}^{2}}\]

Analysis of the trim slope precision suggests that we may reduce scanning time by using distinct values for \(N_{\textit{evts}}\) and \(N\) from those used in measuring gain and offset.

For tables of the typical values of quantities discussed herein and sample precision calculations, see Appendix B. Experimental data comparisons are in Appendix C.

[MISSING_PAGE_FAIL:9]

To generate the plots in the figures, we have first fit for the exponent on the independent variable, and then fit with the exponent held constant to deduce the best value for the scaling parameter, \(p_{\it 0}\). As the figures illustrate, the most consistent reasonable value for the scaling parameter is \(p_{\it 0}=1\).

Combining the results from the three independent variables, we arrive at an equation for \(\delta\sigma\).

\[\delta\sigma\Big{(}\sigma,N_{\it evts},\Delta V\Big{)}=\sqrt{\frac{\sigma^{*} \Delta V}{\left(N_{\it evts}-1\right)}}\]

Figure 4: Results of Monte Carlo simulation. \(\delta\sigma\)is plotted as a function of \(N_{\it evts}\) and fit in the manner described below.

Figure 5: Results of Monte Carlo simulation. \(\delta\sigma\)is plotted as a function of \(\Delta V\), and fit in the manner described below.

## Appendix B Sample Calculations

Here are some sample calculations. The values used for the input parameters are currently the default running values for these parameters.

\begin{tabular}{|c|c|} \hline
**Noise, \(\sigma\) (mV)** & 5 \\ \hline
**Voltage Step, AV (mV)** & 7.5 \\ \hline
**n (\# of scan points)** & 4 \\ \hline
**Gain (mV/IC)** & 50 \\ \hline
**Offset (mV)** & 15 \\ \hline
**Trim Slope** & 3 \\ \hline
**Nevts** & 500 \\ \hline \end{tabular}

The percent statistical errors for various numbers of trigger events are in the tables below.

\begin{tabular}{|c|c c c c|} \hline
**Nevts** & **\%S(Gain)** & **\%S(Ofset)** & **\%S(Noise)** & **\%S(Trim Slope)** \\ \hline \hline
100 & 0.823 & 9.046 & 12.309 & 1.345 \\
200 & 0.582 & 6.396 & 8.682 & 0.951 \\
300 & 0.475 & 5.223 & 7.083 & 0.776 \\
400 & 0.411 & 4.523 & 6.131 & 0.672 \\
500 & 0.368 & 4.045 & 5.483 & 0.601 \\
600 & 0.336 & 3.693 & 5.004 & 0.549 \\
700 & 0.311 & 3.419 & 4.632 & 0.508 \\ \hline \end{tabular}

\begin{tabular}{|c|c c c c|} \hline
**NVts** & **\%S(Gain)** & **\%S(Offset)** & **\%S(Noise)** & **\%S(Trim Slope)** \\ \hline \hline
100 & 0.672 & 5.539 & 10.050 & 1.098 \\
200 & 0.475 & 3.917 & 7.089 & 0.776 \\
300 & 0.388 & 3.198 & 5.783 & 0.634 \\
400 & 0.336 & 2.770 & 5.006 & 0.549 \\
500 & 0.300 & 2.477 & 4.477 & 0.491 \\
600 & 0.274 & 2.261 & 4.086 & 0.448 \\
700 & 0.254 & 2.094 & 3.782 & 0.415 \\ \hline \end{tabular}

\begin{tabular}{|c|c c c c|} \hline
**NVts** & **\%S(Gain)** & **\%S(Offset)** & **\%S(Noise)** & **\%S(Trim Slope)** \\ \hline
100 & 0.475 & 3.917 & 7.107 & 0.776 \\
200 & 0.336 & 2.770 & 5.013 & 0.549 \\
300 & 0.274 & 2.261 & 4.089 & 0.448 \\
400 & 0.238 & 1.958 & 3.540 & 0.388 \\
500 & 0.212 & 1.752 & 3.165 & 0.347 \\
600 & 0.194 & 1

## Appendix C Experimental Validation

We have performed an experimental verification of the formulae given in the body of this note for the statistical precision in noise, gain and offset.

The plots in Figures 7-12 below compare the theoretical results predicted by our models with the spread of measured values seen in real data. In the real data, each measurement was taken 25 times. Error bars are calculated from statistics and represent 1\(\sigma\) interval.

For the gain and offset, these plots indicate that the theory is consistent with the data at the 1\(\sigma\) level. The plots for the noise suggest that the theory is valid in the regime where \(r=\Delta\)V/\(\sigma<<1\), but that the default value for \(\Delta\)V approaches the outside boundary of this regime. In particular, this is illustrated in Figure 8, where the relative positions of the data and the model become inverted as \(r\) is increased. The results in Figure 7, with data taken at \(r=1.5\) (the default), are also consistent. Monte Carlo data in this region is given in Figure 6. The model begins to deviate from the simulated data when \(r\) is increased beyond 1. In this regime the spread depends strongly on the number of bins. Whether the midpoint falls at the center or the edge of a bin determines the behavior of the spread. Thus we see a saw-tooth behavior in Figure 6 as the number of bins under the transition alternates between even and odd.

Figure 6: Monte Carlo data showing behavior of \(\delta\sigma\) as a function of \(r\). The current default settings have \(r\)=1.5. Available values below the default are \(r\)=1 and \(r\)=0.5.

Figure 8: Dependence of \(\delta\)\(\alpha\) on \(\Delta\)V (Measured) plotted with values predicted by the model (Theory). Each measured data point has 25 contributing measurements. N\({}_{\rm ev}\)=100.

Figure 7: Dependence of \(\delta\)\(\alpha\) on N\({}_{\rm ev}\) (Measured) plotted with values predicted by the model (Theory). Each measured data point has 25 contributing measurements. \(\Delta\)V=7.5mV (default).

Figure 10: Dependence of \(\delta\)(Gain) on \(\Delta\)V (Measured) plotted with values predicted by the model (Theory). Each measured data point has 25 contributing measurements. N\({}_{\rm ev}\)=100.

Figure 9: Dependence of \(\delta\)(Gain) on N\({}_{\rm ev}\) (Measured) plotted with values predicted by the model (Theory). Each measured data point has 25 contributing measurements. \(\Delta\)V=7.5mV (default).

Figure 11: Dependence of \(\delta\)(Offset) on N\({}_{\rm{ev}}\) (Measured) plotted with values predicted by the model (Theory). Each measured data point has 25 contributing measurements. \(\Delta\)V=7.5mV (default).

Figure 12: Dependence of \(\delta\)(Offset) on \(\Delta\)V (Measured) plotted with values predicted by the model (Theory). Each measured data point has 25 contributing measurements. N\({}_{\rm{ev}}\)=100.

## References.

* [1] ATLAS SCT Group, "Testing Specification for the Wafer Screening, Project: ABCD3T ASIC ", ATLAS Internal Document
* [2] ATLAS SCT Group, "Project Specification, Project: ABCD3T ASIC", ATLAS Internal Document
* [3] C. Haber et al, "Electrical Assembly and Testing of SVX Ladder Modules", CDF Note 1636, February 16, 1993
* [4] L. Lyons, _A Practical Guide to Data Analysis for Physical Science Students_, Cambridge University Press, c. 1991
* [5] Particle Data Group, R.M. Barnett et al., Physical Review **D**54, 1 (1996)
* [6] ROOT: An Object-Oriented Data Analysis Framework: [http://root.cern.ch](http://root.cern.ch)