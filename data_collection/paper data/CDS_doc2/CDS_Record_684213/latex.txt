# Cobra Performance

Wim T.L.P. Lavrijsen

University of Nijmegen

Faculty of Science

Toernoolevld 1

NL-6525 ED Nijmegen

The Netherlands

Wim.Lavrijsen@cern.ch

###### Abstract

This note presents the performance of the COmBined muon Reconstruction for Atlas (COBRA) package. It consists of two parts: the first part gives a proof of concept of the generic fit, as implemented in COBRA, and tests the fit qualitatively. The second part uses single tracks to estimate the COBRA 'physics' performance and compares the resultant momentum resolutions with those of the final fits of the Atlas pattern recognition packages IPATREC and MUONBOX. The performance of the combined, global fit is compared to the results of the muon identification package MUID.

## 1 Introduction

The muon spectrometer in Atlas is capable of accurately measuring positions along a charged particle trajectory. The directions of tracks reconstructed in the muon spectrometer will therefore be well enough defined to exploit the distance of the muon spectrometer from the vertex (the lever arm) to obtain the best estimates of the track parameters on the vertex. This is especially true for muons with higher momenta, as their relative energy loss in the calorimeter is small. The best way to exploit this lever arm, is to combine the measurements from the inner tracker with those of the muon spectrometer at the track-fitting stage, as opposed to e.g. combining fit parameters in the later analysis.

COBRA is an acronym for COmBined muon Reconstruction for Atlas and it is part of the Atlas offline reconstruction software. The package allows for track matching through extrapolation of track segments from the inner tracker and muon spectrometer as obtained from the respective pattern recognition packages. COBRA is capable of refitting the track segments and performing a global fit of matched track segments, taking into account an average (or, alternatively, a most probable) energy loss in the calorimeter [1]. Some of the COBRA methods are new and some, although successfully applied in other experiments, were not used in Atlas before. This note describes the performance of COBRA by studying the resolution, residual, goodness-of-fit, and pull distributions. The results provide sufficient confidence in the COBRA methods.

COBRA is also compared to the performance of the final fits of the pattern recognition packages of the inner tracker and the muon spectrometer. It is important that the combined muon reconstruction is at least as good as the reconstruction in each of the subsystems alone, otherwise it would be impossible for COBRA to obtain the best possible combined reconstruction.

The results in this note are based on simulation performed with DICE version offline-01-00-01 with the muon spectrometer geometry taken from AMDB version m2.8. The magnetic field was taken from the 3D field map version 02 and was used for both the inner tracker and the muon spectrometer. In the Atlas Physics PerformanceTDR [2], which can be used for comparing results, the geometry in the simulation was also m2.8, but there the magnetic field in the inner tracker was taken to be homogeneous. Reconstruction was done with ATRECON versions offline-01-03-00 and offline-01-03-01 and with COBRA version Cobra-00-00-11. As all this code is under development, it should be understood that this note provides only a snapshot of the performance.

## 2 Proof of Concept

The concepts of the COBRA generic fit are presented in [1]. The following claims were made.

* The generic fit can be applied to completely different detector geometries without loss of performance compared to a dedicated fit.
* The applied generalisations do not lead to non-physical results.

The generic fit and its generalisations are the keys to a simple and straightforward implementation of the global fit of combined track segments. The two claims are checked in the two sections below.

### Reuse of the Generic Fit

The simplest way to prove that the generic fit works for completely different detector setups is by simply doing the exercise: in COBRA, the same code performs the refits in the inner tracker and the muon spectrometer, as well as the global fit of combined track segments.

With PYTHIA v5.7 [3], 5000 Higgs events at a Higgs mass of 170 GeV/c\({}^{2}\) are generated. The Higgs particles decay into two Zs, which subsequently decay into (a total of) four muons. The detector response of these muons is simulated and the physical observables are reconstructed from it. No background was added to the simulation. The detector is assumed to be 100% efficient and perfectly aligned. After applying the standard event selection cuts [2], which leads to a selection of 4-muon events, the Higgs mass is reconstructed by computing the invariant mass of the muons.

Mass resolutions thus obtained are presented in Figure 1 for the inner tracker, for the muon spectrometer, and for the global, combined fit. The tracks from the muon spectrometer are traced back to the beam line to correct for

Figure 1: Distributions of the reconstructed invariant mass in the \(H\to ZZ^{*}\to 4\mu\) channel for a Higgs boson with a mass of 170 GeV/c\({}^{2}\). For the inner tracker stand-alone, the muon spectrometer stand-alone, and for the combined muon reconstruction. None of the fits included a constraint on the vertex.

the energy lost in the calorimeter. The fits are gaussian fits over a 2\(\sigma\) region around the central value. Each of the distributions is seen to be reasonably gaussian shaped. The tail towards lower masses is caused by initial state radiation, although the selection cuts suppress events in this region. With the muon spectrometer stand-alone, considerably fewer events pass the selection cuts than for the inner tracker and combined fits. The combined fit does improve on the stand-alone refits, but at the cost of some inefficiency.

Note that for a Higgs mass of 170 \(\,\mathrm{GeV/c^{2}}\), the most probable transverse momentum (\(P_{t}\)) of the decay muons is about 20 GeV/c. For muons with such \(P_{t}\), the improvement in the momentum resolution by the combined fit is only moderate (see Section 5.1).

The results can be compared with the results in [2], with the caveat that the results presented there where obtained with a homogeneous magnetic field in the inner tracker. The resolutions for the inner tracker stand-alone and for the combined reconstruction are found to be similar. The resolution for the muon spectrometer seems worse, but that is only because the result in [2] was obtained with a vertex constraint (which of course propagates to the combined fit as well). For the results in Figure 1, no vertex constraints were applied1.

Footnote 1: \(\,\mathrm{COBRA}\) allows for a vertex constraint in the inner tracker refit and in the combined, global fit. It is not able to add the vertex constraint on the refit in the muon spectrometer.

### Test of Hit Generalisation

COBRA does not use any explicit geometry information. In particular, the geometrical constraints set by the edges of the detector elements are not used. The fitted, local trajectory position may therefore fall outside the detector element that registered the hit, if this improves the \(\chi^{2}\) of the fit. In practice, this cannot happen too often as all the track segments did already pass the pattern recognition selection and final fit. Still, it is important to test this assumption: if the test fails, it points to problems in either the generic fit or the pattern recognition.

A nice way to test the effects of the lack of hard geometry constraints is found in the semiconductor tracker (SCT) layers in the barrel part of the inner tracker. The strips in these layers consist of two silicon strips of 6.41 cm each, bonded together in order to be able to use only one readout channel. Consequently, there is a dead region where the two strips meet. A generalized strip hit as implemented in COBRA, always uses the strip centre as the initial local position for the fit. For these SCT layers the COBRA initial local position is therefore exactly

Figure 2: Hit residuals of the strip length coordinate for the 2\({}^{\mathrm{nd}}\), 3\({}^{\mathrm{rd}}\), and 4\({}^{\mathrm{th}}\) barrel SCT strips. The distributions include all strips from the selected layer, that is all strips of both stereo angles and all strips over the full range of \(\phi\).

in the dead region where a true hit can not be recorded. If the COBRA fit is working properly, then the fitted position must move out of the dead region and must be distributed uniformly over the active regions of the two strips. This is exactly what is seen in Figure 2, which shows the distributions of the hit residuals (i.e. fitted - initial) for the strip length coordinate in the 2\({}^{\mathrm{nd}}\), 3\({}^{\mathrm{rd}}\), and 4\({}^{\mathrm{th}}\) layer in the barrel SCT.

The COBRA fit does indeed move the fitted positions out of the dead region and does not cross the geometrical strip boundaries. The residual distributions are also flat, as they should be: there should be no accumulation of residuals around strip centre. That result is, however, fully attributable to the fact that the strip length coordinate bears no weight whatsoever w.r.t. to the strip pitch coordinate.

## 3 Quality of the Fit

The COBRA track fit is qualitatively tested by means of the residuals, the momentum pull and the \(\chi^{2}\) probability distributions. The results presented below were obtained using single tracks from negatively charged muons with a transverse momentum of 45 GeV/c. At this \(P_{t}\), the inner tracker and muon spectrometer perform equally well in terms of momentum resolution (see Figure 12, in the next section).

### Residuals

The distributions of hit residuals are expected to be gaussian shaped with a 1\(\sigma\) width that is smaller than, but of the order of the measurement uncertainty. In particular, it is important that the distributions have no non-gaussian tails. Also, the residuals distributions of detector elements of the same subsystem should be roughly equal.

Some examples are shown in Figure 3. Note that the second plot shows the residuals from the 2\({}^{\mathrm{nd}}\) SCT layer in the barrel when that layer is excluded from the fit. The shapes and widths of the distributions are as expected and there are no significant non-gaussian tails.

If a hit is excluded from the fit, e.g. by setting its weight to zero, then the residual is determined by the projection of the trajectory onto the measurement plane. If the distance to the previous and next measurement is short and/or if there is little or no material in between, then the prediction is rather accurate and the measurement

Figure 3: Hit residuals for the outer three SCT layers in the barrel (left), fit residuals for the 2\({}^{\mathrm{nd}}\) barrel SCT layer (centre), and hit residuals for the three pixel layers (right). The gaussian fits in the left and right plots are to the distributions of the outermost SCT and innermost pixel layer, respectively.

uncertainty is retrieved (as the hit lies on the trajectory because of the selection by the pattern recognition). This can be seen in the centre plot, where indeed the width of the distribution is about 23.1 \(\mu\) (i.e. 80/\(\sqrt{12}\)\(\mu\)).

The conclusion is that the hit residuals are basically fine. The residuals in the other subdetectors, in particular those from the fit in the muon spectrometer, still need to be checked, though.

### Momentum Pull

The fit yields an estimate of the uncertainty of the fitted momentum. As the generated momentum (truth) is known from the simulation, a pull for the fitted momentum can be constructed, with 'P' denoting the total momentum:

\[\frac{1/P_{fit}-1/P_{truth}}{\delta(1/P_{fit})} \tag{1}\]

The results are shown in Figure 4.

Each distribution is basically gaussian shaped, although the distributions from the muon spectrometer and from the combined fit have more entries in their tails than expected from the gaussian prescription. These tails are caused by hard scatters in the traversed material. The estimated uncertainty on the fitted momentum is correct to within 10%, as can be seen from the \(\sigma\) parameter of the gaussian fit, which would be 1 if the uncertainties are estimated perfectly. To investigate this effect further, Figure 5 shows the pulls for the various fits as a function of \(P_{t}\). It can be seen that all pull distributions are systematically too high, and there is a dependence on momentum.

Figure 4: \(1/P\) pull distributions from single muons with a transverse momentum of 45 GeV/c for the inner tracker, for the muon spectrometer, and for the combined, global fit. Note that in the case of the muon spectrometer fit, \(P_{{}_{\rm truth}}\) is taken at the entrance of the spectrometer instead of at the vertex.

The increase in width at lower momenta for the muon spectrometer pulls is explained by the increase in tails, which widens the fitted gaussian. However, the similar increase for the case of the inner tracker can probably not be attributed to the same effect. Some more detailed study and likely some new code development is called for.

### \(\chi^{2}\) Probability

The \(\chi^{2}\) probability distributions for the respective (re)fits are shown in Figure 6. The distribution from the fit in the inner tracker is fine, although there is a small fall-off towards higher probabilities. This is likely caused by an overestimation of the uncertainties in the pixel detector, which are already tweaked to values lower than width\(\sqrt{12}\) to account for the fact that the clustering in DICE is not sufficiently realistic. The \(\chi^{2}\) probability distribution can be expected to look good in the inner tracker, as the layout of both the detector geometry and the magnetic field are rather simple and the total amount of material is low.

The distribution from the fit in the muon spectrometer shows an increase towards, and a peak at one. The peak at zero is to be expected from the material distribution and magnetic field configuration in the muon spectrometer.

Figure 5: The 1\(\sigma\) widths of the gaussian fits to the \(1/P\) pull distributions as a function of transverse momentum for the inner tracker, for the muon spectrometer, and for the combined, global fit.

Figure 6: Probability distributions of the fit \(\chi^{2}\) for single muons with a \(P_{t}\) of 45 GeV/c for the inner tracker, for the muon spectrometer, and for the combined, global fit.

A muon that looses a significant part of its energy or follows a path close to the magnetic coils is very likely to yield a bad fit. The rise at high probabilities would indicate an underestimation of the uncertainties due to multiple scattering and variations in the magnetic field. It is, however, not unlikely that it is an artefact of a lack of realism in the simulation. In particular the material distribution of the Monitored Drift Tubes (there are, for example, no individual tubes) and the drift time response are not described accurately. COBRA uses a fixed uncertainty of 80 \(\mu\)m on all MDT hits2, except when the drift time is low (i.e. the muon crossed the tube close to the wire). If the simulation delivers more accurate hits, a peak at one will arise.

Footnote 2: Which in itself is not an accurate description, as the real uncertainties will vary as a function of drift time

The \(\chi^{2}\) probability distribution of the combined fit is clearly a result from the combination of the other two distributions: the peak at zero from the distribution in the muon spectrometer remains, while the peak at one is distributed flatly (i.e. according to the inner tracker distribution) over the full range. As fit problems due to material and magnetic field are to be expected, the conclusion is that the distribution is basically fine.

## 4 Comparison

The COBRA performance in the two tracking detectors of Atlas is compared to the performance of the final fits of the respective pattern recognition packages: IPATREC for the inner tracker and MUONBOX for the muon spectrometer. The combined performance of COBRA in global fit mode is compared to the results from the muon identification package MUID. The results presented below were obtained by simulating single, negatively charged muons in samples of fixed transverse momentum, over the full range of \(|\eta|<\) 2.5. Note in particular that both in the inner tracker and in the muon spectrometer, the 3D magnetic field map was used.

### Inner Tracker

Figure 7 shows the transverse momentum (\(P_{t}\)) resolution of the COBRA and IPATREC packages for single muons, as a function of \(P_{t}\). Both fits scale almost linearly with \(P_{t}\) as expected for a detector like the Atlas inner tracker, and have equal performance within the statistical uncertainty.

Figure 7: Comparison of the IPATREC (circles) and COBRA (triangles) \(P_{t}\) resolutions, as a function of \(P_{t}\).

For all samples, the COBRA refit efficiency is 100%, with both packages having a similar number of tracks in the non-gaussian tails of the distributions (although not necessarily the same tracks).

The same events can also be plotted as a function of pseudorapidity (\(\eta\)), as in Figure 8. The effect of the drop in bending strength of the solenoid field is clearly visible at high \(\eta\). Also at high \(\eta\), the COBRA fit appears to outperform the IPATREC fit. This discrepancy is under investigation and some potential causes have been identified, but it has not been solved yet.

From the presented results, the conclusion is that the physics performance of the COBRA refit in the inner tracker is satisfactory.

### Muon Spectrometer

The momentum resolutions of the COBRA and MUONBOX packages for single muons, as a function of \(P_{t}\), are compared in Figure 9. The reconstructed momentum is compared with the Monte Carlo momentum at the entrance of the muon spectrometer.

Figure 8: Comparison of the IPATREC (circles) and COBRA (triangles) \(P_{t}\) resolutions, as a function of pseudo-rapidity.

Figure 9: Comparison of the MUONBOX (squares) and COBRA (triangles) momentum resolutions, as a function of \(P_{t}\).

What is called resolution is the 1\(\sigma\) width of a Gaussian fit of the 2\(\sigma\) central part of the distribution. For both fits, the resolutions obtained are worst at very low momenta (due to energy loss fluctuations), they get better in the intermediate \(P_{t}\) region, and flatten out at higher momenta (where the dominant contribution to the resolution is multiple scattering).

The difference between COBRA and MUONBOX for low and intermediate \(P_{t}\), in the muon spectrometer stand-alone performance is likely due to a discrepancy between the material distribution description in the simulation and MUONBOX. Although the simulation application (DICE) and MUONBOX access the same database file, they may select different elements from it. As a consequence, MUONBOX can not be sure what was actually used in the simulation. COBRA uses the material description directly, as written on tape by DICE and has therefore, by definition, the same setup as used for the specific simulation run.

At higher energies, COBRA follows MUONBOX more closely than what could be expected from the statistical uncertainties. This is probably due to the fact that COBRA does not apply any corrections (such as propagation time along the wire for drift hits), but takes those as fitted by MUONBOX. Doing so restricts the range of the physically valid trajectories 'accessible' to the fit.

The momentum resolution can also be plotted as a function of \(P_{t}\), see Figure 10. Note that in the region -2.2 \(<\eta<\) -1.7, the Monte Carlo truth information was unavailable, so no resolution could be computed.

The resolutions are worst in the transition region between the barrel and endcap, as is to be expected from the detector layout. The observed difference in momentum resolution is seen to be independent of \(\eta\).

The refit efficiency of COBRA in the muon spectrometer is shown in Figure 11, where it is compared to the pattern recognition efficiency of MUONBOX. The COBRA refit efficiency is seen to be less than 100%. The inefficiency is momentum dependent and is worst at lower momenta. It is not directly clear what is causing this inefficiency as it turns out to be both \(\eta\)- and \(\phi\)-independent.

Figure 10: Comparison of the MUONBOX (squares) and COBRA (triangles) momentum resolutions, as a function of pseudo-rapidity.

The comparisons are to be repeated once updated versions of DICE and MUONBOX, where both packages do use the same geometry, become available. Nevertheless, there is enough evidence to conclude that also in the muon spectrometer, the COBRA refit yields good physics performance although some work on the efficiency is still needed.

## 5 Combined Reconstruction Performance

### Momentum Resolutions

Figure 12 shows the momentum resolution of the combined reconstruction as obtained by COBRA, as a function of \(P_{t}\). The results are as expected: at lower energies, the inner tracker has the dominant contribution to the momentum resolution. At around 20 GeV/c, the muon spectrometer starts to contribute and this contribution increases in importance as the resolution of the inner tracker worsens.

Figure 11: Reconstruction efficiencies of MUONBOX (squares) and COBRA (triangles) in the muon spectrometer. Note that the plotted efficiency for COBRA includes the MUONBOX pattern recognition efficiency.

Figure 12: Comparison of the COBRA momentum resolutions, as a function of \(P_{t}\). Plotted are resolutions from the inner tracker stand-alone (circles), from the muon spectrometer stand-alone (squares), and from the combined, global fit (triangles).

At high energies, the muon spectrometer resolution delivers the most important contribution to the combined resolution. However, the muon spectrometer momentum resolution distribution has large tails, caused by large energy losses in the calorimeter. The combined spectrum on the other hand is still reasonably gaussian shaped, with small non-gaussian tails, which is an important improvement3. Note in particular that the plotted resolution for the muon spectrometer is from a \(2\sigma\) fit to the central region, whereas for the combined fit the full distribution is fitted. The reduction of non-gaussian tails by means of the inner tracker momentum measurement remains effective even for several hundred GeV.

Footnote 3: For example for Higgs physics: tails greatly reduce the ability in the final analysis of identifying two muons as coming from one Z, thus a cut based on a mass window would be less effective.

### Comparison

Another combined reconstruction package in Atlas is MUID. Contrary to COBRA, it does not perform a full refit of the hits in the muon spectrometer. Where COBRA uses a global fit, MUID takes the full information of the muon spectrometer into account assembled in one point at the entrance of the muon spectrometer4. Furthermore, whereas MUID uses the calorimeter energy measurement when extrapolating tracks through the calorimeter, COBRA uses a detailed parametrisation of the average energy loss. It is not intuitively clear which approach is better: an actual measured value is, of course, preferred, provided that it is accurate. But the track fit relies on propagation of both the uncertainties on the track parameters and their correlations, which can only be computed for the the average track. The explicit addition of an energy loss value would invalidate the propagated covariance matrix5, at which point the track fit would not be able to improve on a weighted average method. For physics channels where muons cross jets, a parametrisation is the only option, but what is the best in general can only be found out by trying it. The results are shown in Figure 13.

Footnote 4: MUID used to have a global fit, but moved to this approach, after experiencing unacceptable refit inefficiencies in the transition region between the barrel and the endcap. The refit problems have been solved and MUID could again use a global fit, if that is reimplemented.

Footnote 5: It is possible to scale the average energy loss with the measured energy loss, during propagation. This will yield a valid covariance matrix and likely an improved result. This method has not yet been pursued

Figure 13: Comparison of the MUID (circles) and COBRA (triangles) \(P_{\rm t}\) resolutions from the combined fit momentum, as a function of \(P_{\rm t}\).

Following Figure 13, it would seem that the calorimeter information is an improvement over the parametrisation, although it is as of yet unclear how the use of the calorimeter measurement is going to work out for real events which will suffer from pile-up and QCD background, neither of which was included in the simulation.

### Match Quality

Track segments are matched based on a \(\chi^{2}\) constructed from the respective covariance matrices (\(\sigma_{{}_{1,2}}\)) and predictions on a common position (\(\zeta_{{}_{1,2}}\)):

\[\chi^{2}=(\zeta_{1}-\zeta_{2})(\sigma_{1}+\sigma_{2})^{-1}(\zeta_{1}-\zeta_{2}) \tag{2}\]

Those combinations of track segments that yield a match \(\chi^{2}\) value below a chosen cut off are taken as belonging to the same trajectory. If there are multiple candidates, the match with the lowest \(\chi^{2}\) is kept.

Figure 14 shows the match \(\chi^{2}\) distributions for three different momenta and the percentage of good matches (defined as the percentage of combined tracks constructed with a match \(\chi^{2}<\) 5) as a function of \(P_{t}\). In this case, the match was done on the outside of the calorimeter (i.e. on the inside of the muon spectrometer).

In the region where the muon spectrometer and inner tracker have almost equal performance, i.e. around 45 GeV/c in transverse momentum, the match has the highest quality. The quality drops significantly for tracks with very low and high momenta as is to be expected from the momentum resolutions of the respective trackers (see Section 4).

### Efficiency

The efficiency of the combined reconstruction is presented in Figure 15, where it can be compared to the reconstruction efficiencies after the COBRA refit in the stand-alone tracking detectors.

Figure 14: Quality of the track segment match for single muon events with a \(P_{t}\) of 5 (dashed), 50 (solid), and 100 GeV/c (dotted), left. Percentage of good, high quality matches, as a function of \(P_{t}\), right.

At lower momenta, the combined reconstruction inefficiency is mainly caused by the COBRA refit inefficiency in the muon spectrometer (see the end of Section 4.2). At higher momenta, the inefficiency is due to match failures. The efficiency should improve when the refit inefficiency problem of the refit in the muon spectrometer is solved.

## 6 Conclusions

From the results presented in this note, it can be concluded that the COBRA package delivers good physics performance. The applied generalisations in the COBRA fit are valid and do not impose a penalty on the quality of the results. The track segment match is good and efficient. The combined performance gives an improvement in momentum resolution that follows the expectations.

There are, however, still details that need to be worked out. In particular, the efficiency of the refit in the muon spectrometer must be brought to 100% and the uncertainty estimates on the reconstructed momenta must be improved.

## References

* [1]_Cobra Overview_, W. Lavrijsen, Atlas internal note, ATL-SOFT-2001-001, January 16, 2001.
* [2]_Atlas Detector and Physics Performance TDR_, Atlas Collaboration, CERN, CERN/LHCC 99-14, May 25, 1999.
* [3] "High-energy physics event generation with PYTHIA 5.7 and JETSET 7.4.", T. Sjostrand, Comp. Phys. Comm., 82:74, 1994.

Figure 15: Reconstruction efficiencies for single muons after the pattern recognition and COBRA refit. The efficiency for the combined fit (triangles) includes the match efficiency, which has a cut off value of 100 on the match \(\chi^{2}\).