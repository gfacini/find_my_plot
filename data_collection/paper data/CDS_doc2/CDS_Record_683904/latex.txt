**ATLAS Internal Note**

**MUON-NO-133**

**2 December 1996**

**Report on Muon Electronics Review**

**CERN, October 20, 1996**

Francis Anghinolfi

Ilias Efthymiopoulos

Nick Ellis

Phillipe Farthouat

Brig Williams

## General

There appear to be no fundamental reasons that electronics cannot be developed to meet the needs of the muon measurement and trigger system. However, there are a number of significant issues that should be addressed to ensure a system that delivers the desired performance with high reliability, reasonable cost, and minimum problems during commissioning. Specific comments on each of the electronics systems, based on the material presented and documentation provided, are given below. There are a few general items that potentially apply to all systems which we mention here.

### Power Dissipation and Cooling is a concern.

With 300k channels of MDT readout, 50k channels of CSC readout, 300k channels of RPC, and 600-800k channels of TGC, the total power dissipation of the muon system is very significant. Most of this power must be removed, probably with local controlled cooling rather than just dumped into the air. We note that it is the muon system itself, because of the required temperature uniformity, that will probably set the most stringent limit on power released into the surroundings. The muon community should take very seriously the goal of removing most of this heat in a controlled and local fashion. It should also attempt to minimize the power dissipated in the front ends, subject to the required performance.

### Noise Generation and Noise Immunity should be given high priority.

The MDT system is planning on requiring that all fast signals are differential with low level voltage swings (LVDS). We strongly endorse this approach. It is less clear at this point whether the RPC, TGC, and CSC systems have also followed this approach. We note thatlarge numbers of channels (in excess of half a million) driving large voltage, single ended lines could be a noise source that could threaten the successful operation of the muon system as well as that of other systems. We strongly encourage other parts of the muon system to also pursue differential designs such as LVDS which minimize noise generation.

### Radiation Hardness: Plan to certify all parts for the expected doses.

The muon system has rather low total doses. It is unlikely that special processes will have to be pursued. Nonetheless, some commercial processes can be much "softer" than others. Thus all electronics, whether custom or commercial, will need to be tested at an appropriate level to verify compatibility with the radiation environment. This includes total dose, single event upset, and especially single event latch failure modes.

### Reliability: Potentially a major issue if readout crates are in cavern.

The MDT system currently plans to place the ROD's as well as the power supplies in the cavern. A reliability analyis should be carried out for the MDT's, and for the other systems if similar solutions are followed, to verify that this does not result in undue downtime for the muon system and for ATLAS as a whole.

### Power Supplies: Switching or Linear Supplies. Impact of magnetic field.

Local voltage regulation is being considered for the MDT system. This could result in a more robust system but may also result in a significantly larger power dissipation on the muon chambers. It is noted that none of the inner detector systems consider local voltage regulation to be a necessity. Whether or not switching power supplies should be utilized for the front end circuits and the impact of VME crates near the detector should also be given careful consideration. Finally, the level of magnetic field at the location of crates, and especially the impact on power supplies needs to be addressed.

System Integration: A more detailed design of each overall system is very important, especially for the CSC, RPC, and TGC systems.

A schematic diagram of the overall readout and trigger logic should be worked out in as much detail as possible at the current stage of development of each system. Among the issues that should be addressed are: location and distance between the different components of the readout and the trigger, the transmission media and signal levels used, the amount and type of information being read out, plans for timing-in the electronics and monitoring of its performance.

**Prototype and Production Schedules: Are they consistent with assembly plans?**

The muon system should review their overall assembly and installation plans to ensure that delivery of electronics components is consistent with the plan. It appears, for example, that the present plan for production of the TDC chip may not be consistent with the plans to install electronics on the chambers as they are fabricated. This issue should be evaluated more carefully for the other muon systems as well.

## RPC's

### General

The RPC chambers to be used for the muon trigger in the barrel region are capable of very good timing resolution. Test Beam measurements with discrete electronics have demonstrated a time resolution (sigma) of 1.4 nsec. Thus there would appear to be no fundamental problem in correctly identifying the correct bunch crossing.

**Comments and Questions:**

* While the time resolution of the RPC's (and the associated electronics) should be very good, it would be useful to see a systematic analysis of all contributions to uncertainty in the trigger timing. This should include for example: Variation in propagation delays in the chambers. Time resolution of RPC plus front end chip. Variation in propagation delay through front end chip. Timing of the clock to the latch prior to Matrix chip. Duration of output pulse from the discriminator.

### Front End Signal Processing

Design of a GaAs front end chip with preamplifier, post amplifier, and comparator was presented. The bandwidth peaks at about 100MHz, bipolar shaping is utilized, and the overall gain prior to the comparator is about 300. The power dissipation is expected to be about 10mW for the preamp/shaper and about 30-40mW for the comparator. A protoype chip with 2 channels has, or will soon be, fabricated. An option is to include two comparators.

It is planned to fabricate 4000 channels of the 2 ch chip for beam test next year, and to proceed with the development of an 8 ch chip.

**Comments and Questions:**

* It does not appear that GaAs is required to achieve the required bandwidth for time resolution or for reasons of radiation hardness; a silicon technology should be adequate. Nonetheless, it appears that the present design should meet the required goals. In general, it is often expected that the yield is lower in GaAs, and the cost higher, than for silicon. However the quoted yield (80%) and estimated cost (1 CHF) for the GaAs version are certainly good. Production of a large number of channels next year should allow better evaluation of the real yield and cost.
* Is there a risk that the chosen GaAs process may not be around at the time of production?
* Should the yield, cost, or availability of the present GaAs process prove to be a problem in the future, a silicon process could be considered as well as alternative GaAs processes.
* Given the large number of channels in the RPC system, the power dissipation per channel (50mW) is not insignificant. Does this power include driving the signal to the latches? Could this power dissipation be decreased?
* What are the plans for threshold control, power distribution, etc?
* The cross-talk has been shown to be less than 10%. Is this limit sufficient? Can one measure more accurately the cross-talk?

### Readout

It was stated that all the hits will be read-out offline. This is good in that it will enable to verify offline whether the trigger is performing correctly. The data is "zero-suppressed" to the extent that zeros, i.e. empty latches are not read out. The latched data from the front end chips will be stored in a Level 1 memory with 2.5 microsec latency, and a derandomizer is included as interface to a "100kHz" asynchronous bus (i.e. for reading data out at a maximum event rate of 100kHz). Preliminary estimates of the bandwidth indicate that only 4 ROD's would probably be required; however, it is intended to have 16 ROD's located azimuthally around the detector at \(\eta=0\). The group is quite happy to have the ROD be as consistent with ROD's for other detectors as is feasible.

**Comments and Questions:**

* Where will the output data be latched? Will the same latch be used for reading out the hits as for the input to the MATRIX chip? (If not, use of the data offline for testing the trigger logic may be compromised). Is there provision to "mask off" noisy channels. Is it intended to be able to load data into the latches or just into the MATRIX chip?
* What is the approximate distance from the amplifier/shaper/discriminator chips to the latch? What is the media (cable, backplane, strip line). Will these signals be differential?
* A general concern here is that of noise generation if large amplitude (e.g. 3-5 volt) single ended signals are used and the buses/cables are long and unshielded.
* Is it intended to readout any of the "trigger primitive" information, i.e. results after some trigger processing but before generation of the signals sent to the off-detector trigger processor? If so, what are the media and protocol?
* What are the plans for distribution of the clock, L1A, BCR & Event counter resets, etc?
* What are the plans for downloading of the thresholds and other front end "parameters" which may exist?
* A more detailed calculation of the bandwidth and the number of links to the ROD's would be useful.
* In summary, one would like a more detailed schematic for the overall readout.

### Trigger Generation

We do not comment on this in detail, as it is really the jurisdiction of the trigger group. Significant attention was paid to the trigger in a recent meeting in Rome and a meeting addressing the triggering is also planned for November, just before ATLAS week.

The plan for generation of the trigger using the MATRIX chip for coincidences was presented. Good results have been obtained with the demonstrator chip which, while it does not have the full functionality, is a good proof of concept. Results on the development of a 32 bit, 0.6-1.0 Gigabit, GaAs link were presented; this link is envisioned as a candidate for sending the trigger information generated at 40MHz to the off-detector trigger processor. It usesManchester encoding, and is a bi-directional link. A receiver chip, approximately \(7\times 4\,\mathrm{mm}^{2}\), has been developed and is nominally available from GIGA Corp. It consumes about 3 Watts.

**Comments and Questions:**

* What is the overall efficiency for generating a trigger in the correct beam crossing? What is the probability for generating the trigger before the correct crossing?
* As already noted above, what intermediate trigger results, if any are planned to be read out? What is the overall plan for timing in, monitoring and verifying the trigger logic? Is it intended to be able to download information into the trigger front end for testing.
* We note that the off-detector trigger processor will require uniform links from all subsystems. Thus the GaAs link should be viewed as a candidate that can be used by all subsystems but which will compete against other options in terms of cost, power, ease-of-use, and reliability.
* How does one plan to "time-in" and monitor the front end and trigger system?

## Thin Gap Chambers (TGCs)

### General

The Thin Gap chambers to be used for the muon trigger in the endcap region are in principle capable of good timing resolution. Test Beam measurements have demonstrated 98% of hits within 25 nsec. Thus there would appear to be no fundamental problem in correctly identifying the correct bunch crossing.

**Comments and Questions:**

* While the time resolution of the Thin Gap Chambers (and the associated electronics) should be very good, it would be useful to see a systematic analysis of all contributions to uncertainty in the trigger timing. This should include for example: Variation in propagation delays in the chambers (these are significant). Time resolution of Thin Gap Chamber plus front end chip. Variation in propagation delay through front end chip. Timing of the clock to the latch prior to the trigger logic. Duration of the output pulse from the discriminator.

### Front End Signal Processing

A reasonably careful analysis of the capacitances of the wires and strips on the thin gap chambers was presented. It is intended to gang five wires together resulting in an input capacitance of about 160pF. Assuming 2e/cluster and a gain of \(10^{6}\) the signal on the wires is estimated to be about 0.32 pC. For the strips, the capacitance is estimated to be approximately 100 pF and the induced charge about \(4\times 10^{5}\) electrons. Assuming a risetime of 10-20 nsec and the preamplier design (discussed more below), the noise is estimated to be 10000 electrons for the wires and 4000 for the strips. The time jitter due to the electronics is estimated for the wires to be only 0.25-0.5 nsec.

Of more concern is the time jitter due to the time-walk, that is the variation in time due to pulse amplitude. This was estimated to be 1-2 nsec for the wires assuming a threshold 4 times the noise level, i.e. about 40000 electrons or 7 fC. For the strips, a time walk of 4-8 nsec was estimated (however see questions/comments below).

A prototype 4 channel ASD chip has been developed using the Sony Masterslice linear array (i.e. semicustom array). Typical parameters for the large, low noise, input transistor are a \(R_{bb}\) of 17 ohms, and \(f_{t}\) of 950MHz. The feedback capacitor is 1 pF and \(R_{f}\)-16kohms. The peaking time of the shaper is nominally 16 nsec, where the exact value is determined at least partially by available R & C components. The last stage is a comparator with a latch which extends the pulse width to 50 nsec. The total power per channel is about 70 mW with the majority of the power dissipated in the discriminator and the ECL output drivers. Simulation of the chips showed some variation in the peaking time with amplitude, probably due to some slew rate limiting in the circuit. Baseline restoration (of a Robinson type) is also included. The circuit "turns on" solidly for 0.05pC inputs. Timing "walk" appears to be of order 5 nsec for pulse amplitudes varying from 0.01 to 1 pC. Thus for the actual expected pulse height variation it may be closer to 3 nsec. By April 1998 one should be ready to go into production; a total of 600k to 800k channels will be required.

**Comments and Questions:**

* It appears that the bipolar chip development will probably yield a chip which meets the needs. However there are a number of issues concerning optimisation of the design and the resulting time resolution. The issue appears to be more critical for the strips.
* What is the optimal risetime? A faster risetime results in less slewing due to amplitude variations, but less signal and larger noise. Convolution of the expected amplitudedistribution with a chosen risetime could more accurately estimate the contribution from "time-walk".
* What is the risetime with the detector capacitance connected to the input? What is the input impedance of the amplifier at 100 MHz frequency?
* We encourage measurement of the TGC time resolution with the prototype electronics as soon as possible.
* Some information presented indicated that it might be necessary for the strips to lower the threshold to less than 4 times the noise level to obtain low enough time walk. Yet the signal-to-noise was claimed to be of order 100:1 so there should not be a problem. Thus whether or not time-walk for the strips is a significant issue was not clear.
* Given that there are 600k-800k channels, power consumption is a significant issue. A significantly lower power dissipation might be obtained by changing from ECL levels to lower voltage swings, by going to a more advanced process, or both. Reduction of the power by a factor of two, which is probably obtainable, would allow significant savings in the cost of power supplies, power distribution, and cooling.
* The present Sony array seems to allow limited adjustment in the shaping time. If a way around this is not found, one might consider asking Sony to add a "custom tile" (Tektronix used to do this) or to go to a full custom design for the final production.
* Given the large number of channels, it may be worthwhile considering full custom for the production, either in the Sony process or in another process. Other collaborators in ATLAS doing bipolar development could help provide access to other processes if the Sony process ultimately proves inadequate.
* Although the radiation doses in the region of the thin gap chambers are not large, the Sony process should be evaluated to see if it is sufficiently radiation resistant (in particular to the neutron dose of \(2.5\times 10^{12}n/cm^{2}\).)

### Readout

A diagram of the arrangement of 128 ch boards on a sector of the thin gap chambers was presented. It was stated that the data for hits corresponding to triplets would be readout. Some approximate estimates of the number of readout links and bandwidth were presented.

It was noted that there was not space for crates so that most of the readout logic had to be mounted on the chambers.

**Comments and Questions:**

* A concern was expressed that if one only reads out the hit information for "triplets" found by the trigger logic, then one would not be able to verify the trigger performance using offline information. It was suggested that one should read out all "hits" that exist, using some other form of zero suppression than triplets found by the trigger logic.
* A schematic diagram of the overall readout logic, showing where information is latched, whether the latches for readout and trigger are the same, the paths from the latches to the trigger logic and boards for readout should be produced. Characteristics of the media (cables/bus,etc) which carry signals should be identified as well as whether the signals are differential, high level or low level, etc.
* A refined estimate of the number of links and the bandwidth should be produced.
* For reasons of reliability, consideration should be given to minimizing the amount of complicated readout logic on the chamber where access may be difficult.
* What are the plans for distribution of the clock, L1A, BCR & Event counter resets, etc?
* What are the plans for downloading of the thresholds and other front end "parameters" which may exist?

### Trigger Generation

The actual formation of the trigger primitives was not discussed, which is appropriate as this lies primarily in the domain of the trigger group. However, a few issues involving the trigger are related to the electronics readout and control.

**Comments and Questions:**

* Is one considering to readout any "trigger primitives", i.e. intermediate results from the trigger processing? If so, which ones and what is the readout path?
* Does one plan to download data to front-end latches to enable testing of the trigger system?
* How does one plan to "time-in" and monitor the front end and trigger system?

### Muon Drift Tubes (MDT's)

#### General

A rather detailed presentation of the signal processing for the MDT's was presented along with options for the event readout: leading edge (required), trailing edge to identify beam crossing of interest (accuracy about 1-2 crossings), charge for correction of time-walk effects, and faster tail cancellation to enable better double-pulse resolution. While with the faster double pulse resolution one can identify a second hit approximately 80% of the time, this option is not likely to be included because of the added cost (another TDC channel is required) and the implication of early studies that the information may be of limited use. It is planned to include on the 8 ch ASD a remotely selectable option to have the trailing edge of the pulse identify the end of the primary ionization (bunch crossing identification) or provide information on the charge of the pulse. Including information on the charge of the pulse may provide significantly improved resolution if the threshold has to be set higher than initially expected. Effectively, it results in the position resolution being almost independent of the threshold and the shaping time over significant variations.

Rather detailed presentations of the design goals and status of the prototype ASD and TDC chips were presented. For the barrel MDT's, rather careful consideration has been given to the number of readout links required, given the assumption of 80 MHz links, and to the number of RODS. Up to four TDC's can be daisy chained on the same link. It is found that a factor of 5 safety concerning the background (i.e. allowing for the background counting rate to be 5 times higher than estimated) can be included without significantly increasing the number of front end links or RODS. For the endcap region a similar analysis has yet to be applied, but should be straightforward. Prototype cables and protocols for the FElinks were presented but no commitment has been made. It is envisioned to use JTAG for testing of the front end chips, front end boards, and ROD's and for downloading of the parameters to the front end chips (about 40 bits/ASD). Consideration is given to having redundant JTAG lines.

#### Front End Signal Processing

A four channel chip with preamplifier, shaper, and discriminator has been developed in CMOS. The input impedance, noise, and gain match well with what was simulated. The shaping time is selectable, as is the gain. The discriminator walk (time variation with amplitude of squarepulse) is shown to be negligible and the time slewing (time variation with amplitude of chamber pulse) is shown to be acceptable for achievable thresholds. However, the time walk can be further reduced, especially for larger thresholds and longer risetimes, by including a charge measurement, and it is planned to include this capability in future versions. Cancellation of the tail due to ion drift will also be included in the next version. The outputs will be low level differential (LVDS) and a differential preamplifier with an external "dummy" input trace is used for added noise immunity. It is expected that the final chip will be between \(5\times 5\) and \(6\times 6\,\mathrm{mm}^{2}\). A complication is that the process which is currently being used (HP 1.2micron) will be discontinued within a couple of years. Several other processes, e.g. the Harris Linear CMOS and the HP 0.5 micron process (which includes floating capacitors) are being considered. The final production prototype, in a new process, is scheduled for the end of 1998.

**Comments and Questions:**

* Overall the development of the ASD looks promising, although as noted by the designers the tail cancellation, ADC, and a few other "bells and whistles" have still to be included. There should not be a difficulty finishing the development according to the nominal schedule, although the necessity to switch to a new process does not leave much "extra" time.
* It was not clear whether the sensitivity of the chip parameters (gain, shaping time, etc.) to process variations had been investigated. If not, that should be done (although the inclusion of programmable gain and shaping time clearly provides considerable protection against any variation).
* It would be useful to measure the performance of the prototype chip connected to a chamber as soon as reasonable. (It is our understanding that this will happen soon.)
* The appropriate time for the charge measurement, i.e. the "rundown time" for the measurement should be investigated. It may have some impact on the overall deadtime, although perhaps not large.

### Time Measurement

The design of the TDC is well advanced both in terms of the timing resolution and in terms of the on-chip buffering, depth of memory required, deadtime as a function of output bandwidth, etc. The chip buffers L1Accept signals to minimize deadtime and handles overlapping triggerswithin the drift time of the muon chambers. In a simulation of \(10^{6}\) hits, not a single hit was last due to full buffers and not a single trigger was "missed". The issues of buffer overflow have been addressed with some care. The outputs will be LVDS and up to four TDC's can be daisy chained together for readout on a single link. Consideration is being given to how to bypass a bad chip. A JTAG interface will be included for testing and downloading of information. The power dissipation is about 10 mW per channel and the present chip size is about 32-35 mm\({}^{2}\).

Prototypes which include much of the final functionality have been produced and tested. A behavioural model of the final version exists; a simulation at the register level will be accomplished in the near future. It is planned that the chip will be fabricated in a 0.3 micron gate-array process. Production of the final chips would take place in 2000-2002.

**Comments and Questions:**

* The only significant concern had to do with the production schedule. It seems to be inconsistent with the desire to mount electronics on the muon chambers as they are constructed and seems significantly slower than is technically possible given the advanced state of the design. If the muon group is firm in its desire to mount electronics on the chambers as they are produced, they should seriously consider advancing the schedule for producing the TDC's by at least a year.

### Readout

As noted in the general introduction, the plans for readout of the MDT's, at least in the barrel region, are reasonably well outlined. The plan for the number of FE data links, the number of TDC's per link, and the mapping of FE links to ROD's seems well considered. However, there are a number of issues that arose.

**Comments and Questions:**

* The plan to pass DCS control through the high-bandwidth VME crate should perhaps be re-evaluated. A more robust control system might result from not passing commands for HV control across the same backplane as may be used for monitoring events.
* Selection of a commercial protocol such as JTAG for downloading information to the front end chips is a reasonable choice; however careful consideration should be given to the noise immunity since noise on control lines could weak havoc (this has been observed in some experiments).

* If JTAG controls all the channels on a chamber, then redundant JTAG buses, as proposed, is probably warranted.
* If one encodes the Level 1 accept, Bunch Counter Reset, and Event Counter Reset on the same line, then one must evaluate whether these signals can ever occur at the same time (can the Trigger Processor ensure that this never happens at all places in the detector?)
* We encourage the NIMROD designers to consider some capability for on-line monitoring of the data at that level.

### CSC Chambers

#### General

The CSC chambers are located at very large rapidity to handle the very high rates. Strips of small size (e.g. 5 mm width) are used to minimize the rate/strip and hence occupancy. With excellent signal-to-noise, it is possible to achieve position resolutions of 50 microns.

#### Front End Signal Processing

Prototype results were shown (from measurements on similar chambers developed for the GEM experiment) indicating that 50 micron resolutions can be achieved for strips of \(C_{d}\) approximately 150 pF and with measurement times of order 300-400 nsec. This can be obtained for strips of length up to nearly 3m and with a gas gain of order \(4\times 10^{4}\). The test results were obtained with a JFET front end to the AMPLEX chip. A custom 8 channel chip was developed for GEM to match the 150 pF detector capacitance and with a shaping time of 200nsec. It included programmable gain and shaping and was about \(4.8\times 5.3\,\mathrm{mm}^{2}\).

Due to the higher rates at ATLAS, the ATLAS version will require a shaping time of about 100 nsec and either an analog memory (asynchronous sampling of the shaped waveform) or a several deep sample-&-hold (single sampling at the peak driven by a discriminator signal). If the first approach is used, the SCA being developed for the Liquid Argon calorimeter could probably be utilized. Design and simulation is beginning using the HP 0.5 micron process.

**Comments and Questions:**

* There seems to be no reason that the objectives cannot be realized. However, it is clear that quite a lot of development needs to be done still on an ATLAS version (thedesigners are aware of this).

### Readout

Relatively little detailed information on the readout was presented. However assuming the SCA approach with 10 samples per hit results in an estimated data rate of about 72 Mbits/sec per chamber. Given 32 chambers per endcap, the total data rate per endcap is about 2.3 Gigabits/sec. Thus from a bandwidth point-of-view, only about 4 RODS per endcap would be necessary. More careful consideration of the number of links per chamber might result in a somewhat larger number, but in any event only a very modest number of ROD's is likely to be required.

**Comments and Questions:**

* The overall readout needs to be thought through in more detail. While the total number of channels is not very large, 50,000 channels of a system using SCA's is not small. For example, it is 1/4 the size of the Liquid Argon, although of course the required dynamic range is less.
* If used, where would the SCA's be located? Where would ADC's be located?
* Has the cost of the SCA chips been allowed for?
* What is the architecture for collecting the data? What would be the transmission media and voltage levels for the FE links to the ROD's?
* Where would the RODS be located?