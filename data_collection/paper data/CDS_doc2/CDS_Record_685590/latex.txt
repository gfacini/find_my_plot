**ATLAS Internal Note**

**MUON - NO - xxx**

**25 August 1997**

**Comparison between the RASNIK**

**analysis programs**

P. Oberson \({}^{\rm a}\), K. Hashemi \({}^{\rm b}\), S. Gentile \({}^{\rm a}\)

Dipartimento di Fisica, Universita \(\ll\) La Sapienza \(\gg\) and INFN, Roma, Italy

University of Brandeis, Brandeis, Massachussetts, USA

May 1997

**Abstract**

The in-plane alignment of the first full-scale BIL MDT chamber prototype ("Calypso") was provided by four RASNIK-CCD systems. Tests have been made to determine the RASNIK resolution in monitoring the relative position of its pieces.

Three programs have been written to analyse the RASNIK images. The results obtained with these three programs on a large sample of images have been compared. The three programs agree to within less than 2 \(\upmu\)m.

**1. Introduction**

The in-plane alignment of the MDTs must be able to monitor the chamber deformations with an accuracy of less than 10 \(\upmu\)m. These movements are deduced from the movements of the chamber cross-plates which is measured with RASNIK-CCD systems \({}^{\rm[1]}\). This note presents the in-plane alignment system of the first full-scale BIL MDT prototype \({}^{\rm[2]}\) and its performance.

Three programs were written to process the RASNIK images, each of which was designed to satisfy to different constraints. The first one was written in FORTRAN \({}^{\rm[3]}\) and uses a fitting procedure to determine the cross-plate movement. The second one was written in PASCAL \({}^{\rm[4]}\) on Macintosh computers. It uses the steepest ascent algorithm. This program has been rewritten inC++. The third program was written in C [5] and, like the first one, performs a fit. All three were used to analyse two samples of images - 2780 sharp images and 390 blurred images - in order to compare their performances. The results of the comparison is presented in SS3.

## 2 The in-plane alignment

The in-plane alignment is provided by four RASNIKs (Fig. 1). The two RASNIKs on each side of the chamber, the light rays of which are labeled 1 and 4 on Fig. 1, are parallel to the tubes. The two central RASNIKs (light rays 2 and 3 on Fig. 1) make an angle of \(\pm\,55.2\) mrad with the tubes.

The RASNIK elements are mounted on supports that are screwed to the cross-plates. The exact position of each pieces on the cross-plate is shown in Fig 2. Each RASNIK instrument consists of a mask, a lens and a CCD camera. The mask is a piece of glass of size \(2.5\times 2.5\) cm\({}^{2}\) on which a chessboard is printed. The mask pitch (size of the squares) has been measured to be \(120\pm 0.02\) um [6]. The chessboard contains horizontal and vertical coded lines, i.e. lines in which squares are inverted [1]. This mask is backlit by nine infrared lamps arranged in three rows of three lamps. The central lenses are bi-convex lenses with a focal length of 640 mm. The CCD cameras are miniature video cameras. The pixel size is 8.5 um. The cameras are read by an ISA PC card called a framegraber. They deliver a continuous signal which is sampled 768 times by the framegraber and send a synchronization signal at the end of each line. Therefore, the horizontal pixel size is slightly different from the real pixel size. The program that controls the card displays the image on the screen of the PC and allows the displayed image to be saved on the hard disk.

For each measurement, each RASNIK is turned on and a given number of pictures is taken and recorded on the PC hard disk. The cameras have to be turned on for at least five minutes before one begins to take the pictures because the measurement is unstable during that time. A RASNIK measurement consists of recording between 10 and 100 images on disk with each RASNIK. The pictures are then analysed with one of the three programs that are available (see SS 3). Each program is able to determine the horizontal and vertical positions of the lens, the tilt of the mask with respect to the optical axis of the RASNIK and the size of the mask squares.

### Adjustment of the RASNIK length

The four lenses that were mounted on "Calypso" were manufactured in Protvino. Their focal length is 640 mm \(\pm\) 2 mm. From the positions given in Fig. 3, we can determine that the total length of the RASNIK 2 and 3 is 2563.91 mm, i.e. 3.91 mm bigger than the distance between the two external cross-plates.

\begin{table}
\begin{tabular}{|c|c|} \hline RASNIK & Size of the small spacers \\ \hline
1 & 10 mm \\ \hline
2 & 7 mm \\ \hline
3 & 3 mm \\ \hline
4 & 5 mm \\ \hline \end{tabular}
\end{table}
Table 1: Size of the extra small spacers that had to be added between the mask supports and their cross-plates.

The length of each RASNIK line (distance between the external cross-plates) was measured to be 2560 mm for the RASNIKs 1 and 4 and 2564 mm for the RASNIKs 2 and 3. However, the front of the cameras and masks does not correspond to the front of the cross-plates, as shown on Fig. 3. The distance difference between the front surface of the masks and cameras and the surface of the cross-plates had to be taken into account. This led to the addition of an extra spacer between the supports and the cross-plates as shown on Fig. 3 so as to ensure that the distance camera-lens and lens-masks is twice the focal length of the lenses, i.e. 1280 mm. The size of that spacer is 35 mm between the camera supports and their cross-plate and 11 mm between the mask supports and their cross-plate.

This proved to be insufficient as with this set-up, the pictures recorded with all four RASNIK systems were blurred. The position of each mask had to be adjusted a second time using small spacers in order to get sharp pictures. The size of these small spacers is given in Table 1. The biggest difference between the small spacers sizes is 7 mm, i.e. less than 3 %o of the total RASNIK length. This lies within the precision of the lenses given by the manufacturer.

### RASNIK resolution

The study of the RASNIK resolution was made using a demo-kit in which elements were fixed on supports that were mounted on a rail. The focal length of the lens used with the demo-kit was 200 mm. The support of the lens contained three micrometric screws that allowed us to move the lens horizontally and vertically perpendicular to the optical axis and along the optical axis. These three directions will be referred to later in the text as x, y and z respectively. The range of the micrometric screws is 15 mm and their precision is \(\pm\)5 \(\upmu\)m (half the distance between two marks on the screw).

A series of tests was made to determine the RASNIK accuracy in reconstructing a movement of the lens in x and y directions. The procedure was the following: a reference position was choosen and five pictures were recorded. Then the lens was moved from -200 \(\upmu\)m to +200 \(\upmu\)m with respect to that reference position in x or y by steps of 100 \(\upmu\)m and five pictures were recorded at each step. Finally the lens was brought back to the reference position and five pictures were recorded. The two measurements in x and y were done one after the other. The NIKHEF program was used to analyse the pictures. The upper plots in Fig. 4 shows the reconstructed positions in x and y versus the position of the lens around the reference position. The lines are the result of a fit made on the seven points. The lower plots in Fig. 4 show the distribution of the residuals with respect to the fitted lines. The r.m.s. for the x direction - 0.9 \(\upmu\)m - is slightly better than what we would expect from the micrometric screw precision, which is 1.9 \(\upmu\)m.

A similar test was made to determine the RASNIK resolution in the z direction. This was done using another analog system to measure the displacement of the lens in the z-direction. This system was a pressure sensitive gauge with an analog display that had a precision of the order of 1 \(\upmu\)m. The procedure was identical as the one described above to test the RASNIK accuracy in measuring displacements in x and y directions, but the steps were of 50 \(\upmu\)m: the lens was moved around a reference position from -100 \(\upmu\)m to +100 \(\upmu\)m by steps of 50 \(\upmu\)m. At each step, 25 pictures were recorded. The NIKHEF program was used to analyse these pictures too. The distribution of the reconstructed z position is shown on Fig. 5. The center of gravity of each of the five peaks has been determined by a gaussian fit. The displacements measured with the RASNIK are compared with the one measured using the gauge in Table 2. The r.m.s. of the differences between the measurement of the gauge and the one of the RASNIK is \(\sim\)3 \(\upmu\)m, which is slightly better than what we expect from the resolution in the z direction from Fig. 9 (14 \(\upmu\)m for a RASNIK of 2.56 m, i.e. 4.4 \(\upmu\)m for the RASNIK of the demo-kit which was 0.8 m long).

Fig. 6 shows the distribution of the reconstructed x and y positions, square width and rotation angle of the mask around the z axis for 100 pictures taken in the same conditions for one of the four RASNIK systems that were mounted on "Calypso". The pictures were analysed with the C\(++\) version of the Brandeis program. We can see that the RASNIK resolution for the x and y position determination is less than 1 \(\upmu\)m.

### The RASNIK stability

From measurements made with the RASNIK systems mounted on the BIL MDT prototype "Calypso", it was noted that the reconstructed value for the x and y position could vary with time. This is shown on Fig. 7 for two of the RASNIKs. We clearly see that the reconstructed position increases or decreases with time (upper plots on Fig. 7), changes by a step of \(\sim\)2 \(\upmu\)m during the data taking (lower left plot on Fig. 7, after the sudden change of the reconstructed value2) or changes by a few \(\upmu\)m for a short period of time of about 1 minute (double peak structure seen on the lower right plot of Fig. 7). These effects are still not understood. The first explanation was that the RASNIK systems had to be warmed for 5 to 10 minutes before recording the pictures in order to allow for the stabilization of the temperature of the CCD camera and the mask. This pre-warming stage decreased the rate of appearance of such a drift of the reconstructed values, but did not make it disappear.

Footnote 2: The sudden change of the reconstructed value by \(\sim\)6 \(\upmu\)m shown in Fig. 9 indicates that after \(\sim\)300 s of peiture recording, there is some unknown effect taking place that is responsible for the jump. In this case, the \(\sim\)30 first measurements should be rejected for the analysis as the conditions are still unstable.

## 3 Comparison between the analysis programs

There are three analysis programs avalaible to process the RASNIK pictures. The first one is a FORTRAN program written by Frank Linde of NIKHEF[3]. This program searches for the horizontal and vertical transition lines between white and black squares and performs a fit to determine the x, y and z position of the lens, and the three rotation angles \(\alpha_{\rm x}\), \(\alpha_{\rm y}\) and \(\alpha_{\rm z}\) of the mask around the three axis.

The second program has been written by Kevan Hashemi of the Brandeis University[4] and translated in C\(++\) by Pierre Oberson. It is based on the steepest ascent algorithm and optimizes with

\begin{table}
\begin{tabular}{|c|c|c|} \hline \multicolumn{3}{|c|}{Displacement measured with:} & \\ \hline RASNIK [\(\upmu\)m] & Gauge [\(\upmu\)m] & Difference [\(\upmu\)m] \\ \hline
52.7 & 47.5 & \(+\)5.2 \\
50.5 & 53.0 & \(-\)2.5 \\
45.7 & 44.5 & \(+\)1.2 \\
45.9 & 47.0 & \(-\)1.1 \\ \hline \end{tabular}
\end{table}
Table 2: Comparison of the displacement of the lens in the z-direction measured with the RASNIK with the one measured with an analog gauge.

an iterative procedure the parameters of a chessboard until it matches the actual image. At each iteration, the parameters are modified by a small value that we call the "step size". The parameters are the x and y coordinates of the chessboard origin, the chessboard square sizes in x and y directions and the chessboard rotation around the z axis. The optimization is done in four stages. In the first stage, the optimization is done on only a small portion of the picture in order to get a first "rough" value of the parameters. In the second stage, the optimization area is increased and the step is smaller. In the third stage, the optimization is done on the border of the picture so as to have the biggest possible lever arm to determine the rotation of the mask around the z axis. In the fourth stage, the optimization surface does not change but the step size is very small. At each iteration, a quality factor is computed that compares the chessboard defined by the five parameters with the picture. At each stage, the algorithm has converged once the \(\sigma\) of the five last values of the quality factor has become lower than a given value, or, in other words, once the small variations of the parameters does not change the match between the computed chessboard and the picture. Once the algorithm has converged in the last stage, it is possible to make up to 100 iterations and keep the successive results so as to have a better estimate of the value of the parameters. The reconstructed parameters are the x and y positions of the mask, the rotation angle around the z axis and the size of the mask squares in both x and y directions. Fig. 8 shows the distribution of the reconstructed values for these parameters for 100 analysis of one file.

The second program has been written in C by Stefan Schael from MPI. This program is extensively described in [5]. It provides a measurement of the x and y positions, the rotation angle around the z axis and the magnification, i.e. the ratio between the reconstructed size of the mask squares and their original size.

These three programs have been used to analyze a sample of 2780 sharp pictures and 390 blurred pictures recorded with the four RASNIK systems that have been mounted on "Calypso" [1]. They were compared in terms of processing speed, reconstruction resolution and ability to analyze blurred images. The programs will be referred to later in the text as the NIKHEF, the MPI and the Brandeis program.

### Processing speed

All the pictures have been analysed on a cluster of 16 IBM workstations running the UNIX AIX operating system. The analysis was done in batch mode and each batch job was allocated one of the computer of the cluster and no other job could be run on that computer.

\begin{table}
\begin{tabular}{|c|c|c|c|c|} \hline Program & Total time for & \multicolumn{2}{c|}{Time per image} & Fraction of \\ \cline{3-5}  & 3170 images & Real time & CPU time & CPU time \\ \hline Brandeis & 29542.s & 9.3 s & 8.7 s & 92.9 \% \\ \hline NIKHEF & 53699 s & 16.9 s & 9.7 s & 57.2 \% \\ \hline MPI & 56356 s & 17.8 s & 17.4 s & 97.7 \% \\ \hline \end{tabular}
\end{table}
Table 3: Total time taken for the processing of 3170 images, mean real and CPU time needed for the processing of one image and fraction of the CPU time used by each RASNIK analysis program.

[MISSING_PAGE_EMPTY:6]

program. Since then, this program has been improved and now it is able to analyse the blurred images it could not process a few months earlier.

The MPI and Brandeis programs have always been able to analyse blurred images. We have compared the ability of the three programs to analyse blurred images on a sample of 390 pictures. The biggest z-range covered by these images is 9 mm.

Fig. 13 shows the same comparison between the results obtained with the three programs as the one shown in Fig. 11. Again, the two upper and lower plots show that, though the width of the difference distributions is greater for blurred images - \(\sim\)1.4 \(\mu\)m - all three programs are equivalent.

## 4 Conclusions

The RASNIK system is well designed for the in-plane alignment. Its precision in determining a displacement of the central cross-plate of a MDT is less than 1 \(\mu\)m. It is possible that the length of each RASNIK system has to be adjusted in order to get sharp images, but we believe this is unnecessary as all the analysis programs avalaible are able to process blurred images.

A comparison between the analysis programs of Brandeis, NIKHEF and MPI shows that:

1. the C++ version of the Brandeis program is the fastest of the three;
2. all three programs are equivalent for determining the displacement of the central cross-plate;
3. all three programs are able to analyse blurred images and are equivalent too in this case.

## Acknowledgements

One of us (P. Oberson) would like to thank the Swiss National Fund for supporting and financing his work.

## References

* [1] C. H. Daly, G. De Zorzi, P. Oberson, Mechanical and thermal tests on the BIL MDT chamber prototype "Calypso", ATLAS Internal Note MUON-NO-144, March 1996.
* [2] A. Biscossa et al., The First Full-Scale Prototype of a BIL MDT Chamber for the ATLAS Muon Spectrometer, ATLAS Internal Note MUON-NO-136, January 1996.
* [3] H. L. Groenstege, The coding of the mask for CCD_Rasnik, NIKHEF ETR_94-10, 1994.
* [4] K. S..Hashemi, J. Bensinger, RASNIK Image Processing with a Steepest Ascent Algorithm, ATLAS Internal Note MUON-NO-92, September 1995.
* A Program to Analyze RASNIK Images, ATLAS Internal Note MUON-NO-172, May 1997.
* [6] H. Van de Graaf, private communication.