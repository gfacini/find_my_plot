# Performance of the First Version of VMM Front-End ASIC with Resistive Micromegas Detectors

T. Alexopoulos

National Technical University of Athens

G. Iakovidis

S. Leontsinis

K. Niekas

V. Polychronakos

Brookhaven National Laboratory

J. Wotschack

CERN

###### Abstract

This note describes the performance of the first version of a front end ASIC, VMM1, being developed for the Micromegas and sTGC detectors of the ATLAS New Small Wheel (NSW) upgrade. The VMM1 ASIC was designed by the micro-electronics group of the Instrumentation Division of Brookhaven National Laboratory. It contains 64-channels of linear, low noise amplifiers with adaptive feedback, charge amplitude peak detectors with time stamp. It can accept inputs of both polarities, features selectable gain and shaping time and has a built-in calibration system. It is designed to operate with micro-pattern gas detectors providing both trigger and tracking information. The VMM1 was tested during August 2012 test beam campaign at SPS/H6 beam line at CERN using micromegas detectors of the Muon ATLAS MicroMega Activity R&D program. We present here the VMM1 configuration, the software that was developed to achieve its operation, as well as the calibration procedure. Furthermore, we present the analysis performed with the micromegas detectors using the VMM1, reconstructing a charged particle hit in the \(\upmu\)TPC and centroid mode. Finally, various trigger studies were performed using the VMM1 trigger functionality.

###### Contents

* 1 Experimental Setup
* 2 Software
	* 2.1 Data Format
	* 2.2 Controlling and Configuring the VMM1
* 3 Calibration
	* 3.1 Threshold Calibration
	* 3.2 Channel Trimming
	* 3.3 Peak Detector Output Calibration
	* 3.4 Electronic Cross-talk
	* 3.5 Time Detector Output Calibration
* 4 Analysis
	* 4.1 Perpendicular Track Analysis
	* 4.2 \(\upmu\)TPC Analysis
		* 4.2.1 Cluster Filtering with Hough Transform
		* 4.2.2 Timing Extraction
		* 4.2.3 Hit Errors Calculation and Assignment
		* 4.2.4 Resolution
	* 4.3 Trigger Analysis
* Hough Transform Analysis Technique * A.1 Radon Transform definition * A.2 Hough Transform
* B Micromegas Setup at SPS/H6

## Introduction

VMM1[1] is a first prototype ASIC designed for the New Small Wheel [2] (NSW) upgrade of the ATLAS Muon Spectrometer. It is designed to be used with both the micromegas [3] and sTGC detectors of the NSW upgrade. Fabricated in the IBM_8RF_DM_8LM 130 nm CMOS process it features 64 channels, each providing low noise charge amplification, shaping with baseline stabilization, discrimination with trimming, peak/timing measurement. Furthermore it integrates a pulse generator and signal multiplexers. The address of the channel with the earliest time with respect to the trigger, the Address in Real Time (ART), or the direct timing outputs are also available and will be used for triggering with the micromegas or sTGC detectors. The trigger concept using the channel with the earliest signal was chosen for the micromegas detectors resulting to 30 k of trigger channels instead of 2 M. The concept takes advantage of the strip pitch granularity of 400 \(\upmu\)m. A total of 16 VMM1s were tested with resistive micromegas prototypes constructed at CERN by the MAMMA R&D program.

A block diagram of the VMM1 [1] can be seen in Figure 1. VMM1 contains only the analog part while the digitizers will be added in the next generation. VMM1 utilizes a charge amplifier (CA) and a third-order shaper designed in delayed dissipative feedback (DDF) [4]. A discriminator with a sub-hysteresis feature is employed. An event is detected when a signal crosses a set threshold. The discriminator triggers a peak detection circuit which, once the peak is find, triggers a Time to Amplitude converter (TAC). The resulting peak amplitude and time stamp, PD, TD, are stored in analog multiplexers queued to be read out. The Time-to-Amplitude-Converter (TAC) consists of a voltage ramp that starts at the peak-found pulse and stops at a signal controlled by the data acquisition system. When a first signal exceeding the threshold or, optionally, when a first peak is found, a flag is asserted and the address of the corresponding channel (ART) is made available at six dedicated digital outputs.

Figure 1: VMM architecture. VMM1 integrates only the analog circuitry contained in the dashed line frame. The digitization part show in the figure will be added to the next generation of the VMM.

Experimental Setup

The experimental setup consisted of eight identical 10\(\times\)10 cm\({}^{2}\) resistive strip micromegas prototypes with 1D readout [5][6]. The detector characteristics are shown in the Table 1. They were operated with the drift high voltage at -300 V and an amplification high voltage, applied to the resistive strips, of 540 V while the mesh was kept to the ground. A detailed schematics of the setup can be seen in Appendix B.

All micromegas detectors were mounted on a special frame that allows them to be rotated with respect to the beam axis. Each chamber was equipped with two VMM1s which allows 128 micromegas channels to be readout. Some of the main VMM1 features are shown in Table 2.

Since the first prototype does not integrate the digitizers but only the analog part, each VMM1 was connected to a digitizer board called CDAQ[9] developed at BNL. The connection was implemented through a LVDS signal translation board, developed in Arizona. All the 16 CDAQ boards were connected to a gigabit switch through a network interface developed at Harvard University. The trigger signal was provided by a scintillator coincidence (Appendix B) and was fed into an evaluation FPGA board (trigger board), that distributed the trigger signal to each CDAQ board. Upon receipt of a trigger, a data packet is transmitted from the trigger board containing the ART from the VMM1 cards that had an event. A schematic view of the electronics setup is shown in Figure 2 while a photo of the setup is shown in Figure 3.

\begin{table}
\begin{tabular}{|l|c|} \hline Readout & 1D \\ \hline Dimensions & 10\(\times\)10 cm\({}^{2}\) \\ \hline Strip Pitch & 400 \(\upmu\)m \\ \hline Strip Width & 300 \(\upmu\)m \\ \hline Gas Micture & Ar:CO\({}_{2}\) 93:7 \\ \hline Drift Gap & 5 mm \\ \hline Amplification Gap & 128 \(\upmu\)m \\ \hline Amplification Field & up to 43 kV/cm \\ \hline Drift Field & 600 V/cm \\ \hline Resistive Strips & 20 M\(\Omega\)/cm \\ \hline Gas Gain & up to \(2\times 10^{4}\) \\ \hline \end{tabular}
\end{table}
Table 1: Micromegas detector characteristics and operating conditions.

\begin{table}
\begin{tabular}{|l|c|} \hline Technology & 130-nm \\ \hline Channels & 64 \\ \hline Gain & 1,3,9 mV/fC \\ \hline Peaking time & 25, 50, 100, 200 ns \\ \hline Pulse generator & 10-bit adjustable, 1mV \\ \hline Configuration & 1072-bits \\ \hline ART & Address in Real Time \\ \hline Time to Amplitude Converter & 125 ns - 1 \(\upmu\)s \\ \hline \end{tabular}
\end{table}
Table 2: VMM1 ASIC Main Features.

Figure 2: Schematic representation of VMM1 readout in H6 test beam setup.

## 2 Software

### Data Format

The VMM1 provides trigger and tracking information. The tracking data readout was implemented using the UDP protocol while for the trigger the TCP protocol was used. Both of them are based on 32-bit packet transfer.

For the tracking data multiple 32-bit packets are transmitted. The first 32-bit packet contains the event trigger counter used for event building. All the 16 CDAQ boards were synchronized by an external trigger signal, transmitted from the trigger board. The word "BNL" in hex 32-bit followed used for identification in case of multiplexed readout with other systems. The third 32-bit packet identified the CDAQ board from where the packet was coming from. Each CDAQ had a unique identification number which was configurable. After the three 32-bit packets, the tracking data follow. VMM1 sends out a

Figure 3: Experimental Setup in H6 beam line on July - December 2012. The eight micromegas detectors are mounted on the lower frame equipped with two VMM1s each. The total 16 VMM1s are connected to the 16 CDAQ digitizers on the top crate. All the CDAQ digitizers are connected to the gigabit ethernet switch and they are read out from the DAQ/DCS PC located in the control room.

32-bit packet, for each channel that has a signal, in which the first 6-bit identify the channel address, the next 13-bit the time and the rest 13-bit the amplitude. The tracking data format is shown in Table 3.

The trigger data from the trigger board have a fixed length of 15\(\times\)32-bit packets. Each pair of VMM1 sitting in the same detector, sends a 32-bit word containing information of the ART and the time generated by the trigger board by a clock running at 200 MHz. The trigger data packet format is shown in table 4. The trigger data are recorded in order to be compared with the tracking data offline.

### Controlling and Configuring the VMM1

A DAQ-DCS system (VMMDCS) was developed in close contact with the firmware developers of the CDAQ[9], LX9[14] interface and the trigger board[15]. It provides a friendly Graphical User Interface (GUI). It can configure the VMM1 through the CDAQ, as well as the LX9 and the trigger board registers

\begin{table}
\begin{tabular}{|l|l|l|l|} \hline \multicolumn{4}{|l|}{**Data Packet:**} \\ \hline \hline \multicolumn{2}{|l|}{LWord} & Field & Bias & Function \\ \hline
0 & Frame Counter & 31:0 & Trigger count \\ \hline
1 & SRS Data Header & 31:24 & [0x04C] \\ \cline{3-4}  & & 23:16 & N(0x4B) \\ \cline{3-4}  & & 27:24 & [0x042] \\ \hline
2 & SRS Header Info & 31:24 & Board ID (0x1) \\ \cline{3-4}  & & 23:16 & 0 \\ \cline{3-4}  & & 15:8 & 0 \\ \hline
3:10 & FA Data (Right) & 31:24 & Fast Flag to Trigger Time Counter \\ \cline{3-4}  & & 23: & Fast Flag \\ \cline{3-4}  & & 22: & 0 \\ \cline{3-4}  & & 22:16 & Fast Address \\ \cline{3-4}  & & FA Data (Left) & 15:8 & Fast Flag to Trigger Time Counter \\ \cline{3-4}  & & 7 & Fast Flag \\ \cline{3-4}  & & 6 & 0 \\ \hline
11 & Linear Fit & 31.0 & Currently 0 \\ \hline
12 & Linear Fit Quality & 31.0 & Currently 0 \\ \hline
13 & Reserved & 31.0 & Currently 0 \\ \hline
14 & End Of Data & 31.0 & [0x04444] \\ \hline \end{tabular}
\end{table}
Table 4: Table showing the trigger data format for the VMM1 ART readout.

.It features an event building mechanism based on trigger event counter. A screen shot of the software GUI is shown in Figure 4.

To ensure the proper VMM1 configuration, because of the UDP protocol nature, a send-reply mechanism was implemented in the CDAQ firmware meaning that a confirmation packet was received for each packet send. In case of any problems, mismatches or packet loss an error is received. The configuration protocol is shown in Figure 5. In order to distinguish different hardware types that the configuration packet is for, a unique configuration UDP port is assigned for each piece of hardware.

Figure 4: VMMDCS software developed for the controll and readout of the VMM1.

Figure 5: Configuration protocol format[9].

The GUI is segmented in 5 sections. Each section functionality is described in the following paragraphs.

Fec-Lx9 ControlIn this section of the GUI the communication with the CDAQ through LX9 card is established. There are several configurations that can be performed like configuring the trigger input, the data acquisition mode as well as the sampling of the analog output pulse from the VMM1. The configuration can be sent to all CDAQ cards or to any individual one. Reading back the registries that have been configured is also possible from here. To configure one VMM1, a 1072-bit configuration is downloaded in 34\(\times\)32-bit registers of the CDAQ followed by some control commands. Two 32-bit packets of the total 1072-bit, are used for the global VMM1 configuration and the rest 1024-bits are used to configure the 64 channels. Each channel has a 16-bit configuration and due to 32-bit protocol, two channel configurations are combined into one 32-bit packet. The internal pulse generator can also be enabled in this section as well as sending reset commands. In the Data Header section, a unique id is assigned to every CDAQ based on its IP address for event building. In the Detect-mode-time-edge section a special procedure for calibration purposes is implemented. This procedure is explained in detail in section 3.5.

Trigger FPGAIn this section of the GUI the communication with the trigger board is established. There are several registries that are configurable like the trigger counter reset, the trigger enable and the data readout. The trigger time window, in 5 ns units, can be also configured from here.

Global RegistersIn this section of the GUI all the global VMM1 registries are configured. Also calibration constants can be loaded from here.

VMM1 ChannelsIn this section each VMM1 channel, out of the total 64, can be configured individually. The polarity, multiplexer output, mask as well as the test pulser can be configured.

Run ControlThe run control section is used to control the data acquisition process. The writing of the trigger data in the Root[13] file can be enabled from here as well. There are two modes of data taking. In the physics data taking events are build based on the trigger event counter which is embedded in the trigger and tracking data. The second mode is the calibration mode where the trigger counter is always zero.

## 3 Calibration

The VMM1 provides charge and time measurements. Micromegas chambers can be used to measure a particle hit position with the centroid or the \(\upmu\)TPC mode depending on the particle incident angle. In the first mode the channel gain and the pedestal should be known with accuracy while for the latter, the time of each strip signal with high time resolution is needed. To achieve the best performance in both modes each channel's pedestal, gain and TAC was calibrated. This was done using the integrated inside VMM1 pulse generator. Furthermore, channel thresholds were calibrated accurately to enable triggering on low amplitude signals.

### Threshold Calibration

Each VMM1 can be set to a preferable threshold. In order to trigger at very low thresholds above the pedestal, all the 16 VMM1s were calibrated. Figure 6 shows threshold in mV (measured on the oscilloscope), versus the actual VMM1 setting in DAC counts. In this figure the spread of the measured thresholds is increasing as a function of threshold set for the various VMM1 boards. For this reason, a specific threshold value was used for each VMM1.

### Channel Trimming

The threshold inherently has some channel-to-channel variation. To ensure the discriminator fires at the same threshold for all channels, a threshold trim was included in the VMM1. This allows thresholds equalization in a range of approximately 0-15 mV. Individual channel thresholds were measured by varying the input amplitude and counting the percent of signals recorded by the acquisition system. The turn-on curve (Figure 7 left plot) for each channel was fitted by a Fermi-Dirac function and the value at half maximum, \(p_{1}\), was taken as the channel threshold.

\[\text{FD}(x)=\frac{p_{0}}{\text{e}^{-(x-p_{1})/p_{2}}+1}\qquad p_{0},\ p_{1},\ p_{2},\text{ arbitrary constants}\]

The VMM1 channel to channel variation was at the level of 20-25 mV which makes the range of the individual trimmers not sufficient to bring the channels down to the same level. Furthermore as shown in Figure 7 (right plot), the range of the VMM1 trimmers, instead of a 15 mV range, had an average of 8 mV. This did not allow the threshold to be set as close as possible to the pedestal for each channel and will be fixed in the next VMM generation.

Figure 6: The threshold measurement of all the VMM1s as a function of the set value.

Figure 7: Left plot: The turn-on curves for 64 channels of a VMM1. Right plot: The measurement of the trimmer range for 25 channels of the VMM1.

### Peak Detector Output Calibration

The VMM1 features an internal multiplexer to drive the analog signals to a monitor output. Each channel uses the internal pulse generator that has 1024-bit adjustable over a 1.2 V range, along with a 1.2 pF internal input capacitor. The Peak Detector Output (PDO) response was measured for a range of input charges to extract the calibration constants for the gain and pedestal. Figure 8 shows an example of the gain measurement for the gain setting of 3 mV/fC.

Since the chambers were operated at \(2\times 10^{4}\) gas gain for this measurement, the higher electronics gain setting of 9 mV/fC was used and calibrated. On Figure 9 (right plot), the gain measurement for 1024 channels of 16 VMM1s is shown. A channel to channel gain drop was observed and was identified to be a voltage drop across the channels. This will be fixed in the next version of VMM. An average of 8.2 mV/fC was measured from all the VMM1. On the left plot of Figure 9 the pedestal measurement of 1024 channels of 16 VMM1s is shown.

The pedestal was measured with three techniques. The first measurement was done by linear fit on the gain curves. The second one was done by forcing the VMM1 to read the signal of the neighbour to pulsed channel even below the threshold. The third technique was by measuring the pedestals directly on a oscilloscope but due to large number of channels only some of them were measured and compared to the results of the other two techniques. The measurements with the three above techniques for one VMM1 is shown in Figure 10.

Figure 8: Channel gain measurement and pedestal extraction performing a linear fit, for gain setting of 3 mV/fC.

Figure 9: Left plot: Channel pedestal for 16 VMM1 channels as extracted from the gain curves. Right plot: The gain measurements of the 16 VMM1 channels for the setting of 9 mV/fC.

### Electronic Cross-talk

By enabling the internal pulser of one channel and forcing the VMM1 to read out the channel adjacent to the pulsed one (neighbour), we were able to measure the electronic cross-talk which is shown in Figure 11. For the full range of the integrated pulse generator an increase of 8 mV was measured.

### Time Detector Output Calibration

In VMM1, the time is measured by charging a capacitor from the time a peak is detected at a specific rate given by the TAC. This creates a ramp up slope which is not identical across the VMM1 channels. It is critical to calibrate the TAC charging rate for accurate time measurements. To do so, a special procedure was developed. In order to avoid all timing parasitics, such as time-walk and peak detection delay, the VMM1 was forced to be readout at a fixed time (\(t_{\mathrm{CS}}\)) in time bins of 25 ns, after the input charge injection time (\(t_{\mathrm{A}}\)). The procedure is shown in the left plot of Figure 12. For this measurement, 15\(\times\)25 ns time bins were used. The measured points are fitted with a line from which the TAC slope and the time detector output (TDO) pedestal are extracted. An example is shown in the right plot of Figure 12.

Figure 11: Electronic crosstalk measured by forcing the VMM1 to readout the neighbour to pulsed channel for the full range of the internal pulser.

Figure 10: Pedestal measurements with three techniques for 64 channels of VMM1. The blue markers showing the real pedestal measurements on the scope is systematically lower than the measurement through the gain curves and through the readout of the neighboring strip. This is expected since the last two methods use a charge injection on the channel while the scope measurement does not. Also there is a faulty gain fit on channel 37.

In Figure 13 the TDO pedestals (left plot) and the TAC slopes (right plot) for 64 channels of a VMM1 are shown. With the use of these values the timing information coming from VMM1 can be calibrated (each VMM1 has its own calibration constants).

## 4 Analysis

The electronics configuration used for the data analysis can be seen in Table 3. All the 16 VMM1 were calibrated according to the procedures explained in section 3. The chambers were studied in several angles with respect to the beam axis. The case of zero degree incidence is referred to as "Perpendicular Track Analysis" in which the position of a particle is reconstructed by the weighted average of the charge acquired by each strip. The "uTPC Analysis" is for the case of inclined tracks with respect to the detector planes. In this method the arrival time of the ionized electrons is measured with a time resolution of a few nanoseconds allowing the reconstruction of the particle position in the drift gap of the detector1.

Figure 12: Left plot: TDO measurement diagram. Right plot: TAC charging rate measurement.

Figure 13: Left plot: TDO pedestal measurement for 64 channels of a VMM1 ASIC. Right plot: TAC slope measurement for the same VMM1.

### Perpendicular Track Analysis

For the perpendicular track analysis the setup is shown in Figure 14.

A particle hit creates a footprint of 2-4 strips which can be easily clustered. By subtracting the position of the track in two chamber, reconstructed using the charge centroid method, the residual distribution is extracted as shown in Figure 15. The chambers were aligned offline first. The distributions are then fitted with a double Gaussian function to take into account the tails. From these distributions the convoluted resolution (no corrections for scattering, extrapolation error etc) can be computed with the use of the simple equation \(\sigma_{\mathrm{resolution}}=\sigma_{\mathrm{gauss}}/\sqrt{2}\) as the chambers were identical. A spatial resolution of \(\sim\)65 \(\upmu\)m has been measured similar to the measurements done with the APV25 ASIC [7][8].

In Figure 16 the cluster charge distribution of one chamber is shown. With the most probable value, MPV, at \(\sim\)350 mV, and gain of 8.5 mV/fC, we estimate the most probable number of primary electrons to be about 50 taking into account the ballistic deficit resulting from the 50 ns peaking time collecting about a quarter of the charge. This is in good agreement with Garfield[16] simulations and a detector gain of \(\sim 10^{4}\).

\begin{table}
\begin{tabular}{|l|c|} \hline \multicolumn{2}{|c|}{Electronics Configuration} \\ \hline VMM Gain & 9 mV/fC \\ \hline TAC & 500 ns \\ \hline Neighbour Readout & On \& Off \\ \hline Threshold & 5-20 mV above pedestal \\ \hline ADC Sampling & 8 times \\ \hline Trigger Time Window & 1275 ns \\ \hline Peaking time & 50-100 ns \\ \hline ART & Threshold-Peak \\ \hline Sub-hysterisis & On \& Off \\ \hline \end{tabular}
\end{table}
Table 5: VMM1 configuration and main features.

Figure 14: Micromegas setup for the perpendicular track analysis.

### \(\mu\)TPC Analysis

The setup used for the \(\mu\)TPC was identical to the setup used for the perpendicular track analysis with the only difference that the chambers were rotated at various angles as shown in Figure 17. For this analysis the T chambers were rotated by 10\({}^{\circ}\), 20\({}^{\circ}\) and 30\({}^{\circ}\), respectively.

Figure 16: Charge of clusters for perpendicular tracks. The Landau fit has a MPV of \(\sim\)310 mV.

Figure 15: Residual distribution for perpendicular tracks fitted with a double Gaussian. This is done to take into account the tails of the distribution. The final standard deviation is the weighted average of the two Gaussian distributions (where p2 and p5 parameters are the standard deviation of the two Gaussian distribution, respectively and p0 and p3 the corresponding heights).

#### 4.2.1 Cluster Filtering with Hough Transform

Clustering strips for an event in \(\upmu\)TPC mode with micromegas detectors has been a challenge. This is because of several reasons. There are fluctuations on primary cluster generation that can give strips without signal within a cluster of strips due to statistics and the incident track angle. Other reasons are generation of delta electrons, multiple track events as well as noise or saturation of electronics that can cause scattered hits on the detector. For these reasons a pattern recognition technique, the Hough transform, which is a special case of Radon Transform (RT) has been adapted for high efficiency cluster reconstruction. A detailed description of the method can be found in Appendix A.

The micromegas space is expressed in a 2-dimensional space with the knowledge of the strip pitch and the drift velocity. In this way the hits of each detector can be transformed to a "Hough" space with the transformation equation:

\[\rho=x\cos\theta+y\sin\theta \tag{1}\]

All the hits belonging in the straight line in the detector space have their sinogram lines crossed in the Hough space. By finding the crossing points on the Hough space and then do the inverse transformation back to the detector space, particle tracks can be reconstructed. In Figure 18 a double track event is shown in the detector coordinates on the left and on the right the Hough space. The two tracks can be seen clearly for \(0\approx 30^{\circ}\) in the Hough space.

The line reconstructed by the Hough transform is used to calculate the residuals from the hits. Using this information, hits that are far from the Hough transform line can be rejected. An example of the residual distribution can be seen in Figure 19.

Figure 17: Micromegas setup for \(\upmu\)TPC analysis.

Figure 18: Hough Tranform Space for a double track event.

After the rejection of the hits a linear fit is done in \(\mu\)TPC mode. Two examples are shown in Figures 20 and 21 where in the first one an event with a delta electron is filtered out and in the latter scattered hits from noise are rejected.

Figure 21: Event with noise. Left plot: The detector space with all the hits inside a micromegas detector and some scattered hits. Center plot: The Hough space reconstructed from the detector hits. Right plot: The cluster after the noise rejection and the \(\mu\)TPC linear fit.

Figure 19: Hit residuals from Hough transform line.

Figure 20: Delta electron event clustering. Left plot: The detector space with all the hits inside a micromegas detector. Center plot: The Hough space reconstructed from the detector hits. Right plot: The cluster after the delta electron rejection and the \(\mu\)TPC linear fit.

#### 4.2.2 Timing Extraction

As described in section 3.5, the timing output of the VMM1 is in units of Volts (\(v_{\text{measured}}\)). To convert the measured voltage to a time meaningful for analysis, the calibration constants (TDO pedestal, TAC slope) were used as shown in function 2.

\[I_{\text{calibrated}}=\text{TAC}-(v_{\text{measured}}-\text{ pedestal})/\text{slope} \tag{2}\]

Before the calibration the channel timing distribution of one chamber is shown in Figure 22 (left plot).

After the calibration all the timing measurements were inline as shown in Figure 22 (right plot).

The time distribution for each chamber was fitted with a double Fermi-Dirac function

\[\text{FD}(x)=\frac{p_{0}}{\text{e}^{-(x-p_{1})/p_{2}}+1}+\frac{p_{3}}{\text{e}^ {(x-p_{4})/p_{5}}+1}+p_{6}\qquad p_{0},\;p_{1},\;p_{2},\;p_{3},\;p_{4},\;p_{5}, \;p_{6},\;\text{arbitrary constants}\]

to measure the \(t_{0}\), which is the value at half maximum, \(p_{1}\) of the rising Fermi-Dirac and \(t_{max}\) which is the value at half maximum, \(p_{4}\) of the falling Fermi-Dirac. Also, forcing the readout of the neighbour to the signal channel of the VMM1 resulted in parasite time measurement and time outs that were taken into account from a pedestal parameter of the fit. The distribution is shown in right plot of Figure 23.

Figure 23: Left plot: Timing distribution of all the times measured by all the channels in one VMM1 for tracks under 30\({}^{\circ}\). The distribution is fitted with a double Fermi-Dirac function. Right plot: The same distribution when the neighbour to signal channels are forced to be readout by VMM1.

Figure 22: Left plot: The timing distribution along the channels of two VMM1s in one micromegas chamber. Right plot: The same distribution with the calibration constants taken into account.

#### 4.2.3 Hit Errors Calculation and Assignment

A cluster of hits with the time and amplitude measured for each of them is shown in Figure 24. After the hough transform filtering, a linear fit is performed to measure the slope and intercept of the traversed particle hit. On each hit an error on the \(x\) axis is assigned equal to: \(\sigma_{\mathrm{x}}=\mathrm{pitch}/\sqrt{12}\), where pitch is equal to the strip pitch. On the \(y\) axis, the error assigned, is calculated as a function of the signal amplitude.

This is done because the timing resolution of a peak measurement by the VMM1, depends on the amplitude of the signal. The time resolution to amplitude relation[1], is shown in Figure 25. The blue curve which corresponds to the 50 ns peaking time was used.

Figure 24: Left: The amplitude measured from channels after the pedestal subtraction for an event. Right: A linear fit on the hits for the same events.

Figure 25: Timing resolution measured on the VMM1[1].

#### 4.2.4 Resolution

By subtracting the positions of a particle hit in two chambers, measured with the \(\upmu\)TPC method, a residual distribution is obtained as shown in Figure 26 (right plot). Moreover for the same events the angular distribution of the measured hits in one chamber is shown in Figure 26 left plot. The distributions are fitted with a Gaussian function. The convoluted resolution can be extracted with the equation: \(\sigma_{\text{resolution}}=\sigma_{\text{gauss}}/\sqrt{2}\) since the chambers were identical.

In the Figure 27 (left plot) a summary of chamber spatial resolution versus the incident track angle is shown. On the right plot of the same figure, the mean angle measured from the angular distributions versus the incident angle is shown.

Figure 27: Left plot: The Spatial and Angular resolution versus the incident track angle. Right plot: The mean angle measured versus the incident track angle.

### Trigger Analysis

The trigger concept that micromegas will be used for the ATLAS NSW is based on detecting the first arriving signal of the 64 channels of each VMM. The timing distribution of the earliest arrival, measured in the test beam using the trigger data and compared to the Monte Carlo simulation is shown in Figure 28.

During the test beam period the address with the earliest time signal on each VMM1 was recorded and compared to the offline tracking data. The difference from the earliest strip measured using trigger and tracking data compared to Monte Carlo is shown in Figure 29.

From the ART addresses of all micromegas, a track is formed using a linear fit. An angular distribution is obtained for a run. Figure 30 shows the angular distribution for runs under \(0^{\circ}\), \(10^{\circ}\), \(20^{\circ}\) and \(30^{\circ}\).

Figure 28: Timing distribution of the ART compared to the Monte Carlo.

Figure 29: The ART address compared to the first arrival of the tracking data (blue) versus the Monte Carlo simulation (red).

In Figure 31 the summary of the angular resolution from the trigger data is shown. For the run of 10\({}^{\circ}\) and 20\({}^{\circ}\) the ART was measured also by the time at peak instead of time at threshold and no significant difference between the two methods was observed.

## Conclusions

The first version of VMM1 was tested at CERN with the micromegas detectors. Almost all the features that the ASIC integrates were functioning correctly. The VMM2 will improve several of them such as the power distribution within the ASIC resulting in a more uniform functionality avoiding the gain drop across the channels. The channel trimmers will also be corrected to allow the uniform threshold setting across the channels of the ASIC. Additional functionality will be implemented such as amplitude and time digitizers as well as more trigger primitives.

Figure 31: Angular resolution measured with trigger data. Both techniques by measuring time on peak or threshold are shown.

Figure 30: Angular distributions fitted with double Gaussian for runs of 0\({}^{\circ}\), 10\({}^{\circ}\), 20\({}^{\circ}\) and 30\({}^{\circ}\).

The same performance as the APV25 ASIC for perpendicular tracks was achieved. For the \(\upmu\)TPC analysis the gain of 9 mV/fC was not sufficient to achieve a timing resolution close to the detector intrinsic time resolution. The data were dominated by low amplitude signals where the peaking time resolution is even higher than 10 ns. The next version of the VMM will feature gain of 16 mV/fC which will be sufficient for the micromegas requirements.

## Acknowledgment

We would like to thank the MAMMA group for providing the micromegas detectors and the PCB workshop team for realizing them. Moreover we would like to express our thankfulness to the BNL Instrumentation division and especially to Jack Fried, Joseph Mead and Gianluigi De Geronimo for providing the electronics and the software to realize this testbeam as well as the Arizona Group for providing part of the electronics setup and Nathan Felt from the Harvard University for the software on the electronics. Finally, we acknowledge the valuable reviewing effort of Philippe Farthouat and Stephanie Zimmermann.

The work presented in this note note was co-funded by the European Union (European Social Fund ESF), the Greek Program "Education and Lifelong Learning" of the National Strategic Reference Framework (NSRF) 2007-2013, ARISTEIA-1893-ATLAS MICROMEGAS, and the U.S. Department of Energy under contract No. DE-AC02-98CH10886.

## Appendix A Radon - Hough Transform Analysis Technique

### Radon Transform definition

In this appendix we define the Radon transform of function \(f\) defined on the Euclidean space. Specifically, we define the Radon transformation of a functions on \(\mathbb{R}^{2}\).

Assuming a function \(f:\mathbb{R}^{2}\rightarrow\mathbb{R}\) of two variables \(x,\ y\), defined in the space \(D\subseteq\mathbb{R}^{2}\) (potentially the full space \(\mathbb{R}^{2}\) or an area of \(\mathbb{R}^{2}\)), as shown in Figure 32, and \(L\) an arbitrary line on this space.

The imaging defined by the projection (integral over a straight line) of \(f(x,y)\) over all possible lines \(L\) is the two dimensional Radon Transformation (RT) provided that the integral is defined. In particular, we will denote this transformation as \(f(x,y)\xleftrightarrow{RT}\tilde{f}\), where

\[\tilde{f}=\mathcal{R}[f(x,y)]=\int_{L}f(x,y)\mathrm{d}s \tag{3}\]

where \(\mathrm{d}s\) is an elementary part on the line. The line integral of (3) was first studied by the German mathematician Johann Radon [10][11].

In the further analysis we will consider the parametric form of the line \(L\) given by the function

\[\rho=x\cos\theta+y\sin\theta \tag{4}\]

as is described in [10]. This representation is referred to as "normal representation" of the straight line. Therefore, the integral of \(f(x,y)\) over the line \(L\) will depend on the parameters \(\rho\) and \(\theta\). So we have

\[\tilde{f}(\rho,\theta)=\mathcal{R}[f(x,y)]=\int_{L}f(x,y)\mathrm{d}s \tag{5}\]

where the Radon transform is the integral of function (5) for each line defined by \(\rho\) and \(\theta\). Therefore, if \(\tilde{f}(\rho,\theta)\) is known for each \(\rho\) and \(\theta\), then we will say that we have the two-dimensional Radon transform of

Figure 32: Definition of Radon transform.

the function \(f(x,y)\), while if it is known only for particular values of \(\rho,\theta\), we say that we have a sample of Radon transform (RT).

Now, if we consider the rotated by \(\theta\) coordinate system \(\rho\) and \(s\), as shown in Figure 33, then the \(x\) and \(y\) of an arbitrary point will be given through the rotation matrix as follows:

\[\left(\begin{array}{c}x\\ y\end{array}\right)=\left(\begin{array}{cc}\cos\theta&-\sin\theta\\ \sin\theta&\cos\theta\end{array}\right)\left(\begin{array}{c}\rho\\ s\end{array}\right)\Rightarrow\left\{\begin{array}{c}x=\rho\cos\theta-s \,\sin\theta,\\ y=\rho\sin\theta+s\,\cos\theta\end{array}\right.\]

Therefore, we can write the RT of (5) in the form of a simple integral

\[\breve{f}(\rho,\theta)=\int_{-\infty}^{+\infty}f(\rho\cos\theta-s\sin\theta, \,\rho\sin\theta+s\cos\theta)\mathrm{d}s \tag{6}\]

In order to generalize the RT in higher dimensions we introduce the vector notation of the Euclidean space. If \(\mathbf{x}=(x,y)\) is a vector with \(x\) and \(y\) Cartesian coordinates, then the function \(f(x,y)\) we defined above can be expressed briefly as \(f(\mathbf{x})\). We can define two perpendicular vectors (as shown in Figure 33) as follows:

\[\boldsymbol{\xi}\,=(\cos\theta,\sin\theta)\qquad\boldsymbol{\xi}\,^{\perp}=( -\sin\theta,\cos\theta)\]

We can find a scalar \(t\) such that the vector \(\mathbf{x}\) can be expressed as \(\mathbf{x}=\rho\boldsymbol{\xi}+t\boldsymbol{\xi}^{\perp}\). With the introduction of these new symbols, the RT of (6) is considerably simplified as expression in following way:

\[\breve{f}(\rho,\boldsymbol{\xi})=\int_{-\infty}^{+\infty}f(\rho\boldsymbol{ \xi}+t\boldsymbol{\xi}^{\perp})\mathrm{d}t \tag{7}\]

resulting that the expressions of \(\breve{f}(\rho,\boldsymbol{\xi})\) and \(\breve{f}(\rho,\theta)\) to be equivalent. The equation of the line (4) will be expressed in the simple way

\[\rho=\boldsymbol{\xi}\cdot\mathbf{x}=x\cos\theta+y\sin\theta\Rightarrow\rho- \boldsymbol{\xi}\cdot\mathbf{x}=0\]

This new parametric form of the line \(L\) leads us to perform the integral using the delta function \(\delta(\rho-\boldsymbol{\xi}\cdot\mathbf{x})\), since the line \(L\) is expressed as \(\rho-\boldsymbol{\xi}\,\cdot\mathbf{x}=0\). Therefore, the RT can be written as

\[\breve{f}(\rho,\boldsymbol{\xi})=\int\int_{\mathbb{R}^{2}}f(\mathbf{x})\delta (\rho-\boldsymbol{\xi}\cdot\mathbf{x})\,\mathrm{d}x\mathrm{d}y \tag{8}\]

where the integration is over \(\mathbb{R}^{2}\). The advantage of this form is that it is generalized in higher dimensions.

Figure 33: Vector definition of Radon transform.

### Hough Transform

Hough transform[12] may be viewed as a special case of the Radon transform. We will use a point source to study the behavior of the Radon transform. Consider an arbitrary point \((x_{0},y_{0})\) in two-dimensional space \((x,y)\). A point source will be written as

\[f(x,y)=\delta(x-x_{0})\delta(y-y_{0})\]

The RT of \(f(x,y)\) from the function (8) will be

\[\breve{f}(\rho,\mathbf{\xi})=\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} \delta(x-x_{0})\delta(y-y_{0})\delta(\rho-x\cos\theta-y\sin\theta)\mathrm{d}x \mathrm{d}y=\delta(\rho-x_{0}\cos\theta-y_{0}\sin\theta) \tag{9}\]

In the Figure 34 we see the point source and the corresponding RT. From the function (9), the RT is calculated for each function \(f(x,y)\) by the relations

\[f(x,y)=\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty}f(x_{0},y_{0})\delta(x- x_{0})\delta(y-y_{0})\mathrm{d}x_{0}\mathrm{d}y_{0}\]

\[\Rightarrow\breve{f}(\rho,\theta)=\int_{-\infty}^{+\infty}\int_{-\infty}^{+ \infty}f(x_{0},y_{0})\delta(\rho-x_{0}\cos\theta-y_{0}\sin\theta)\mathrm{d}x_ {0}\mathrm{d}y_{0} \tag{10}\]

\[\Rightarrow\breve{f}(\rho,\theta)=\int_{-\infty}^{+\infty}\int_{-\infty}^{+ \infty}f(x_{0},y_{0})\delta(\rho-\rho_{0}\cos(\theta-\theta_{0}))\mathrm{d}x_ {0}\mathrm{d}y_{0} \tag{11}\]

where \(\rho_{0}\cos\theta_{0}=x_{0}\) and \(\rho_{0}\sin\theta_{0}=y_{0}\). This result is very interesting for the algorithms of numerical calculations. We have shown that a point is transformed to a sinogram shape area of the Radon and the RT of a point source can be limited to a finite parameter space, i.e.

\[f(x,y)=0\qquad\text{for}\quad\sqrt{x^{2}+y^{2}}>\rho_{\text{max}}\quad \Rightarrow\quad\breve{f}(\rho,\theta)=0\qquad\text{for}\quad|\rho|>\rho_{ \text{max}}\]

as shown directly from the expression (11).

The Hough Transform can be used to identify straight lines from a set of data points. The idea is to transform each point to the Radon Transform space by assigning a sinogram. All sinograms will converge to a single point. This point gives us the parameters \((\rho,\theta)\) of the original line. Assuming 6 (a,b,c,d,e,f) points generated by the line \(y=5-x\) as shown in the Figure 35 left plot. By reconstructing the points through the Hough transform equation \(\rho=x\cos\theta+y\sin\theta\), the Hough sinogram lines (a,b,c,d,e,f) are

Figure 34: (a) Point source on the point \((x_{0},y_{0})\), (b) The corresponding Radon transform.

reconstructed as seen in the Figure 35 right plot. We see that the crossing point (4.5\({}^{\circ}\),3.5) represents the initial line from were the points are generated.

Figure 35: Left: Points belonging to a line in detector space. Right: Representation of the same points in Hough space.

## Appendix B Micromegas Setup at SPS/H6

## References

* an ASIC for micropattern detectors." submitted to TWEPP 2012 Topical Workshop on Electronics for Particle Physics, Abstract ID. Vol. 51. 2013.
* [2] The ATLAS Collaboration, New Small Wheel Technical Design Report, (CERN-LHCC-2013-006 ; ATLAS-TDR-020).
* [3] Y. Giomataris _et al._, "MICROMEGAS: a high-granularity position-sensitive gaseous detector for high particle-flux environments", Nucl. Instr. Meth. A376, 29-35, (1996).
* [4] De Geronimo, Gianluigi, _et al._, "Shaper Design in CMOS for High Dynamic Range." IEEE Transactions On Nuclear Science, Vol. 58, Issue. 5, October 2011.
* [5] J. Wotschack, Development of micromegas muon chambers for the ATLAS upgrade, JINST **7** C02021, 2012.
* [6] J. Wotschack, The development of large-area Micromegas detectors for the ATLAS upgrade, Mod. Phys. Lett. A, 28, 1340020 (2013)
* [7] G. Iakovidis, The Micromegas project for the ATLAS upgrade, JINST **8** C12007, (2013)
* [8] M. Iodice, Performance studies of MicroMegas for the ATLAS experiment, JINST **9** C01017, (2014)
* Engineer of CDAQ Board.
* [10] S. R. Deans, "The Radon Transform and Some of Its Applications", Krieger Publishing Company, 1992.
* [11] T. Alexopoulos, "Introduction to Signal Analysis", NTUA Press (in Greek), (2010).
* [12] P.V.C. Hough, "Method and means of recognizing complex patterns", U.S Patent 3,069,654. (Dec, 1962).
* [13] Rene Brun and Fons Rademakers, Nucl. Inst. & Meth. in Phys. Res. A 389, 81-86, (1997).
* Engineer at Harvard University. Developer of LX9 firmware.
* Engineer at Brookhaven National Laboratory. Developer of Evaluation FPGA board firmware.
* [16] R. Veenhof, Nucl. Instr. and Meth. A 419, 726, (1998).