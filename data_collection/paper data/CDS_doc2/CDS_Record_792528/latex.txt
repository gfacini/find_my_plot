**ATLAS Level-1 Calorimeter Trigger**

9 September 2004 Version 1.0

**ATLAS Level-1 Calorimeter Trigger Algorithms**

ATLAS L1Calo Group, compiled by E. Eisenhandler

## 1 Introduction

This document provides a summary of the ATLAS Level-1 Calorimeter Trigger algorithm definitions. It includes changes made since the Level-1 Technical Design Report [1], and spells out what is done in case of signal saturation or arithmetic overflow in the trigger logic. The information is based on the specifications for the PreProcessor ASIC [2], Cluster Processor FPGA [3], Jet/Energy Module (JEM) [4], and Common Merger Module [5].

## 2 Electron/photon and tau/hadron cluster triggers

The inputs to the electron/photon and tau/hadron trigger algorithms are a set of \(\sim\)7200 **trigger towers**, of granularity \(0.1\times 0.1\) in \(\Delta\eta\times\Delta\phi\). These are formed by analogue summation of calorimeter cells. There are separate sets of trigger towers from the electromagnetic (e.m.) and hadronic calorimeters. These triggers cover the region \(|\eta|<2.5\), which is the limit of inner-detector coverage and of high-granularity electromagnetic calorimetry. Trigger tower words are 8 bits with, nominally, 1 GeV of transverse energy (\(E_{\mathrm{T}}\)) per count. (Among other things, note that the calorimeter responses to e.m. and hadronic showers are not equal.)

The electron/photon (e.m.) and tau/hadron trigger algorithms are illustrated in figure 1. They are based on a **window** of \(4\times 4\) towers in both the e.m. and hadronic calorimeters, and make use of six basic elements, each formed by summing \(E_{\mathrm{T}}\) over a group of towers:

1. Four overlapping **e.m. clusters**, each summed over two e.m. towers, which are used to measure the \(E_{\mathrm{T}}\) of electromagnetic showers.
2. A **hadronic core**, the four hadronic towers centred in the algorithm window behind the e.m. clusters, the sum of which is used for isolation tests in the hadronic calorimeters.

Figure 1: Trigger towers used in the electron/photon and tau/hadron triggers.

3. Four **hadronic clusters**, each summed in depth over the e.m. and hadronic calorimeters, which are used to measure the \(E_{\rm T}\) of hadronic showers. These four hadronic clusters are formed by individually summing each two-tower e.m. cluster (item 1) with the hadronic core (item 2).
4. An **e.m. isolation ring**, consisting of the 12 e.m. towers surrounding the clusters, the sum of which is used for isolation tests in the e.m. calorimeters.
5. A **hadronic isolation ring**, consisting of the 12 hadronic towers behind the e.m. isolation ring, the sum of which is used for isolation tests in the hadronic calorimeters.
6. A 2 x 2-tower **cluster RoI**, summed in depth over the e.m. cluster region and hadronic core (item 2), centred in the algorithm window, which is used to identify candidate RoIs.

The window slides in steps of one trigger tower (0.1) in both the \(\eta\) and \(\phi\) directions, so there is one window corresponding to each tower within the acceptance of these triggers.

The requirements for an electron/photon or tau/hadron object to be found within the window for a given threshold set are:

* The most energetic of the four e.m. clusters (electron/photon trigger) or of the four hadronic clusters (tau/hadron trigger) must be greater than (>) the e.m. or hadronic cluster threshold under consideration.
* The total \(E_{\rm T}\) in the e.m. isolation ring must be less than or equal to (\(\approx\)) the corresponding e.m. isolation ring threshold.
* The total \(E_{\rm T}\) in the hadronic isolation ring must be less than or equal to (\(\approx\)) the corresponding hadronic isolation ring threshold.
* For electron/photon triggers only, the total \(E_{\rm T}\) in the hadronic core isolation region must be less than or equal to (\(\approx\)) the corresponding hadronic core isolation threshold.
* The cluster RoI must be a local \(E_{\rm T}\) maximum compared to its neighbours (see section 5).

If _all_ of these conditions are met for an electron/photon or tau/hadron object, then the window is considered to contain an **e.m. cluster trigger** candidate or a **hadronic cluster trigger** candidate, respectively.

Sixteen sets of trigger \(E_{\rm T}\) thresholds are available. Each **threshold set** is a combination of \(E_{\rm T}\) thresholds for cluster energy, e.m. isolation ring, hadronic isolation ring, and (for the e.m. cluster trigger) hadronic core isolation. Eight of the threshold sets are dedicated to the e.m. cluster trigger, with each of the other eight sets individually programmable to be either an e.m. cluster trigger or hadronic cluster trigger.

The handling of saturated trigger-tower signals, as well as maximum values for parameters and internal arithmetic, are discussed in section 6.

The merging logic counts objects passing each threshold set and sends the total multiplicities to the Central Trigger Processor (CTP). The multiplicities saturate at a maximum of 7, i.e if more than 7 objects are found for a particular threshold set anywhere in the trigger space the value 7 is sent [6].

## 3 Jet triggers

### Main jet trigger

The main jet trigger algorithm is illustrated in figure 2. Its basic units are **jet elements**, which are formed by summing over \(2\times 2\) trigger towers to give a granularity of \(0.2\times 0.2\) in \(\Delta\eta\times\Delta\phi\), and then summing in depth over the electromagnetic and hadronic calorimeters. (Some jet elements in outer regions of \(\eta\) are \(0.3\times 0.2\).) This trigger covers the region \(|\eta|<3.2\), which is the limit of the endcap acceptance. Jet elements are 10-bit words with, nominally, 1 GeV of \(E_{\mathrm{T}}\) per count. The algorithm has two components:

* A \(2\times 2\) **jet RoI** (i.e. summed over \(0.4\times 0.4\) in \(\Delta\eta\times\Delta\phi\)), which is used to identify candidate jet RoIs.
* **Jet windows**, which are used to measure the jet \(E_{\mathrm{T}}\). The windows are summed over \(2\times 2\), \(3\times 3\) or \(4\times 4\) jet elements, i.e. \(0.4\times 0.4\), \(0.6\times 0.6\) or \(0.8\times 0.8\) in \(\Delta\eta\times\Delta\phi\). Jet windows slide in steps of one jet element (0.2) in both the \(\eta\) and \(\phi\) directions.

The requirements for a jet trigger object to be found for a given threshold set are:

* The RoI cluster must be a local \(E_{\mathrm{T}}\) maximum compared to its neighbours (see section 5).
* The jet window \(E_{\mathrm{T}}\) must be greater than (>) the jet threshold under consideration. Comparisons are done in parallel for \(0.4\times 0.4\), \(0.6\times 0.6\) and \(0.8\times 0.8\) windows, and the choice of threshold also requires a choice of window size. For the \(0.4\times 0.4\) and \(0.8\times 0.8\) windows there is only one possible window for each RoI, but for \(0.6\times 0.6\) there are four possible windows surrounding each RoI and the one with the highest \(E_{\mathrm{T}}\) sum is used.

If _both_ of these conditions are met for a jet object, then the window is considered to contain a **jet trigger** candidate.

Eight sets of trigger \(E_{\mathrm{T}}\) thresholds are available. Each threshold set is a combination of a threshold for jet \(E_{\mathrm{T}}\) and a choice of jet window size.

The handling of saturated trigger-tower signals, as well as maximum values for parameters and internal arithmetic, are discussed in section 6.

The merging logic counts objects passing each threshold set and sends the total multiplicities to the CTP. The multiplicities saturate at a maximum of 7, i.e if more than 7 objects are found for a particular threshold set anywhere in the trigger space the value 7 is sent [6].

### Forward jet trigger

A trigger on jets in the FCAL is planned, and will be accommodated in JEMs 0, 7, 8 and 15 which serve the ends of the \(\eta\) range in each Jet/Energy-sum Processor crate. Jet elements of

Figure 2: Main jet trigger algorithms, based on jet elements of 0.2 \(\times\)0.2 and showing RoIs (shaded). In the 0.6 \(\times\)0.6 case, there are four possible windows containing a given RoI.

0.4 in \(\Delta\phi\) and summed over the whole of the FCAL \(\eta\) range cover the region out to \(|\eta|<4.9\). (The coverage of 0.4 in \(\Delta\phi\) is awkward, so for jet and energy trigger purposes each FCAL jet element value is divided by 2 and sent out as two pseudo-0.2 jet elements.)

One possibility is four jet thresholds for each end of the detector, each with a maximum multiplicity count of 3. Full details will be included in a future revision of this document.

## 4 Energy-sum triggers

The total and missing transverse-energy triggers cover the region out to \(|\eta|<4.9\), which is the limit of the FCAL.

### Total transverse energy

Each Jet/Energy Module computes the scalar transverse-energy sum of jet elements. The sum is transmitted to a Common Merger Module using an 8-bit compressed format with a 6-bit mantissa and a 2-bit exponent, which multiplies the mantissa by 1, 4, 16 or 64 to yield the full value transmitted.

On arrival at the Common Merger Module, the linear form of the summed energy is recovered, and the data from all Jet/Energy Modules are summed. The sum is compared to four thresholds with values up to 2 TeV in 4 GeV steps. Four bits, indicating which thresholds were passed, are sent to the CTP.

### Missing transverse energy

The Jet/Energy Modules multiply each jet element by the appropriate geometrical constants to obtain its transverse-energy components \(E_{\rm X}\) and \(E_{\rm Y}\). This is done using 12-bit multipliers and 12-bit products, working to 0.25 GeV precision before the result is rounded to the nearest 1 GeV. \(E_{\rm X}\) and \(E_{\rm Y}\) are separately summed on each JEM, and the results transmitted to a Common Merger Module. An 8-bit compressed format is used for each datum, with a 6-bit mantissa and a 2-bit exponent, which multiplies the mantissa by 1, 4, 16 or 64 to yield the full value transmitted. The phi-quadrant architecture of the trigger implies that the components from any one JEM always have the same sign values, which are therefore not transmitted.

On arrival at the Common Merger Module, the linear form of the summed energy is recovered, and signed arithmetic used to sum the components from all Jet/Energy Modules. A lookup table is used to perform the final quadrature addition of \(E_{\rm X}\) and \(E_{\rm Y}\) as well as compare with eight thresholds in a single step. In order to cover as wide a dynamic range as possible while maintaining precision at the low end, four different energy ranges are provided in the lookup table, with the choice based on the value of the larger of \(E_{\rm X}\) and \(E_{\rm Y}\). The thresholds have step sizes from 2 GeV to 16 GeV, depending on the range. Eight bits, indicating which thresholds were passed, are sent to the CTP.

### Total jet transverse energy

The total jet transverse energy is calculated approximately, using a simple multiplicity-based estimator. The inputs to the algorithm are the counts of the numbers of jets passing each of the eight main jet thresholds and the values of those thresholds, together with the numbers of jets passing each of the four forward jet thresholds and the values of those thresholds. As the counts are limited to 7 (3 for forward jets), and the maximum incoming calorimeter \(E_{\rm T}\) is limited to 255 GeV per trigger tower, the estimator may be low for events with high jet multiplicity or high jet energies.

[MISSING_PAGE_FAIL:5]

### Energy-sum triggers

The RoI information for missing and total transverse-energy triggers consists of the values calculated for the missing-\(E_{\mathrm{T}}\) components \(E_{\mathrm{X}}\) and \(E_{\mathrm{Y}}\), and for the total scalar \(E_{\mathrm{T}}\). For the total jet transverse-energy trigger, the RoI consists of bits indicating which of the four thresholds were exceeded.

## 6 Saturation and overflows

Trigger towers are processed as 8-bit words, with 1 GeV per count. The bunch-crossing identification carried out in the PreProcessor identifies saturated trigger-tower signals and sets these towers to full-scale, i.e. 255 GeV. In addition, there are some stages of the trigger logic where arithmetic overflows can occur. When either saturation or overflow occur this may signal very large energy deposition, and this has two implications:

* A trigger should normally be produced.
* The associated RoI information sent to the level-2 trigger will have a saturation-flag bit set, to indicate that the level-1 trigger arithmetic is not completely correct and the trigger was generated for that reason.

This section summarises the situation for each type of trigger algorithm, and describes how saturation or overflow generate triggers. Note that it must be possible to _disable_ triggers generated in this way because they might be caused by fault conditions, and so it is here that we also describe how to switch triggers off.

### E.M. and hadronic cluster triggers

If any of the eight trigger towers in the RoI are saturated, the Cluster Processor Module sets the saturation flag in the RoI readout, and a trigger should be produced.

To guarantee that saturation produces an e.m cluster trigger or a hadronic cluster trigger, at least one threshold set of the appropriate type must have its isolation requirements set to zero. However, the jet trigger (see next section) can also provide saturation triggers while covering a wider \(\eta\) range, provided no regions of the jet trigger are disabled. _Note that this has implications for the generation of trigger menus_.

The sums used in the trigger algorithms use longer word-lengths so that they do not overflow, but the results are truncated to 8 bits for cluster sums and 6 bits for isolation sums (items 2, 4, and 5) in order to match the threshold word-lengths.

The requirement that cluster sums must be greater than (>) the cluster thresholds therefore means that setting a cluster threshold to full scale (255 GeV) effectively turns it off, since it can never be exceeded due to the 8-bit limit on the sums. The requirement that isolation sums must be less than or equal to the isolation thresholds (\(\approx\)) is needed to allow isolation sums of zero to produce triggers for threshold values of zero. Also, the 6-bit limit on isolation sums means that setting isolation thresholds to full scale (63 GeV) effectively turns off isolation requirements.

### Jet triggers

Jet elements are formed in two stages, first in the PreProcessor by summing 2 x 2 trigger-tower regions in the e.m. and hadronic calorimeters separately, then on the Jet/Energy Modules by summing matched pairs of 2 x 2 regions in depth. Jet elements are processed by the trigger algorithms as 10-bit words with 1 GeV per count.

In addition to trigger-tower saturation, the 2 x 2 sums done by the PreProcessor can also overflow since these sums are limited to 9 bits. In either case, the PreProcessor sets the 2 x 2 sum to its full-scale value of 511 GeV before sending it to the JEM, which cannot distinguish between these two cases. When the JEM sums the 2 x 2 e.m. and hadronic regions to form a jet element, it sets the jet element to its full scale value, 1023 GeV, if either the e.m. or hadronic regions are set to full scale.

Jet thresholds are 10-bit words, and setting the threshold to full scale, i.e. 1023 GeV, turns off triggers from that threshold set, in the same way as with e.m. and hadronic cluster trigger thresholds.

The jet algorithm flags all jet windows containing full-scale jet elements. Any jet window of the chosen size whose jet-element sum is greater than or equal to (\(\geq\)) 1023 GeV, and which contains an RoI, will always produce a jet trigger if the threshold is not set to full scale. This ensures that if there is a full-scale jet element in the jet window a trigger will always be produced, provided that at least one jet threshold set is not turned off. _Note that this has implications for the generation of trigger menus_. The threshold value of 1023 GeV can be exceeded by the sum of non-full-scale jet elements, but if any jet elements in the window causing the trigger _are_ full-scale the JEM sets the saturation flag in the RoI readout.

### Energy-sum triggers

Energy sums of \(E_{\mathrm{X}}\), \(E_{\mathrm{Y}}\), and \(E_{\mathrm{T}}\) on Jet/Energy Modules are done to 12 bits, so any value above 4095 GeV produces an overflow. When transmitted to the Common Merger Module, the 8-bit quad-linear code is set to full scale (0xFF), which when decoded produces 4032 GeV. The same thing is done if any of the input jet elements are saturated, due to either trigger-tower saturation or upstream arithmetic overflow. Similarly, if a sum over a crate done by the Common Merger Module overflows, the resulting 14-bit sum is set to full scale. If there has been an overflow anywhere along the \(E_{\mathrm{X}}\), \(E_{\mathrm{Y}}\), or \(E_{\mathrm{T}}\) summation chains, the saturation flag is set in the RoI readout of that energy sum and a trigger should be produced. _Note that this has implications for the generation of trigger menus._

## Acknowledgement

The starting point for this note was Appendix B of the LVL1/LVL2 Interface Specification, which was written by Norman Gee.

## References

* [1] ATLAS First-level Trigger Technical Design Report, CERN/LHCC/98-14.
* [2] Specification for PreProcessor ASIC, [http://www.kip.uni-heidelberg.de/atlas/L1/PP_ASIC/PPrASICspec_May99.pdf](http://www.kip.uni-heidelberg.de/atlas/L1/PP_ASIC/PPrASICspec_May99.pdf)
* [3] Specification for Cluster Processor FPGA, [http://hepwww.rl.ac.uk/Atlas-L1/Modules/CPCHIP/cp-spec-final1-0.pdf](http://hepwww.rl.ac.uk/Atlas-L1/Modules/CPCHIP/cp-spec-final1-0.pdf)
* [4] Specification for Jet/Energy Module, [https://edms.cern.ch/file/326674/1.01/JEMspec101.pdf](https://edms.cern.ch/file/326674/1.01/JEMspec101.pdf)
* [5] Specification for Common Merger Module, [http://hepwww.rl.ac.uk/Atlas-L1/Modules/CMM/CMM_V1](http://hepwww.rl.ac.uk/Atlas-L1/Modules/CMM/CMM_V1)\(4\)4d.pdf
* [6] Specification of the Interface between the Level-1 Calorimeter Trigger and the Level-1 Central Trigger Processor, ATL-DA-ES-0032 v1.2.
* [7] Specification of the LVL1/LVL2 Trigger Interface, ATL-D-ES-0003 v.3.