**Study of DMILL TCTrx ASICs properties.**

**A. Camard, B. Laforge, P. Schwemling**

_LPNHE-Paris, Universites Paris 6-7 et IN2P3-CNRS_

The TTCrx ASIC [1] sends 40.08 MHz LHC clock and trigger L1 Accept signals to the electronics subsystems in the ATLAS experiment. This note reports studies on jitter variation versus programmable delay and phase delay versus temperature of the deskew clocks. The ATLAS experiment requires that the total TTCrx clock jitter relative to the LHC clock must be less than 100 ps RMS [2], and the maximum found on testbench is roughly 70 ps. The temperature evolution of the TTCrx delays has been evaluated and was found to be about 34 ps/\({}^{\circ}\)C. Finally, the jitter effects on energy and time reconstruction have been studied within the LArg electronics system, using the EM Barrel Calorimeter reconstruction method. The amplitude relative uncertainty is between \(10^{-5}\) and \(10^{-4}\), and is not negligible only at high energies. The time uncertainty is, at worst, of the same magnitude as the jitter introduced in simulation (about 50 ps).

###### Contents

* 1 Introduction
* 2 Testbench and measurement method
	* 2.1 Testbench
	* 2.2 Time calculation
* 3 Characterization of the TTCrx performances
	* 3.1 Delays INL
	* 3.2 Jitter measurement results
	* 3.3 Correlations between clock periods
	* 3.4 Clock delay versus temperature
	* 3.5 Jitter variation as a function of trigger L1 frequency.
	* 3.6 Electrical links results
* 4 Jitter effect on energy and time reconstruction
	* 4.1 Method
		* 4.1.1 Signal and optimal filtering coefficients
		* 4.1.2 Simulation method
	* 4.2 Results
		* 4.2.1 Long term jitter
		* 4.2.2 Short term jitter
* 5 Conclusions

Introduction

The TT Crx chip [1] properties are important in ATLAS to ensure a good transmission of the 40.08 MHz LHC clock and a good synchronization between all subdetectors. The version tested here is the v. 3.1, differing from the v. 3.2 by its lower resistance to photo-diode Single-Event Effects (SEEs), but they are both DMILL versions in fp BGA package [3]. The TT Crx are delivered by CERN soldered on a mezzanine board (see Fig. 1).

The two clocks provided by the TT Crx (those transmitted to detectors for synchronization) can be delayed using a fine delay, that varies by step of about 104 ps from 0 to 25 ns. These fine delays are labeled by a number (noted K) which goes from 0 for a delay of 0 ps to 240 for a delay of one clock period. The fine delay Integral Non-Linearity (INL) has been studied, and the jitter measurements have been done on the clocks as a function of K.

In the present note, the testbench and method used to study the TT Crx properties are first detailed. Next are shown obtained results, concerning mainly the clock output jitter measurement, and also the clock delay as a function of the temperature variation. The final part is dedicated to the influence of the TT Crx properties on energy and time reconstruction in the LArg case, and more particularly in the EM Barrel Calorimeter case.

Figure 1: _The TT Crx mezzanine board._

Testbench and measurement method

### Testbench

The testbench (see Fig. 2) uses a mini-crate version of the TTCmi and TTCtx modules (years 1994 to 1996), version ECP 680-1108-100 of TTCvi VME board, and a home design jig to plug in the TTCrx mezzanine. This testbench allows the study of various TTCrx properties (always measured relatively to the LHC input clock):

1. The fine delay INL.
2. The TTCrx jitter versus the programmable fine delay.
3. The TTCrx clock output phase shift vs temperature

Different configurations were tested. In particular, optical and electrical link between crate and TTCrx chip were tested. We have also studied the two different output clocks, called clock deskew 1 and 2.

Our testbench uses three mezzanine versions of the TTCrx version 3.1 delivered by CERN. On two of them, cables have been soldered (the standard PIN photo-diode on the mezzanine cannot be used in this condition) to allow an electrical transmission of the TTC signal from the TTCvi to the TTCrx chip in the LArg Front-End Crate. This electrical transmission allows us to test the final TTC signal transmission in the Front-End Crates, particularly on the Front-End Controller Board. A PCB was specifically designed to plug in the mezzanine and extract various outputs :

* Clock 40 (Clock40) (not used in this study)

Figure 2: _Test bench used in Paris LPNHE. The TTCvi and TTCtx are old mini-crate versions._

* Clock deskew 1 (ClockDes1)
* Clock deskew 2 (ClockDes2)
* Level one trigger (L1A) (not used in this study)

A numerical oscilloscope (LeCroy 9362) is used to acquire data that are analyzed through Labview and C programs.

### Time calculation

To measure the time of each clock period, the time reference taken is the LHC clock (replaced here by a TTCvi crate clock output, since we have not all the ATLAS electronics chain). The relative time of each clock to the LHC clock is evaluated via a linear regression

Figure 3: Diagram of clock time calculation. First of all, the points between dashed (green) lines are selected. The lines position is chosen to ensure that at least one point of each edge is between these lines. In the case where only one point is selected for one edge, its two nearest neighbours are automatically selected (shown by the two black curved arrows). If the raw slope (obtained with the points at extremities) of an edge is positive (or negative, at user choice), they are rejected (inclined crosses on the diagram). For each edge selected by user (those not rejected previously), the program tries to extend the points up to the (blue) dotted lines. These lines have been chosen to select only the straightest part of all edges. Then, a linear regression is done for each edge. The edge’s time (to on diagram) is then the time at signal half height (horizontal solid line) of each fitted line. The dotted crosses show points sampled by the oscilloscope, but never selected in the analysis.

of clock edges (see Fig. 3), done by a C function integrated into the Labview virtual instrument (vi). The fit is done by the standard \(\chi^{2}\) method on the falling edge's points1 of the clock analyzed. The time of each edge found is then the time at the signal half height calculated for each fitted line.

Footnote 1: The method can be applied to the rising edges, but they have been found to be less sharp than falling ones.

Other methods to estimate the time were tried, but they were not optimal. The method of points selection allows a good rejection of noise (wave on clock's top and bottom) that can be between the dotted lines (see Fig. 3). So this is the reason to implement the first selection between the closer limits (dashed lines on Fig. 3) and then, the extension to wider limits avoids a selection of fake edges. The fit method gives a better accuracy than other methods, such as calculating directly the mean time of the selected points for each edge, or a raw calculation of the line equation with the two extreme points of the edge. All these methods have been tested just by evaluating the time distribution obtained with a cable delay and also by studying the same clock edge with the different methods. The sharpest time distribution was always obtained by the fitting method.

Since the measurements are carried out as a function of the clock fine delay, the Labview program that drives the oscilloscope and the TTCrx has been designed in such a way that the clock on the oscilloscope's screen is always the'same': when a delay command is sent to the TTCrx, a command is also sent to the oscilloscope to delay the clock input by the same value.

For each delay value and clock edge on oscilloscope screen, about thousand time measurements were carried out. Then, the time distributions were plotted, and the mean and RMS are recorded to obtain the fine delay INL, and the jitter evaluation as a function of the delay value, and this, for each edge on screen selected by user. The maximum number of edges taken is four, limited by the oscilloscope sampling and by the number of points by edge necessary to fit the line.

A temperature probe can be placed on the TTCrx chips, to measure the TTCrx properties as a function of the temperature.

## 3 Characterization of the TTCrx performances

The results obtained come from the study of clock des1 and clock des2. The measurements obtained are similar for these two TTCrx output clocks.

### Delays INL

In the analysis program, the mean of the time distribution is recorded. With this value, and knowing the theoretical slope of the delay versus K, the delay INL can be obtained. The slope is of 103.96 ps/K step (see Fig. 4), value obtained from the TTCrx output clock period. The clock period is deduced from the time separation between three pairs of consecutive edges, and, then, the measured clock period is divided by 240, the number of steps.

The INL for different TTCrx have very similar values (see Fig. 5), however the INL differences distribution between the two TTCrx has 100 ps RMS (see Fig. 6).

The results presented here are close to those shown in the Ref. [4]

### Jitter measurement results

In a similar way to the INL study, the jitter is measured from time distributions RMS for each delay value and each clock edge. The first results have been obtained from the clock deskew 1, with standard optical link (using the optical receiver on the mezzanine).

We remind that in the ATLAS specifications, the total jitter RMS between the LHC clock and the TTC output clock must be lower than 100 ps (Ref. [2]). On the Figure 7, for the two TTCrx tested, the jitter RMS is always lower than 70 ps, so this is quite a good result. The mean jitter for the two TTCrx are 55 ps and 53 ps for TTCrx 2 and TTCrx 3, respectively between 47 to 62 ps and 44 to 70 ps.

The clock des2 jitter was also tested, and the jitter is a little bit lower than with the clock des1 output. The jitter RMS goes in this case from 36 ps to 52 ps, with a mean of 44 ps (see Fig. 8). The clock des2 was only tested on one TTCrx, because at this time, only one of our TTCrx mezzanine had a functional PIN photo-diode, since the others had been disconnected to permit electrical TTC signal receiving.

### Correlations between clock periods

During measurements done with an old non DMILL version of the TTCrx, the jitter, calculated as the time RMS of clock edges, seemed to be correlated between edges. This correlation took place between edges of the same "parity"2. The correlations found on

Figure 8: _Jitter vs K of four successive edges for the clock deskew 2 and optical link._

Figure 7: _Jitter vs K of four successive edges and for the clock deskew 1 and two different TTCrx, with optical link._non DMILL version were quite important (correlation coefficient of the order of 0.9 to 1) for edges with the same parity (Fig. 10 and 10), unlike those between edges of different parity (\(0.31<\rho<0.42\), see Fig. 11).

Since these correlations were very important, they have also been studied on DMILL TT Crx. The correlations found on the two TT Crx tested are not so high (\(0.60<\rho<0.67\)

Figure 11: Correlations between odd and even edges jitter for a non DMILL TT Crx. All the jilters are not in this case very correlated, unlike in the case of the same parity edges.

for TTCrx 2, and \(0.75<\rho<0.78\) for TTCrx 3), and, most of all, they are independent of the edges parity (see Fig. 12).

### Clock delay versus temperature

The effect of the jitter on the signal reconstruction can be worsened by a delay variation with temperature. The delay variation as a function of temperature is plotted on Fig. 13, and its value is of about 34 ps/\({}^{\circ}\)C, all the measurements being between 32 and 37 ps/\({}^{\circ}\)C. This is quite a large value, because a temperature variation of 3 \({}^{\circ}\)C can result in a delay variation of 102 ps, a delay almost equal to the 104 ps fine delay step. In this case, the temperature must be well controlled, or the fine delay must be changed by a retroactive calibration.

Figure 12: _Correlations between edge 1 jitter and edge 2 and edge 3 jitter with DMILL TTCrx (here, it’s for TTCrx 2 and clock deskew 1)._

Figure 13: _Delay variation versus temperature. The first point time is arbitrary shifted to 0._

### Jitter variation as a function of trigger L1 frequency.

Another interesting point to test is the jitter dependence as a function of the trigger L1 frequency. During studies, four different frequencies have been tried, from 1 kHz to 1 MHz. No jitter variation with the L1 frequency has been found on clock des1 and clock des2 (see Fig. 14).

### Electrical links results

Until now, all the results shown deal with the standard optical links provided on the TT Crx mezzanine. We give here some test results obtained without optical link to find a solution for the TTC distribution on the Front-End Controller Board and the TTC electrical links (from Controller Board to FEB) used in the Front-End Crates. With a purely electrical TTC signal transmission (diagram on Fig. 15), the jitter is good (about 42 ps). A test with 10H116 (a ECL line driver) FAN-OUT (diagram on Fig. 16) gives jitter results in the range from 60 to 70 ps RMS, and another with a mini-B USB connector [6] (diagram on Fig. 17), with a rather high jitter level (between 50 and 60 ps RMS). It is important to notice that these results ensure that the total TTC signal jitter should be under the ATLAS specifications of 100 ps RMS.

Figure 14: _Time distribution for different Trigger L1 frequencies at K=0._Figure 16: _Electrical transmission with a 10H116 FAN-OUT._

Figure 17: _Electrical transmission with a mini-B USB connector. The USB cable is stripped because no cable with two mini-B USB ends was available when tests have been done._

Figure 15: _Electrical transmission of the TTC signal._

Jitter effect on energy and time reconstruction

Since we have measured the TTCrx output clocks jitter, it can be interesting to study the consequences of this jitter on the reconstructed energy and time. It has been decided to use the optimal filtering coefficients calculated for the EM Barrel Calorimeter, particularly those used in M10 module. The study takes therefore place in this particular LArg case.

### Method

#### 4.1.1 Signal and optimal filtering coefficients

The ATLAS experiment will use the optimal filtering (OF) method [5] to reconstruct energy and time of events. This method consists in applying some weights (called coefficients) to the signal samples taken to find estimators of energy and time of events, minimizing the noise influence (in low luminosity, it is mostly electronics noise, and in high luminosity, pile-up noise predominates).

The coefficients used here to study the jitter impact on energy and time reconstruction are those used in the EM Barrel Testbeam. They have been calculated for each M10

Figure 18: _Signal and optimal coefficients used in simulation. The signal is sampled each nanosecond here (this is the sharpest sampling step that can be obtained from the EM Testbeam optimal filtering data). Optimal filtering coefficients are calculated from the signal, and they are normalized. Each batch of coefficients is calculated for 5 samples separated by 25 ns, and each batch of OF coefficients is spaced by 1 ns. Each batch on the plot has a specific color, and in the further study, they are each labeled by the time of the first sample, ranged from 25 to 50 ns. The vertical blue lines separate each range of sample._

module cell, from calibration signal modified to be shaped as physics signal, and by taking into account capacitors and inductances measurements in each cell. They have been calculated to minimize electronics noise influence, and for 5 samples of physics signal, but with 25 different time situations since the Testbeam data are note synchronized, unlike in the standard ATLAS case (see Fig. 18). The signal shapes used in the study are also taken from the M10 Barrel module analysis, as the coefficients must correspond exactly to the signal for which they have been calculated. Using other signals with these coefficients may lead to systematic uncertainties.

#### 4.1.2 Simulation method

Using the coefficients and the signal shape from the EM Barrel Testbeam, a simulation program has been written. Since the signal is known with a sampling interval of 1 ns, and the jitter level is about 50 ps, we need to know the amplitude value at points that are not sampled. It has been chosen to interpolate the signal amplitude between each sample. The interpolation chosen is linear (we have found no major modification in the results with a 2\({}^{\mathrm{nd}}\) degree polynomial interpolation, and with higher degrees, the amplitude accuracy is worse). To test the interpolation result, the different uncertainties for signal amplitude have been compared with different polynomial degrees in interpolation method. The linear and second degree interpolations give the smallest uncertainties, these uncertainties increase with the polynomials of higher degrees.

The program makes all the following tasks :

1. Choose 5 time samples, each of them separated by the standard 25 ns.
2. Add the jitter, whose distribution is a gaussian of 50 ps RMS and mean value 0, to each time sample, with a variable correlation level between each sample jitter. It must be noted that the correlations here are different from those studied in section

Figure 19: _Two examples of correlations between time distributions (here for the clock deskew 2 and at K=0). Here, the time of different edges is directly compared, not their jitter._

3.3 : the correlations are here directly considered between the falling edges time value, and not between the jitters (see Fig. 19).
3. Calculate the signal amplitude associated with each sample, by interpolation if necessary.
4. Apply the coefficients to the signal samples to find the signal total amplitude and the time delay.

In the simulation, no other noise than jitter noise is added to the standard physics pulse shape, unlike the real physics case where electronics noise or pile-up noise dominates.

The time correlation seen in experimental conditions between falling edges can be quite variable. For example, with TTCrx 3, the correlation for clock des2 is of about \(\rho=0.65\), and with TTCrx 2, the clock des1 study gives \(\rho=0.83\). Because of this variability, the correlation introduced in the simulation are the extreme cases :

* No time correlation between each sample. For each sample, the time is totally independent of the previous sample, obtained from a gaussian (which variance is equal to the jitter) random number. This kind of jitter is called short term jitter, because of its short lived memory.
* Time 100% correlated between each sample. For the first sample, a random time is obtained from a gaussian (\(\sigma=\) jitter) and this same time is applied to the four other samples. In this case, all samples are delayed by the same time, but randomly for each event. This jitter is called long term jitter.

With these two extreme cases, all the possible correlations can be evaluated, since all the experimental correlations between time distribution are between these extreme cases. To find a possible optimum in time and energy reconstruction, the time of the samples have been taken every 0.2 ns, from \(-0.8\) to 0.8 ns around the time of each sample in the Testbeam data (sampled only every ns).

### Results

#### 4.2.1 Long term jitter

Under these conditions, the delay set to the samples is just affected in block to all samples with a gaussian variation with the jitter intensity. The signal amplitude is well reconstructed (Fig. 20), the value found is always close to the theoretical result of 1 (the optimal coefficients are normalized), with a very good accuracy (Fig. 21) of about \(10^{-5}\). An unexpected effect appears on the amplitude uncertainty : the points corresponding exactly to the chosen set of coefficients (e.g. the point at 30 ps for the set of coefficients labeled 30 ps) is systematically lower than the other points in the same set of coefficients. This effect is due to the amplitude distribution for this point, which is a half-gaussian (see Fig. 22). This distribution is due to the fact that the amplitude with the long term jitter can never be greater than 1. It must be noticed that with a broader jitter, let's say 500 ps for example, the transition between a gaussian and a half-gaussian is smoother, and then, the evolution of the amplitude errors is more continuous than with a little jitter (all points have a flat pattern unlike the one just at the middle which is lower).

[MISSING_PAGE_EMPTY:16]

#### 4.2.2 Short term jitter

The situation with a short term jitter is slightly different. Here, the amplitude (see Fig. 25) is very similar to the amplitude found with a total correlation, but its accuracy has been degraded by going from \(10^{-5}\) in the long term jitter case to \(10^{-4}\) here (Fig. 26). If we expect an electronic noise of 50 MeV, at low energy (100 GeV for example), the uncertainties obtained in the jitter simulation are negligible, but at the high energies of a few TeV, the uncertainties coming from electronics noise and clock jitter are of the same magnitude order. The time estimation with short term jitter (Fig. 27) is very close to the time obtained from the case with long term jitter, and, the effect on the time accuracy is exactly reversed: the lack of correlations is better to obtain a good time reconstruction (Fig. 28), the accuracy here being better then 36 ps. This accuracy should be optimized, for the accuracy with the coefficients taken at around 48 to 50 ns for the first sample is of only 26 ps, the minimum error in the simulation. To really optimize both the amplitude and the time, the other noise sources must be considered, i.e. the electronic noise and the pile-up noise.

The signal interpolation has a slight effect on the reconstructed time, and also on the energy: the amplitude as a function of time for a given set of optimal filtering coefficients has a triangular shape (see Fig. 20 and 25). When a second degree interpolation is used, the triangular shape becomes a parabola shape, so it is clear that the triangular shape is really due to the interpolation method. This effect modifies only the global shape of the amplitude distribution, and not the range of the amplitude values found in the simulation.

[MISSING_PAGE_EMPTY:18]

Conclusions

The DMILL TTCrx jitter has been measured, and its consequences on the Amplitude and Time evaluation have been studied. The jitter measurements show a good result, never exceeding 70 ps RMS, while the ATLAS specifications fix an upper limit of 100 ps RMS. The delay with temperature of 34 ps/\({}^{\circ}\)C is not negligible, but a good temperature control or a periodical calibration can control this problem. With the DMILL TTCrx version, no jitter correlation effect depending of the edge parity has been found, nor a jitter variation with the trigger L1 frequency.

The jitter's influence on energy and time reconstruction was simulated with the LArg electronics system. Using the optimal filtering reconstruction method calculated for the EM Barrel Calorimeter M10 module, the jitter effects on energy reconstruction is low, but not totally negligible for the time reconstruction. With long term jitter, the accuracy on energy is very good (magnitude of \(10^{-5}\)), and the time accuracy is of the same magnitude as the jitter value. With short time jitter, the energy accuracy is of some \(10^{-4}\), and the time accuracy is better than the jitter value. Given the specifications required by ATLAS on the TTCrx chip, it is obvious that the electronic and pile-up noise should have the major impact on the energy reconstruction. Furthermore, the present version of the TTCrx meets the ATLAS requirements, with some safety margin.

## Acknowledgments

We take the opportunity of thanking M. Dhellot, O. Le Dortz, D. Martin, J.M. Parraud, and F. Rossel for fruitful discussions and suggestions.

## References

* [1]_"TTCrx Reference Manual : A Timing, Trigger and Control Receiver ASIC for LHC Detector", version 3.6, June 2002_, Christiansen, J. ; Marchioro, A. ; Moreira, P. ; Toifl, T.
* [2][http://ttc.web.cern.ch/TTC/TTCmain.html#Transmitters](http://ttc.web.cern.ch/TTC/TTCmain.html#Transmitters), RD-12 Timing, Trigger and Control Systems for LHC Detectors.
* [3] Informations on the fpBGA package can be found at the following URL: [http://www.cern.ch/TTC/fpBGA.pdf](http://www.cern.ch/TTC/fpBGA.pdf).
* [4]_"Measurements of Radiation Effects on the Timing, Trigger and Control Receiver (TTCrx) ASIC"_, Toifl, T. ; Moreira, P. ; Marchioro, A.
* [5] NIM **A**338(1994)467-497, _"Signal processing considerations for liquid ionization calorimeters in a high rate environment"_, Cleland, W.E. ; Stern, E.G. ATL-LARG-2001-003, _"Use of optimal filtering in the 1999 data"_, Zitoun, R.
* [6] The datasheet of the Molex mini-B USB connector can be found from the URL [http://www-lpnhep.in2p3.fr/atlas/pubdocs/cont/](http://www-lpnhep.in2p3.fr/atlas/pubdocs/cont/)