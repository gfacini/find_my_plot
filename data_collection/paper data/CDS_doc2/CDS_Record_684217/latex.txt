ATLAS

**MDT-ASD User's Manual**

Christoph Posch, Boston University/CERN christoph.posch@cern.ch

Eric Hazen, Boston University hazen@bu.edu

John Oliver, Harvard University inoliver@fas.harvard.eduThis page intentionally left almost blank 

[MISSING_PAGE_EMPTY:3]

- TEST AND MEASUREMENT RESULTS. 37
* 4.1 Sub-circuits and building blocks 38
* 4.1.1 Bipolar shaper 38
* 4.1.2 Amplifier sensitivity 39
* 4.1.3 Discriminator time slew 40
* 4.1.4 Wilkinson ADC performance 41
* 4.1.5 Timing discriminator threshold DAC 42
* 4.1.6 Timing discriminator hysteresis DAC 44
* 4.1.7 Serial data interface 44
* 4.2 System performance 44
* 4.2.1 Noise behaviour and non-systematic measurement errors 44
* 4.2.1.1 Time measurement 44
* 4.2.1.2 Charge measurement 45
* 4.2.2 Power consumption 44
* 5 APPENDIX-A 49
* 5.1 MOS transistor models 49
* 5.2 LVDS Driver properties 50
* 5.2.1 Driver DC specifications 50
* 5.2.2 Driver AC specifications 53
* 5.3 Packaging information 58
* 5.3.1 Pin out diagram 58
* 5.3.2 PQFP80 package 59
* PARAMETER SETUP GUIDELINES 61
* 6.1 Discriminator 61
* 6.1.1 Threshold 61
* 6.1.2 Noise rates 62
* 6.1.3 Hysteresis 63
* 6.2 Wilkinson parameters 64
* 6.2.1 Gate width 64
* 6.2.2 Rundown current 65
* 6.2.3 Disc2 threshold 66
* 6.2.4 Transfer curve 66
* 6.2.5 Deadtime 67
* 6.3 Summary : Nominal operating settings 68
* 7 REFERENCES 69Introduction

### 1.1 MDT system overview

#### General

The ATLAS MDT system consists of about 350,000 pressurized drift tubes of 3 cm diameter, with lengths from 1.5 to 6 m. The MDTs are read out by an Amplifier/Shaper/Discriminator (ASD) at one end, and the other end is terminated with the characteristic impedance of the tube (370 \(\Omega\)). The pre-amp input impedance is a relatively low (\(\sim\) 100 \(\Omega\)) to maximize collected charge. To minimize cost, the MDT signals are carried on two-layer "hedgehog boards" to a mezzanine board, which contains 24 readout channels: 3 Octal ASDs, a single 24-channel TDC, and associated control circuitry. A single MDT chamber may have as many as 432 drift tubes or 18 hedgehog/mezzanine board sets. Data are read out of each TDC individually via a 40 Mbit/sec serial link to a single CSM (Chamber Service Module) which multiplexes the (up to) 18 serial links into a single optical fiber for transmission to the ATLAS DAQ. A daisy-chain JTAG bus permits downloading of parameters to ASDs and TDCs and triggering of test/calibration pulse injection. Each _multilayer_ (3 or 4 layers of individual tubes) is entirely enclosed in a faraday cage shield at both ends. All AC signals entering or leaving the shield are low-level differential signals (LVDS). All DC signals are filtered at the shield entry point. Each complete MDT chamber is electrically isolated from the support structure, and all services (gas, electrical, etc) are also electrically isolated or floating at the source. The MDT chambers will be individually grounded in a controlled way to a single common ground point.

#### MDT chamber properties

Some properties relevant for the design of the readout electronics of the muon drift tubes are summarized in Table 1.

#### Drift gas issues

The drift gas Ar/CO\({}_{2}\) 93/7 was chosen in large part because of its favourable ageing properties in the LHC environment. It is, however, a non-linear drift gas and this results in some difficulties for the ASD design [1]. In particular, the non-linear r-t relationship results in a significant probability of late arriving clusters. This has been simulated extensively [1][16][19][20], and results in significant after-pulsing in the resulting signal. We expect approximately three output pulses for each muon track and this can result in difficulties for track reconstruction. It has been shown, again by extensive simulation [16][19][20], that introducing dead time for entire drift time of the MTD substantially eliminates this problem while minimally impacting track reconstruction efficiency. Thus, programmable deadtime up to the total drift time is a requirement of the design.

\begin{table}
\begin{tabular}{|l|l|} \hline Length & \(\leq\) 6 m \\ \hline Diameter & 30 mm \\ \hline Wire diameter & 50 \(\mu\)m \\ \hline Wire resistance & 44 \(\Omega\) / m \\ \hline Impedance (Z\({}_{0}\)) & 380 \(\Omega\) \\ \hline Termination & 380 \(\Omega\) in series with 470 pF \\ \hline AC coupling capacitor & 470 pF \\ \hline Drift gas & Ar/CO\({}_{2}\) (93\%/7\%) \\ \hline Maximum background rate & 400kHz \\ \hline \end{tabular}
\end{table}
Table 1. MDT properties

#### On-chamber readout electronics

The ASD chips are mounted on a "mezzanine" card which is in turn connected to a chamber mounted "hedgehog" card. Each mezzanine card contains three MDT-ASDs for a total of 24 channels per mezzanine-hedgehog combination. The hedgehog contains no active circuitry and it, along with the mezz card, is fully contained within a faraday cage.

### Front end requirements

The ATLAS Muon Spectrometer aims for a \(\mathrm{Pr}\) resolution of 10% for 1 TeV muons. This translates into a single wire resolution requirement of \(<80\)\(\mathrm{\SIUnitSymbolMicro m}\).

The average drift velocity is about 20\(\mathrm{\SIUnitSymbolMicro m}\)/ns, which implies a systematic timing error for an individual tube of about 500 ps. The planned gas gain is low, about 2\(\times 10^{4}\), to avoid aging problems. The expected signal (collected charge) is roughly 1500 electrons (0.25 fC) per primary electron, so good position resolution requires a low noise front-end. A specified pre-amp peaking time of 15 ns is a good compromise in terms of resolution and stability [16][20].

The channel to channel crosstalk is specified to be less than 1%. The high count rates of up to 400 kHz/wire together with the long electron drift times require either a bipolar shaping scheme or active baseline restoration to avoid resolution deterioration due to baseline fluctuations. At the time of the TDR, the baseline MDT gas was Ar/N\({}_{2}\)/CH\({}_{4}\) 91/4/5 (3 bars absolute) which is very linear and has a maximum drift time of 500 ns. The choice for the ASD shaping scheme was unipolar shaping with active baseline restoration for the following two reasons [21]. First, it allows the measurement of the signal trailing edge, which has a fixed latency with respect to the bunch crossing, with an accuracy of about 20 ns. Second, it avoids multiple threshold crossings per muon track, which would increase the hit rate and therefore the readout occupancy. Aging problems with all MDT gases containing hydrocarbons caused a change of the baseline gas to Ar/CO\({}_{2}\) (93%/7% @ 3 bars absolute) which has a maximum drift time of approximately 800 ns and is very non-linear [1]. The long drift time and the non-linearity degrade the trailing edge resolution to about 80 ns and cause multiple threshold crossings even for a unipolar shaping scheme. We therefore have adopted a bipolar shaping scheme since it does not require an active BLR and also does not require programmable filter time constants [21].

To avoid multiple hits from multiple threshold crossings for a single signal we introduce a variable dead time up to the maximum drift time. It was shown that the overall increase in dead time does not cause a degradation of the pattern recognition efficiency [1][16].

An ADC will measure the signal charge in a given time window (integration gate) following the initial threshold crossing. The signal charge is encoded into pulse width using the dual-slope "Wilkinson" technique. This charge information allows for increasing the accuracy of the timing measurement by performing time slewing correction [16][19], thus improving the spatial resolution of the tracking detector. Additionally, it is effective for diagnostics and monitoring purposes and might also be used for dE/dx identification of slow moving heavy particles like heavy muon SUSY partners [13]. Two modes of operation will be provided. In one mode the ASD output gives the time over threshold information, i.e. signal leading and trailing edge timing. The other mode measures leading edge time and charge and is considered the default operating mode.

Design

The MDT-ASD is an octal CMOS Amplifier/Shaper/Discriminator which has been optimized for the ATLAS MDT chambers. The length of these chambers, up to six meters, requires the use of a terminating resistor to avoid confusion and pulse distortion from reflections. The noise contribution from this terminating resistor has been analyzed in detail and has been shown to be the dominant noise source in either a bipolar or CMOS ASD implementation [10][5]. For reasons of cost and design flexibility, implementation as an ASIC using a high quality analog CMOS process has been chosen for this device (2.2).

### Overview and specifications

The structure of one analog channel of the ASD is shown in Figure 2. It is a fully differential structure with a pair of identical preamplifiers at the input, a shaper stage, followed by a discriminator and a leading edge charge integrator to be described later. The second pre-amp provides DC balance, common mode pickup rejection and improved power supply rejection. The main analog specifications are summarized in Table 2.

Additional analog and functional specifications are listed in section 2.7

\begin{table}
\begin{tabular}{|l|l|} \hline Input impedance & Z\({}_{\text{IN}}\) = 120 \(\Omega\) \\ \hline Noise & ENC = 6000 e’ rms or \(\sim\) 5 primary electrons (pe’) \\ \hline Shaping function & bipolar \\ \hline Shaper peaking time & t\({}_{\text{p}}\) = 15 ns \\ \hline Sensitivity at discriminator & 1.65 mV/pe (gas gain 2\(\times\)10\({}^{\text{2}}\)) or 8.9 mV/fC (delta pulse into terminated \\ input & MDT) \\ \hline Linear range & 1.5 V or 900 pe’ \\ \hline Nominal threshold setting & 40 mV or 24 pe’ ( \(\sim\) 5 \(\sigma_{\text{noise}}\) ) \\ \hline \end{tabular}
\end{table}
Table 2: ASD analog specifications

### Fabrication process

The fabrication process chosen for the MDT-ASD is a 0.5 \(\upmu\)m n-well triple-metal CMOS process, Hewlett Packard HP AMOS14TB [27]. There is a linear capacitor option consisting of polysilicon over an active N+ diffusion in an N-well (2250 aF/\(\upmu\)m\({}^{2}\)). The process is silicided yielding very low polysilicon and diffusion resistivities. There is a "silicide" block layer available which allows exclusion of silicide over polysilicon but not over diffusion. This is used primarily for well behaved polysilicon resistors. The operating voltage is 3.3 V. The process parameters are apparently very tightly controlled and consistent run to run (Wafer Test Results and SPICE Model Parameters at [26]).

#### 2.2.1 Basic specifications

#### 2.2.2 Radiation tolerance

The MDT-ASD will reside and work in the LHC radiation environment. Table 4 gives the simulated radiation levels for the relevant locations in ATLAS, accumulated over the foreseen lifetime of the experiment (10 years). The inner end-cap chambers (EIS/EIL) will experience the highest levels (bold numbers).

Several studies on total dose and single-event tolerance for devices fabricated on the HP AMOS14TB process have been conducted [8][14][15]. Some of the relevant results are summarized below.

#### 2.2.2.1 Single event latchup (SEL)

Single event latchup testing was performed with both a single shot laser system and with accelerated heavy ions ranging in effective LET from 5.6 MeV/mg/cm2 to greater than 120 MeV/mg/cm2. Figure 1 indicates that the HP 0.5\(\upmu\)m devices range in latchup threshold from 63 LET for a 1.5 \(\upmu\)m well-to-active spacing to greater 100 LET for a 4.5 \(\upmu\)m well-to-active spacing device. HP 0.5\(\upmu\)m latchup thresholds improve at the rate of \(\sim\)12 LET per micron of increased well-to-active spacing. Bias of the HP devices was 3.3 V during both ion and laser testing [14].

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|} \hline  & BIS/BIL & BMS/BML & BOS/BOL & EIS/EIL & EMS/EML & EOS/EOL \\ \hline SRL\({}_{\text{TID}}\)(krad) & 0.47 & 0.28 & 0.13 & **0.64** & 0.62 & 0.33 \\ \hline SRL\({}_{\text{NIEL}}\)(1MeV eq n/m\({}^{2}\)) & 0.3\(\times\)10\({}^{11}\) & 0.3\(\times\)10\({}^{11}\) & 0.24\(\times\)10\({}^{11}\) & **2.9\(\times\)10\({}^{11}\)** & 0.34\(\times\)10\({}^{11}\) & 0.17\(\times\)10\({}^{11}\) \\ \hline SRL\({}_{\text{SEE}}\) (\(>\)20MeV h/cm\({}^{2}\)) & 0.54\(\times\)10\({}^{10}\) & 0.57\(\times\)10\({}^{10}\) & 0.46\(\times\)10\({}^{10}\) & **4.8\(\times\)10\({}^{10}\)** & 0.9\(\times\)10\({}^{10}\) & 0.3\(\times\)10\({}^{10}\) \\ \hline \end{tabular}
\end{table}
Table 4: Simulated radiation levels (SRL) for MDT electronics locations

\begin{table}
\begin{tabular}{l c c c} \hline Parameter & n-channel & p-channel & either & Units \\ \hline Minimum gate length & & 0.5 & \(\upmu\)m \\ \hline Threshold voltage (typ) & 0.76 & 0.88 & & V \\ \hline Kprime & 92 & 26 & & \(\upmu\)A/V\({}^{2}\) \\ \hline N+ diffusion sheet resistance & 2.2 & 2.2 & & \(\Omega\)/sq \\ \hline Poly sheet resistance (silicided) & & 2.0 & \(\Omega\)/sq \\ \hline Poly sheet resistance (silicide blocked) & & 130 & \(\Omega\)/sq \\ \hline Gate oxide thickness & & 100 & Å \\ \hline Gate capacitance & & 3.5 & fF/\(\upmu\)m\({}^{2}\) \\ \hline Linear capacitor & & 2.3 & fF/\(\upmu\)m\({}^{2}\) \\ \hline Vbkd & 11.3 & -9.6 & & V \\ \hline \end{tabular}
\end{table}
Table 3: HP 0.5\(\upmu\) CMOS process parametersthe process-specific vendor design rules. The minimum well-to-active spacing in MDT-ASDs is 3 \(\upmu\)m, resulting in a 81 LET latchup threshold.

A recent simulation study [6] has shown that the maximum energy deposition occurring with non-negligible probability in the LHC radiation environment will correspond locally to a LET lower than 50 MeVcm\({}^{2}\)mg\({}^{1}\). This will happen in the very rare case of a nuclear interaction in tungsten, which is often used in ICs for connection purposes between metal layers [7].

#### 2.2.2 Total ionizing dose (TID)

Total dose irradiation was performed with a \({}^{60}\)Co gamma source at 50 rad (Si)/sec up to 300 krad total. At each measurement point, the devices were measured and irradiation reinitiated within one hour. Following final irradiation, all devices were subjected to a 100\({}^{\circ}\) C biased anneal for 168 hours.

Good TID radiation tolerance is achieved in the HP 0.5\(\upmu\)m process. The average change in threshold voltage at 100 krad is less than 40 mV for the n-channel and less than 20 mV for the p-channel devices.

No special radiation-tolerant layout techniques were applied. The HP 0.5\(\upmu\)m process is recommended to be a candidate for (space) missions with a total dose requirement of one hundred kilorad [15].

The expected total ionizing dose, calculated from the figures in Table 4 for the worst case location (end-cap inner chambers) in consideration of all relevant safety factors for a known-batch ASIC is 3.5 krad.

New results on TID radiation hardness of the MDT-ASD can be found in [16].

\begin{table}
\begin{tabular}{|c|c|c|c|} \hline Dose & Vth NMOS & Vth PMOS & Gate delay \\ \hline
100 krad & -40 mV & 18 mV & +0.6\% \\ \hline
300 krad & -38 mV & 43 mV & +1.0\% \\ \hline Post-anneal & 0 mV & 28 mV & +1.6\% \\ \hline \end{tabular}
\end{table}
Table 5: HP AMOS14TB total ionizing dose (TID) results

Figure 1: Latchup threshold in LET versus distance between biased N-well and grounded Active regions

#### Single event upset (SEU)

SEU studies on devices fabricated on the HP AMOS14TB production line were conducted. A shift register composed of conventional, non-radiation-tolerant, flip-flops exhibited SEU at an LET of 7.0 MeV/mg/cm\({}^{2}\) and had a saturation cross section of about \(9\times 10^{-7}\) cm\({}^{2}\) per flip-flop [8]

### Topology and architecture

The MDT-ASD utilizes the pseudo-differential input topology developed and implemented in many successful bipolar ASDs by University of Pennsylvania [12].

The complete signal channel is shown as a block diagram in Figure 2.

The signal path is a fully differential structure from input to output for maximum stability and noise immunity. Each MDT connects to a "active" pre-amp with an associated "dummy" pre-amp. This in turn connects to the mezzanine card but goes no further. It provides DC balance to the subsequent stages as well as some degree of common mode rejection from noise pickup, substrate coupling, and power supply noise. Following the pseudo-differential pair of pre-amps is a differential amplifier which provides gain and outputs a fully differential signal to subsequent stages. Following this are two stages of differential amplifiers which provide further gain while implementing bipolar shaping. Bipolar shaping was chosen to prevent baseline shift at the anticipated high level of background hits [16][20][21].

The shaper output is fed into a discriminator and Wilkinson ADC section. The ADC integrates the shaped pulse for a given gate width and stores the charge on a holding capacitor which is then run down at a constant rate1. The ADC output width thus encodes the "leading edge" charge. These data are primarily used for time slew correction to enhance timing resolution.

Footnote 1: Integration gate and rundown current are variable (see section 2.7)

The Wilkinson ADC operates under the control of a Gate Generator which consists of all differential logic cells. It is thus highly immune to substrate coupling and can operate in real time without disturbing the analog signals. The final output is then sent to the LVDS cell and converted to external low level signals.

Each complete ASD channel draws approximately 10 mA from a 3.3 V supply, thus dissipating \(\sim\) 33 mW per channel. The operation of the MDT-ASD sub-cells is described in detail in the following sections

Figure 2: MDT-ASD channel block diagram

### Analog signal chain

#### Pre-amplifier

_Specifications_

* Power dissipation: 3.3 mW per pre-amp (\(\sim\) 1 mA @ 3.3 V)
* \(\mathrm{Z_{IN}}\): 120 ohms (DC & AC/dynamic)
* Charge gain: 1 mV/fC
* DC voltage gain: 100 (40dB)
* Input noise density: 1.3 nV/\(\sqrt{Hz}\)
* ENC (with 380 \(\Omega\) termination): 6000 e' rms

_Description_

The pre-amp is an unfolded cascode shown in the schematic in Figure 3.

The large input transistor M1 (2400 \(\mathrm{\SIUnitSymbolMicro m}\) / 0.9 \(\mathrm{\SIUnitSymbolMicro m}\)) operates at a nominal 1 mA standing current providing low noise and low input impedance at reasonable power dissipation. Transistor M2 constitutes the cascode. Current is supplied to the high impedance node via a cascode current source (M4 & M3). There is a 10 k\(\Omega\) load resistor, R1, on the high impedance node which, along with feedback resistor R2 sets the low frequency part of the input impedance. The high frequency behaviour of the circuit is determined by the feedback capacitor and the total parasitic capacitance on the high impedance node. This capacitance consists of the parallel combination of drain capacitances of M2 and M3, trace capacitance, and gate capacitance of the subsequent stages. Each of these is a well controlled process parameter with very low process variation. The value of feedback capacitor is chosen to produce uniform input impedance of 120 \(\Omega\) across a wide range of frequency. Bias voltages \(\mathrm{V_{b}}\)[1:4] are provided by a bias circuit (not shown) which is bypassed using large external capacitors.

#### Differential amplifiers

Each of the differential amplifies DA1 through DA4 is of the same basic design shown in Figure 4. The core amplifier is a differential pair of transistors, M3 & M4, with gain set by load impedance, Z, and source impedance, Y. By tailoring these impedances with some combination of resistors and capacitors, one can obtain gain stages as well as more complicated pole/zero structures or bipolar shaping structures.

The DC operating point of the amplifier is established by common mode feedback. The output nodes, OUTB (OUTA) are connected to the gates of M1(1a) and M5(5a) respectively. These transistors operate in their linear

Figure 3: Pre-amp simplified schematicregion as resistors with, typically, 50 - 100 mV across them. Common mode gain is achieved by modulating these FET resistances via common mode output voltage. The gain of this loop is of order 10. Voltages VB1 and VB2 are set by the bias network shown to the left. Common mode feedback drives the common mode output voltage to V\({}_{\text{ref}}\) which is set to V\({}_{\text{DD}}\)/2 or 1.65 V.

Measured common mode output voltage is typically within 20 mV of this value. Total standing current in the circuit is set by the single polysilicon resistor, R.

Bandwidth of each of the differential amplifier stages is limited by load resistance and the total capacitance of the output node which consists of the parallel capacitance of output transistor drains, traces, and gate input of subsequent stage. Typically, each stage incurs a pole at a time constant of about 4 ns with an 11 k\(\Omega\) load (\(\sim\) 40 MHz 3dB - bandwidth per stage, see section 2.5.2)

Since gain of each diff-amp is largely determined by the ratio of load to source resistance (silicide blocked poly), the gain is desensitized to process variation.

#### 2.4.3 Shaper

The shaper is composed of two stages of RC networks embedded in the differential amplifiers DA[2:3]. The first diff-amp DA2 implements a pole/zero network using a series parallel RC combination shown below in Figure 5. The values are chosen to cancel the very long time constant component of the positive ion MDT pulse. This shaping stage is, however not critical as the overall pulse shape is dominated by the following bipolar shaping stage.

Figure 4: Differential amplifier schematic

Figure 5: Pole/zero network

The second amplifier, DA3, uses a simple series RC network in its source location to effect a bipolar shaping stage. The RC product of this shaping stage is approximately 50 ns. The pulse thus formed by this stage achieves a high level of area balance within 10 shaping time constants or about 1/2 us. This is short compared with the estimated average time between background pulses (2.5 us or 400 kHz) and thus achieves good rejection to baseline shift.

#### 2.4.4 Pre-discriminator gain stage

The shaper output is AC coupled to one additional differential amplifier, DA4, referred to as pre-discriminator gain stage which provides additional gain to the discriminator. This stage has smaller load resistance (5.5 k\(\Omega\)) to provide lower driving impedance to the subsequent discriminator stage. Its source resistor is chosen to be zero to provide maximum gain and bandwidth at the expense of higher process variation of gain. Since the threshold is applied at its input however, the gain sensitivity to process variation is irrelevant.

#### 2.4.5 Discriminator

The discriminator, shown below in Figure 6, is a high-gain differential amplifier with symmetrical current-mirror loads with main differential pair, M1/M2, biased at 400 A. Two current-mirror "loops" provide a differential gain of about 500 with no hysteresis.

Hysteresis is provided by the M1a/M2a pair, which unbalances the static current through the main differential pair by a variable external current, shifting the effective discriminator threshold by up to 100 mV. The main bias current is provided by R1 (poly-resistor). The expected operating regime is at a threshold of about 20 primary electrons, which corresponds to a differential signal of about 300 mV at the discriminator input.

Figure 6: Discriminator simplified schematic

#### LVDS output cell

This cell, shown in Figure 7, provides an "LVDS-like" low-level logic output, with a nominal swing of 160 mV into 100 \(\Omega\) centred at 1.2 V. This corresponds to the "reduced range link" described in IEEE 1596.3. [25].

Differential drive is provided directly from the discriminator outputs to two moderately-sized inverters (not shown). These inverters drive the output stage, which is essentially a pair of inverters (M2a/M3a and M2b/M3b) with their output current limited by transistor pairs (M1a/M1b and M4a/M4b) operating in their resistive region. Common-mode feedback from the outputs to the resistive FETs sets the common-mode output voltage.

The DC characteristics are set entirely by transistor sizes and are thus subject to process variations. Observations on fabricated devices from multiple prototype runs agree with Monte Carlo simulations and comply with the specification. Test results are provided in section 5.2.

#### Analog pad driver

Analog output is provided for ch-7 (last channel) only for diagnostic purposes. The pad driver cell is shown in Fig. 8 and is simply a set of cascaded source followers reminiscent of the old "Damn Fast" buffer parts from National Semiconductor.

Figure 7: LVDS driver simplified schematicThe gain of this cell is only about 0.5 when driving a high impedance load. It is capable of driving a terminated twisted pair but at lower gain. When back terminated with 50 \(\Omega\) and driving a 50 \(\Omega\) load, the circuit suffers a total of approximately 8:1 attenuation. It can easily drive a 50 \(\Omega\) scope input but must be ac coupled. A pulse transformer can be used for this purpose.

The analog output is useful for observation of MDT shaped signals and provides an accurate means for noise measurements. It has a separate VDD connection on the chip so that it can be powered down except for diagnostic purposes as desired. The pad driver is powered up by inserting low value resistors (\(<2\)\(\Omega\)) into locations R108, R208, or R308 on the mezzanine cards. The pad drivers are known to cause crosstalk to their neighbouring channel, and therefore these resistors should be removed prior to installation on an MDT chamber. The mezz cards are shipped without these resistors.

#### 2.4.8 Wilkinson ADC

The Wilkinson ADC serves as a time slew correction and also provides diagnostics for monitoring chamber gas gain. It operates by creating a variable gate of 10 - 50 ns width at the leading edge of the signal, integrating the signal charge onto a holding capacitor during the gate, and then running down the hold capacitor at constant current. The rundown current is also programmable to be able to adjust for the dynamic range of the subsequent Time-to-Digital-Converter. The Wilkinson dual-slope scheme is shown in a simplified diagram in Figure 9.

Figure 8: Analog pad driver simplified schematic

Figure 9: Wilkinson charge-to-time converter principle

The Wilkinson cell is fully differential and uses the same differential transconductor as the shaper stage as a floating current source, both for the integration current source as well as the rundown current sink. A discriminator, similar to the one used for the main threshold, is used to sense when the holding capacitor has run down to zero. This discriminator is referred to as "DISC2" and its threshold is programmed via the "Wilkinson threshold" programming code. See Appendix B for programming details.

The gate generator logic is shown below in the block diagram in Figure 10.

The main discriminator, DISC1, fires a one-shot consisting of flip flop FF1 and a 15 ns delay element thus generating the Wilkinson GATE signal. Delay elements are based on complementary current sources charging appropriately sized capacitors driving logic gates with hysteresis. The trailing edge of the GATE signal fires a second flip-flop, FF2, resulting in the OUT signal. This, in turn, activates the run down current which eventually discharges the hold capacitor and is sensed by discriminator DISC2. This in turn, resets FF2, and terminates the cycle. Further input signals are inhibited by the "dead time" delay element which is programmable up to approximately one microsecond.

#### Input protection

Primary input protection is provided by a pair of large N+ diodes in series with a wide 3 \(\Omega\) input resistor. The resistor is a silicide blocked polysilicon resistor attached directly to the input pad. Each diode consists of eight fingers of n+ diffusion, 50 microns each, surrounded by P+ diffusion for a total finger length of 400 microns. The whole structure is surrounded by an additional N+ diffusion which acts as the collector of an "n-p-n" structure. The collector scoops up current discharged into the substrate more effectively than the P+ cathode strips alone. Each such diode has a total capacitance, area plus fringe, of about 0.8 pF.

There is also a smaller pair of P+ diodes connected to the positive supply rail. In principle, a human body model type discharge into these diodes would dump current into the positive supply rail which, therefore, requires a clamp for bare chip handling. This clamp is based on the UMC "Corner" design [26], but is a bit simpler. It is by no means, guaranteed to withstand a full HBM discharge while the device is unconnected.

While these diodes are robust, they are not sufficient to withstand a full 3 kV - 4 kV MTD chamber discharge which can be of order several amperes. Additional off-chip protection in the form of back to back 1N914 signal diodes, in conjunction with the on-chip diodes, has been shown to provide robust protection against such discharges.

All digital I/O pads are taken from the MOSIS Hi-ESD Pad Library for the HP AMOS14B process [28].

Figure 10: Gate generator block diagram

### Subcircuit characteristics

#### Pre-amplifier

Figure 11 shows the simulated signal transfer characteristic of the ASD pre-amp. The input signal is a voltage step function with a rise time of 2 ns applied to an ideal capacitor of 100 fF at the pre-amp input. The range is 50 - 800 mV yielding a charge range of 10 - 160 fC. The small signal frequency response of the pre-amplifier is shown in Figure 12. The input signal is a 1 mV AC signal.

#### Differential amplifier stages DA1 through DA4

Four differential amplifier stages DA1 through DA4 serve both as gain and as shaping amplifiers. The basic topology for all four amplifiers is identical while the feedback networks differ according to the desired frequency characteristics.

* DA1 is a simple gain stage with purely resistive feedback. The bandwidth is limited by the product of the feedback resistor and the load capacitance, typically consisting of the gate capacitances of the subsequent stages and the source/drain capacitances of the input and output transistor pairs. The gain is 4.5dB with a 3dB bandwidth of 45 MHz (Figure 14). The pulse peak voltage gain is in the order of 1.1 exhibiting sufficient linear behaviour (Figure 13). DA1s main purpose is to ensure the signal being completely complementary.

Figure 11: MDT-ASD pre-amplifier: SPICE simulation of the transfer characteristic (output peak voltage vs. input charge) shows good linearity over an extended input charge range (Nominal range - 10 - 80 fC). The gain is 0.93 mV/fC.

* DA2 and DA3 constitute the shaping portion of the MDT-ASD. The desired combined shaping function has a bipolar characteristic. This frequency response is achieved by adding a series R-C branch in parallel to the resistive feedback in case of DA2 and by replacing the feedback resistor with a series R-C branch in DA3. DA2 shows a linear voltage gain of 3.4 over the extended signal range (Figure 6) while DA3 exhibits a compressive transfer characteristic with a small signal voltage gain of \(\sim\) 3.2 [9]. Again, the working signal range is roughly the first half of the plotted range.

Figure 16: DA3 output peak voltage vs. input peak voltage. The small signal voltage gain is \(\sim\) 3.2 (\(\sim\) 10dB, compare Figure 18). The transfer curve shows a soft compressive characteristic.

The AC characteristics of the shaping amplifiers are shown in Figure 18 and Figure 18. The gain peak for both amplifiers is approximately 10dB in the range of 5 to 10 MHz.
* DA4 is the pre-discriminator gain stage of the timing discriminator with a voltage gain of 5 to 6 (16dB). The transfer curve, again covering twice the expected signal range, shows DA4 going to saturation very fast.

#### 2.5.3 Pre-Amplifier - Shaper: Combined transfer characteristic

The analog signal chain ends at DA3 output where the signal is tapped to be sent to the analog pad drivers and where the discriminator threshold is applied before the signal is put into the pre-discriminator gain stage DA4. Figure 21 shows the gain Bode plots of all individual amplifier stages plus the combined Bode plot (labelled "full chain"), thus giving the delta pulse frequency response of the pre-amplifier - shaper combination, or equivalently the frequency spectrum of the pulse at the shaper output.

Figure 21: Pre-amplifier – DA3 analog signal chain: AC frequency response; the amplifier chain exhibits a pass-band characteristic with a center frequency of 5 MHz. The high-pass part, mainly imposed by DA3, shows a corner frequency of 30 kHz and a slope of +6dB/octave (representing a first order high-pass filter). The low-pass section is a superposition of all four amplifier low-pass characteristics that have similar corner frequencies between 38 MHz and 44 MHz. The curve shows a - 24dB/octave slope (or 4\({}^{\rm th}\)-order low-pass filter behaviour) above - 45 MHz. At approx. 500 MHz where DA2 goes flat again, the slope reduces to -18dB/octave (3\({}^{\rm rd}\) order). The peak lies at 5 MHz showing a voltage gain or close to 70dB.

#### 2.5.4 Pre-Amplifier - Shaper: Time domain pulse response

Figure 22 shows the simulated response of the amplifier chain to current Delta pulses (a) at the pre-amp input, (b) shows the pre-amplifier signal, (c) and (d) are the outputs of the differential amplifiers DA1 and DA2 respectively. The threshold is applied at the output of DA3 (e), the DA4 signal (f) is fed into the discriminator.

Figure 22: Space simulation of the Delta pulse (a) response of the analog signal chain after the pre-amp (b), DA1 (c), DA2 (d), DA3 (threshold coupling point) (e) and DA4 (pre-discriminator gain stage) (f).

#### Simulation with GARFIELD signals

GARFIELD is a program for the detailed simulation of two-dimensional drift chambers (drifting of particles, including diffusion, avalanches and current induction is treated in three dimensions) [22]. The software package allows to create typical MDT signals which can be used within a Spice simulator.

Figure 23 shows the current induced on a MDT wire as seen at the tube's signal pin; (b) is the voltage at the ASD input pad assuming a simple electrical model of the tube including the termination resistor and the coupling and parasitic capacitances; (c) shows the pre-amplifier output, (d), (e) and (f) the 3 differential amplifier outputs DA1 - DA3; (g) is the DA3 signal with a 60 mV nominal threshold applied; (h) shows the DA4 signal and the discriminator output.

#### 2.5.6 Wilkinson ADC

The main purpose of the Wilkinson ADC is to provide data which can be used for the correction of time-slew effects due to pulse amplitude variations by measuring the charge contained in the rising edge of the MDT signal [16][20]. Time slewing correction improves the spatial resolution of the detector. In addition, this kind of charge measurement provides a tool useful for chamber performance diagnostics and monitoring. Further applications such as _dE/dx_ measurements of slow moving heavy particles like heavy muon SUSY partners etc are conceivable [13].

The result of the charge measurement is converted into time, encoded in the width of the output pulse. The information contained in the pulse, namely the leading edge timing and the pulse width encoded charge, will be read and converted to digital data by a TDC [1].

Figure 24 shows the response of the Wilkinson ADC to the GARFIELD signal of the last section. The two digital signals are the integration gate (16 ns) and the rundown gate (\(\sim\) 55 ns). The ADC output pulse is constructed as the OR of the two gates. The rundown current was set to a medium value. The differential analog signal shows the triangular shape composed of the integration and the run-down ramp. The end of the conversion cycle is triggered by the rundown ramps undershooting the threshold of a discriminator (DISC2).

Figure 23: Response of one ASD channel to a MDT current signal created by GARFIELD [22].

Figure 24: Wilkinson ADC: Internal ramp signals and gate signals (integration gate and rundown gate). The ADC output pulse is constructed as the OR of the two gate signals.

#### Analog pad driver

Channel #7 is equipped with an analog signal output which allows one to observe and monitor the shaper pulse. The signal is tapped after the shaper at the threshold coupling point between DA3 and the pre-discriminator gain stage DA4 and fed into an analog output driver. The pad driver has a voltage gain of -3.7dB and a bandwidth of 185 MHz (Figure 25).

### Simulator

All simulations were done using BSIM3 Version 3.1 Level 49 MOS transistor-models2 and the AVANT(r) Star-HSPICE simulator release 1998.2 (Star-HSPICE 98.2.1 [980912])

Footnote 2: The transistor models used in all simulations are listed in Appendix-A (section 5.1)

Figure 25: Analog pad driver frequency response – gain and phase Bode plots: The amplifier shows a small signal gain of -3.7dB with the -3dB point at 184 MHz. The rolloff slope is -6dB/octave.

[MISSING_PAGE_FAIL:28]

An analysis of the above circuit shows that the output voltage, DACOUT, is given by

\[DACOUT=R_{{}_{N}}+\frac{R_{{}_{P}}-R_{{}_{N}}}{512}\cdot N=\!\!R_{{}_{N}}\!+\!N \cdot 1mv\]

Where R\({}_{\text{P}}\) & R\({}_{\text{N}}\) are the positive and negative voltage references and N is the programming code. The voltage reference circuit is designed so that R\({}_{\text{P}}\) - R\({}_{\text{N}}\) is set to 512 mv. There are two such DACs, each receiving complementary codes with the final result that the differential voltage applied to the discriminator is given by,

\[\Delta V_{{}_{Out}}=(N-\overline{N})\cdot 1mv=(2\cdot N-255)\cdot 1mv\]

#### 2.7.1.2 Offset voltages - Chip Tester and Mezz Test Databases

Each channel in the ASD has an actual threshold voltage which is different from the ideal threshold voltage. The difference is termed the offset voltage and is measured for each channel using noise hit rate techniques. For historical reasons, the Chip Test and Mezz Test databases used slightly different formulae for the conversion from programming code to differential voltage resulting in small differences between the offsets listed in the databases and the actual offsets. The formulas used by the Chip Tester and Mezz Test databases are given respectively by,

\[\Delta V_{{}_{Out}}=(2\cdot N-256)\cdot 1mv\quad\&\quad\Delta V_{{}_{Out}}=(2 \cdot N-254)\cdot 1mv\]

Thus, to recover the actual offsets, one must _add 1 mv to the number in the Chip Test database_ and/or _subtract 1 mv from the value in the Mezz Test database_.

#### 2.7.1.3 Timing discriminator hysteresis

It was demonstrated that the option of a wide-range adjustable hysteresis for the timing discriminator is a useful feature to reduce the probability of multiple threshold crossings in the tail of the MDT signal [16][19][20]. It also improves the system reliability by removing ambivalent output states of the discriminator due to signals or signal fluctuations close to the threshold level. The hysteresis for DISC1 is applied through a scaled-transistor current source DAC with a resolution of 4 bits. The range of the DAC is 320 uA with a LSB of 40 uA. This

Figure 26: Block schematic of the 8-bit threshold voltage DAC

corresponds to a hysteresis voltage range of 0 - 20 mV at the threshold coupling point DA-4 (0 - 7 primary electrons) or 0 - 100 mV at the discriminator.

#### 2.7.1.4 Wilkinson ADC Control

* The **integration gate width** can be set from 8 ns to 45 ns in steps of 2.5 ns (4-bit). This setting influences what fraction of the leading edge charge of the signal is used for time slew correction. The nominal gate width is 15 ns which corresponds to the average peaking time t\({}_{\text{p}}\) of the pre-amplifier. It can be demonstrated that the time slewing is only correlated to the leading edge charge and not to the total signal charge of the MDT signal. ADC measurements with a gate \(>2\times\text{t}_{\text{p}}\) thus can not be used to further improve the spatial resolution of the system [16, 19, 20]. However for dE/dX for particle identification, longer gates are desirable [13]. The current controlling the gate width is set by a binary-weighted switched resistor string.
* The **threshold** is applied to the differential threshold terminals of the Wilkinson discriminator (DISC2) by two coupled resistor divider voltage DACs with 3-bit resolution and a range of 16 mV to 128 mV (LSB = 16 mV). One set of control signals sets both DACs complementary. Unlike DISC1 threshold, the two DACs do not cover the same range. The range of the positive going DAC is V\({}_{\text{base}}+16\) mV to V\({}_{\text{base}}+128\) mV, the one of the negative from V\({}_{\text{base}}-16\) mV to V\({}_{\text{base}}-128\) mV. The minimum threshold thus amounts to 32 mV, the maximum to 256 mV. The same voltage references as for the DISC1 threshold DACs are used. The DISC2 threshold also affects the width of the Wilkinson ADC output pulse (see below) but does not influence the ADC performance in a wide range and is primarily implemented for troubleshooting and fine-tuning purposes.
* 140 ns (100 ns range \(\Rightarrow\) 7-bit TDC resolution).
* The **deadtime** setting defines an additional time window after each hit during which the logic does not accept and process new input. It can be set from 17 to 535 ns in steps of \(\sim\)75 ns (3 bit). The nominal setting is 535 ns corresponding to the maximum drift time in the MDT. This feature can be used to suppress spurious hits due to multiple threshold crossings in the MDT signal tail (additionally facilitated by the bipolar shaping scheme). The deadtime window is added to the output pulse, thus a minimum deadtime is always present (the time of the output pulse itself). The current controlling the dead time is set by a binary-weighted switched resistor string. Different combinations of the ADC settings affect the output pulse in a wide range. For minimum integration gate (8 ns), high rundown current (7.3 uA) and high DISC2 threshold (128 mV), the width of the pulse can go as low as 15 ns for a very small input signal. The other extreme (gate 45 ns, rundown current 2.4 uA, DISC2 threshold 16 mV) yields a 240 ns ADC output pulse for a large signal (note that certain settings exceed the TDC dynamic range).

#### Programmable functional parameters

##### 2.7.2.1 Calibration/test pulse injection

In order to facilitate chip testing during the design phase as well as to perform system calibration and test runs with the final assembly, a calibration/test pulse injection system was integrated in the chip. It consists of a parallel bank of 8 switchable 50 fF capacitors per channel and an associated channel mask register (Figure 27). The mask register allows for each channel to be selected separately whether or not it will receive test pulses. The capacitors are charged with external voltage pulses, nominal 200 mV swing standard LVDS pulses, yielding an input signal charge range of \(10-80\) fC.

##### 2.7.2 Chip mode

One bit is used to set the global output mode of the MDT-ASD. The two modes are:

\begin{tabular}{|c|p{284.5pt}|} \hline ADC mode (default) & In this mode, the output pulse width represents the charge measured in the leading edge of the MDT signal (pulse width encoded charge measurement, see section "Wilkinson ADC control"). The rising edge contains the timing information. \\ \hline ToT mode (Time-over-Threshold) & In this mode, the discriminator signal itself is sent to the output drivers. Thus the width of the pulse is determined by the shape and amplitude of the MDT signal. Multiple threshold crossings (and output pulses) are possible. The rising edge of the first (main) pulse contains the timing information for the event. \\ \hline \end{tabular}

Figure 27: Calibration/test pulse injection – block diagram

#### Channel mode

For diagnostic (boundary scan) and troubleshooting purposes, the output of each channel can be set to one of three states (2 bits per channel)

\begin{tabular}{|c|l|} \hline \hline ON & Channel on. Default working setting. \\ \hline HI & LVDS output of the respective channel is forced HIGH ('Logic 1') (regardless of what happens in the analog part of this channel). \\ \hline LO & Like above but 'Logic 0'. These two settings allow boundary scan type connectivity checking of the circuit board. Particularly useful for large scale production testing. \\ \hline \hline \end{tabular}

### Serial data interface

#### Architecture

The chosen ASD serial data interface architecture employs separate shift and working registers. The shift register is connected directly to digital input and output pads respectively. Its length is designed to hold a complete set of control bits (53). The data can be uploaded any time (asynchronously) to the shadow registers, which control the DACs, multiplexers etc. The architecture allows downloading the whole set of active bits from the shadow to the shift register in order to send them back to the controller for diagnostic or monitoring purposes. This can be done any time and does not interfere with the normal operation of the ASD. The interface, for each data bit, consists of the shift register-cell, implemented as a static master-slave D flip-flop, the shadow register cell, realized as a static transparent latch and 2 two-in-one multiplexers (Figure 28). ASDs thus can be daisy-chained to form a closed JTAG type control loop.

#### 2.8.2 I/O operation

The protocol requires 2 data lines (TO and FROM chip), 3 control lines (SHIFT [D0], DOWN [D1], LOAD [D2]) and one clock line (Table 8). The configuration allows extensive control over the data flow (Table 9).

HOLD mode keeps the data in the shift register by feeding back each cell with its own content. SHIFT mode shifts data right at the rising edge of the clock. LOAD active copies the bits in the shift register to the shadow register at any time (asynchronous). DOWN active copies the contents of the shadow registers to the shift register at the next rising clock edge (overrides SHIFT - HOLD). The ASD serial input expects the data to be stable at the rising edge of the clock \(\pm\) a few nanoseconds. The controller will change data bits at the falling clock-edge. Thus data are stable at the input for the entire clock period with the sensitive rising edge in the middle. Data bits at the ASD serial data output also change state at the falling edge of the clock.

Figure 28: Serial data interfaceShift and shadow registers have a length of 54 bits, where 53 are actual data bits. The last shift register cell is clocked with an inverted clock, making the output change at the falling edge of the clock. A DOWN instruction causes the last cell to perform a HOLD operation.

#### Shift register bit assignment

The bit assignment of the shift register is given in Table 10. JTAG bit 0 is the last bit to enter the shift register. Data words are loaded LSB first. Channel 1 is the top most channel when looking at the chip with the analog inputs on the left-hand side. The mask bit for channel 1 is JTAG bit 0. The DACs for Random Current and DISC2 Threshold give the lowest output for all bits set. All other DACs vice versa.

\begin{table}
\begin{tabular}{|c|l|c|} \hline JTAG bit \# & Description & LSB/code \\ \hline
[0:7] & Channel mask register 1 - 8 [0:7] & bit 0 channel 1 (top) \\ \hline
[8:10] & Calibration injection capacitor select [2:0] & bit 10 LSB \\ \hline
[11:18] & Main threshold DAC (DISC1) [7:0] & bit 18 LSB \\ \hline
[19:21] & Wilkinson ADC threshold DAC (DISC2) [2:0] & bit 21 LSB \\ \hline
[22:25] & Hysteresis DAC (DISC1) [3:0] & bit 25 LSB \\ \hline
[26:29] & Wilkinson ADC integration gate [3:0] & bit 29 LSB \\ \hline
[30:32] & Wilkinson ADC rundown current [2:0] & bit 32 LSB \\ \hline
[33:35] & Deadtime [2:0] & bit 35 LSB \\ \hline
[36:37] & Channel mode – channel 1 (top) [1:0] & \\ \hline
[38:39] & Channel mode – channel 2 [1:0] & \\ \hline
[40:41] & Channel mode – channel 3 [1:0] & ’00’  ON (active) \\ \hline
[42:43] & Channel mode – channel 4 [1:0] & ’01’  ON (active) \\ \hline
[44:45] & Channel mode – channel 5 [1:0] & ’10’  LO (forced) \\ \hline
[46:47] & Channel mode – channel 6 [1:0] & ’11’  HI (forced) \\ \hline
[48:49] & Channel mode – channel 7 [1:0] & \\ \hline
[50:51] & Channel mode – channel 8 (bottom) [1:0] & \\ \hline
[52] & Chip mode & ’0’ ADC, ’1’ ToT \\ \hline \end{tabular}
\end{table}
Table 10: Shift register bit assignment

\begin{table}
\begin{tabular}{|c|c|c|c|c|} \hline DATA\_IN & Data line from controller to ASD shift register input \\ \hline DATA\_OUT & Data line from ASD shift register output to controller \\ \hline CLK & Clock line \\ \hline D[0:2] & Register control lines \\ \hline \end{tabular}
\end{table}
Table 8: Serial interface signal lines

\begin{table}
\begin{tabular}{|c|c|c|c|c|} \hline Instruction & D0 & D1 & D2 & Operation \\ \hline SHIFT & 1 & 0 & X & Shift right at rising edge of CLK \\ \hline HOLD & 0 & 0 & X & Keep shift register contents (self feedback) \\ \hline DOWN & X & 1 & X & Copy contents of shadow register to shift register @ rising edge of CLK \\ \hline LOAD & X & X & 1 & Load shadow registers with contents of shift register (asynchronous) \\ \hline \end{tabular}
\end{table}
Table 9: Serial interface instruction encoding
Figure 29: Shift register image

IC layout

### Die and packaging

Eight channels of the ASD analog signal chain (Figure 2) and the serial I/O data interface plus DACs, registers and control logic for the programmable features are fabricated on a \(3180\leavevmode\nobreak\ \upmu\mathrm{m}\times 3720\leavevmode\nobreak\ \upmu\mathrm{m}\) die. The floor plan and the chip layout are shown in Figure 30. All analog inputs are placed on the left side of the chip while the LVDS outputs lie opposite. Top and bottom sides are taken by the digital I/O and power supply pads. \(\mathrm{V_{DD}}\) and GND buses are connected to pads on both top and bottom side of the chip to minimize voltage drops along the power buses.

Testability is provided by an adequate number of probe pads at crucial points across the layout. These pads however are accessible only by means of a probe station.

The chip is packaged using a rectangular 80-pin PQFP80E package with the dimensions \(14\leavevmode\nobreak\ \mathrm{mm}\times 20\leavevmode\nobreak\ \mathrm{mm}\) and a pin pitch of 0.8 mm. A pin-out diagram and a bonding diagram plus additional information on the package can be found in appendix 5.3.

### Substrate noise coupling

The MDT-ASD is a "mixed signal" ASIC and as such, careful attention must be paid to the issue of substrate noise coupling [23]. In particular, the Wilkinson Gate Generator subsection operates in essentially real time unlike the serial I/O programmable logic cells in the chip. This presents potential problems due to substrate coupled digital noise into the analog sections of the chip. To alleviate this potential source of coupling, the gate generator logic sub-cells are all custom built fully differential logic. Each rail-to-rail logic swing is accompanied by a complementary swing in close physical proximity. In addition, the logic cells are encircled by guard-rings connected to substrate nets which are tied to ground off-chip via dedicated wire bonds.

The option of back-plating the chip and tieing the substrate directly to the package ground by conductive glueing has been taken into consideration. However, tests on a small series of prototypes have shown no considerable effect of reducing substrate noise coupling.

Extensive testing has shown that coupling of the differential logic cells into the analog signal chain occurs at very low levels.

Figure 30: Octal MDT-ASD: Floor plan and chip layout for the HP 0.5 \(\upmu\mathrm{m}\) CMOS process

Prototyping - test and measurement results

All sub-circuits and building blocks of the MDT-ASD were prototyped at different stages of the development. One of the prototypes, dubbed "ASD light", a reduced-functionality4 4-channel chip was produced in larger quantities to be used for MDT chamber production testing. The following sections contain test and measurement results taken from different prototype chips, but mainly from the final octal prototype ASD00A. All results are produced by the final sub-circuit versions as implemented on ASD00A and intended to be identical on the production version of the chip.

Footnote 4: Although ASD99b does not contain the final functionality (charge ADC, programmability, etc.) it meets all analog specifications.

### Sub-circuits and building blocks

#### 4.1.1 Bipolar shaper

Figure 31 shows oscilloscope traces of the shaper delta pulse response (top) and its integral (bottom). The bipolar shaped pulse achieves area balance after ~ 400 ns which is slightly better than the specification value of 500 ns (compare 2.4.3).

Figure 31: Bipolar shaper pulse (delta response) and integral. Area balance at ~ 400 ns.

#### 4.1.2 Amplifier sensitivity

Figure 33 shows oscilloscope traces of the shaper output at the threshold coupling point. The measurements were taken with a calibrated probe using well defined input charges. The peaking time (time between the arrows) is 14.4 ns. There is a probe attenuation of 10:1 which is not accounted for in the peak voltage values in the left hand column. Due to the differential architecture, the voltages have to be multiplied by a factor 2 to obtain the total gain.

Figure 32: Shaper output for 40, 60, 80 and 100 fC input charge. The peak voltages translate into the sensitivity curve below by multiplying with a factor of two (single-ended to differential) and taking into account a probe attenuation of 10:1.

#### 4.1.3 Discriminator time slew

Due to the finite rise time of the signal at the discriminator input, different signal amplitudes with respect to the threshold level produce different threshold crossing times. This effect is called time slew. Figure 34 shows the time slew as measured for a constant threshold by varying the input charge and for a constant input signal by scanning the threshold. The time slew in the expected charge region (\(\sim\) 20 - 80 fC) is of the order 2 - 3 ns.

Figure 34: Time slew of the MDT-ASD signal chain. The slew is the timing of the discriminator 50% point of transition as a function of input signal amplitude for a 20 mV threshold.

Figure 33: Sensitivity of the analog signal chain (Pre-amp to shaper) for the expected input signal range. The gain amounts to – 10 mV/fC, exhibiting very good linearity.

#### 4.1.4 Wilkinson ADC performance

The transfer characteristic of the Wilkinson charge ADC is plotted in Figure 35. The traces show the non-linear relation between input charge and output pulse width for 4 different integration gates. The advantage of this compressive characteristic is that small signals which require a higher degree of time slew correction gain from a better charge measurement resolution. The disadvantage is an increased number of calibration constants. The dynamic range spans from 90 ns (8 ns gate) to 150 ns (45 ns gate).

Figure 35: Width of the Wilkinson ADC output pulse as a function of input charge for 4 different integration gate widths (left).

[MISSING_PAGE_EMPTY:42]

Figure 37: VDAC differential non-linearity Figure 38: VDAC integral non-linearity

#### 4.1.6 Timing discriminator hysteresis DAC

Hysteresis is applied to the discriminator via a scaled transistor current source DAC. Figure 39 shows the measured transfer characteristic and differential non-linearity of the DAC. The maximum differential non-linearity amounts to \(\pm\)5 \(\upmu\)A at an LSB of 35 \(\upmu\)A.

#### 4.1.7 Serial data interface

Tests on the control data interface showed full functionality according to the specifications. The data interface was tested up to a clock frequency of 150 MHz. No data corruption was observed. Registers and logic were tested to work within a supply voltage range of 2.0 V to 5.0 V.

### 4.2 System performance

#### 4.2.1 Noise behaviour and non-systematic measurement errors

The timing information carried by the ASD output signal is recorded and converted by the AMT (Atlas Muon TDC) time-to-digital converter [3]. The AMT can be set to provide a dynamic range for the pulse width measurement of 0 - 200 ns with a bin size of 0.78 ns [3]. If the ASD is programmed to produce output pulses up to a maximum of 200 ns, then the combination of the ASD and the AMT chip represents a charge-ADC with a resolution of 7 - 8 bits.

Non-systematic errors in the timing and charge measurement due to electronic noise in the ASDs and AMTs and quantization errors set a limit to the performance of the system. The following two sections present test results on the noise performance of the ASD and determine how the noise introduces error and degrades the accuracy of the measurements.

#### 4.2.1.1 Time measurement

Figure 40 shows the measured RMS error of the leading edge time measurement at the output of the ASD as a function of threshold overdrive. The lower curve gives the noise for floating pre-amplifier inputs while the upper curve includes the effect of the 380 \(\Omega\) tube termination resistor. The threshold is set to its nominal value of 60 mV (corresponding to \(\sim\) 6 fC). The horizontal axis gives the charge of the input signal applied through the test pulse injection system. Typical muon signals are in the range of 40 - 50 fC resulting in a RMS error of the order of 200 ps.

The time-to-digital conversion in the AMT shows a RMS error of 305 ps, including 225 ps of quantization error [4]. The resulting total error of the time measurement, covering all noise sources from the front-end down to the A/D conversion, will typically be of the order of 365 ps RMS.

Figure 39: Hysteresis DAC transfer curve and differential non-linearity.

#### 4.2.1.2 Charge measurement

Variations in the pulse width at the ASD output are typically below 600 ps RMS, depending on signal amplitude and integration gate width (Figure 42). Figure 43 shows the ASD Wilkinson noise versus threshold overdrive in percent of the measured charge for 3 short integration gate widths. The pulse width conversion (two independent pulse-edge quantizations) in the AMT shows a RMS error of 430 ps including quantization error. Hence, the resulting total error, covering all noise sources from the front-end down to the A/D conversion, stays in the range of under 800 ps RMS. This number corresponds to a typical error of well below 1% of the measured charge for the vast majority of signals (Figure 43).

Figure 41: Measured AMT conversion error including quantization noise [4].

Figure 40: RMS error of the leading edge timing measurement vs. input charge for a fixed discriminator threshold (set to its nominal value of 60 mV or 5 IC). Typical muon signals will be of the order of 40 - 50 IC. Bottom curve: floating pre-amp input, top curve: with 380 \(\Omega\) tube termination resistor.

The effect of the tube termination resistor can be seen in Figure 44 (also Figure 40). Contributing about 4000 e' ENC, this termination resistor constitutes the dominant noise source of the read-out system [5].

All systematic charge measurement errors like converter non-linearities and channel-to-channel variations can be calibrated out using the ASD's programmable test pulse injection system.

Figure 42: RMS error of Wilkinson pulse width at the output of the ASD as a function of input signal charge for a fixed discriminator threshold (nominal).

Figure 43: RMS error of Wilkinson pulse width at the output of the ASD as a function of input signal charge for a fixed discriminator threshold (nominal), given in percent of the measured charge. Note the decrease in noise for growing integration gate widths.

Figure 44: Effect of the 380 \(\Omega\) tube termination resistor on the charge measurement error.

#### 4.2.2 Power consumption

Figure 45: Measured power consumption versus supply voltage for one channel of the octal ASD00A prototype. The consumption is < 35 mW / channel.

Appendix-A

### MOS transistor models

MODEL CWOSN INOS *VERSION - 3.1 *TNOM - 27 *TOX - 9.6E-9 *XJ = 1.5E-7 *NCH - 1.7E17 *VTR0 - 0.6607278 *K1 - 0.7328155 K2 - - 0.0164557 K3 - 37.6307825 *K3B - - 0.6626036 W0 - 5.954482E-6 *NLX - 1.160795E-8 *DUTOW - 0  DUT1W - 0  DUT2W - 0 *DUT - 5.9023096 DUTI - 1.0356475 DUTZ - -0.1928577 *U0 - 494.0166594 UA - 5.793483E-10 *UB - 1.286576E-18 *UC - 3.434774E-11 *VSAT - 1.25997625 A0 - 0.9390877 *A0B - 0.1848153 B0 - 2.222029E-6 B1 - 5E-6 *KETA - 1-7.11141E-3 A1 - 0 &A2 - 1 *KDSW - 1.640042B3 PRWG - 0.0418215 PRWB - 0.0750653 *WR - 1  WINT - 2.612312E-7 *LINT - 1.1148382-7 *XL - -1E-7 *XN - 0 &DUG - 1.709665E-8 *DWB - 1.235807E-8 *VPPP - -0.0896698 NFACTOR - 1.2143784 *CIT - 0 &CSDC - 1.1717654-4 *CSDC - 2.973469E-5 *PFAO - 1.7126923-3 *PHA - 3.4153E-3 *DSUB - 0.7387012 PCLM - 0.6279545 PDBLCI - 0.0416968 *PDBLCI2 - 3.027171E-3 *PDBLCI - 0.1 &DROUT - 0.4026747 *BCSB1 - 3.664597E10 PSCB2E - 1.6701E-8 *PVAG - 0.1613363 *DBLTA - 0.01 &MORMOD - 0.1613363 *UTE - -1.5 &KT1 - 0.11 &KT1L - 0 *KT2 - 0.022 &U1 - 4.31E-9 *UBL - -7.61E-10 *UCl - -5.6E-11 &AT - 3.324 &WL - 0 *WLIN - 1.117 &KT1L - 0 *WLIN - 0 &LL - 0 &LLN - 1 &L - 0 &LLN - 1 *LAN - 0 &LNN - 1 &LML - 0 &CAPMOD - 2 &XPART - 0.4 &CODO - 2.51E-10 *CSDO - 2.51E-10 *CSDO - 2.51E-10 *CSDO - 2.18-11 &CJ - 5.06534E-4 *PB - 0.99 &MJ - 0.7315511 CJSW - 4.076138E-10 *PBSW - 0.99 &MJSW - 0.1 &PVTH0 - 3.611855E-4 *PRDSW - 47.8578499 PK2 - 8.209074E-3 *NKETA - 5.880416E-3 *LKETA - 1.690549E-3 *PAGS - 0.0968

MODEL CWOSP MOS *VERSION - 3.1 *TNOM - 27 *TOX - 9.6E-9 *XJ = 1.5E-7 *NCH - 1.7E17 *VTR0 - -0.8451175 *K1 - 0.374455 K2 - 0.0214736 K3 - 4.5726678 *K3B - -1.4496401 W0 - 5.256776E-6 *NLX - 8.640935E-8 *DVTW0 - 0 &DVT1W - 0 &DVT2W - 0 &DVT3W - 3.893012 DVT1 - 0 &DUTO - 3.893012 DVT1 - 0.6051434 DVT2 - 0.0821732 *U0 - 179.9725329 UA - 1.189439E-9 UB - 1.189025E-18 *UC - 5.01386E-11 VSAT - 1.831276E5 A0 - 0.6676752 A0S - 0.325462 A0 - 5.7206767E-6 B1 - 5E-6 *KETA - 9.86091E-4 A1 - 0 &A2 - 1 *RDSW - 2.476373E3 PRWG - 0.0212227 PRWB - -0.0823133 *WR - 1 &NINT - 2.441032E-7 LINT - 4.330033E-8 *KL - 1E-7 &XN - 0 &DUG - 2.061704E-8 *DWB - 1.11758E-8 VOPP - 0.0956807 NFACTOR - 0.9637884 *CIT - 0 &CDSC - 5.707153E-4 CDSC - 2.3673774-4 *CSDC - 1E-3 &PFAO - 0.694355 RTAB - 5.61067E-3 *DSUB - 0.3174305 PCLLM - 5.4525904 PDBLCI - 1.491356E-4 *PDBLCI2 - 4.327953E-3 *PDBLCI2 - 0.0181933 PROWT - 9.994143E-4 *DSCBCB1 - 1.2510596E10 BCBCB2E - 5.001074E-10 PVAG - 14.98313684 *DELTA - 0.01 &MOMOD - 1 &PTT - 0 *UTPE - -1.5 &KT1 - 0.11 &KT1L - 0 &KT2 - 0.022 &U1a1 - 4.31E-9 *U1B1 - -7.61E-18 *UC1 - 5.6E-11 &AT - 3.324 &WL - 0 *WLIN - 1 &WW - -1.245E-15 WWN - 1.025 *NML - 0 &LL - 0 &LLN - 1 &LLN - 0 &LLN - 0 &LLN - 0 &LLN - 0 &LAN - 1 &LML - 0 &LAN - 1 &LML - 0 &CARMOD - 2 &XPART - 0.4 &CODO - 2.44E-10 *CSDO - 2.44E-10 *CSDO - 2.44E-10 *CSDO - 1E-11 &CJ - 9.335184E-4 *PB - 0.9260485 MJ - 0.4724799 CJSW - 1.466932E-10 *PBSW - 0.4542609 MJSW - 0.1167867 PVTH0 - 5.089527E-3

* 37.6262554 PK2
- 2.784938E-3 WKETA

### LVDS driver properties

The characteristics of the MDT-ASD LVDS-drivers on an ASD99D were assessed according to the specifications in the IEEE P1596.3 (LVDS) standard document.

#### 5.2.1 Driver DC specifications

Table 12 gives the LVDS "reduced range link" driver DC specifications for a nominal 100 \(\Omega\) termination and results from measurements at a power supply voltage of 3.3 V. All measurement results lie within the specifications at nominal conditions.

Figure 46 shows the variation of the driver dc levels as a function of the power supply voltage VDD. The upper voltage level V\({}_{\mathrm{oh}}\) remains below the specified maximum up to a VDD of 3.42 V. The lower voltage level V\({}_{\mathrm{ol}}\) remains above the specified minimum down to a VDD of 2.9 V. The output offset voltage V\({}_{\mathrm{os}}\) stays within the specified range for a VDD between 3.0 V and 3.3 V.

Figure 47 shows the dependency of the driver output differential voltage V\({}_{\mathrm{od}}\) on the power supply voltage VDD. V\({}_{\mathrm{od}}\) lies within the specified range from VDD = 3.17 V to VDD well above 3.6 V.

Driver DC levels are measured to lie within the LVDS reduced range link standard specification for a power supply voltage variation from 3.17 V to 3.3 V (VDD\({}_{\mathrm{nom}}\)- 4% to VDD\({}_{\mathrm{nom}}\)+ 0%) at nominal termination (100 \(\Omega\)).

Figure 48 and Figure 49 show the variation of the driver dc levels as a function of the power supply voltage for a termination resistance R\({}_{\mathrm{load}}\) = 200 \(\Omega\), V\({}_{\mathrm{oh}}\) exceeds the upper limit at VDD = 3.22 V, V\({}_{\mathrm{os}}\) stays in range from 3 V to 3.44 V, V\({}_{\mathrm{ol}}\) from 3.05 V upwards.

The variation of the driver output differential voltage V\({}_{\mathrm{od}}\) as a function of load resistance is shown in Figure 50. V\({}_{\mathrm{od}}\) remains within the specified limits for R\({}_{\mathrm{load}}\) from 90 \(\Omega\) to 150 \(\Omega\) at VDD = 3.3 V.

\(\Delta\)V\({}_{\mathrm{os}}\), the change in output offset voltage between '0' and '1' is shown in the bottom oscilloscope trace of Figure 51. V\({}_{\mathrm{oa}}\) and V\({}_{\mathrm{ob}}\) are represented by the top traces labelled 1 and 2. The amplitude cursor yields a difference of 2 mV. This number has to be divided by 2 according to V\({}_{\mathrm{os}}\) = (V\({}_{\mathrm{oa}}\)+ V\({}_{\mathrm{ob}}\))/2, yielding the value of 1 mV in Table 12.

\(|\Delta\)V\({}_{\mathrm{od}}|\) was measured in a similar way (compare Figure 54).

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|} \hline \hline Symb. & Parameter & Conditions & Min & Max & Meas & Unit \\ \hline V\({}_{\mathrm{oh}}\) & Output voltage high, V\({}_{\mathrm{oa}}\) or V\({}_{\mathrm{ob}}\) & R\({}_{\mathrm{load}}\) = 100 \(\Omega\pm\) 1\% & & 1375 & 1335 & mV \\ \hline V\({}_{\mathrm{ol}}\) & Output voltage low, V\({}_{\mathrm{oa}}\) or V\({}_{\mathrm{ob}}\) & R\({}_{\mathrm{load}}\) = 100 \(\Omega\pm\) 1\% & 1025 & & 1165 & mV \\ \hline \(|\)V\({}_{\mathrm{od}}|\) & Output differential voltage & R\({}_{\mathrm{load}}\) = 100 \(\Omega\pm\) 1\% & 150 & 250 & 170 & mV \\ \hline V\({}_{\mathrm{os}}\) & Output offset voltage & R\({}_{\mathrm{load}}\) = 100 \(\Omega\pm\) 1\% & 1150 & 1250 & 1250 & mV \\ \hline R\({}_{0}\) & Output impedance, single ended & V\({}_{\mathrm{cm}}\) = 1.0V and 1.4V & 40 & 140 & - & \(\Omega\) \\ \hline \(\Delta\)R\({}_{0}\) & R\({}_{0}\) mismatch between a \& b & V\({}_{\mathrm{cm}}\) = 1.0V and 1.4V & & 10 & - & \% \\ \hline \(|\Delta\)V\({}_{\mathrm{od}}|\) & Change in \(|\)V\({}_{\mathrm{od}}|\) between '0’ and ’1’ & R\({}_{\mathrm{load}}\) = 100 \(\Omega\pm\) 1\% & & 25 & 2 & mV \\ \hline \(\Delta\)V\({}_{\mathrm{os}}\) & Change in V\({}_{\mathrm{oa}}\) between ’0’ and ’1’ & R\({}_{\mathrm{load}}\) = 100 \(\Omega\pm\) 1\% & & 25 & 1 & mV \\ \hline I\({}_{\mathrm{sa}}\), I\({}_{\mathrm{sb}}\) & Output current & Driver shorted to ground & 40 & 3.7 & mA \\ \hline I\({}_{\mathrm{sab}}\) & Output current & Drivers shorted together & 12 & 1.5 & mA \\ \hline \hline \end{tabular}
\end{table}
Table 12: LVDS ”reduced range link”: Driver DC specifications and ASD LVDS driver properties measured at V\({}_{\mathrm{au}}\)= 3.3VThe short-circuit output currents \(\mathrm{I_{as}}\), \(\mathrm{I_{sb}}\) and \(\mathrm{I_{sub}}\) were measured according to the definitions in the LVDS standard document.

Figure 46: Driver DC levels \(V_{\text{oa}}\), \(V_{\text{oa}}\), \(V_{\text{oa}}\) vs. supply voltage at nominal load (100 \(\Omega\))

Figure 47: Driver differential voltage \(V_{\text{od}}\) vs. supply voltage at nominal load (100 \(\Omega\))

Figure 48: Driver DC levels \(V_{\text{oa}}\), \(V_{\text{od}}\), \(V_{\text{oa}}\) vs. supply voltage at 200 \(\Omega\) load

#### 5.2.2 Driver AC specifications

The LVDS standard document specifies AC parameters for clock and data signals. Relevant for MDT-ASD are rise- and fall-time and differential skew, while clock signal duty cycle and channel-to-channel skew are not applicable. Table 13 gives the LVDS driver AC specifications for a nominal 100 \(\Omega\) termination and results from measurements at a power supply voltage of 3.3 V. Rise- and fall-time (Figure 53) exceed the specifications by a factor of 2, skew (Figure 55) lies well within specs. The measurements were done under conditions illustrated in Figure 52.

Figure 50: Driver differential voltage vs. load resistance

[MISSING_PAGE_EMPTY:54]

The skew measured in Figure 55 is the time difference between the high-to-low and low-to-high transitions of complementary single ended channels measured at the 50% level. The measured value of 20 ps is well below the specified maximum of 50 ps.

[MISSING_PAGE_EMPTY:56]

Standard for Low-Voltage Differential Signals (LVDS) for Scalable Coherent Interface (SCI), IEEE P1596.3-1995 standard document.

### Packaging information

#### 5.3.1 Pin out diagram

(58)

#### PQFP80 package

[FIGURE:Ch

[MISSING_PAGE_EMPTY:60]

## 6 Appendix - B Parameter setup guidelines

The MDT-ASD has 11 programmable registers which total 53 bits as shown in the table below (Channel Mode is considered two 8-bit registers)

\begin{tabular}{||c|c|c||} \hline
**JTAG bit** & **Description** & **LSB/code** \\ \hline
[0:7] & Channel mask register [0:7] & bit 0 channel 0 \\ \hline
[8:10] & Calibration injection capacitor select [2:0] & bit 10 LSB \\ \hline
[11:18] & Main threshold DAC (DISC1) [7:0] & bit 18 LSB \\ \hline
[19:21] & Wilkinson ADC threshold DAC (DISC2) [2:0] & bit 21 LSB \\ \hline
[22:25] & Hysteresis DAC (DISC1) [3:0] & bit 25 LSB \\ \hline
[26:29] & Wilkinson ADC integration gate [3:0] & bit 29 LSB \\ \hline
[30:32] & Wilkinson ADC rundown current [2:0] & bit 32 LSB \\ \hline
[33:35] & Deadtime [2:0] & bit 35 LSB \\ \hline
[36:37] & Channel mode - channel 0 (top) [1:0] & \\ \hline
[38:39] & Channel mode - channel 1 [1:0] & \\ \hline
[40:41] & Channel mode - channel 2 [1:0] & '0x' Active \\ \hline
[42:43] & Channel mode - channel 3 [1:0] & '10' Force Lo \\ \hline
[44:45] & Channel mode - channel 4 [1:0] & '11' Force Hi \\ \hline
[46:47] & Channel mode - channel 5 [1:0] & \\ \hline
[48:49] & Channel mode - channel 6 [1:0] & \\ \hline
[50:51] & Channel mode - channel 7 (bottom) [1:0] & \\ \hline
[52] & Chip mode & '0' ADC, '1' ToT \\ \hline \end{tabular}

In order to accurately program the chip, one needs to know the relationship between the downloaded register values and the corresponding parameters, such as Wilkinson gate width, rundown current, etc. These relationships are extracted for each chip during production chip test and are recorded into a database. They are described in the following sections and typical values derived from measurements of approximately 10k chips. The data base of tested chips is found at [http://hepldb.harvard.edu/elec1/ASDmain.asp](http://hepldb.harvard.edu/elec1/ASDmain.asp)

A description of the chip testing procedure, database parameters, and quality codes, can be found in the Chip Tester User's Manual at [http://huhepl.harvard.edu/](http://huhepl.harvard.edu/)\(\sim\)oliver/UsersManual.pdf

### Discriminator

#### 6.1.1 Threshold

Recommended threshold setting is determined by the chip's gain, noise levels, and offset voltages. The gain or "sensitivity" of the ASD depends on whether or not the inputs are "terminated", meaning whether or not the card is plugged into a terminated chamber (or dummy terminations). When terminated, the gain is reduced by approximately 20%. Threshold dispersion refers to the rms spread in offset voltages as measured over a large number of channels. Typical values for a terminated MDT-ASD are;

\begin{tabular}{||c|c|c||} \hline \hline Parameter & Typical value & Comments \\ \hline Sensitivity & 8.9 mv/fc & Delta response \\ \hline Single electron response (SPICE) & 1.65 mv/pe & @ 2*10*4 gas gain \\ \hline RMS noise & 7.8 mv & \\ \hline enc & 5500 electrons rms & Delta function referred \\ \hline enc & 4.7 pe & Primary electron referred \\ \hline \end{tabular}

Note that the amplifier's response to a single electron in the MDT is computed by convoluting the assumed shape of the pulse tail with the delta response. This is done in SPICE and the results quoted above. In order to operate the chip at 5\(\sigma\) above thermal noise level, the nominal threshold must be set to;

\[\text{V}_{\text{thr(nominal)= - 39 mv}}\]

In terms of primary electrons, this is equivalent to

\[PE(thr)=\frac{40mv}{1.65\,mv}=23.7\,primary\,\,electrons\]

This value is higher than the target value of 20 primary electrons so that to achieve the target value, the MDTs would have to operate at a slightly higher gas gain of 2.4*10\({}^{\circ}\)4.

#### 6.1.2 Noise rates

For any particular threshold setting, we expect to get random noise hits which are Poisson distributed in time and a Gaussian function of threshold as shown below.

\[R(x)=R_{0}\cdot e^{-\frac{(x-V_{\text{off}})^{2}}{2\cdot\sigma^{2}}}\]

where R\({}_{0}\) is the maximum rate of hits, V\({}_{\text{off}}\) is the measured offset voltage of the channel, s is the rms noise voltage, and x is the threshold setting. The parameters R\({}_{0}\), V\({}_{\text{off}}\), and \(\sigma\) are extracted during production chip testing for each channel and placed in the production database. Typical values for peak rates are \(\sim\)20MHz so that for zero offset, we expect thermal noise rates of

\[R(5\cdot\sigma)\approx(20MHz)\cdot e^{-\frac{5^{2}}{2}}\approx 75Hz\]

Typical noise plots are shown below for offsets of 0 and - 6 mv respectively.

Note that the offset of - 6 mv results in a noise rate increase of about 50 fold and we therefore expect this channel to be a "hot channel". In general, for a channel with non-zero offset, when operating at 5\(\sigma\) we expect the noise hit rate to increase by the factor;

\[\begin{array}{c}R\dot{\diagup}R=e^{\frac{-5V_{\mathit{off}}}{\sigma}}\approx 2x \text{ {factor per mv of negative offset}}\end{array}\]

When taking such noise scans, neither the AMT-3, nor the DAQ systems can measure noise rates beyond about one half megahertz or so. The chip test procedure, however, uses a counter to measure the rates directly, and has confirmed the Gaussian nature of this curve over the entire threshold range.

For each chip, the database contains a _signed offset correction_ which is taken as the mean between the maximum and minimum offsets of the eight channels on the chip. This correction should be added to the nominal desired threshold setting. "Quality 1" chips are selected by cutting on maximum offset spread of less than a 12 mv total across all eight channels of the chip. Thus, if the offset correction is downloaded, no channel will have an effective offset of worse than 6 mv in either direction.

Of course, none of this precludes operation at more conservative threshold values of -44 mv, for example, or even higher. The final recommended nominal threshold setting will have to come from on-chamber noise and resolution studies.

#### Hysteresis

Hysteresis is utilized simply to provide clean transitions of the discriminator through its firing point.

Hysteresis is set by a 4-bit code as follows;

\[\begin{array}{c}\mathit{Hysteresis}\equiv 1.25mv\cdot N\end{array}\]

where \(\,N=0,1,...\,15\)Hysteresis does, by necessity, cause an effective threshold shift, which is equal to the nominal hysteresis setting. Thus a hysteresis setting of 2.5 mv, for example, shifts the actual firing point by 2.5 mv away from zero. In this example, a setting of -39 mv, will result in an effective threshold of -41.5 mv. Thus, to maintain an actual threshold of -39 mv, the threshold register must be set to -37 mv. The final recommendation for hysteresis setting must be gained from experience, but a reasonable starting point would be in the range of 1.25 mv to 5.0 mv.

### 6.2 Wilkinson parameters

#### Gate width

Wilkinson gate width refers to the charge integration period at the leading edge of the pulse. It is set by a 4-bit code, N, which corresponds to the physical gate width as follows,

\[Tgate=(11+1.5\cdot N)ns\]

While the gate width is not directly observable, its effect on the output pulse width is measured and characterized by a quadratic expression, whose parameters are found in the chip-test database.

\[T_{out}=A\_gate\cdot N^{\ 2}+B\_gate\cdot N+C\_gate\]

Typical values are shown below.

\begin{tabular}{|c|c|c|} \hline Parameter & Typical value & Units \\ \hline A\_gate & -0.83 & ns \\ \hline B\_gate & 15.2 & ns \\ \hline C\_gate & 114 & ns \\ \hline Typical T\({}_{out}\) at N = 0 & 114 & ns \\ \hline Typical T\({}_{out}\) at N=15 & 155 & ns \\ \hline \end{tabular}

A typical measurement of output pulse width vs W\({}_{gate}\) programming code is shown below.

\begin{tabular}{|c|c|c|} \hline Parameter & Typical value & Units \\ \hline A\_gate & -0.83 & ns \\ \hline B\_gate & 15.2 & ns \\ \hline C\_gate & 114 & ns \\ \hline Typical T\({}_{out}\) at N = 0 & 114 & ns \\ \hline Typical T\({}_{out}\) at N=15 & 155 & ns \\ \hline \end{tabular}

A typical measurement of output pulse width vs W\({}_{gate}\) programming code is shown below.

\begin{tabular}{|c|c|c|} \hline Output pulse width vs Wikinson gate code & \\ \hline

[MISSING_PAGE_POST]

Note that this curve corresponds to measurements made during production chip testing using delta function charge injection. Measurements made on-chamber will be different.

#### 6.2.2 **Rundown current**

Rundown current[ see note \({}^{5}\)] refers to the programmable discharge current of the hold capacitors after the Wilkinson integration period. It can be set to a nominal value of between 2.4 \(\upmu\)a and 7.3 \(\upmu\)a in steps of 0.7 \(\upmu\)a. The current cannot be measured directly however, but its effect on the output pulsewidth is recorded and its parameterized coefficients are placed in the database.

\[T_{out}=A\_\_\,Rund\cdot Nbar\,^{2}+B\_\,Rund\cdot Nbar\,+C\_\,Rund\]

where N takes values of 0,1,.... 7. Typical values are shown below.

\begin{tabular}{|c|c|c|} \hline Parameter & Typical value & Units \\ \hline A\_Rund & -0.83 & ns \\ \hline B\_Rund & 15.2 & ns \\ \hline C\_Rund & 114 & ns \\ \hline Typical value at N=7 & 256 & ns \\ \hline Typical value at N=0 & 120 & ns \\ \hline \end{tabular}

A plot of typical pulse width values corresponding to programming code is shown below.

\begin{tabular}{|c|c|c|} \hline Parameter & Typical value & Units \\ \hline A\_Rund & -0.83 & ns \\ \hline B\_Rund & 15.2 & ns \\ \hline C\_Rund & 114 & ns \\ \hline Typical value at N=7 & 256 & ns \\ \hline Typical value at N=0 & 120 & ns \\ \hline \end{tabular}

Note \({}^{5}\) : 6 June 2003 - Rundown current actually decreases with increasing register value, while rundown time increases. Thus, plot is shown as a function of Nbar which is the bit for bit inverse of N. Thus, the register is to be loaded with N, while time is computed as a function Nbar.

#### 6.2.3 Disc2 threshold

This refers to the discriminator whose firing defines the end of the rundown period. Its effect on the output pulse width is exceedingly minimal. While the Chip Tester can determine its characteristics, this feature has not been implemented and no database entries are made.

#### 6.2.4 Transfer curve

The Wilkinson transfer curve measures the output pulse width as a function of input charge for each channel of the chip. Since input charge is injected by the on-chip calibration capacitors its value depends on the size of the applied strobe step and the number of caps. This applied step size has been set in the Chip Tester but its important to note that its value on the Mezzanine cards may be somewhat different.

There are eight cal_inject capacitors per channel, each of which has a nominal value of 50 ff. Once a channel is enabled by setting its mask bit, anywhere from 1,2,... 8 caps can be selected.

It should be noted that a "channel 0" effect has been discover in the chip tester which invalidates the parameters extracted for this channel. The technical reasons for this have nothing to do with the chip, but are an artifact of the tester. It is due to the close proximity of a STROBE line to the ASD's channel 0 input line and there is nothing to be done about it at this point. Values are placed in the database, but note that channel zero data are not particularly meaningful and should be excluded when taking averages or histograms. This feature has been observed in the transfer curve test, but not in any of the others.

\begin{tabular}{|c|c|c|} \hline Parameter & Typical value & Units \\ \hline A\_Xfer & -3.1 & ns \\ \hline B\_Xfer & 36.8 & ns \\ \hline C\_Xfer & 67.1 & ns \\ \hline Typical value at N=0 [\({}^{\circ}\)] & 67 & ns \\ \hline Typical value at N=7 & 173 & ns \\ \hline \end{tabular}

Note that codes = 0,1,..., 7 correspond to 1,2,..., 8 calibration caps.

#### 6.2.5 Deadtime

Programmable deadtime is measured by a double pulse / binary search routine during chip testing and its parameters placed in the database. It is defined as the time between the trailing edge of one pulse and the leading edge of the second; in other words, the time minimum time between pulses. The allowed separation between leading edge of one pulse and leading edge of the second, is therefore the sum of the average deadtime plus the average pulse width. Its max value will be in the neighborhood of 600 ns. It should be noted that the design target for deadtime was 1,000ns and earlier versions of Mini-DAQ refers to this maximum. Deviations of the manufactured chips from the design models resulted in this smaller figure.

Deadtime is a linear function of programming code as follows7

Footnote 7: Updated in Ver1.05

\[\begin{array}{c}\mbox{\it Dead}\;\;time=A\_prog\cdot N+B\_prog\end{array}\]

#### 6.2.6 Eqn 6-1

Typical values and plots are shown below.

### Summary : Nominal operating settings

Below is a table of nominal settings used in the Chip Tester and database. We expect those values to be very close to the ones used on the mezz cards on-chamber.

\begin{tabular}{|c|c|c|c|c|} \hline Parameter & No bits & \begin{tabular}{c} Nominal \\ Value \\ \end{tabular} & 
\begin{tabular}{c} Nominal \\ Code (dec) \\ \end{tabular} & Expression \\ \hline Disc1 threshold & 8 & -39 mv & 108 & (2*N - 255) mv \\ \hline Disc1 hysteresis & 4 & 2.5 mv & 2 & N*1.25 mv \\ \hline Wgate & 4 & 20 ns & 6 & (11 + 1.5*N) ns \\ \hline Disc2 threshold & 3 & 30 mv & 6 & (126 - 16*N) mv \\ \hline W\_Rundown & 3 & 5.9 \(\upmu\)a & 2 & (7.3 - 0.7*N) \(\upmu\)a \\ \hline Deadtime & 3 & 535 ns & 7 & (17 + 74*N) \\ \hline \end{tabular}

## References

* [1] M. Aleksa, W. Riegler, Non-Linear MDT Drift Gases like Ar/CO2, ATLAS Internal Note, ATL-MUON-98-268, Dec. 1998
* [2] M. Aleksa, M. Deile, N. Hessey, W. Riegler, MDT Performance in a High Rate Background Environment, ATLAS Internal Note, ATL-MUON-98-258, Oct. 1998
* [3] Y. Arai, AMT-1, ATLAS Muon TDC Version 1, User's Manual, KEK, [http://atlas.kek.jp/~araiy](http://atlas.kek.jp/~araiy), June 2000
* [4] Y. Arai, Preliminary Design Review of the MDT Electronics (TDC part) [http://arkhp01.kek.jp:80/~araiy/TDC](http://arkhp01.kek.jp:80/~araiy/TDC) PDR.pdf, Feb. 2001
* [5] C. Blocker, John Huth, John Oliver, Noise Considerations for the Atlas Muon Front-End Electronics, ATLAS Internal Note, MUON-NO-080, CERN, April 1995
* [6] F.Faccio, C.Detcheverry, M.Huhtinen, First evaluation of the Single Event Upset (SEU) risk for electronics in the CMS experiment, CMS Internal Note, CERN CMS NOTE 1998/054 (1998)

* [8] K.J. Hass, J.W. Gambles, B. Walker, M. Zampaglione, Mitigating Single Event Upsets From Combinational Logic, in Proceedings of 7th NASA Symp. on VLSI design, 1998
* [9] E. Hazen, J. Shank, T. Giordano, J. Huth, J. Oliver, Status of the Front End Electronics for the MDT System, ATLAS Internal Note, MUON-NO-111, CERN, March 1996
* [10] J. Huth, A. Liu, J. Oliver, Note on Noise Contribution of the Termination Resistor in the MDTs, ATLAS Internal Note, ATL-MUON-96-127, CERN, Aug. 1996
* [11] J. Huth, J. Oliver, W. Riegler, E. Hazen, C. Posch, J. Shank, Development of an Octal CMOS ASD for the ATLAS Muon Detector, Proceedings of the Fifth Workshop on Electronics for LHC Experiments, CERN/LHCC/99-33, Oct. 1999
* [12] F. M. Newcomer, S. Tedja, R. Van Barg, J. Van der Spiegel, H. H. Williams, IEEE Transactions on Nuclear Science NS-40 (4), March 1993
* [13] G. Novak, C. Posch, W. Riegler, Particle identification in the ATLAS Muon Spectrometer, ATLAS Internal Note, to be released, CERN, June 2001
* [14] J.V. Osborn, D.C. Mayer, R.C. Lacoe, S.C. Moss, and S.D. La Lumondiere, Single event latchup characteristics of three commercial CMOS processes, in Proceedings of 7th NASA Symp. on VLSI design, 1998
* [15] J.V. Osborn, R.C. Lacoe, D.C. Mayer, and G. Yabiku, Total Dose Hardness of Three Commercial CMOS Microelectronics Foundries, IEEE Trans. Nucl. Sci., vol. 45, p. 1458, 1998.