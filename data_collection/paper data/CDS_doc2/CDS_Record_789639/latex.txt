**ATL-NOTE MUON**

**August 14, 2004**

**A Prototype Detector Control System Setup at the H8 Muon Test Beam 2001**

**T. Alexopoulos, R. Avramidou, M. Dris, E.N. Gazis, S. Maltezos,**

**P. Oikonomou, P. Savva, G. Tsipolitis**

_Physics Department, National Technical University of Athens,_

_9, Heroon Polytechniou, GR-157 80, Athens, Greece_

This report describes the implementation of a prototype DCS setup based on the PVSSII SCADA system for the control and monitoring of the MDT chambers in the H8 Test beam facility during the summer of 2001. The project involved the design and installation of a setup for the MDT chambers temperature, the gas mixture, pressure and flow and the low voltage monitoring, as well as, creating a database for data archiving and manipulation.

This work involved designing and setting up a Detector Control System (DCS) for measuring, monitoring and archiving temperatures, gas parameters and voltages. This system consists of Pt100 and NTC 5k sensors connected to the Embedded Local Monitor Board (ELMB)[1] front-end IO electronics. The ELMB is a general-purpose plug-in board, which contains, amongst others, a 64 channel ADC with 16-bit resolution. The SCADA (Supervisory Control And Data Acquisition) system used is the PVSS-II software and it connects to the front-end electronics via an OPC Can-Bus.

The parameter space of the software system includes data points representing all elements of the setup, opportunities for archiving and alarm alerts, as well as, panels designed to monitor the output readings, calibrate the ELMB and process archived data. A web page was created so that current and archived data can be accessed remotely through the web. The project is capable to read more than one ELMB modules connected on the same Bus.

## 1 Measuring Temperatures (Pt100 and NTC 5k sensors) and Voltages

The ELMB mother-board has sockets on its backside to house 16 adapters. Different kinds of adapters are used to measure 4-wire Pt100 sensors, 2-wire NTC and voltages. Different adapters can be put on the same ELMB in order to make different types of measurements. The ADC range of the ELMB must be the same for all channels on each board and was set in the case of this project to be 100mV. The modules of the setup work in "unipolar" mode, thus the maximum precision for voltage measurements is \(100mV\,/\,65536\,{\approx}\,10^{-3}\,mV\), which is the restriction implied by the ADC. The desired precision for the temperatures is \(0.1^{\mathrm{o}}\mathrm{C}\).

### i. The Pt100 sensors

For the Pt100 connection a four-wire connection is used, which eliminates the effect of the wires' resistor. The sensor is connected to two channels as shown in the following Figure 1 (R\({}_{\mathrm{s}}\)=0.1k\(\Omega\) and R\({}_{\mathrm{c}}\)=3.9k\(\Omega\)).

The measured voltage is converted to temperature by the function [2]:

\[T_{P100}=\frac{3.9\cdot 10^{-3}-\sqrt{15.27\cdot 10^{-6}+2.31\cdot 10^{-6} \Bigg{[}1-\Bigg{(}\frac{V_{1}}{V_{0}}-\textit{offset}\Bigg{)}\cdot\frac{R_{ calibration}}{R_{specific}}\Bigg{]}}}{1.156\cdot 10^{-6}}-T_{\textit{offset}} \tag{1}\]

Figure 1: The circuit of a connected Pt100 4w sensor

The value of the measured resistor is \(R_{sensor}=\frac{V_{1}}{V_{0}}R_{s}\) (using the voltage divider formula) or

\[R_{sensor}=(\frac{V_{1}}{V_{0}}-offset)R_{calibration} \tag{2}\]

The total error of the resistor measurement is

\[dR_{sensor}=\sqrt{dR_{ADC}^{2}+dR_{calibration}^{2}} \tag{3}\]

The error due to the ADC accuracy is derived from eq.(2)

\[dR_{sensorADC}=R_{calibration}\sqrt{\left(\frac{dV_{1}}{V_{0}}\right)^{2}+\left( \frac{V_{1}\cdot dV_{0}}{V_{0}^{2}}\right)^{2}}\approx\sqrt{\frac{2}{36}}\cdot 1 0^{-4}\cdot 100\Omega\approx 0.002\ \Omega \tag{4}\]

where, \(V_{0}=IR_{sensor}\approx 0.6\cdot 0.1\ V\approx 0.06\ V\) and \(V_{1}=IR_{s}\approx 0.6\cdot 0.1\ V\approx 0.06\ V\). This error is negligible. Thus, the accuracy of the measurement is defined by the precision of the calibration and the stability of the adapter resistor.

The relationship between the temperature and the resistor error ( \(R_{specific}=100\ \Omega\) ) follows from eq.(1)

\[dT_{{}_{P100}}\approx\frac{2.31\cdot 10^{-6}\ dR}{2\cdot 1.156\cdot 10^{-6}\ R_{ specific}\sqrt{15.27\cdot 10^{-6}}}\approx 0.25dR_{sensor} \tag{5}\]

therefore the temperature error due to the ADC is \(dT_{{}_{P100}}\approx 10^{-3\ ^{\circ}}C\).

The desired precision is \(dT_{{}_{P100}}\approx 10^{-1\ ^{\circ}}C\rightarrow\ dR_{sensor}\approx 0.4\ \Omega\), which gives the upper limit for the precision for a 100 \(\Omega\) calibration resistor.

**ii. The NTC 5k sensors**

The NTC sensor is connected via a 2-wire connection to a channel of the ELMB as shown in the following Figure 2 (R=1M\(\Omega\)).

**Figure 2** Circuit of a connected NTC sensor The voltage to temperature conversion function is [2]:

\[T_{NTC5k}=15.007784+4.79707\cdot 10^{-5}R_{sensor}-10.96722\ln(R_{sensor})+\frac{878.19263}{\ln(R_{sensor})}-\frac{331724.614}{R_{sensor}^{2}}-T_{offset} \tag{6}\]

where

\[R_{sensor}=\frac{V_{ch}}{V_{ref}-V_{ch}}R_{adapter} \tag{7}\]

The error due to the ADC accuracy is

\[dR_{sensorADC}=\frac{V_{ref}\cdot dV}{V_{ref}-V_{ch}}R_{adapter}\approx 1\cdot 10^{-6} \cdot 1\ M\Omega=1\ \Omega \tag{8}\]

where \(V_{ch}=IR_{sensor}\approx\frac{2.5}{1M}\cdot 5kV\approx 2.5\cdot 10^{-3}V\).

The relationship between the temperature and the resistor error is

\[\begin{split} dT_{NTC5k}=&\Bigg{(}4.79707\cdot 10^{- 5}-\frac{10.96722}{R_{sensor}}-\frac{878.19263}{\ln^{2}(R_{sensor})}\frac{1}{R_{ sensor}}+2\frac{331724.614}{R_{sensor}^{3}}\Bigg{)}dR_{sensor}\\ dT_{NTC5k}\approx&-5\cdot 10^{-3}\ dR_{sensor}\end{split} \tag{9}\]

Thus, the temperature error due to the ADC precision is \(dT_{NTC5k}\approx 5\cdot 10^{-3\ \sigma}C\), well below the required tolerances. The limit of the calibration resistor (\(R_{adapter}\approx 5\ k\Omega\) ) precision is \(dR_{adapter}\approx 20\ \Omega\). The desired precision is \(dT_{NTC}\approx 10^{-1\ \sigma}C\Rightarrow\ dR_{adapter}\approx 20\ \Omega\), which gives the upper limit for the precision for a 5 k\(\Omega\) calibration resistor.

**iii. The Voltage measurement**

In order to measure voltages a differential attenuator is used, which is shown in Figure 3

Figure 3: Circuit used for a voltage measurement

The ratios of the resistors of the adapter are such, so that the voltages fit the ADC range (100:1 divider). The measured voltage by the ADC is analogue to the voltage connected to the adapter and thus the precision of the measurement mainly depends on the accuracy of the calibration and the stability of the adapter resistors.

## 2 The ELMB Calibration Procedure

The calibration of the ELMB was performed for both Pt100 and NTC sensors. The calibration procedure is done in two steps. First, the ADC channels have to be calibrated, and then the offset differences due to the voltage drop on the cables or manufacturing differences of the sensors can be determined. These two steps are outlined below:

**i. The ADC calibration**

For both types of Pt100 & NTC measurements, the sensors were replaced by a known precision resistor R\({}_{\rm pr}\) (the resistor used was 109.867\(\Omega\) for the Pt100 and 5 k\(\Omega\) for the NTC sensor, which are both in the limits mentioned above). From the measurement of the precision resistor R\({}_{\rm meas}\) a calibration factor \(\alpha=\)\(R_{{}_{\rm pr}}/R_{{}_{meas}}\) is obtained. The calibrated readings are obtained after multiplying R\({}_{\rm calibration}\)=100 \(\Omega\) (Pt100 case) or R\({}_{\rm adapter}\)=1 M\(\Omega\) (NTC case) for each ELMB channel with the calibration factor, \(\alpha\).

**ii. The offset determination**

After the precision resistor calibration the temperature measurements of the same type were not identical, even though all sensors are set to identical environmental conditions. The cables driving the Pt100 sensors were shortened out to check for any ADC offset due to any resistance of the cables; no offset was found. For the 4-wire Pt100 sensors the voltage drop of the wires was eliminated (as shown in Figure 4) while for the NTC sensor it is negligible, so it cannot account for the offset. It was therefore concluded that this effect is due to differences between the sensors used. This was verified by swapping the sensors in different channels and checking that each sensor carries its offset with it. The calculation of the offsets was performed experimentally, by setting the sensors to identical environmental conditions (mounting them between two copper plates) and recording temperature measurements for several hours. The temperature differences between sensors were calculated and plotted versus time. The mean values of these differences were the relative offsets. The standard deviation of the differences from their mean value was approximately \(\sigma_{{}_{\Delta T}}=\)\(10^{-2\;\alpha}C\), so all the measured sensors seems to track each other within our requirements. In Figure 4 the results for 4 Pt100 sensors are displayed.

## 3 The analysis of the Temperature Measurements

A panel in PVSS was created that uses an "SQL query" to retrieve the temperature measurement data from the PVSSII database for a user defined time interval and convert them to a format that can be analyzed and plotted.

The graphs of two Pt100 sensors temperature vs. time, the deviation of their difference and graphs of the deviation of each Pt (time-counts vs. temperature) are shown below in Figure 5.

Figure 4: Measurements for four Pt100s (T2, T3, T4, T5) relative to a sensor T1 (counts vs. temperature)

## 4 The DCS Setup at the H8 Test Beam Area

The setup consists of five ELMB modules used to monitor all temperature sensors on the MDT chambers, alignment bars, gas and other low voltage readings. 2\(\times\)27 Pt100 sensors are mounted on the two EO long alignment bars and 4\(\times\)8 (Pt100) for the BOS, BML, BIL and the Phantom chambers. In addition, four low-voltage channels were used to monitor the chamber gas system including the readings of the gas flow, pressure and temperature.

The sensors are connected to the ELMB modules located inside the test beam area. All the ELMB modules have Pt100 adapters on them except for the four channels on one ELMB that have differential attenuators which were used to measure the voltages of the gas controller. As shown in Figure 6, the ELMB modules are connected serially with 10m cables, and a PC in the control room with a 30m CAN-bus flat cable. Inside the control

Figure 5: Temperature measurements of two Pt100 sensors: graphs of the deviation of each Pt (a) & (b) and the deviation of their difference (c) (time-counts vs. temperature), and the 2 temperatures vs. time (d). Temperature and time are measured in Celsius and seconds respectively.

room the CAN-bus connects to a spare ELMB, used for testing and debugging of new components of the setup. The CAN-bus chain ends on the PC where the PVSSII[3] software and the OPC server are installed through out a NI-CAN PCI card. The power for the whole setup is provided in the control room and comes through the CAN-bus cable.

The CAN-bus is the field-bus chosen to connect the ELMB to the software via the NI PCI-CAN/2 interface. CAN_Open OPC Server is a high-level communication protocol, used to connect any clients (such as PVSS-II) to the ELMB modules. Each ELMB has a different hardware ID[2] assigned, using the DIP switches on the board, and can therefore be recognized by the software.

## 5 Design of Monitoring Panels

When the PVSS project starts the user is referred to a login panel where. Different users have different authorizations (common users cannot alter the parameterization space and the system settings and cannot create new sensors). One can logoff and login again as a different user through the CLOSE button. The current H8 panels are presented in Figure 7.

Figure 6: Sketch of the DCS at the H8 test beam area

This panel is the main menu used to access the various subsystems. Once login in this panel one should first INITIALIZE the ELMB modules so they start reading out the sensors (PVSS sends a reset and start signal to the ELMB modules and checks if new readings have been taken; if not an error panel appears). Through several pull-down menus (shown in Figure 8) the user can choose to view the readings of the chambers, alignment bars or the gas system parameters. Some panels of the subsystems are presented below.

The expert menu is accessible only by users having the appropriate authorization.

**CREATE SENSOR:** A new sensor may be connected to one of the channels that is not used. In order to change the use of an already used channel the sensor that makes use of the channel should be erased beforehand through the **"PARA"** panel.

**SETTINGS:** Change or view the settings of any ELMB connected to the system. (calibration, resistor adapter values and offsets for each ELMB)

**SYSTEM MGMT.:** Opens the system manager. In the Report tab of the _SysMan_ one can query the database. Information exists only for the sensors that have an archive node under their "value" data point (see para panel). The _sql_data_all_sensors_ panel was added to the SQL query panel so that one can store the data in an ASCII text format and handle it with PAW or any other program. Analytical information about the SysMan one can find on the online PVSS help.

**PARA PANEL:** Opens the panel of the parameter space of the project.

Figure 7: Main panel of the H8 DCS SCADA/PVSS environment

Figure 9: Panels for the readings of the chambers, alignment bars or the gas system parameters of the H8 DCS SCADA/PVSS environment

The background color of each temperature text field represents the state of alarm alert of each Pt100 sensor. If an alarm alert occurs it can be acknowledged by clicking on the sensor's text field and as a result it stops flashing and changes color. Only an authorized user can change the limits of the alerts.

The project is accompanied by some other panels, which are not available to the common user who wishes only to monitor and archive the readings of the DCS.

**TREND:** this panel allows two temperature measurements to be viewed simultaneously on a graph. The sensors to be viewed can be selected from two selection lists on the right, which show all the sensors registered in the project.

**RAW DATA & RESISTor VALUES:** two panels where one can view the raw data (counts) of the 10 channels and a measurement of the resistor value of the Pts respectively. This panel was used for debugging.

**CALIBRATION:** a special panel used during the calibration process.

**Acknowledgements**

This work has been performed within the ATLAS Collaboration. We thank Dr. Helfried Burckhart, Dr. Bjorn Hallgren, Jim Cook and Fernando Varela Rodriguez of the ATLAS DCS group for their hardware/software help and support on the project. Also, we would like to thank Dr. Sandro Palestini, Dr. Fabio Cerutti and William Adreazza for the enormous support that they provided during the project.

_Bibliography_

**[1]** CERN ATLAS-DCS, updated 20/11/00, Embedded Local Monitor Board, _[http://atlasinfo.cern.ch/ATLAS/GROUPS/DAQTRIG/DCS/LMB/ELMB/DISTRIBUTION/elmb_5.pdf_](http://atlasinfo.cern.ch/ATLAS/GROUPS/DAQTRIG/DCS/LMB/ELMB/DISTRIBUTION/elmb_5.pdf_)

**[2]** J. R. Cook & G. Thomas 11/2001,

ELMB Documentation "Everything you wanted to know about the ELMB but were afraid to ask", _[http://atlasinfo.cern.ch/ATLAS/GROUPS/DAQTRIG/DCS/ELMB/ElmbUserGuide.pdf_](http://atlasinfo.cern.ch/ATLAS/GROUPS/DAQTRIG/DCS/ELMB/ElmbUserGuide.pdf_)

**[3]** PVSS-II On-line Help, _[http://pgras.home.cern.ch/pgras/PvsHelp/_](http://pgras.home.cern.ch/pgras/PvsHelp/_)