**ATLAS Internal Note**

**MUON-NO-061**

**15 January 1995**

**A proposal for the ATLAS**

**Level-2 Muon Trigger in the barrel region**

G.Ambrosini\({}^{2}\), S.Falciano\({}^{3}\), A.Nisati\({}^{3}\), O.Palamara\({}^{1}\), S.Petrera\({}^{1}\) and L.Zanello\({}^{3}\).

(1) University of Lecce and INFN

(2) University of Pavia and INFN

(3) University of Rome "La Sapienza" and INFN

**Abstract**

We report on a design study of the Level-2 Muon Trigger for the barrel region of the ATLAS experiment. The proposal describes a trigger algorithm in two steps: (a) a simple and fast pattern recognition, initiated by the results of the Level-1 trigger, to define narrow roads in the drift chambers and then find the muon hits; (b) the determination of the muon transverse momentum by a sagitta measurement in the magnetic region. The pattern recognition algorithm accepts \(\sim\)90% of muon hits with a contamination of \(\sim\)5% of background hits. The sagitta method is limited only by physical effects (Coulomb scattering and energy loss fluctuations) yielding a \(\Delta\)pT/pT=2+3% for pT<100 GeV/c.

The trigger algorithm described here runs in less than 1ms on various processors of the current generation (e.g. DSPs, RISC 3000).This performance is compatible with the Level-2 latency time required by the ATLAS trigger. We finally show that less than hundred trigger processors are enough to build a system with practically no deadtime.

Introduction

The ATLAS Level-2 trigger aims at refining the Level-1 trigger decision using programmable algorithms and detector information with full granularity and resolution. The Level-2 trigger will reduce the Level-1 100 kHz trigger rate by a factor \(\sim\)100 with a variable latency time, up to 10 ms. Unlike the Level-1, it works only on a small amount of data coming from the detector regions with interesting features such as jets, electromagnetic clusters or muons (Regions of Interest, RoIs).

As for the Level-1 trigger, the second level is made of subtrigger processors associated with the muon, calorimeters and tracking detectors, working in parallel and providing their results to a global trigger logic which combines the local features to take the final decision.

At Level-2 the muon trigger can be improved by sharpening the Level-1 \(\mathrm{p_{T}}\) threshold making use of the high-precision external muon detector and, at low \(\mathrm{p_{T}}\), of the inner tracker detector which is not used at Level-1. Moreover, the muon rate can be further reduced by requiring an isolation criterium based on the \(\mathrm{E_{T}}\) measured in the calorimeter cells near the muon track.

This note describes a solution for the Level-2 muon trigger in terms of algorithm implementation and architectural studies. Presently, we focus on the trigger required in the low rapidity range \(\mathrm{\eta}\)!\(<\)1.05, the barrel muon system, neglecting the end-cap regions where further investigation is necessary.

## 2 Input parameters

In this Chapter we describe the parameters determining the project of the Level-2 muon trigger such as muon rates and background flux, detector segmentation and readout organization, data volumes and information coming from the Level-1 muon trigger.

### Level-1 trigger rates

The muon rate is mainly determined by heavy-quark decays, vector boson decays and Drell-Yan pairs. Direct muon production overwhelms secondary muon production coming from the decay of charged pions and kaons in flight and punch-through particles with \(\mathrm{p_{T}}\sim 6\) GeV/c. We assume a muon rate of about 2 kHz in the barrel region at a luminosity of \(10^{34}\) cm\({}^{-2}\) s\({}^{-1}\) for a 20 GeV/c \(\mathrm{p_{T}}\) threshold and a muon rate of about 5 kHz at a luminosity of \(10^{33}\) cm\({}^{-2}\) s\({}^{-1}\) for a 6 GeV/c \(\mathrm{p_{T}}\) threshold (\(\mathrm{p_{T}}\) is calculated at the pp vertex).

The expected background rates have been described in Ref. [1]. Coherent background is originated by : a) electrons accompanying the muon track; b) charged particles (e.u,r.p) produced in the ATLAS hall. They may cross two or more adjacent chamber layers giving correlated hit patterns. This background is important for the Level-1 muon trigger and the Level-2 pattern recognition. Uncoherent background, whose expected rate is about 20 Hz/cm\({}^{2}\), produces uncorrelated hits in the chambers due to low energy photons and neutrons present in the cavern.

### Detector geometry and granularity

The muon detector, described in detail elsewhere [2], consists of MDT (Monitored Drift Tube) and RPC (Resistive Plate Chamber) layers arranged in cylindrical shells concentric to the beam axis. The detector retains the eightfold symmetry of the toroidal magnet in the azimuthal view (Fig.s 1a,b).

Layers of MDTs and RPCs form three muon stations. MDTs are used for the precise measurement of the muon momentum. Each station includes one MDT chamber made of two multilayers separated by a spacer. Each multilayer consists of three or four layers of drift tubes (we assume four layers in our calculations).

RPCs are used for triggering low and high PT muon tracks. This is provided by means of two double layers of chambers, one on each side of the middle station and with a triple layer in the outer station. The readout of the MDTs is done in one projection only, while that of the RPCs provides two orthogonal coordinates.

There are two chamber layouts, with corresponding Level-1 trigger segmentations, considered here. One is that reported in the ATLAS Technical Proposal [2] and adopted by the detailed project of the Level-1 muon trigger in Ref. [3] to compute the number of RPC readout channels, the size and the number of the RoIs. Our design study is based on the assumptions and results of the Level-1 proposal for what concerns the hardware implementation of the Level-2 trigger. A second layout, which differs slightly from the previous one, is used by the muon trigger simulation software within the ATRECON (ATlas RECONstruction program) framework. The Level-2 software has been developed in the ATRECON scheme and uses this geometry with negligible consequences on the results of the algorithm presented in Chapter 3.

In Table I we report the mnemonics used to label the muon stations in the Technical Proposal and in ATRECON. In the r_\(\phi\) view the barrel is segmented in 8 ATLAS \(\phi\)-sectors, numbered from 1 to 8, instrumented with Large and Small chambers, adjacent in the direction of the positive \(\phi\). Within a sector the chambers have a numbering convention which is reported in the same Table I and in Fig.2. A detailed picture of the MDT and RPC layers is given in Figs.3a,b,c.

Fig. 1a

Side view of the muon detector showing the muon chambers

Fig. 1b

View of a single barrel sector showing the MDT support structure (light shades of grey), the MDT multilayers (medium shades of grey) and the trigger chambers (dark shades of grey).

Figura 2Fig. 2

Barrel muon chambers: azimuthal segmentation. S1 and S2 are the trigger stations (RPCs).

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|} \hline  & \multicolumn{4}{c|}{ATRECON} & TP \\ \cline{2-5}  & \multicolumn{2}{c|}{Small Chambers} & \multicolumn{2}{c|}{Large Chambers} & \multicolumn{1}{c|}{} \\  & logical name & number & logical name & number & \\ \hline Muon Outer Barrel & MOBS & 5 & MOBL & 6 & BO \\ Muon Middle Barrel & MMBS & 3 & MMBL & 4 & BM \\ Muon Inner Barrel & MIBS & 1 & MIBL & 2 & BI \\ \hline \end{tabular}
\end{table}
Table 1: ATRECON and Technical Proposal (TP) naming convention for the Barrel Muon Spectrometer

[MISSING_PAGE_EMPTY:7]

[MISSING_PAGE_EMPTY:8]

### Level-1 Trigger segmentation

The detector segmentation adopted at Level-1 foresees 3 \(\phi\) trigger subsectors for each ATLAS sector: two subsectors for the Large Chamber and one subsector made by the Small Chamber. Each of the 24 \(\phi\) subsectors of the barrel will be equipped with two trigger logics (one for \(\eta\)<0 and one for \(\eta\)>0). Each logic, called Sector Muon Trigger, will deliver a 32-bit word specifying the address of at most two RoIs within that region of the detector.

As described in Ref. [3], each \(\phi\) subsector is covered by two Level-1 coincidence matrices giving 48 \(\phi\) regions in the r-\(\phi\) view (Fig. 5a). In the r-z view, the barrel is divided into 20 partitions (10 for \(\eta\)<0 and 10 for \(\eta\)>0) of step \(\Delta\eta\)=0.1. Each z partition is covered by a coincidence matrix as illustrated in Fig. 5b.

Assuming a projective geometry and a RPC strip size of 3.0 to 4.5 cm (depending on the trigger layer), the Level-1 trigger is served by 960 coincidence matrices in the r-z view (20 \(\Delta\eta\) x 24 \(\Delta\phi\) x 2 \(\mathrm{p}\mathrm{t}\) thresholds) and by 960 coincidence matrices in the r-\(\phi\) view (10 \(\Delta\eta\) x 48 \(\Delta\phi\) x 2 \(\mathrm{p}\mathrm{t}\) thresholds), the total number being 1920.

Fig.6 shows the definition of the minimum Level-1 RoI as the intersection region given by the RPC area covered by the coincidence matrices in the two trigger views. Thus the minimum Level-1 trigger granularity we may define is \(\Delta\eta\) x \(\Delta\phi\) = 0.10 x 0.13 giving a total number of 960 RoIs.

### Readout electronics and DAQ crates

Presently the readout system of the muon detector (RPCs and MDTs) is not yet defined. We assume a generic model and study how data may be digitized and organized within the T2 buffers.

The generic readout foresees : a) front-end boards mounted on the detector; b) fibers to move data from the front-end boards to the Level-2 buffers (T2 buffers) located in the Control Room. The T2 buffers will store and hold the data during the Level-2 latency time, they will collect the RoI information and have links to the Level-2 and Level-3 systems. In more detail, they will receive the (\(\eta\),\(\phi\)) coordinates from the RoI builder, the YES/NO signal from the Global Level-2 system, they will deliver partial data to the local Level-2 processors and, after a Level-2 YES, dispatch the entire event to the Event Builder.

The muon detector geometry described in Ref.s [2] and [3] gives a number of readout channels of about 362 K for the RPCs and 256 K for the MDTs.

Three types of data are stored into the T2 buffers for event readout and Level-2 calculations:

- Level-1 data (RoI coordinates and trigger data from the Sector and Central Muon Trigger);Fig.5a

Fig.5b- RPC data to drive the pattern recognition and to monitor the Level-1 muon trigger;
- MDT data to perform pattern recognition and feature extraction.

The data organization within the T2 buffers follows two possible schemes referred to as solution (a) and (b). Solution (a), illustrated in Fig.7a, assumes dedicated buffers for RPC (and possibly Level-1) data and MDT data. In this way the information within a Region of Interest ("trigger tower") is spread in several buffers. This allows for a simple readout scheme, at the front-end level, as each subsystem delivering data (Level-1 trigger logic, RPCs and MDTs) is independent. The drawback of this solution is that data must be sent out from different memories into the Level-2 processor increasing the required bandwidth across the connecting switch.

Solution (b) assumes data collection from different subsystems in the same buffer where data are organized per Region of Interest (e.g. RPC and then MDT data or following the sequence of the layers as the muon penetrates the detector). This solution (Fig.7b) simplifies the data transfer to the Level-2 processors but makes the readout organization more complex. One possibility is to organize the memories as partitioned buffers deep enough to hold data corresponding to one RoI. This geographical mapping of the T2 buffer memories with (n,\(\phi\)) detector regions would be desirable at least for MDTs. Moreover, an allocation of DAQ crates to portions of the barrel which correspond to the detector segmentation illustrated before (e.g. 8 DAQ crates, one per sector, holding 16 readout cards), would simplify further on the overall logical scheme.

We plan to investigate the performance of the local Level-2 system with the two types of data organization plus intermediate schemes to assess the optimum solution.

Figure 7.a

Organization of muon data within the T2 buffers : solution (a)

### Data volume

In order to perform studies on the trigger architecture, it is important to evaluate the global amount of data flowing to the T2 buffers from the muon system (Level-1 muon trigger data, RPC and MDT data) and the amount of information required by the Level-2 algorithm (raw data from RPCs and MDTs within a RoI, data from Level-1 trigger, data base with detector geometry and other parameters, look-up tables, etc.). We have calculated the data

Figure 7.b

Organization of muon data within the T2 buffers : solution (b).

volume produced by the muon detection system making assumptions on the data encoding that is not yet defined.

An overall picture of the data volume and the bandwidth required for the entire Level-1/Level-2 muon trigger system is reported in Fig.8.

Level-1 muon trigger data

Each muon track triggered at Level-1 activates up to four coincidence matrices. For each matrix the following 45 bits are required:

- 32 bits for the hit pattern;

- 2 bits for the PT threshold;

- 3 bits for the 8 time slots within the bunch crossing;

- 8 bits for the T0 counter.

This bit configuration yields about 6 bytes per matrix and 24 bytes per track. Data readout is needed to monitor the trigger performance. For a 5 kHz single muon rate, the required bandwidth is about 1 Mbits/s, which suffices to merge this information with the detector data.

Moreover, for each bunch crossing, the Level-1 muon trigger provides a summary on the triggered tracks. It is foreseen that each of the 48 (24 \(\upphi\) subsectors x 2 \(\eta\) regions, negative and positive) Sector Muon Triggers will deliver a 32 bit word with the following information:

- number of trigger "tracks" in the half-subsector (2 bits, max=2);

- RoI address for each track (2 x 4 bits);

- \(\tt PT\) threshold for each track (2 x 2 bits, max=3 thresholds x 2 bits, max= 4 coincidence matrices);

- T0 counter (8 bits);

- 6 additional bits to be defined.

Every 25 ns this information is sent to the Central Muon Trigger via optical links, and is elaborated to form the global muon trigger information (muon multiplicity per event for each of the three \(\tt PT\) thresholds) and sent to the Level-1 Central Trigger Processor. If the event is accepted, the RoI coordinates are also sent to the T2 buffers at a rate of 100 kHz (Level-1 total rate).

RPC data

The detector occupancy may be computed assuming a typical strip size of 3.0+4.5 cm, a maximum strip length of 200 cm, a pulse width of \(\sim\)20 ns and a background rate of 100 Hz/cm\({}^{2}\) (a factor 5 higher than the nominal value). The occupancy turns out to be 1+2%e.

According to Ref. [3] the number of strips is -252 k in the r-\(\phi\) view and -109 k in the r-z view which gives -5 x 10\({}^{7}\) hits/s and -2 x 10\({}^{7}\) hits/s respectively at 100 kHz trigger rate. To calculate the real bandwidth we assume 8 bits per hit strip to encode its address. A few additional words may be added in the data stream from the readout chain to indicate the chamber address and build a suitable data format. With this assumption the required bandwidths are about 50 MBytes/s in the r-\(\phi\) view and 20 MBytes/s in the r-z view. A typical RPC event yields -1 KBytes of data.

MDT data

The calculation of the data volume is based on a simulation of 5000 \(\upmu^{+}\)tracks (validated by the Level-1 trigger), background electrons accompayning the muon track and uncoherent background whose rate is overestimated as 100 Hz/cm\({}^{2}\). The simulation has been performed for low and high \(\rm p_{T}\) tracks (momentum less than 100 GeV/c, 0 \(<\phi<\) 2\(\pi\), -1.05 \(<\eta\) \(<\) 1.05) hitting the Small and the Large chambers. The results of the simulation, in terms of number of hits per ATLAS sector, are summarized below:

\begin{tabular}{|l|l|l|l|l|l|} \hline PT & Chambers & \(<\)hits/sector\(>\) & \(\mu\) hits & coh. bkg. hits & unconbkg. hits \\ \hline Low & Small & 252.0 & 17.0 & 2.4 & 233.0 \\ Low & Large & 547.0 & 18.0 & 3.7 & 527.0 \\ High & Small & 526.0 & 23.7 & 7.4 & 496.0 \\ High & Large & 1305.0 & 24.0 & 10.0 & 1272.0 \\ \hline \end{tabular}

In this pessimistic assumption the uncoherent background largely dominates the data volume.

With the present knowledge of the MDT readout system it seems reasonable to assume an encoding scheme which gives 3 bytes per hit. If a typical ATLAS event contains one muon RoI, the MDT data volume turns out to be of -100 kBytes for the entire barrel. Concerning the data within one or more RoIs (according to the needs of the Level-2 algorithm), we compute the following values for the amount of data required at Level-2:

\begin{tabular}{|l|l|l|} \hline \multicolumn{3}{|c|}{RoI data volume} \\ \hline  & 1 RoI & 3 RoIs \\ \hline \(\Delta\eta\) = 0.10 & 0.6 kBytes & 2.0 kBytes \\ \(\Delta\eta\) = 0.20 & 1.4 kBytes & 4.0 kBytes \\ \hline \end{tabular}

These numbers are in agreement with simpler calculations that assume a chamber occupancy of 10%. For a 100 kHz trigger rate, the required bandwidths are 10 GBytes/s to 

[MISSING_PAGE_FAIL:16]

A Trigger algorithm

The purpose of the Level 2 muon trigger is the identification of the muon tracks in the muon spectrometer, the accurate calculation of the muon transverse momentum and the extrapolation to the inner tracker and to the calorimeter.

The high background environment in MDT chambers (see Fig.9) imposes an algorithm with high capability of rejecting background hits due to physical activity accompanying the muon track and to the background present in the cavern. To this end, hits from the fast detector of the Level 1 muon trigger (RPC), which has a very low occupancy, are used to initiate the pattern recognition.

In this section we describe a trigger algorithm that seems viable and compatible with this scheme. The trigger algorithm is split in two functions:

- pattern recognition of muon tracks in the MDTs;

- transverse momentum fit.

### Pattern recognition

The ATLAS second level trigger must have a latency time of a few milliseconds. Consequently the trigger algorithms must run in less than 1 ms. This constraint imposes simple and fast algorithms at the subdetector level to provide the local features.

The method we propose here is **simple** since it allows to define muon roads based on simple geometrical models, which ignores the magnetic field map. It is **fast** since the road parameters are obtained through a non-recursive calculation. Finally, the pattern recognition takes into account only the centers of the hit tubes, eliminating the ambiguity of drift times.

The pattern recognition algorithm proceeds through two subsequent phases:

i) Calculation of the muon roads.

ii) Contiguity algorithm within muon roads.

i) The first phase defines regions in the muon chambers ("muon roads"), which possibly contain all the muon hits and a minimum background contamination. Within each RoI from the RPC trigger system, the method performs the following steps:

a) Calculation of three points to make a muon trajectory (Fig.10). The three points are the superpoints (SP1, SP2, SP3) obtained from RPC hits, in the case of a high \(\rm{p_{T}}\) Level 1 trigger. In the case of a low \(\rm{p_{T}}\) trigger, where SP3 is not available, the third point is the nominal crossing point O.

b) Calculation of the muon trajectory parameters. The trajectory is a circle (through SP1, SP2 and SP3) in the case of high \(\rm{p_{T}}\) trigger (where all the points are in the Fig.9

Display of the MDT (dots) and RPC (crosses) hits in the middle and outer stations of a typical event. Muon hits are represented as black dots. Physical (dark grey dots) and uncoherent (light grey dots) backgrounds are included as described in section 3.3.

Fig.10

Definition of the muon trajectory through three points. The trajectory is a circle through SP1, SP2 (RPC superpoints in the middle station) and SP3 (RPC superpoint in the outer station) in the case of a high pT Level-1 trigger, whereas it is a circle through SP1 and SP2 and a straight line, tangent to it and originating from the p-p average interaction point O, in the case of a low pT trigger.

magnetic field region), whereas it is a circle in the spectrometer region and a straight line tangent to the circle in the no-field region, in the case of low PT trigger. c) Calculation of the parameters of three straight segments in the inner, middle and outer chambers. The segments are the chords of the arcs obtained intersecting the calculated circle with the muon chambers. d) Computation of the residual of each hit (\(\Delta\)_res_ ) from the relevant straight segment. e) Selection of the hits fulfilling the condition (see Fig.11) :

\[\mid\!\!\Delta\!\!res\!\mid\!\leq\ \Delta\!\!road\ (\mbox{chamber, layer})\]

where \(\Delta\!\!road\) is the road size at each layer of the muon chambers, defined so that 90% of the muon hits are inside the road. The road table \(\Delta\!\!road(\mbox{chamber, layer})\) is constructed using muon tracks simulated in ATRECON, as described in section 3.3. More details about this calculation are given elsewhere [4].

After this phase a list of MDT addresses is available containing more than 90% of muon hits and a reduced contamination of background hits.

* The second phase is performed to drop background hits within the muon roads. The method proceeds through the following steps:
* Removal of spread out hits with respect to contiguous ones. On each muon chamber the average <\(\Delta\)_res_> is computed and the hit with the highest \(\mid\!\!\Delta\!\!res\) - <\(\Delta\)_res_> is dropped. A new <\(\Delta\)_res_ > is then obtained. The procedure is re-iterated if the new <\(\Delta\)_res_> is improved, with respect to the previous one, by more than a predefined value or the remaining number of hits is greater than eight.
* Selection, on each muon chamber layer, of the hit with \(\Delta\)_res_ nearest to <\(\Delta\)_res_>.

At the end of the pattern recognition a clean muon track is defined with a maximum of eight hits for each muon chamber.

### Muon Momentum Measurement

The algorithm for the muon transverse momentum calculation employes the muon tracks previously reconstructed by the pattern recognition algorithm, the momentum being determined by a sagitta measurement in the barrel magnetic region (Fig.12).

[MISSING_PAGE_EMPTY:21]

Fig.12

The sagitta measured in the magnetic field region.

Look-up table (sagitta map)

Look-up table (sagitta map)

Look-up table (sagitta map) to determine the muon \(\rm p_{T}\).

The method we propose for a precision calculation is based on the use of look-up tables which define the relationship between the measured sagitta \(\mathrm{s_{M}}\) and the \(\mathrm{p_{T}}\) for each \(\eta\)-\(\phi\) position of the crossing muon. In what follows we describe the various steps in the second level trigger momentum calculation.

1. The calculation starts from the results of the fast pattern recognition, which are defined, for each muon track, in terms of a "superhit" in each MDT muon station. The superhit, computed by at most 8 hits of the MDT layers, refers to the average point of the measured hits in the bending plane.
2. Using three such superhits from the three MDT stations, an effective sagitta of the muon track is determined together with the \(\eta\)-\(\phi\) position of the muon.
3. For each \(\eta\)-\(\phi\) position, this sagitta is related to the \(\mathrm{p_{T}}\) by a function that has been evaluated using a detailed Monte Carlo Simulation and described as a table.

The table is a sort of "sagitta map" where, for a defined set of \(\mathrm{p_{T}}\) values (from 6 to 50 GeV/c), averaged sagitta values are stored for each \(\eta\)-\(\phi\) position in the barrel magnetic region. The partitioning of the space depends on the accuracy required for the \(\phi\) and \(\eta\) measurement as described in Ref. [5]. We use a step of 3 cm for the large chambers and 1 cm in the small chambers. The partition of the \(\mathrm{p_{T}}\) interval has been chosen taking into account the functional relationship between the sagitta and the \(\mathrm{p_{T}}\) in the 3-D field map of the air-core toroidal magnet. We have been scanning, using 1 GeV/c step from 6 to 10 GeV/c, 2 GeV/c step from 10 to 20 GeV/c and 5 GeV/c step from 20 to 50 GeV/c.

The algorithm then uses a linear interpolation method to calculate the \(\mathrm{p_{T}}\) once the sagitta interval (S1,S2) or, equivalently, the interval (P1,P2) in the matrix has been determined. This step is actually used instead of the generation of the final look-up tables as, for the time being, the purpose is the evaluation of the method.

Therefore, from the measured sagitta \(\mathrm{S_{M}}\) and the \(\eta\)-\(\phi\) position, the interval (S1,S2)/(P1,P2) is determined by looking it up in the appropriate sagitta table (Fig.13). There are in total four tables which distinguish the large chamber region from the small chamber region and the muon charge (2 chamber types x 2 muon charges = 4 Look-up tables). The total size of the tables is about 1 Mbyte.

The \(\mathrm{p_{T}}\) comes out by a linear interpolation between (P1,P2). Therefore the measured value is:

\[\mathrm{P_{M}}=1/(\mathrm{m}\ \mathrm{S_{M}}+\mathrm{q}\ )\]

where24

m=(1/P2-1/P1)/(S2-S1), q=(1/P1)-(1/P2-1/P1) S1/(S2-S1)

The sagitta distribution for a fixed PT is affected by energy loss fluctuations and multiple-scattering. For PT values greater than 50 GeV/c the calculation uses instead the simple formula valid for homogeneus magnetic fields which is a good approximation to the real case at high PT. So, for PT>50 GeV/c:

\[\rm{P_{M}=\alpha/S_{M}}\]

where

\[\rm{\alpha=50(GeV/c)S_{50}}\]

S50 being the sagitta value at 50 GeV/c.

More details about the method described here are given in Ref. [6].

### Performance of the algorithm

The pattern recognition algorithm is developed inside ATRECON. To study its performance, we generated with DICE single muons in the barrel region (\(\rm{\eta\eta}\)\(\rm{<}\)1) with a transverse momentum 6 GeV/c\(\rm{<}\)\(\rm{<}\)\(\rm{p_{T}\rm{<}}\)100 GeV/c. We selected the 3-D magnetic field and switched on the GEANT simulation of the physical processes induced by muons.

Muon events have been filtered using the level 1 muon trigger simulation. RPC strip size was assumed to be 3 cm, MDT tube diameter is 3 cm. We introduced in ATRECON the simulation of uncoherent background in muon chambers (randomly extracted over the sensitive areas). We assumed an uncoherent background rate of 100 Hz/cm\({}^{2}\) (a factor five higher than the nominal value [1] ) and a maximum tube drift time of 500 ns [7].

The results reported hereafter refer to the ATRECON layout of the muon spectrometer called 'OUTE' 'GEOM' 2. Table 2 gives the muon road sizes for the different muon chambers. The sizes are given as half-widths (in cm) around the calculated straight segments. The ranges given in Table 2 refer to the minimum and maximum values of the road sizes on each chamber. The shape of the road depends on the relevant muon chamber: in particular the road size is roughly independent of the layer in the middle chambers, whereas it increases towards the exterior (interior) in the outer (inner) chambers.

The main feature characterizing the effectiveness of the pattern recognition algorithm is the relative occupancy of background hits with respect to muon hits. In order to have a better understanding of the performance of the algorithm we present the results after each of the two Pattern Recognition phases (muon roads, contiguity). Table 3 shows the occupancies of muon hits, defined as the number of hits per layer. The pattern recognition preserves as a whole \(\rm{\sim}\)90% of the muon hits. Table 4 gives the number of background hitsfor each muon hit, for the physical (a) and for the uncorrelated background (b). After the first phase the content of extra hits is small only in the middle chambers (where the RPC hits strongly constrain the muon roads), but is still sizeable in the outer chambers and can be of the same order of the muon hits in the inner chambers. This fact gives a strong motivation for the subsequent phase which is intended to search for contiguous hits. After this phase the number of extra hits is strongly reduced, down to the level of few percent.

Averaging over all the different muon chambers the pattern recognition algorithm accepts \(\sim\)90 % of muon hits, with a contamination of \(\sim\)5 % of background hits.

Concerning the muon momentum resolution, it is mainly limited by energy loss fluctuations and multiple scattering and it is not affected by the method based on the look-up tables representation (for pT\(<\)50 GeV/c). In Fig.s 14,15,16 some plots of the resolution for fixed pT and integrated over pT ranges are shown. Fig.17 shows the threshold curves obtained at Level-2.

The "sagitta method" described here is effective down to 6 GeV/c muon momentum as the resolution is about 7%. For lower momenta, we are studying the possibility of applying the same method with a new definition of the sagitta.

\begin{table}
\begin{tabular}{|l|c|c|} \multicolumn{3}{c}{**High PT**} \\ \hline  & small chambers & large chambers \\ \hline OUTER & 1.7 - 3.4 & 1.8 - 3.1 \\ \hline MIDDLE & 1.8 - 2.1 & 1.9 - 2.2 \\ \hline INNER & 21. - 25. & 14. - 18. \\ \hline \end{tabular}
\end{table}
Table 2: Half-width (in cm) of muon roads

\begin{table}
\begin{tabular}{|l|c|c|c|c|} \multicolumn{3}{c}{**High PT**} \\ \hline  & \multicolumn{2}{c|}{after phase i)} & \multicolumn{2}{c|}{after phase ii)} \\  & small chambers & large chambers & small chambers & large chambers \\ \hline OUTER & 0.91 & 0.91 & 0.89 & 0.89 \\ MIDDLE & 0.93 & 0.93 & 0.92 & 0.91 \\ INNER & 0.93 & 0.93 & 0.90 & 0.89 \\ \hline \end{tabular}
\end{table}
Table 3: Occupancies of muon hits (number of hits per layer) wihin muon roads

\begin{table}
\begin{tabular}{|l|c|c|c|c|} \multicolumn{4}{c}{**High PT**} \\ \hline  & after phase i) & \multicolumn{2}{c|}{after phase ii)} \\  & small chambers & large chambers & small chambers & large chambers \\ \hline OUTER & 0.050 & 0.047 & 0.006 & 0.005 \\ MIDDLE & 0.050 & 0.054 & 0.005 & 0.007 \\ INNER & 0.302 & 0.197 & 0.015 & 0.011 \\ \hline \end{tabular}
\end{table}
Table 4: Number of physical background hits for each muon hit

\begin{table}
\begin{tabular}{|l|c|c|c|c|} \multicolumn{4}{c}{**High PT**} \\ \hline  & after phase i) & \multicolumn{2}{c|}{after phase ii)} \\  & small chambers & large chambers & small chambers & large chambers \\ \hline OUTER & 0.100 & 0.203 & 0.017 & 0.029 \\ MIDDLE & 0.043 & 0.106 & 0.007 & 0.014 \\ INNER & 0.387 & 0.602 & 0.052 & 0.051 \\ \hline \end{tabular}
\end{table}
Table 3: Number of uncoherent background hits for each muon hitFigure 14: Momentum resolution for 6 GeV/c muons.

Fig.15 : Momentum resolution for 20 GeV/c muons.

Fig.16 : Momentum resolution for 100 GeV/c muons.

Figure 17: Level-2 trigger efficiency

## 4 Trigger architecture

The major issues of the trigger implementation to be studied are : a) the organization of the DAQ crates (housing the T2 buffers); b) the switching fabric necessary to _push_ or _pull_ data from the T2 buffers to the local processor farm; c) the farm implementation and its connection to the global part. A _control layer_ is foreseen to monitor the entire system and operate it easily for testing and debugging purposes.

Modelling activity is in progress to define the trigger architecture and will be followed by a prototyping phase to evaluate the performance, flexibility and feasibility of current technologies suitable to build such a system. This phase allows to extrapolate the implementation of the selected architecture to new hardware and software components once available in the future.

In what follows we report about the status of the art concerning the performance of the trigger algorithm and the system modelling.

### 4.1 Feature extraction algorithm timings

The second step of the Level-2 trigger algorithm, that is the muon momentum measurement, has been running on three processors with RISC 3000 architecture in different configurations: a) 40 MHz and 128 kBytes cache memory; b) 25 MHz and 128 kBytes cache memory; c) 25 MHz and 32 kBytes cache memory. They were all running the Real-Time UNIX operating system EPLX. The measured average execution time is of the order of a few hundreds \(\upmu\)s with differences depending on the processor configuration. The average time, obtained simulating 5000 muons, is 260 \(\upmu\)s, 355 \(\upmu\)s and 485 \(\upmu\)s respectively for a), b) and c). The same code has been running on a Motorola DSP 96002 in about 170 \(\upmu\)s. Moreover we estimate the execution time of the pattern recognition step similar to the previous one, yielding a total execution time of about a ms for the whole trigger code. This algorithm timing is compatible with the required Level-2 latency time and shows that the algorithm presented here is feasible.

The numbers obtained with the current version of the trigger software must be considered as indicative for several reasons: a) the algorithm is still under development; b) no code optimization has been performed; c) the programming language is FORTRAN.

The measurements reported here do not include the time for data collection.

### Requirements for the Local Processor farm

We have simulated, using the MODSIM package, a simple farm architecture for the Level-2 processors, assuming a constant execution time for the algorithm. We define "lost" an event, output of the Level-1 trigger, if at time of occurancy all processors are busy.

The distributions in Fig.s 18 show the percentage of lost events versus the number of Local Processors for various Level-1 muon trigger rates and various event processing times. The results indicate that, for a trigger rate of 2-5 kHz and with a safety margin of about two, less than 100 processors are enough to build a system with no deadtime. More sophisticated simulations have to be carried out in a realistic environment which includes the time for data collection, a more refined algorithm timing and assumptions on the overall trigger scheme.

As feature extraction takes place in parallel for each RoI in the muon detector, we also plan to study the optimum RoI processor allocation among several possible schemes such as geographical and dynamical allocations. The number of switching networks (one or many) necessary to gather RoI data into one processor will also be an issue of the simulation program.

Finally we envisage the use of a few processors to build a _control layer_ whose task is twofold : a) to operate the local trigger autonomously during testing and debugging phases; b) to monitor locally the trigger performance during data taking and provide prompt diagnosis of hardware and software faults. In Fig.19 we report a possible implementation of the _control layer_, seen as logical connections, where dedicated processors (S\({}_{\mathbf{x}}\), x=1.8) take care of each sector of the muon detector (Level-2 Sector Logic) and talk to each other to exchange informations and messages. They are also connected to a local supervisor (LT2MS) whose task is to collect all the messages related to the system, accumulate statistics on the working conditions from the local processors, if that be the case, talk to the global Level-2 supervisor (GT2S) and take the actions necessary to operate the muon trigger autonomously (e.g. init the system, run it, reconfigure it, inject special data to test algorithm performance, etc.).

During data taking the main events (time-out, error handling, etc...) are handled by the global supervisor but some of them might be handled locally in order to make system failures transparent to the GT2S. Monitoring and testing of the system will remain the main tasks of the LT2MS.

### Level-2 muon features

For each event, the muon features computed by the local Level-2 muon trigger and available to the Global Level-2 processor allocated to the event, will be the following:- sign

- PT, transverse momentum

- PT, transverse momentum RMS

- Inv. PT, inverse transverse momentum ERR

- \(\eta_{\rm M}\), pseudorapidity in the standalone system (best estimate for \(\mu\))

- \(\phi_{\rm M}\), azimuthal angle in the standalone system (best estimate for \(\mu\))

- \(\eta_{\rm C}\), pseudorapidity at the calorimeter surface

- \(\phi_{\rm C}\), azimuthal angle at the calorimeter surface

- \(\eta_{\rm V}\), pseudorapidity at the vertex

- \(\phi_{\rm V}\), azimuthal angle at the vertex

### 4 Test plans

We plan to continue the system modelling using both MODSIM standalone programs and the SIMDAQ package [8] developed by ATLAS. The behaviour of the Level-2 muon trigger with different configurations of switches and processors will help in the second phase to implement a system prototype. We envisage to build a small test system to evaluate links and switches based on ATM, SCI and C104 technologies.

## Acknowledgements

We wish to thank our colleagues F.Ceradini, E.Petrolo and S.Veneziano for the useful discussions about the implementation of the Level-1 muon trigger and its implication on the design of the Level-2. We are particularly grateful to N.Ellis for his continuous contribution.

## References

* [1] G.Battistoni, A.Ferrari and P.R.Sala : "Background calculations for the ATLAS detector and hall", ATLAS note GEN-NO-010, 13 October 1994.
* [2] ATLAS Collaboration, "Technical Proposal for a General Purpose p-p experiment at the Large Hadron Collider at CERN", CERN/LHCC 94-93, LHCC/P 2, 15 December 1994.

* [3] E.Barberio et al. : "Implementation of the first level muon trigger", ATLAS note DAQ-NO-039, 27 December 1994.
* [4] O.Palamara and S.Petrera : "Pattern recognition at the second level muon trigger in the ATLAS barrel region", ATLAS note DAQ-NO-017, 15 January 1995
* [5] P.Shune : "Study of the effect of the resolution in R,\(\Phi\) on the momentum resolution in the air core toroid", Private communication
* [6] G.Ambrosini and A.Nisati : "Precise determination of the muon momentum at the second level trigger in the ATLAS barrel region", ATLAS note in preparation
* [7] "Monitored drift tubes Chambers for muon spectroscopy in ATLAS", ATLAS note MUON-NO-044, June 1994.
* [8] A.Bogaerts et al., ATLAS note DAQ-NO-18, 1994.

[MISSING_PAGE_EMPTY:36]

[MISSING_PAGE_EMPTY:37]

[MISSING_PAGE_EMPTY:38]

[MISSING_PAGE_EMPTY:39]

S1, S2,...S8 = Sector Supervisor (connected to each other and to the Local Supervisor)

LT2MS = Local T2 Muon Supervisor (may control each sector logic and may communicate with the T2 Global Trigger)

Fig. 19 : Level-2 muon trigger architecture