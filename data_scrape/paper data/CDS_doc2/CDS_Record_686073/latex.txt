# An analog solution for the readout of the ATLAS Accordeon calorimeter

University of Alberta, LAPP Annecy, CPPM Marseille, Universidad Autonoma Madrid, Nevis laboratories, LAL Orsay, University of Pittsburgh, CEA/DAPNIA Saclay

November 1994

###### Abstract

Three teams have worked independently on preliminary studies of a readout scheme for the ATLAS accordeon electromagnetic calorimeter in Canada, in the USA and in France. They have come to similar conclusions, described below. This document results from detailed technical discussions between all three groups. On minor points, they have studied a variety of possible solutions, and definitive detailed decisions will be taken later, when responsibilities are shared and implementation work is started.

## 1 Overview of the Analog Solution

In the "analog solution", the signal from each calorimeter cell is sampled continuously at the LHC bunch crossing frequency (40MHz), and each sample is stored in an analog memory during the latency of the level 1 trigger (2\(\mu\)s). In case of a positive trigger decision, a number of samples centered on the corresponding bunch crossing are read back from the analog memory and digitized.

After digitization, the raw ADC words are calibrated. Then, the several samples from each calorimeter cell are combined to give a single estimate of the energy in the cell, an estimate of the time of the incoming particle, and an estimate of the signal "quality". The result is made available in a convenient form for the level 2 trigger and for the data acquisition system.

The main advantage of this solution is that only interesting data are digitized. This may be achieved with a limited number of commercially available ADCs, at a limited cost. On the other hand, a large effort has been necessary to develop analog memories satisfying the speed and dynamic range requirements. Such chips now exist in the form of prototypes, and will be available at a low cost (5 SF/channel) in the next few years.

We have implicitely made the hypothesis of linear preamplifiers. However, a good fraction of the results remain valid in the case of a moderate dynamic range compression (e.g. performed by the preamplifiers).

## 2 Specific requirements

* The electronics described here should equip each electromagnetic calorimeter cell (100,352 in the barrel part and 40,960 in each end-cap), each presampler cell [28, 672]. Modulo minor modifications, it will also equip the harmonic calorimeters (barrel, extended barrels and end caps). We therefore have strong constraints on the cost and on the power dissipation per channel (0.6 W per calorimeter cell).
* It should match the very large dynamic range of the pre-amplifiers (more than 16bits), with minimal degradation of the detector resolution. In particular, it should not increase the constant term in the energy resolution, which is the dominant error for high energy particles. If we choose to avoid compression of the dynamic range, then we need to use two shaper channels per calorimeter cell. The ratio between the maximum signal and the r.m.s. noise introduced by the analog memories should be at least 8192 (i.e. 13 bits). However, since we read out several samples per event, the requirement on a single sample is slightly less stringent. The fraction of this noise which is coherent over the channels should be small (typ. less than 10%). For example, using a shaper gain ratio of 12, analog memories with 13 bit dynamic range, and a 13 bit ADC with an rms precision equal to half the lsb allows to measure energies between -100 GeVand 2 TeV in a cell with an rms noise of 24 MeV (to be added in quadrature with the pre-amplifier noise), which seems adequate.
* It should work with an average frequency of events accepted by the level 1 trigger up to 100 kHz (see section 8).
* The level 1 trigger latency is fixed, equal to 2\(\mu\)s. However, some cells are closer to the interaction point than others. The delay between the interaction and the analog signal in a cell depends on the cell position, and may vary by at most 10 ns. This delay is more than compensated by the cable length between the cell and the shaper, which differ by at most 3.5 meters. As a result, the signal from the cells at \(\eta\) = 0 arrive on their front-end board \(\approx\) 7 ns later than the signals from cells at \(\eta\) = 1.4. We tune the delay on the trigger signal in such a way that it comes back to a given front-end board 2 \(\mu\)s after the corresponding analog signals have been sampled on this board.
* It should use several samples for each channel in each selected event :
* A weighted sum over the samples allows a minimization of the total noise (pile-up and electronics noise) for any value of the machine luminosity [1][2]
* It allows to measure the signal timing with a precision better than 0.3 ns for energies above 5 GeV [2]. This is useful to identify at which bunch crossing a given particle was produced. It also allows to correct for small imperfections in the timing of the cells. We anticipate that neighbouring cells should be timed to within 1 ns (r.m.s.) with respect to each other.
* It allows detection of a significant pile-up. In particular, because of the bipolar shape of the signals at the shaper output, we need to measure negative signals in order to estimate a small positive energy superimposed on a larger negative tail. At the maximum trigger rate, we accept up to 5 samples per event. This has been shown to be adequate for simultaneous energy and time measurements [1]. At smaller trigger rates, we may accept more samples. However, reading out more than 5 samples makes sense only if the negative tail is correctly measured.
* It should provide the level 1 trigger system with "Tower signals". A trigger tower covers 0.1 \(\times\) 0.1 in \(\eta\times\Phi\). For the barrel part of the accordion calorimeter and for the outer wheel of the end caps, this corresponds to 32 front cells + 16 middle cells + 8 back cells. For the inner wheel of the end caps, this corresponds to 4 front cells + 4 middle cells + 2 back cells (see section 10).

The tasks to perform are summarised below :

* Sample each channel at 40 MHz
* Store the information from each calorimeter cell during the level 1 trigger latency
* Estimate the energy in each trigger tower, for each bunch crossing, and send this information to the trigger system.
* Estimate the energy and time of the energy deposit in each cell for each bunch crossing accepted by the level 1 trigger, using several samples
* Mark the cells with a significant pile-up

## 3 Location of the electronics

Our preferred solution consists in installing, as close as possible to the detector, the minimum amount of electronics necessary to send digitized data (for events accepted by the level 1 trigger). The electronics is therefore split into a Front-End part consisting principally of shapers, analog memories and ADCs, and a Remote part sitting in a control room 200 meters away, which processes the digitized data. Data transfers between the two parts use a limited bandwidth : either 16,256 or 27,648 links, 200 MBits/seach, depending on whether both high and low gain data are digitized and sent for each calorimeter cell or not (see section 12).

The front-end electronics is installed on the feed-throughs where cables come out of the cryostats. For the barrel calorimeter, it sits at both ends of the cryostat, in the cracks between the barrel hadron calorimeter and the extended barrels. Each of those two regions is 50 cm wide, and extends from an inner radius of 280 cm to an outer radius of 380 cm. For each end cap, a region with similar geometry is available between the extented barrel and the first muon chambers.

The advantage of this solution is that the distance between the detector and the analog electronics is kept as short as possible. This maximizes the signal to noise ratio. However, given the high performance requirement and the severe constraints on the installation area, the feasibility of this solution is not yet completely proven :

* The regions are difficult to access during the installation phase. Moreover, access during data taking periods will be rare (every two month), because it requires stopping the beam for 48 hours.
* The space is limited (of the order of 10 m\({}^{3}\) for each crack, to be shared between several sub-detectors), with constraints on heat dissipation (the calorimeter front-end electronics dissipates 50 kW in each crack, including the calibration system).
* The radiation level is rather low, in the range 1-10 krad per year at nominal luminosity, but may be non negligible for some CMOS components.

In the alternative solution, the front-end electronics is installed away from the calorimeter. This solution nevertheless requires some electronics ("transceivers") to be installed on the feed-throughs in order to send the analog signals to the shapers over 60 meters long coaxial cables. Because of the large dynamic range (more than 16 bits), we cannot use analog optical links. The difficulty with this solution is to route the large number of coaxial cables (55,000 from each crack, representing a cross-section of \(\approx\)0.55 m\({}^{2}\)) to an electronics hut. The cost of those cables is also an important parameter. Nevertheless, this design is studied as a fall-back solution. In this case, we have no bandwidth constraints between the ADCs and the digital treatment of the data. We have less constraints on the size and on the power dissipation per board. The description of the front-end board and of the front-end crates might be slightly different from what is presented below.

## 4 Guidelines for the System Design

As previously stated, our first rule is to minimize the amount of electronics on the detector. We list below the other rules which we have followed :

* Most of the work on the front-end electronics should be performed remotely during data taking and during installation :
* Tuning the parameters (various delays)
* Identification of faulty components
* Exchange a faulty component with a spare one on the same board where possible Direct work on the front-end electronics should be limited to the exchange of an already identified faulty board with a new one.
* The reliability of the front-end boards should be increased with appropriate use of redundancy
* Divide the system into several sub-systems ("regions" corresponding to the division of the calorimeter into mechanically independant modules and to a crate with remote electronics) to allow convenient installation of the detector, monitoring and calibration.
* Optimize the installation work. For each region, several teams should be able to work in parallel on the installation of the various components. In particular, the front-end part should be able to run in a stand-alone mode.

* Make the data available in a convenient form for the level 2 trigger and for the data acquisition systems.
* Perform no cell by cell zero suppression: we must consider all cells in the neighbourhood of a given calorimeter cell to decide whether the energy content in that cell may be ignored. Therefore, this operation is conveniently performed only when data has been collected together (e.g. when the data is made available to the Level 2 trigger and to the DAQ). On the contrary, it is difficult to perform such a task at the front-end level, because of the necessary inter-board links.

## 5 Description of the Analog Memories

Analog memories (also called Switched Capacitor Arrays, SCA) suitable for the readout of the ATLAS accordion calorimeter are being developed in three different places : Nevis labs, University of Alberta (in collaboration with LBL) and Orsay/Saclay (joint project between LAL and CEA/DAPNIA). These chips are rather similar : an input signal is sampled continuously at 40 MHz (voltage sensing), and the resulting voltage is stored in a capacitor, at a position given by an external controller. To read back the signal, the corresponding capacitor (position also given by the external controller) is placed in the feed-back loop of an operational amplifier.

### 128 capacitors per input signal

Out of the 128 capacitors per input signal, 80 are occupied at any time by data waiting for a trigger decision (the trigger latency is 2 \(\mu\)s = 80 \(\times\) 25 ns). The remaining 48 may be occupied by data corresponding to events accepted by the level 1 trigger and waiting for digitization. With 5 samples per event, we may accept up to 9 good events in a short period. Detailed simulations [3][4] show that this is adequate (see section 8). The analog memory may therefore be considered as a derandomizing buffer before the ADCs. If the level 1 trigger latency was significantly increased, then we would use more capacitors per channel. The present Alberta chip indeed has 256 capacitors per channel.

### Clock jitter less than 100 ps

Because of propagation delays of the analog signals and of the control signals in the analog memory chip, and because of jitter in the clock distribution system, it is difficult to control to a sufficient precision the delay between two successive samples in time (\(\approx\) 25 ns), which may not be stored in adjacent capacitors. This uncertainty contributes as a constant term to the energy resolution \(\sigma_{E}/E\). Limiting this contribution to 0.2% requires controlling the sampling intervals to better than 100 ps (when using optimal filtering). This imposes some constraints on the impedance of the analog lines, and on the path length for the 40 MHz clock distribution in the chips.

### 13 bit dynamic range

The limitation of the dynamic range does not come from true noise, but from two systematic effects :

* cross-talk between the input signal and the digital lines. With simultaneous write/read operations, the cross-talk may occur either when sampling the signal or when reading it back. If the capacitors were always accessed in the same sequence, then the cross-talk affecting a given capacitor would always be the same, and this effect could be corrected by using an effective pedestal, different in each capacitor. However, this does not hold in the case of random accesses, and this effect should be considered as a noise. It has been shown that this effect affects almost identically two neighbouring channels on a chip. As a result, we may feed an input signal only in every second channel, and use the other channels as reference to subtract the cross-talk before digitization (referred to as "pseudo-differential signals" in the following). This procedure doubles the number of analog memory channels. A less costly solution might be to add to the channels used for input signals (typically 16, see below) a few reference channels (1,2,or 4) used to subtract the cross-talk. Another possible solution consists in minimizing the transitions on the digital lines. For example, one may use Grey code for the addresses. In the case of the Nevis chip, instead of sending directly the write address, the increment to the previous write address is sent. As a result, when the capacitors are used in sequence (i.e. when no event is waiting for digitization), the number of transitions on the write address lines is only one per clock cycle.
* parasitic charges injected by the switches. The switches to write and read are not exactly identical from capacitor to capacitor. As a result, the parasitic charge they inject may be different, and the pedestal value then depends on the capacitor. Using the same average pedestal for all 128 capacitors associated to a given input channel results in measurement errors which should also be considered as noise. The Orsay/Saclay chip systematically performs an estimate of the effective pedestal in a capacitor immediately after reading a signal from this capacitor, and delivers a pedestal subtracted signal on its output pin. It should allow to get rid of this effect. Another solution consists in using a different pedestal value for each capacitor (i.e. 2\(\times\)128 pedestal values per calorimeter cell).

The requirement on the linearity is not very strong : an integrated non-linearity at the level of a few % seems tolerable.

### Event readout time less than 10 microseconds

This is an obvious necessity to accept a trigger rate of 100 kHz.

An analog memory chip deals with 16 input signals, or 8 pseudo-differential ones. Write operations occur simultaneously for all signals. This is also the case for Read operations. In this case, after the voltage signals have been transferred from the 16 capacitors to the 16 read amplifiers, they are multiplexed either on a single output pin (simple signal), or on two output pins (pseudo-differential signals).

The Nevis chip deals with 8 pseudo-differential signals. It provides a new signal on its two output pins in 200 ns. Two analog memory chips are associated with a single 10 MHz ADC, for 16 input signals. With 5 samples, the total time to read and digitize an event is 8 \(\mu\)s. The maximum theoretical event rate is therefore 125 kHz. The same readout time is achieved by the Alberta chip, using one 5 MHz ADC per group of 8 channels. The Orsay/Saclay chip deals with 16 input signals. 800 ns are needed to extract the pedestal subtracted signals from the capacitors. Then, multiplexing is performed at 10 MHz. During this multiplexing, new data can be extracted from other capacitors, reducing the 800 ns to only 300 ns when more than one event is queing for digitization. In this case, the total time to read a 5 sample event is 9.5 \(\mu\)s and the maximum theoretical event rate is 105 kHz.

## 6 Status of the Analog Memory Developments

The Alberta chip is a continuation of the developments for the SDC experiment, based on an original design by S. Kleinfelder et al. [5][6]. They envisage one memory channel per input signal, although they do not exclude using pseudo-differential signals. The write address and the read address are both coded on 8 bits. A 120 channels system has been constructed and operated in the readout chain of the RD3 accordion calorimeter in the september 1993 beam period. The energy resolution obtained was identical to the one with standard electronics. A time resolution of 0.4 ns was obtained for 180 GeV electrons [7]. A dynamic range of 13 bits was obtained in the laboratory. An new version of the chip and of the test system is expected in 1995.

The Nevis chip is the continuation of the development originally chosen by the GEM experiment to read out their Krypton calorimeter [8]. They use pseudo-differential signals, although they do not exclude using only one memory channel per input signal. The write "increment" adress is coded on 5 bits, and the read address is sent bit-serially on a single wire. The readout speed is 200 ns per signal. They have equipped 36 channels of a liquid Krypton prototype calorimeter, which took data at CERN in august 1994. The data is being analysed. A dynamic range in excess of 13 bits has been achieved in the laboratory [9].

The Orsay/Saclay development started in 1993. They envisage one memory channel per input signal, although they do not exclude using pseudo-differential signals. The write address and the read address are both coded on 7 bits. Pedestal subtraction is performed during each read sequence. With the second prototype, pedestal subtraction allowed to reach a dynamic range of 12 bits in the lab. [10]. A new version is expected early 1995, and beam tests on 120 channels are planned for 1995.

Description of the Front-End board

Two electronics channels per calorimeter cellSince the dynamic range of the analog memory matches the one of the shaper, we choose to have one memory channel associated to each shaper channel. To use a single memory channel per calorimeter cell, one would need to switch between the high and low gain shaper channels at the input of the analog memory, which is delicate. Moreover, this setup would never allow to digitize both high and low gain signals.

For each calorimeter cell, the high gain channel and the low gain channel are read out simultaneously. We use the low gain channel when the signal is large and either positive or negative. In this way, the high gain channel is used to measure small signals in the optimal way.

A high gain shaper channel may frequently reach saturation. The shaper needs 400 ns to recover from this saturation. During most of this time, the saturation affects only the differentiation stage in the shaper, and is hardly visible on the output signal. This comes from the strong constraint that, even in case of saturation, the positive and negative lobes of the signal have the same area.

A 10 MHz ADC for 8 or 16 calorimeter cellsWith a "perfect ADC", the rms error introduced by the ADC would be the lsb divided by \(\sqrt{12}\), and a 12 bit device would be sufficient. However, with a practical ADC, the rms error is of the order of half the lsb. As a result, we should use ADCs with more than 12 bits, e.g. 13 bits if commercially available.

At maximum trigger rate, the digitizing frequency reaches 500 kHz per calorimeter cell. One possibility consists in digitizing both the high and the low gain signals for each sample read, and send them to the remote electronics. In that case, we may multiplex 8 calorimeter cells on the same 10 MHz ADC. A careful analysis of these data might be sufficient to reveal that a given sample is distorted by saturation. The system would then always be able to choose the correct gain.

This scheme fits nicely if pseudo-differential signals are used, with 8 signals per chip. In this case, we have one memory chip for the low gains and one for the high gains, and reading data from the memory may take as long as 200 ns.

A second possibility consists in detecting saturation at the output of the analog memory. The low gain channel is digitized only if the high gain one is saturated. In this case, we go on with the low gain channels for the rest of the event. We may multiplex 16 calorimeter cells on the same 10 MHz ADC. This solution requires only half the digitizing power, and half of the bandwidth to the remote electronics as compared to the first one. This has a visible effect on the cost of this electronics. It is also less demanding on the remote electronics, which does not have to choose between high or low gain for each sample of each calorimeter cell. However, saturation occurring just before the event is not detected.

The Orsay/Saclay and Alberta chips, which are able to multiplex the output signals at 10 MHz may be used in this scheme. Because of the small overhead when the read address changes, this read address may be inserted among the data without introducing extra delay.

If we choose to read first the sample corresponding to the maximum of the signals, both solutions allow to systematically use for each calorimeter cell, the same gain for all the samples belonging to the same event. However, the first solution gives more flexibility, for example when a given sample belongs to two consecutive events.

### 64 calorimeter cells per board

A front-end board carries 128 shaper channels (8 chips with 8 channels \(\times\) 2 gains per channel) and 128 memory channels (8 chips with 16 channels each, or 16 chips with 8 channels each if we work with differential signals). We may digitize both High and Low gains or only the relevant one, using 8 or 4 ADCs respectively. Associated with each ADC, we have a link to the remote electronics. Each link has to transmit a 16 bit word (13 bits from the ADC, a bit to distinguish High from Low gain, a bit to distinguish an event header from a data word and a parity bit) each 100 ns. Coding each byte on 10 bits to minimize errors in the transmission, we obtain a bandwidth of 200 MBits/s which allows the use of presently available multi-mode fibers with relatively low cost emitter/receivers. We might further reduce this bandwidth (for example to use the sonet standard, or to use cheap copper twisted pairs) by an optimal coding of the information: since ADC data are very often close to the pedestal value, Huffmancoding might reduce the bandwidth by up to a factor 2, at the price of more difficulties in synchronisation (in particular, the links would not be synchronous with the ADCs anymore).

The 64 cells assigned to a given front-end board should be neighbours in the calorimeter, in order that the analog signals have equal time. This allows the use of a single 40 MHz clock on a board, and not several clocks shifted with respect to each other. For this reason, it is not possible to group on the same front-end board all the cells for a level 1 trigger tower. We suggest that a front-end board covers entirely a calorimeter module in \(\phi\). For example, in the middle section of the calorimeter (barrel, or outer wheel of the end caps), a board would cover 16 cells in \(\phi\) and 4 in \(\eta\). In the back section, it would cover 8 cells in \(\phi\) and 8 in \(\eta\).

### 128 presampler cells per board

The dynamic range requirement on the presampler allows to use a single shaper and memory channel per cell. As a result, 128 channels might be treated on the same front-end board : it requires the same number of shaper and memory chip than for the calorimeter boards. It requires 8 ADCs and 8 links to remote electronics, like the calorimeter boards in the case where both gains are digitized. It does not need any logic to choose which gain should be digitized.

## 8 Control of the Analog Memories

A controller receives the 40 MHz LHC clock and the level 1 trigger decision (every 25 ns). It provides the memory chips with a 7 bit "write address" every 25 ns and with a 7 bit "read address" at most every 1.6 \(\mu\)s. The controller marks the first read address for each event. It also numbers the events.

In the case of the Nevis chip, instead of sending directly a real write address, the controller sends the increment to the previous address. Only 6 bits are needed in this case. As seen before, this minimizes transitions on the digital lines. Because of the relatively low frequency of read operations, the read address may be sent bit-serially on a single wire (instead of 7).

Because of the strong timing constraints and of the high bandwidth needed to send the write address, we install one memory controller on each front-end board. This controller therefore has to be integrated. In case of failure of a controller, only 64 cells are lost.

We anticipate using the timing, trigger and control distribution system as developed at CERN by B.G. Taylor et al [11]. For cost reasons, we might have only two optical receivers per front-end crate (two for safety reasons), electrically connected to a decoder chip on each front-end board. In each decoder chip, a bunch crossing number is maintained locally and will be used to number the events.

The work done by the front-end boards does not depend on the event number, nor on the trigger type, except if pseudo-events with special data patterns are to be sent during normal data taking. If we neglect this latter case, no trigger information has to be passed to the front-end boards. It is passed via the "data channel" of Taylor's system directly into Fifos in the remote electronics. It always arrives much before the first corresponding data from the front-end boards.

When the analog memories are full, we stop writing the new samples in the memories, and send an error signal to the DAQ controller. In this way, none of the events stored before the error occurs is corrupted. However, we expect the global level 1 trigger system to generate dead time in order to avoid this situation in normal data taking conditions.

If the time to read an event was always the same, a simple "leaking bucket" algorithm would be adequate : the trigger would increment a counter for each accepted event, and would decrement it at the event read frequency. Dead time would be generated when the counter reaches a maximum value (e.g. 9). However, in order to keep the memory addresses in order, an address just read cannot be immediately re-used. We have to wait a variable time (up to 3.2 \(\mu\)s) until it finds its place in the sequence of write addresses. As a result, the leaking bucket algorithm, which always considers that the maximum possible time, causes too much dead time and leads to an inefficient use of the analog memories.

Because of the long distance between the front-end crates and the global level 1 trigger, a signal "memory almost full" sent by the controllers to the trigger is not a good solution either. The correct solution is that the global level 1 trigger locally maintains a model of the controllers. When this model indicates that the memory is almost full (i.e. that at most one more event may be accepted), this information is immediately taken into account by the trigger system.

Memory controllers have been designed in Alberta, Nevis and Orsay/Saclay. A controller with discrete components is under tests in Alberta, and one is being built in Orsay. Those boards will be used in beam tests in 1995. Verilog simulations of these devices have been performed [4], and the design of integrated versions is going on, with prototypes expected in 1995.

## 9 Redundancy

The large number of front-end boards and their reduced accessibility impose severe requirements on their reliability.

If a high gain shaper channel does not work, or if the associated memory channel does not work, we invalidate this channel at the output of the memory chip and use only the low gain one. The least count is then 500 MeV also for small energies.

If a low gain shaper channel does not work, or if the associated memory channel does not work, we invalidate this channel and use only the high gain one. In case of saturation for the sampling(s) close to the signal maximum, it may be possible to reconstruct the peak value from the other non-saturated samplings. This however requires a special treatment in the remote electronics.

The low and high gain channels should not be in the same memory chip.

We might add an extra ADC associated to an extra optical fiber on each front-end board. The signal at the output of each analog memory chip is connected to the standard ADC through one pin of the chip, and it may be connected to the extra ADC via another pin of the chip.

The drivers and receivers we use for each optical link use a redundant coding of information (10 bits for 8 bits) which allows a very low error rate (\(10^{-12}\)) [12]. We implement parity checks to detect most of these errors. Moreover, we will run these systems in auto-test mode from time to time.

## 10 Interface towards level 1 trigger system

In the barrel calorimeter and the outer part of the end caps, the 64 analog signals at the output of the low gain shapers on each front-end board are summed by groups of 8 and sent to "Tower Summation boards". A level 1 trigger tower signal is the sum of 7 groups of 8 cells each (4 groups from the front section, 2 from the middle and one from the back).

In the inner part of the end caps, a trigger tower corresponds to 4 cells in the front section, 4 cells in the middle and 2 cells in the back. This require a special summation, i.e. special front-end boards.

Since a front-end crate corresponds to at most 16 towers, a tower summation board corresponds to 16 towers. It receives 112 analog signals from the front-end boards and produces 16 analog tower signals. The tower signals are sent via co-axial cables, 70 meters long, to the level 1 trigger processors, where they are digitized at 40 MHz.

We choose the low gain shapers, although all trigger thresholds would be in the range of the high gains. The reason is that the high gain shapers are often saturated. In that case, the bunch crossing identification, normally performed by the trigger system, does not work. Each tower signal is sent both to an 8 bit, 40 MHz Flash ADC and to an analog bunch crossing identifier. It is amplified in such a way that the 1sb of the FADC corresponds to a transverse energy of 1 GeV.

The FADCs system, and the Bunch Crossing identifier are discussed separately.

Prototype summation boards, equipping 9 trigger towers on the RD3 accordion calorimeter prototype, have been used in a test beam at CERN. They fully meet the requirements [13].

## 11 Local controller/Region controller

In each front end crate, the local controller is connected to all boards in the crate via a private synchronous bus (front-end boards, tower summation boards, calibration boards - see below). It is also connected to a CPU sitting in the remote electronics crate via an optical link. In debug mode, all local controllers in the same region are slaves of the same remote CPU, which is called "Region controller" in the following.

In this way, the Region controller may read back all the various registers (possibly including JTAG ports) on all the boards in each front end crate. This allows detailed checks during installation.

A region might correspond to one or several calorimeter super-module(s) in the barrel part, and to one or several wedge(s) in the end caps. In total, we have at most 48 regions (32 for the barrel and 8 for each end-cap).

During the installation/debugging phases (i.e. when standard data taking does not work), using a very low trigger rate (a few Hz), we will be able to store the data at the output of the ADCs into Test buffers on each front-end board, and collect the data from one or several front-end crates of the region into the region controller, where we will record it and analyse it. In that case, the region controller will also control the triggers.

The local controller also receives two optical fibers (for safety) from the clock, timing and trigger distribution system. These signals are translated to differential ECL signals, and sent to each board in the crate (including the local controller itself), where it is decoded. This system is used to configure each board. It is also used to load a test pattern into the Test buffer on each front-end board. In debugging mode, these data may be transmitted to the remote electronics as a pseudo-event. This checks that data sent by the front-end are correctly received by the remote electronics.

In general, the region controller may perform its own data acquisition in debug mode : it uses the clock, timing and trigger distribution system to pass orders to the corresponding local controllers, to configure the front-end crates, and to control the level 1 trigger.

During calibration run, we will use the region controller to analyse the events and calculate the calibration constants. During normal data at a taking, the region controller will analyse some events in order to monitor the data quality.

## 12 Overview of the front-end crates

The anticipated dimensions of the front-end boards are 366 \(\times\) 240 mm 2. We also anticipate that a calibration board of this size will deal with 224 cells (calorimeter or presampler). A full front-end crate corresponds to 16 trigger towers (896 calorimeter cells). It contains 20 boards :

* 8 front-end boards for the calorimeter front part
* 4 front-end boards for the calorimeter middle part
* 2 front-end boards for the calorimeter back part
* 1 tower summation board
* 4 calibration boards
* 1 local controller

It receives 896 analog signals from the pre-amplifiers, and two optical fibers (for safety) for clock and control distribution (also used to configure the boards in the crate and to drive the calibration boards).

It sends either 126 or 70 optical fibers to the remote electronics (including one spare fiber per front-end board), depending on whether both gains are digitized or not. It also sends one optical fiber to the region controller (for debugging) and 16 copper links to the level 1 trigger system.

We have 112 copper links between the tower summation board and the front-end boards.

A pre-design study of the front-end board shows that the power dissipation amounts to 38 Watts per board (i.e. 0.6 W per calorimeter cell). This includes the on board logic, the TTL/ECL translators, the test buffers, etc... The power dissipation of a full crate is 800 Watts, out of which half corresponds to logical supplies (+5 and -5.2 V), and half to analog supplies (+7, \(\pm\)5, \(\pm\)3 V). Works on the installation of the crates (including cooling facilities, and cables to bring the power), and on the installation of the power supplies, close to the detector are in progress in Alberta and in CERN. Cabling is studied in Orsay and CERN.

Each of the 32 super-modules of the barrel calorimeter and presampler would correspond to 4 front-end crates : 3 full crates as described above, and one crate corresponding to the remaining 8 towers and to the presampler :* 4 front-end boards for the calorimeter front part
* 2 front-end boards for the calorimeter middle part
* 1 front-end board for the calorimeter back part
* 1 front-end board for the coarse presampler
* 6 front-end boards for the fine presampler
* 1 tower summation board (half un-used)
* 4 calibration boards (2 for calorimeter and 2 for presampler)
* 1 local controller

Each of the 16 wedges of the outer end-caps would correspond to 5 full crates as described above.

Each of the 16 wedges of the inner end-caps would correspond to a single crate with :
* 4 front-end boards for the calorimeter front part
* 4 front-end boards for the calorimeter middle part
* 2 front-end boards for the calorimeter back part
* 4 tower summation boards
* 3 calibration boards
* 1 local controller
* 2 free slots

In total, the front-end electronics requires :

* 224 crates (64 in each barrel crack and 48 in each front-end crack)
* 224 local controllers
* 2688 front-end boards (calorimeter barrel and outer end-caps)
* 160 front-end boards (calorimeter inner end-caps)
* 224 front-end boards (presampler)
* 272 tower summation boards
* 880 calibration boards
* 16,256 or 27,648 optical links to transfer data to the remote electronics (depending on whether both gains are digitized or not for the calorimeter, and including 3072 spare links)

## References

* [1] W.E. Cleland and E. G. Stern, _Nucl.Inst. and Meth._**A338** (1994) 467.
* [2] O. Benary et al., _Nucl.Inst. and Meth._**A349** (1994) 367.
* [3] H. Cunitz, A. Gara, J.A. Parsons, W. Sippach, L. Zhang, _Proceedings of the Fourth International Conference on Calorimetry in High Energy Physics_, Elba (1993)
* [4] A. Antona, A. Dari, _LAL internal technical report_, unpublished (1994)
* [5] S.A. Kleinfelder, M. Levi, O. Milgrome _Nucl. Phys. B_**23A** (1991) 382.
* [6] D.M. Gingrich et al., _Proceedings of the Fourth International Conference on Electronics for Future Colliders_, LeCroy Corp. (1994), ATLAS Note CAL-NO-051
* [7] D.M. Gingrich et al., ATLAS Note CAL-NO-052
* [8] A. Gara, J.A. Parsons, W. Sippach, _Proceedings of the Second International Conference on Electronics for Future Colliders_, LeCroy Corp. (1992) 61.
* [9] J.A. Parsons, _Proceedings of the Fifth International Conference on Calorimetry in High Energy Physics_, BNL (1994)
* [10] J. Ardel\(\acute{e}\)an et al., _Proceedings of the Fifth International Conference on Calorimetry in High Energy Physics_, BNL (1994) ATLAS Note LARG-NO-001
* [11] B.G. Taylor, Timing, Trigger and Control distribution for LHC detectors _informal working document_, _rev 1.6_ Nov. 1994
* [12] A test bench has been set-up in Marseille. Work in progress.
* [13] J. Pascual and J. Teiger, ATLAS Note CAL-NO-068 (1994)