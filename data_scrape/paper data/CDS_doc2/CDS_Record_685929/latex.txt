# ATLAS Internal Note

**INDET-NO-087**

**15 December 1994**

A Clock and Control System for the Test Beam

R.B. Nickerson and A.R. Weidberg

Oxford University

ATLAS-INDET-NO-087

## 1 Introduction

This note describes a clock and control system that will be available for the inner detector test beam work next year and beyond. The system conforms to the requirements of the final system, at least in overall philosophy. The system can transmit the following information to the detector front end electronics:

* 40 MHz bunch crossing clock. The precision of the clock(i.e. pulse to pulse jitter) must be better than 2 ns so that the jitter causes a negligible error in the detector pulse height for the case of the SCT. If the same system is used for the TRT the precision must be better than 0.5 ns. The relative phases of clocks should be adjustable so that slow drifts can be corrected for. The drift rate must be less than 1 ns/hour so that slow drifts only need to be correct for relatively infrequently (i.e. at start of run).
* Synchronous LVL1 accepts.
* Control information. This includes fast information such as reset bunch crossing number as well as slow information such as lists of bad channels to be masked.

The overall global architecture is explained in section 2 and the particular implementation employed here in section 3. The components of the system are described in sections 4 and 5. Finally the use of this system in the test beam is explained in section 6.

## 2 Overall Architecture

The overall architecture requires several features:

1. Uniformity. The DAQ system should see a maximally uniform system from the point of view of hardware and software.
2. Minimum complexity on the detector. From the point of view of the design of the front end electronics, the amount of electronics that is on the detector must be minimised in order to reduce the cost of the radiation hard electronics, the radiationlength and the power consumption. In addition, the use of very high speed signals in close proximity to sensitive amplifiers is undesireable.
3. Redundancy. The system should be immune to single point failures.
4. Timing adjustment. It is desirable that the relative timing can be adjusted without beams so that useful Cosmic Ray data can be taken.

The last two items are discussed in ref. [1]. A sensible compromise for these competing requirements has been discussed at recent DAQ meetings at CERN and is shown in Fig. 1

In the emerging global architecture there is a clean partition between the central DAQ and the detector. The Central Trigger System (CTS) sends the clock and control information to the interface module using the ATLAS wide DAQ standard system (e.g. the RD12 system [2]) The SCT TTC module then acts as the interface between the global DAQ and the final destinations. Its output is multiple fibres, each of which carries clock and control data for an individual module on the detector.

## 3 Implementation

In the scheme described here the control data is superimposed on top of the clock using pulse height modulation(PHM) as shown in The data are encoded on top of the clock signal by using larger amplitude pulses to represent logic 1 data. The amplitude of the larger pulses is set to be a fixed ratio of the smaller pulses (e.g. a factor of two). The slope of the rising edge will have the same gradient up to the lower amplitude pulse for both height pulses to avoid clock jitter. The clock and control data are recovered on the detector as described in section 5 The data provides the control information for the detector. In the final system a predefined sequence of three bits is interpreted as a header and the following n bits are data. Some of the allowed data words would correspond to fast data such as L1 triggers or global resets. Another data word would tell the system that slow control data was going to be sent (e.g. set up bad channel masks). This feature does not necessarily have to be used in the test beam where it might be more convenient to have a separate link for L1 and other control data.

## 4 The Counting Room Module(CCM)

A VME module in the counting room(CCM) distributes the clock and control information. The CCM module is illustrated schematically in fig. 3.

There are front panel inputs for the BC clock and the fast data. The BC clock and the fast data/control data are sent down a single fibre to the detector using PHM as described in section 3 above. Up to 8 fibre outputs can be driven from this prototype module. Fast control information such as global resets come from the global DAQ via the front panel input(FAD) on the module. This generates identical data on all of the output fibres. Slow information which is different for different output fibres will come from registers which are computer stable. The software loads a sequence of up to 256 bits into the registers and then an execute command is issued which causes this sequence of bits to be sent simultaneously out of each fibre. This will be used to send information like lists of bad channels to mask, perform calibrations, pedestals etc. The execute command can be isused via software or via the front panel input, XEC. In addition to FAD and XEC there are two other front panel signals, delay width (DWI) and execute in progress (XIP). These are outputs associated with avoiding conflict between hardware and software generated control data. When the contents of the 128 bit shift stream is being transmitted XIP is set: If the execute instruction is issued from software, XIP will be set a fixed delay time before the shift start. The delay time(\(\Delta\)T) is set by a front panel pot. A pulse of width \(\Delta\)T is output on DWI. There is no delay if the execute instruction is sent from hardware (via XEC), however XIP will still be set for the duration of the shift. XIP can be used as a busy signal by the external trigger logic. In a system with more that one link it will be necessary to adjust the relative phases of the different clocks to correct for channel to channel propagation delay delay differences and for different fibre lengths. Each clock delay can be adjusted by a delay chip. This allows for up to 12.5 ns of delay in steps of 0.25 ns. After the clock phases have been adjusted the phases of the data relative to the clock would be adjusted with a similar delay chip.

## 5 On Detector Electronics

The electronics required on the detector module consists of a radiation hard PIN diode to convert the light signal to electrical and the "DORIC2" chip to reconstruct the BC clock and the control data. The PIN diode and DORIC2 will be packaged on a silicon substrate along with two LEDs for data transmission. The functionality of the DORIC2 chip [3] is illustrated in fig. 4.

It contains an amplifier and two discriminators. The output of the lower threshold (\(V_{LOW}\)) discriminator is the BC clock and the output of the higher threshold discriminator (\(V_{HIGH}\)) is the control data (see fig. 3). The data remains constant for an entire clock period,i.e. this is a NRZ-L scheme. For the early test system the control signal will be fed back to the counting room module via a LED/fibre link which is then used to set the amplitude of the pulse. In the final system a dedicated fibre is not required for this purpose provided that the destination of the data is designed appropriately (e.g. the binary FE chip DDR2 has a "talk to me" mode in which it returns all control data back to the counting room via the normal data link). For use in the test beam the following procedure is used to set the pulse amplitude:

* A DAC in the CCM module is used to set the amplitude of the pulses being sent down the fibre.
* A stream of pulses containing control data is sent down to the detector.
* The counting room module counts the number of control pulses returned.
* The DAC level is increased until the amplitude of the pulse is \(a_{1}\) when the counting room module starts to detect the returned pulses.
* A stream of clock pulses with no control data is then sent down to the detector.
* the DAC level is increased until the amplitude of the pulse is \(a_{2}\) when the counting room module starts to detect returned pulses(because the low level pulses are now big enough to cross the higher discriminator level of DORIC2).
* The DAC level is then set to lie between \(a_{1}\) and \(a_{2}\) e.g. half way between.

Use in the Test Beam

The VME module will be available for use in the test beam next year. The board will be produced by February '95. A board with DORIC2 functionality will be constructed from discrete components and will be available by the end of '94. The rad-hard ASIC version will be available in early '95. The system can be adapted to the requirements of different FE as required, e.g. if for the APV5 tests it is necessary to have separate L1 and control signals then two links can be duplicated where one link provides the L1 and the other the control data. Similarly the number of links on a VME board can be adapted to the user requirements.

## References

* [1] R.B Nickerson and A.R. Weidberg Clock, & Control ATLAS-INDET-48
* [2] B. G.Taylor, Timing Trigger and Control Distribution for LHC Detectors, working review document, CERN/ECP.
* [3] J. Gorbold, Specification for DORIC2, RAL.

Figure 1: Functional Model for the Overall Clock & Control Architecture

Figure 2: Pulse height modulation for transmission of BC clock and L1/control data (a) PHM encoded signal (b) reconstructed clock (c) reconstructed L1/control data

Figure 3: VME Clock and Control Module

Figure 4: DORIC2 Block Diagram