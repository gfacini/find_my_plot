**Description of the test bench for the ATLAS hadronic tile calorimeter front end electronics.**

**Franck Martin**

A dedicated test bench was developped in order to check the proper working of the Atlas Tile Calorimeter front end electronics after its assembly in super-drawers. The assembly itself is validated through these tests. This note describes in details the tests performed.

Introduction.

The ATLAS hadronic Tile Calorimeter (TileCal) front end electronics is assembled in structures called'super-drawers' at Clermont-Ferrand, before being sent to CERN and inserted in the calorimeter modules. The correctness of this assembling and the perfect working of the electronics must be checked at this step. This is the purpose of the test bench which is described in this note.

## 2 Short description of the electronics.

The front end electronics is described in [1]. The figure 1 shows the different cards which are tested, and the name used for the different cards hereafter. A super-drawer contains 45 (barrel case) or 32 (extended barrel case) photomultiplier (PMT) blocks, containing a light mixer, the photomultiplier itself, a high voltage divider board and a 3in1 card, inserted in a steel shielding. The 3in1 card ensures the signal amplification and shaping, the charge injection for the calibration and the control of the trigger output. The 3in1s are connected to four mother boards, which receive/transmit the TTC and the CANbus signals. The ADC integrator (one ADC-I per super-drawer for calibration) and the adder cards (7 (ext. barrel) or 9 (barrel) per super-drawer, summing the low gain responses of 4 to 6 channels in view of the calorimeter trigger decision, and transmitting the signal of the D-cell for the muon trigger decision) are plugged onto the mother boards. Eight digitizer cards and one S-LINK card are superimposed on top of the mother boards. These cards digitize the data, format them and transmit them via the optical fibers. All these cards are on the first side of the super-drawer (readout side). On the second side (HV side), there are two bus boards, the HV microcontroller card and two HV-OPTO boards which ensure the high voltage regulation.

Figure 1: Schematic of a drawer. A super-drawer is made of one internal and one external drawer. The HV-MICRO board, the ADC-Integrator and the S-LINK board exist only on the external drawer. 21 (barrel case) or 10 (extended barrel case) 3in1 boards are connected on the external drawer, and 24 (barrel) or 22 (extended barrel) 3in1 boards are connected on the internal drawer.

Description of the test bench

The figure 2 shows a schematic of the test bench. Two super-drawers inserted in lighttightness boxes can be tested at the same time. In case of non-intentional opening, an interlock hardware stops the high voltage distribution. Two LEDs (blue light), are connected to a bunch of optical fibers which distribute the light in the boxes. This allows each PMT to be illuminated. For each super-drawer, two different low voltage power supplies are used : one for the high voltage side (PPT 1830 GPIB programmable power supply, +5V, +15V and -15V) and the second for the readout electronics side ("home made" power supply, which provides analog -5V, +5V and +15V and digital +5V and +3.3V). There is only one high voltage distributor (FUG MCN 140-1250) for the two test benches. A VME crate contains the RIO 8061 (Lynx OS, version 3.0.1), the S-LINK card (LDC ODIN EP 680-1110-950 from CERN), the TTCvi and the TTCvx, which generate the clock and the L1 accept, and two adder multiplexers : they receive the trigger signals coming from the adder cards, both for muon and hadron outputs. These signals are converted through a V792 CAEN-ADC. A NIM crate supports two LED drivers, the electronics dedicated to the cooling system, the power supply for the adder multiplexers and a DIO board (which allows the control of the bar code readers, of the interlock system, of the LED mode and of the choice of the adder mux input).

The cooling system uses depressurised water at 18\({}^{o}\). The water flow is 50l per hour.

The main code of the test bench is written with LABview 6.0 on a PC/Windows 98 (see fig. 3). The digitizer and interface cards are controlled through C code running on the RIO, as well as the CAEN-ADC.

Figure 2: Schematic of the test bench.

## 4 The tests of the assembly

Barrel modules have not the same number of PMT's than extended barrel modules. Also, TileCal modules are made of different types of tiles (different sizes and different manufacturers) and radiation exposure varies from cell-to-cell. Thus, depending of its nominal high voltage, a particular PMT can not be placed anywhere in the detector. This leads to six different possible configurations for a super-drawer. PMT blocks are disposed in the super-drawer holes, alternatively up and down. During the insertion in the test bench, bar code readers register the PMT block numbers. For each PMT, the nominal high voltage and the allowed zone, as defined in [2], are taken from the PMT database1. The global configuration for the inserted super-drawer is compared to the expected one. An error message is produced and the test ends either if the configuration is wrong or if one PMT is not registered in the database. A schematic of the insertion into the test bench is shown on figure 4.

Figure 3: Main panel of the test bench: inputs are the super-drawer position, the tests the operator wants to perform, the board numbers (serial numbers or TTCrx addresses), and some informations for the QC sheet (drawer numbers, module number, operator names).

## 5 Functionnality tests of the electronics

To check the redundancy of the system, only one optical fiber is plugged during this first test (for data fiber as well as for TTC fiber). The second one will be used during the stability test described in section 7.

The functionnality tests can be separated in three parts : the first devoted to the readout side, the second to the high voltage side, and the third to the full system. The parts of the electronics tested at each step are highlighted in the boxes. Figure 5 summarises the different tests performed on a Super-Drawer.

### Part I

The different steps of the first part are :

* The low voltage power supply for the readout side is turned on. Voltages and currents are controlled every 20 seconds along all the test, and the stability must be better than 10 % 2. Measured values are compared to the average values calculated from the previous measurements. Footnote 2: This is not true for the analog +15V, where the variations during the test are bigger than 10%. This current must be smaller than 170 mA.
* The communication with the ADC-I and with the 3in1 cards is tested. The ADC-I serial number is read out and each switch of the 3in1 card is alternatively turned on and off. The configuration is set and checked through the CANbus. It is also tried to configure the non-existing board 0, to check that boards do not acknowledge orders sent with a wrong addressing scheme.

Figure 4: Schematic of insertion into the test bench.

low voltage distribution,

TTC cable connection (transmission of the clock signal),

CANbus connection and availability, ADC functionnality,

S-LINK board (TTC transmission part),

mother board EPLD and mezzanine card,

3in1 connections to the mother board, 3in1 to MB communication,

3in1 functionnalities.

* A TCP-IP connection is open with the RIO, and the test of the readout is executed. The code controls the digitizer configuration and the charge injection (CIS). First, a new 3in1 card configuration is ordered to each 3in1 board, through the TTC, and checked through the CANbus. This controls the possibility to send commands

Figure 5: Schematic of the tests performed on the Super-Drawer.

[MISSING_PAGE_FAIL:7]

between a linear fit and a second order polynomial fit. This difference must be smaller than 1.76, 1.96, 2.15, 2.56, 2.22 and 2.34 for the different gains (measured average differences on the 6 gains are: 0.59\(\pm\)0.39, 0.61\(\pm\)0.45, 0.71\(\pm\)0.48, 0.79\(\pm\)0.59, 0.84\(\pm\)0.46, 0.75\(\pm\)0.53, the limit is taken at 3\(\sigma\)). The \(\chi^{2}\)/dof of the linear fit must be less than 1 (the average value for the first Super-Drawers is 0.38\(\pm\)0.2). Errors in the \(\chi^{2}\) computation have been taken as twice the RMS of 50 pedestal measurements (on the same channel) for each gain. The same error is taken for each charge injection at the same gain. There is also a visual control by the operator.

This is done for two different channels. The difference between the two fitted offsets must be less than twice the RMS of the pedestals mesured on all the channels, and the relative difference between the slopes must be less than 2%.

For all the channels, two charge injections are done to check that the ADC-I to 3in1 connection is correct. The average slope is computed for the 6 gains, and a warning appears for channels with a slope which deviates more than 3 \(\sigma\) from this average.

### Part Ii

If this part ends successfully, the test of the high voltage side can be started :

Figure 6: Internal drawer test of the low gain. Barrel configuration : the 24 PMTs are connected.

* The low voltage power supply is turned on. Output Voltages and currents are checked, these voltages must not exceed the nominal values by more than 0.5V. A warning message occurs if the currents are not in the [0.25,0.35]A, [1.5,1.7]A (barrel case, 70% of these limits is taken for ext. barrel) and [0.11,0.31]A windows, for the +15V, -15V and +5V respectively.
* The communication with the HV-MICRO board through the CANbus is tested, by writing a new soft address for the super-drawer. The global status of the HV-MICRO and HV-OPTO boards (low voltage, EEPROM, CPU...) is checked. The software version of the HV-MICRO code is also checked (the current version is 6.8).
* The low voltage inputs to the board are checked, and must be in \(\pm\)1V around the nominal values. A warning message is displayed if one low voltage input differs by more than 0.5V from the nominal value. 

* The temperature probes are read out. At this step, they are not calibrated, and this is just a test of the connections. Temperature probes connections.
* The regulation loop is tested : the input high voltage on boards must be in \(\pm\) 5V of the power supply output high voltage (-830V). Then, 530 \(\pm\) 5V are required on all the channels. High voltage is put on the super-drawer by half a drawer. If a

Figure 7: ADC-I linearity test. The non linearity is taken as the difference between a quadratic and a linear fit for the biggest injected charge. The test is done on two different channels, and for each gain. Relative difference in the slope must be less than 2%.

problem occurs on one channel, high voltage is turned off and the test ends. This step is essentially dedicated to search for light leaks : the ADC pedestals must be unchanged when the high voltage is turned on. The maximum allowed change is 1% of the pedestal (the RMS has been measured to be 1.36 for an average pedestal of 512.7 counts, so 1% is roughly 3\(\sigma\)). This also detects any leakage current when the HV is turned on.
* The high voltages on all the channels are increased to 600V. An error message appears if the regulation is not into \(\pm\)2V around this value.
* The nominal high voltages are applied. Measured values must be into \(\pm\) 0.7V of the orders (average difference: \(0.18\pm 0.16\)V).
* At each step, currents are recorded and controlled. Typical values are 200 to 300 \(\mu A\) per regulation loop, and currents must be within \(\pm\) 200 \(\mu A\) around the expected values.
* The nominal high voltages and the temperature orders are written in the EEPROM. The temperatures orders are 34 degrees for the HV-OPTO boards, 30 degrees for the HV-MICRO board and 20 degrees elsewhere.

High voltage regulation, optocouplers removing on empty channel.

### Part III

The third part only controls that there is no problem in the chain from the light mixer to the electronics. Also, it is checked that there is no influence of the high voltage side by looking at the pedestal of the digitizers: 50 pedestals measurements per channel are done. The RMS per channel is required to be smaller that 2 ADC counts4.

Footnote 4: As can be seen on figure 8, there is a clear increase of the noise near the patch pannel (channel number greater than 32) when the high voltage is turned on. This problem, seen on the first produced super-drawers, has been solved[3].

* A continuous blue LED is turned on. The ADC signal is read out on the first channel, and must be greater than 1365 counts, and less than 2013 counts (average response: 1689\(\pm\)108). This checks the PMT to divider and divider to 3in1 board connections. This also checks the connection of the PMT HV cable to the bus board.
* The ADC signal on each channel must be inside a window of \(\pm\) 20% around the measured mean for all the channels. This average must also stand in the [1365,2013] ADC counts window.
* Pedestals on the digitizers are checked again on the high gain with the high voltage on.

PMT's HV cable connection, PMT to divider connection, PMT response,

divider to 3in1 card connection, HV distribution on dynodes.

* The soft address of the drawer is written to 0. The high voltage on/off switches on each 1/4 of super-drawer are let **ON**. Some results of the tests are kept and sent with the module, see fig. 8. The QCsheet is done (see fig. 9). The duration of the tests is roughly 45 minutes.

## 6 Calibration of the temperature probes.

The super-drawer is cooled. The water temperature is at 18\({}^{o}\), the external temperature is regulated around 23\({}^{o}\). The low voltages for the high voltage side and for the readout side are turned on. After 15 mn, the temperature probes are read out, and the new offsets are computed to equalize the measured temperatures to the orders.

Figure 8: Few results of the tests are kept: noise without/with the high voltage side on, adder response per PMT and measured high voltage currents at each step. The nominal high voltage per PMT is also given.

## 7 "Long run" test

After the functionnality tests, two different runs of 12 hours are done. In both cases, the currents on the readout side are read out every seconds. There is also an hardware limitation to the delivered currents.

### Run I

The first one checks the stability of the high voltage regulation, of the temperature regulation and optionally of the ADC-I response. The HV must be in \(\pm 0.7\)V (average value : \(0.18\pm 0.16\)V) around the nominal HV, and must be regulated with a stability better than 0.11V (average RMS :\(0.05\pm 0.02\)V). Stability of the temperature regulation must be better than \(1.1^{o}\) (average RMS : \(0.32\pm 0.25^{o}\)). If the ADC-I response is also controlled, the PMT's are continuously illuminated, and the ADC-I response for all the channels is controlled every ten minutes(5 measurements per 10 minutes per channel). The response must be in the 1365-2013 ADC counts range, and the mean RMS of the response must be less than 3.81 counts (three times the pedestal RMS).

Figure 9: QCsheet produced for each module at the end of a successfull test.

### Run II

The second run checks the stability of the readout response (3in1, digitizer and interface board). The readout is tested using charge injection on the high and on the low gain. The maximum of the pulse and the time of this maximum (the sample number) are recorded. These pulse maximum and time are recorded every fifty events, as there are roughly one million events in 12 hours. The stability of the digitizer response must be better than 3.9 ADC counts on the high gain (average RMS is between 1.9 and \(2.3\pm 0.5\) counts) and better than 4.7 counts on the low gain (average RMS is between 1.6 and \(2.2\pm 0.9\)). The RMS of the time of the maximum must be better than 0.16 (the average RMS is \(0.06\pm 0.05\)). The acquisition rate is also controlled (roughly 24 events per second).

## 8 Conclusion

The test bench for the ATLAS hadronic tile calorimeter front end electronics is working, and the first production super-drawers have been assembled and tested. Evolution of the test bench is expected to be small in the near future: only a test in pulsed light (in the PART III, and in the "long run" test of the readout with CIS) is foreseen.

An interface is still missing with the future database with all the information related to a super-drawer.

## Acknowledgments

I thank the electronics team of Chicago, Stockholm, Barcelona and Rio for their nice help. I also thank R. Teuscher and K.J. Anderson for their help in understanding the S-LINK card. I am grateful to S. Nemecek, D. Calvet and P. Gris for carefully reading this note, and to R. Chadelas and D. Lambert for their support.

## References

* [1][http://atlasinfo.cern.ch/Atlas/SUB_DETECTORS/TILE/elec/electronics.html](http://atlasinfo.cern.ch/Atlas/SUB_DETECTORS/TILE/elec/electronics.html)
* [2] ATL-TILECAL 2001-003, Final definition of sets of photomultipliers for the tile hadron calorimeter of the ATLAS detector.
* [3] Ph. Gris, R. chadelas