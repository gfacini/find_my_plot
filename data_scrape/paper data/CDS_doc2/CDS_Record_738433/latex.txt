**ATLAS TILECAL DIGITIZER TEST SYSTEM**

**AND QUALITY CONTROL**

**Christian Bohm, Daniel Eriksson, Sten Hellman, Kerstin Jon-And, Jonas Lesser, Magnus Ramstedt**

Stockholm University

mank@physto.se

This document describes the tests of the quality control procedure for the ATLAS TileCal digitizer unit. Since the ATLAS detector will fill most of the space in the detector cavity it will be difficult to disassemble parts of the detector. Therefore quality control is extremely important for every part of ATLAS. In Stockholm the digitizer units are tested in a testbench to ensure functionality and reliability in the ATLAS environment.

The document includes a brief description of the ATLAS TileCal digitizer system and a description of the testbench setup. It also includes a description of the tests preformed and of the quality control procedure developed in Stockholm together with a production status.

###### Contents

* 1 Introduction
	* 1.1 TileCal
	* 1.2 The TTC System
	* 1.3 The Digitizer System
* 2 The Digitizer Test Setup
	* 2.1 Drawer Testbench Setup
		* 2.1.1 Configuration System
		* 2.1.2 Read-out System
		* 2.1.3 The 3-in-1 System
		* 2.1.4 Software
	* 2.2 The LongBench
		* 2.2.1 LongBench Configuration
		* 2.2.2 LongBench Tests
		* 2.2.3 LongBench Communication
* 3 Quality Control and Tests of the Digitizer
	* 3.1 Tests
		* 3.1.1 Configuration Tests
		* 3.1.2 TileDMU Memory Test
		* 3.1.3 Bias Test
		* 3.1.4 Linearity Test
		* 3.1.5 CRC check
		* 3.1.6 Parity check
		* 3.1.7 Bunch-crossing id check
		* 3.1.8 Additional Tests
		* 3.1.9 Pipeline memory
* 3.1.10 LongBench Tests
	* 3.2 Documentation
* 4 Production status
* A QC-sheet

Introduction

This document describes the tests of the quality control procedure for the ATLAS TileCal digitizer unit. ATLAS[1] is one of four detectors at the Large Hadron Collider(LHC) experiment and its hadronic calorimeter is called TileCal. The TileCal detector is now in the phase of commissioning and installation. Parts of the detector have been installed into the underground experiment hall about hundred meters under ground. The ATLAS detector will fill most of the space in the cavity and thus it will be difficult to disassemble parts. Therefore quality control is extremely important for every part of ATLAS. In Stockholm the digitizer units are tested in a testbench to ensure functionality and reliability in the ATLAS environment.

### TileCal

The ATLAS Tile Calorimeter[2] is a cylindrical structure divided into a barrel and two extended barrel segments. Each segment consists of 64 wedge shaped modules. The module itself is made as a sandwich of iron plates with scintillating plastic tiles in between. The light produced when charged particles cross the scintillators is brought out to PMTs in the back of the module by wavelength shifting fibers. PMTs, supply electronics and read-out electronics for each module are mounted in an aluminum girder called drawer. The drawer slides into a compartment in the back of a module. A super-drawer consists of two drawers. Each barrel module contains two super-drawers equipped with 45 channels each while the extended barrel module has one super-drawer with 32 channels. A so called 3-in-1 card[3] attached to the PMT base amplifies and shapes the PMT signal. The 3-in-1 card has four outputs: the trigger sum signal connected to a summation unit for the Level-1 trigger system[4], a signal for calibration and two for the digitizer units[5, 6, 7]. The two digitizer outputs have different gains, low and high, with a ratio of 64 to achieve a greater dynamic range of the signal. The two digitizer signals from the the 3-in-1 card are digitized by the digitizer units.

### The TTC System

To synchronize the detectors with the beam in LHC the Timing, Trigger and Control(TTC)[8, 9] system will be used. The TTC system is synchronized with the beam and provides the front-end electronics with bunch crossing id(BCID) and system clocks. As the name indicates the system can also be used to configure the electronics. The TileCal digitizer-system uses the TTC receiver ASIC(TTCrx)[10]. The TTCrx decodes a TTC-signal and provides the digitizer boards with three 40 MHz clocks, the first level trigger(L1A) signal and BCID. It also provides configuration data to the digitizers. Outside the detector the TTC-signal is generated by a TTCvi[11] module and a TTC encoder module. The TTCvi is a timing and control module. It has several functions to control the TTCrx and to send custom front-end electronics commands. It has trigger inputs and outputs on the front panel to control registers and to generate L1As. The TTCvi ensures that the timing of the clock, L1A and commands are synchronized. In the Stockholm digitizer testbench a TTCvx[12] is used as a TTC encoder. The TTCvx encodes the signals from the TTCvi to a TTC-signal. A laser module is used to convert the electrical signal to an optical signal.

### The Digitizer System

A barrel super-drawer contains eight digitizer boards and an extended barrel drawer six (plus an additional dummy board). The digitizer boards have two Tile-DMUs (Data Management Units) serving in total six high- and six low-gain channels, see figure 1. The 3-in-1 signals are continuously digitized by ten-bit ADCs with a bias level (pedestal level) controlled by a Digital to Analog Converter(DAC). The digitized data from each of the six ADCs are fed to the Tile-DMU making up a 60 bits wide data word. Four parity bits are added to protect the data words. The data is fed into a internal pipeline memory from which they are retrieved after a time delay suitable to compensate for the L1A latency. When a L1A signal is received a number of data words from the pipeline are transfered to a second memory. The number of words stored is decided by the sampling frame parameter i.e. the number of samples per readout. This allows an entire pulse shape to be stored.

The Tile-DMU has three different readout modes: normal, calibration and test mode. In normal mode high and low gain is chosen automatically by the Tile-DMU using the two gain switching parameters, high- and low- limit. High gain is chosen if the pulse is between these limits. In test- and calibration-mode both gains are read out. The difference is that in test mode a programmable test word is used instead of ADC data. The test word is rotated by one bit every clock cycle.

When data is read out a header with gain-, BCID-, parity-information etc. is built, see figure 2. First the header word is read out followed by the data words. The data words are stored as 64 bits words in the memory. There are 32 bits for each gain. Before readout the 32 bits appropriate for the selected gain are chosen. In calibration and test mode two sets of data and header words are read out. The first set contains low gain data and the second high gain data. The data set is read out to a parity check. Then the serializer builds a two bit wide data stream from the 32 bit wide header and data words. At the end of the stream two cyclic redundancy check(CRC)[13] words are added, one for each

Figure 1: A schematic picture of the components on the digitizer board.

bit stream.

The digitizer boards have one TTCrx each.

The Tile-DMU is clocked by the 40 MHz system clock. The ADCs are clocked with another 40 MHz clock called clock40des2[10] while the Tile-DMU output buffer is clocked by a third clock, called clock40des1[10]. These three clocks are all obtained from the TTCrx. Clock40des1 and clock40des2 can independently be shifted in phase relative to the system clock. The clock40des2 clock is used to compensate for the geometric time delays in the detector. It will be set such that the ADC samples as close as possible to the top of the 3-in-1 pulse. There are some phase regions for the clock40des2 causing setup and hold problems[14] when data is clocked into the Tile-DMU. The in-buffer clock can therefore be inverted to avoids such problems. The configuration is made via the TTC system.

In table 1 all configurable digitizer variables are listed.

The interface card is placed in the middle of the drawer. There are two chains of boards on each side of the interface card. The TTC-signal enters the interface card and is fanned-out to the digitizer boards via three layer flex-foils. The TTC-signal passes through adjacent

\begin{table}
\begin{tabular}{l l l} Parameter name & Function \\ \hline Sample frame size & - & Number of samples per read-out. \\ Pipeline depth & - & The depth of the pipeline memory. \\ Test Word & - & Test word used in test mode. \\ DAC values & - & Controls the ADC offset. One for each Tile-DMU. \\ Inverted clock in & - & Inverts the Tile-DMU in buffer clock. \\ Invert clock out & - & Inverts the Tile-DMU out buffer clock. \\ Speed mode & - & Mode for read-out. Not used anymore. \\ Wait & - & Time to wait before starting to read out after a L1A. \\ High limit & - & The upper limit for high gain. \\  & & Levels above switches to low gain. \\ Low limit & - & The lower limit for high gain. \\  & & Levels beneath switches to low gain. \\ Mode & - & Read-out mode. Normal-, calibration or test- mode. \\ clock40des1 & - & Read-out clock.Not used by the TileCal link but by the Stockholm link. \\ clock40des2 & - & ADC clock. \\ \hline \end{tabular}
\end{table}
Table 1: Digitizer parameters the can be configured via the TTC system.

Figure 2: Description of the header bits. The least significant bits are to the right.

boards on its way out in the drawer. The data signal propagates the same way, but in the other direction, to the interface card, see figure 3.

## 2 The Digitizer Test Setup

The Stockholm TileCal digitizer test system includes two subsystems: the drawer testbench and the LongBench. The drawer testbench tests all features of the digitizer board crucial for proper functionality of the TileCal sub-detector. The LongBench tests the BCID, the Digitizer system clock and the data integrity during a long period (about 12 hours). Both testbenches are needed to test a digitizer board completely. Test results from both testbenches are saved into an external data-base.

### Drawer Testbench Setup

To test a digitizer board and its functionality the drawer testbench configures the digitizer and then analyzes the read-out data. For simplicity the description of the system will be split into the read-out system and the configuration system. The common part to both systems is the RIO-II power PC (RIO). The RIO is a VME-rack mounted computer with an internal PCI-bus, an external VME-bus and an Ethernet connection. The computer runs software which controls and synchronizes the configuration and the read-out. On a separate workstation software with a graphical user interface (GUI) and pre-defined tests makes it easy to test and debug digitizer boards. The workstation- and the RIO-software communicates via TCP/IP.

In the drawer testbench the digitizer boards, 3-in-1 mother boards, 3-in-1 cards and link/interface card are mounted in the same way as in a TileCal drawer. Although the system was built to test eight digitizer boards at the same time, for practical reasons, only one board is tested at a time. In this position all data lines are tested as well. The testbench is nevertheless equipped with eight boards. The Stockholm interface/link source card (LSC)[15] is used in the testbench.

#### 2.1.1 Configuration System

The TTC system is used to configure the digitizers in the testbench, see figure 4. The TTC components are a TTCvi, TTCvx and a laser fan-out module. The TTCvx and the TTCvi are clocked by an external 40 MHz (actually 40.08) clock module. The TTCvi is

Figure 3: The digitizer boards read out via the adjacent boards in an LVDS-bus. The TTC-signal is transmitted to the digitizer boards from the interface card in a similar way (not seen in the picture).

connected to the RIO via the VME-bus and is used to configure the digitizers, send L1A signals and to configure and send commands to the 3-in-1 system. The TTCvx encodes the TTCvi signal in the TTC-format, and are connected via two ECL inputs and outputs called A- and B-channel. The encoded signal is converted to an optical signal by the laser fan-out module. The signal is sent to the interface card via an optical fiber.

To configure the digitizers the RIO software sends the digitizer commands to a certain TTCvi address via the VME-bus. After receiving the command the TTC system forwards the command to the digitizer boards.

#### 2.1.2 Read-out System

A schematic picture of the read-out system is shown in figure 5. The digitizer starts to read out data when a L1A signal is received. The data from all digitizers in the testbench is merged in the interface card and sent to the link destination card (LDC) via an optical

Figure 4: A schematic picture of the Rio and TTC crate.

Figure 5: A schematic picture of the read-out system.

fiber. The LDC is a simplex G-link S-link card[16]. The LDC is attached to the RIO PCI-bus via a simple PMC to S-link interface. On the LDC a field programmable gate array (FPGA) is used to control the read-out from the LSC to the PCI-bus. Since the LSC is reading out data continuously the FPGA searches for a special pattern to find real digitizer data. When the start patten is found the digitizer data is passed through to the RIO.

The L1-trigger is generated by the LDC. A new trigger is generated when the previous data has been completely read out. This is to prevent the PCI-buffer memory to overflow. The trigger signal is connected to the L1A and the B-go\(<\)2\(>\) inputs on the TTCvi module, see section 2.1.3.

To be able to test all the data lines on the digitizer board the device under test has to be put in the fourth position (closest to the interface card) in the testbench and the positions in front of the tested board have to be occupied by fully functioning digitizer boards, see figure 6. The interface card is placed on top of the digitizer board at position five. The LDC uses this board to control the read-out. This board therefore has to be a fully functioning digitizer board.

#### 2.1.3 The 3-in-1 System

The 3-in-1 system contains four mother boards and several 3-in-1 cards. The 3-in-1-system is configured by the TTC system like the digitizers. For calibration purposes the 3-in-1 card has a mechanism called charge injection system (CIS) to create a test pulse. The testbench uses this function among others to test the ADCs on the digitizer boards.

To generate a CIS-pulse synchronized to the L1-trigger the B-go registers and the calibration trigger on the TTCvi are used. The TTCvi has four B-go registers which can be pre-programmed with arbitrary TTC-commands. If enabled these command sent when triggered by the B-go inputs on the front of the TTCvi. A special feature for B-go\(<\)2\(>\) is that it can be set to generate a L1a after a programmable delay. The B-go\(<\)2\(>\) register is therefore pre-programmed with the command to fire the CIS charge. The B-go\(<\)3\(>\) register is pre-programmed with the CIS charge command. By connecting the B-go\(<\)3\(>\) input to the trigger out, the 3-in-1 system will charge while the digitizer data is read out.

Figure 6: A schematic picture of the test bench. Eight digitizer boards are connected with flex-foils. The Interface/LSC is mounted on top of the digitizer board at position five. The four 3-in-1 mother boards are placed under the digitizer boards.

#### 2.1.4 Software

There are two software packages in the testbench system. The RIO runs a software called Coot-Boot and on the workstation a java application called Baltazar is running. Coot-Boot has direct-access to the VME-bus, the PCI-bus and the ethernet connection. Since the RIO runs a real-time OS it is important that Coot-Boot deals with just one process at the same time. Because of this constraint the L1-trigger is generated from the LDC and not from Coot-Boot. Coot-Boot both configures of the system and receives the data from the LDC. When data has been collected from the LDC it is forwarded to Baltazar. Baltazar is the back-end interface which controls Coot-Boot.

Baltazar was made to present the digitizer data graphically. When the mass production of the digitizer started there was a need to test the digitizer boards comprehensively and automatically. Baltazar has some pre-defined tests, testing the functionality of a digitizer board. Baltazar connects to a shared disk via the FTP protocol where testing history and auto-generated QC-sheets are saved. The information is accessible from Internet.

### The LongBench

Since the number of events read out by the drawer tetbench is small, a new testbench called LongBench was developed to test reliability. The LongBench system is a modular system consisting of a dedicated LongBench board, a download card and a PC (see figure 7). Each LongBench board can test one or two digitizer boards at the same time. Up to 14 LongBench boards can be connected to the system via the Download card.

Figure 7: A schematic picture of the LongBench.

#### 2.2.1 LongBench Configuration

The main component of the LongBench board is a Xilinx FPGA. This is a reconfigurable chip allowing the system to be easily upgraded. The PC is connected to the Download card which in turn is connected to all the LongBench boards. The Download card acts as a Xilinx download cable with 14 outputs. This means that the PC can configure the whole LongBench system in one go.

The LongBench mimics a TTC system and sends TTC coded signals to the digitizers. During a LongBench reset cycle it sends all the configurations the digitizers need and also sends a BCID reset signal to the TTCrx chip. In addition it resets a BCID counter in the LongBench board. After the reset cycle the LongBench board checks the identification number of the digitizers under test and starts sending L1A triggers to the digitizers at a rate of about 40kHz. This is the maximum read-out speed when the digitizer is running in test-mode and reading out 16 samples. The LongBench monitors all data read out from the digitizers.

#### 2.2.2 LongBench Tests

The BCID read out in the header word of the digitizers is compared to the internal BCID counter (minus an offset). Any deviation increases a BCID error counter. The clock40des1 is also read out from the digitizers to the LongBench board and monitored. A missed clock cycle is reported in the clock error counter. In addition to these tests all the data words from the digitizers are checked for errors. The digitizers are run in test-mode with all data bits set to zero. Errors in the data words are stored in the data error counter. If the configuration read from the header is wrong this also generates a data error in the data error counter.

#### 2.2.3 LongBench Communication

The PC is communicating with the LongBench system via a daisy-chained RS232 cable. When a test starts the PC sends a reset token to the first LongBench board. Upon receiving a reset the LongBench board sends the token to the next board and initializes a reset cycle.

In certain intervals the PC sends a read-out token. When this is received by a LongBench board it sends out the identification numbers of the digitizers being tested, the number of received events from the digitizers and the three error counters. This is followed by forwarding of the read-out token. The PC will, after the token has passed on to the last LongBench board, receive the information from all LongBench boards and store this in a log.

When the test has terminated the LongBench software will send the information about the tested boards to an external data base.

Quality Control and Tests of the Digitizer

The digitizer boards are produced in Stockholm by several manufacturers. The boards are sent to Stockholm University for tests and burn-in. Tested boards are shipped to Clermont-Ferrand in France where the TileCal drawers are assembled and tested. The drawers are then sent to CERN. At CERN the drawers are inserted into TileCal modules and tested once more with a system called MobiDick[17]. Many modules have also been tested in the test beam area. When the modules have been moved to the ATLAS pit they are tested once more with MobiDick.

All drawer components must be tested after the production. Each component has a Quality Control(QC) sheet confirming a successful test.

### Tests

This section explains the tests made in Stockholm. The unmounted boards are pre-tested by the manufacturers. They are mounted and shipped to Stockholm University. First the boards undergo a visual inspection. The boards are then pre-tested in the drawer testbench. Then the boards are burnt-in in a 70 degree Celsius oven during one week to find bad boards at an early stage. Then the systematic tests of the digitizer boards start. The drawer testbench and LongBench together test the digitizer board completely for the need of ATLAS. The tests are constructed to test a specific component by varying the configuration. But due to the testbench setup many components are tested at the same time. The cyclic redundancy check(CRC16) is continuously monitored for the read-out data as is the parity check and bunch-crossing id mismatch check. Read-out and data bus errors between the TileDMU and the interface card will immediately be caught by these tests.

Some of the digitizer board functionalities are not necessary to test separately since they must be functioning for the board to be able to read out data. These functions are listed below.

* For a malfunctioning data-bus the CRC will fail.
* Bad signal will cause single and double bit errors.
* Bad clocks will give bad data and the CRC will fail.
* If the TTCrx addressing fails the digitizer board will not be configured right and give non-expected data.

In the testbench one board is tested at a time. The board is put in the fourth position, see figure 6. To be able to test the flex-foil connectors and the passive data lines from preceding boards positions one, two and three have to be occupied with well-functioning boards.

#### 3.1.1 Configuration Tests

The main task of the configuration tests is to test the TileDMU variable registers and the configuration bus. The tests set TileDMU parameters and compare the data with the expected values. The parameters are set to all zeros and all ones to reveal stuck at zero and stuck at one conditions.

**The digitizer sample frame size**: is in the data header and is compared to the configuration values. The number of data words are counted as well.
**The read-out modes**: are stored in the data header and are compared with the configured mode. The number of digitizer words distinguish normal mode from test and calibration mode. During the test a CIS pulse will distinguish between test mode and calibration mode.
**High and low limits**: are tested by using the ADC bias level. The bias levels are set by the DAC. In normal mode the high and low limit values decide which gain is read-out. A gain flag is stored in the data header and is compared to the expected value. To be able to test the upper limit (high and low limit equals to (hex)3FF) of the gain switching, a CIS pulse is used.
**The pipeline memory depth**: can not be fully tested because of latency of the 3-in-1 system and L1A. A CIS pulse will moves in time relative the L1A with the pipeline depth setting. By delaying the L1A with two different values two pipeline depth settings will be covered. These settings are chosen to include complementary bits, (hex)2F and (hex)D0, so all high and low bits are covered. Depending of where in the clock cycle the trigger signal arrives the L1A is generated with a delay of zero, one or two clock cycles. The test can therefore miss an error for the lowest bits in the pipeline depth setting.
**The speed setting**: has to be 20 MHz for the drawer testbench to be able to read-out with the link. The 40 MHz setting used in ATLAS is tested by the LongBench. However the clock inverting is not tested. The inverted in-clock setting may be used in ATLAS. A test for this is described in section 3.1.8. This test wasn't included in the normal quality control procedure.
**The data bus and bits of the ADCs**: are tested by setting the DAC to zero and by using the maximal CIS pulse. The pulse is large enough to set all ADC bits for both gains.

#### 3.1.2 TileDMU Memory Test

The TileDMU data memories are tested in test mode. The test word is configured by four eight bits words which are all set to either of: (hex)0, (hex)FF or (hex)11. The (hex)0 and (hex)FF words tests the memory bits. The (hex)11 word tests the parity memories. These tests are complete for the memory and the parity memories but not for the pipeline memory. The reason for this is that the testbench can not produce L1A triggers with enough precision, see section 3.1.4 and 3.1.9.

#### 3.1.3 Bias Test

In the bias test the characteristics of the bias levels and the noise is tested. The 3-in-1 system is disconnected. 100 data sets in calibration mode with sixteen samples are read-out. The average and the RMS of all samples of all data sets are calculated. The RMS must be less the 0.8 counts for low gain and 1.5 for high gain. The spread of the bias levels between all channels connected to one TileDMU has to be less then 25 counts.

If the spread is greater, one or several fine-tuning resistors have to be mounted on the digitizer-board. The bias level has to be greater than 20 and less than 80 counts for a DAC value equal to 128 to pass the test.

#### 3.1.4 Linearity Test

In the linearity test the lower part of the ADCs, the whole DAC and the buses are tested. The test is performed by increasing the DAC setting by one every read-out. The bias level is read out. A straight line is fitted to the data, see figure 8. The linearity is measured by the \(\chi^{2}\). The \(\chi^{2}\) has to better than 0.7 per degree of freedom. All data points must also be within 3 counts from the line. The graphs shows, apart from the fitted line, also the mean, the maximum and minimum sample value of the frame.

In addition the test detects many other problems. Grounding problems show up as bumps in the linearity plot. Figure 9 shows a ramp of a channel with badly grounded ADC. Figure 10 shows a channel where the ADC voltage was to low. Figure 11 shows a channel with a bad DAC bit and figure 12 shows a channel with pipeline memory error.

Figure 8: A figure from the linearity test for a good digitizer board. The right picture shows the samples.

Figure 9: A figure from the linearity test for a digitizer channel with badly grounded ADC. The small pictures shows the samples for a read out in the two notches.

Figure 11: A figure from the linearity test for a digitizer channel with a bad DAC bit. It is recognized as a saw tooth pattern.

Figure 12: A figure from the linearity test for a digitizer channel with pipeline error.

Figure 10: A figure from the linearity test for a digitizer channel with ADC noise due to a too low voltage level. The mean of the samples within the sample frame is correct, see the right picture. The figure of the DAC ramp therefore shows the maximal and minimal sample value within the sample frame.

#### 3.1.5 CRC check

Coot-Boot calculates a CRC in the same way as the TileDMU. The two CRC words are compared.

#### 3.1.6 Parity check

The digitizer data has odd parity. This means that the parity bit is set so the data word has an odd number of high bits. The parity check counts the number of set bits and checks if it is odd or not.

#### 3.1.7 Bunch-crossing id check

The bunch-crossing id for all boards are compared to the bunch-crossing id from the board at position five which is known to be working well from previous tests.

#### 3.1.8 Additional Tests

A test of the pulse shape was not included originally. Such a test is needed to find error in the clock40des2 and bad ADC behaviors. The test is called pulse test and generates CIS pulses for sixteen different clock40des2 values. All pulses are merged to one and an analytic function of the pulse is fitted to data, see figure 13. The \(\chi^{2}\) per number of degrees of freedom is used to find bad boards. The function used to fit is expressed in equation 1. The fit algorithm still has to be improved. The present algorithm is good enough to be used for finding bad ADC channels.

\[f(x)=A\left(\frac{x-\Delta}{\tau}\right)^{\mu}\cdot e^{-\mu\left(\frac{x-\Delta }{\tau}\right)} \tag{1}\]

A test for the TileDMU inverted in-clock parameter was not implemented in the QC. In this test a scan is made over all possible clock40des2 values. The ADCs are reading out bias levels. In a certain range, setup and hold violations will occur. This will not give any CRC or parity errors since the errors occur when data is clocked into the Tile-DMU. Instead the bias level RMS is checked. Figure 14 shows a diagram of the calculated RMS versus the clock40des2 value. The clock40des2 value is increased by one step every readout. The peak refers to where data fails to be correctly clocked into the TileDMU. If the in-clock is inverted the peak moves by about 120 steps to the left (12.5 ns). The scan has to be made twice to test the in-clock inverting parameter properly.

#### 3.1.9 Pipeline memory

The pipeline memory is not tested completely. To test the pipeline the system must be able to synchronize the L1A with the pipeline memory read out. But a large number of data are read out and hence the risk of missing an error is very small.

#### 3.1.10 LongBench Tests

In the LongBench the BCID is tested and compared to a reference, the clock40des1 stability is controlled and all data words and header words are monitored. Any discrepancyFigure 14: A figure of a clock40des2 scan. The clock40des2 is increased by one step every read-out. On the Y-axis the RMS of all samples in the sample frame is displayed. The peak is where setup and hold violation for ADC data and the TileDMU in-clock occurs.

Figure 13: A fit to CIS data where the pulses are sampled with different clock40des2 settings.

will be reported as an error. The test lasts for at least ten hours corresponding to more that 2G readouts.

### Documentation

Baltazar saves the result from the tests in a history file. Fine-tune resistor values are also included in the file. LongBench software writes a result file for each board. Baltazar reads the LongBench report files and includes the result in the QC. If a board passes the Baltazar tests and the LongBench tests an auto-generated QC-sheet is created. Baltazar copies the QC-sheet and the history file to a directory accessible for the web-server. The files are generated as HTML and can be opened with a normal HTML browser. The QC-sheet is explained in appendix A. An index file with all boards with QC-sheets is updated for fast access from the web. The URL is _[http://www.sysf.physto.se/atlas/digitizer/qc_](http://www.sysf.physto.se/atlas/digitizer/qc_).

## 4 Production status

In the end of January 2004, 1507 digitizer boards had been tested in Stockholm. 1425 of these have passed the QC. The spread of the bias levels for the ADCs belonging to the same TileDMU has to be within a certain region. To adjust the bias, fine-tuning resistors on the boards are mounted. Resistors have been mounted for 42 percent of the tested boards. Figure 15 shows two histograms of the pedestal level for all high and low gain channels. In the right histogram, the bias levels belonging to one TileDMU were moved to minimize the spread. 97% of the distribution is found within 25 counts. The pedestal difference within each gain and TileDMU is shown in figure 16.

Figure 15: The figure shows two histograms of the bias levels for all high and low channels. The bias levels are taken for all digitizer boards that have passed the quality control. In the left histogram the DAC setting is 128 for all channels. In the right the bias levels belonging to one TileDMU were moved, using individual DAC settings, to minimize the spread.

Figure 16: The upper left figure shows a histogram of the difference of the low gain channels on TileDMU 1. The upper right shows a histogram of the difference of the high gain channels on TileDMU 1. The lower figures shows the same things for TileDMU 2.

QC-sheet

ATLAS Tile Calorimeter Digitizer

Board **4920** is ready for installation.

Quality Control Operator: **Magnus Ramstedt**

Date : **2003-09-24**_Date when the board passed the quality control tests_.

TEST RESULTS:

ADC Linearity

**OK** _Result from the linearity test and bit test in configuration test_.

DC Linearity

**OK** _Result from linearity test_.

TileDMU Configurations

**OK** _The TileDMU was able to be configured in all tests_.

TileDMU Memory Check

**OK** _Result from memory test and linearity test_.

TileDMU Readout

**OK** _No parity, CRC error or corrupted data was found_.

Data Connectors

**OK** _The data connectors and data lines were functioning_.

LVDS Drivers

**OK** _The LVDS drivers were functioning. No corrupted data was found_.

TTCrx BCID

**OK** _Result from LongBench tests_.

TTCrx Clocks

**OK** _Result from LongBench tests_.

TTCrx Configuration

**OK** _Result from LongBench and configuration tests_.

TTCrx Long Run

**OK** _Passed LongBench tests_.

TTCrx LONG TEST:

Total Number Of Events:

**2177495927** _Number of read-out triggers in the LongBench tests_.

Total Number Of Errors:

**0** _Number of errors in the LongBench tests_.

BIAS LEVELS: _Result from the Bias test. ADC bias levels for a DAC setting equals 128_

TileDMU 1

low gain ch1 : **67.06 \(\pm\) 0.42** counts

ch2 : **66.87 \(\pm\) 0.55** counts

ch3 : **67.62 \(\pm\) 0.49** counts

high gain ch1 : **43.02 \(\pm\) 0.28** counts

ch2 : **47.23 \(\pm\) 0.43** counts

ch3 : **48.42 \(\pm\) 0.50** counts

TileDMU 2

low gain ch1 : **54.52 \(\pm\) 0.51** counts

ch2 : **66.55 \(\pm\) 0.52** counts

ch3 : **49.87 \(\pm\) 0.35** counts

high gain ch1 : **53.34 \(\pm\) 0.54** counts

ch2 : **54.24 \(\pm\) 0.47** counts

ch3 : **50.37 \(\pm\) 0.52** countsSaturated CIS PULSE PLOTS: _The figures shows the CIS pulses from configuration test._

Information about the tests : [http://www.sysf.physto.se/atlas/digitizer/qc/Fysikum](http://www.sysf.physto.se/atlas/digitizer/qc/Fysikum), Stockholm University

## References

* [1] ATLAS technical proposal for a general-purpose pp experiment at the Large Hadron Collider at CERN, CERN/LHCC/94-43, 1994
* [2] ATLAS Tile Calorimeter Technical Design Report, CERN/LHCC 96-42
* [3] Front-end electronics for the ATLAS Tile Calorimeter, K. Anderson et al., Writeup from Fourth Workshop on Electronics for LHC Experiments, Rome 1998.
* [4] ATLAS First-Level Trigger Technical Design Report, CERN/LHCC/98-14.
* [5] A Digitizer System for the Tile Calorimeter, S.Berglund et al., CERN/ATL-TILECAL-97-132.
* [6] The ATLAS Tile Calorimeter Digitizer, S. Berglund et al. Fourth Workshop on Electronics for LHC Experiments, Rome 1998, p.79.
* [7] The ATLAS Tile Calorimeter Digitizer, S. Berglund et al. Fifth Workshop on Electronics for LHC Experiments, Snowmass 1999.
* [8] Timing Distribution at the LHC, B.G. Taylor, Eighth Workshop on Electronics for LHC Experiments, Colmar 2002.
* [9] ATLAS First-Level Trigger Technical Design Report, CERN/LHCC/98-14, chapter 16 p.429-446 Timing,trigger and Control.
* [10] TTCrx Reference Manual A Timing, Trigger and Control Receiver ASIC for LHC Detectors, J. Christiansen, A. Marchioro, P. Moreira, [http://ttc.web.cern.ch/TTC/TTCrx_manual3.8.pdf](http://ttc.web.cern.ch/TTC/TTCrx_manual3.8.pdf)
* [11] TTC-VMEbusinterface(TTCvi) Manual (Rev 1.6), Ph. Farthouat, P. Gallno, [http://ttc.web.cern.ch/TTC/TTCviSpec.pdf](http://ttc.web.cern.ch/TTC/TTCviSpec.pdf)
* [12] TTCvx Technical Description and Users Manual, [http://ttc.web.cern.ch/TTC/TTCvxManuala.pdf](http://ttc.web.cern.ch/TTC/TTCvxManuala.pdf)
* [13] A Painless Guide to CRC Error Detection Algorithms, Ross Williams, 24 September 1996, ftp.adelaide.edu.au/pub/rocksoft/crc_v3.txt, [http://www.ross.net/crc/](http://www.ross.net/crc/)
* [14][http://www.sysf.physto.se/~klere/tile-dmu/](http://www.sysf.physto.se/~klere/tile-dmu/)
* [15] An Optical Link Interface for the Tile Calorimeter in ATLAS, C. Bohm, D. Eriksson, K. Jon-And, J. Klereborn and M. Ramstedt, Seventh Workshop on Electronics for LHC Experiments, Stockholm 2001.
* [16][http://hsi.web.cern.ch/HSI/s-link/devices/g-ldc/](http://hsi.web.cern.ch/HSI/s-link/devices/g-ldc/)
* [17] MobiDICK: a mobile test bench for the TileCal super-drawers, R. Bonnefoy, D. Calvet, R Chadelas, M. Crouau, F. Martin, ATL-TILECAL-2004-003, 24 March 2004, [http://atlas-proj-mobidick.web.cern.ch/atlas-proj-mobidick/](http://atlas-proj-mobidick.web.cern.ch/atlas-proj-mobidick/)