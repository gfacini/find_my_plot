# Measurement of the solenoid magnetic field

M. Aleksa, F. Bergsma, P-A. Giudici, A. Kehrli,

M. Losasso, X. Pons, H. Sandaker

_(CERN)_

P. S. Miyagawa, S. W. Snow

_(Manchester)_

J.C. Hart

_(RAL)_

L. Chevalier

_(Saclay)_

###### Abstract

We describe the machine used to map the solenoid field and the data sets that were collected. The bulk of the note describes the analysis of this data. A series of small corrections are made; some taken from surveys and some derived from the data itself. Two fitting methods are defined and applied to all data sets. The final result is that the field map at normal operating current can be fitted to a function that obeys Maxwell with an r.m.s. residual of less than 5 Gauss. Systematic errors on the measurement of track sagitta due to the field uncertainty are estimated to be in the range \(2.3\times 10^{-4}\) to \(12\times 10^{-4}\), depending on the track rapidity. Finally, the representation of the map in Athena is briefly described.

**1. Introduction**

The Inner Detector (ID) magnetic field is produced by a superconducting solenoid [10] of radius 1.247 m, length 5.283 m, having 1154 turns which generates a field of 2 T at the centre when supplied with 7730 A. A flux return path is provided by the iron of the Tile Calorimeter. Since the solenoid is shorter than the ID and the calorimeter is at high radius, the field drops steeply from \(\sim\)1.8 T at \(Z=1.7\) m to \(\sim\)0.9 T at the end tracking volume. Almost 96% of the field is directly due to the current in the solenoid with the remainder being due to the magnetised iron of the Tile Calorimeter.

**2. Required map accuracy and aims**

Since Atlas is searching for new physics it is hard to say what accuracy will be needed on momentum measurement. We have therefore taken measurement of the W mass, that continues to be an important parameter, as the criterion to set our requirements. Muons and electrons from W decay have typical transverse momentum of 40 GeV, which gives them a sagitta of 1.1 mm in a radial path of 0.8 m in a 2 T field. The momentum scale of these tracks is limited by our understanding of the ID alignment and magnetic field. Of these two, alignment is by far the more difficult to get right and we believe that there will be irreducible alignment errors at the 1 micron level, or 0.1% of the sagitta. In order to give ourselves the best possible chance of understanding alignment down to this level we would like the magnetic field to be known to somewhat better accuracy, so we set a target of 0.05% for the uncertainty of track sagitta due to the field.

In addition to mapping the solenoid field with 0.05% accuracy at nominal current at one moment in time, we also need to understand the effects listed below to the same accuracy so that we can predict the field during physics running.

* does the iron have any memory of its past magnetisation history.
* if we are forced for some reason to run with a different current is there any deviation from linearity between field and current due to iron saturation.
* the solenoid and the barrel toroid compete for the available magnetisability of the TileCal girders. Simulations show that this will lead to a small decrease of the solenoid field when the barrel toroid is turned on.
* the JD shielding discs were not present when the solenoid was mapped. They are expected to cause a small perturbation to the solenoid field at the ends.

Hysteresis and saturation were measured during the mapping campaign and are reported in this note, while the toroid and JD effects will be determined by future simulations and measurements.

**3. Apparatus**

The mapping machine was designed to scan an array of Hall probes [11] over a volume slightly larger than that which will later be occupied by the Inner Detector. The machine had four arms mounted on a common axle in a windmill configuration. The axle was supported by a carriage that rode on the ID rails. The axle could be rotated and the carriage moved along the rails by means of pneumatic motors. Optical encoders allowed control of the machine movements and readout of its stop positions with an accuracy of \(\sim\)0.1 mm. Each arm held 12 Hall cards at radii ranging from 0.118to 1.058 m. Each Hall card contained three sensors to measure the field components B\({}_{\rm z}\), B\({}_{\rm r}\) and B\({}_{\rm\varphi}\).

In addition to the mapping machine we have four NMR probes fixed to the wall of the ID volume at z=0. They provide highly accurate measurements of the field magnitude at these four points.

## 4 Scan Data

The field was mapped in early August 2006. During mapping the complete TileCal was present in its final position but the JD shielding discs were not present and the toroids were not yet commissioned. The ID was obviously not present but parts of its services were installed, however they are not supposed to contain any significant magnetic materials so this should not matter.

The field was mapped with the solenoid current at 7730, 7850, 7000 and 5000 A, with a final map back at the nominal operating current of 7730 A. The actual current values as measured by the DCCT [9] differ marginally from these at 7729.995, 7849.985, 6999.980 and 4999.982 A. In this analysis we use the exact values but refer to them by the round numbers. Each map took about 4 hours and the solenoid current was stable to much better than 0.1 A during this time. Each data set contained at least 20000 points, sometimes many more, and each is sufficient to fit the field with negligible statistical uncertainty.

Figure 3.1: The mapping machine installed in the Inner Detector cavity, viewed from end A.

\begin{table}
\begin{tabular}{|c|c|l|l|l|l|l|l|l|} \hline Date & Current & Name & Files & N\({}_{\rm o}\) & N\({}_{\rm z}\) & Z\({}_{\rm min}\) & Z\({}_{\rm max}\) \\ \hline
2/8/06 & 7730 & Map7730a & CorrC7n02003 \(\sim\)2005 & 16 & 66 & -2.67 & 2.73 \\  & & & \(\sim\)3007 \(\sim\)3010 \(\sim\)3024 & & & & \\  & & & \(\sim\)3028 & & & & \\ \hline
2/8/06 & 7730 & Pzero7730a & CorrC7n02001 & 16 & 4 & -0.25 & 0.25 \\ \hline
3/8/06 & 7730 & FineZ7730a & CorrC7n03009 & 16 & 10 & -0.25 & 0.25 \\ \hline
3/8/06 & 7730 & FineF7730a & CorrC7n03015 & 64 & 1 & 0.0 & 0.0 \\ \hline
4/8/06 & 5000 & Map5000 & CorrC7c03030 \(\sim\)3031 & 16 & 63 & -2.62 & 2.61 \\  & & & \(\sim\)4001 \(\sim\)4004 \(\sim\)4005 & & & & \\  & & & \(\sim\)4006 & & & & \\ \hline
4/8/06 & 5000 & Pzero5000 & CorrC7c03029 & 16 & 4 & -0.25 & 0.25 \\ \hline
4/8/06 & 5000 & FineZ5000 & CorrC7c04002 & 16 & 10 & -0.25 & 0.25 \\ \hline
4/8/06 & 5000 & FineF5000 & CorrC7c04003 & 64 & 1 & 0.0 & 0.0 \\ \hline
4/8/06 & 7850 & Map7850 & CorrC7h04003 & 16 & 21 & -2.32 & 2.32 \\ \hline
4/8/06 & 7000 & Map7000 & CorrC7l04001 \(\sim\)4002 & 16 & 36 & -2.62 & 2.62 \\  & & & \(\sim\)4004 \(\sim\)4006 & & & & \\ \hline
4/8/06 & 0 & Map0 & CorrC203020 & 8 & 11 & -2.5 & 2.5 \\ \hline
7/8/06 & 7730 & Map7730b & CorrC7n07029 \(\sim\)7040 & 24 & 31 & -2.35 & 2.74 \\ \hline \end{tabular}
\end{table}
Table 4.1: The data sets used in this analysis. Those named ‘Map’ cover the whole volume and are used to make field maps, while other names indicate data used for special studies. The files names refer to the publicly available data [7]. Columns N\({}_{\rm o}\), N\({}_{\rm z}\), Z\({}_{\rm min}\) and Z\({}_{\rm max}\) refer to the range of positions taken by the mapper carriage, which supports four planes of Hall probes, so the number of Z planes scanned is four times N\({}_{\rm z}\)and it covers a further \(\pm\)0.25 metres in Z.

Figure 4.1: A small selection of the data from Map7730a after all the corrections that will be described below. We have selected three radial positions and one \(\varphi\) position (20\(\pi\)/16) to illustrate the shape of the field and the density at which it was mapped.

## 5 Hall probe calibration

The primary Hall card calibration involved placing each card in a highly uniform field whose strength was monitored by an NMR probe. The card was turned to many different orientations with angles \(\theta\) and \(\varphi\) that were measured very precisely by pickup coils. The measurements were repeated at several field strengths and temperatures.

The Hall voltage (V) is decomposed into orthogonal functions. Spherical harmonics are used for \(\theta\) and \(\varphi\) and Chebyshev polynomials for \(|\mathrm{B}|\) and temperature.

\[V(\mid B\mid,Temp,\theta,\varphi)=\sum_{k}\sum_{n}\sum_{l}\sum_{m=0}^{l}c_{{}_ {lim}}T_{{}_{k}}(\mid B\mid)d_{{}_{nlm}}T_{{}_{n}}(Temp)Y_{{}_{lm}}(\theta,\varphi)\]

Using this series about 200 parameters are necessary to calibrate each probe to 0.01% accuracy [6]. A separate angular calibration was used to find the orientation of the calibrated coordinate system relative to the three feet that support the Hall card on the mapping machine.

All Hall cards were calibrated up to 1.4 T in a magnet at CERN and up to 2.5 T in the M5 magnet at Grenoble. We would like to thank the Grenoble High Magnetic Field Laboratory for the generous offer of their facilities, which made the high field calibration of our probes possible. Compared with the CERN magnet, the Grenoble magnet had less temperature stability and a smaller region of uniform field, not large enough to operate the calibration jig simultaneously with an NMR probe.

Consequently the expected accuracy is \(\pm\) 2 G for the low field calibration and \(\pm\)10 G for the high field calibration. The alignment accuracy is expected to be \(\pm\)2 mrad for both calibrations. We knew in advance that 2 mrad alignment accuracy is not sufficient for our needs. However we also found in advance that it is possible to determine individual probe misalignments within 0.1 mrad from the map data itself, as described in Section 12.

Finally, we are able to make a comparison between the field measured by the Hall probes and the same field measured by the four NMR probes. We know that NMR is highly accurate so we can derive from this a correction that applies to the Hall probes as a whole. The difficulty with this comparison is that the NMR probes are just outside the volume scanned by the Hall probes, so some extrapolation must be done.

Two methods have been used and the difference between them gives a measure of the uncertainty. The first method is to use the field model which is fitted to the entire Hall probe data set to predict the field at the NMR positions. The second method is to plot the difference between the Hall probe data and this fit, on a line pointing towards the NMR probes, and extrapolate linearly outwards to the radius of the NMR. The first method makes best statistical use of the Hall data while the second takes into account the small discrepancy between the measurements and the fit. Whatever method is used, the correction is only measurable at the four mapped field strengths.

We can also look at the difference between the 5000 A map data when it is passed through either the high or low field calibration. All these differences are plotted in Figure 5.1.

This data is consistent with the hypothesis that the low field Hall calibration is very accurate, as expected, while the high field Hall calibration has a systematic bias that varies linearly with the field strength. So we make a correction to all Hall data that is processed through the high field calibration using the linear fit coefficients HC1, shown in blue in the figure. The possible systematic error in our final maps resulting from this correction is evaluated by using the alternative values labelled HC2. No such corrections are applied when the Hall data is processed through the low field calibration.

## 6 Mapping machine geometry

We work in a coordinate system that is identical to the Inner Warm Vessel (IWV) coordinate system used by the ATLAS survey team, except that we re-label the axes so that they approximately coincide with the more familiar ATLAS physics coordinate system:

\[x=y_{IWV}\approx x_{phys}\hskip 28.452756pt,\hskip 28.452756pty=z_{IWV}\approx y_{phys} \hskip 28.452756pt,\hskip 28.452756ptz=x_{IWV}\approx z_{phys}\]

The dimensions in this section are extracted from the results of five surveys:

* The inner detector rail survey [1].
* A detailed survey of the mapping machine in building 164 [2].
* The first underground survey [3] with the machine at \(Z\)=0 before the mapping campaign. This survey is thought to be less accurate and used only as a cross-check for...

Figure 5.1: Differences of field measured by the NMR system and high and low calibrations of the Hall probes. The error bars indicate the r.m.s. spread of the data behind each plotted point; for points comparing the fit to the NMR it is the r.m.s. of four numbers and for points comparing two calibrations of the Hall probes it is the r.m.s. of 48 numbers.

* The second underground survey [4], with the machine at Z=2.5 m after the mapping campaign.
* A survey of the positions of individual sensors within the Hall cards. Each survey individually had an accuracy of around 0.1 mm. When all this information is combined to calculate the position of a map point in the IWV coordinate system we estimate that the resulting accuracy is around 0.3 mm r.m.s.

Figure 6.1: Showing the numbering of the probes and the parameters of the idealised machine.

We number the Hall probes from 1 to 48. The surveyors used a labelling system based on A or C for the end of the machine, E or I for external or internal, and numbers 1-12. So the relation between the systems is given in Table 6.1.

The machine geometry is defined by first giving the parameters of the ideal geometry as drawn in Figure 6.1, then by describing the small deviations from this geometry. The parameters of the ideal machine are:

* **Zenc0,** the Z position in Atlas coordinates of the mapper carriage centre when its Z encoder reads zero. Surveyed values were -1.78 mm [3] and -1.75 mm [4]. We use **-1.77 mm**.
* **Fenc0**, the phi position in Atlas coordinates of the mapper axle when the phi encoder reads zero. Not surveyed but set up accurately at zero. We use **0 deg**.
* **ZarmA**, the distance in Z from the carriage centre to the mid-line of the arm at the A end. We use **0.2224 m** based on survey [2].
* **dZarmA**, the distance in Z from the mid-line of the arm A to the Hall sensors. Utilised **0.0278 m** based on survey [2].
* **FarmAE, FarmAI, FarmCI, FarmCE** the difference in phi from the mapper axle to the arms. Utilised **0,180,270,90** degrees. The survey [2] measured the arms to be perpendicular to within 0.04 degrees so we treat them as perfectly perpendicular.
* **ZarmC, dZarmC**. Similar to arm A, from survey [2], utilised **0.2224 m** and **0.0275 m**.
* **Rhall(12)**, the radial positions of the Hall probes on the arm. We use the nominal values **118, 228, 338, 438, 538, 638, 718, 798, 878, 938, 998, 1058 mm**. Nearly all (42 out of 48) of these positions were measured in survey [2]. The measured values differ from nominal by; max 0.3 mm, min -0.2 mm, r.m.s. 0.14 mm.
* **Fnmr**, the phi-angles of the four NMR probes. We use **135.17, 224.88, 314.99, 44.75 degrees** respectively.
* **Rnmr**, radii of the NMR probes. Utilised **1.13020, 1.13045, 1.12967, 1.13240 m.
* **Znmr**, z-positions of the NMR. Utilised **-0.0042, -0.0047, -0.0026, -0.0043 m. All the NMR positions are based on surveys [3] and [4].

\begin{table}
\begin{tabular}{l|l|r|r} \hline Survey & label range & Our label range \\ \hline start & end & start & end \\ \hline AE1 & AE12 & 1 & 12 \\ \hline Al1 & Al12 & 13 & 24 \\ \hline C11 & C112 & 25 & 36 \\ \hline CE1 & CE12 & 37 & 48 \\ \hline \end{tabular}
\end{table}
Table 6.1: Relation between surveys and probe numbering. A and C refer to the two ends of Atlas. E and I refer to the external and internal faces of the arms.

**6a. Arm tilts**

The final machine survey found that the two arms were tilted at different angles relative to the IWV axis. The survey data for arms AE and CI have been analysed to provide tilt information, and arms AI and CE are assumed to have the same tilts as AE and CI respectively. The plane in which an arm moves is defined by the normal unit vector \(a\hat{x}+b\hat{y}+c\hat{z}\),where for arm A, \(a\) = -0.000438, \(b\) = -0.001267 and for arm C, \(a\) = -0.000422, \(b\) = +0.000482. The opposite-signed \(b\) values correspond to both arms drooping slightly below the horizontal.

**6b. Rotation centre offsets**

The centre of rotation of the arms is also offset from the IWV axis. This leads to a correction of the positions but not the field components in Cartesian coordinates. However, once transformed back to cylindrical coordinates, field components also change because the r and phi directions have changed. The centre of rotation is shifted \(\Delta x\) = -0.0001, \(\Delta y\) = +0.00105 for arm A, and \(\Delta x\) = +0.0001, \(\Delta y\) = +0.00125 for arm C (all values in metres). These shifts were measured in survey [4] when the mapping machine was at z = +2.5 m.

**6c. Rail tilt**

A survey of the rails [1] found that they had a tilt of +0.0775 mm/m. The correction for the rotation centre of the arms becomes

\[\Delta y=rail\ tilt\times(\ z-2.5\ )+\ \Delta y(at\ z\)=2.5)\]

**6d. Machine skew**

Additionally, the machine chariot can be skewed because the wheels on the rails do not travel exactly the same amount in \(z\). There are separate encoders on the two rails so we can see the skew and correct for it by correcting the positions and field components of the Hall probes. Typical skew values were \(<0.1\) mrad with extremes of up to 0.3 mrad. The chariot was assumed to be a rigid body which rotated about its centre. The centre was defined to lie on the \(z\)-axis (i.e., \(x\)=0, \(y\)=0) with \(zmap\) = average of the two rail positions \(z0\) and \(z1\). ( \(R_{rail}\) = 1.110 m )

\[zmap=\frac{1}{2}\big{(}z0+z1\big{)}\,,\ \ \ skew=\frac{\big{(}z0-zmap\big{)}}{R _{rail}}\,,\ \ \ \Delta z=z-zmap\]

\[\sin\delta=skew\,,\ \ \ \cos\delta=\sqrt{1-skew^{2}}\]

\[x^{\prime}=x\cos\delta-\Delta z\sin\delta\,\ \ \ y^{\prime}=y\,\ \ \ z^{\prime}= zmap+\Delta z\cos\delta+x\sin\delta\]

\[\ B_{x}^{{}^{\prime}}=B_{x}\cos\delta-B_{z}\sin\delta\]

\[\ B_{y}^{{}^{\prime}}=B_{y}\]

\[\ B_{z}^{{}^{\prime}}=B_{z}\cos\delta+B_{x}\sin\delta\]

The corrections in this and the preceding sections are applied to the data before it is stored in the "CorrC" format [7].

**6e. Offsets of Hall sensors from a common point**

This correction is not applied to the CorrC data because it deals with the fact that the three field components are not really measured at a common point, as is assumed by CorrC. The location of the field measurement given in CorrC refers to a point roughly at the center-of-mass of the three Hall sensors that measure the individual field components.

These Hall sensor positions have been measured on a sample of 9 cards, randomly chosen from the 48 cards used for mapping. In fact what one can measure on the card is the position of the package that holds the Hall sensor, so in addition we use information from the manufacturer on the position of the sensor within the package. We also measured the target adapter that was used for the surveys of the mapping machine; this is what defines the nominal position of the triplet of sensors. Combining all the above information, as indicated in Figure 6.3, leads to calculated offsets of real sensor positions from the nominal position. The relevant offsets are shown below,

Figure 6.3: Hall sensor positions (mm). In X,Y they are relative to the target adapter hole (large circle). In Z they are relative to the plane of the Hall card feet. Note that the offsets of the Hall sensors from the centre of their SMD packages are included in the reported positions.

Figure 6.2: Hall Card Detail. This shows the arrangement of Hall sensors glued onto three perpendicular faces of a small glass cube. The annular object is one of the three feet that locate the card on the mapping machine.

while the others have negligible effect because our field is almost independent of phi.

The r.m.s. spread of the offsets in the nine cards sampled was typically 0.2 mm, so the means are probably accurate to about 0.1 mm.

## 7 NMR Data

The Inner Detector is equipped with four NMR probes which are fixed to the wall of the inner warm vessel near R=1.13 m and Z=0 (exact positions in Section 6). The NMR probes were operational throughout the commissioning of the solenoid and the mapping of the field, and remain in place to monitor the field strength during the lifetime of Atlas. These probes measure the field strength with accuracy of around 0.1 G. Figure 7.1 shows a typical sample of the raw NMR data at full field.

It can be seen that the field is very stable but there are some glitches, due either to noise affecting all probes (around reading 85) or occasions when the multiplexer failed to switch and a reading was attributed to one probe when in fact it was from another (around reading 5). These glitches are removed by hand and the remaining data averaged within each map period to give the results in Table 7.1.

\begin{table}
\begin{tabular}{|l|c|c|c|c|} \hline  & Probe A & Probe B & Probe C & Probe D \\ \hline Map7730a & 2.028837 & 2.029652 & 2.028481 & 2.029078 \\ \hline Map5000 & 1.312676 & 1.313181 & 1.312396 & 1.312812 \\ \hline Map7850 & 2.060301 & 2.061129 & 2.059939 & 2.060547 \\ \hline Map7000 & 1.837422 & 1.838149 & 1.837099 & 1.837639 \\ \hline Map7730b & 2.028840 & 2.029656 & 2.028485 & 2.029083 \\ \hline \end{tabular}
\end{table}
Table 7.1: Averaged NMR values (Tesla) from each probe for each map.

\begin{table}
\begin{tabular}{|l|c|c|c|c|} \hline  & \multicolumn{2}{c|}{Offset of Br sensor in the...} & \multicolumn{2}{c|}{Offset of Br sensor in the...} \\ \hline  & Z direction & R direction & Z direction & R direction \\ \hline Arms AE \& CI & -0.67 & -1.32 & -0.90 & +1.59 \\ \hline Arms AI \& CE & +0.67 & -1.32 & +0.90 & +1.59 \\ \hline \end{tabular}
\end{table}
Table 6.2: Offsets in mm, to be applied to the nominal position of the sensor triplet in order to get the real position of individual sensors in Atlas coordinates.

Figure 7.1: Sample of raw NMR data.

An early concern was that there could be some hysteresis in the iron contribution to the field that would make it difficult to reach a predictable operating condition. This proved not to be true, as Figure 7.2 demonstrates. During commissioning and mapping the solenoid current was taken nine times to 7730 A and on eight of those occasions the current was approached from below. The average of the four NMR probe readings was recorded each time and is plotted in the figure showing that the hysteresis effect, if any, is no more than 0.2 Gauss. Once, between cycles 3 and 4, the 7730 A point was approached from above and that time the average NMR reading was 20293.27 Gauss, showing that the direction of approach does matter. For Atlas physics running the operating current will be approached from below.

We can derive from the data in Table 7.1 information about the saturation of the calorimeter iron magnetisation. Saturation will produce a non linearity in the relation between current and field. We can see this by subtracting the very dominant linear part and plotting the remainder, as shown in Figure 7.3. The distortion of the solenoid by magnetic forces also causes a non linearity which goes in the opposite direction, so we can not read off the iron saturation effect directly from this plot.

**8. Special scans**

The data set Pzero7730a was used to measure the repeatability of the Hall probes. Figure 8.1 shows the difference between pairs of measurements made by the same Hall probe at the same position in space, separated in time by the few minutes required to make a 360 degree rotation of the axle. The measurements are near the z=0 plane and only the B\({}_{\mathrm{z}}\) component of the field is used, so any tilts or imperfections

Figure 7.3: **Small deviation from linearity between current and field.**

Figure 7.2: **NMR data demonstrating negligible hysteresis.**

of the machine movements have negligible effect. The r.m.s. is only 0.30 G, showing that the random part of the Hall probe error is a negligible 0.21 G.

The fine Z scan around Z=0, FineZ5000, was used to check that the weld between solenoid sections was at the expected position. We found that over this limited Z range the \(|\)B\(|\) measured by the outermost Hall probes fits well to a quadratic minus a Gaussian function. Looking at Figure 8.2 it is plausible to assume the quadratic fits the shape that the field would have with no weld and the Gaussian fits the small dip caused by the weld.

### 8.3 Weld fits at 16 \(\varphi\) positions.

Figure 8.1: Repeatability of Hall probe measurements.

Figure 8.2: The quadratic minus Gaussian function fits the field magnitude.

This fit was repeated at the 16 \(\upphi\) positions of the scan, as shown in Figure 8.3. Thus we have 16 independent estimates of the weld position and they have a total range between 6.5 and -8.5 mm, with mean -1 mm and r.m.s. 3 mm. This allows us to be confident that the centre weld is really within 5 mm of \(Z\)=0, which is good enough for our needs.

The fine \(\upvarphi\) scans FineF7730a and FineF5000 were used to discover and measure the perturbation of the field caused by the mapping machine itself, as described in Section 13.

**9. The purposes of fitting**

We only fit the map data to models of the field that obey Maxwell's equation in the absence of current and magnetic materials; \(\mbox{div}\ \underline{\mbox{B}}=\mbox{curl}\ \underline{\mbox{B}}=0\). So if we find that our field model does not fit the data it either means that our model is not detailed enough to represent the true field, or that there is a systematic error in the map data that makes it non-Maxwellian. Several months have been spent on tracing residuals back to one or other of these causes and thus correcting the data or improving the model. Another possible reason for fitting would be to smooth out any random errors in the data; however the level of truly random errors is around 0.2 Gauss so the benefit of smoothing this away is very small. Even if we had absolute confidence in the map data we would still need to make use of a field model because the map data points are not dense enough to allow us to calculate the field any all points in the ID volume by interpolation with the accuracy we need.

**10. The Geometrical** **Fit**

We use a detailed model of the conductor geometry and integrate the Biot-Savart law using the measured conductor current to produce a field model that we expect to account for most of the measured field. Within our conductor geometry model there are several parameters taken from surveys of the solenoid coil as built [13]. For example the coil was built from four sections, each with slightly different average pitch, and joined together by welds that can be represented electrically by turns having just under twice the average pitch. There are also welds at the ends of the coil and a return conductor that runs axially along the outside of the support cylinder. We include the expected distortion of the solenoid from its surveyed dimensions due to shrinkage on cooling. We also include the distortion due to magnetic forces [10]. We assume that the coil has a perfectly circular cross section.

We allow two free parameters to our conductor model; an overall scale factor of all dimensions in the axial direction and an independent scale factor in the radial direction. Technically this is achieved in the software by mixing two field models with slightly different aspect ratios (coil length/diameter) that bracket the true aspect ratio, then by scaling the resulting mixture equally in both the radial and axial directions. Both mixing and scaling are simple transformations that can be done in a second of CPU time, whereas creating a field model with a new aspect ratio requires the Biot-Savart integral to be evaluated at every point in the map which takes about 2 hours.

We have a further five free parameters representing three offsets and two rotations of the conductor model relative to the map coordinate system. Finally we include four z-symmetric terms of a Fourier-Bessel series, which are intended to represent the field due to the magnetised iron. The length scale of the lowest term was chosen to be 2.5 m because this value allows a good fit to the iron field predicted by ATLM with only 4 terms. So the fit has a total of 11 free parameters, which are found by using MINUIT to minimise a \(\chi^{2}\) function that includes the B\({}_{\rm z}\) and B\({}_{\rm r}\) components of the field at all mapped points.

### The general Maxwell fit

Any magnetic field which obeys divB = curlB = 0 can be represented by a sum of the functions described below. Furthermore, the field anywhere inside a volume is fully determined by the field values on the surface that encloses the volume. The general Maxwell fit [8] uses these features to find a function that closely matches the measured data on the surface of the mapped volume and this function then predicts the field at any point within the ID. All three functions described below are infinite series. In principle an infinite number of terms would be needed to describe an arbitrary field but in practice each series has to be truncated somewhere. The number of coefficients we can evaluate is eventually limited by the number of data points on the cylinder surface, but in fact we work with a much smaller number of terms. We have chosen an expansion that matches the nearly-cylindrical character of our field and so it converges quite rapidly.

Figure 10.1: The main dimensions of the conductor geometry model of the solenoid, when cold but not carrying current.

In our situation the majority of the B\({}_{\rm z}\) field is represented by a sum of Fourier-Bessel terms of the form

\[A_{n0}r^{n}\cos(n\phi+\alpha_{n0})\]

and

\[A_{n}I_{n}\biggl{(}\frac{l\pi}{L}r\biggr{)}\!\cos(n\phi+\alpha_{n!})\cos\! \biggl{(}\frac{l\pi}{L}z\biggr{)}\!+B_{n!}I_{n}\biggl{(}\frac{l\pi}{L}r\biggr{)} \!\cos(n\phi+\beta_{n!})\sin\!\biggl{(}\frac{l\pi}{L}z\biggr{)}\]

where \(L\) is the half-length of the cylinder and the \(I_{n}\) are modified Bessel functions. The coefficients \(A\), \(B\) and phases \(\alpha\), \(\beta\) of these terms are evaluated solely from the B\({}_{\rm z}\) measurements on the curved surface of the mapped cylinder. After subtraction of the Fourier-Bessel terms from the measured data one is left with non-zero B\({}_{\rm z}\) values on the cylinder ends. These can be represented by hyperbolic terms of the form

\[C_{mn}J_{n}\biggl{(}\frac{\varepsilon_{nm}}{R}r\biggr{)}\!\cos(n\phi+\gamma_{ nm})\cosh\!\biggl{(}\frac{\varepsilon_{nm}}{R}z\biggr{)}\!+D_{mn}J_{n}\biggl{(} \frac{\varepsilon_{nm}}{R}z\biggr{)}\!\cos(n\phi+\delta_{nm})\sinh\!\biggl{(} \frac{\varepsilon_{nm}}{R}z\biggr{)}\]

where \(\zeta_{nm}\) are the zeros of the Bessel functions \(J_{n}\). These terms are chosen so that they have a zero at the mapper radius \(R\) in order to avoid changing B\({}_{\rm z}\) on the curved surface. The corresponding B\({}_{\rm r}\) and B\({}_{\rm\phi}\) components of the field are given by rather similar terms with the same coefficients.

After subtraction of both FB and hyperbolic terms from the data one is only left with components of the field which are independent of z and make no contribution to B\({}_{\rm z}\). B\({}_{\rm r}\) is represented by multipole terms of the form

\[E_{n}nr^{n-1}\cos(n\phi+\varepsilon_{n})\]

where the coefficients are evaluated from the B\({}_{\rm r}\) residuals on the curved surface of the cylinder.

We make use of the general Maxwell fit in calculating the probe normalisation corrections below. We also apply it to the residuals of the geometrical fit, where it allows us to improve our representation of the data without straying outside the laws of physics. We have also tried it on whole field maps but we do not report the results here because it has no advantage over the geometrical fit and the many parameters do not have simple physical interpretations, such as coil dimensions and displacements that can be cross-checked against other information.

**12. Probe normalisation and alignment corrections**

The strong constraints on the possible field from Maxwell's equations, combined with the fact that the field at the origin can be almost completely determined from the B\({}_{\rm z}\) measurements of a single Hall probe, allows us to determine all three probe alignment angles and to normalise the B\({}_{\rm z}\) component to a common scale for all probes. This calibration method is described in detail in [8]. It is applied separately to the low (5000 A) and high (all other currents) field maps because the underlying Hall calibrations are different in these two cases.

Figure 12.1 shows the B\({}_{\rm z}\) normalisation correction that we use for the high field maps. There is no significant structure versus probe number. The mean is zero by construction and the r.m.s. is 3.4 \(\times 10^{-4}\), slightly better than the \(\pm 10\) G expectation. In the case of the low field map, the r.m.s. is 0.8 \(\times 10^{-4}\), also slightly better than the \(\pm 2\) G expectation.

Figure 12.2 shows the probe alignment corrections that we use for the high field maps. The R-Z angle is by far the most important because it mixes the two large components of the field that are used in the fit \(\chi^{2}\). The mean angle is slightly negative and there is an r.m.s. of 3.1 mrad, somewhat worse than the \(\pm 2\) mrad expected from the Hall probe angular calibration procedure. There is no significant structure except that probe number 6 stands out; on dismantling the mapping machine this probe was found to be poorly attached to the arm.

The R-\(\varphi\) angle is poorly determined on the lowest radius probes (numbers 1,13,25,37) because both B\({}_{\rm r}\) and B\({}_{\rm\varphi}\) are always very small for these probes, conversely this angle has little influence on the final map. The remainder of the R-\(\varphi\) and Z-\(\varphi\) angles show a scatter of around 3 mrad, with possibly some systematic effects, but again they have little influence on the fit.

Figure 12.2: Probe alignment corrections for the high field maps.

**13. Mapper dipole corrections**

Early investigations of the data showed variations of the field versus \(\varphi\) that were unlike anything predicted by our field models. We will discuss here only the B\({}_{\rm z}\) component because it is not influenced by probe misalignments of a few mrad, but these variations also exist in the B\({}_{\rm r}\) and B\({}_{\rm\varphi}\) components where they are mixed with probe alignment effects. Figure 13.1 shows a typical example of B\({}_{\rm z}\) measured by arm CI in a fine \(\varphi\) scan of 64 steps. We plot B\({}_{\rm z}\) measured minus B\({}_{\rm z}\) of our model but in fact the \(\varphi\) dependence of B\({}_{\rm z}\) in the model is well below 1 Gauss so all the variation seen in this plot is coming from the measurements.

We now understand the features in Figure 13.1 as being due to two independent effects. First is a low-spatial-frequency effect in \(\varphi\) that is seen in probes at all radii and has amplitude that is approximately proportional to radius. This effect changes, also with low spatial frequency, as a function of Z. We suspect that it is due to very small variations in the density of the windings in different regions of the solenoid coil.

The second effect is spikes or bumps that are only seen by one or two neighbouring probes in a narrow \(\varphi\) range. For most probes they appear near 0 and 180 deg but for the innermost two probes the bump is broader and is centred at 90 deg. These features are independent of Z. Another clue is that they are most pronounced on the inner sides of the arms and especially on arm CI. All this is consistent with the features being perturbations of the field cause by small magneisable components on the mapping machine itself. We have tracked down a list of components on the machine which are probably the culprits. The positions of these components are known but their magnetisability has to be got from the map data itself. We represent each of the magnetic components by a dipole field located at the known position on the machine and with a strength that is adjusted by hand to make the residuals plot look as smooth as possible after subtraction of the dipoles. The dipole direction is aligned with the local direction of the field, so it changes as the machine moves along the rails. The dipole strength is constant, independent of the local field strength, because we found that this gives the lowest residuals, which indicates that the magnetic components are fully saturated.

Figure 13.1: **Bz residuals in a fine phi scan at Z = -0.195 m.**The final result for arm CI is shown in Figure 13.2. There is a significant improvement but clearly our model of the perturbation due to the machine is not quite perfect as some small spikes remain. The reason for making this effort to correct for localised perturbations of only a few Gauss is that the methods used in [8] rely on having a field that accurately obeys Maxwell. The intrinsic accuracy of the Hall probes is so good that these machine perturbations would be the dominant error in Sections 12 and 14 if they were not corrected.

## 14 Carriage Tilts

The x component of the field on the axis of the mapping machine can be evaluated by using one of the probes at low radius and taking the average of \(\mathrm{B_{x}}\) over the 16 equally spaced \(\varphi\) steps. All of the low radius probes on one arm give consistent results for \(\mathrm{B_{x}}\) and \(\mathrm{B_{y}}\) measured in this way. At higher radius results diverge because 16 steps are not enough to accurately average to zero the transverse field due to the return conductor. The measurement can also be done using either the \(\mathrm{B_{r}}\) or the \(\mathrm{B_{\varphi}}\) component of the field and these also give consistent results within 1 G.

If \(\mathrm{B_{x}}\) or \(\mathrm{B_{y}}\) are plotted against z we see that the different arms do not agree on a unique value of the field at each z position; Figure 14.1. But if they are plotted against the z position of the mapping machine carriage, \(\mathrm{z_{car}}\), then we see in Figure 14.2 a

\begin{table}
\begin{tabular}{|l|c|c|c|c|} \hline
**Component** & **Z (m)** & **R (m)** & **Phi (deg)** & **Strength (A m\({}^{2}\))** \\ \hline Phi encoder & -0.02 & 0.190 & 90 & 9.0 \\ \hline Phi motor bearings & -0.13 & 0.378 & 164 & 2.3 \\ \hline Z motor bearings & -0.13 & 0.772 & 171 & 2.3 \\ \hline Plug on ESB & -0.04 & 0.457 & 9 & 16.8 \\ \hline Z encoder & -0.04 & 1.080 & 188 & 5.6 \\ \hline Z encoder & 0.00 & 1.080 & 352 & 5.6 \\ \hline Electrical valve & -0.08 & 0.865 & 18 & 3.2 \\ \hline Electrical valve & -0.08 & 0.830 & 162 & 3.2 \\ \hline Z motor bearings & -0.13 & 0.830 & 8 & 2.3 \\ \hline \end{tabular}
\end{table}
Table 13.1: Magnetic components on the mapping machine, with the position and strength of dipoles used to represent them.

Figure 13.2: Bz residuals in a fine phi scan at Z = -0.195 m after the mapper dipoles correction.

much more coherent picture. These features are explained if the carriage tilts slightly as it moves along the rails, this imparting a common error to all measurements as a function of \(z_{\rm car}\). The offset between the transverse fields measured by arms A and C can be explained by small errors in the surveyed values of the arm tilts. So we apply a correction to the tilts of arms A and C to bring them into agreement with each other without changing their average value. This is done by changing the \(a\) and \(b\) parameters of Section 6a. For arm A we use \(\Delta a\)=0.00004, \(\Delta b\)=0.00011 and for arm C we use \(\Delta a\)=-0.00004, \(\Delta b\)=-0.00011.

We have developed an integral method to calculate the carriage tilts from the data, which is described in detail in [8]. The integral needs a starting point of some \(z_{\rm car}\) value at which the carriage tilt is known. One option is to trust the survey data, which amounts to setting the tilt to be zero at \(z_{\rm car}=2.5\) because this is where the carriage was surveyed and the data have already been corrected for the surveyed axle tilt; this gives a correction set which we call CT1. However we do not expect the survey [4] to be

Figure 14.2: The transverse field on the mapper axis plotted against the z position of the carriage

Figure 14.1: The transverse field on the mapper axis plotted against the z position of the probe

highly accurate because the axle directions measured in an earlier survey [3] differ from it by up to 1 mrad. Rather than accept a systematic error of 1 mrad we have used the map data itself to choose offsets of the carriage tilt in the horizontal and vertical directions which minimise differences between the four arms. The required offsets change the surveyed axle directions by \(\Delta a\)=0.00024, \(\Delta b\)=-0.00011, thus giving an alternative correction set which we call CT2.

Figure 14.3 shows a compilation of the tilt values CT1 from all maps. We see that the rotations around the horizontal axis, \(\Delta b\), are quite jagged, possibly due to the machine going over steps and bumps of order 0.1 mm in the rail height. Any rotations around the vertical axis caused by the rails should have been picked up and already corrected by the separate encoders on the two rails, so we assume that the non-zero values of \(\Delta a\) are due to imperfections of the encoders themselves.

### 15 Fit quality measures

The quantity minimised in our fit is

\[\chi^{2}=\sum_{i,c}\Biggl{(}\frac{B_{c,i}^{measured}-B_{c,i}^{fit}}{5\;G} \Biggr{)}^{2} \tag{1}\]

where the index \(i\) runs over all the measured points and the component index \(c\) can be one or more of z, r and \(\varphi\). For our final results we use the z and r components but for systematic studies we also use z alone or all three. Another systematic test, designed to be insensitive to probe alignment is to minimise

\[\chi^{2}=\sum_{i}\Biggl{(}\frac{\mid B_{i}^{measured}\mid-\mid B_{i}^{fit}\mid}{5 \;G}\Biggr{)}^{2} \tag{2}\]

Figure 14.3: A compilation of carriage tilt corrections CT1 from all maps.

[MISSING_PAGE_FAIL:22]

The expected offsets of the solenoid centre were -0.1 \(\pm\) 2.3 mm axial, -0.3 \(\pm\) 0.4 mm horizontal, -2.2 \(\pm\) 0.4 mm vertical [14]. Our fitted offsets are consistent with these expectations in the axial and vertical directions. The fitted horizontal offset is in the opposite direction to that expected but the discrepancy is only 1.5 \(\sigma\). At first sight the fitted scale Z and R scale factors appear very close to 1, however the Z scale of 1.0012 amounts to a change of 6 mm in the total length of the coil, which is difficult to reconcile with the coil survey accuracy. The radial scale factor that comes from our fit is compatible with survey information.

The conductor model used in all these fits had the expected dimensions of the coil at 7730 A, so the slight changes of the Z and R scale factors with current could be due to the real distortion of the coil by magnetic forces. Also, since the coil is fixed at end A and free at end C, one expects the slight movement of the coil centre in the +z direction as it gets shorter.

We believe that the ripples seen in these residual plots at \(|\)Z\(|\)\(<\) 2m are due to variations in the coil winding density. The winding density was measured at intervals of 50 turns and 45\({}^{\circ}\), with accuracy 0.5 mm [13]. This data was used to set the average pitch of each 288-turn section of the coil in our conductor model. The data also shows that there are smaller scale variations in the winding density but it is not accurate enough for us to put them into our conductor model with any confidence. So it is not surprising that we see these residual ripples at the 5 G level.

The bigger features in the residuals plots at \(|\)Z\(|\)\(>\)2m could also be due to winding density variations but we believe it is more likely that they are a result of the coil not having a perfectly circular cross section. Four points on each end of the coil were surveyed [12]. The deviation of the measured points from fitted circles were up to 2.7 mm, indicating that it is not circular but not giving us enough information to know its real shape. The field near the ends of a long solenoid depends on its cross sectional shape and area, whereas the field becomes independent of the section as you move towards the middle. This suggests that any residuals due to having the wrong coil cross section in our conductor model will be largest near the coil ends.

The 0 A map shows a field of 4.2 G at the centre and fits well to a single Fourier-Bessel term with length scale 2.52 metres. The fit residuals are around 1.2 Gauss in all three field components.

\begin{table}
\begin{tabular}{l|c|c|c|c|c|c|c|c|c} \hline Map & \multicolumn{3}{c|}{Offsets (mm)} & \multicolumn{3}{c|}{Angl (mrad)} & \multicolumn{3}{c|}{Scale factors} & \multicolumn{2}{c}{Field at centre} \\ \hline  & x & y & z & A\({}_{\rm x}\) & A\({}_{\rm y}\) & Z & R & (Gauss) & \% iron \\ \hline
5000 & 0.44 & -2.52 & 0.36 & -0.11 & 0.20 & 1.00159 & 0.99900 & 12926.2 & 4.108 \\ \hline
5000h & 0.42 & -2.54 & 0.35 & -0.11 & 0.18 & 1.00154 & 0.99913 & 12925.2 & 4.099 \\ \hline
7000 & 0.33 & -2.41 & 0.48 & -0.06 & 0.16 & 1.00137 & 0.99919 & 18092.6 & 4.074 \\ \hline
**7730a** & **0.26** & **-2.42** & **0.51** & **-0.08** & **0.19** & **1.00121** & **0.99926** & **19977.5** & **4.052** \\ \hline
7730b & 0.17 & -2.63 & 0.55 & -0.13 & 0.23 & 1.00122 & 0.99927 & 19977.7 & 4.054 \\ \hline
7850 & 0.35 & -2.50 & 0.60 & -0.12 & 0.23 & 1.00126 & 0.99954 & 20287.3 & 4.060 \\ \hline \end{tabular}
\end{table}
Table 16.2. Parameter values of the geometrical fit.

Figure 16.1: **Bz residuals from the geometrical fit to map7730a.**

Figure 16.2: Br residuals from the geometrical fit to map7730a.

Figure 16.3: **B\(\varphi\) residuals from the geometrical fit to map7730a.**

**17. Application of the Maxwell fit to the Geometrical residuals**

If either of the explanations above is correct then the residuals that we see after the geometrical fit are due to real magnetic fields rather than measurement errors. In this case they will obey Maxwell and we can fit them with the general function that is described in Section 11. We chose the truncation point of each series by looking at the behaviour of the fit residuals as the number of terms is increased from a low level. We find that the residuals improve rapidly at first then more slowly, so we truncate the series when the rate of improvement of the residuals becomes low. The resulting series has up to 25 Fourier-Bessel terms and up to six additional hyperbolic terms in (r,z) describing the azimuthally symmetric component of the field. Further Fourier-Bessel and hyperbolic terms, modulated by \(\cos(\varphi)\), \(\sin(\varphi)\), \(\cos(2\varphi)\) and \(\sin(2\varphi)\) are needed to describe the small azimuthal dependence. Thus the total number of parameters determined from the data is; for the Fourier-Bessel series 245 coefficients and 196 phases; for the hyperbolic series 60 coefficients and 48 phases; for the multipole series 4 coefficients and 4 phases.

**18. Results of final fit**

The effect of the Maxwell fit is to significantly reduce the residuals of all probes. We remind the reader that this function is evaluated using only measurements on the surface of the cylinder and is dominated by the curved part of the surface which is measured by just the four outermost Hall probes. So the fact that the function matches the inner probes too it is very strong evidence that the difference between the data and the geometrical model is a real field, not a measurement error.

The inclusion of the Maxwell fit has a beneficial effect on the fit quality as measured by \(\delta\)S/S at high \(\eta\). This is because the geometrical fit had \(\sim\)5 G residuals in B\({}_{\rm r}\) at around z = 1m and low radius. In this region for high \(\eta\) tracks B\({}_{\rm r}\) is just as important for bending the track as B\({}_{\rm z}\). The track has a long path length before exiting the ID and the denominator S is falling rapidly with \(\eta\), which conspires to make a B\({}_{\rm r}\) residual of only 5 G important.

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|} \hline Map & \multicolumn{2}{|c|}{B\({}_{\rm z}\) (G)} & \multicolumn{2}{|c|}{B\({}_{\rm r}\) (G)} & \multicolumn{2}{|c|}{B\({}_{\rm\varphi}\) (G)} & \multicolumn{2}{|c|}{\(\delta\)S/S (\(\times 10^{-4}\))} \\ \hline  & r.m.s. & extreme & r.m.s. & extreme & r.m.s. & extreme & r.m.s. & extreme \\ \hline
5000 & 2.27 & -25.1 & 1.84 & -29.8 & 1.89 & +11.3 & 1.75 & +6.8 \\ \hline
5000h & 3.69 & -28.5 & 3.30 & -29.4 & 2.72 & +12.5 & 2.05 & +8.0 \\ \hline
7000 & 5.01 & -33.4 & 4.36 & -34.7 & 3.19 & +15.9 & 1.62 & +7.7 \\ \hline
**7730a** & **4.35** & **-37.1** & **3.52** & **-33.6** & **2.96** & **+14.9** & **1.40** & **+7.3** \\ \hline
7730b & 3.32 & -32.4 & 3.43 & -54.1 & 3.26 & +14.9 & 1.36 & +6.8 \\ \hline
7850 & 3.55 & -32.6 & 3.47 & -48.6 & 3.12 & +16.0 & 1.66 & +10.1 \\ \hline \end{tabular}
\end{table}
Table 18.1: Quality indicators of the final fit residuals.

Figure 18.1: Bz residuals from the final fit to map7730a.

Figure 18.2: Br residuals from the final fit to map7730a.

Figure 18.3: **B\(\varphi\) residuals from the final fit to map7730a.**

**19. Error estimates**

We divide the error into two parts; one uncertainty about the shape of the field and another uncertainty about the scale of the field. We estimate the shape uncertainty of our final fit by making'reasonable' changes to our analysis and seeing what effect they have on the results. One type of change that we consider reasonable is to change the way that we evaluate a correction, or to completely ignore a small correction.

Another reasonable change is to use a different choice of field components in the \(\chi^{2}\) that is minimised in the fit. If the field was perfectly understood this would make no difference. A final possibility is to fit to the 5000 A data and scale up the result in some way. However the scaling is not trivial and will introduce errors of its own, while many other systematics will be in common. Keys for the error estimates:

**None** - no change, the standard Geometrical + Maxwell fit to the data set 7730a.

**HC2** - use the alternative high field correction described in Section 5.

**noHC** - remove the high field correction completely. This is too big a change to use for error estimation but we include it for reference.

**CT2** - use the alternative carriage tilt correction described in Section 14.

**noCT** - remove the carriage tilt correction completely. This is too big a change to use for error estimation but we include it for reference.

**noMD** - remove the mapper dipoles correction.

**Zonly** - fit to the B\({}_{\rm z}\) component of the field only

**ZRF** - fit to all three field components

**Bmod** - fit to the modulus of the field only

**5000s** - compare with the standard fit to data set 5000, scaled up by the ratio of the NMR values.

We quantify the effect of these changes by showing the quality indicators for the fit residuals in Table 19.1 and the fitted parameter values in Table 19.2. However the most important results are in Table 19.3 where we show the quality indicators for the difference between the modified fit and our standard fit. In this comparison the mean can be non-zero so we show the mean and the r.m.s. deviation from zero.

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|} \hline Map & \multicolumn{2}{|c|}{B\({}_{\rm z}\) (G)} & \multicolumn{2}{|c|}{B\({}_{\rm r}\) (G)} & \multicolumn{2}{|c|}{B\({}_{\rm o}\) (G)} & \multicolumn{2}{|c|}{\(\delta\)S/S (\(\times 10^{-4}\))} \\ \hline  & r.m.s. & extreme & r.m.s. & extreme & r.m.s. & extreme & r.m.s. & extreme \\ \hline None & 4.35 & -37.1 & 3.52 & -33.8 & 2.96 & +14.9 & 1.40 & +7.3 \\ \hline HC2 & 4.35 & -37.1 & 3.86 & -32.0 & 2.96 & +14.9 & 1.60 & +7.9 \\ \hline noHC & 4.38 & -37.1 & 5.64 & -33.9 & 2.96 & +14.9 & 2.45 & +9.7 \\ \hline CT2 & 4.34 & -37.1 & 3.52 & -33.7 & 2.90 & +15.2 & 1.29 & +6.5 \\ \hline noCT & 4.43 & -38.0 & 5.52 & -35.0 & 5.30 & +19.5 & 2.43 & +8.1 \\ \hline noMD & 4.36 & -37.2 & 3.57 & -33.5 & 3.06 & +15.4 & 1.50 & +7.1 \\ \hline Zonly & 4.35 & -37.1 & 3.52 & -33.7 & 2.96 & +14.9 & 1.41 & +7.4 \\ \hline ZRF & 4.35 & -37.1 & 3.52 & -33.9 & 2.96 & +14.9 & 1.40 & +7.3 \\ \hline Bmod & 4.35 & -37.1 & 3.52 & -33.7 & 2.97 & +14.9 & 1.41 & +7.4 \\ \hline
5000s & 3.51 & -38.8 & 2.84 & -46.1 & 2.92 & +17.5 & 1.75 & +6.8 \\ \hline \end{tabular}
\end{table}
Table 19.1: Quality indicators of the residuals of reasonable alternative fits.

For our final shape error estimate we combine in quadrature a selection of numbers from the right hand column of Table 19.3. We select **HC2**, **CT2** and **noMD** as being real uncertainties. We select **Bmod** because this causes the biggest change and exclude the other choices of field components to fit, because including them would probably be double counting this error. There is also a shape error due to the difference between the measurements and the best fit, the value 1.4 \(\times 10^{-4}\) is taken from Table 16.1. The resulting total shape error on \(\delta\)S/S is 6.6 \(\times 10^{-4}\).

The overall scale uncertainty applies to all of our fits and comes from the limited accuracy with which we can match up the Hall and the NMR data. There are two parts to this. One part comes from the spread of the NMR-Hall difference over the 4 NMR probes. We take the r.m.s. of the difference evaluated by the extrapolation method; 2.5 G giving \(\delta\)S/S = 1.25 \(\times 10^{-4}\). We do not feel that it is safe to divide the r.m.s. by \(\sqrt{\mathrm{n}}\) in this case because it is not really a random error.

The other part comes from the way that any NMR-Hall comparison is influenced by the weld thickness used in our conductor model. Figure 19.1 shows the field

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|c|c|c|} \hline Map & \multicolumn{3}{c|}{\(\mathrm{B_{z}\,(G)}\)} & \multicolumn{3}{c|}{\(\mathrm{B_{r}\,(G)}\)} & \multicolumn{3}{c|}{\(\mathrm{B_{\varphi}\,(G)}\)} & \multicolumn{3}{c|}{\(\delta\)S/S (\(\times 10^{-4}\))} \\ \hline  & mean & r.m.s. & Mean & r.m.s. & mean & r.m.s. & mean & r.m.s. \\ \hline None & 0.00 & 0.02 & 0.00 & 0.02 & 0.00 & 0.01 & 0.00 & 0.01 \\ \hline HC2 & 0.03 & 0.55 & 0.00 & 0.36 & 0.00 & 0.01 & -0.02 & **0.28** \\ \hline noHC & 1.16 & 2.63 & 0.00 & 1.53 & 0.01 & 0.01 & +0.50 & 1.24 \\ \hline CT2 & 0.00 & 1.10 & 0.00 & 3.60 & 0.00 & 3.46 & +0.01 & **6.44** \\ \hline noCT & 0.02 & 0.99 & 0.00 & 4.04 & 0.00 & 3.97 & +0.01 & 7.16 \\ \hline noMD & 0.01 & 0.05 & 0.00 & 0.16 & 0.00 & 0.16 & +0.01 & **0.09** \\ \hline Zonly & -0.22 & 0.39 & 0.00 & 0.19 & 0.00 & 0.02 & -0.14 & 0.20 \\ \hline ZRF & 0.00 & 0.02 & 0.00 & 0.02 & 0.00 & 0.01 & 0.00 & 0.02 \\ \hline Bmod & +0.41 & 0.72 & 0.00 & 0.34 & 0.00 & 0.03 & +0.25 & **0.36** \\ \hline
5000s & -4.33 & 6.16 & -0.33 & 2.52 & 0.00 & 1.19 & -2.54 & 3.50 \\ \hline \end{tabular}
\end{table}
Table 19.3 Quality indicators of the difference between alternative fits and the standard fit.

\begin{table}
\begin{tabular}{|l|c|c|c|c|c|c|c|c|} \hline Map & \multicolumn{3}{c|}{Offsets (mm)} & \multicolumn{3}{c|}{Angl (mrad)} & \multicolumn{3}{c|}{Scale factors} & \multicolumn{1}{c|}{Field at centre} \\ \hline  & x & y & z & \(\mathrm{A_{x}}\) & \(\mathrm{A_{v}}\) & Z & R & (Gauss) & \% iron \\ \hline None & 0.26 & -2.42 & 0.51 & -0.09 & 0.19 & 1.00121 & 0.99926 & 19977.9 & 4.052 \\ \hline HC2 & 0.26 & -2.42 & 0.51 & -0.09 & 0.19 & 1.00120 & 0.99925 & 19978.4 & 4.053 \\ \hline noHC & 0.26 & -2.42 & 0.50 & -0.09 & 0.19 & 1.00115 & 0.99919 & 19981.1 & 4.060 \\ \hline CT2 & 0.27 & -2.39 & 0.51 & +0.13 & 0.09 & 1.00121 & 0.99926 & 19977.9 & 4.052 \\ \hline noCT & 0.28 & -2.44 & 0.51 & +0.17 & 0.14 & 1.00121 & 0.99926 & 19977.9 & 4.052 \\ \hline noMD & 0.26 & -2.42 & 0.51 & -0.09 & 0.19 & 1.00121 & 0.99926 & 19977.9 & 4.053 \\ \hline Zonly & 0.18 & -2.04 & 0.52 & -0.01 & 0.08 & 1.00124 & 0.99930 & 19977.9 & 4.055 \\ \hline ZRF & 0.29 & -2.49 & 0.51 & -0.05 & 0.20 & 1.00121 & 0.99926 & 19977.9 & 4.052 \\ \hline Bmod & 0.11 & -2.08 & 0.48 & +0.03 & 0.05 & 1.00119 & 0.99916 & 19977.9 & 4.049 \\ \hline
5000s & 0.44 & -2.52 & 0.36 & -0.11 & 0.20 & 1.00159 & 0.99900 & 19983.4 & 4.108 \\ \hline \end{tabular}
\end{table}
Table 19.2 Parameter values found by reasonable alternative fits.

magnitude measured by the four outermost Hall probes in data set 'fineZ5000' compared with field models from the geometrical fit. All parameters have their best fit values except that the weld thickness in the conductor model has been varied from 1.8 to 1.9 times the average pitch. A model with the weld having the same pitch as other turns is also shown for comparison. Each model has been normalised to match the data at the \(\pm\)0.5 meter points. By inspection of this plot we estimate that our multiplier for the weld pitch should be 1.85 with uncertainty \(\pm\) 0.03. This uncertainty in the weld pitch changes the ratio of the field at the NMR probe position to the field in the bulk of the mapped volume by \(\pm\) 1.7 \(\times\)10\({}^{-4}\), therefore it changes the result of the Hall to NMR normalisation by the same amount and this feeds directly into the scale error. We combine the two scale errors together in quadrature to get an overall \(\delta\)S/S scale error of 2.1 \(\times\)10\({}^{-4}\).

The total of scale and shape errors amounts to 7.0 \(\times\)10\({}^{-4}\). Since the shape errors depend strongly on rapidity we plot it as a function of rapidity in Figure 19.2. This shows that the total sagitta error is dominated by the scale at low rapidity and by the shape at high rapidity.

The shape error at high rapidity is dominated by our uncertainty about the orientation of the mapping machine rotation axle, which is highly correlated with our fitted orientation of the solenoid coil. This appears as order 0.2 mrad changes in angles Ax and Ay between rows 1 and 4 in Table 19.2. It is possible that a future measurement of a known resonance mass versus \(\varphi\) at high rapidity will allow us to measure the orientation of the field axis relative to the ID coordinates to better than 0.2 mrad and thus reduce the part of the shape error that is due to this angle.

Figure 19.1: Field magnitude measured by the four Hall probes at 1.058 m, plotted versus z and compared with field models having various pitches for the centre weld.

## 20 Final maps for Athena

Three files are available [7] describing our results in a form suitable for use in Athena. The magnetic field service is called many times for each track fit and it must return a result very quickly. The best way to do this is with linear interpolation in cylindrical coordinates. There is not time for any more complex calculation or even for quadratic interpolation. The use of cylindrical coordinates minimises the size of the map because the slow variation of the field versus \(\varphi\) allows use of a coarse grid in the \(\varphi\) direction. We use a 3D rectangular grid with variable step size. The step size is optimised to give an r.m.s. interpolation error of no more than 1 Gauss while keeping the map size as small as possible.

As the standard field for use if the solenoid current is 7730 A we have map7730best.txt which represents the geometrical fit plus the Maxwell terms fitted to the data set 7730a. Then we have produced two alternative files that could be used for special studies of systematic effects in track momentum scale. File map7730geom.txt represents the geometrical fit to 7730a but without the Maxwell terms. File map7730data.txt represents the data set 7730a but without any use of the fit except to guide interpolation from the mapped data points to the grid points required by Athena.

All of these files will require corrections of order 0.1% in the future to take account of the toroid and JD disc effects. If we run the solenoid at some other current than 7730 A further work will be needed to create a suitable map.

## 21 Conclusion

We have mapped the solenoid field and found a function which obeys Maxwell and matches each component of the data within 5 Gauss r.m.s. There are a few residuals of up to 50 Gauss on the edges of the inner detector volume but they do not extend far enough inside to have a significant bending effect on tracks. The relative error on track sagittas due to the field uncertainty, \(\delta\)S/S, is due a common scale uncertainty of 2.1\(\times\)10\({}^{-4}\) and a shape uncertainty which varies from 0.7\(\times\)10\({}^{-4}\) in the centre to 12\(\times\)10\({}^{-4}\) at the highest rapidity.

Figure 19.2 Sagitta error versus rapidity.

**References**

**[1]** V.Carmona and D.Mergelkuhl. Adjustment of V profiles on ID rails. 10/4/2006. EDMS 720316.

**[2]** D.Grimm et al. Measurement of probes positions in Hall164. ATL-S-UR-0006. EDMS 701391 (2/2/2006)

**[3]** D.Mergelkuhl and A.Wiart. Measurement of probes positions in Atlas cavern. ATL-S-UR-0009. EDMS 751943 (4/8/2006)

**[4]** V.Carmona, D.Mergelkuhl and A.Wiart. Measurement of probes positions in Atlas cavern after magnetic tests. ATL-S-UR-0010. EDMS 766312 (11/8/2006)

**[6]** F.Bergsma. Calibration of Hall sensors in three dimensions. 13\({}^{\rm th}\) International Magnetic Measurement Workshop, Stanford, 2003.

[http://atlas.web.cern.ch/Atlas/GROUPS/MUON/magfield/mag_felix.html](http://atlas.web.cern.ch/Atlas/GROUPS/MUON/magfield/mag_felix.html)

**[7]** The raw data, partially corrected data and final field maps are available at

[http://www.hep.man.ac.uk/atlas/bfield/index.html](http://www.hep.man.ac.uk/atlas/bfield/index.html)

**[8]** J.C.Hart Atlas note in preparation.

**[9]** Roger Ruber personal communication.

**[10]** A. Yamamoto et al. ATLAS Central Solenoid Technical Design Report. CERN LHCC/97-21. ATLAS TDR-9 (1997).

**[11]** Hall probes developed by NIKHEF.

[http://www.nikhef.nl/pub/departments/ct/po/html/dcs.html](http://www.nikhef.nl/pub/departments/ct/po/html/dcs.html)

**[12]** D.Mergelkuhl and A.Wiart. ATLAS IWV and Solenoid measurement in Hall 180. 14/10/2003. ATL-S-UR-0003. EDMS 408020.

**[13]** R.J.M.Y. Ruber. Solenoid - Main Parameters. ATL-S-EN-0002. EDMS 703076.

**[14]** R.J.M.Y. Ruber. Solenoid - Cold mass movements during cool down and excitation. ATL-SC-EN-0001. EDMS 415267. 29/3/2005.