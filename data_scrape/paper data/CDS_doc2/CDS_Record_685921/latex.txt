**ATLAS Internal Note**

**INDET-NO-080**

**2 September 1994**

Progress Report on the Development of a Bipolar ASIC for

the ATLAS Transition Radiation Detector

B. Bevensee, F.M. Newcomer, R. Van Berg, H.H. Williams

University of Pennsylvania

## 1 Introduction

We have designed an Amplifier Shaper Discriminator circuit targeted at the Tektronix/Maxim SHPi high speed bipolar process. The design is optimized for the ATLAS Transition Radiation Tracker. Notable improvements over our SSC based design include:

* Selectable ion tail compensation optimized for either Xenon or more traditional \(CF_{4}\) based (_fast_) gases.
* A differentiating baseline restorer that breaks the DC signal path, reduces the susceptibility to errors in the ion tail cancellation and offers excellent recovery characteristics from large signals.
* The addition of a high level discriminator to detect transition radiation photons.

The circuit design is complete up through the second pass revisions and we have begun the layout process. While we expect some small detailed changes in the circuit over the next few weeks (perhaps some based on feedback to this note from the ATLAS collaboration), the circuit appears complete, the simulations are very promising, and the layout process is proceeding at a reasonable pace.

Additional components are being included in the layout to accomodate changes in shaping (_e.g._ wire diameter), gain, etc. Such changes would be implemented via metalization changes only and thus would be relatively inexpensive and have a processing turn around of about 8 weeks.

Because of the combined tracking and particle identification nature of the TRT, the choices made in the pulse shaping and peaking time can be critical to optimal operation of the detector. We first outline the considerations that lead to our present design and then consider the circuit blocks in detail and finally present some measurements made using a discrete implementation of some of these ideas.

## 2 Design Considerations

Timing jitter in the leading edge tracking discriminator will arise due to the widely varying pulse height for the first clusters arriving at the wire. To minimize this effect without a significant price in signal to noise a peaking time of 7.5ns for both the xenon and \(CF_{4}\) shaping was chosen for the shaper. In Figure 1 the integral of the xenon parameterized function, normalized for a 7.5ns unit charge is displayed. The figure shows that, at best, an additional 30% in signal may be achieved by going to a 13ns shaping time. Ballistic deficit due to the sharp differentiation in the tail cancellation section would severely limit the efficient use of this additional charge.

Fast shaping limits the precision of energy measurement critical for detecting transition radiation photons when the straw is unterminated. A photon conversion presents a sharp, relatively large charge deposition which travels towards both ends of the straw. With no termination, the signal going toward the far end will reflect and return to the preamp delayed from the prompt signal by as much as 6ns. Thusnearly half of the available signal could be lost with a 7.5ns shaping time reducing the dead band between charge particle depositions and transition radiation photons. Two additional integrations, preceding the high level discriminator increase the shaping time to 12ns to optimize it for position independent energy measurement.

## 3 Circuit Description

The block diagram of the ASD/BLR shown in Figure 2 indicates the main architectural features of the circuit.

The analog signal processing path (i.e. preamp through the baseline restorer but without the discriminators) is shown in Figure3.

### Dual Preamp - 3.3mW

As shown in Figure 4, we have retained the cascaded common emitter configuration used in the SDC design, increasing the DC input impedance to 275 ohms (_tunable_\(\pm\)10%). A study of signal to noise convinced us that matching the straw impedance at frequencies above 30MHz resulted in significant signal loss with shaping times of 6-8ns. Consider a straw capacitance of 10pF in addition to 10pF of connection capacitance. With a pure resistive 300 ohm input impedance, the time constant for removing charge from the detector is 6ns. By allowing the preamp input impedance to roll off to \(\approx\)100 ohms at 100MHz, significant improvement in signal collection is achieved. Our simulations indicate only minimal reflections when a one meter, unterminated straw is included.

Pileup in the preamp is unavoidable and presents a potential problem especially with the long xenon signal. To ensure plenty of head room a range of 600fC is provided.

The dual preamp design, inherited from the original ASD offers excellent DC matching and resistance to radiation effects, in addition it offers a potentially important node for common mode signal rejection.

Figure 1: Integral of the Xe charge collection function normalized for 1 fC in 7.5ns.

Figure 3: Top Level Schematic.

Figure 2: ASD/BLR Block Diagram.

**Noise** The equivalent series noise resistance of the preamp is 47ohms (ignoring input protection resistors) and the equivalent parallel noise resistance is 8.5Kohms, resulting in a noise corner of about 10ns.

The signal at the output of the preamp is single ended, has a rise time of 1.5ns and adds a 10ns tail due primarily to the 30kohm and.33 pF parallel feedback elements.

### Shaper - 11mW

The objective of the shaper is to shorten the signal from the detector, remove the preamp tail and provide the baseline restorer with a well behaved symmetric input that cuts off cleanly just above the maximum expected threshold.

Three differential pair stages provide the basic shaper framework. A 2ns time constant in the collectors of each stage provide three equivalent integrations. The first stage symmeterizes the single ended input from the preamp keeping a wide dynamic range by limiting the gain to 1.5. The second stage provides a selectable detector tail cancellation network and the third stage limits the signal magnitude to 120fC and offers a zero to match the preamp feedback network time constant, canceling the preamp tail.

#### 3.2.1 Detector Tail Cancellation

Once electronics has been installed it will still be possible to switch gasses to improve detector performance. Our understanding is that the only candidate replacement gases for this high rate experiment are the so called _fast CF4_ based gases. For this detector geometry the characteristic time constant of the gas, \(t_{0}\), is in the range of one to two nanoseconds and requires significantly different compensation. We include two, independent gas compensation networks; one for xenon based on the parameterized function for a \(50\mu m\) wire and one for a \(CF4\) based gas with a \(t_{0}\) of 1.5ns. See Figure 5. The pulse shape and magnitude at the output of the shaper is adjusted to be nearly identical for each compensation, (see

Figure 4: Preamp Schematic.

Figure 6) when the integral of the input charge is the same for the first 7ns.

#### 3.2.2 Gain Adjustment and Lockout

Given that there are two discriminator levels for each channel, and that the AC coupling provided between the BLR and the discriminators will nearly eliminate channel to channel threshold offset, thresholds will be set at the chip level. To accommodate differences in gain, either within the chip, or in the straw, eight control lines provide gain control for each channel. The most likely use for these eight lines, however, will be to disable an individual channel within the chip.

### Baseline Restorer (BLR) - 2mW

The basic schematic for the BLR is shown in Figure 7. Two, 8pF, capacitors break the DC path from the shaper and couple the signal across a series connected pair of diodes (shown as base-collector shorted transistors in the schematic). The quiescent impedance of each diode is set to 650\(\Omega\) by a standing current of 40\(\mu\)A creating a short time constant \(CR\) differentiation of the shaper signal. For millivolt level signals the pulse is bipolar with nearly equal magnitude lobes, but as the shaper signal increases in magnitude, the exponential behavior of the diode junction moderates the impedance, increasing it as the desired lobe of the signal is processed and dramatically lowering it as the capacitors are redaraged to their quiescent voltages in the second lobe of the bipolar signal. The diode impedance for the transistors used in the SHPi process is plotted in Figure 8 as a function of deviation from the quiescent operating voltage of the BLR diodes. From this plot it can be seen that impedance nearly doubles for a 15mV signal in the

Figure 5: Charge collection current function for \(CF_{4}\) and Xe with a 50\(\mu m\) anode wire.

Figure 6: Tail Cancelation Schematic.

positive direction and is nearly half for a 15mV overshoot. We expect minimum level signals to be of this magnitude.

The Figure 9 shows the expected signal at the shaper output for a 2fC and a 25fC output signal. The significant difference in overshoot can be attributed to the non linear behavior of the diode based BLR described above. Figure 10 offers significant insight into the rate capability of the ASD with BLR. The two plots in the figure show the calculated response for a 50fC (\(Fe^{55}\) magnitude) signal followed 50ns later by a 2fC (minimum threshold) signal, and a 200fC signal followed 50ns later by a 2fC signal. In each plot an additional trace shows the response for a 2fC signal followed by a second 2fC signal for reference. To the extent that the fabricated circuit reproduces this response, it is easy to believe that only a small percentage of hits would be lost due to offsets from a previous pulse 50ns or earlier.

While the BLR stage is nonlinear for low level signals, and presents an unwanted bipolar lobe, there are several significant benefits due to the \(CR\) stage it inserts with a short time constant.

1. Elimination of DC offsets due to high rate signals.
2. Significant reduction in sensitivity to the accuracy of detector tail cancellation.
3. Early recovery from hits with large charge depositions.

#### 3.3.1 Signal, Noise and Triggering Rates

Spice calculations show that the input referred equivalent noise charge, ENC is 1500e for this design with a 10pF detector capacitance. Although slightly non-linear, the noise for an input capacitance in the range of 5 to 25pF is reasonably well given by the following linear relationship: \(ENC\approx 550e+90e/pF\) The efficiency for using charge arriving at the input during the 7.5ns shaping time is calculated by comparing the impulse response for a 2fC charge at the BLR output with the BLR output for a parameterized sensor signal normalized to present an integral charge of 2fC within 7.5ns at the amplifier input. Spice based calculations show 80% efficiency when xenon tail compensation is selected and 85% when \(CF_{4}\) compensation is selected. The signal to noise ratio, considering intrinsic noise only, for a 2fC xenon signal and a 10pF detector capacitance should be approximately 7.1; For a 20pF input capacitance it reduces to 4.5.1.

From these values we can estimate the expected trigger rate for a 2fC threshold due to intrinsic amplifier noise. For a given bandwith \(BW\), the trigger rate, \(R\), for a threshold set in terms of desired signal to noise, \(s/n\), is given by the following formula (from the 1988 lecture series by V. Radeka).

\[R=BW\times e^{-1/2(s/n)^{2}}\]

Setting the bandwidth at the BLR output to 50MHz, the trigger rate for a \(s/n=7\) is less than 1Hz and for \(s/n=4.4\) the accidental rate is 3Khz.

Given these rates, we would expect the false trigger rate to be dominated by pickup, rather than intrinsic amplifier noise. Unfortunately, pickup is difficult to calculate and our major defence will have to be careful design of the electronics mounting and the chamber connections.

### Discriminators - 5.5mW

The low level discriminator used primarily for tracking will be identical to the design used for SDC, with the power scaled down from 6mW to 2.5mW to reflect the relaxed timing accuracy required for the ATLAS TRT. A complete description of this circuit may be found in Reference [1]. This time over threshold circuit will provide a sharp turn on with a minimum output width of approximately 5ns.

#### 3.4.1 Transition Radiation Comparator - 2mW

As mentioned previously efficient detection of the transition radiation photons requires an extended signal integration time. The overhead required to do this is moderated by the fact that the TR signal is more than an order of magnitude larger than the minimum signal for the tracking discriminator.

Figure 7: Base Line Restorer Schematic.

Figure 8: Diode impedance for SHPi transistors referenced to the quiescent operating point. A 5 fC input produces about a 50 mV pulse which would see an impedance of about 4,500 Ohms. The overshoot lobe is shortened noticeably for large inputs as the diode turns on.

Figure 9: Base Line Restorer Output for 2 FC and 50 FC input signals. The 50 FC signal is normalized to the 2 FC amplitude to allow easy comparison of the differences in pulse shape.

Figure 10: Base Line Restorer Output for a 50 fC input signal followed 50ns later by a 2 fC signal (a). A very large 200fC input followed 50ns later by a 2 fC signal is shown in (b). In both cases a second trace shows a 2 fC signal followed 50ns later by a second 2 fC signal for reference. As can be seen in (b) a small 2 fC pulse shows only a small offset from the reference signal 50ns after the 100 times larger input.

The schematic of the circuit is shown in Figure 11. Two _RC_ integrations approximately 2.5ns each extend the shaping time to beyond 12ns, allowing integration of both the direct and reflected TR photon signal before the signal is input to the comparator. A cascaded differential pair preamplifies the signal into the comparator and offers a low impedance input for positive hysteresis of about 2mV referred to the input. The threshold adjustment range is from \(\approx\)5fC to 120fC and the power requirement for this stage is 2mW.

#### 3.4.2 Output Drive 1mW + (on chip power diss. from output current drive)

The outputs are differential switched currents from the low level and transition radiation discriminators summed with a constant current draw for full compatability with the existing TRDS chip. These outputs may include programmability options to allow individual current control over each function.

## 4 Discrete Prototype

In order to test the basic idea of nonlinear baseline restoration and the accuracy of the Xe tail cancellation technique, a semi-discrete prototype channel was constructed using the single channel AT&T process preamplifier shaper (gaussian shaping only, \(t_{m}\sim 6ns\)) followed by a discrete implementation of the Xe tail cancellation similar to that in the integrated design. Values for tail cancellation were chosen solely from SPICE modeling calculations using the Xe parameterization provided by A. Romaniaux. The differential output of the shaping stage is connected to an AC coupled set of diode connected microwave transistors. These transistors operate at nearly the impedance levels of the integrated design scaled by a factor of four to reduce sensitivity to the discrete stray capacitances. Pulser and \(Fe^{55}\) studies were carried out at Penn on this device. Some of the results are discussed below. This device has also been tested at CERN for high rate and beam tests, but data from those tests is not yet available. Note that while some features of the integrated design can be tested in this way, the actual operating environments are very different in terms of stray capacitances, current levels, and dynamic range.

Figure 11: TR discriminator schematic.

### Pulse Shape Tests

The discrete circuit was first attached to a pulse injector and the output was observed at various amounts of input charge. As can be seen in Figure 12 the signal for small pulses is bipolar with a short time consant and for larger pulses the shape moves toward a unipolar response.

The same circuit was then attached to an ATLAS 50 cm straw and \(Fe^{55}\) signals were observed at the preamplifier, shaper and baseline restored outputs. The observed tail cancellation (Figure 13) was very nearly exact and required no tuning or changes from the SPICE optimized component values. Only a 5% overshoot is observed at the BLR output due to the large number of primaries associated with the \(Fe^{55}\) conversion.

### Trigger Rate Tests

One important question is what is the accidental hit rate contributed by the electronics to the basic physics rate (which is certainly large enough all by itself). Electronically induced accidental hits come either from the inherent electronic noise of the circuit or from external disturbances (pickup) which

Figure 12: Meaured outputs of the base line restorer for an impulse input of 1.5, 5, and 20 fC. Note that the shape following the initial peak reflects the Xe tail cancellation function operating on an impulse input. The non-linear shape changes of the overshoot with pulse height are a desired result of the BLR clamping action.

Figure 13: Meaured outputs of the preamp, shaper, and base line restorer for an \(Fe^{55}\) source applied to a 50cm ATLAS straw tube with 50\(\mu m\) anode operating at 1,600 V in the standard ATLAS Xenon mixture. The overshoot is \(\sim\) 1% at the output of the shaper. The small mismatches in the tail cancellation are largely eliminated by the BLR stage.

induce discriminator trips in the circuit. In order to obtain some level of confidence that the expression for noise related accidental hits given in Section 3.3.1 is correct, we attached the prototype circuit to a 10 pF capacitor to simulate an ATLAS straw and made measurements of the actual number of firings of a commercial discriminator and scaler attached to the BLR output of the prototype circuit.

The discriminator threshold was calibrated using a pulser and a charge injector. The quoted threshold levels are the 50% firing points for the circuit with that level of injected charge. The quoted rate is the discriminator rate _without_ the pulser firing.

\begin{tabular}{|r|r|} \hline Threshold (fC) & Rate (kHz) \\ \hline
1.5 & 111.0 \\
2.0 & 10.5 \\
2.5 & 0.1 \\ \hline \end{tabular}

In addition, we calibrated the noise behavior of this set up by measuring the \(\pm FWHM/2\) points on the trigger efficiency curve (e.g. 12% and 88% efficient) and measured a noise equivalent to about 3,000 electrons. This is much larger than the previously measured noise of the AT%T preamp in a similar configuration (\(<1,500\) electrons) and, presumably, the excess represents the necessarily limited choice of components for the discrete design and the lack of effort at optimizing the noise behavior of the discrete portions of the device. Considerable effort was expended to eliminate local pickup noise. The observed total noise width was similar to that observed in the previous measurements using the ATLAS 50cm test straw, so the shielding used was probably of similar efficacy.

It is then amusing to take the measured 3,000 electron noise figure and plug it into the expression in Section 3.3.1. One then obtains:

\begin{tabular}{|r|r|} \hline Threshold (fC) & Rate (kHz) \\ \hline
1.5 & 278.0 \\
2.0 & 8.4 \\
2.5 & 0.1 \\ \hline \end{tabular}

The agreement is comforting, (note that the relatively large discrepancy at 1.5 fC corresponds to a very small error in setting this very low threshold) but the importance of careful treatment of straw to electronics connections and local sources of radiated and conducted energy should continue to be emphasized.

## References

* [1] A Fast Low Power Amplifier Shaper Discriminator for High Rate Straw Tracking Systems, F.M. Newcomer, S. Tedja, R. Van Berg, J. Van der Spiegel, H.H. Williams, IEEE Trans. on Nucl. Science (1993), NS-40:630-636, August, 1993.