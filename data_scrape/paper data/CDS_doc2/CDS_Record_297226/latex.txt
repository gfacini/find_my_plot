**ATLAS Internal Note**

**LARG-NO-10**

**Date 1 MAR 95**

**A FAST MONOLITHIC SHAPER**

**FOR THE ATLAS E.M. CALORIMETER**

R.L Chase, C. de La Taille, J.P. Richer, N. Seguin-Moreau

_Laboratoire de l'Accelerateur Lineaire, IN2P3-CNRS et Universite Paris-Sud_

_91405 Orsay Cedex, France_

Presented by C. de La Taille at the Vth International Conference on Calorimetry

in High Energy Physics, Brookhaven National Laboratory, 23 sept - 1 oct 1994

The shaping for the ATLAS electromagnetic calorimeter is discussed and the analytical expressions for signal and noise, taking into account the preamplifier risetime, are detailed. A monolithic CR RC\({}^{2}\) shaper has been realized using Bi-CMOS technology. It provides a high gain and a low gain output to accomodate the maximum 16 bit dynamic range of the detector. The peaking time for a step input can be tuned with a 4 bit logic between 25 and 40 ns. The noise referred to the input is \(e_{n}=1.5\) nV/\(\sqrt{\rm{Hz}}\) with 100 mW power dissipation.

Introduction

The shaper, located between the preamplifier and the readout chain, optimizes the signal to noise ratio which is the quadratic sum of the electronic noise (decreasing with slower shaping) and pileup noise (increasing with slower shaping). For the ATLAS electromagnetic calorimeter [1], the high levels of pileup at high luminosity require a peaking time for the calorimeter signal around 40 ns (corresponding to \(t_{p}(\delta)\approx 20\) ns). At lower luminosity, an equivalent slower shaping is achieved by digital filtering with multiple samples [2]. A good peaking time uniformity would be an advantage to reduce the cost and complexity of the digital readout.

The shaper also provides additional amplification to bring the preamp noise into the mV range rendering the noise of the readout chain negligible. However, the very large dynamic range (16 bits) anticipated in ATLAS [1] makes this last feature unachievable. One solution is to compress the dynamic range into 10-11 bits, which matches the detector intrinsic resolution [3]. Another option is to cut the 16 bits in two times 13 bits, with two different outputs in a ratio between 8 and 16. These 13 bits match well the dynamic range of switched capacitor arrays and ADCs that could be used for the readout [1]. Due to the large number of channels (200,000) and their favoured location in a calorimeter crack, the realization of an ASIC was highly desirable.

We will now describe the requirements, design and experimental results obtained with a 4 channel monolithic circuit using AMS 1.2\(\mu\) BiCMOS technology1. The total silicon area is 6 mm2.

Footnote 1: Austria Mikro Systeme, Schloß Premsätten, A-8141 Unterpremsätten

## 2 Shaper characteristics

### Overview

Two different preamplifiers are foreseen for the ATLAS EM calorimeter [1] :

Figure 1: _Readout with cold current preamplifiers_

\(\bullet\) For the barrel calorimeter, current preamplifiers2 using Si or GaAs FETs would be located close to the electrodes, operating at LAr temperature [4, 5] (cf. Fig.1). They deliver positive output pulses, with a triangular shape similar to the detector current, but of opposite polarity. These signals are sent outside the cryostat through 50 \(\Omega\) cables, terminated at both ends.

Footnote 2: There are no real current preamps [7], as they always somewhat integrate the input current, nor are there any real charge preamps as they are never perfect integrators. Moreover, they have the same transfer function (cf. 2.2.1), the difference resides in the location of the feedback pole \(\tau_{f}=R_{f}C_{f}\) compared to the shaping time \(\tau\). When \(\tau_{f}\ll\tau\) the preamp is said to be current sensitive, whereas when \(\tau_{f}\gg\tau\) the preamp is charge sensitive.

The temperature the cable in its characteristic impedance, but are non inverting, giving a negative pulse to the shaper located nearby.

Thus, the requirements for the shaper are very different : in the first case, it must accomodate a positive signal and show a constant 50 \(\Omega\) input impedance over the whole dynamic range, whereas in the second case, it deals with a negative pulse, with no restriction on the input impedance. However, in both cases, the signal has the same shape, leading to a similar architecture, with a strong constraint for low noise design, as the shaper noise is not negligible (cf. 2.4.6). _The present availability of only NPN transistors in multiproject fabrication led us to start with the negative signal of the \(\emptyset\)T._

The architecture chosen consists of one differentiation (CR) and two integrations (RC), usually referred to as CR RC\({}^{2}\). The differentiation minimizes the pileup contribution due to the long decay (\(\sim\)400 ns) of the signal from the calorimeter. It also delivers a bipolar signal, which allows AC coupling in the following stages without baseline shift s, as the signal area is zero. The integrations filter out the high frequencies to reduce the electronic noise. It is not necessary here to have many integrations, which usually slightly improve the signal to noise ratio (cf. 2.6), as this is achieved digitally further down in the readout chain [2]. This allows minimizing the number of stages and decreases the power consumption.

Figure 2: _Readout with cable-coupled warm preamps (\(\emptyset\)T)_

### Temporal waveform

We give here analytical expressions for the waveform at the shaper output, which are useful in detailed Monte-Carlo simulations. They assume a current preamplifier with a finite risetime, followed by a CR RC2

Footnote 2: A more accurate formula would be :

\[H_{p\,a}(s)=\frac{-R_{f}}{R_{f}\,C_{d}\,s^{2}/\omega_{c}+R_{f}\,C_{f}\,s+1} \tag{1}\]

 in which \(\omega_{c}\) is the unity gain frequency of the preamplifier. The stability of this second order system requires the 2 poles to be sufficiently separated, the quality factor being : \[Q=\frac{1}{C_{f}}\sqrt{\frac{C_{d}}{\omega_{c}\,R_{f}}}\] (2)

 Usually, \(R_{f}\) is determined by the maximum signal, and \(C_{f}\) is added to ensure stability for a given detector capacitance \(C_{d}\) (\(Q<0.5\)). The price paid for this deviation from the ideal current preamp (\(C_{f}=0\)) is an increase of the shaper noise contribution (cf. 2.4.6). This problem is alleviated by the use of a fast technology such as GaAs (\(F_{e}=4\) GHz) which allows smaller \(C_{f}\).

The formulais similar for the \(\emptyset\)T [6], except that the two poles are always real, giving unconditionnal stability.

The transfer function for a CR RC2 shaper is given by :

Footnote 2: \(i.e.\) for a 1 V sinusoidal input of frequency \(f_{c}\), the output amplitude is 0.385 V and the phase \(-15.8^{\circ}\)

\[H_{sh}(s)=\frac{\tau s}{(1+\tau s)^{3}} \tag{5}\]

where \(\tau\) is the shaper time constant (\(\tau=RC\)), chosen to minimize the total noise (electronic and pileup) (cf. 2.5) ; it is typically around 15 ns at a luminosity \(\mathcal{L}=10^{34}\) cm\({}^{2}\)s\({}^{-1}\). The shaper can be seen as a bandpass filter, the central frequency of which is located at

\[f_{c}=\frac{1}{2\pi\,\sqrt{2}\,\tau} \tag{6}\]

At this frequency4, the gain is \(|H_{sh}(\omega_{c})|=0.385\).

Footnote 4: \(i.e.\) for a 1 V sinusoidal input of frequency \(f_{c}\), the output amplitude is 0.385 V and the phase \(-15.8^{\circ}\)

#### 2.2.2 Impulse response

From the transfer functions, we can calculate the response of the overall chain to a current impulse \(Q_{0}\delta(t)\), by taking the inverse Laplace transform of Eq.(3) and (5) :

\[V_{\delta}(t) =\mathcal{L}^{-1}[Q_{0}\,\times H_{pa}(s)\times H_{sh}(s)] \tag{7}\] \[=\frac{Q_{0}\,R_{f}}{\tau}h_{\delta}(t)\]

in which \(h_{\delta}(t)\) is dimensionless :

\[h_{\delta}(x)=\left[\frac{x^{2}}{2}+\frac{x}{\lambda-1}+\frac{\lambda}{( \lambda-1)^{2}}\right]\frac{e^{-x}}{\lambda-1}-\frac{\lambda\,e^{-x}/\lambda} {(\lambda-1)^{3}} \tag{8}\]

with \(x=t/\tau\) and \(\lambda=\tau_{pa}/\tau\).

The waveform is shown in Fig. 4 with \(\lambda=1\).

The maximum amplitude \(h_{m\,ax}(\delta)\) and its position \(x_{m\,ax}(\delta)=t_{m\,ax}/\tau\), are a function of \(\lambda\) only. They are calculated numerically and given in Table 1. We also compute the peaking time \(t_{p}(\delta)\) between 5% and the peak, used in noise calculations (cf. 2.4.2). The value for \(\lambda\to 0\) gives the impulse response of the shaper alone.

#### 2.2.3 Step response

The response to a current step \(I_{0}\) at the input can be obtained by integrating the impulse response or by taking the inverse Laplace transform with an input current \(I_{\mathrm{f}}(s)=I_{0}/s\). It gives :

\[V_{\mathrm{f}}(t)=R_{f}\,I_{0}\,h_{\mathrm{f}}(t) \tag{9}\]

in which \(h_{\mathrm{f}}(t)\) is dimensionless :

\[h_{\mathrm{f}}(x)=\frac{\lambda^{2}\,e^{-x/\lambda}}{(\lambda-1)^{3}}-\left[ \frac{x^{2}}{2}+\frac{\lambda\,x}{\lambda-1}+\frac{\lambda^{2}}{(\lambda-1)^{ 2}}\right]\frac{e^{-x}}{\lambda-1} \tag{10}\]

with \(x=t/\tau\) and \(\lambda=\tau_{pa}/\tau\).

Similarly, the maximum \(h_{m\,ax}(\dagger)\), its position \(t_{m\,ax}(\dagger)\) and the peaking time \(t_{p}(\dagger)\) between 5% and the peak are calculated numerically and given in Table 1. It can be noted that \(t_{p}(\dagger)\) is quite different from the usually stated value of \(2t_{p}(\delta)\).

#### 2.2.4 Triangle response

The response to the triangular detector current \(i_{\Delta}\) can also be calculated :

\[i_{\Delta}(t)=I_{0}\Bigl{(}1-\frac{t}{t_{\,dr}}\Bigr{)}\qquad t<t_{\,dr} \tag{11}\]

where \(I_{0}\approx 2.5\,\mu\)A/GeV5 and \(t_{\,dr}\approx\)400 ns for ATLAS with LAr [1, 11].

In the frequency domain,

Footnote 5: assuming the geometry described in Ref. [1], with a sampling fraction \(\eta_{s}=0.23\), a suppression factor for electromagnetic showers \(\epsilon/\mu=0.7\) and a pair creation energy \(W_{i}=25\,\)eV.

With LKr, \(I_{0}\approx 4.2\,\mu\)A/GeV and \(t_{\,dr}\approx 550\) ns, assuming \(\eta_{s}=0.4,\epsilon/\mu=0.8\) and \(W_{i}=19\,\)eV [9].

\[I_{\Delta}(s)=I_{0}\Biggl{(}\frac{1}{s}-\frac{1-e^{-st_{\,dr}}}{s^{2}t_{\,dr} }\Biggr{)}\]

Taking the inverse Laplace transform of Eq.(12), (3) and (5) yields :

\[V_{\Delta}(\,x)=\begin{cases}R_{\,f}I_{0}\left[h_{1}(x)-\frac{1}{x_{\,dr}}h_{ 2}(x)\right]&\text{if }x\leqslant x_{\,dr}\\ R_{\,f}I_{0}\left[h_{1}(x)-\frac{1}{x_{\,dr}}(h_{2}(x)-h_{2}(x-x_{\,dr})) \right]&\text{if }x\geqslant x_{\,dr}\end{cases} \tag{13}\]

in which \(x=t/\tau\), \(x_{\,dr}=t_{\,dr}/\tau\), \(\lambda=\tau_{\,ps}/\tau\) and

\[h_{1}(x) =\frac{\lambda^{2}e^{-x/\lambda}}{(\lambda-1)^{3}}-\left[\frac{x ^{2}}{2}+\frac{\lambda\,x}{\lambda-1}+\frac{\lambda^{2}}{(\lambda-1)^{2}} \right]\frac{e^{-x}}{\lambda-1} \tag{15}\] \[h_{2}(x) =1-\frac{\lambda^{3}e^{-x/\lambda}}{(\lambda-1)^{3}}+\left[ \frac{x^{2}}{2}+\frac{2\lambda-1}{\lambda-1}\,x+\frac{3\lambda^{2}-3\lambda+1 }{(\lambda-1)^{2}}\right]\frac{e^{-x}}{\lambda-1} \tag{14}\]

The waveform is shown in Fig.3 for various values of \(\lambda\). When \(\tau\ll t_{\,dr}\), \(x_{\,dr}\rightarrow\infty\) and \(V_{\Delta}\) tends to the step response given by Eq.(9) :

\[V_{\Delta}(t)\to V_{\!r}(t)=R_{\,f}I_{0}h_{\,r}(t) \tag{16}\]

#### 2.2.5 Effective integration time

The effective integration time \(t_{m}\) is defined as the charge that is taken into account until the triangle response reaches its peak6

Footnote 6: If the triangle can be approximated by a step, it corresponds to the definition of Ref. [8]

\[t_{m}(\uparrow)=\int_{0}^{t_{z}z}\frac{h_{\delta}(t)}{h_{max}(\delta)}\,dt \tag{17}\]

in which \(t_{z}z(\delta)\) is the zero-crossing of the impulse response.

\[t_{m}(\Delta)=\tau\frac{V_{m\,ax}(\Delta)}{V_{m\,ax}(\delta)} \tag{18}\]

If the impulse response were perfectly symmetric, \(t_{m}\) would be proportionnal to the peaking time \(t_{p}(\delta)\). In reality, the peaking time to the step is a much better representative, when the triangle is close to a step. It can be shown by using Eq.(18) and Table 1 that :

\[t_{m}(\uparrow)=(0.66\pm 0.02)\,t_{p}(\uparrow) \tag{19}\]

The effective integration time is useful to convert the noise in charge units (ENC) into noise in energy units (cf. 2.4.2 and 2.4.4).

Figure 3: _Response to the triangle for various preamplifier risetimes_, _as given by Eq.(13). Calculations made with \(\tau\) = 15 ns_, \(t_{\vartheta}\) = 400 ns and \(\lambda\) = 0, 0.5, 1, 1.5 and 2._

### Simplified expressions

The above expressions can be simplified in practice by considering that the pole in the preamp is very close7 to the poles used in the shaper, _i.e._\(\lambda\approx 1\).

Footnote 7: This results from a stability requirement in the preamp (see footnote 3) that leads to \(\tau_{pa}\approx 15\) ns and noise minimization which requires \(t_{p}(\uparrow)=4\,0\) ns (cf. 2.5). The price paid for not using an infinitely fast preamp is an increase of the shaper noise contribution due to ballistic deficit (cf. 2.4.6).

In that case, the **impulse response** is simply :

\[V_{\delta}(x)=\frac{R_{f}Q_{0}}{\tau}\,\frac{3x^{2}-x^{3}}{6}e^{-x} \tag{20}\]

From table 1, the maximum amplitude is \(V_{m\,ax}(\delta)=0.1\,306\,R_{f}Q_{0}/\tau\) at \(t_{m\,ax}(\delta)=1.268\,\tau\). The peaking time 5-100% is \(t_{p}(\delta)=1.144\,\tau\).

The **step response** is :

\[V_{\tau}(x)=\,R_{f}I_{0}\,\frac{x^{3}}{6}e^{-x} \tag{21}\]

Similarly, \(V_{m\,ax}(\uparrow)=0.224\,R_{f}I_{0}\) at \(t_{m\,ax}(\uparrow)=2\,\tau\) and \(t_{p}(\uparrow)=2.523\,\tau\).

The **response to the triangle** is :

\[V_{\Delta}(x) =\frac{R_{f}I_{0}}{x_{dr}}\left[\left(x_{dr}\frac{x^{3}}{6}+\frac {x^{3}}{6}+\frac{x^{2}}{2}+x+1\right)e^{-x}-1\right] x\leqslant\,x_{dr} \tag{23}\] \[V_{\Delta}(x) =\frac{R_{f}I_{0}}{x_{dr}}\left[x_{dr}\frac{x^{3}}{6}+\sum_{k=0}^ {3}\frac{x^{k}-\left(x-x_{dr}\right){}^{k}e^{x_{dr}}}{k!}\right]e^{-x} x\geqslant\,x_{dr} \tag{22}\]

Its peak is located exactly at :

\[x_{m\,ax}(\Delta)=\frac{3x_{dr}}{x_{dr}+1} \tag{24}\]

Also interesting is the **response to the exponential** used by the calibration to simulate the triangle :

\[V_{exp}(x)=\left[\frac{x^{3}}{6}+\frac{1}{x_{d}-1}\frac{x^{2}}{2}+\frac{x_{d} }{(x_{d}-1)^{2}}x+\frac{x_{d}^{2}}{(x_{d}-1)^{3}}\right]\frac{x_{d}\,e^{-x}}{x _{d}-1}-\frac{x_{d}^{3}\,e^{-x/x_{d}}}{(x_{d}-1)^{4}} \tag{25}\]

in which \(x_{d}=\tau_{d}/\tau\) and \(\tau_{d}\) is the decay time constant of the exponential, set equal to \(t_{dr}\) in the calibration in order to obtain the same falling slope as with the triangle [10].

Figure 4: _Normalized response to an impulse (dashed line), a step (dotted line), a triangle (solid line) and the calibration decaying exponential (dot-dashed line) with the simplified formulae. The values taken are \(t_{{}_{dr}}\) = 400 ns and \(\tau_{{}_{pa}}=\tau\) = 16 ns, corresponding to \(t_{{}_{p}}(\delta)=18\) ns and \(t_{{}_{p}}(\Delta)\approx t_{{}_{p}}(\uparrow)=40\) ns._

### Noise

The electronic noise is an important contributor to the energy resolution at low energy8

Footnote 8: The energy resolution of the calorimeter is usually parametrized as :

\[\frac{\sigma(E)}{E}=\frac{a}{\sqrt{E}}\oplus\frac{b}{E}\oplus c \tag{26}\]

Using figures for the ATLAS electromagnetic calorimeter[1], E is the energy in GeV, \(a\approx 10\%\) is the sampling term due to statistical fluctuations in the energy deposited in the liquid argon, \(b\approx 420\) MeV (in a 3x7) comes from the electronic and pileup noise (cf. 2.5) and \(c\approx 0.7\%\) is the constant term due to non uniformities in the mechanics and the calibration. With LKr, \(a\approx 6\%\) and \(b\approx 370\) MeV (28)

The experiment (28) is not valid in the case of \(\emptyset\)T preamps, as the series noise is not differentiated by the detector capacitance, because of the cable coupling. In that case, there is no difference between series and parallel noise and

\[V_{n}^{2}\approx(e_{n}^{2}/R_{0}^{2}+i_{n}^{2})\,R_{f}^{2}\,J_{6}^{2}\,( \lambda)/\tau\]

which is independent of \(C_{d}\)[6]. The signal, however, is affected by \(C_{d}\) as the pole \(R_{0}C_{d}\) creates ballistic deficit, which degrades the signal to noise ratio.

the whole frequency spectrum :

\[V_{n}^{\,2} = \frac{e_{n}^{2}C_{\,d}^{\,2}R_{f}^{2}}{\tau^{3}}\,\int_{0}^{\infty} \frac{(\omega\tau)^{4}}{(1+\omega^{2}\tau_{\,ps}^{2})(1+\omega^{2}\tau^{2})^{3}} \frac{d(\omega\tau)}{2\pi}\] \[+\,\frac{i_{n}^{\,2}R_{f}^{2}}{\tau}\,\int_{0}^{\infty}\frac{( \omega\tau)^{2}}{(1+\omega^{2}\tau_{\,ps}^{2})(1+\omega^{2}\tau^{2})^{3}} \frac{d(\omega\tau)}{2\pi}\]

in which the two integrals are a function of \(\lambda\) only ; they are referred to as \(J_{a}^{\,2}(\lambda)\) and \(J_{b}^{\,2}(\lambda)\), series and parallel noise integrals10

Footnote 10: The two noise integrals can also be calculated in the time domain, using Parsevals’ theorem :

\[J_{a}^{\,2}=\frac{1}{2}\,\int_{0}^{\infty}\frac{1}{h_{max}^{\,2}(\delta)}\left( \frac{dh_{b}}{dx}\right)^{2}\,dx\qquad\qquad J_{b}^{\,2}=\frac{1}{2}\,\int_{0 }^{\infty}\,\frac{h_{b}^{\,2}(\,x)}{h_{max}^{\,2}(\delta)}\,dx \tag{30}\]

 in which the two integrals are a function of \(\lambda\) only ; they are referred to as \(J_{a}^{\,2}(\lambda)\) and \(J_{b}^{\,2}(\lambda)\), series and parallel noise integrals11

Footnote 11: The 1/f noise is modeled by letting \(e_{n}^{2}=e_{n}^{2}W+A^{\,2}/f\) in which \(e_{n}W\) is the usual white noise of the input transistor [11] and the 1/f noise is characterized by its corner frequency at which both terms are equal : \(f_{c}=A^{\,2}/e_{n}^{2}W\). Replacing in Eq.(28) gives a third term :

\[V_{n}^{\,2}=\frac{2\pi A^{\,2}C_{\,d}^{\,2}R_{f}^{\,2}}{\tau^{2}}\,\int_{0}^{ \infty}\frac{(\omega\tau)^{3}}{(1+\omega^{2}\tau_{\,ps}^{2})(1+\omega^{2}\tau ^{2})^{3}}\frac{d(\omega\tau)}{2\pi} \tag{31}\]

 as it is not filtered by the preamp pole. It is estimated referred to the input in 2.4.6.

#### 2.4.2 Equivalent noise charge (ENC)

The electronic noise is traditionnaly referred to the input in terms of equivalent noise charge, defined as the charge (current impulse) on the input that would give the same _rms_ noise. It is usually specified in units of \(e^{-}\)_rms_.

\[ENC = Q_{0}V_{n}/V_{max}(\delta)\] \[= e_{n}C_{\,d}\,\frac{J_{a}(\lambda)}{h_{m\,ax}(\delta)(\lambda) \,\sqrt{\tau}}\,\oplus\,\,i_{n}\,\frac{J_{b}(\lambda)\,\sqrt{\tau}}{h_{m\,ax}( \delta)(\lambda)}\]

Unfortunately, as can be seen in Table 2 and Fig. 5, \(J_{a}(\lambda)\) and \(h_{m\,ax}(\delta)(\lambda)\) are widely varying functions of \(\lambda\). However, the ratio is roughly proportionnal to the peaking time 5-100% : \(t_{p}(\delta)\). Thus, \(ENC\) can be rewritten :

\[ENC=e_{n}C_{\,d}\,\frac{A_{s}}{\sqrt{t_{p}(\delta)}}\oplus\,i_{n}\,A_{p}\, \sqrt{t_{p}(\delta)} \tag{33}\]in which \(A_{s}\) and \(A_{p}\) are listed in Table 2 and plotted in Fig.5. It can be seen that \(A_{s}\) is constant within \(\pm 3\%\) whereas \(A_{p}\) is less invariant, especially for \(0<\lambda<0.5\). This shows that the peaking time to the impulse \(t_{p}(\delta)\) is a good variable to specify the series noise, but not as good for the parallel noise.

_For example :_ assuming GaAs preamps with \(e_{n}=0.3\) nV/Hz, \(C_{d}=500\) pF (including 100 pF for the preamp input capacitance12), \(i_{n}=3\) pA/Hz and \(t_{p}(\delta)=20\) ns in Eq.(33) yields \(ENC=6630\oplus 2380=7050\,e^{-}\,rms\).

Footnote 12: The series noise is minimized for a given power dissipation by matching the input transistor capacitance to one third of the detector capacitance [11]

#### 2.4.3 Equivalent noise current (ENI)

With current sensitive electronics, it is natural to refer the noise to the input in terms of Equivalent Noise Current (ENI) which is the current step amplitude on the input that would give the same _rms_ noise. It has the units of _A rms_.

\[ENI = I_{0}V_{n}/V_{m\,ax}(\mbox{\fiverm\,})\] \[= e_{n}C_{d}\,\frac{J_{a}(\lambda)}{h_{m\,ax}(\mbox{\fiverm\,})( \lambda)\,\tau^{3/2}}\oplus\,i_{n}\,\frac{J_{b}(\lambda)}{h_{m\,ax}(\mbox{ \fiverm\,})(\lambda)\,\sqrt{\tau}} \tag{34}\]

As in the ENC case, \(J_{a}(\lambda)\) and \(h_{m\,ax}(\mbox{\fiverm\,})(\lambda)\) are also widely varying functions of \(\lambda\), but again, the ratio scales roughly with the peaking time \(t_{p}(\mbox{\fiverm\,})\). Thus, _ENI_ can be rewritten :

\[ENI=e_{n}C_{d}\,\frac{B_{s}}{t_{p}(\mbox{\fiverm\,})^{3/2}}\oplus\,i_{n}\, \frac{B_{p}}{\sqrt{t_{p}(\mbox{\fiverm\,})}} \tag{35}\]in which \(B_{s}\) and \(B_{p}\) are listed in table 2 and plotted in Fig.6. It can be seen that \(B_{p}\) is constant within \(\pm 2\%\) whereas \(B_{s}\) is much less invariant, especially for \(0<\lambda<0.5\). Thus, the peaking time to the step \(t_{p}(\uparrow)\) is a good variable for the parallel noise, but not so good for the series noise, which is usually dominating13.

Footnote 13: A better estimation for the series ENI can be found by using the invariance of ENC with \(t_{p}(\delta)\) and converting with the effective integration time \(t_{m}\) through : \(ENI=ENC/l_{m}\). Using Eq.(32) and (19), it follows that :

\[ENI_{s}=e_{n}\,C_{d}\,\frac{A_{s}}{t_{m}\,\sqrt{t_{p}(\delta)}}=e_{n}\,C_{d}\, \frac{B_{s}^{\prime}}{t_{p}(\uparrow)\,\sqrt{t_{p}(\delta)}} \tag{36}\]

 in which \(B_{s}^{\prime}=0.67\pm 0.03\) varies rather little.

_For example :_ Si preamps used in RD3 [4, 12] had \(e_{n}=0.6\) nV/VHz, \(C_{d}=600\) pF, \(i_{n}=3\) pA/VHz and \(t_{p}(\uparrow)=35\) n s. Eq.(35) leads to : \(ENI=126\oplus 13=126\) nA \(rms\).

#### 2.4.4 Equivalent noise energy (ENE)

The equivalent noise charge or current are interesting quantities (especially to evaluate the noise generators), but for the physics what counts is the electronic noise contribution into the energy resolution \(\sigma_{el}\). This is obtained by referring the _rms_ noise to the energy deposited in the calorimeter. It is related to the triangle response \(V_{\Delta}(t)\) through Eq.(11) and has energy units (MeV). It follows that :

\[ENE=\sigma_{el}=E_{0}V_{n}/V_{m\,ax}(\Delta) \tag{37}\]

which is a more complex function of both \(\lambda\) and \(x_{dr}\). However, at the high luminosity anticipated at LHC, \(\tau\ll t_{dr}\) and \(x_{dr}\rightarrow\infty\) to the first order. Therefore, \(V_{\Delta}(t)\to V_{\rm f}(t)\)

[MISSING_PAGE_FAIL:14]

The corresponding values are listed in table 2. It can be seen that \(I_{pu}^{2}\) varies strongly with \(\lambda\) which is not surprising as the signal is considerably stretched. \(I_{pu}^{2}/t_{p}(\delta)\) is not much better as can be seen from Fig.7, which leads to favour the specification of the peaking time to the triangle (or to the step) rather than to the impulse. In effect, \(I_{pu}^{2}/t_{p}(\dagger^{\prime})\) is a better invariant, although not completely satisfactory15, the best variable being the full width at half maximum (FWHM), as shown in Fig.7.

Footnote 15: This is due to the fact that with a CR RC\({}^{2}\) shaper, the signal is not very symmetrical.

_For example_, assuming the shaping foreseen in ATLAS (cf. 2.5) \(\tau=16\) ns and \(\lambda=1\), and using Table 2 leads to a pileup integral : \(I_{pu}^{2}=50\) ns. This corresponds to 2 bunch crossings, showing that with this shaping, the pileup is \(\sqrt{2}\) worse than with an infinitely fast detector and shaping. A more accurate calculation [13], using the exact response to the triangle given by Eq.(13), yields \(I_{pu}^{2}=54.5\) ns, showing that the undershoot due to the triangle increases the pileup integral by less than 10%.

Figure 7: _Pileup integral for a step current inlo a preamplifier followed by a CR RC\({}^{2}\) shaper. Solid line: \(I_{pu}^{2}\) as defined by Eq.(40), dotted line: \(I_{pu}^{2}/t_{p}(\delta)\), dashed line: \(I_{pu}^{2}/t_{p}(\dagger^{\prime})\), last line: \(I_{pu}^{2}/FWHM\). It shows that \(t_{p}(\delta)\) is not a good indicator of the pileup integral ; \(t_{p}(\dagger^{\prime})\) is better and FWHM is the best (within 0.5%)._

The first integral is calculated with Monte-Carlo simulations [13]. In ATLAS, there is an average of 18 minimum bias events per bunch-crossing16 at the maximum luminosity of \({\cal L}=10^{34}\) cm\({}^{2}\)s\({}^{-1}\), which give without shaping \(\sigma_{E}\approx 220\) MeV at \(\eta=0\) rapidity in \(\Delta\eta\times\Delta\phi=0.075\times 0.175\), canonic \(3\times 7\) cluster size. Using Eq.(38) with the shaping time described above, leads to a pileup noise with shaping : \(\sigma_{pu}=31\,5\) MeV.

Footnote 16: The number of minimum bias events follows a Poisson distribution, with a mean value : \(\nu=T_{c}\,{\cal L}\,\sigma\) in which \(T_{c}=25\) ns is the bunch crossing interval, \({\cal L}=10^{34}\) cm\({}^{2}\)s\({}^{-1}\) is the luminosity and \(\sigma=70\) mb is the inelastic cross section of p-p interactions at \(\sqrt{s}\)=14 TeV.

#### 2.4.6 Shaper noise contribution

The shaper noise \(e_{sh}\) can be referred to the preamp input by dividing by the preamp transfer function \(H_{pa}(s)\) given by Eq.(3). It gives two terms : one which behaves like series noise and one like parallel noise17 :

Footnote 17: The frequency independent term is similar to parallel noise, whereas the term scaling as \(\omega^{2}\) is similar to series noise (cf. Eq.(27))

\[i_{n}^{2}=\frac{e_{sh}^{2}}{R_{f}^{2}}\qquad e_{n}^{2}=\frac{\tau_{ps}^{2}}{R_ {f}^{2}C_{d}^{2}}e_{sh}^{2} \tag{41}\]

When \(\tau_{pa}\ll\tau\), the preamp acts as an ideal current preamp and the shaper noise behaves like a parallel noise. When \(\tau_{pa}\gg\tau\), the preamp acts as an ideal charge preamp and the shaper noise looks like series noise, referred to the input with the classical noise gain \(C_{d}/C_{f}\) (assuming \(\tau_{pa}=R_{f}C_{f}\)).

_For example_ : on the prototype tested in RD3 with monolithic GaAs preamps, typical values were \(C_{d}=500\) pF, \(R_{f}=1.5\) k\(\Omega\) and \(C_{f}=12\) pF. Assuming a noise \(e_{sh}\) = 2 nV/\(\sqrt{\rm Hz}\) for the shaper and an attenuation of 6 dB (=0.5) between the preamp and the shaper due to the cable termination at both ends, the shaper noise can be referred to the preamp input as : \(e_{n}\) = 0.1 nV/\(\sqrt{\rm Hz}\)**and**\(i_{n}\) = 2.7 pA/\(\sqrt{\rm Hz}\). It has to be compared to \(e_{pa}=0.25\) nV/\(\sqrt{\rm Hz}\) for the best GaAs preamps and \(i_{n}=3\) pA/\(\sqrt{\rm Hz}\) for the parallel noise (_cf. supra_).

### Optimum shaping

From Eq.(34) and (40), the total noise at the shaper output can be written :

\[\sigma^{2}=\frac{A^{2}}{\tau^{3}}+\frac{B^{\,2}}{\tau}+\,C^{\,2}\,\tau \tag{42}\]

in which the first two terms represent the series and parallel noise and the third, the pileup noise. _It should be emphasized that when the preamplifier is not ideal (\(\tau_{pa}\neq 0\)), the coefficients \(A\), \(B\) and \(C\) are not independent of \(\tau\), as they vary with \(\lambda=\tau_{pa}/\tau\)_. One simplification occurs if the pole in the preamplifier \(\tau_{pa}\) is set equal to the shaper time constant \(\tau\) (see footnote 6), which is roughly the case in ATLAS around the optimum shaping (cf. 2.2.1), but not elsewhere. Another possibility is to use the peaking time to the triangle (or to the step) as a good global variable to evaluate the electronic and pileup noise, taking into account the effect of \(\tau_{pa}\).

Figure 8: _Total noise in a 3 x 7 tower of the EM calorimeter, as a function of the overall peaking time (5-100%) to the triangle : \(t_{{}_{p}}\left(\Delta\right)\) (details in footnote 14 ; the parallel noise has been doubled for clarity ; pileup from [13]). The optimum is \(\sigma_{\mbox{\tiny opt}}\) = 420 MeV at \(t_{\mbox{\tiny opt}}(\Delta)\) = 47 ns with LAr compared to 370 MeV at 36 ns for LKr._

Using Eq.(35) and (40) and approximating the triangle by a step \((t_{\,dr}\gg t_{p}(\Delta))\), the total noise can be expressed as :

\[\sigma=\frac{A^{\prime}}{t_{p}(\Delta)^{3/2}}\oplus\frac{B^{\prime}}{\sqrt{t_{p}( \Delta)}}\oplus C^{\prime}\sqrt{t_{p}(\Delta)} \tag{43}\]

in which A', B' and C' are fairly constant.

_For example_, using figures for ATLAS18 with liquid argon, A'= 65 000 MeV.n s\({}^{-3/2}\), B'= 350 MeV.n s\({}^{-1/2}\) and C'= 50 MeV.n s\({}^{-1/2}\). With liquid krypton19

Footnote 18: Calculated for the barrel at \(\eta=0\), filled with LAr giving 2.5 \(\mu\)A/GeV for electrons. Assuming a 3 \(\times\) 7 tower with 3 compartments in depth : Front, Middle and Back plus a presampler, as described in [1]. Linear readout with GaAs preamplifiers having \(e_{n}=0.33\) nV/Hz and \(C_{pa}\approx 100\) pF input capacitance plus \(C_{str\,ap}\approx 50\) pF stray capacitance on the motherboard holding the preamps. Feedback network is adjusted [14] for each compartment in order to cope with the maximum current and stability is assured by letting \(R_{f}C_{f}\approx 15\) ns. The shaper time constant is set \(\tau=16\) ns, leading to \(t_{p}(\tau)=40\) ns, its noise is taken \(e_{sh}=4\) nV/Hz to include the 6 dB attenuation due to the cable termination at both ends. The shaper noise is added to \(e_{n}\) and \(i_{n}\) with Eq.(41). Using Eq.(35) with \(t_{p}(\Delta)=40\) ns and \(\lambda=1\) yields : \(EN\,l=2.8\,10^{11}\,e_{n}C_{d}\oplus 44\,30\,i_{n}\)

\(\bullet\) Front : 48 cells with \(C_{det}=150\) pF, \(R_{f}=4\) k\(\Omega\), \(C_{f}=4\) pF.

 This gives \(C_{d}=300\) pF, \(e_{n}=0.33\oplus 0.05=0.334\) nV/Hz and \(i_{n}=1.5\oplus 1=1.8\) pA/Hz.

\(EN\,l=28\oplus 8=29\) nA \(rms\Rightarrow ENE=12\) MeV.

\(\bullet\) Middle : 21 cells with \(C_{det}=900\) pF, \(R_{f}=1\) k\(\Omega\), \(C_{f}=15\) pF.

 This gives \(C_{d}=1050\) pF, \(e_{n}=0.33\oplus 0.06=0.335\) nV/Hz and \(i_{n}=3\oplus 4=5\) pA/Hz.

\(EN\,l=98.5\oplus 22=101\) nA \(rms\Rightarrow ENE=40\) MeV.

\(\bullet\) Back : 12 cells with \(C_{det}=1100\) pF, \(R_{f}=1\) k\(\Omega\), \(C_{f}=15\) pF.

 This gives \(C_{d}=1250\) pF, \(e_{n}=0.33\oplus 0.05=0.333\) nV/Hz and \(i_{n}=3\oplus 4=5\) pA/Hz.

\(EN\,l=116.5\oplus 22=119\) nA \(rms\Rightarrow ENE=48\) MeV.

\(\bullet\) Presampler : \(C_{det}=40\) pF.

 The contribution from the presampler is neglected here as the noise is small and only a few cells are taken into account for energy measurements (the shower is very narrow at the beginning).

\(\bullet\) Total series noise \((t_{p}(\Delta)=40\) ns) : \(ENE_{s}=\sqrt{48\times 11.2\oplus\sqrt{21}\times 39.4\oplus\sqrt{12}\times 4 6.6=255\) MeV

\(\bullet\) Total parallel noise \((t_{p}(\Delta)=40\) ns) : \(ENE_{p}=\sqrt{48\times 3.2\oplus\sqrt{21}\times 8.8\oplus\sqrt{12}\times 8.8=55\) MeV

\(\bullet\)The fact that the optimum shaping time changes with the luminosity is dealt with by hardwiring the shaping for the highest luminosity, and slowing20 the signal down by combining digitally several samples of the waveform at lower luminosity [2].

Footnote 20: Although the reverse operation is possible (accelerating digitally), it is quickly penalized by post-shaper and quantization noise, as subtractions must be performed

### Higher order shapers : CR RC\({}^{n}\)

It is well known that the signal to noise ratio is improved by increasing the number of integrations in the shaper using a CR RC\({}^{n}\) structure. Its transfer function is given by :

\[H_{sh}(s)=\frac{\tau s}{(1+\tau s)^{n+1}} \tag{46}\]

The central frequency (cf. 2.2.1) is \(f_{c}=1/2\pi\sqrt{n}\;\tau\).

Similar calculations can be performed on signal and noise, assuming an ideal current preamplifier (\(\lambda=0\)). Notations similar to those in 2.2.

**Impulse and step response :**

\[h_{\delta}(x)=\frac{(\,n-x)x^{n}}{n!}e^{-x}\qquad h_{\tau}(x)=\frac{x^{n}}{n!} e^{-x} \tag{47}\]

which respectively peak at \(x_{m\,ax}(\delta)=n-\sqrt{n}\) and \(x_{m\,ax}(^{\dagger})=n\)

**Triangle response :**

\[V_{\Delta}(x) = \frac{R_{f}I_{0}}{x_{dr}}\left[\left(x_{dr}\frac{x^{n}}{n!}+\sum \limits_{k=0}^{n}\frac{x^{k}}{k!}\right)e^{-x}-1\right]\qquad\qquad\qquad x \leqslant\,x_{dr} \tag{48}\] \[V_{\Delta}(x) = \frac{R_{f}I_{0}}{x_{dr}}\left[x_{dr}\frac{x^{n}}{n!}+\sum\limits _{k=0}^{n}\frac{x^{k}-(x-x_{dr})^{k}e^{x_{dr}}}{k!}\right]e^{-x}\qquad x \geqslant\,x_{dr} \tag{49}\]

for which the peak is located exactly at :

\[x_{m\,ax}(\Delta)=\frac{nx_{dr}}{1+x_{dr}} \tag{50}\]

**Noise integrals :**

\[J_{a}^{2}=\int_{0}^{\infty}\frac{(\omega\tau)^{4}}{(1+\omega^{2}\tau^{2})^{n+ 1}}\,\frac{d(\omega\tau)}{2\pi}\quad=\frac{3}{4}\frac{(2n-5)!!}{2n!!} \tag{51}\]

\[J_{b}^{2}=\int_{0}^{\infty}\frac{(\omega\tau)^{2}}{(1+\omega^{2}\tau^{2})^{n+ 1}}\,\frac{d(\omega\tau)}{2\pi}\quad=\frac{1}{4}\frac{(2n-3)!!}{2n!!} \tag{52}\]

in which \(n!!=n\cdot(\,n-2)\cdot(\,n-4)\cdots\) and \(0!!=1\).

The results are summarized in Tables 3 and 4. The noise coefficients, as defined in Eq.(32) and (34) are plotted in Fig. 9. They show clearly that the peaking time \(t_{p}\) 5-100% is a better invariant21 (although not perfect) than \(t_{max}\) 0-100%.

Footnote 21: This is due to the fact that with high order shapers, there is a kind of delay before the output signal actually rises. During this period, there is no contribution to the signal nor to the noise, so that the peak position \(t_{max}\) does not represent the actual bandwidth of the shaper. It is thus better to take a point where the output voltage has started to rise. For accuracy in measurements, the value of 5% was chosen in order to be above of the noise and have a slope steep enough to get good time location.

**Factor of merit** : assuming the parallel noise is negligible, the minimum noise can be calculated from Eq.(45) as a function of the number of integrations n. Replacing A and C by their expressions from Eq.(34) and (38) yields :

\[\sigma_{opt}(n)=K\Biggl{(}\frac{J_{a}}{h_{max}(\mbox{\tiny$\dagger$}^{\mbox{ \tiny$\dagger$}})}\Biggr{)}^{1/4}\Biggl{(}\frac{I_{pu}^{2}}{\tau}\Biggr{)}^{3/8} \tag{53}\]

which allows the definion of a factor of merit F, by normalizing with the asymptotic value

\[F=\frac{\sigma_{opt}(n)}{\sigma_{opt}(\infty)} \tag{54}\]

The result is shown in Table 4 and indicates that the improvement obtained by increasing n past 3 is not worth the trouble.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|} \hline n & \(J_{a}^{2}\) & \(J_{b}^{2}\) & \(I_{pu}^{2}/\tau\) & \(A_{s}\) & \(A_{p}\) & \(B_{s}\) & \(B_{p}\) & F \\ \hline
2 & 3/32 & 1/32 & 2.559 & 1.006 & 1.01 2 & 2.777 & 0.881 & 1.24 6 \\
3 & 1/64 & 1/64 & 3.114 & 1.024 & 0.895 & 2.236 & 0.886 & 1.123 \\
4 & 3/51 2 & 5/51 2 & 3.581 & 1.091 & 0.852 & 2.17 6 & 0.896 & 1.084 \\
5 & 3/1 024 & 7/1024 & 3.995 & 1.146 & 0.830 & 2.183 & 0.904 & 1.063 \\
6 & 7/4 096 & 21/4 096 & 4.372 & 1.193 & 0.81 7 & 2.206 & 0.912 & 1.051 \\ \hline \end{tabular}
\end{table}
Table 4: _Noise and Pileup integrals for an ideal preamplifier followed by a CR RC\({}^{n}\) shaper. Series and Parallel noise coefficients in ENC and ENI as defined by Eq.(33) and (35). Factor of merit as defined in Eq.(54)._

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|} \hline n & \(h_{max}(\delta)\) & \(t_{max}(\delta)/\tau\) & \(t_{p}(\delta)/\tau\) & \(h_{max}(\mbox{\tiny$\dagger$}^{\mbox{\tiny$\dagger$}})\) & \(t_{max}(\mbox{\tiny$\dagger$}^{\mbox{\tiny$\dagger$}})/\tau\) & \(t_{p}(\mbox{\tiny$\dagger$}^{\mbox{\tiny$\dagger$}})/\tau\) & \(t_{m}/\tau\) \\ \hline
2 & 0.2306 & 0.586 & 0.574 & 0.2707 & 2 & 1.820 & 1.174 \\
3 & 0.1306 & 1.268 & 1.144 & 0.2240 & 3 & 2.523 & 1.715 \\
4 & 0.0902 & 2 & 1.653 & 0.1954 & 4 & 3.136 & 2.165 \\
5 & 0.0686 & 2.764 & 2.111 & 0.1755 & 5 & 3.686 & 2.559 \\
6 & 0.0551 & 3.55 & 2.530 & 0.1606 & 6 & 4.188 & 2.91 5 \\ \hline \end{tabular}
\end{table}
Table 3: _Maximum amplitude \(h_{max}\), peak position \(t_{max}\) and peaking time \(t_{p}\) (5-100%) for an impulse (\(\delta\)) and a step (\(\mbox{\tiny$\dagger$}^{\mbox{\tiny$\dagger$}}\)) at the input of an ideal preamplifier followed by a CR RC\({}^{n}\) shaper._Figure 9: \(Series\) _and Parallel noise coefficients in ENC (top) and \(ENI\) (bottom) for an ideal preamp followed by a CR RC\({}^{n}\) shaper. Dashed line : \(J_{a}/h_{max}\) and \(J_{b}/h_{max}\); dotted line : \(J_{a}\surd t_{max}/h_{max}\) and \(J_{b}/h_{max}\,/\surd t_{max}\); solid line \(A_{s}\), \(A_{p}\) as defined in Eq.(33) and \(B_{s}\), \(B_{p}\) as defined in Eq.(35). The peaking time 5-100% is a better invariant in the noise estimation than \(t_{max}\), as shown by the solid line compared to the dotted line._

## 3 Shaper design

### Overview

The requirements for the shaper are the following :

**i) Input impedance :** it should be 50 \(\Omega\) in order to terminate the cable from the preamplifiers. The precision here is not essential as the cable is terminated at both ends. However, any change over the whole dynamic range would result in non-linearity as a variable part of the signal gets reflected. For the \(\emptyset\)T, the input impedance is unimportant, but as we aim at a single design, we also impose a constant input impedance (although possibly higher).

**ii) Shaping time** : as shown in 2.5, the optimum peaking time at 10\({}^{8}\) luminosity is around \(t_{p}(^{\prime})=40\) ns, which corresponds to \(\tau\)=16 ns in the shaper, assuming \(\tau_{pa}\)=15 ns. A uniformity better than 1 ns would eliminate the need for channel to channel timing correction.

**iii) Noise** : as shown in 2.4.6, the very low noise achieved by the preamps [5] combined with their limited noise gain due to the large dynamic range lead to an upper limit of \(e_{sh}\)= 2 nV/\(\sqrt{\rm Hz}\) for reasonnable contribution.

**iv) Power dissipation** : the foreseen location of the shapers in the crack between barrel and end-cap calorimeters requires a high level of compactness, with typically 8 shapers per chip to avoid expensive ceramic packages, and this requires \(P_{d}<100\) mW/channel.

Figure 10: _Block diagram of the shaper_

**v) Linearity** : the choice of having two linear outputs with high and low gain instead of dynamic compression [3] argues for very good linearity (better than 1%) in order to take the full benefit of linear systems.

**vi) Out put** : typically a 4 V swing in a 1 k\(\Omega\) load impedance, is compatible with the following stage located nearby.

**vii) Gain ratio** : must still be optimized as a function of the number of bits in the readout. It would range between 8 and 32.

The architecture retained consists of two sections in parallel : high gain and low gain, with similar design, except for the input stage which also provides the cable termination. In order to accomodate to the large dispersion in resistor values (\(\pm 20\%\)) and capacitor values (\(\pm 10\%\)) of the process, an adjustment has been included with extra capacitors and switches in parallel with those that determine the shaping time. 4 bits, common to the whole chip, allow a tuning of \(\pm 40\%\) around the central value, with a resolution of 5% corresponding to 1 ns. The global schematic is shown in Fig.10.

### High gain input stage

The high gain input stage (cf. Fig.11) provides a first amplification in order to make the noise from following stages negligible, a first integration (RC) and a constant 50 \(\Omega\) input impedance, even when overloaded.

A common base configuration (Q 3) has been chosen to make an active termination as it minimizes noise and exhibits good overload behaviour. In order to improve the linearity, Q 3 has been inserted in the feedback loop of a rudimentary amplifier (Q 1-Q 2), which decreases the input impedance of Q 3 (\(\sim 1/g_{m3}\)) by the open loop gain \(g_{m1}R_{c}\). Thus,

Figure 11: _Schematic diagram of the high gain input stage_the input impedance is :

\[R_{in} = R_{\epsilon}+\frac{1}{g_{m1}R_{\epsilon}g_{m3}} \tag{55}\]

which is very close to the value of \(R_{\epsilon}\), set to 50 \(\Omega\).

The transfer function of this stage is simply given by :

\[\frac{V_{out}}{V_{in}}=\frac{R}{R_{\epsilon}}\frac{1}{1+sRC} \tag{56}\]

in which the resistors ratio determine the gain with a good precision. The pole \(RC=\tau\) yields the first integration. The signal is buffered to the second stage with a White follower (Q4-Q5) described in the next paragraph.

The noise is dominated by the series noise due to \(R_{\epsilon}\) and Q1 :

\[e_{sh}^{2}=4\,kT(R_{\epsilon}+R_{bb}+\frac{1}{2g_{m1}}) \tag{57}\]

in which \(R_{bb}\) is the base spreading resistance of Q1.

The noise is minimized by using a large transistor for Q1 to reduce \(R_{bb}\) an d operating it at a relatively large collector current, around 3 mA.

### Low gain input stage

The low gain input stage (cf. Fig.12) only provides the first integration (RC). The noise performance here is non critical and no amplification is needed, so that a simple RC network followed by a buffer is adequate.

Figure 12: _Schematic diagram of the low gain input stage_

The buffer is built around a White follower (Q4-Q5) as a low output impedance is needed here to ensure good linearity. This overcomes the weaknesses of lateral PNP transistors such as Q4. The transistor pair forms a closed loop configuration, in which local feedback is used to decrease the output impedance to a fraction of an Ohm. However, the stability of such a configuration needs careful attention, especially when driven from a low impedance or with capacitive loading.

### Second stage

The second stage is similar in both sections : it provides the differentiation, the second integration and some gain. The same common base configuration is used (cf. Fig.11), although operated at lower current to reduce the power dissipation. A gain of 4 is taken here in order to recover the signal attenuation (0.27) due to the differentiation, whereas the second integration is given by the pole on the collector. Again, a White follower is used as the output stage.

## 4 Experimental results

The first prototype described hereafter was designed slightly differently from the requirements listed above, mainly for historical reasons. It is a little faster, the time constant being set to \(\tau=13\) ns, with R = 1 k\(\Omega\) and C = 12 pF + 1 pF from the transistors. The high gain was set to 10 using ten resistors R in parallel for \(R_{\epsilon}\), which led to an input impedance of 100 \(\Omega\). There were 4 bi-channels per chip.

### DC parameters

Single test transistors have been included on the chip, a NPN an a lateral PNP. Their measured characteristics have been found in good agreement with the Spice parameters used for the simulations. The current gain for the NPN was \(\beta_{NPN}=80\) at \(I_{c}\) = 1 mA, whereas for the lateral PNP, \(\beta_{PNP}\) was only 10 at \(I_{c}\) = 0.2 mA (typical operating points). Concerning passive components, the resistor R and capacitor C determining the shaper time constant were implanted separately. R was measured as 950 \(\Omega\) and C gave 12.5 pF.

### Dynamic measurements

The step response of the shaper (Fig.13) gives a temporal waveform close to that predicted by simulation. For the unity gain section, simulation indicated a gain of 0.91 and a peaking time (5-100%) for a step input of 24 ns (all bits OFF). It differs from the ideal expression of 2.2 because of second order poles. Measurements gave a gain of 0.84 and a peaking time of 26 ns. The slight discrepency in peaking time is probably due to some extra capacitance and explains the smaller gain. The high gain section gave a gain of 7.2 with the same peaking time.

### Peaking time adjustment

The peaking time (5-100%) has been measured on 8 chips with 4 bi-channels. The _rms_ of the dispersion amounted to 0.95 ns, which confirms our assumption of good uniformity over a same chip, and even over a wafer. The peaking time adjustment with the 4 bits is shown in Fig.13. With all bits OFF, the peaking time was measured \(t_{p}(\dagger)=26\) ns, whereas all bits ON gave 42 ns. Thus, one bit gives a variation of 1 ns, as required.

### Saturation and crosstalk

The high gain has been checked for saturation behaviour, showing no dead time longer than the drift time \(t_{\,\mu\!r}\). During this time, the signal shape is distorted, mainly because the differentiation is taken after the saturation to conserve zero signal area. Unfortunately, it has not been possible to measure the crosstalk between adjacent channels, because of a high frequency oscillation which occurs when several channels are powered simultaneously. It comes presumably from couplings in the power supplies and bonding inductance, for which the White follower is particularly sensitive.

Figure 13: _Measurement of the shaper time response for a step input, with minimum and maximum adjustment_

### Linearity

The linearity has been measured on both high gain and low gain sections, with the peaking time set at a median value (\(t_{p}(\dagger^{\prime})=32\) ns) to take into account a possible effect of the switches. The residuals to a best line fit (Fig.14) indicate an integral non-linearity [(data - fit)/max] better than \(\pm 0.3\%\) for both gains. The "relative" non-linearity [(data - fit)/data], which is actually much more demanding, is also satisfactory (in the percent range) as shown in Fig.14. This confirms the stability of the input impedance over the dynamic range.

### Noise

The noise spectral density has been measured (Fig.15) on the high gain output, using Fourier transform on a digital oscilloscope. Referring it to the input gives \(e_{sh}=1.8\) nV/\(\sqrt{\rm Hz}\) from which \(R_{\epsilon}=1\,00\)\(\Omega\) contributes \(\sqrt{4kTR_{\epsilon}}=1.3\) nV/\(\sqrt{\rm Hz}\). Thus, the shaper alone exhibits a noise density of 1.2 nV/\(\sqrt{\rm Hz}\), corresponding to 85 \(\Omega\) noise resistance; it would give 1.5 nV/\(\sqrt{\rm Hz}\) with \(R_{\epsilon}=50\)\(\Omega\) input impedance.

The _rms_ noise at the high gain output has been measured : \(V_{n}=80\mu\)V at \(t_{p}(\dagger^{\prime})=26\) ns, in good agreement22 with the spectral density. On the low gain output, the _rms_ noise has been measured \(V_{n}=4\,0\mu\)V. With the 4 V maximum output voltage, this leads to a dynamic range of 50,000 (resp. 100,000) for the high gain (resp. low gain).

Figure 14: _Integral and ”relative” non linearily of the shaper_

## 5 Conclusion

Analytical calculations indicate that the peaking time to the triangle (\(t_{p}(\Delta)\)) should be the favoured specification for the time response of the front end electronics. Experimental measurements on the first prototype of a monolithic NPN shaper for ATLAS have given good results concerning the speed, the peaking time adjustment and the noise. A high frequency oscillation problem in the White followers will almost certainly be resolved in the next iteration.

## References

* [1] "ATLAS Technical Proposal" CERN/LHCC/94-43
* [2] W.E. Cleland, E.G. Stern "Signal processing considerations for liquid ionization calorimeters in high rate environment". NIM A338 (1994) 467-497
* [3] FERMI collaboration "Status Report" CERN/DRDC/93-21
* [4] V. Radeka et al. "Performance and reliability of Si cryogenic preamplifiers for noble liquid calorimetry", 5th international conference on calorimetry in high energy physics, Brookhaven National Laboratory, 26 sep-1 oct 1994.
* [5] D.V. Camin et al. "Performance of monolithic current-sensitive preamplifiers with an accordion LAr calorimeter", 5th international conference on calorimetry in high energy physics, Brookhaven National Laboratory, 26 sep-1 oct 1994.

Figure 15: _Noise spectral density at the high gain input_