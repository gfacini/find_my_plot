## 1 Towards tuning electromagnetic shower properties to data with AtlFast3

The ATLAS Collaboration

A precise simulation of electromagnetic shower properties in the ATLAS calorimeter is crucial for the identification of particle showers originating from electrons and photons. AtlFast3, the next-generation of fast simulation in ATLAS, precisely simulates the properties of electromagnetic showers, but is limited by the accuracy of the full Geant4 simulation, upon which its parametrization is based. Differences between the Geant4 simulation and data collected by the ATLAS detector are well known but insufficiently understood. This note shows that AtlFast3 can be tuned to accurately describe the shower shapes observed in data and describes the underlying models that are employed to outperform Geant4.

## 1 Introduction

Photon identification in ATLAS relies on calorimetric variables that describe the lateral and longitudinal shower properties and show good power to discriminate against fake signatures from QCD jets and decays of neutral hadrons in jets. Therefore, the precise simulation of the electromagnetic shower development is crucial to ensure the correct identification of photon and electron candidates. However, the Geant4 [1] simulation of the ATLAS detector is known to imperfectly reproduce the properties of electromagnetic showers observed in data [2]. In general, longitudinal shower shapes appear to be better modeled in comparison to the transverse shower development. While these differences mainly result in shifts in the central values of the shower shape distributions, their origin remains unknown. Traditionally, these discrepancies are corrected using _ad hoc_ methods such as applying shifts to the corresponding distributions, a procedure known as _fudging_.

AtlFast3 [3] is the next generation of fast simulation employed by the collaboration and plays an important role in tackling the increasing CPU needs in Run 3 and beyond. In AtlFast3, three distinct simulation tools are used: Geant4 is employed to simulate the Inner Detector and the Muon Spectrometer, while the simulation of the calorimeter response is performed using a parametrized approach known as FastCaloSimV2 and a new machine-learning based simulation using Generative Adversarial Networks (GANs) known as FastCaloGAN. FastCaloSimV2 parametrizes the calorimeter response using single particle samples of photons, electrons and pions in logarithmically spaced energy bins ranging from 64 MeV to 4 TeV and 100 equally spaced bins in \(|\eta|\) from 0 to 5, covering the full detector region. While FastCaloSimV2 is used for the simulation of photons, electrons as well as low and high energetic pions, FastCaloGAN is used for the simulation of pions in the intermediate energy range. As a parametrized simulation, AtlFast3 inevitably inherits the mismodelling observed in the shower shape variables in Geant4. However, it allows to flexibly alter the simulation of the lateral and longitudinal shower shape properties on a fundamental level and hence offers the possibility of tuning electromagnetic shower properties to data.

In this note, it is shown that AtlFast3 can be modified in a way that the shower shapes observed in data are accurately reproduced by the simulation. The development of a data tune within AtlFast3 and the underlying models are described for photons with \(E_{T}=65\) GeV and \(0.20<|\eta|<0.25\), corresponding to a single parametrization point in AtlFast3. The definitions of the variables that are targeted in the development of the data tune are shown in Table 1 and include the most important shower shape variables in the EM middle and strip layer of the calorimeter, which are known to be insufficiently described by the simulation.

## 2 The ATLAS calorimeter system

The ATLAS experiment [4] at the LHC is a multipurpose particle detector with a forward-backward symmetric cylindrical geometry and a near \(4\pi\) coverage in solid angle.1. The calorimeter system of the ATLAS detector consists of a complex arrangement of calorimeters in which three main regions can be identified: the barrel, which covers the cylindrical part of the detector, the end-caps (EC) and the

\begin{table}
\begin{tabular}{c l c} \hline \hline Category & Description & Name \\ \hline  & Ratio of the sum of the energies of the cells contained in a & \\  & \(3\times 7\) rectangle (measured in cell units) to the sum of the & \\ EM middle layer & cell energies in a \(7\times 7\) rectangle, both centered around the & \(R_{\eta}\) \\  & most energetic cell & \\  & Lateral shower width, \(\sqrt{\Sigma E_{i}\eta_{i}^{2}/\Sigma E_{i}-\left(\Sigma E_{i}\eta_{i}/\Sigma E _{i}\right)^{2}}\), & \\  & where \(E_{i}\) is the energy and \(\eta_{i}\) is the pseudorapidity of cell \(i\) & \(w_{\eta 2}\) \\  & and the sum is calculated within a window of \(3\times 5\) cells & \\  & Ratio of the sum of the energies of the cells contained in a & \\  & \(3\times 3\) rectangle (measured in cell units) to the sum of the cell & \\  & energies in a \(3\times 7\) rectangle, both centered around the most & \(R_{\phi}\) \\  & & energetic cell \\  & Lateral shower width, \(\sqrt{\Sigma E_{i}\left(i-i_{\max}^{2}\right)/\Sigma E_{i}}\), where \(i\) runs over & \\ EM strip layer & all cells in a window of 3 cells around the highest-energy cell & \(w_{\eta 1}/w_{\mathrm{s3}}\) \\  & Total lateral shower width, \(\sqrt{\Sigma E_{i}\left(i-i_{\max}\right)^{2}/\Sigma E_{i}}\), where \(i\) runs over all cells in a window of \(\Delta\eta\approx 0.0625\) and \(i_{\max}\) is the index & \(w_{\mathrm{stot}}\) \\  & Energy outside the core of the three central strips but within & \\  & seven strips divided by energy within the three central strips & \(F_{\mathrm{side}}\) \\  & Ratio of the energy difference between the maximum energy & \\  & deposit and the energy deposit in the secondary maximum in & \\  & the cluster to the sum of these energies & \\ \hline \hline \end{tabular}.

\end{table}
Table 1: Definition of shower shapes relevant for the middle and strip layer of the calorimeter targeted in the development of the data tune. Table modified from [2].

forward calorimeter, which covers the region closest to the beam pipe. In the barrel and end-cap regions, lead-liquid argon (LAr) sampling calorimeters that provide high granularity electromagnetic (EM) energy measurements are used. A steel/scintillator-tile hadron calorimeter covers the central pseudorapidity range (\(|\eta<0.7|\)). The endcap and forward regions are instrumented with LAr calorimeters for both the EM and hadronic energy measurements up to \(|\eta|=4.9\). The electromagnetic calorimeter consists of the electromagnetic barrel (EMB) covering the central detector region \(0<|\eta|<1.52\) and the electromagnetic end-cap (EMEC), which covers the pseudorapidity range \(1.375<|\eta|<3.2\). The EM calorimeters have an accordion shaped geometry that provides several layers without any gaps. While the granularity of the LAr calorimeter has a complex structure and changes in dependence of the detector region, a schematic depiction of the ATLAS LAr calorimeter granularity around \(\eta=0\) is shown in Figure 1. The first layer consists of finely segmented strips with a width of \(\Delta\eta=0.0031\) in order to effectively discriminate between \(\pi^{0}\) and electromagnetic energy deposits. The main sampling for measuring energy is the middle layer, which consists of less granular squares with \(\Delta\phi\times\Delta\eta=0.0245\times 0.025\).

## 3 Data and MC samples

The tuning model is derived from a \(pp\) collision dataset sample of 58.5 fb\({}^{-1}\) collected in 2018 during Run 2 with the ATLAS detector at \(\sqrt{s}=13\) TeV. The mean number of interactions per bunch crossing was \(\langle\mu\rangle=36.1\). A Good Run List (GRL) selection is applied to only select events recorded from good luminosity blocks, in which a proper functioning of the detector can be ensured. Photons are collected by an OR of single photon triggers [5], most of which are expected to stem from \(\gamma\)+jets processes.

Figure 1: Schematic depiction of the ATLAS LAr calorimeter granularity around \(\eta=0\). [2]

For the nominal and tuned version of the simulation, single photons are simulated using AtlFast3. The photons are generated at the origin of the detector and pile-up is modeled by overlaying signals from simulated inelastic \(pp\) events with the hard-scattering event [6], resembling the conditions during the Run 2 data taking period. An average number of pileup interactions per \(pp\) bunch crossing of 38 was used, reasonably similar to the pile-up distribution recorded by the ATLAS experiment during 2018. The pile-up samples are generated using Pythia 8.186 using the NNPDF23 set of PDFs [7] and the A3 tune [8].

As the development of the tuning model focusses on photons with \(E_{T}\) = 65  between 0.20 and 0.25 in \(|\eta|\), corresponding to a single parametrization point in AtlFast3, photon candidates are required to have \(60\GeV<E_{T}<70\GeV\) and \(0.20<|\eta|<0.25\). To avoid electrons resulting from photon conversions from interfering in the tuning procedure, only photons classified as unconverted by the reconstruction algorithm [9] are selected. The purity of the sample is further increased by requiring the photon candidates to pass the Tight identification criteria and the FixedCutLoose[9] isolation working point. Using the latter selection, around 7830 photon candidates are selected in data, corresponding to an efficiency of approximately 14%. The signal purity in data is estimated to be around 90% [10], but background components are not expected to significantly alter the means of the shower shape variables observed in data.

## 4 Tuning model

The reconstructed shower shapes are dependent on the geometrical distribution of the hits in the various layers of the calorimeter. In the case of photons and electrons, the assigned hit energy in AtlFast3 is independent of the position of the hit (\(E_{\mathrm{hit}}\approx 10\MeV\)), such that the hit positions in the \(\eta-\phi\) plane constitute the only degrees of freedom that will impact the simulated properties of the electromagnetic shower development. By design, the geometric distribution of the hit positions can be arbitrarily altered in AtlFast3, while a similar procedure is not possible in Geant4. As a result, a powerful procedure to tune the fast simulation to data, is to transform the hit positions within AtlFast3 in a way that the shower shapes observed in data are reproduced with AtlFast3. In order to accomplish the latter, the azimuthal angle \(\phi\) of the hit position is transformed into a new angle \(\phi^{\prime}\) according to

\[\phi\rightarrow\phi^{\prime}=\phi_{c}+\phi_{s}\cdot\Delta\phi, \tag{1}\]

where \(\phi_{c}\) is the azimuthal angle of the shower center, \(\Delta\phi\) the projected distance to the shower center in \(\phi\) direction and \(\phi_{s}\) an arbitrary model parameter. The computation of the shower centers in AtlFast3 is based on the trajectory of the incident particle and extrapolated to the various layers of the calorimeter. The transformed distance to the shower center in \(\phi\) is then given by \(\Delta\phi^{\prime}=\phi_{s}\cdot\Delta\phi\), such that \(\phi_{s}\) is a measure of the scale of transformation. Analogously, the identical transformation can be performed on the \(\eta\) of the hit positions. While positive values of \(\phi_{s}\) or \(\eta_{s}\) will shift hits away from the shower center, negative values will cause an inwards movement of the hits.

### Two-dimensional \(\eta-\phi\) scaling model for middle layer shower shapes

As the middle layer of the calorimeter is finely grained in the \(\eta\) and \(\phi\) direction, shower shapes are expected to be sensitive to shifts around the shower center in both directions. The simplest transformation in this case, is to apply constant scaling factors \(\phi_{s}\) and \(\eta_{s}\). Figure 2 shows the hit distributions in the \(\Delta\eta-\Delta\phi\) space after application of a constant scaling in \(\eta\) (a) and \(\phi\) (b) direction as well as for a radial scaling (c), in which case the identical scaling is applied in both directions. According to expectations, the hits are shifted further away from the shower center in \(\eta\) direction when setting a large value for \(\eta_{s}\). In the opposite case of setting a large value for \(\phi_{s}\), the hit density is stretched in \(\phi\) direction. Lastly, setting both parameters to equally large values, leads to hits being moved radially outwards from the shower center such that the hit density decreases within the shower core and increases towards the outer regions.

In order to find suitable model parameters \(\eta_{s}\) and \(\phi_{s}\), a two-dimensional phase space scan in the region \(\eta_{s}\times\phi_{s}=[0.9,1.1]\times[0.8,1.1]\) with step size \(\Delta\phi_{s}=0.1\) and \(\Delta\eta_{s}=0.01\) is performed using the standalone FastCaloSimV2 shower simulation, which is part of the AtlFast3 toolkit and does not rely on the full simulation and reconstruction chain employed by ATLAS. At each point of the \(\eta_{s}-\phi_{s}\) phase space, the means of the shower shapes are evaluated and intermediate values are interpolated using natural neighbor interpolation [11]. Employing latter interpolation, contour values corresponding to the desired means observed in data are extracted for each of the shower shapes. The two-dimensional phase space scan in the \(\eta-\phi\) scaling model is shown in Figure 3 for \(w_{\eta 2}\) (a), \(R_{\eta}\) (b) and \(R_{\phi}\) (c). As expected, \(w_{\eta 2}\) and \(R_{\eta}\) show a strong sensitivity for a scaling in \(\eta\) and a low sensitivity in \(\phi\) scaling, while the opposite is the case for \(R_{\phi}\). The extracted target contour lines for \(w_{\eta 2}\) and \(R_{\eta}\) show an almost parallel behavior, but are close enough to each other, indicating that the same set of parameters is suitable to tune both variables. In both cases, a clear cross section with the contour line extracted for \(R_{\phi}\) is visible, i.e. all target contour lines cross at one single point within statistical uncertainties. A two-dimensional constant scaling model is therefore expected to be able to fully describe the differences observed in the central values of the respective shower shapes between simulation and data. The optimal parameters chosen to validate the model correspond to the cross section of the target contours given by \(w_{\eta 2}\) and \(R_{\phi}\) and are \(\phi_{s}=0.861\) and \(\eta_{s}=1.028\) (see Section 5).

Figure 2: Hit distributions in the \(\Delta\eta-\Delta\phi\) space after application of a constant scaling in \(\eta\) (a) and \(\phi\) (b) direction as well as for a radial scaling (c). The color scheme encodes the hit density, while the white dots show the positions of the individual hits.

Figure 3: Two-dimensional phase space scan in the linear scaling model for the middle layer shower shapes \(w_{\eta 2}\)(a), \(R_{\eta}\)(b) and \(R_{\phi}\)(c). The white crosses show the points in the scaling space at which the mean values of the shower shapes are evaluated. Natural neighbor interpolation is employed to interpolate values in between to extract contour lines, which correspond to the target shower shape means extracted from data. The shaded regions show the statistical uncertainties of the unscaled means of the corresponding shower shapes. The red circles indicate the cross sections between the target contour lines.

### Cubic \(\eta\) scaling model for strip layer shower shapes

As the strip layer of the ATLAS calorimeter consists of finely segmented strips, the shower shapes are expected to be very sensitive to hit displacements in \(\eta\) direction, while very little sensitivity is expected for displacements in \(\phi\). As a result, the \(\phi_{s}\) scaling applied for the development of the data tune targeting middle layer variables described in Section 4.1 becomes unapplicable. However, a constant \(\eta_{s}\) factor is insufficient to correctly model all the target shower shapes. Under the assumption that there exists a functional form \(\eta_{s}(\Delta\eta)\) that can describe the differences of electromagnetic shower properties in simulation compared to data, one can expand \(\eta_{s}\) as series in the distance to the shower center in \(\eta\) direction:

\[\eta_{s}=1+a_{0}+a_{1}\cdot\frac{\Delta\eta}{\Delta\eta}+a_{2}\cdot\left(\frac {\Delta\eta}{\Delta\eta}\right)^{2}+...+a_{n}\cdot\left(\frac{\Delta\eta}{ \Delta\eta}\right)^{n}, \tag{2}\]

where \(a_{n}\) are arbitrary model parameters and \(\Delta\eta\approx 0.0039\) is the mean distance of the hits to the shower center in \(\eta\) direction. For \(n=1\), \(\eta_{s}\) is an affine function of \(\Delta\eta\) and is described by two free parameters \(a_{0}\) and \(a_{1}\), such that a similar two-dimensional phase space scan as described in Section 4.1 can be performed. While such a linear model might describe some of the targeted variables such as \(w_{\eta 1}\), \(w_{\text{stot}}\) and \(E_{\text{ratio}}\) correctly, it is deemed to insufficiently model the differences observed in data for \(F_{\text{side}}\). The transition from a two-dimensional to higher dimensional models is however non-trivial, as graphical approaches to studying the model phase space become impractical and are significantly more expensive to evaluate with regards to the required CPU consumption. Models with \(n>1\) may therefore offer improved performance, but require more involved optimization algorithms such as derivative-free black box optimization methods to analyze. Orion[12] is employed in order to perform a random search in these higher dimensional phase spaces with the aim of minimizing

\[\chi^{2}=\frac{1}{N}\sum_{i\in S}\left(\frac{\bar{X}_{i}-\bar{X}_{i}^{\prime}} {\sigma_{i}}\right)^{2}, \tag{3}\]

where the sum runs over the target shower shapes \(S=\{w_{\eta 1},w_{\text{stot}},E_{\text{ratio}},F_{\text{side}}\}\), \(\bar{X}_{i}\) is the mean resulting from the black-box evaluation given a set of arbitrary parameters \(a_{n}\), \(\bar{X}_{i}^{\prime}\) is the target mean extracted from data and \(\sigma_{i}\) the standard deviation of the respective shower shape in the nominal simulation. The normalization factor \(N=4\) is chosen as the number of targeted variables, such that on average the black-box evaluated and the target mean have a distance of \(1\sigma\) to each other for a value of \(\chi^{2}=1\). The method aims to minimize the shifts in the central values observed in the shower shapes with respect to data, while keeping the RMS values of the distributions largely intact. An alternative approach would be to exploit the full information of the simulation by computing Pearson's test-statistic directly using the distributions of the shower shape variables. However, the observed differences in the shower properties are almost fully driven by shifts in the means of the distributions and while misidentified photons in data are unlikely to play a significant role in the means of the variables, they are more likely to alter the higher moments of the distributions, such that one risks to absorb background driven differences into the tune. The baseline error with the nominal simulation is at \(\chi^{2}\approx 0.165\). While separate searches for each of the model dimensions are studied, a \(\chi^{2}\) value in the sub-percent region is reached with four free parameters (\(n=3\)).

An initial phase space scan in a relatively large search region of \(a_{0}\in[-3,3]\) and \(a_{k}\in[-1,1]\) with \(k\in\{1,2,3\}\) is performed. Figure 4 shows the development of the \(\chi^{2}\) error in dependence of the trials ordered by the time they are suggested by Orion. The red line indicates the error of the current best trialat a given point in time. While most of the evaluations in the phase space show large errors in the range between 1 and 30, the minimal error drops significantly after 293 trials to \(\chi^{2}\approx 0.0023\). The corresponding optimal parameters are given by \(a_{n}=\{0.2486,0.2944,-0.3486,0.1633\}\). These results show that with

Figure 4: Model error \(\chi^{2}\) as a function of trials ordered by suggested time for the data tune targeting the strip layer variables \(w_{\eta 1},w_{\text{stot}},E_{\text{ratio}}\) and \(F_{\text{side}}\). The phase space is scanned with a random search algorithm in the region \(a_{0}\in[-3,3]\) and \(a_{k}\in[-1,1]\) with \(k\in\{1,2,3\}\). The blue dots show the individual trials, while the red line indicates the error of the current best trial. The orange box shows the optimal set of parameters found after 350 trials.

Figure 5: Scaling factor \(\eta_{s}\) as a function of the distance to the shower center \(\Delta\eta\) in \(\eta\) direction (a) and new distance to the shower center \(\Delta\eta^{*}\) as a function of the original distance to the shower center \(\Delta\eta\) (b). The blue dashed line indicates the functional form of the nominal simulation, while the orange line shows the dependence for the tuned simulation. The shaded red area displays the normalized shape of the hit distribution in \(\Delta\eta\). For illustration purposes, the distribution is reflected across the \(\Delta\eta\) axis in case (b). The vertical dashed lines indicate the positions of the strip edges, assuming that the shower center is situated in the center of a strip.

higher dimensional \(\eta_{s}\) scaling models, an effective tuning of electromagnetic shower properties to data is feasible. In fact, it has been shown that a reduction in the size of the search space around regions of interest can decrease the model error even further. The resulting functional dependence of the scaling factor \(\eta_{s}\) on the distance to the shower center as well as the transformed distance as a function of the original distance projected onto the \(\eta\) direction is shown in Figure 5. Hits in the shower core (\(\Delta\eta=0\)) are moved outwards with a constant scaling \(\eta_{s}=1+a_{0}\approx 1.2486\). The scaling first increases moderately until \(\Delta\eta\approx 0.008\), at which the scaling factor begins to increase strongly. The scaling factor diverges for \(\Delta\eta\rightarrow\infty\), which however, has no physical implications as the majority of hits do not receive such large scaling factors as shown by the shaded red hit distribution in Figure 5.

## 5 Results

The phase space analysis performed in Section 4 suggests that both models should be able to reproduce the means of the shower shapes observed in data correctly. However, the analysis was performed using the FastCaloSimV2 standalone implementation and it is crucial to ensure that the model accomplishes similar performance when propagating through the full simulation and reconstruction chain employed by ATLAS. While not expected, it is also necessary to make certain that the model does not significantly distort the shape of the distributions beyond a simple shift in the central values. Figure 6 shows the comparison between the data, the nominal and the tuned simulation for the shower shape variables \(w_{\eta 2}\) (a), \(R_{\eta}\) (b) and \(R_{\phi}\) (c).

A comparison between the nominal simulation with AtlFast3 and Geant4 is shown in the Appendix in Figure 8 and Figure 9 for the middle and strip layer variables, respectively. As expected, AtlFast3 reproduces the electromagnetic shower properties simulated with Geant4 very precisely. In the case of \(w_{\eta 2}\), the mean of the nominal simulation is shifted by 1.26% in comparison to data. The two-dimensional \(\eta-\phi\) scaling model entirely eliminates this shift and is furthermore compatible with the shape observed in data within

Figure 6: Validation of the linear hit scaling model for the most important shower shape variables \(w_{\eta 2}\) (a), \(R_{\eta}\) (b) and \(R_{\phi}\) (c) in the second sampling layer. The distributions for the nominal simulation are shown in blue, while the tuned simulation is shown in orange and the data in gray. The uncertainties on the data include statistical sources only and no background subtraction is performed. As a reference, a comparison of the shower shape variables between AtlFast3 and Geant4 is shown in Figure 8 in the Appendix.

statistical uncertainties. Similarly, a small shift seen for \(R_{\eta}\) is reduced from 0.16% to 0.06%, without impacting the shape of the distribution. A large shift to data is seen for the nominal simulation in the case of \(R_{\phi}\), which is effectively reduced from 0.55% to 0.15%. The difference in the RMS to data is slightly increased by 6% from 20% to 26% and the tails of the distribution show minor mismodelling.

Figure 7 shows the validation of the cubic \(\eta\) scaling model for the strip layer variables \(w_{\eta 1}\) (a), \(w_{\text{stot}}\) (b), \(E_{\text{ratio}}\) (c) and \(F_{\text{side}}\) (d). The largest shift between the data and the nominal simulation is observed for

Figure 7: Validation of the cubic hit scaling model for the most important shower shape variables \(w_{\eta 1}\) (a), \(w_{\text{stot}}\) (b), \(E_{\text{ratio}}\) (c) and \(F_{\text{side}}\) (d) in the strip layer. The distributions for the nominal simulation are shown in blue, while the tuned simulation is shown in orange and the data in gray. The uncertainties on the data include statistical sources only and no background subtraction is performed. As a reference, a comparison of the shower shape variables between AtlFast3 and Geant4 is shown in Figure 9 in the Appendix.

\(F_{\rm side}\) and is effectively reduced from 10.4% to 0.4%, followed by a shift of 3.8% in the central value of \(w_{\rm{stot}}\), which is decreased to 0.8%. Similarly, the difference in \(w_{\eta 1}\) is reduced from 3.5% to 0.4%. In all three cases, the shape of the shower shape variables generated using the tuned simulation shows excellent agreement with data, with very small differences in the high-end tail of the \(w_{\eta 1}\) distribution. In the case of \(E_{\rm ratio}\), a small degradation in the relative mean difference to data is observed from 0.25% to 0.4%, but still remaining well under the sub-percent level. A summary of the relative mean and RMS differences to data for the nominal and the tuned simulation for all targeted shower shape variables is shown in Table 2. The corresponding means and RMS values are provided in Table 3 in the Appendix. As the data tune only targets the means of the shower shape variables, the RMS values are not expected to be significantly affected by the tune. However, for \(F_{\rm side}\), a significant improvement in the absolute relative RMS difference is observed from 22% to 9%, while a slight degradation from 6% to 14% is seen for \(E_{\rm ratio}\). The RMS of all other variables remains largely unchanged.

## 6 Conclusion

Differences between the simulation of electromagnetic shower properties and data are a long-standing problem in ATLAS and could only be tackled using ad hoc methods such as the application of _fudge factors_ until now. For the first time, this note presents two different tuning models for the strip and middle layers of the calorimeter embedded in the state-of-the-art fast simulation employed in ATLAS that are able to reproduce the photon shower shapes observed in data with differences in the means being well below the sub-percent level. The data tune is directly integrated in the simulation toolkit and does not employ any ad hoc post-simulation corrections. In addition, the derived models can provide useful insights and possible explanations on the current issues observed with Geant4 in ATLAS. For instance, the large differences between the scaling factors in the two layers of the calorimeter in \(\eta\) direction, i.e. \(\eta_{s}\sim 3\%\) for the middle layer and \(\eta_{s}(\Delta\eta=0)\sim 25\%\) for the strip layer, shows that a very different increase to the width of the showers is required for the two layers. Given that Orion provides an easy to scale asynchronous distributed framework for black-box optimization, an extension of the tune to other regions of the phase space is in reach.

\begin{table}
\begin{tabular}{l c c c c} \hline \hline Variable & \multicolumn{2}{c}{RMD (\%)} & \multicolumn{2}{c}{RRD (\%)} \\ \hline  & No tune & Tune & No tune & Tune \\ \hline \(w_{\eta 2}\) & \(1.26\pm 0.06\) & \(0.01\pm 0.06\) & \(6\pm 1\) & \(4\pm 1\) \\ \(R_{\eta}\) & \(0.16\pm 0.01\) & \(0.06\pm 0.01\) & \(5\pm 1\) & \(5\pm 1\) \\ \(R_{\phi}\) & \(0.55\pm 0.01\) & \(0.15\pm 0.01\) & \(20\pm 1\) & \(26\pm 1\) \\ \(w_{\eta 1}\) & \(3.54\pm 0.07\) & \(0.4\pm 0.2\) & \(11\pm 1\) & \(6\pm 3\) \\ \(w_{\rm{stot}}\) & \(3.8\pm 0.2\) & \(0.8\pm 0.5\) & \(2\pm 1\) & \(4\pm 3\) \\ \(E_{\rm{ratio}}\) & \(0.24\pm 0.04\) & \(0.50\pm 0.08\) & \(6\pm 1\) & \(14\pm 3\) \\ \(F_{\rm{side}}\) & \(10.4\pm 0.2\) & \(0.4\pm 0.5\) & \(22\pm 1\) & \(9\pm 3\) \\ \hline \hline \end{tabular}
\end{table}
Table 2: Absolute relative mean difference (RMD) and absolute relative RMS difference (RRD) to data for the nominal and the tuned simulation for the various targeted shower shape variables.

[MISSING_PAGE_EMPTY:13]

Figure 9: Distributions of the most relevant strip layer shower shape variables \(w_{\eta 1}\) (a), \(w_{\rm{stot}}\) (b), \(E_{\rm{ratio}}\) (c) and \(F_{\rm{side}}\) (d) for photons with \(E_{T}=65\) GeV and \(0.20<|\eta|<0.25\), simulated using AtlFast3 and Geant4.

\begin{table}
\begin{tabular}{l l l l l l l} \hline \hline Variable & \multicolumn{3}{c}{Mean} & \multicolumn{3}{c}{RMS} \\ \hline  & Data & No tune & Tune & Data & No tune & Tune \\ \hline \(w_{\eta 2}\) & 0.009156 & 0.009041 & 0.009158 & 0.000389 & 0.000365 & 0.000372 \\ \(R_{\eta}\) & 0.9670 & 0.96854 & 0.96638 & 0.0096 & 0.00908 & 0.00909 \\ \(R_{\phi}\) & 0.9779 & 0.97253 & 0.97941 & 0.0088 & 0.00707 & 0.00657 \\ \(w_{\eta 1}\) & 0.5830 & 0.5623 & 0.5807 & 0.0321 & 0.0286 & 0.0303 \\ \(w_{\rm{stot}}\) & 1.774 & 1.707 & 1.789 & 0.305 & 0.299 & 0.292 \\ \(E_{\rm{ratio}}\) & 0.9635 & 0.9612 & 0.9586 & 0.0291 & 0.0275 & 0.0251 \\ \(F_{\rm{side}}\) & 0.1896 & 0.1700 & 0.190 & 0.0357 & 0.0279 & 0.033 \\ \hline \hline \end{tabular}
\end{table}
Table 3: Comparison of the first two moments of the shower shape distributions for data, the nominal and the tuned simulation. The numbers shown are rounded to one significant digit on the uncertainty.

## References

* a simulation toolkit_, Nucl. Instrum. Meth. A **506** (2003) 250 (cit. on p. 2).
* [2] ATLAS Collaboration, _Measurement of the photon identification efficiencies with the ATLAS detector using LHC Run 2 data collected in 2015 and 2016_, Eur. Phys. J. C **79** (2019) 205, arXiv: 1810.05087 [hep-ex] (cit. on pp. 2-4).
* [3] ATLAS Collaboration, _AtlFast3: the next generation of fast simulation in ATLAS_, (2021), arXiv: 2109.02551 [hep-ex] (cit. on p. 2).
* [4] ATLAS Collaboration, _The ATLAS Experiment at the CERN Large Hadron Collider_, JINST **3** (2008) S08003 (cit. on p. 2).
* [5] ATLAS Collaboration, _Performance of electron and photon triggers in ATLAS during LHC Run 2_, Eur. Phys. J. C **80** (2020) 47, arXiv: 1909.00761 [hep-ex] (cit. on p. 4).
* [6] ATLAS Collaboration, _Emulating the impact of additional proton-proton interactions in the ATLAS simulation by pre-sampling sets of inelastic Monte Carlo events_, (2021), arXiv: 2102.09495 [hep-ex] (cit. on p. 5).
* [7] R. D. Ball et al., _Parton distributions with LHC data_, Nucl. Phys. B **867** (2013) 244, arXiv: 1207.1303 [hep-ph] (cit. on p. 5).
* [8] ATLAS Collaboration, _The Pythia 8 A3 tune description of ATLAS minimum bias and inelastic measurements incorporating the Donnachie-Landshoff diffractive model_, ATL-PHYS-PUB-2016-017, 2016, url: [https://cds.cern.ch/record/2206965](https://cds.cern.ch/record/2206965) (cit. on p. 5).
* [9] ATLAS Collaboration, _Electron and photon performance measurements with the ATLAS detector using the 2015-2017 LHC proton-proton collision data_, JINST **14** (2019) P12006, arXiv: 1908.00005 [hep-ex] (cit. on p. 5).
* [10] ATLAS Collaboration, _Measurement of the inclusive isolated-photon cross section in \(pp\) collisions at \(\sqrt{s}=13\) TeV using \(36\,fb^{-1}\) of ATLAS data_, JHEP **10** (2019) 203, arXiv: 1908.02746 [hep-ex] (cit. on p. 5).
* [11] R. Sibson, _A brief description of natural neighbour interpolation_, John Wiley & Sons, 1981, chap. 2 (cit. on p. 6).
* [12] X. Bouthillier et al., _Epistimio/orion: Asynchronous Distributed Hyperparameter Optimization_, version v0.1.17, 2021, url: [https://doi.org/10.5281/zenodo.3478592](https://doi.org/10.5281/zenodo.3478592) (cit. on p. 8).