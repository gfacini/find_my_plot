# **Cosm-Muon-2005-019**

**Track-based absolute alignment in the ATLAS muon spectrometer and in the H8 test beam**

P.-F. Giraud, F. Bauer, L. Chevalier, J. Ernwein, A. Formica, C. Guyot, S. Hassani, E. Lancon, J.-F. Laporte, R. Nicolaidou, A. Ouraou, Ph. Schune

_CEA-Saclay, DAPNIA, F-91191 Gif-sur-Yvette, France_

13 October 2005

###### Abstract

Track-based alignment of chambers in the ATLAS muon spectrometer is an essential part of the alignment procedure, during commissioning (cosmics and in beam) and during physics runs. Good overall performance of the spectrometer requires a strong effort dedicated to this task. We present here a complete analysis aimed at performing track-based alignment using test beam data at the H8 facility at CERN. Alignment-dedicated tracking tools, as well as track-based alignment algorithms, are described. Results are given for several H8 runs, including an estimate of the systematic uncertainty. The systematic error is currently dominated by the lack of sensitivity to some degrees of freedom, due to special conditions of the H8 beam. Better performance is however expected during ATLAS commissioning.

[MISSING_PAGE_EMPTY:2]

rest of the optical alignment (\(\sim\) every one to two hours).

There is another chapter to the track-based alignment, involving the alignment with straight tracks that should be performed before the toroid magnetic field is turned on. The objective here is to obtain precisely the initial positions (and deformations) of every chamber in the muon spectrometer. The necessity for this straight-track alignment is two-fold:

* First, it will be needed for checking the optical alignment: incompatibilities between the straight-track alignment and the optical absolute alignment at the given reference time may be interpreted as mis-placements or bad calibrations in the alignment reconstruction program (e.g. ASAP [3]).
* Second, we would like to use such a reference geometry as the starting point for the relative alignment, which should eventually provide the best precision.

We foresee three kinds of samples for performing straight-track alignment:

* The cosmic ray sample: we may use the entire commissioning period for performing the alignment of the chambers as they are mounted. However, the tracks will be of low momentum (multiple scattering will be important), and their orientation is not favorable for the alignment of the chambers positioned vertically.
* Beam halo tracks (before pp collisions) may also be used. However, they will only be useful for aligning the end-cap chambers.
* A run with the toroid switched off, and the solenoid on, in the presence of colliding beams in the LHC. High momentum tracks may be selected using the inner detector and all chambers should be uniformly illuminated. It is essential for the alignment, and thus for the good performance of the muon spectrometer, that we record such a sample before the beginning of the physics runs.

This entire program is quite important and will require a considerable amount of work before it is operational. Today, a sample of real data is available: the H8 test beam data. Even though, as we will show, the H8 beam conditions are not completely favorable for performing track-based alignment, we nevertheless start to set up the tools and try to understand the sources of systematics. The H8 test beam setup is described extensively in [4].

We present here a complete analysis aimed at performing the alignment of the H8 barrel based on straight tracks. After presenting the global strategy, we will describe the tracking tools that we had to develop specifically for the alignment. We will show how the H8 beam conditions influence the alignment and will present results and an analysis of the systematic error.

The work described in this note was the subject of two presentations in ATLAS [5][6].

## 2 Alignment strategy

A track may be seen as a sample of hits associated together by a pattern recognition algorithm. A \(X^{2}\) function may be built for each track which will depend on track parameters, and on the spatial coordinates and orientation of the sensitive devices producing the hits:

\[X^{2}_{nuck\;i}\left(\boldsymbol{a}\,,\,\boldsymbol{p}_{i}\right)=\sum_{ hits\;j}\,X^{2}_{hit\;i\;,j}\left(\boldsymbol{a}\,,\,\boldsymbol{p}_{i}\right)\]

In the previous expression, \(i\) denotes the track index, and \(j\) the hit index of track \(i\). The vector \(\boldsymbol{a}\) represents the complete set of chamber position parameters and \(\boldsymbol{p}_{i}\) the four straight-track parameters.

[MISSING_PAGE_EMPTY:4]

The linear tracker achieves a complete track fit in 0.6 ms, i.e. it performs ~1600 track fits per second (performance obtained on a laptop).

### T0 and RT calibrator

As we will see later, the runs that are relevant for the track-based alignment are only those recorded with the hodoscope trigger, which has a timing different from the 10x10 trigger. Moreover, some of these runs were recorded at a period which was not a "muon main user period". For all these reasons, very few calibrations are available for the runs we wish to analyze. Also, we would like to minimize the possibility of a systematic effect due to calibrations between two runs by having a coherent calibration, obtained with exactly the same tools.

All these reasons have led us to develop a calibrator dedicated to alignment studies. Its use should in principle be limited to the analysis of the test beam data since there is no reason to encounter these

Figure 1: Difference of found MDT hit radius between the fast straight track fiter presented in this note and MuonBoy, evaluated with segments containing the same hits. The radii coincide within 4 \(\mu\)m.

Figure 2: Comparison of the sagitta obtained with the custom fitter and MuonBoy, using the same tracks.

particular problems during the commissioning.

The requirement for this calibrator is that it should be able to easily calibrate any of the H8 runs (some of the runs do not have the rotating BIL), and its resolution should be in the 100-150 \(\mu\)m range. This resolution is sufficient, is easy to achieve, and can be compensated by higher statistics in the alignment fit.

The calibration algorithm consists of the following steps:

* Fit of the beginning and end of the raw drift time spectra with sigmoid functions. If the statistics is such that the error is less than 2.5 \(\mu\)s, the individual tube fit is used. In the opposite case, tubes are grouped by mezzanine or by chamber until the criterion is achieved.
* The reference times of the two sigmoids are called T0 and Tmax. Raw drift time spectra are shifted and scaled using these quantities so that the beginning and end of the spectra are the same for every tube. We call the resulting time the calibrated drift time.
* A very rough RT calibration may be obtained by integration of the calibrated drift time spectrum assuming the distribution of the radii is flat. The calibrated drift time spectrum is shown in Figure 3.
* Finally pattern recognition is performed to recognize segments, and radius residuals are subtracted from the rough calibration. This step may be performed several times.

One encounters the well known problem of the angular spread of the tracks at H8 that is very small, and an ambiguity in the RT calibration cannot be resolved when using a chamber at a fixed angle with respect to the beam. However, given the precision that we would like to achieve, we can easily make the approximation that the calibration is the same for every chamber at H8 and take advantage of the particular orientation of the various chambers. With respect to the H8 beam, the BIL placed in front of the barrel (which can be rotated) is at an angle of 0\({}^{\circ}\), the barrel and large end-cap chambers are at an angle of 15\({}^{\circ}\) and the EIS at 12\({}^{\circ}\). Radius residuals subtraction is performed from one or the other of the available chamber angles. More precisely, residuals subtraction is performed in two successive steps:

* In a first pass, residuals are estimated using the data from the BIL placed in front of the barrel (the one which can be rotated). These residuals are subtracted from the first rough RT calibration.
* Using this slightly better calibration, segment fitting is redone using the data from the barrel BIL chambers. Resulting residuals are again subtracted from the RT calibration.

The resolution of the calibration is presented in Figure 4. The overall resolution, estimated on the BML chambers (which were not used for estimating the calibration), is 114 \(\mu\)m. The radius residual is presented as a function of drift time on Figure 5. A small bias is observed, at the level of 30 \(\mu\)m, and it is neglected in the rest of this analysis. This kind of bias will only degrade the overall segment resolution but is not expected to bias the alignment fit.

Figure 4: Segment radius residual, after calibration, in the BML chambers. The resolution is 114 \(\mu\)m. A small bias of 12 \(\mu\)m is observed. (BML chambers are not used in the computation of the calibration)

Figure 3: Calibrated drift time accumulated from all the valid H8 MDT tubes. The integral of this spectra is a rough RT calibration.

As a further cross-check, we also compute the radius residuals for the EIS chamber, which makes a 12\({}^{\circ}\) angle with respect to the beam. In other words, we explore a different angle from the angle used for the calibrations and check if the ambiguities are correctly resolved. This is shown in Figures 6 and 7. We observe a slightly worse resolution than for the BML (123 \(\mu\)m instead of 114 \(\mu\)m) and also a dependence with drift time at the 50 \(\mu\)m level. This quantifies the accuracy of our resolution of the ambiguities and again at a level that is acceptable for this analysis.

Figure 5: Segment radius residual as a function of drift time, for the BML2 chamber. (BML chambers are not used in the computation of the calibration)

Figure 6: Segment radius residual, after calibration, in the EIS chamber. The resolution is 123 \(\mu\)m. The angle between EIS and the beam is different from angles of chambers used to compute the calibration.

### Pattern recognition

A pattern recognition algorithm is necessary for performing the RT calibrations, and also for extracting the segments used for the alignment. In principle it is possible to use very elaborate trackers (such as MuonBoy) to perform this step. However, pattern recognition of straight tracks in the low background conditions of H8 is simple and easy to implement at the n-tuple level. Moreover, we would like to ensure that some particular configurations are present in our selection, such as segments overlapping two misaligned neighboring chambers. With a "home-made" pattern recognition, it is easy to tune for accepting such segments.

The algorithm consists of building segment candidates with individual hits and, if the candidate passes a certain cut, trying to fit a straight line through the list of hits. In case the fit does not succeed, the hit with the worse \(\chi^{2}\) is rejected and the fit it retried. The cut that is performed on the candidates consists of comparing the number of tubes associated with a segment and the number of tubes the segment candidate geometrically crosses. A fast and efficient algorithm gives this information, which is actually non-trivial to obtain. Elaborate algorithms giving this kind of information exist in the implementation of MuonBoy, however they require having a very precise knowledge of the geometry throughout the muon spectrometer which is far beyond the scope of the present study. Instead, we have chosen to implement a general algorithm capable of handling any kind of geometry:

* First, the Voronoi diagram of the 2D projections of the wires of each sector is computed (see [9] for a definition of the Voronoi diagram).
* The tubes that a segment candidate should hit correspond to the Voronoi cells intercepted by the segment (with an additional cutoff on the distance from the wire to the segment). A

Figure 7: Segment radius residual as a function of drift time, for the EIS chamber. The angle between EIS and the beam is different from angles of chambers used to compute the calibration.

[MISSING_PAGE_FAIL:10]

the hodoscope trigger. However, even when using the appropriate trigger, we are able to illuminate only a small portion of the chamber, as can be seen in Figure 11. In this Figure, we see that the beam is mainly concentrated in a small area of size approximately 10cm x 10cm. The tails of the distribution cover an area comparable to the hodoscope window, which is small compared to the size of the BOL chambers, and only slightly covers the BOL1. We expect the alignment to be acceptable in the region illuminated by the beam, however, a small error on the alignment will be propagated and amplified over a large area. We do not expect to obtain good results for the alignment away from the beam window.

Figure 10: H8 test beam layout and coordinate system. In this drawing, the origin is shifted along x.

Another desirable feature for obtaining good constraints on the alignment would be a large angular spread of the tracks. However in H8, the tracks are mainly parallel. Figure 12 shows that the angle distribution of the incoming tracks is spread by only 5 mrad. This implies that the degrees of freedom of the chamber longitudinal to the beam may not be fitted with H8 data. The fit never converges when letting these parameters free.

Figure 11: Beam intensity, as a function of chamber coordinates, seen at the BOL chambers. The black boxes represent the approximate positions and size of the BOL chambers. In this drawing, the BOL1 is on the left, BOL2 on the right, RO (read out) is top and HV bottom.

Figure 12: Absolute angle of the reconstructed tracks and the nominal beam direction.

Figure 13 illustrates the parameters that may be fitted for each H8 chamber. Out of the 6 parameters necessary for the position of a chamber, three are not fitter. The translation along the direction of the tubes (s) cannot be fitted because it is the wire direction. The translation along the axis transverse to the chamber plane (t) and the rotation around the axis orthogonal to the wires and in chamber plane (\(\theta\)z) may not be fitted, given the poor angular dispersion of the beam at H8. The translation along the precision coordinate (z), the rotation around the wire axis (\(\theta\)s), and the rotation around the axis orthogonal to the chamber plane (\(\theta\)t) are fitted. Finally, chamber deformations are completely ignored in the present study.

This procedure is only performing internal alignment, as there is no link between the chambers and a reference point in the hall; therefore some of the degrees of freedom need to be fixed. We have chosen to fix the BML2, and fit all of the other barrel chambers. The EML (providing the second coordinate, as we will show later) is not fitted either.

## 5 Data samples, selection

Four hodoscope runs are analyzed in this study and are detailed in Table 1. In order to study systematic error, it is important that the beam conditions are approximately stable from one run to the other. In particular, two of the runs were recorded with the hodoscope window moved off the beam axis. As we expect large difference in the alignment when moving the illuminated part of the chamber, we will not try to compare these runs with those where the hodoscope window is in the beam.

Figure 13: Illustration of the parameters that may be fitted for the alignment of the H8 chambers. The tube direction is \(s\).

The selection of the tracks is the following:

* Exactly one good segment in each of the chambers BIL, BML, BOL and EML
* A good segment is made up of at least (max-1) MDT hits, where (max) is 8 for the BIL, and 6 for the other chambers
* RPC information is ignored. The RPCs from tower 1 were switched off in the analyzed runs, and to avoid a difference of treatment between tower 1 and tower 2, the RPC information was not used in the analysis
* The second coordinate is provided by the end-cap EML chamber.

## 6 Results and validations

The result of the alignment fit is presented in Figure 14 in the form of differences with the geometers' survey positions. The precision of the geometers' survey is of the order of 500 \(\mu\)m. More importantly, several movements have been performed on the chambers between the time of the geometers' survey and the time of the alignment run and the chambers had been put back into position with the precision of about 1 mm. This leads to the conclusion that the observed displacements in the track-based fit are of the correct order of magnitude.

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|} \hline _Run number_ & \multicolumn{2}{|c|}{_Start and end time_} & \multicolumn{2}{|c|}{_Approximate_} & _Beam_ & _Trigger_ \\  & \multicolumn{2}{|c|}{_(GMT)_} & \multicolumn{2}{|c|}{_chamber_} & & \\  & & \multicolumn{2}{|c|}{_positions_} & & \\ \hline
600733 and 600734 & 2004-07-26 & 2004-07-26 & Nominal & Muons & Hodoscope \\  & 6:28 & 6:47 & & 250 GeV & \\ \hline
601508 & 2004-08-27 & 2004-08-27 & Nominal & Muons & Hodoscope \\  & 8:58 & 9:13 & & 180 GeV & \\ \hline
600523 & 2004-07-10 & 2004-07-10 & Nominal & Pions & Hodoscope, off \\  & 17:13 & 18:30 & & & beam axis \\ \hline
600522 & 2004-07-10 & 2004-07-10 & BIL chambers & Pions & Hodoscope, off \\  & 15:48 & 16:50 & rotated by 6 mrad & & beam axis \\  & & & around beam axis & & \\ \hline \end{tabular}
\end{table}
Table 1: Run numbers, period of recording, chamber positions, trigger and beam conditions of the samples analyzed in this study. Chamber positions are known at the mm level, and are subject to daily thermal fluctuations. Information about beam energy has been lost for runs 600523 and 600522.

Figure 14: Result of the alignment fit. The reference for the fitted parameters is taken at the survey position.

Figure 15: Sagitta of the selected tracks, with the chambers at the survey position. The muon sagitta is centered at about -350 \(\mu\)m.

[MISSING_PAGE_EMPTY:16]

Figures 17 and 18 show the sagitta of the selected tracks, as a function of the chamber coordinates seen at the BML chambers. The outcome of the alignment fit is a complete correction of the residuals.

Figure 19 shows the same kind of correction, for the run 600522, where a large displacement of the chambers has been applied. Before correction, the rotation applied to the BIL chambers around the beam axis appears as a dependence of the sagitta on the second coordinate. It is corrected by the alignment procedure.

Figure 18: Mean value of the sagitta as a function of the second coordinate seen at the BML. In blue (dark) before correction, and in red (light) after correction.

Figure 19: Mean value of the sagitta as a function of the second coordinate seen at the BML for run 600522 (large displacement of the chambers). In blue (dark) before correction, and in red (light) after correction.

[MISSING_PAGE_EMPTY:18]

the track-based alignment with the optical relative alignment.

The procedure to do this is illustrated in Figure 22. The starting point is a pair of runs, between which some movements of the chambers have been performed. Track-based alignment is performed on these two runs: let's call the corresponding alignment corrections A1 and A2. The first set of corrections A1 is then used as a reference geometry for ASAP in relative mode, which can in turn extrapolate the geometry to the period of the second run by using the response of the optical sensors only. Let's call this extrapolated alignment A'2. If every correction is perfect, then we should find that A2 and A'2 are the same. If they are not the same, then we attribute the error to the track-based alignment procedure, because we have great trust in the optical relative alignment. (Its reliability has been proved many times at the test beam.)

The procedure that we describe here may in principle not reveal a systematic defect in the alignment that would be the same in A1 and A2, whatever the random displacement of the chambers between A1 and A2. One may think of bad positioning of few wires in a chamber, or a bias in the RT calibration that would be z-dependent,... but such fine effects are beyond the scope of the present study.

The recipe for comparing two sets of alignment (A2 and A'2) consists in using triplets of virtual tags (one tag on BIL, one on BML, and one on BOL) with fixed local coordinates in the chambers, approximately aligned along a projective light ray. For a given set of alignment corrections, a sagitta may be computed from the positions of these tags. To compare two sets of corrections, for example A2 and A'2, we compare the sagitta given by these triplets of tags and they should be the same. As a standard, we define 8 triplets of tags per tower.

An example of such an estimate is shown in Figure 23, for two runs recorded at a month's interval, and for which the chambers had moved by only a few 100 \(\mu\)m. This test shows a very good result in the region of the beam. This systematic error is only slightly higher than 20 \(\mu\)m. Away from this region, the systematic error increases and large differences (more than 200 \(\mu\)m) are seen far away from the beam.

Figure 22: Illustration of the procedure to estimate the systematic error on track based alignment, using the optical alignment.

Another comparison was performed with two runs between which the chambers have moved by a large amount. In the following example, the two BIL chambers were rotated by 6 mrad around the beam direction. First, we can check that the alignment corrections A2 and A'2 are equally good at correcting the sagitta of the selected tracks. This is shown if Figures 24 and 25: the two alignments result in the same small bias on the sagitta (30 \(\mu\)m), within 7 \(\mu\)m. This means that for the degrees of freedom to which the tracks are sensitive, the precision of the alignment is of few tens of microns.

Figure 23: Difference of geometric sagitta between two runs in July and in August 2004; chambers were moved by a few 100 \(\mu\)m between these two periods.

Figure 24: Sagitta of the tracks in a run where the BIL chambers were rotated by 6 mrad around the beam direction, after track-based alignment correction. (alignment A2 in the text)

Applying the recipe of virtual projective tags, as seen in Figure 26, we now find large sagitta residuals across the entire chamber. This kind of effect is expected and, as described in section 4, H8 tracks are completely insensitive to two parameters which are left unfitted. The virtual projective rays are not parallel to the beam direction and explains why they are sensitive to these unfitted parameters. Given the beam conditions, the systematic error on the alignment is a few hundred microns in the degrees of freedom to which projective rays are sensitive.

This result is still very encouraging. Considering only the degrees of freedom to which the tracks coming from the beam are sensitive, track-based alignment is able to achieve a precision of 20 to 30 \(\mu\)m. It is not possible to fit the other degrees of freedom at H8, however, we expect the same kind of

Figure 26: Difference of geometric sagitta between two runs where the BIL chambers were rotated by 6 mrad around the beam direction.

Figure 25: Sagitta of the tracks in the same run as Figure 24. Here, track-based alignment is performed on a run where the chambers are approximately in nominal position, and ASAP in relative mode is used to extrapolate the alignment to the time of the plot. (alignment A’2 in the text)

sensitivity when using a more appropriate sample containing a large angular spread of the tracks, such as cosmic rays for example.

## 8 Conclusion

We have presented a complete analysis aimed at performing track-based alignment. Taking as input raw MDT data, we are able to perform calibrations and pattern recognition and use the resulting tracks in an alignment algorithm. A procedure is also presented for evaluating the systematic error. The systematic error in the regions of the chambers illuminated by the beam is acceptable for the degrees of freedom to which tracks parallel to the beam direction are sensitive. As expected, the systematic error is large outside this region, and for tracks with different directions. This feature is expected to vanish if we use a sample of tracks with a large angular spread.

The initial goal of this work was to explore procedures to analyze cosmic ray data during the commissioning. We conclude that this goal is reached and we expect track based alignment to be an effective way to align the muon spectrometer in conjunction with the optical alignment.

## Bibliography

[1] The ATLAS Collaboration, _The ATLAS Detector Physics Performance Technical Design Report_, CERN/LHCC 99-14, 1999

[2] _Description of the ATLAS barrel alignment system_, [http://atlas.web.cern.ch/Atlas/GROUPS/MUON/alignment/documents/Barrel_description_140301.p](http://atlas.web.cern.ch/Atlas/GROUPS/MUON/alignment/documents/Barrel_description_140301.p) df

[3] _ASAP, ATLAS Spectrometer Alignment Program_, [http://florian.home.cern.ch/florian/Asap.htm](http://florian.home.cern.ch/florian/Asap.htm)

[4] Saclay Muon Group, _Alignment of the muon chambers and results from muon reconstruction in the H8 combined test beam setup of 2004._, ATLAS note in preparation, 2005

[5] Pierre-Francois Giraud, _Track-Based Absolute Alignment at H8_, presentation at the Ringberg workshop, 2005

[6] Pierre-Francois Giraud, _Track-based alignment_, presentation at the Cetraro muon week, 2005

[7] F. James, M. Roos, _'MINUIT' A system for function minimization and analysis of the parameter errors and correlations_, Comput.Phys.Commun.10:343-367, 1975

[8] _MuonBoy, the muon reconstruction program_, ATLAS Computing Technical Proposal, 1996, CERN/LHCC 96-43

[9] _Voronoi Diagram_, [http://en.wikipedia.org/wiki/Voronoi](http://en.wikipedia.org/wiki/Voronoi)

[10] M. Virchaux, D. Pomarede, _The Persint Manual_, ATL-SOFT-2001-003, 2001