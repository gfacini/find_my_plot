**ATLAS Muon Note**

**May 16, 2003**

**Results from Tests of the**

**Muon Endcap Alignment System**

**in the H8 Beam Line 2002**

**Ch. Amelung \({}^{1}\), J. Bensinger \({}^{2}\), F. Cerutti \({}^{1}\), K. Handrich \({}^{3}\), K. Hashemi \({}^{2}\), K. Mair \({}^{1}\), S. Palestini \({}^{1}\), J. Rothberg \({}^{4}\), A. Schricker \({}^{2}\), I. Trigger \({}^{1}\)**

\({}^{1}\) _European Laboratory for Particle Physics (CERN)_

\({}^{2}\) _Brandeis University_

\({}^{3}\) _Universitat Freiburg_

\({}^{4}\) _University of Washington_

The ATLAS muon spectrometer endcap test setup assembled in the H8 beam line at CERN in 2002 consisted of six alignment bars and six MDT chambers, representing part of one octant of the endcap. These elements were equipped with a full set of alignment sensors, which were used to obtain a first appraisal of the performance of the alignment system.

###### Contents

* 1 Introduction
* 2 The Muon Alignment System
	* 2.1 Overview
	* 2.2 Optical Alignment Sensors
		* 2.2.1 The RASNIK System
		* 2.2.2 The BCAM Camera
	* 2.3 Calibration of Chambers, Bars, and Sensors
* 3 The Alignment Test Setup
	* 3.1 Overview
	* 3.2 Alignment System Layout
	* 3.3 Alignment Sensor Operation and Settings
	* 3.4 External References
* 4 The Alignment Data
* 5 Alignment Reconstruction Software
	* 5.1 General Concepts
	* 5.2 The ARAMYS Program
	* 5.3 Resolutions and Accuracies
	* 5.4 Global Alignment Reconstruction with ARAMYS
* 6 Performance of Shape Models
	* 6.1 Alignment Bar Deformations
	* 6.2 MDT Chamber Deformations
* 7 Tests of Absolute Alignment
	* 7.1 Complete Setup without Fully Calibrated Sensors
	* 7.2 Incomplete Setup with Fully Calibrated Sensors
* 8 Tests of Relative Alignment
	* 8.1 Using the Muon Simulator
		* 8.1.1 Reconstruction and Results
		* 8.1.2 Comparison to Simulation
		* 8.1.3 Quality of the Alignment Fit
	* 8.2 Initial Study of Using Muon Tracks
* 9 Summary and Outlook

Introduction

The ATLAS muon spectrometer has been designed to provide a good stand-alone momentum measurement of muons up to the highest expected energies: the transverse momentum \(p_{T}\) should be measured with a resolution of \(\Delta p_{T}/p_{T}=10\%\) at \(p_{T}=1\,\mathrm{TeV}\). The muon spectrometer consists of MDT (monitored drift tube) chambers, composed of 6-8 layers of cylindrical (30 mm diameter) aluminum drift tubes glued onto a support structure of cross plates and long beams. The MDT chambers are placed in an air-core toroidal magnetic field, which has the advantage of causing only slight multiple scattering due to the small amount of material present between chambers. The drawback of this design is the relatively low magnetic field strength that can be reached. For example, the bending of a 1 TeV muon track in the magnetic field is such that the track sagitta varies between 500 \(\upmu\)m at pseudorapidity1\(\eta=0\) (in the barrel) and 1 mm at pseudorapidity \(\eta=2\) (in the endcap). Consequently, in order to measure the momentum of a 1 TeV muon to 10%, the error on the sagitta measurement must be less than 50 \(\upmu\)m in the bending direction of the magnetic field (transverse to the MDT wires). Each track is detected in three almost equally spaced layers of chambers; thus the design MDT single-tube resolution of 80 \(\upmu\)m contributes a sagitta error of 40 \(\upmu\)m, and the additional error from the alignment of the MDT chambers must not exceed 30-40 \(\upmu\)m. As long-term stability in ATLAS cannot be guaranteed at such small scales, a continuously running alignment monitoring system has been designed which is based on optical and temperature sensors, and, in the endcap, on the so-called alignment bars, which are large precision reference rulers. The information from the alignment system is used in the offline track reconstruction to correct for the misalignment of the MDT chambers; no physical adjustments are made to the chamber positions.

Footnote 1: The pseudorapidity, \(\eta\), is defined as a function of the polar angle, \(\theta\), which is measured with respect to the beam line: \(\eta=-\ln(\tan(\theta/2))\). Consequently, \(\eta=\pm\infty\) points along the beam line, and \(\eta=0\) is transverse to it.

The ATLAS muon collaboration has installed a large-scale test setup of the muon spectrometer barrel and endcap in the H8 test beam line at CERN. The endcap part of the setup installed in 2002 consisted of six alignment bars and six MDT chambers, representing a part of one octant of the ATLAS endcap. Bars and chambers were equipped with alignment sensors, and data were taken with the alignment sensors and the MDT chambers being successfully read out. First results for the performance of the endcap alignment system are presented in this note.

## 2 The Muon Alignment System

### Overview

There are two possible strategies for making use of the data provided by an alignment system. The absolute concept is the most straightforward one: to ask that the alignment system provides sagitta corrections at any time and without using any external references. The other concept is relative: assuming that at one moment the sagitta corrections are known (e.g. from the use of straight muon tracks in special runs with the magnetic field switched off, or using muons from \(\mathrm{Z}^{0}\) decays recorded in normal running), the alignment system is used only to follow variations of the sagitta corrections from this point on.

The ATLAS muon alignment system is suitable for both concepts. It is based on optical sensors measuring the individual deformations and the relative positions of MDT chambers; temperature sensors are used to monitor their thermal expansion. While the barrel region can accommodate such a system, the endcap system requires the addition of alignment bars [1]. These are hollow aluminum tubes, up to 9.6 m long, used as precision reference rulers: as for chambers, their deformations, relative positions, and thermal expansion are monitored by optical and temperature sensors, respectively. The positions of the endcap MDT chambers are then monitored by optical sensors relative to the closest alignment bars. Both MDT chambers and alignment bars are precision objects: their shape, i.e. the position of any point on them, should be reconstructed to an accuracy of \(20\,\upmu\mathrm{m}\).

An important feature of the endcap system is factorization, meaning that it is possible to reconstruct the alignment in sequential steps without significant loss of precision. The shapes of alignment bars and MDT chambers can be reconstructed individually; after that the relative alignment of all the alignment bars in one endcap is performed, and finally the positions of pairs of chambers are determined with respect to the closest alignment bars. This dramatically reduces the required computing power, as the complexity of an alignment problem grows approximately with the third power of the number of objects to be aligned in one step.

### Optical Alignment Sensors

The optical sensors used in the endcap alignment system are RASNIKs and BCAMs, which are described below. For temperature measurements, four-wired Pt100 temperature sensors were used in the 2002 alignment test setup. As these are well-known standard equipment, they will not be discussed further here.

#### 2.2.1 The RASNIK System

The heart of the RASNIK (Red Alignment System of NIKHEF) system [2] is a mask with a chessboard-like pattern, which is illuminated by an array of infrared LEDs and projected through a lens onto a CCD. Typical CCD dimensions are of the order of mm, while the mask has a size of the order of cm. As the lens is usually placed somewhere halfway between mask and CCD, the image projected onto the CCD corresponds to only a small fraction of the mask. In order to determine from the incomplete image its location on the mask, the chessboard pattern is modified in every ninth column and row to encode coarse position information. Masks with a variety of square sizes in the range 85-340 \(\upmu\mathrm{m}\) are used. Fine position information is obtained from the large number of black/white transitions in the image.

For a symmetric RASNIK, where the lens is positioned exactly halfway between CCD and mask, position resolutions of the order of 1 \(\upmu\mathrm{m}\) have been obtained in the coordinates transverse to the optical axis (under lab conditions). Longitudinal position information comes from the measured magnification of the image, and the resolution is found to be about \(10^{-5}\) times the distance between CCD and mask. A nice feature of the RASNIK is the decoupling of dynamic range and position resolution: the dynamic range can be increased by using a larger mask, without any loss in resolution.

The CCD, lens, and mask of the RASNIK form a three-point straightness monitor (i.e. the measurement depends on the positions of three points relative to a straight line): the measured quantity is the distance of the mask center from the straight line joining the centers of the CCD and the lens. In the muon endcap alignment, RASNIK elements are glued directly onto the objects (cross plates of chambers, disks inside alignment bars) which they monitor.

A useful variation of the RASNIK is to integrate CCD and lens in a stiff tube to build a camera. This converts the three-point straightness monitor into a directional two-point monitor (i.e. the measurement depends on the positions of two points and on the orientation of one of them), or proximity sensor. In the endcap alignment, proximity sensors sit on rails with a V-shaped cross section which are glued onto MDT chambers; the corresponding masks sit on platforms with three balls which are glued onto chambers and alignment bars.

As storing the full CCD images would be uneconomical, every captured image is analyzed online and only the result is saved. Four parameters are determined by the RASNIK image analysis [3]: the horizontal and vertical coordinates of the point on the mask that is projected onto the CCD center, the magnification of the image, and its rotation angle in the CCD plane.

#### 2.2.2 The BCAM Camera

The BCAM (Boston CCD Angle Monitor) is a camera [4], consisting of a CCD and a lens, which looks at a laser diode at a distance between \(0.5\,\mathrm{m}\) and \(16\,\mathrm{m}\). The distance from CCD to lens is very close to the focal length of the lens of about \(76\,\mathrm{m}\mathrm{m}\), and the image seen by the camera is thus a blurred circular light spot. The measured quantity is the position of the centroid of this light spot on the CCD, which can be translated into a transverse angle with respect to the BCAM optical axis. Some low-precision longitudinal information can be obtained from the relative angle between the images of two laser diodes, if their separation is known. In the endcap alignment, BCAMs sit on platforms with three balls, which are glued onto alignment bars. One or two cameras and two or four laser diodes are integrated in one BCAM body. In the case of two cameras, they are arranged next to each other facing in opposite directions.

BCAMs can be used in two configurations: each BCAM of a pair is a directional two-point monitor, measuring the absolute angular position of its partner to an accuracy of \(50\,\mathrm{\SIUnitSymbolMicro rad}\). A triplet of BCAMs on a straight line is a three-point straightness monitor, each of the outer BCAMs measuring the relative angular positions of the two others with an accuracy of \(\sqrt{2}\cdot 5\,\mathrm{\SIUnitSymbolMicro rad}\). In addition, each pair of BCAMs in such a triplet also provides two-point information, and thus the BCAM three-point straightness monitor provides somewhat superior information (but not precision) to its RASNIK equivalent. The effective longitudinal precision, using the two laser diodes of a BCAM which are separated by \(16\,\mathrm{m}\mathrm{m}\), ranges from \(300\,\mathrm{\SIUnitSymbolMicro m}\) at \(0.5\,\mathrm{m}\) to \(75\,\mathrm{m}\mathrm{m}\) at \(16\,\mathrm{m}\). Both the relative and the absolute accuracy of the BCAM have been demonstrated in the lab with a prototype. The dynamic range of a BCAM is \(\pm 21\,\mathrm{mrad}\) in horizontal and \(\pm 16\,\mathrm{mrad}\) in vertical direction, given by the active area of the CCD (\(324\times 244\) pixels of \(10\times 10\,\mathrm{\SIUnitSymbolMicro m}^{2}\)).

As for RASNIKs, captured BCAM images are analyzed online. The BCAM image analysis routine [3] computes the center of gravity of the measured intensity distribution on the CCD in horizontal and vertical direction, after subtraction of a threshold value.

### Calibration of Chambers, Bars, and Sensors

The sensors and the sensor mounts on MDT chambers and alignment bars are not assembled to the precision required by their design accuracies. Instead, they are calibrated, which can be done in two different ways: either sensor mount and sensor are calibrated separately (which allows the sensor to be mounted late in the assembly process, and malfunctioning sensors to be replaced when necessary), or the sensor is glued directly onto the mount and calibrated in place.

* Sensor mounts on chambers: Rails for proximity sensors and three-ball platforms for masks on endcap chambers are calibrated during chamber production by making a series of relative measurements with uncalibrated sensors mounted on them.
* Sensor mounts on bars: The positions and orientations of the three-ball platforms for BCAMs and for proximity masks on alignment bars are measured with a coordinate-measuring machine (CMM) during bar production [5].
* RASNIK sensors: In-plane (i.e. in-chamber) and in-bar RASNIKs are calibrated by reading them out during chamber and bar production, respectively, at a moment where the shapes of chambers and bars are well known. In-bar RASNIKs are also read out for different bar deformations, in order to make precise correlations between changes of RASNIK measurements and changes of the bar shape [5]. For chambers, the RASNIK element assembly accuracy is sufficient in this respect, as smaller deformations are expected for chambers than for bars.

* BCAMs and proximity sensors: BCAM cameras and light sources, as well as proximity sensors and masks, are calibrated in dedicated setups by performing a series of measurements with them mounted on calibrated mounts [6].

Each calibration produces a set of constants characterizing a mount or a sensor. For sensors, a 'zero readout value' is usually part of this set. Calibration constants have uncertainties, which are related to the limited precision that can be achieved in the calibration procedures, and to the limited reproducibility of position and orientation of a sensor on its mount.

For the absolute alignment concept, all calibration constants need to be known. This may be regarded as a drawback, because sensor mounting accuracies and calibration parameter uncertainties typically dominate the alignment quality. For the relative concept, the sensors need not be calibrated, because an _in situ_ calibration can be performed by using external information about the positions and orientations of all objects in the setup, and taking the sensor readout values at some moment as zero reference for all further readings. This has the advantage that sensor mounting and calibration do not dominate; however, the external information must come from somewhere, and has its own uncertainties. In case such information is not available, it is still possible to make an 'educated guess' about the positions of objects in space and thus perform an _in situ_ pseudo-calibration. In this process, all absolute information is of course lost, but it is at least possible to use the alignment system to track variations of the alignment.

## 3 The Alignment Test Setup

### Overview

The 2002 endcap alignment system test setup in the H8 test beam line (Fig. 1) consisted of three pairs of large/small MDT chambers (EIL1/EIS1, EML2/EMS2, EOL3/EOS32) arranged such that they approximately represented a part of an octant of the EI (inner), EM (middle), and EO (outer) stations of the ATLAS A-side endcap. In addition, there were six alignment bars (two 2.6 m short ones in the EI station, named EI_lo and EI_up, and four 9.6 m long ones in the EM and EO stations, named EM_lo, EM_up, EO_lo, and EO_up). This is the smallest muon endcap system unit that can be aligned and used for track reconstruction. The chamber positions were chosen such that the muon beam from the SPS illuminated mainly the large chambers, traversing them at about 15\({}^{\circ}\) (\(\eta=2\)). Chambers and bars were mounted kinematically on large support structures of aluminum and steel, which were designed to be conceptually similar to the corresponding structures in ATLAS. The EI station as a whole could be moved by turning screws on its feet; the EO_lo alignment bar had a small micrometer screw under one of its mounts allowing the bar to move along its axis. The EML2 chamber was sometimes moved in an _ad hoc_ way by loosening and shifting one of its mounts.

Footnote 2: The EOS3 chamber installed in 2002 was a so-called phantom chamber, i.e. an object shaped like the real chamber and equipped with alignment sensors, but without any particle detection capability.

### Alignment System Layout

The following physical sensors3 were mounted inside or on alignment bars and MDT chambers (Figs. 2-5) in the test setup:* Temperature sensors: There were 27 Pt100 sensors measuring bar temperatures in nine roughly equally spaced positions along the long bars, and 15 sensors in five positions along the short bars. MDT chambers in ATLAS should also have temperature sensors glued onto them; some of the chambers in the H8 setup were however not equipped with those sensors, and for others it was not possible to read them out through the existing system. Chamber temperatures were therefore measured by additional Pt100 sensors attached to the outer tube surfaces. In total, 138 bar temperature sensors and 48 chamber temperature sensors were present.
* In-bar RASNIKs: Three RASNIK systems (each consisting of a CCD, a lens, and an illuminated mask) monitored deformations in each alignment bar. They were arranged as two short and one long RASNIK. In total, 18 in-bar RASNIKs were present.
* In-plane RASNIKs: Four logical RASNIK systems (consisting of two CCDs, four lenses, and two masks altogether) monitored deformations on the cross plates of each chamber. Two of them looked along the wide and the narrow sides of the chambers, respectively, the other two diagonally across. In total, 24 logical in-plane RASNIKs were present.
* BCAMs: Six BCAMs on each alignment bar monitored the relative positions of the bars. They were arranged as radial (looking along a bar), azimuthal (looking from one bar in a station to the other), and polar (looking from one station to the two others) pairs or triplets. In total, 36 physical BCAMs were present. Since each of them had two light sources, and polar BCAMs looked at two partners, this resulted in 96 logical BCAM devices.
* Proximity sensors: Two proximity sensors on each chamber looked at masks on the closest bar to monitor chamber positions relative to bars. Large chambers carried one more proximity sensor looking at a mask on the corresponding small chamber. In total, 15 proximity sensors were present.
* Saloon-door light sources: (These devices consist of a pair of the same laser diodes as used in BCAMs. Their name refers to the degree of freedom which they serve to constrain: a correlated rotation of the two chambers of a pair, like two opening swing-doors of a saloon.) The positions of two pairs of light sources on each chamber were monitored by azimuthal BCAMs (in addition to their BCAM partners). They occupied mounts originally foreseen for a second chamber-to-chamber proximity sensor and mask. In total, 20 saloon-door light sources were present; the four missing ones would have been looked at by the azimuthal BCAM on the EI_up bar, but were outside the dynamic range.

In addition, a number of virtual devices were defined for use in the alignment reconstruction program (Section 5). These were assigned values computed from the measured values of logical sensors, or from other sources (e.g. surveys of the setup). As an example, for each physical BCAM a virtual BCAM device was defined to measure the separation of the two light sources on its partner, and was assigned the difference of the measured values from the two logical BCAMs associated to the physical one. For a complete list of virtual sensors see the Appendix.

The optical and the temperature sensors were read out by separate alignment DAQ and temperature DCS computers, respectively, and the measurements were stored in ASCII format for further processing and analysis. One readout cycle through the working fraction of all 173 logical alignment devices took approximately three minutes; temperatures from 186 sensors were updated every five minutes. The sensor measurements were performed one after another, rather than all at the same moment. It was thus implicitly assumed that any significant variations would take place on a time scale longer than one readout cycle.

Of the sensors and objects in the 2002 setup, alignment bars and BCAMs were calibrated. Chambers and mounts on them had also been calibrated, but the information could not be used because the proximity sensors, masks, and saloon-door light sources mounted on chambers were uncalibrated. Consequently, tests of the absolute alignment concept were possible only as far as bars and BCAMs were concerned; for tests of the relative concept, the full alignment system including chambers was available.

### Alignment Sensor Operation and Settings

After the installation of the alignment sensors in the setup, the images taken by each optical sensor were verified 'by eye'. It was checked that they could be successfully analyzed, and that the analysis result was both reasonably stable and plausible. It was decided that the background subtraction option should be used for all sensors: two images were taken, with and without illuminating the light source, respectively, and the difference analyzed.

The exposure time for each sensor was continuously adjusted by an automatic procedure based on the most recent captured image, since both the BCAM and, to a lesser extent, the RASNIK image analysis results are affected by over-exposure and thus saturation of the CCD. For BCAMs, the adjusted exposure time was used to check if the light source was partially obscured by an obstacle (this cannot be seen as a distortion of the BCAM image itself, since the spot shape is entirely dominated by diffraction in the BCAM optics). The measured intensity is expected to decrease as the square of the distance between camera and light source, and thus the required exposure time should be proportional to the distance squared. Nearly all working devices were found to require an exposure time within 50% of a parabolic fit.

The BCAM analysis can be affected by a threshold being set too low (near the noise level) or too high (cutting away a significant fraction of the light spot peak). A threshold of 25 counts (for a maximum intensity adjusted to about 100 counts after background subtraction) was chosen from the safe region in between.

Temperatures measured by bar and chamber temperature sensors were also verified. It was checked that absolute values were compatible with the temperatures in the hall, and that neighboring sensors measured similar temperatures.

After some necessary adjustment and repair work, most of the sensors were functional. Three logical BCAM devices in EI were not usable due to a feature of the design. Some saloon-door light sources in each station were not visible to the associated azimuthal BCAMs; this situation could have been improved by further adjustments of the bars and chambers. Due to problems with the readout system, the RASNIKs in both EI bars could not be read out together with the other devices in the system, and were excluded for most of the time. In addition, 10 temperature sensors failed in bars, probably due to broken contacts. Owing to the redundancy of the alignment system, none of the non-functioning sensors was indispensable, therefore no attempt was made to debug the system further once the state presented here had been reached.

### External References

For tests of the alignment system that go beyond checks of internal consistency, external references are required. Such references provide alignment information which can be compared to the information reconstructed by the alignment system. The following references were used:* Survey: Optical surveys are performed in the classical way, using a theodolite and survey targets mounted on the objects to be surveyed. Alternatively, the method of photogrammetry can be used, which requires special targets. Alignment bars have two survey rings near the mounts, each of which can hold three survey targets of any type. MDT chambers have photogrammetry targets directly glued onto the outer surfaces of the tubes.
* Muon beam: The most straightforward references to use (and the reason for installing the test setup in a test beam area) are muons from the SPS accelerator detected in MDT chambers. In the absence of a magnetic field, reconstructed muon tracks provide to good approximation an absolute straight-line reference. A drawback of this reference are the additional uncertainties and systematic effects introduced by the track reconstruction and track-based alignment methods. In addition, data taking is limited to time periods when the muon beam is available. Tracks reconstructed in MDT chambers cannot provide a precise position measurement in the direction along the wires, which prohibits a test of the alignment in this coordinate.
* Muon simulator: A muon simulator can replace to a certain extent a muon beam as a straight-line reference. It consists of a camera with the optical axis pointing along the straight line corresponding to a hypothetical muon track, and of light sources on MDT chambers whose positions can be measured. If the mounting positions of the camera and of the light sources are not known with high precision, this device does not provide an absolute reference and can only track variations of the alignment. A muon simulator provides equally precise reference measurements in the bending direction and along the wires.

Optical surveys were performed at different times during and after the installation of the setup, mostly in order to make sure that objects were positioned in the correct locations. The muon beam from the SPS was available during the test beam period until mid-September. A muon simulator was installed after the end of the beam time.

## 4 The Alignment Data

The endcap alignment system and the endcap MDT chamber readout became available only a few days before the end of the 2002 SPS beam time in mid-September. Data from the alignment system were collected both with and without the MDT chambers being read out simultaneously, depending on the studies to be performed with the data. The following data sets were analyzed for the results presented in this note (ordered by the time when the data were taken):

* Data from chamber deformations: Each chamber was put into a rotating frame before their installation in the setup in July. The in-plane RASNIKs were read out in all four possible orientations of the chambers: wide or narrow side up (chamber placed vertically), proximity sensors up or down (chamber placed horizontally). These data are analyzed in Section 6.2.
* Data with muon beam and MDT chamber readout: Data with reconstructed muon tracks were taken for a couple of hours on September 13 and September 16, in the MDT (and alignment) DAQ runs 11242-11246 and 11250-11270. During this time, controlled movements of the EI station and the EML2 chamber were performed. These data are analyzed in Section 8.2.

* Data with optical survey: Two days after the end of the beam time, on September 18, an optical survey of the positions of the six alignment bars was performed while data were simultaneously recorded with the alignment system in alignment DAQ run 2316. These data are analyzed in Section 7.1.
* Data with muon simulator: Data with the muon simulator were taken in various time intervals during October 7-17, corresponding to alignment DAQ runs 2340-2348 and an integrated time of about 120 hours. These data are analyzed in Sections 6.1 and 8.1.
* Data without optical survey: For a test of the absolute calibration of alignment bars and BCAMs, data were taken for 24 hours on November 22-23 in alignment DAQ run 2388, when fully calibrated BCAMs were available to equip the EM station. The results from the previous optical survey were assumed to be still valid. These data are analyzed in Section 7.2.

## 5 Alignment Reconstruction Software

Alignment information was reconstructed from the alignment sensor data using the program ARAMYS ('Alignment Reconstruction and Simulation for the ATLAS Myon Spectrometer'), the documentation of which is the subject of a separate note [7]. Only the main features of the concepts and the implementation are discussed here.

### General Concepts

The basic building blocks of alignment problems are coordinate systems, characterized by six parameters for their positions and orientations in space. Points, characterized by three parameters for their positions, can be defined in any given coordinate system. A group of points defined in a common coordinate system represents a rigid body. The issue of alignment comes up once there are points defined in different coordinate systems, as then the relative positions and orientations of the coordinate systems affect the relative positions of points.4 Without loss of generality, one coordinate system may be fixed in space as the global coordinate system, turning all others into local coordinate systems.

Footnote 4: For clarification: points are _defined_ in a coordinate system, i.e. they are fixed and do not move in their system; if points do move with respect to each other, it is because they have been defined in different coordinate systems that move with respect to each other.

Alignment sensors link points defined in different local coordinate systems and provide measurements depending on their relative positions; the quantity actually measured depends on the sensor type. Each alignment sensor has a sensor coordinate system attached to one of the points it is linking, and the sensor measurement only depends on the positions of the other points in this system. The achievable precision of the alignment is limited by the intrinsic resolutions and mounting accuracies of the sensors. The concept of an alignment sensor is not limited to optical devices; for example, temperature sensors on an object with a known thermal expansion coefficient can be regarded as length sensors linking the two endpoints of the object.

The alignment, i.e. the positions and orientations of all local coordinate systems, is reconstructed by comparing measured values from the sensors to expected values for an assumed set of local coordinate system positions and orientations, and by iteratively minimizing the difference (defined as a \(\chi^{2}\) in the usual way) by variations of these assumed positions and orientations.

An additional complication emerges if the objects in question are not rigid but can mechanically deform or thermally expand. In this case, an object-shape function is introduced which, depending on one or more shape parameters, returns for the position of any point on the object a small correction representing the deformation or expansion of the object. The reconstruction of the values of the shape parameters is part of the minimization process, and is made possible by alignment sensors linking points on the same object.

### The ARAMYS Program

The program ARAMYS implements the above concepts. It has about 3000 lines of code written in C. For the \(\chi^{2}\) minimization in the alignment fit, the standard package MINUIT [8] is used. The use of MINUIT (rather than of an optimized private minimization routine, which would be faster) makes useful information accessible, e.g. about convergence and quality of the fit, and the errors and correlation matrices of all fitted parameters.

For the endcap alignment, a bar shape function [1] and a chamber shape function had to be implemented to take into account deformations and expansion of alignment bars and MDT chambers, respectively. Apart from these components, the program is not very ATLAS-specific and is in principle suitable for any alignment problem. ARAMYS reads input data from three databases in ASCII format:

* Points database: Database listing the positions of the points in the setup and the local coordinate systems they are defined in.
* Sensors database: Database listing the sensors in the setup and the points they are linking, the sensor coordinate system vectors and the sensor zero readout values. Correction values for the zero readout values may be stored in the separate corrections database, which implements the optional _in situ_ calibration of the sensors.
* Readout database: Database listing the readout values of all the sensors in the setup, which are usually provided by the alignment DAQ system.5

Footnote 5: ARAMYS can also be used to simulate the expected performance of a setup; in this case, the readout database entries are generated from the true positions and orientations of all objects, smeared by the intrinsic resolutions and mounting accuracies of the sensors. The deviations of the reconstructed from the true positions and orientations then represent the effect of the limited sensor precision, and can be used to quantify the performance of the alignment setup under study.

The outputs of ARAMYS are (after convergence of the alignment fit)

* reconstructed positions and orientations of all local coordinate systems,
* reconstructed positions of all points in the global coordinate system,
* the values of the bar and chamber shape parameters,
* expected readout values for all sensors,
* diagnostic data like global \(\chi^{2}\) and individual sensor pull values, and
* macro files (kumac) to generate drawings of the setup using PAW [9].

The output is in ASCII format and can be converted to an HBOOK [10]tuple. The quantities relevant for the track reconstruction (which, in case of the muon system, are the MDT wire positions in space) are not directly part of the alignment data in the ARAMYS output, but can be easily computed from these.

In addition, some auxiliary programs are part of the package. For example, BCAMs are mounted on three spherical balls and have been individually calibrated; the ball positions and calibration parameters must therefore be translated to a sensor position and three sensor coordinate system axes before they can be used in ARAMYS. The same applies to proximity sensors and masks, and saloon-door sources.

### Resolutions and Accuracies

Some of the important parameters of the alignment fit are the assumed intrinsic resolutions and mounting accuracies6 for the various sensor types, the quadratic sum of which enters as error into the \(\chi^{2}\) calculation (no attempt is made to account properly for correlations between sensor measurements in the \(\chi^{2}\) function). Requirements for design errors for all sensor types have been determined from simulation studies, and where possible it has been checked in the lab that the sensors comply with these requirements.

Footnote 6: The mounting accuracy is defined as reflecting the expectation value for the constant part of the error of a measurement, which is related to the individual sensor, its calibration, and its mounting; the intrinsic resolution describes the fluctuations of many repeated measurements around this constant mean.

Listed below are these design errors as they are implemented in ARAMYS. The \(\Delta\) denote mounting accuracies, the \(\delta\) intrinsic resolutions; those quantities which are not listed are assumed to be zero. All errors refer to the quantities measured by the sensors in the way they are returned by the RASNIK and BCAM reconstruction routines: for RASNIKs and proximity sensors, this is the position in mask coordinates of the point on the mask which is projected onto the center of the CCD; for BCAMs, it is the position of the light spot on the CCD.

* Temperature sensors: \(\delta T=0.1\,\mathrm{K}\), corresponding e.g. to \(\delta Z/Z=\alpha_{\mathrm{Al}}\cdot\delta T\) for an aluminum structure of length \(Z\) (where \(\alpha_{\mathrm{Al}}=22.3\,\mathrm{\SIUnitSymbolMicro m}\,\mathrm{K}^{-1}\, \mathrm{m}^{-1}\) is the thermal expansion coefficient of aluminum).
* In-plane and in-bar RASNIKs: \(\delta X=\delta Y=3\,\mathrm{\SIUnitSymbolMicro m}\); the magnification and rotation measured by in-bar and in-plane RASNIKs are not used. Digression: as an elegant way of taking into account in a simulation the design uncertainties of the bar and chamber shape functions of \(20\,\mathrm{\SIUnitSymbolMicro m}\), these can be absorbed into virtual mounting accuracies of the in-bar and in-plane RASNIKs: \(\Delta X=\Delta Y=\sqrt{6}\cdot 20\,\mathrm{\SIUnitSymbolMicro m}\), where the factor \(\sqrt{6}=\sqrt{1^{2}+2^{2}+1^{2}}\) comes from the different contributions of the three single RASNIK element mounting accuracies to the total error of the measurement (for approximately symmetric RASNIKs, the effect of a displacement of the lens on the measured value is twice the effect of a displacement of the mask or the CCD).
* BCAMs measuring the position of one light spot: \(\Delta X\,=\,\Delta Y\,=\,50\,\mathrm{\SIUnitSymbolMicro rad}\cdot f\oplus \sqrt{2}\cdot 10\,\mathrm{\SIUnitSymbolMicro m}\cdot f/d\), \(\delta X\,=\,\delta Y\,=\,5\,\mathrm{\SIUnitSymbolMicro m}\mathrm{rad}\cdot f\), where \(f\approx 76\,\mathrm{mm}\) is the lens-CCD distance of the BCAM, \(d\) the distance to the light source, and \(\oplus\) denotes the sum in quadrature.

* BCAMs measuring the separation of two light spots: \(\Delta X\,=\,\Delta Y\,=\,\sqrt{2}\cdot 10\,\upmu\mathrm{m}\cdot f/d\), \(\delta X\,=\,\delta Y\,=\,\sqrt{2}\cdot 5\,\upmu\mathrm{rad}\cdot f\). See above. These errors also apply for BCAMs looking at saloon-door light sources.
* Proximity sensors: \(\Delta X\,=\,\Delta Y\,=\,50\,\upmu\mathrm{rad}\cdot d\oplus\sqrt{2}\cdot 1 0\,\upmu\mathrm{m}\), \(\delta X\,=\,\delta Y\,=\,3\,\upmu\mathrm{m}\), \(\Delta Z\,=\,\sqrt{2}\cdot 10\,\upmu\mathrm{m}\), \(\delta Z\,=\,f/m^{2}\cdot\delta m\), where the error of the magnification \(m\) is assumed to be \(\delta m=1\cdot 10^{-4}\), \(d\) is the distance to the mask, and \(f\) is the (variable) lens-CCD distance of the proximity sensor. The rotation measured by proximity sensors is not used.
* Survey sensors: (A survey sensor is a virtual sensor which is assigned the result of an optical survey.) \(\Delta X\,=\,\Delta Y\,=\,\Delta Z\,=\,10\,\upmu\mathrm{m}\), \(\delta X\,=\,\delta Y\,=\,\delta Z\,=\,300\,\upmu\mathrm{m}\).

In normal running of ARAMYS, both intrinsic resolutions and mounting accuracies are taken into account in the minimization process (i.e. the absolute alignment concept is assumed). There is a second reconstruction mode (for the relative concept), in which all sensors are assumed to have been calibrated _in situ_, by regarding the readout values at some moment as the zero reference for all further measurements; in this case, only intrinsic resolutions (scaled by a factor of \(\sqrt{2}\)) are used in the minimization, and the \(\chi^{2}\) function is modified accordingly.

The expected performance of the alignment system test setup (Fig. 6), expressed as average width of the false sagitta distribution in the bending direction, has been obtained from an ARAMYS simulation based on the implemented design errors both for the absolute (Fig. 7) and the relative (Fig. 8) alignment concept. For the absolute concept, the false sagittas have an r.m.s. width of about \(38\,\upmu\mathrm{m}\) on average (\(48\,\upmu\mathrm{m}\) maximum); for the relative concept, they have \(17\,\upmu\mathrm{m}\) on average (\(23\,\upmu\mathrm{m}\) maximum), illustrating how mounting accuracies dominate in the absolute concept. Eventually, however, the sagitta error of any external information (e.g. track-based alignment) used for the _in situ_ calibration of the sensors would have to be added to the error for the relative concept.

### Global Alignment Reconstruction with ARAMYS

The alignment was reconstructed from the sensor readout in factorizable units, starting with the shapes of individual bars and chambers, followed by the positions and orientations of all bars, and finally the positions and orientations of large/small chamber pairs in each station. At each step, contributions from individual sensors to the total \(\chi^{2}\) of the alignment reconstruction fit were checked, which served to identify a small number of outliers. These were in rare cases due to hardware problems (readout, cabling, sensor mounting), and the sensors were then either repaired or excluded from the fit. Most outliers, however, were due to mistakes in the databases, which were corrected. It was also checked that the absolute values of fitted positions and shape parameters were compatible with expectations. One run of ARAMYS, i.e. the alignment reconstruction based on one sensor readout cycle, took between 30 and 90 seconds on a standard Linux PC (\(1.8\,\mathrm{GHz}\), Pentium 4), depending on the analysis mode.

Performance of Shape Models

The shape models describing deformations and expansion of chambers and bars which are implemented in the bar and chamber shape functions are a critical part of the alignment reconstruction. The first step in the analysis is thus to test these models.

### Alignment Bar Deformations

Alignment bars are calibrated in the horizontal position on a CMM. At this time, they are equipped with temperature sensors and RASNIKs; however, BCAMs, proximity masks and cables are mounted only after installing the bars in their final location, and deform the bars along the direction of gravity. In addition, only three bars in the H8 setup are approximately horizontal; the other three are inclined by about \(45^{\circ}\), and thus deform because the component of gravity transverse to the bar axis is decreased (in ATLAS, all alignment bars are inclined, by angles between \(14^{\circ}\) and \(76^{\circ}\) with respect to the horizontal direction).

The in-bar RASNIKs monitor the bar deformation at five points. In between these points, a two-step interpolation is performed [1]. In the first step, the effect of all known forces acting on the bar (BCAM and mask weights, inclination of bars) is computed and compared to the RASNIK measurements. The difference between computed and measured RASNIK values is used in the second step to determine three effective forces assumed to be acting on the bar in addition to the known ones (Fig. 9); alternatively, three continuous force distributions could be assumed. The effective forces absorb everything that was not accounted for in the first step, like neglected forces (weights of cables), and uncertainties of parameters (weight of the bar tube and the in-bar instrumentation, Young's modulus and geometrical moment of inertia of the tube). The quality of the interpolation depends on the effective forces being small, as a systematic error is made in absorbing all unaccounted-for effects into them. This error must not exceed the required uncertainty of the bar shape of \(20\,\upmu\)m, and consequently, the bar shape predicted in the first interpolation step should be as accurate as possible.

The quality of the bar shape prediction has been studied with the four long alignment bars in the setup. In Figs. 11 and 12, the computed and the observed bar shapes are compared; this comparison is strictly valid only in the five points where RASNIK elements are placed, in between them an approximate interpolation is shown for illustration. It is found that for all bars the computed shape agrees with the observed one to better than \(200\,\upmu\)m r.m.s.7 Consequently, in order to obtain the real bar shape to better than \(20\,\upmu\)m, the error of the interpolation procedure must not exceed \(10\%\).

Footnote 7: Excluding the worst offender (the EM_up bar, which is somewhat special because it is rotated by \(180^{\circ}\) in the setup relative to the position during calibration, and because an extra weight of some kg is attached to it), computed and observed deformation agree even better, on average to \(120\,\upmu\)m r.m.s. in the direction of gravity, and to \(20\,\upmu\)m r.m.s. transverse to it.

This can not be directly checked in the test setup, as it requires measurements of the bar shape in other points than those monitored by the RASNIKs; it has instead been verified using CMM measurements of alignment bar deformations in the horizontal position [1], where the magnitude of these deformations was typically larger than the deformations observed in the setup. An indirect check can however be performed using the test setup, with measurements from BCAMs mounted on the bars; this is the subject of Section 7.

Short alignment bars are found to deform significantly less than long bars, by 1-2 orders of magnitude. Their total deformations stay below \(30\,\upmu\)m, so these bars could nearly be regarded as rigid bodies (except for thermal expansion). Consequently, the RASNIKs monitoring the bars are dispensable for the purpose of measuring deformations; their main purpose is rather to ensure that the bars are not accidentally exposed to large unnoticed forces.

A surprising observation made in the course of this study is temperature-related shape variation of the long alignment bars (Figs. 11 and 12). Bars should not deform while thermally expanding, because the bar mounts are designed such that their positions along the bar (expressed as fractions of the varying bar length) do not change, and the effect of longer bars sagging more under their own weight is negligible (0.2 \(\upmu\)m for a temperature change of 1\({}^{\circ}\)C). It turns out that the variations are correlated to the derivative of temperature with time: the bars deform more when expanding faster, and the sign of the deformation is different for increasing and decreasing temperatures.

This suggests that friction in the sliding bar mount is responsible for the effect, i.e. that during thermal expansion the movement of the bar in the mount8 is not completely free due to longitudinal forces acting on it below its center. Apart from being an interesting effect, the magnitude and speed of the variations of less than 50 \(\upmu\)m over many hours are too small to affect the performance of the alignment system; still an attempt was made to reduce friction in the final ATLAS version of the sliding mount by a modification of the surface treatment.

Footnote 8: An aluminum bar of 9.6 m length expands by 214 \(\upmu\)m for a temperature change of 1\({}^{\circ}\)C. If the temperature changes by 5\({}^{\circ}\)C in 12 hours, this results in an expansion speed of some hundred atomic layers per second.

### MDT Chamber Deformations

The four coupled in-plane RASNIKs (sharing two CCDs and two masks between them) monitor the chamber deformation at two points on each of the outer cross plates and three points on the central cross plate. As for bars, an interpolation is performed between these points; however, since deformations are expected to be small for endcap chambers due to gravity acting nearly in the chamber plane, a less powerful interpolation procedure may be sufficient. As a first approach, simple linear and quadratic interpolations are used, and cross plates are assumed to be rigid (except for thermal expansion, and gravitational sag for chambers placed horizontally).

Chamber deformations and thermal expansion are described using the following parameter set (Fig. 10; the coordinate system is the usual chamber coordinate system [11], where \(X\) points along the long beams, \(Y\) out of plane, and \(Z\) along the central cross plate, and the origin lies in the narrow-side endpoint of the central cross plate; the mask-side, central, and CCD-side cross plates are denoted by CPM, CPL, and CPC, respectively):

* thermal expansion of the chamber (global, and temperature differences between the central and each of the two outer cross plates): three parameters (\(T_{\rm{CPL}}\), \(\Delta T_{\rm{CPC}}\), \(\Delta T_{\rm{CPM}}\)),
* shifts of the central cross plate in \(Y\) and \(Z\) (treated, equivalently, as common shifts of the two outer cross plates): two parameters (\(Y_{\rm{CPL}}\), \(Z_{\rm{CPL}}\)),
* individual rotations of the two outer cross plates around \(X\) (out of plane, i.e. twist of the chamber) and around \(Y\) (in plane): four parameters (\(\Theta_{\rm{CPC}}\), \(\Theta_{\rm{CPM}}\), \(\Phi_{\rm{CPC}}\), \(\Phi_{\rm{CPM}}\)), and
* common sag of all cross plates in \(Y\) (only applied when chambers are placed horizontally): one parameter (\(Y_{\rm{sag}}\)).

Using the \(X\) and \(Y\) measurements provided by the four in-plane RASNIKs,9 and temperature measurements at each of the cross plates, there are 11 measurements to determine 9 (10 in the case of horizontally placed chambers) parameters, i.e. the system is overdetermined. This can be exploited to check if the above parameter set provides a valid description of the behavior of real chambers, by deforming chambers in a controlled way, fitting their shape using the RASNIK measurements, and looking at the \(\chi^{2}\) of the fit, which, in this case, reduces effectively to making a prediction for one RASNIK measurement from the three others.

The two largest chambers present in the test setup (EOL3 and EML2) were used for this study, as the largest deformations are expected for them. Before their installation, they were put into a rotating frame (held by four axial mounts, i.e. not kinematically mounted), and the RASNIKs were read out in all four possible orientations of the chambers: wide or narrow side up (chamber placed vertically), proximity sensors up or down (chamber placed horizontally). By analyzing differences between RASNIK measurements from the two first and the two last orientations, respectively, the effect of gravity, multiplied by two, acting in the chamber plane (as in the ATLAS endcap) and transverse to it (as in the ATLAS barrel) could be isolated.

Thermal expansion was assumed to be negligible because the measurements were performed within less than 15 minutes. The first set of data was fitted with 6 parameters for 8 measurements, the second set with 7 parameters. The resulting deformations are shown in Figs. 13 and 14, and the \(\chi^{2}/\mathrm{ndf}\) of all fits was found to be reasonable, i.e. below or around unity. The fitted deformation parameters and the deformations described by them agree well qualitatively with expectations: for chambers placed horizontally, the most significant effect is a sag of the chambers in the \(Y\) direction, i.e. a shift of the central cross plate in \(Y\) with respect to the outer cross plates; for chambers placed vertically, the central cross plate shifts in the \(Z\) direction, and the outer cross plates rotate slightly in the chamber plane. A twist of varying magnitude which could be ascribed to the non-kinematic mounting is superimposed on all deformations.

These results suggest that the model of chamber deformations used here can describe the relative positions and orientations of the cross plates, assuming that they are rigid. The data show no evidence for deformations of the cross plates, but it should be noted that not all deformation modes can be seen by the RASNIKs. Whether the interpolation between the cross plates is good enough depends on the absolute magnitude of the deformation. The vertical measurements presented here show a maximum deformation due to gravity of about \(300\,\upmu\mathrm{m}/2=150\,\upmu\mathrm{m}\), and r.m.s. deformations below \(100\,\upmu\mathrm{m}/2=50\,\upmu\mathrm{m}\). As the chamber shape should be known to \(20\,\upmu\mathrm{m}\), the interpolation procedure must be better than 40% for these chambers. This condition is likely to be met even by a very simple interpolation method. A test of the chamber shape function under realistic conditions, i.e. for chambers installed in the test setup, requires calibrated proximity sensors and saloon-door sources, and is anticipated for 2003. This will also help to show if a more complex description is necessary, possibly including cross plate deformations.

Unlike for alignment bars, deformations of chambers were not significantly correlated to temperature or the derivative of temperature. The variations of \(Y_{\mathrm{CPL}}\), \(Z_{\mathrm{CPL}}\), \(\Theta_{\mathrm{CPC}}\), \(\Theta_{\mathrm{CPM}}\), \(\Phi_{\mathrm{CPC}}\), and \(\Phi_{\mathrm{CPM}}\) for temperature changes up to \(5^{\circ}\mathrm{C}\) were found to be negligibly small (below \(5\,\upmu\mathrm{m}\) and \(5\,\upmu\mathrm{rad}\), respectively).

Note that the chamber deformations studied here are deformations of the MDT tubes; for track reconstruction, however, the positions of MDT wires in space are relevant. These can be determined from the positions of the tube endpoints; some of the deformation parameters actually do not affect them and are thus irrelevant for track reconstruction (though not for alignment reconstruction).

## 7 Tests of Absolute Alignment

A test of the absolute alignment requires an external reference with sufficient absolute precision, to which the object positions determined by the alignment system can be compared. Here, an optical survey with an accuracy of \(300\,\upmu\mathrm{m}\) in each coordinate has been chosen as a reference.

A comparison to this is not an exhaustive check of the alignment system performance, as the survey precision is about one order of magnitude worse than the precision of the alignment system for relative positions along polar lines; however, the survey precision is comparable to that of the alignment system for absolute positions. Therefore, it does represent a powerful test of the alignment system in the absolute concept. All objects and sensors used in the test have to be calibrated; as no calibrated proximity sensors and saloon-door sources were available, the scope of the test was limited to the system of alignment bars and BCAMs.

### Complete Setup without Fully Calibrated Sensors

An optical survey of the alignment bars [12] was performed on September 18, and alignment data were taken in parallel in alignment DAQ run 2316. Alignment bars have two survey rings near the mounts, each of which can hold three survey targets; on average, about two targets per ring could be both installed and seen by the surveyors.

For the alignment reconstruction, the alignment bars were constrained to the locations determined in the optical survey by making use of the survey sensor type implemented in ARAMYS. In this way, for large objects like alignment bars with more targets measured than required to determine the position, the best fit of the location in space is obtained; in addition, the internal consistency of the survey data can be verified, which was found to be well within the specified survey precision of \(300\,\mathrm{\SIUnitSymbolMicro m}\).

After this check, a combined alignment fit was performed taking into account the in-bar RASNIK and temperature sensor readings, the BCAM measurements and the survey sensors. The internal consistency of all the sensor measurements in this fit, assuming their design intrinsic resolutions and mounting accuracies, was taken as a measure of the compatibility of the alignment system with the optical survey, and of how well the sensors complied with their specifications. To illustrate the result, pull values were extracted for BCAMs and survey sensors after convergence of the fit (i.e. assuming the design errors as listed in Section 5.3), separately for three classes of BCAM measurements:

* BCAM measuring the absolute position of one light source on its partner,
* BCAM measuring the separation between the two light sources on its partner, and
* polar BCAM measuring the separation between two light sources on its two partners.

In this procedure, RASNIK and temperature sensor measurements were implicitly assumed to be perfect, so any errors of these devices were thus absorbed into those of the BCAMs and the survey sensors.

At the time of performing this experiment, only a set of partially calibrated BCAMs was available: the optical axis of some BCAMs was known only to an uncertainty of about 2-3 times the design value, and for some BCAMs the calibration parameters were not known at all (these were left out of the alignment fit). A problem of the same magnitude (but different origin) also affected the calibration of four of the six alignment bars. Both the bars and the BCAMs were therefore re-calibrated after the data-taking period.

The resulting BCAM pull distributions are shown in Fig. 15, where they are compared to the corresponding distributions as expected from simulations; this is in order to verify that correlations between sensors have no significant impact on the pull distributions, and to take properly into account the effect of the constraints imposed by the survey sensors. For absolute BCAM measurements, the obtained pull distributions from the setup are, as expected, centered around zero, but exhibit a width significantly larger than unity. This is caused by the problem with the calibration of the optical axis, which to first order affects only absolute measurements. The two classes of relative BCAM measurements also have approximately zero mean; they do not show too wide pull distributions, and are in agreement with the expected width at the level of 10-20%, which is acceptable given the limited number of sensors in the setup. Pull distributions for survey sensors are also found to agree with expectations (not shown).

### Incomplete Setup with Fully Calibrated Sensors

In order to investigate further the problem ascribed to the partial calibration of the BCAMs, the above test was repeated later for the EM station, when fully calibrated BCAMs became available and were installed on the two EM alignment bars. The calibration of the EM bars was known to be reliable at that time; EO and EI bars had been removed from the setup for re-calibration and could therefore not be included.

Data for the test were taken for 24 hours on November 22-23 (alignment DAQ run 2388). No update of the survey was performed, so the data from the the previous one [12] were used, which were about two months old. It was thus assumed, without being justified _a priori_, that the alignment bars had not (or had only coherently) moved within the precision of the survey; only from the result of the data analysis it was found _a posteriori_ that the survey data were indeed compatible with the alignment sensor measurements.

Exactly the same procedure as above was followed, and the same result plots as before (restricted to the EM station) were generated, which are shown in Fig. 16. A dedicated simulation of the EM station setup was also performed to account for possible differences in correlations between sensor measurements with respect to the complete setup.

In agreement with what had been found already in the analysis of the complete setup, pull distributions for relative BCAM measurements meet the expectation of zero mean and unit width. In addition, the new pull distributions for absolute measurements are also acceptable. This shows that the system of alignment bars and BCAMs works according to specifications, and represents a successful test of the alignment system in the absolute concept as far as bars and BCAMs are concerned. In addition it also shows that the assumed design resolutions and accuracies are realistic, and do not significantly overestimate the real errors of the devices.

## 8 Tests of Relative Alignment

A test of the relative alignment requires an external reference which need not provide an absolute value (as only variations of the alignment have to be monitored), but which must have a higher precision than an optical survey. The alignment sensors do not need to be calibrated, because an _in situ_ calibration can be performed by making an assumption about the positions and orientations of all objects in the setup, and using the sensor readout values at some moment as zero-reference for all further readings. Provided that the assumed positions and orientations are reasonably close to reality (at the level of cm), variations of the alignment can then be tracked with the full relative precision of the alignment system; any absolute precision is of course lost.

### Using the Muon Simulator

One possibility for implementing a precise external reference is a muon simulator. This device consists of a camera with the optical axis pointing along the straight line corresponding to a hypothetical muon track, and of light sources on MDT chambers whose positions can be measured. A muon simulator was installed in the endcap test setup after the end of the beam time in September. Due to space constraints from the neighboring barrel setup, the camera could not be placed at the virtual interaction point, but rather had to be shifted toward EI by about 5 m (Fig. 2). For simplicity it was decided to use BCAMs for the camera as well as for light sources, while a technology'more different' from that used in the alignment system itself might have been more desirable. The BCAM camera was placed on a concrete block, and the BCAM light sources were mounted on extension plates attached to the central cross plates of the large chambers, thus modeling a straight muon track that just missed the chambers by 10-20 cm.

#### 8.1.1 Reconstruction and Results

Data with the muon simulator were taken for an integrated time of about 120 hours. During this time, the MDT chambers moved due to temperature variations by up to 800 \(\upmu\)m and rotated by up to 200 \(\upmu\)rad, as shown in Fig. 17. The corresponding sagitta variations happened to be mostly limited to the bending direction. They were reconstructed from the muon simulator data using the observed movements of the light spots and taking into account the different distances between camera and chambers. These variations were then compared to those reconstructed using the full alignment system, after having performed the _in situ_ calibration of all sensors, and using only intrinsic resolutions in the computation of \(\chi^{2}\). The result of this comparison is shown in Fig. 19, separately for the bending direction (which is the critical coordinate for the alignment system performance) and the wire direction (which is less relevant). The target precisions for these two coordinates are 40 \(\upmu\)m and 250 \(\upmu\)m, respectively; these targets include, however, contributions from mounting accuracies which are by construction zero here.

The intrinsic resolution of the muon simulator measurement is estimated from data, by comparing results obtained using one or the other light source on each chamber, and is found to be 15 \(\upmu\)m in the bending direction, and 34 \(\upmu\)m in the wire direction. It is unclear why the data suggest the error to be significantly smaller in the bending direction. As the bending direction is nearly horizontal (inclined by 14\({}^{\circ}\)), and the wire direction nearly vertical, thermal gradients and/or air turbulence might be responsible for this. Vibrations of the extension plates supporting the muon simulator light sources would also affect predominantly the wire direction.

The width of the sagitta difference distribution in the bending direction is found to be 22 \(\upmu\)m, with a considerable contribution of 15 \(\upmu\)m from the muon simulator. After subtracting in quadrature the muon simulator error, the error of the alignment system is about 16 \(\upmu\)m, thus safely below the specification and leaving ample room for the contribution from mounting accuracies. Similarly, the width of the difference distribution in the wire direction is found to be about 58-66 \(\upmu\)m (it is not understood what causes the non-Gaussian tail of the distribution, and whether this is suggestive of a systematic problem); here, the muon simulator error of 34 \(\upmu\)m contributes less to the total error, and after its subtraction the error of the alignment system is found to be about 47-57 \(\upmu\)m, again safely below the specification and leaving enough room for the contribution from mounting accuracies.

#### 8.1.2 Comparison to Simulation

These results can be compared to a simulation of the same setup, including the simulation of the muon simulator (Fig. 20). The simulated muon simulator error is set 'by hand' to the magnitude determined from data, and the simulation results are found to be in good agreement with data (again at the level of 10-20%): subtracting the muon simulator error from the total width, a precision of the alignment system of about 17 \(\upmu\)m (data: 16 \(\upmu\)m) in the bending direction and about 47 \(\upmu\)m (data: 47-57 \(\upmu\)m) in the wire direction is predicted by the simulation. To cross-check the method of subtracting the muon simulator error from the total width, the alignment precision of 17 \(\upmu\)m obtained here can be compared to the one directly predicted by the simulation (Fig. 8), which (for the position of the muon simulator light sources) is about 16-18 \(\upmu\)m, and thus fully consistent.

A significant difference between measured and simulated data is however observed in the time evolution of the sagitta difference: while in data this is a relatively narrow band, the center of which slowly varies on a scale of many hours, the simulation expects a wider band which,by construction, exhibits no long-term variations (in the simulation many identical setups are reconstructed, so that a time axis is not even defined).

This difference is due to a misunderstanding about the character of intrinsic resolutions and mounting accuracies, and the separation between the two. In an ideal world, the intrinsic resolution would be a purely statistical error associated with a single measurement, while the mounting accuracy would be purely systematic and associated to a device: many repeated measurements using the same device would all share the common systematic error and would scatter randomly around a mean value according to the statistical error. Therefore the intrinsic resolution could be determined as the scattering width of the short-term fluctuations. In the case of the relative alignment concept as tested here, where mounting accuracies do not contribute at all, the only errors present would be statistical ones.

In reality, however, the intrinsic resolution has a systematic component (as an example, the BCAM image analysis algorithm which computes the center of gravity of a digitized intensity distribution has a small position-dependent bias which is periodic over the width of one pixel of the CCD). Consequently, as object positions vary only slowly with time, sensor measurements do so too (a BCAM light spot typically remains centered on the same CCD pixel for hours), and their short-term fluctuations only represent the statistical component of the intrinsic resolution. Determining the intrinsic resolutions from the scattering width of the short-term fluctuations would therefore lead to an underestimation of the intrinsic resolution.

As the simulation implements design intrinsic resolutions, which have been determined from methods that take the systematic contribution into account properly, it creates the misleading impression that the short-term fluctuations are overestimated, while in fact they cannot be directly compared to intrinsic resolutions.

#### 8.1.3 Quality of the Alignment Fit

As a check of consistency, the variations with time of the total \(\chi^{2}\) of the fit and the contributions to it originating from the four steps in the alignment reconstruction (fits of bar and chamber shapes, and of bar and chamber positions and orientations) were checked. The contribution from bar shapes is zero by construction, because the numbers of fitted and measured parameters are equal. The contribution from chamber shapes is small. The remaining contributions, from fitting bar and chamber positions and orientations, are shown in Fig. 18. As can be seen, the \(\chi^{2}\) is systematically smaller than the expectation of \(\chi^{2}/\mathrm{ndf}=1\); it varies in cycles of about one day duration, and is correlated to temperature. Its minimum lies around \(22^{\circ}\mathrm{C}\), which was the temperature at the moment where the _in situ_ calibration was performed. From this point it rises both for increasing and decreasing temperatures. There seems to be an indication of saturation at the expected level of \(\chi^{2}/\mathrm{ndf}=1\) for temperature differences of more than \(2^{\circ}\mathrm{C}\) from the minimum; clearly additional data would be desirable to verify this point.

This observation can again be ascribed to the issue of intrinsic resolutions mentioned above. For temperatures near the one assumed in the _in situ_ calibration, chambers and bars are near their initial positions; therefore the systematic component of the intrinsic resolution is (too) small, which leads to an overestimation of the intrinsic resolution and a \(\chi^{2}\) value smaller than expected. As observed in the data, the effect should decrease as chambers and bars move away from their initial positions, and disappear completely once all sensor readings have changed by more than \(1\sigma\) of their intrinsic resolution.

### Initial Study of Using Muon Tracks

Another possibility for choosing an external reference to measure chamber sagittas is to use a beam of real muons detected in MDT chambers, which, in the absence of a magnetic field, provides to a good accuracy a straight line (limited by multiple scattering of muons in the chamber material and in air). The obvious advantage of this choice is that it also provides an absolute reference. The drawbacks are the absence of a reference measurement along the wire direction, and the additional uncertainties and systematic effects introduced by the track reconstruction and track-based alignment methods.

For this test, data with the muon beam from the SPS and the MDT chambers being read out were taken for a couple of hours on September 13 and on September 16, in the MDT (and alignment) DAQ runs 11242-11246 and 11250-11270. During this time, controlled movements of the EI station and the EML2 chamber were performed.

As a complication, the chamber-temperature readout computer was not running normally, and temperature measurements from chambers were not recorded. For the analysis, fake temperature measurements were generated from the temperatures of the neighboring bars; it was checked by applying the same procedure to the muon simulator data analyzed in the previous section that the resulting sagitta accuracy degrades only negligibly (1-2 \(\upmu\)m in the bending direction, 10-20 \(\upmu\)m along the wires).

Another complication is related to the controlled movement of the EML2 chamber (by about 3 mm). For such macroscopic movements, the _in situ_ calibration is pushed beyond its limits, as it can no longer fully compensate for the missing sensor calibration data. This chiefly affects proximity sensors: as the directions of the RASNIK \(X\) and \(Y\) axes are linked to the orientation of the mask (which for uncalibrated masks is only known within the assembly accuracy of about 20 mrad), a movement of e.g. 3 mm in the \(X\) direction causes an uncertainty of the \(Y\) position of 60 \(\upmu\)m (to be compared to the design intrinsic resolution of 3 \(\upmu\)m for the proximity sensor). As a result, the alignment fit converges with an unacceptably large \(\chi^{2}\); to avoid this, an additional class of errors is implemented in ARAMYS: errors proportional to the difference between actual sensor readings and the zero readout values from the _in situ_ calibration.

After this, the fit converges with an almost reasonable \(\chi^{2}\): one of the two proximity sensors connecting the EML2 chamber to the EM_lo alignment bar disagrees with all the other sensors about the distance between chamber and bar along the wire direction. After elimination of this sensor from the fit, the \(\chi^{2}\) becomes acceptable; the sagitta in the bending direction is affected only negligibly by this last problem.

The reconstruction of muon tracks in MDT chambers and their use to determine the alignment of the chambers, as well as the comparison between the variations of chamber alignment reconstructed using muon tracks and the alignment system is the subject of a separate note [13]; the purpose of this section was to document the part of the study exclusively related to the alignment system.

## 9 Summary and Outlook

The setup for the test of the endcap MDT alignment system in the H8 test beam line at CERN was completed in 2002 in the sense that all sensors foreseen were present; it was incomplete in the sense that not all sensors were calibrated. A number of relevant tests have already been performed and have produced satisfactory results. It has been shown that the calibration methods for alignment bars and BCAMs are valid, and that these devices fulfill their specifications of 20 \(\upmu\)m error on the bar shape, and of 50 \(\upmu\)rad and \(\sqrt{2}\cdot 5\) \(\upmu\)rad for absolute and relative BCAM measurements, respectively. The observed errors typically agree with specifications at the level of 10-20%. For the alignment system as a whole, it has been demonstrated that it can follow sagitta variations caused by relative movements of the chambers with a precision of 16 \(\upmu\)m in the bending direction, in good agreement with the expected accuracy of 17 \(\upmu\)m for the relative alignment mode.

For the year 2003, the calibration of the sensors that were not calibrated in 2002 is expected, so that the most significant check of the alignment system can be performed: the test of the absolute alignment with alignment bars and chambers; this will include testing the chamber shape function under realistic conditions. In addition, it is planned to install an improved muon simulator with a higher precision than the one used in 2002, and significantly more data with muon tracks are expected, so that the studies presented here can be repeated and extended.

## Acknowledgments

The results presented in this note could not have been obtained without the work of many colleagues not listed as authors, and their contributions are gratefully acknowledged. We would like to express our thanks explicitly to Th. Alexopoulos, P. Oikonomou, and Y. Tsipolitis (NTU Athens) who set up the alignment bar temperature readout system, to J. Tobias (Freiburg University) who performed the CMM measurements for the alignment bar calibration, and to the many people who contributed to the big effort of getting the endcap chamber readout to work just in time. We would also like to thank D. Loveless (University of Wisconsin) for the loan of the CMS chamber installation tool. The installation of chambers and alignment bars and most of the setup in the beam line would have been nearly impossible without the dedicated and efficient work of W. Andreazza (CERN).

## References

* [1] A. Schricker, The Alignment System of the ATLAS Muon Endcap Spectrometer, Ph.D. thesis, Vienna University of Technology (2002). [http://atlas.web.cern.ch/Atlas/documentation/thesis/schricker/thesis.pdf](http://atlas.web.cern.ch/Atlas/documentation/thesis/schricker/thesis.pdf)
* [2] H. Dekker et al., The RASNIK/CCD 3-Dimensional Alignment System, Proceedings of the Third International Workshop on Accelerator Alignment, CERN, Geneva (1993). [http://www.nikhef.nl/pub/departments/et/experiments/atlas/rasnik/index.html](http://www.nikhef.nl/pub/departments/et/experiments/atlas/rasnik/index.html)
* [3] K. Hashemi, Brandeis Image Analysis Libraries, ATLAS note ATL-MUON-99-011. [http://alignment.hep.brandeis.edu/ATLAS/Reports/index.html](http://alignment.hep.brandeis.edu/ATLAS/Reports/index.html)
* [4] K. Hashemi and J. Bensinger, The BCAM Camera, ATLAS note ATL-MUON-2000-024. [http://alignment.hep.brandeis.edu/ATLAS/Reports/index.html](http://alignment.hep.brandeis.edu/ATLAS/Reports/index.html)
* [5] Ch. Amelung and A. Schricker, Calibration of Alignment Bars for the ATLAS Muon Spectrometer Endcap, ATLAS internal note ATL-MUON-COM-2002-14. [http://axl.home.cern.ch/axl/](http://axl.home.cern.ch/axl/)
* [6] D. Daniels, K. Hashemi and J. Bensinger, BCAM Calibration, ATLAS note ATL-MUON-2000-026. [http://alignment.hep.brandeis.edu/ATLAS/Reports/index.html](http://alignment.hep.brandeis.edu/ATLAS/Reports/index.html)
* [7] Ch. Amelung, The ARAMYS Software Package, ATLAS Note in preparation. [http://amelung.home.cern.ch/amelung/aramys.html](http://amelung.home.cern.ch/amelung/aramys.html)
* [8] F. James and M. Roos, Comp. Phys. Comm. **10** (1975) 343; MINUIT Reference Manual. [http://wwwinfo.cern.ch/asdoc/minuit/minmain.html](http://wwwinfo.cern.ch/asdoc/minuit/minmain.html)
* [9] PAW Reference Manual. [http://wwwinfo.cern.ch/asd/paw/index.html](http://wwwinfo.cern.ch/asd/paw/index.html)
* [10] HBOOK Reference Manual. [http://wwwinfo.cern.ch/asdoc/hbook/HBOOKMAIN.html](http://wwwinfo.cern.ch/asdoc/hbook/HBOOKMAIN.html)
* [11] ATLAS Muon Collaboration, ATLAS Muon Spectrometer Technical Design Report, CERN/LHCC/97-22. [http://atlas.web.cern.ch/Atlas/GROUPS/MUON/TDR/Web/TDR.html](http://atlas.web.cern.ch/Atlas/GROUPS/MUON/TDR/Web/TDR.html)
* [12] J.-F. Fuchs and J.-N. Joux, Mesure de la position des points des bagues sur les barres inferieures et superieures, structure EO-EM-EI, CERN EDMS document 356108. [http://edms.cern.ch/document/356108/2](http://edms.cern.ch/document/356108/2)
* [13] D. Levin and D. Pomarede, ATLAS Note in preparation.