# Updates to the Level-1 _e/\(\gamma\)_ & \(\tau\)/\(h\)_ Algorithms

Alan Watson

University of Birmingham

###### Abstract

This note documents changes to the level-1 electromagnetic and hadronic cluster triggers since the level-1 TDR [1]. The changes are in the numbers of em and tau trigger selections, the hadronic isolation of the em trigger, and the use of a common RoI definition for the two triggers. The motivations for the changes are described, and the results of simulation studies shown. The changes increase the flexibility of the trigger and have a small but positive effect on trigger performance.

## Introduction

The level-1 Trigger TDR [1] describes algorithms for electron/photon and tau/hadron triggers which would be implemented together in a single ASIC (or FPGA) within the level-1 calorimeter trigger. Both are based on a window of 4x4 "trigger towers" in the electromagnetic and hadronic calorimeters, and the algorithms contain many common elements.

While the overlap between the algorithms was not one of the requirements in choosing them, it would be natural to exploit it in designing the trigger hardware. This also raised the question of whether all of the differences between the algorithms were necessary or desirable.

In considering changes to the trigger algorithms, the following criteria were applied:

* The performance of the trigger should not be in any way degraded, and should be improved if possible.
* The flexibility of the trigger system to respond to different physics requirements and background conditions should be improved.
* The complexity of implementation should not be increased without a clear performance benefit.

From these considerations, the following changes to the algorithms were proposed and accepted [2]:

* The numbers of _e/\(\gamma\)_ and \(\tau\)/\(h\) trigger selections should be made adjustable, rather than being fixed at eight sets of thresholds for each type of trigger.
* The hadronic isolation region of the _e/\(\gamma\)_ algorithm should be divided into two regions (based on the elements of the \(\tau\)/\(h\) trigger), with separate thresholds for both.

* A common RoI definition should be used for both the \(e\)/\(\gamma\) and \(\tau\)/\(h\) trigger algorithms The following sections describe the proposed changes, the motivations and considerations in each case, and the results of simulation studies of the effects of the changes.

### The TDR e/\(\gamma\) and \(\tau\)/h algorithms

The level-1 electron/photon and tau/hadron trigger algorithms, as described in [1], are illustrated in Figure 1 below. Both are based upon a 4\(\times\)4 array of 0.1\(\times\)0.1 "trigger towers" in the electromagnetic and hadronic calorimeters (within the region \(|\eta|\)<2.5).

Both algorithms are based on four elements: the trigger cluster(s), an electromagnetic isolation region, a hadronic isolation region and an "RoI cluster". Although the definitions of these elements differ (except for the em isolation region, which is the same in both algorithms), the requirements for a window to be accepted as containing a valid trigger object are the same in both cases. These requirements are:

* at least one of the four trigger clusters passes the "cluster threshold"
* the \(\rm E_{T}\) sums in the electromagnetic and hadronic isolation regions are less than the corresponding "isolation thresholds"
* the central 2\(\times\)2 "RoI cluster" is a "local \(\rm E_{T}\,\rm maximum\)", i.e. is more energetic than the 8 neighbouring clusters of the same type contained within the 4\(\times\)4 trigger window (these clusters are displaced by one tower in \(\eta\) and/or \(\phi\) relative to the central cluster, and therefore overlap with it). To allow for the possibility of two neighbouring clusters having the same \(\rm E_{T}\), this condition is modified to require that the central RoI cluster is more energetic than

Figure 1: The TDR e/\(\gamma\) and \(\tau\)/\(h\) trigger algorithms

neighbours along two contiguous edges, and at least as energetic as the neighbours along the other edges [3].

For both algorithms there are several sets of cluster and isolation thresholds, allowing the classification of candidates by different cluster and isolation criteria.

Both algorithms will be executed in the same processors, and the similarity of their elements will be fully exploited in the hardware implementation. It was natural then to consider whether the similarity of the algorithms could be exploited to increase the flexibility of the trigger or to simplify the implementation.

## The modified e/\(\gamma\) algorithm

The current form of the _e/\(\gamma\)_ algorithm is shown in Figure 2. The changes are in the use that is made of the hadron calorimeter information:

1. The hadronic window is split into two regions, which are used separately for isolation i.e. separate thresholds are applied to the \(\mathrm{E_{T}}\) sum in each region.
2. The RoI is now defined not by the central 2\(\times\)2 cluster in the em calorimeter, but rather by the sum of the central 2\(\times\)2 regions in both calorimeter systems (i.e. the same as that used for the tau trigger).

The requirements for an electron candidate to be accepted then become:

* At least one of the trigger clusters passed the cluster \(\mathrm{E_{T}}\) threshold
* The total \(\mathrm{E_{T}}\) in the electromagnetic isolation region is less than the em isolation threshold

Figure 2: The new level-1 electron/photon trigger algorithm

* The total \(\rm E_{T}\,\)in the inner hadronic isolation region is less than the hadronic "core" isolation threshold
* The total \(\rm E_{T}\,\)in the outer hadronic isolation region is less than the hadronic "ring" isolation threshold
* The central RoI cluster (em+hadronic) is a "local \(\rm E_{T}\,\)maximum"

Comparing with Figure 1, it can be seen that the same \(\rm E_{T}\,\)sums are used for the tau trigger, except that in the e/\(\gamma\)trigger the central hadronic core is used for isolation rather than as part of the trigger cluster. The tau trigger algorithm itself is unchanged from the TDR.

#### 3.2.2 Numbers of _e/\(\gamma\)_ and \(\tau\)/_h_ classifications

The level-1 _e/\(\gamma\)_ and \(\tau\)/_h_ trigger decisions will be based on the multiplicities of candidates passing different cluster and isolation thresholds (and combinations of these with other trigger objects). It will not be possible to increase the numbers of different classifications of trigger candidates (i.e. the numbers of sets of cluster & isolation thresholds) without replacing a large part of the level-1 calorimeter trigger. It is therefore important that the design should include a sufficient number of different classifications for any foreseeable physics or background scenario.

In the TDR design there are 8 sets of classifications for each of the em and tau triggers. While this was felt to be a comfortable allocation for the tau trigger, it is arguably marginal for the _e/\(\gamma\)_ trigger, which will be one of the most important physics triggers1. An obvious solution would be to increase the number of _e/\(\gamma\)_ classifications, but this would add cost and complexity to the trigger. Alternatively, one could keep the total number of _e/\(\gamma\)_ plus \(\tau\)/_h_ classifications at 16, but allocate more of these to the _e/\(\gamma\)_ trigger and fewer to the \(\tau\)/_h_ trigger. The problem here is that the optimal division between the two triggers will depend on what physics is encountered and what the backgrounds are, and will certainly be luminosity-dependent.

Footnote 1: To see this, one must remember that the same isolation cuts will not be appropriate for both a 20 GeV electron candidate and a 100 GeV candidate. Hence a simple “trigger menu item” such as “1 electron with \(\rm E_{T}\,\)> 20 GeV” will actually require inputs from 2 or 3 different sets of cluster & isolation thresholds (using looser isolation cuts with higher cluster \(\rm E_{T}\,\)to maintain efficiency). Conversely, a single classification may contribute to more than one “trigger menu item”, but even allowing for this it is easy to produce scenarios in which 8 classifications may be marginal.

A better solution then would be to make the numbers of _e/\(\gamma\)_ and \(\tau\)/_h_ classifications _adjustable_, within the overall envelope of \(\rm N_{em}+N_{tau}=16\). This would allow the balance between the two algorithms to be varied according to the physics priorities, resulting in a more powerful and flexible trigger. To see how this might be done, compare the elements of the em and tau algorithms (Table 1). Both consist of:

* RoI condition (identical)
* tests on 4 trigger clusters (at least one of which must pass a threshold)
* an electromagnetic isolation test (identical)
* an "outer" hadronic isolation test (identical)In addition the \(e/\gamma\) algorithm uses the hadronic part of the RoI cluster for isolation.

Thus, the same sets of threshold comparisons (4 trigger clusters and 3 isolation tests) and RoI requirements will suffice for either algorithm, provided:

* different trigger clusters are tested according to which algorithm is being applied
* the inner hadronic isolation test is disabled for the tau algorithm

The second condition is straightforward: it is a requirement that any isolation condition can be disabled. The first requires that each of the comparators used for the trigger threshold test can be presented with either an \(e/\gamma\) or a \(\tau/h\) trigger cluster as required. This can be achieved by using a multiplexer as a "switch" to select one or other input sum. It is therefore a relatively simple matter to allow a set of thresholds to be used to select either \(e/\gamma\) or \(\tau/h\) candidates as required.

Nevertheless, there is some overhead in allowing this flexibility. Since the pressure was felt to be on the number of \(e/\gamma\) classifications, the current design includes 8 classifications for the \(e/\gamma\) trigger, with the other 8 selectable between the \(e/\gamma\) and \(\tau/h\) triggers. If however, as is hoped, the algorithms can be implemented in FPGAs rather than ASICs, this division could be reassessed if the need arose.

As a historical note, this proposal predated the other changes to \(e/\gamma\) trigger. Thus in its original form further multiplexers were required to select which type of hadronic isolation sum was tested and which of two RoI test results was used. In this respect, the current design is simpler.

#### Changes to Hadronic Isolation

The hadronic isolation sum will be divided into two regions:

* a central 2\(\times\)2 tower "core", which is sensitive to longitudinal leakage from the object depositing energy in the trigger cluster
* an outer 12 tower "ring", which is sensitive to hadronic \(\mathrm{E_{T}}\) from other nearby particles

\begin{table}
\begin{tabular}{|l|l|l|} \hline
**Element** & \(e/\gamma\)**trigger** & \(\tau/h\)**trigger** \\ \hline
**Trigger cluster** & 4\(\times\)(2\(\times\)1/1\(\times\)2 em towers) & 4\(\times\)(2\(\times\)1/1\(\times\)2 em + 2\(\times\)2 had towers) \\
**Em Isolation** & 12-tower “ring” & 12-tower “ring” \\
**Inner Had Isolation** & 2\(\times\)2 towers & n/a \\
**Outer Had Isolation** & 12-tower “ring” & 12-tower “ring” \\
**RoI cluster** & 2\(\times\)2 towers (em+had) & 2\(\times\)2 towers (em+had) \\ \hline \end{tabular}
\end{table}
Table 1: Comparing elements of \(e/\gamma\) and \(\tau/h\) trigger algorithmsThis factorisation is not perfect, due to the transverse spread of hadronic showers and, in some regions of the detector, imperfect projective matching of em and hadronic trigger towers, but it provides a fair description of the main properties of the two regions.

Figure 3 compares the \(\mathrm{E_{T}}\) sums in the core and ring regions for isolated electrons and for jets passing a 16 \(\mathrm{GeV}\) cluster threshold. In both cases 48 minimum-bias interactions have been added to the event, with no modelling of the time-history of the pulses. This is a somewhat pessimistic description of the expected pileup, since while it reproduces the expected RMS of the pileup \(\mathrm{E_{T}}\), the baseline \(\mathrm{E_{T}}\) is shifted upwards, which will not occur in those calorimeters using bipolar pulse shaping. Unsurprisingly, for the single electrons the isolation \(\mathrm{E_{T}}\) sum is greater in the ring than in the smaller core. However, for jets passing the cluster threshold the converse is true. Thus the inner "core" sum provides the greater part of the jet rejection while being less sensitive to pileup than the larger "ring". Figure 4 shows that for the jet background events the two isolation sums are reasonably uncorrelated, and thus that rejection can be optimised by using separate cuts on both sums.

Figure 3: \(E_{T}\) distributions for inner (left) and outer (right) isolation sums. for signal and background clusters (including 48 minimum-bias/event). Note different horizontal scales.

The effect of the change is illustrated in Table 2. This shows the jet rejection factors obtained from isolation cuts giving efficiencies of 95%, 98% and 99% for electrons passing the trigger cluster threshold, at a simulated luminosity of \(\mathrm{L}=10^{34}\) cm\({}^{2}\)s\({}^{-1}\).

The separation of the hadronic isolation veto into two regions allows us to maintain a better balance between efficiency and rate, by loosening the ring threshold to maintain efficiency while keeping a tight cut on the core to optimise rejection. This advantage becomes more significant when higher efficiencies are required. Studies with different noise and pileup models also found no circumstance in which the single-region isolation veto provided better performance than the two-region algorithm.

Overall, this change increases the flexibility and robustness of the trigger without significant increase to the complexity or cost (since the hadronic part of the trigger window must already be split in this way for the tau trigger algorithm).

#### 3.2.2 RoI algorithm

In the level-1 TDR we proposed using different RoI clusters for the em and tau triggers:

\begin{table}
\begin{tabular}{|c|c|c|c|c|} \hline \hline Efficiency & \multicolumn{3}{|c|}{New Algorithm} & \multicolumn{2}{|c|}{TDR Algorithm} \\  & Core cut & Ring cut & Rejection & 4\(\times\)4 cut & Rejection \\ \hline
95\% & \(<\) 1 GeV & \(<\) 2 GeV & 2.39 & \(<\) 2 GeV & 2.30 \\ \hline
98\% & \(<\) 2 GeV & \(<\) 3 GeV & 2.05 & \(<\) 3 GeV & 1.85 \\ \hline
99\% & \(<\) 2 GeV & \(<\) 5 GeV & 1.98 & \(<\) 5 GeV & 1.62 \\ \hline \hline \end{tabular}
\end{table}
Table 2: Jet rejection factors from isolation for different electron isolation efficiencies, for jets passing a 15 GeV trigger cluster \(E_{T}\) cut. EM isolation cuts of 5 GeV (95%) and 6 GeV (98% & 99%) were applied in addition.

Figure 4: Correlations between inner and outer hadronic isolation sums. for electrons (left) and jets (right), both with pileup.

* the e/\(\gamma\) trigger would use only the em calorimeter in identifying potential Rols
* the tau trigger would use both electromagnetic and hadronic calorimeters for its RoI candidates

This was based on the nature of the objects being selected: electromagnetic showers should, ideally, be completely contained in the em calorimeter, and so the hadronic calorimeter is used only as a veto. Hadronic objects (such as hadronic tau decays) deposit energy in both calorimeters, and so the best identification of the location of such an object should use information from both. The algorithm used (requiring that a 2\(\times\)2-tower RoI cluster be a local E\({}_{\mathrm{T}}\) maximum) is identical in both cases.

This is, however, a technical complication: it requires that two sets of RoI clusters be formed and that energy comparisons be made within each set separately. It also complicates the RoI data (since a single object could produce slightly different RoI coordinates for the em and tau algorithms), and requires additional outputs from the chips executing the algorithms. A common RoI definition is therefore preferable, provided that trigger performance is not degraded.

The best RoI for a candidate trigger object is that which best contains the energy of the shower within the trigger cluster. Since hadrons deposit energy in both calorimeter systems, the best tau RoI algorithm should also use both calorimeters, and simulations quickly confirmed this to be true. However, since electromagnetic showers should not deposit energy in the hadronic calorimeters, for an isolated electron or photon it should not matter whether the RoI is formed using the em calorimeter only or using both calorimeter systems.

The choice of RoI algorithm can only affect the performance of the trigger if, for a given object, the two algorithms would select different trigger windows. For the two algorithms compared here, this requires that there be a measurable hadronic E\({}_{\mathrm{T}}\) deposit near to an electromagnetic shower. This is illustrated in Figure 5 below.

Figure 5: How the choice of RoI algorithm might affect the trigger decision

In the left-hand figure the 2\(\times\)2 em Rol cluster completely contains the em shower. When the hadronic data are included in the right-hand figure, the most energetic cluster is instead the one which includes the hadronic deposit, even though this one does not completely contain the em shower itself. This has the following effects:

* the RoI coordinate is shifted by 1 trigger tower (0.1 radian)
* the hadronic signal is added to the "core" isolation sum instead of the "ring"
* part of the shower leaks into the electromagnetic isolation ring

A scenario such as this could indeed degrade trigger efficiency, which is why detailed simulation studies were required. However, there are a couple of points which should be noted:

* only hadronic signals which would lie within or next to the em Rol, i.e. which would in any event lie within the hadronic isolation region, can affect the RoI decision. Since hadronic isolation requirements are expected to be fairly tight, it is therefore unlikely such objects would be selected in any case.
* this example, where em isolation is affected as well as the Rol coordinate, is an even more extreme case. For this to happen, the hadronic deposit must be greater than the em E\({}_{\rm T}\) leaked into the isolation region. Since em isolation requirements will in most cases be looser than hadronic, it is particularly unlikely that this could result in an object being rejected by the electromagnetic isolation that would not in any event have been rejected by hadronic isolation.

In fact, this type of scenario is more likely to occur not with genuine electrons or photons, but rather with jets which pass the trigger cluster requirements.

#### Effects on Efficiency

As discussed above, the change in RoI algorithm can only affect efficiency if there are hadronic signals near to an electron or photon shower. These signals may be due to noise, pileup, or other particles produced in the primary event.

In order to test the robustness of the algorithm against noise and pileup, a "worst case" scenario was studied. Single electron events with a \(\rm p_{T}\) of 30 GeV were used. An average 48 minimum bias interactions were added per event, plus the expected levels of electronic noise. No special tuning of the trigger tower E\({}_{\rm T}\) threshold was made to suppress the extra noise. As described earlier, this gives a rather pessimistic model of the E\({}_{\rm T}\) in the calorimeters even at high luminosity. The events were analysed with both the old and new RoI algorithms and the efficiencies compared. Figure 6 shows the isolation E\({}_{\rm T}\) distributions found using the different RoI algorithms. Very small differences are visible in the hadronic isolation sums, but these had no measurable effect on efficiency.

In physics events, however, there will be other energetic particles present in addition to the electron or photon of interest. In order to test whether the Rol algorithm affected efficiency in these cases, a number of processes containing both energetic electrons or photons plus jets were studied. The largest effects were seen in top pair events (where one top quark decayed semi-leptonically). Figure 7 shows the isolation \(\mathrm{E_{T}}\) distributions for trigger objects produced by electrons in these events. The tails of these distributions extend to much higher \(\mathrm{E_{T}}\) than for single electrons plus pileup (Figure 6), evidence that at least some of these electrons are near to jets2.

Footnote 2: The history information available in these events did not allow separation of electrons from top decays from those from b quark decays - the plots therefore will contain both.

Looking at these events in detail, we found that fewer than 1% of RoIs coordinates differ between the two algorithms, and no effect at all on efficiency was observed.

Figure 6: Effect of Rol algorithm on isolation sums. The solid line is with the TDR algorithm. while the points are with the new Rol definition.

### Effects on Jet Rejection

Jets containing a sufficiently-energetic em cluster to pass the level-1 trigger thresholds usually deposit significant amounts of E\({}_{\rm T}\) behind and near to that cluster. This is the basis of the use of isolation to reduce background, but also means that the change in RoI algorithm can affect backgrounds differently from the signal (where the trigger cluster is normally well-isolated). Since the key to trigger performance is the background rate for a given signal efficiency, it is important to consider the effect of the RoI algorithm on background rates as well. To study this, 2015 events from the level-1 jet background production [4] were analysed, with 48 minimum-bias interactions added to each event. A trigger cluster threshold of 15 GeV was applied, resulting in 269 (270) clusters passing the threshold for the new (old) RoI algorithm3. A very obvious difference from the signal events was the fact that the RoI coordinates from the two algorithms differed for \(\sim\)10% of these clusters, compared with <1% for \(e\)/\(\gamma\) RoIs in any of the situations studied.

Figure 7: Hadronic isolation \(E_{T}\) for electrons in top pair events, for old and new RoI algorithmsTo understand the impact on trigger performance, jet rates were compared for different \(e\)/\(\gamma\) efficiencies. For each Rol algorithm, isolation cuts were chosen to give 95%, 98% and 99% efficiency for electrons passing the cluster \(\rm E_{T}\) cut (again, with 48 minimum-bias/event). This method, optimising the cuts for each algorithm independently, gives the fairest measure of the performance of each option. The results are summarised in Table 3.

The differences are small, but in all cases favour the new Rol algorithm. This is not surprising: where the two algorithms differ, the new algorithm will tend to select the window with more \(\rm E_{T}\) in the hadronic "core" isolation region, which is the isolation sum with the tightest cut, and hence the jet is more likely to fail with the new algorithm. That the difference should be greater when a higher efficiency is required (i.e. looser cuts) is less obvious. The explanation is that the lower efficiencies (e.g. 95%) are achieved with hadronic isolation cuts so tight that RoIs containing hadronic \(\rm E_{T}\) are rejected regardless of whether it is in the core or ring region, and so the rate does not differ much between the two algorithms.

#### Sensitivity to Hadronic Trigger Tower Noise

It is obvious that including the hadronic part in the Rol cluster must introduce some increased sensitivity to noise in the hadronic signals. Most of the tests above were carried out using an extremely pessimistic model of pileup, but this does disproportionately affect the electromagnetic calorimetry. It therefore seemed prudent to ensure that the safety margin was adequate by studying the effects of increased levels of noise in the hadronic calorimetry.

The following procedure was used. Events, both single electrons (of different \(\rm p_{T}\)) and jet background, were analysed with various levels of noise added to the hadronic trigger towers. To maximise the effect of the noise, no attempt was made to suppress it by tuning trigger tower thresholds (as would be done in reality). Cluster and isolation thresholds were found which gave 95% efficiency for the electrons, and the number of jets passing these for the two Rol algorithms were compared. The lowest level of noise examined was 350 MeV RMS in the barrel calorimetry (slightly higher than would currently be expected from the summing electronics, and somewhat higher than assumed in the TDR and earlier studies in this note). Twice this level was assumed in the endcap calorimeter (arbitrarily, purely in order to give a similar RMS in \(\rm E_{T}\)). The study was repeated with 2, 4 and 8 times these RMS values. The results are summarised in Table 4 below. As can be seen, only for noise levels more than eight times our expectation, and with no attempt to use the facilities which exist in the trigger to suppress this noise, do we see a significant degradation of performance relative to the TDR algorithm.

We therefore conclude that the change in Rol algorithm will not degrade performance for any plausible noise scenario.

\begin{table}
\begin{tabular}{|c|c|c|c|} \hline Isolation Efficiency & \(>\)95\% & \(>\)98\% & \(>\)99\% \\ \hline TDR RoI Algorithm & 135 & 170 & 175 \\ \hline New Rol Algorithm & 134 & 165 & 170 \\ \hline \end{tabular}
\end{table}
Table 3: Numbers of jet events (from a pre-filtered sample of 2015) passing isolation cuts giving different signal efficiencies, for old and new Rol algorithms.

\begin{tabular}{|c|c|c|c|c|} \hline Noise RMS (GeV) & 0.35 & 0.70 & 1.40 & 2.80 \\ \hline TDR Rol Algorithm & 160 & 195 & 248 & 275 \\ \hline New Rol Algorithm & 160 & 198 & 241 & 341 \\ \hline \end{tabular}

_Table 4: Numbers of jet events (from a pre-filtered sample of 2015) passing cluster and isolation conditions giving 95% signal efficiency, for different (artificially high) hadronic noise RMS. Noise levels were (arbitrarily) doubled for \(|\eta|\)\(>\)1.5._

#### Summary

Three changes have been made to the level-1 e/\(\gamma\) trigger algorithm since the TDR:

* The numbers of sets of \(e\)/\(\gamma\) and \(\tau\)/\(h\) thresholds have been made variable, within the limits of the hardware.
* The hadronic isolation region has been divided into an "inner" and an "outer" region, with independent thresholds for the two.
* A single Rol algorithm will be used for the \(e\)/\(\gamma\) and the \(\tau\)/\(h\) triggers.

Although there are small improvements in the jet background rejection, the main motive for all of the changes is to improve the flexibility (and hence robustness) of the trigger or to simplify the implementation.

## Acknowledgements

The proposal for making the numbers of \(e\)/\(\gamma\) and \(\tau\)/\(h\) classifications variable, and the conceptual implementation of the scheme, were worked-out over a cup of coffee by Norman Gee, Murrough Landon and myself. This is, of course, just another example of the well-known phenomenon of the coffee break being the most productive part of any meeting.

The idea of separating the hadronic isolation of the \(e\)/\(\gamma\) algorithm into two regions was arrived at independently by Sam Silverstein and myself. Knowing that it wasn't just one of my fancies helped keep it live despite the pressure of "more urgent" problems.

## References:

* [1] The ATLAS First-Level Trigger Technical Design Report, CERN/LHCC/98-14
* [2] Minutes of the Trigger/DAQ Steering Group meeting of 22/07/99
* [3] Level-1 TDR, Section 4.2.2