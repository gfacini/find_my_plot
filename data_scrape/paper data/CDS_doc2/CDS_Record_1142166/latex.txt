**Refitting of combined inner detector and muon spectrometer tracks from Monte Carlo samples by using the Kalman fitter and the STEP algorithm in the ATLAS experiment**

E. Lund\({}^{*,1}\), L. Bugge\({}^{1}\), T. G. Cornelissen\({}^{2}\), M. Elsing\({}^{2}\), I. Gavrilenko\({}^{2,3}\),

W. Liebig\({}^{4}\), D. Lopez Mateos\({}^{5,6}\), A. Salzburger\({}^{2,7}\), A. Strandlie\({}^{1,8}\), S. Todorova\({}^{9}\)

\({}^{1}\) _University of Oslo, Oslo, Norway_

\({}^{2}\) _CERN, Geneva, Switzerland_

\({}^{3}\) _P. N. Lebedev Institute of Physics, Moscow, Russia_

\({}^{4}\) _NIKHEF, Amsterdam, The Netherlands_

\({}^{5}\) _Columbia University, New York, USA_

\({}^{6}\) _California Institute of Technology, Pasadena, USA_

\({}^{7}\) _DESY, Hamburg, Germany_

\({}^{8}\) _Gjovik University College, Gjovik, Norway_

\({}^{9}\) _Tufts University, Boston, USA_

\({}^{*}\) corresponding author (esben.lund@fys.uio.no)

**Abstract**

In this paper we refit combined muon tracks using the Kalman fitter and the _simultaneous track and error propagation_ (STEP) algorithm of the ATLAS tracking software. The muon tracks are simulated by GEANT4 in the full detector description, reconstructed by MUID, and refitted by the Kalman fitter in the ATLAS TrackingGeometry. The relative transverse momentum resolution of the refitted tracks is compared to the resolution of the refits done by the global \(\chi^{2}\) track fitter, along with the resolution found by the MUID and STACO muon combination algorithms. Reconstructed invariant masses are compared in a similar way.

Introduction

Experimental particle physics is on the verge of a new era, heralded by the Large Hadron Collider being commissioned at the European Organization for Nuclear Research -- CERN -- located just outside Geneva, Switzerland. The LHC accelerator will collide protons at a center of mass energy of 14 TeV, opening up a new window for particle discoveries and precision measurements of existing theories. Particle detectors are located at four beam crossings along the LHC, one of which houses the ATLAS detector [1]. This is the largest of the LHC experiments, employing a great variety of detector and magnetic field technologies to identify a wide range of particles. The complex magnetic field and high collision rate, however, make the reconstruction of particle tracks very challenging. Things are complicated further by the relatively big amount of material within ATLAS, generating considerable disturbances to the particle tracks through material interactions such as energy loss and multiple scattering.

Track reconstruction is mostly done in the inner detector and muon spectrometer, while the calorimeters match energy deposits to the reconstructed tracks and to tracks that go undetected in the inner detector, such as photons and neutrons. In addition to the standalone inner detector and muon spectrometer tracks, the track reconstruction matches these tracks to construct the combined muon tracks. To guarantee the quality of the reconstructed tracks, competing algorithms exist for performing individual tasks in the track reconstruction process. For the combined muon reconstruction, two of the most prominent algorithms are MUID [2] and STACO [3].

As the detector calibration and material description are better understood, old data might be improved through reconstruction with an upgraded material description, which is handled by the so-called TrackingGeometry [4] within the new ATLAS tracking realm [5]. Running the complete reconstruction chain is quite computing costly. However, it might be sufficient to only refit the existing tracks using the new detector information in some cases, thereby reducing the computing cost significantly. The ATLAS reconstruction mainly uses two mathematically equivalent, yet different approaches to track refitting; the global \(\chi^{2}\) track fit [6] and the Kalman filter [7], implemented in the ATLAS global \(\chi^{2}\) track fiter [8] and Kalman fitter, respectively. The global \(\chi^{2}\) fitter handles the material interactions in the final track fit, whereas the Kalman fitter incorporates the material interactions at points along the track or continuously during the track propagation. Hence, material interactions can be integrated in two ways; as point-like corrections to the track trajectory in detectors that have a discrete material distribution -- such as the Silicon layers of the ATLAS inner detector -- or by incorporating the material interactions as continuous corrections during the propagation process itself. The latter method is carried out by the newly developed STEP propagation algorithm [9, 10, 11] and is well suited to the transport of track parameters through the dense material of the ATLAS detector. In this note, we focus on the effect of using STEP to propagate through the muon spectrometer and calorimeters, and we investigate the quality of the refitted muon tracks in such cases. Specifically, we present the relative transverse momentum (\(p_{T}\)) resolution of the Kalman and global \(\chi^{2}\) track refitting algorithms, along with the resolution of the STACO and MUID combined muons. The combined muon tracks reconstructed by STACO and MUID are quite similar, but only MUID performs a track fit, hence we choose to restrict the track refitting by the Kalman and global \(\chi^{2}\) track fitters to the MUID combined muons. Reconstructed invariant masses are compared in a similar way.

In this paper, we start out by describing two of the most prominent ATLAS muon combination algorithms; MUID and STACO, along with the Kalman and global \(\chi^{2}\) track fitters, in Sections 2 and 3. Furthermore, we introduce the Monte Carlo samples and quality selection cuts in Section 4, followed by the relative \(p_{T}\) resolution and invariant mass reconstruction in Section 5. Finally, we present the conclusion in Section 6.

Natural units (\(\hbar=c=1\)) are used throughout this paper, and all results are produced with ATLAS offline software release 14.4.0, unless otherwise stated.

Reconstruction of the combined inner detector and muon spectrometer tracks

Generally speaking, the ATLAS detector can be divided into three parts; the inner detector, the calorimeters and the muon spectrometer. The reconstruction of the interaction point, secondary vertices and most tracks is done by the inner detector located in the center of the detector. Covering the inner detector, we find the calorimeters stopping most particles -- except muons -- while measuring their energy deposits. Outside of the calorimeters we find the second tracking device of ATLAS; the muon spectrometer.

In this paper we focus on muons coming from the interaction point with sufficient momentum to penetrate the calorimeters and pass through the muon spectrometer, allowing a combined reconstruction by using information from both tracking devices; the inner detector and muon spectrometer. This covers most muons coming from \(Z\), \(W\) and \(H\), and excludes low-\(p_{T}\) muons stopped in the calorimeters, or muon spectrometer, and muons created through decay processes in the inner detector or calorimeters. The inner detector and muon spectrometer are complementary in the sense that the inner detector has a good \(p_{T}\) resolution for muon tracks with a \(p_{T}\) up to 50 GeV, while the muon spectrometer covers the remaining \(p_{T}\) range, giving the combined muons a good \(p_{T}\) resolution over the whole momentum range.

The ATLAS software contains several algorithms for reconstructing combined muons. Here we concentrate on two of the most established algorithms; MUID [2] and STACO [3]. Both algorithms pair inner detector (ID) and muon spectrometer (MS) tracks by using the match chi-square to identify the combined muons;

\[\chi^{2}_{\rm match}=(\mathbf{\xi}_{\rm MS}-\mathbf{\xi}_ {\rm ID})^{\rm T}(\mathbf{\Sigma}_{\rm MS}+\mathbf{\Sigma}_ {\rm ID})^{-1}(\mathbf{\xi}_{\rm MS}-\mathbf{\xi}_{\rm ID}) \tag{1}\]

where \(\xi\) are the five local track parameters defined in the ATLAS event data model [12] -- expressed at the point of the closest approach to the beam line -- and \(\Sigma\) is the track parameter covariance matrix at the same point. The match chi-square requires the propagation of the muon spectrometer track through the calorimeters, taking material interactions into account. The above track matching decides which pairs of inner detector and muon spectrometer tracks to combine.

Upon matching the inner detector and muon spectrometer tracks, STACO does a statistical combination to produce the combined track parameters at the point of the closest approach to the beam line;

\[\mathbf{\xi}_{\rm combined}^{\rm STACO}=(\mathbf{\Sigma}_ {\rm ID}^{-1}+\mathbf{\Sigma}_{\rm MS}^{-1})^{-1}(\mathbf{ \Sigma}_{\rm ID}^{-1}\mathbf{\xi}_{\rm ID}+\mathbf{\Sigma$ }_{\rm MS}^{-1}\mbox{\boldmath$\xi}_{\rm MS}) \tag{2}\]

MUID, on the other hand, fits the combined track, starting from the inner track fit and adding the points from the muon spectrometer track.

As of today, MUID is the only combined muon reconstruction algorithm -- discussed in this note -- which incorporates the calorimeter energy loss measurements into the track fitting. This feature has, however, been replaced by a parameterized calorimeter energy loss to better compare MUID to the other algorithms presented here.

## 3 The Kalman and global \(\chi^{2}\) track fitters

The Kalman filtering approach [7] to track fitting is a progressive method in the sense that the track measurements are added to the track one at a time, Fig. 1. This linear dependency on the number of track measurements lends itself well to the refitting of combined muon tracks, which often contain close to 100 measurements. Mathematically, the Kalman fitter performs a \(\chi^{2}\) minimization, equivalently to the global \(\chi^{2}\) fitter [8]. This method, however, combines all measurements into one big calculation to minimize the \(\chi^{2}\). Both methods have their strengths and weaknesses; the Kalman fitter is quick but might be steered off course by bad measurements, especially early in the fitting process. The global \(\chi^{2}\) fit is less sensitive to bad measurements -- often called outliers -- but more computing costly, particularly for tracks containing many measurements.

The prediction step is an important part of the Kalman filtering, which is why a dedicated propagator, STEP [9, 10, 11], has been developed with this in mind. In this note, the STEP algorithm -- encapsulated within the ATLAS extrapolator tool [13] -- propagates the track parameters and the associated covariance matrix through the dense volumes of the muon spectrometer and calorimeter tracking geometry [4], taking the material interactions continuously into account. These interactions introduce noise into the filtering process which has to be well understood in order to produce a good fit. In the inner detector, where the detector material is mostly layered, the Kalman fitter uses another ATLAS propagator -- the RungeKuttaPropagator, originally part of the xKalman package [14] -- for the prediction step, along with point-like updates to the track parameters from the material interactions at these layers. The outermost part of the inner detector (the TRT) can also be incorporated into the track propagation as dense volumes, which is not done here.

## 4 Monte Carlo samples and quality selection cuts

The primary goal of this paper is to find out how the Kalman fitter -- employing the STEP algorithm -- matches up to the other methods of finding the combined muon track parameters, hence the source of the muons is of less importance. Here we use Monte Carlo samples of \(J/\psi\to\mu^{+}\mu^{-}\), \(Z\to\mu^{+}\mu^{-}\), \(H(600\mbox{ GeV})\to ZZ\to 4l\) and single muons (\(p=1\mbox{ TeV}\) and \(p_{T}=10,100,1000\mbox{ GeV}\)) -- simulated by GEANT4 [15] in the full detector description -- to cover a wide range of muon momenta. The \(H\) and the \(p=1\mbox{ TeV}\) single muons are produced with ATLAS software release 12.0.6, while the rest of the samples are simulated with release 13.0.40. All of the samples are simulated in a misaligned detector description, which is mirrored in the reconstruction software to compensate for the misalignment. This correction might, however, be less than perfect, giving reconstructed tracks of worse resolution than those of an ideal detector description.

A consistent set of quality selection cuts for the reconstructed tracks has been used throughout this note; requiring at least seven hits in the pixel and SCT layers of the inner detector, and demanding that

Figure 1: Illustration of a typical Kalman filtering step. The track parameters associated to module 1 are propagated through a material layer onto module 2 to find the predicted track parameters at this module. In the Kalman filter formalism, the weighted mean between the prediction and the associated measurement form the updated track parameters, which are the starting point of the next filtering step. (From Ref. [13]).

the transverse and longitudinal impact parameters at the point of closest approach to the primary vertex must fulfill \(|d_{0}|<2\) mm and \(|z_{0}\sin\theta|<10\) mm respectively, where \(\theta\) is the polar angle of the track.

## 5 Relative transverse momentum resolution and invariant mass reconstruction

Since we are only doing track refitting -- and not track finding -- the impact on particle discovery related parameters, such as track finding efficiencies, fake rates, and exclusion and discovery limits, is minimal. Improvements to the reconstructed invariant mass resolutions and other precision measurements might, however, be seen. To evaluate the quality of the track fits, we study the relative \(p_{T}\) resolution, defined as the width of the Gaussian fit restricted to 3 sigma of the peak;

\[\frac{\Delta p_{T}}{p_{T}}=\frac{1/p_{T}^{\rm reco}-1/p_{T}^{\rm true}}{1/p_{T} ^{\rm true}}=\frac{p_{T}^{\rm true}-p_{T}^{\rm reco}}{p_{T}^{\rm reco}} \tag{3}\]

The transverse momentum \(p_{T}\) is used for invariant mass reconstruction and for estimating the missing transverse energy, among other things. Reconstructing the \(p_{T}\) is particularly challenging, making the \(p_{T}\) resolution the most common yardstick for evaluating the quality of a track fitting method. The accuracy of the direction measurements are, on the contrary, typically much better than that required by any physics analysis.

Figure 2 shows the relative \(p_{T}\) resolution of the combined muons from all of the datasets as a function of \(p_{T}\) in the barrel region (\(|\eta|<0.7\)), while Fig. 3 shows the relative \(p_{T}\) resolution as a function of \(|\eta|\), averaged over \(\phi\), for three transverse momenta. All of the methods are in good agreement with each other, producing reasonable results.

Figure 4 shows the reconstructed invariant masses of \(J/\psi\), \(Z\) and \(H(600\GeV)\) from the combined muons of their respective Monte Carlo samples. The invariant masses are reconstructed from the two (or four) most energetic muons of the event regardless of their summed charge, only requiring all of the muons to be located in the barrel region. The Higgs mass is reconstructed without any \(Z\)-mass constraint. The reconstructed invariant masses of the respective methods of Fig. 4 are quite similar because the quality of the invariant mass reconstruction relies heavily on the momentum resolution of the combined muons, which is quite similar for all of the muon combination methods discussed here. The non-Gaussian tails are partially due to radiative decays, but mostly due to muons poorly measured in certain regions of

Figure 2: Relative transverse momentum resolution as a function of \(p_{T}\) in the barrel region for different methods (left) and configurations of the STEP algorithm within the Kalman fitter (right). The Kalman and global \(\chi^{2}\) refitting is applied to the MUID tracks. The straggling refers to the energy loss fluctuations.

the muon spectrometer, while the lower reconstructed masses -- with respect to the true masses -- are mostly caused by radiative energy loss during the initial decay and radiative energy loss of the individual muons. The radiative energy loss of the muons is particularly hard to reconstruct due to its non-Gaussian, Landau distribution. The asymmetric Landau distribution has a tail towards high energy loss, which grows with increasing muon momenta. In the combined muon reconstruction, it is common practice to transport the muon track parameters through the calorimeters assuming the most probable energy loss of the Landau distribution -- to optimize the momentum resolution -- thereby underestimating the true energy loss and initial momenta of the muons in many cases. These underestimated momenta are then passed on to the reconstruction of the invariant masses, giving lower than expected masses. Since the radiative energy loss of muons rises rapidly with increasing momenta, the negative shift in the reconstructed mass is particularly big in the \(H\) sample of Fig. 4. In some cases, the reconstructed mass can be improved through various combinatorial techniques, such as mass and charge constraints, none of which are applied here.

## 6 Conclusion

In this paper we have shown that the \(p_{T}\) resolution of combined muons refitted with the Kalman fitter -- employing the STEP algorithm -- and the invariant masses reconstructed from these muons, are on par with the \(p_{T}\) resolution of the combined muon refits, and reconstructed invariant masses, found by the

Figure 3: Relative transverse momentum resolution as a function of \(|\eta|\), averaged over \(\phi\), for different methods, at \(p_{T}=10,100\), and \(1000\GeV\), within the \(|\eta|<2.5\) acceptance of the inner detector. The Kalman and global \(\chi^{2}\) refitting is applied to the MUID tracks.

global \(\chi^{2}\) fitter and the results obtained by the STACO and MUID muon combination algorithms.

The Kalman fitter's main strengths lie in its straightforward way of including the material interactions, and the fact that the computing time scales linearly with the number of track measurements, which is particularly useful when refitting tracks with many measurements attached, such as the combined muons. These factors cause the Kalman fitter to be around two times faster than the global \(\chi^{2}\) fitter when refitting the combined muons of the Monte Carlo samples presented here. The timing does, however, rely on many things, such as the ATLAS software release version and material description of the detector.

The refitting of combined muons with the Kalman fitter is partly based on new non-optimized software -- such as the dense volume description of the ATLAS calorimeters in the tracking geometry and the energy loss fluctuations of the STEP algorithm -- hence there is still room for improvements.

## 7 Acknowledgements

This work has been carried out as part of the developments of the ATLAS tracking group. We would like to thank our colleagues for their help in integrating the software and for their support in preparing this note.

Figure 4: Reconstructed invariant masses of \(J/\psi\to\mu\mu\), \(Z\to\mu\mu\) and \(H(600\,\mathrm{Ge\kern-1.0ptV})\to 4\mu\) from the combined muons of their respective Monte Carlo samples. The invariant masses are reconstructed from the two (or four) most energetic muons of the event regardless of their summed charge, only requiring all of the muons to be located in the barrel region. The Gaussian fit is done on the invariant masses reconstructed from the combined muons of the Kalman fitter.

## References

* [1] The ATLAS Collaboration, G. Aad _et al._, JINST **3** (2008) S08003.
* [2] Th. Lagouri _et al._, IEEE Trans. Nucl. Sci. **51** (2004) 3030-3033.
* [3] S. Hassini _et al._, NIM **A572** (2007) 77-79.
* [4] A. Salzburger _et al._, The ATLAS Tracking Geometry Description, ATLAS Public Note ATL-SOFT-PUB-2007-004, 2007.
* [5] T. Cornelissen _et al._, Concepts, Design and Implemenentation of the ATLAS New Tracking (NEWT), ATLAS Public Note ATL-SOFT-PUB-2007-007, 2007.
* [6] R. Fruhwirth _et al._, Data analysis techniques for high-energy physics, (Cambridge University Press, Cambridge, 2000).
* [7] R. Fruhwirth, Nucl. Inst. and Meth. A **262** (1987) 444.
* [8] T. Cornelissen _et al._, J. Phys.: Conf. Ser. **119** (2008).
* [9] E. Lund _et al._, Track parameter propagation through the application of a new adaptive Runge-Kutta-Nystrom method in the ATLAS experiment, ATLAS Public Note ATL-SOFT-PUB-2009-001, submitted to Journal of Instrumentation, 2009.
* [10] E. Lund _et al._, Transport of covariance matrices in the inhomogeneous magnetic field of the ATLAS experiment by the application of a semi-analytical method, ATLAS Public Note ATL-SOFT-PUB-2009-002, submitted to Journal of Instrumentation, 2009.
* [11] E. Lund _et al._, Treatment of energy loss and multiple scattering in the context of track parameter and covariance matrix propagation in continuous material in the ATLAS experiment, ATLAS Public Note ATL-SOFT-PUB-2008-003, 2008.
* [12] F. Akesson _et al._, The ATLAS Tracking Event Data Model, ATLAS Public Note ATL-SOFT-PUB-2006-004, 2006.
* [13] A. Salzburger, The ATLAS Track Extrapolation Package, ATLAS Public Note ATL-SOFT-PUB-2007-005, 2007.
* [14] I. Gavrilenko, Description of Global Pattern Recognition Program (XKALMAN), ATLAS Note ATL-INDET-97-165, 1997.
* [15] S. Agostinelli _et al._, Nucl. Inst. and Meth. A **506** (2003) 250.