# Three-dimensional Event Visualization for the ATLAS Calorimeter

Luciano M. de Andrade Filho

luciano.andrade@engenharia.ufjf.br

Jose Manoel de Seixas

Roberto Agostino Vitillo

Brian Thomas Martin

Federal Univertity of Juiz de Fora - Department of Electrical Circuits Federal University of Rio de Janeiro - Signal Processing Laboratory National Institute of Nuclear Physics - Pisa Michigan State University

###### Abstract

The ATLAS detector has been commissioned with cosmic rays. For this commissioning phase, a number of software tools has been developed to support data analysis. Among ATLAS subdetectors, commissioning the calorimeter system demanded a considerable effort due to its segmentation into seven detection layers, which produces more than a hundred thousand readout channels. Tasks like performance evaluation of the calorimeter, calibration and noisy or dead channel detection benefit a lot from cosmic muon track visualization, which facilitates the identification of the activated cells in the calorimeter. The coherence of the reconstructed data can be visually checked and potential problems can be detected in a easier way. This work presents a 3D visualization tool for the ATLAS calorimeter system, the Calo-GeoView, which provides a smooth integration with analyses currently performed by the ATLAS community. The tool structure and some applications with reconstructed data are presented. Due to its 3D graphical interface, the CaloGeoView has been providing a simple and intuitive way to analyze results of event reconstruction. As a consequence, the ATLAS hadronic calorimeter collaboration is now using this visualization tool online in the control room.

keywords: Event display, Cosmic rays, Calorimetry, Triggering Systems, ATLAS detector +
Footnote â€ : journal:

## 1 Introduction

LHC [1] will collide protons with 14 TeV in the center of mass at a 25 nanosecond period. As one of the main LHC detectors, ATLAS [2] will explore the fundamental nature of matter and the basic forces that shape our universe. The detector has a total length of 42 \(m\) and a radius of 11 \(m\) (see Figure 1).

The Inner Detector [3] extends to a radius of 1.2 \(m\), and is 7 \(m\) in length along the beam pipe. Its basic function is to track charged particles, revealing detailed information about the type of particle and its momentum. The calorimeter [4] is situated outside the solenoidal magnet that surrounds the inner detector and comprises two sections: electromagnetic and hadronic part. Their purpose is to measure the energy of incoming particles by total absorption [5]. The muon spectrometer is an extremely large detection system, extending from a radius of 4.25 \(m\) around the calorimeters out to the full radius of the detector (11 \(m\)) [6]. Its tremendous size is required to accurately measure the momentum of muons.

Due to the extremely high interaction rate and the huge background noise generated by LHC, ATLAS requires the design of a sophisticated on-line triggering system, for which calorimeters provide an essential information. In ATLAS, the triggering system operation is split into three cascaded levels and should reduce dramatically the background noise rate, providing an output frequency of the order of 100 Hz [7].

Synchronization of all the ATLAS subdetectors with the trigger system can

Figure 1: The ATLAS detectorbe considered as a real challenge, when complexity of the detector system, the huge number of channels and the variety of the technologies used in the different parts are taken into account. In order to achieve this goal, several commissioning procedures have been put into place. For commissioning the whole system with physical events, before the LHC start, an exhaustive tests with cosmic rays have been performed since 2006 [8], [9], [10], [11]. These tests have allowed to check the integrity of each sub-detector, identifying local problems, and testing the intercommunication of the sub-systems as well.

Different algorithms are executed to analyze cosmic runs. One of the most efficient way to identify local problems is the visual inspection of the reconstructed data, using an event display tool. While standard event displays in ATLAS - like Atlantis [12], Persint [13] and VP1 [14] - were developed to visualize as much information as possible in LHC proton-proton collisions, the CaloGeoView provides specific calorimeter cell level information that can be very usefull during commissioning phase with cosmic rays, like actual 3D cell geometry, energy-to-color palette and track visualization of cosmic muons based on calorimeter information only.

This work presents a software tool for 3D visualization of the calorimeter cells, the CaloGeoView [15]. This tool allows to check the coherency of the reconstruction algorithms and supports the commissioning phase with cosmic rays. The CaloGeoView has been developed using ROOT framework [16] and its embedded geometry package [17]. Since the framework for data reconstruction in ATLAS, Athena [18], generates specific files to be loaded in ROOT environment, the integration between reconstructed data and the CaloGeoView can be done smoothly. Due to its easy and intuitive way to analyze and identify problems, this tool has become part of the Online Hadronic Calorimeter Monitoring System [19] and should be operational during LHC collisions as well.

This paper is organized as it follows. For the ATLAS calorimeter system, both the geometry and segmentation profile are presented in Section 2. In Section 3, the online triggering system is described. Section 4 addresses the calorimeter commissioning with cosmic rays. Then, Section 5 presents the 3D event display tool, their features and some practical examples. Details about implementation are given in Section 6. Finally, conclusions are derived in the Section 7.

## 2 Calorimeter System

The calorimeter system comprises two sections: an inner electromagnetic calorimeter and an outer hadronic calorimeter (Figure 2). Both are sampling calorimethe shape of the resulting particle shower, inferring the energy of the original particle from this measurement.

The electromagnetic (EM) calorimeter [20] is designed for absorbing energy from particles that interact electromagnetically, which includes charged particles and photons. It has high precision, both in the measurement of the amount of energy absorbed and in the precise location of the energy deposition profile. The energy-absorbing materials are lead and stainless steel, with Liquid Argon (LAr) as the sampling material.

The hadronic calorimeter absorbs energy from particles that pass through the EM calorimeter, which are primarily hadrons. The hadronic calorimeter is less precise, both in energy resolution and in shower localization [21]. Different technologies are used in this calorimeter, depending on \(\eta\) region (in pseudo-rapidities [2]), in order to optimize the detection and energy measurements in a large energy range. For \(|\eta|<1.7\), the energy-absorbing material is steel and scintillating tiles sample the deposited energy. This detector is known as TileCal. Then, for \(1.5<|\eta|<3.2\), detection is performed by the Hadronic End-cap Calorimeter (HEC), which is based on copper absorbers and also uses liquid argon as sampling material. In the very forward directions, the Forward Calorimeter (FCal) covers the region from \(3.0<|\eta|<4.9\). Three cryostats around the calorimeter are required to keep the liquid argon sufficiently cool - one for the barrel part and one to each End-cap.

All ATLAS calorimeter parts, but the FCal, are supported by the Calo-GeoView. Their geometries and segmentation profiles are shown in more details bellow.

Figure 2: The ATLAS Calorimeter System

### LAr Calorimeter Segmentation

Figure 3 shows the segmentation for the electromagnetic calorimeter. It has three regions with different granularity levels, amounting to more than a hundred thousand readout channels. The dimensions are given in terms of ATLAS coordinates \(\eta\times\phi\) (pseudorapidity and azimuthal angle).

1. Sampling 1 (S1 or Strips region) has extremely fine granularity in \(\eta\) and a depth of 4.3 radiation lengths;
2. Sampling 2 (S2 or Middle region) has a granularity of \(0.025\times 0.0245\) and a depth of 16 radiation lengths; most of the energy of electromagnetic showers is deposited here;
3. Sampling 3 (S3 or Back region) has a coarse granularity of \(0.05\times 0.0245\) and a depth of 2 radiation lengths. This region is used to measure the tail of high-energy showers, which interact beyond S2. This region is also used to distinguish hadronic and electromagnetic showers, since the former typically deposit a larger amount of energy in S3.

The HEC is composed by two identical parts, one in each end-cap. Each part consists of two wheels, a front and a rear wheel. Each wheel contains two longitudinal cylindrical sections, comprising four detection layers per end-cap. The number of readout channels in each layer, from inner to outer, is: 1,536, 1,472, 1,344, and 1,280 respectively. The size of the readout cell is \(\Delta\eta\times\Delta\phi=0.1\times 0.1\) in the region \(|\eta|<2.5\) and \(\Delta\eta\times\Delta\phi=0.2\times 0.2\) for larger values of \(\eta\).

Figure 3: Electromagnetic calorimeter segmentation.

### TileCal Segmentation

The TileCal comprises three cylindrical parts: one barrel, which covers the rapidity range \(|\eta|<1.0\), and two extended barrel wheels, covering the rapidity range \(0.8<|\eta|<1.7\) on either side of the barrel [21]. The barrel and the two extended barrels are separated by a gap of 600 \(mm\) to provide space for Liquid Argon distribution pipes, LAr Calorimeter front-end crates and Inner Detector services. Each of the sub-detectors is composed of 64 azimuthal wedge-shaped modules. Figure 4 shows the TileCal segmentation. Each calorimeter cell is coupled to two PMTs for readout redundancy.

## 3 Trigger System

In order to identify interesting and rare physics phenomena in the bulk of the data, the ATLAS detector implements a three-level trigger (Figure 5). The last two levels form the ATLAS High-level trigger [22]. The task of the trigger system [23] is to classify events according to landmark properties and to store those that comply with a list of given descriptions (the trigger menu). The three cascaded trigger levels have different requirements and different implementation strategies:

1. **Level1** The first level (L1) trigger is optimized for maximum processing speed [7]. It processes a subset of the available data: calorimeters are read out only with coarse granularity, while fast Muon Trigger detectors are read out with full granularity. To further reduce processing time, the trigger is implemented with dedicated electronics, located as close to the detector as possible. The designed output rate from L1 is 100 \(kHz\)
2. **Level2** The second-level (L2) trigger receives input from L1 for accepted events [22]. This input consists of Regions of Interest (RoIs), which rep

Figure 4: TileCal longitudinal segmentation.

resent signal areas in the sub-detectors that are recognized by the first level trigger as containing a trigger item. The average processing time for L2 algorithms - running on multiple PCs - is 40 \(ms\).
3. **Event Filter** The Event Filter receives L2 decisions with an input rate of 1 \(kHz\), then proceeds to read out the full event data from all the sub-detectors. The processing time is expected to be on average 4 second per event, and the result is stored in a permanent repository. The Event Filter is implemented on a large farm of PCs, and the output rate for reconstructed data is 100-200 \(Hz\).

## 4 Commissioning with cosmic rays

The goal of the calorimeter commissioning with cosmic rays [24] was the performance validation of the calibrated detector, ensuring the readiness for LHC turn-on. The detector commissioning started before the triggering system was ready for full integration. Therefore, in order to acquire cosmic data, the ATLAS trigger system was bypassed and a coincidence board was assembled for performing trigger based on TileCal information [25]. Figure 6 shows how was the Tile Cosmic Trigger setup. The straight-line represents a cosmic muon crossing the center of the detector. For triggering, coincidence from both top and bottom parts of the TileCal was required. When a trigger signal was generated, data from both hadronic and electromagnetic calorimeters were recorded with full granularity. The coincidence board was fed from TileCal compacted information, which was obtained from its trigger towers. These towers corre

Figure 5: The ATLAS three-level online trigger.

spond to the analog sum of all PMTs inside \(\Delta\eta<0.1\), for each module [26]. In Figure 4, one can identify, for instance, that the first tower corresponds to the sum of signals from A1, BC1 and D0 cells.

Cosmic ray muons can be used to check various detector parameters. While the cell by cell statistics might not be sufficient, it will be possible to sum similar cells (along the \(\phi\) direction) and perform physics signal shape studies, as well as amplitude and time inter-calibrations. The problematic channels, such as having HV different from nominal voltage, dead readout channels etc, can be identified, and proper treatment of these channels can be investigated. To help in these tasks, the 3D visualization for the excited calorimeters cells has been an easy and intuitive way to identify problems.

## 5 The Visualization Tool

The presented visualization tool provides two different modules: a TileCal specific module and a combined TileCal and LAr Calorimeters module.

The first module is used to load specific TileCal reconstructed data, providing detailed information from this subdetector. The second module accesses cell energy for both electromagnetic and hadronic calorimeters. However, both pulse-shape and TileCal individual PMT information, like fitting parameters, are not available (energy information only at the cell level). Also, cosmic muon tracks computed using information from TileCal [27] are shown as well for both modules.

### The TileCal Specific Module

Figure 7 shows the Graphical User Interface (GUI) for this module. Three windows can be observed. The left-back window is the standard viewer for 3D objects in ROOT (ROOTs GL viewer). A cosmic ray event is displayed in the

Figure 6: Triggering cosmic rays with TileCal.

center. In this central window, we can identify the TileCal structure, which is shown in a transparent gray scale, the activated cells with colors depending on an energy scale and the corresponding track of the reconstructed cosmic muon. The right most window offers user controls to open, access and visualize the information for the reconstructed data. Among the information available, one can see the ADC counts for the selected cell, as it is shown in the left-front window.

The main features of this TileCal specific tool are:

* the commands are executed quickly taking less then 300 milliseconds to update the graphic for most of the regular events.
* the colors of the activated cells depend on the energy deposited in the cell. A color palette from yellow to dark red (hot palette), with 256 color levels, is provided with yellow assigned to null energy. The full energy scale, which is assigned to the dark red color, may be set by the user and can accommodate full TileCal energy range.
* TileCal has about 5,000 cells, 10,000 PMTs; in order to display only the desired cells for a given application, a cut value in \(MeV\) can be applied.
* Desired information such as energy, position and PMT channels for a specific cell is obtained by selecting the cell with the mouse.
* basic visualization commands, such as rotation, translation and zooming, can be achieved with the mouse; the desired transformation is displayed on the screen almost instantaneously.
* for TileCal specific reconstructed data, information concerning pulse shape (7 consecutive ADC measurements with 25 ns step) is available. This tool shows graphics with this information for the selected

Figure 7: TileCal specific module of this visualization tool.

cell.
* the TileCal cells can be drawn in two parts, each part representing one of the two PMTs of the cell. In this mode, each PMT receives a different color depending on its energy. With this approach one can visually inspect for problems like energy imbalance of the cell.

### The General Calorimeter Module

This is the visualization tool for the combined hadronic and electromagnetic ATLAS calorimeter. The controls are pretty much the same as the ones provided by TileCal specific tool. The threshold and the color palette can be set independently for the two calorimeters, with a bright to dark green palette assigned to EM calorimeter and yellow to dark red palette assigned to the hadronic calorimeter. The combined visualization tool has been mainly used to test algorithms for the High-Level Trigger and visualize online event reconstruction in the ATLAS control room.

### Application Examples

This section presents some applications of this visualization tool. Several commissioning aspects, like simulation validation, online monitoring and offline reconstruction were tested using the visualization facilities provided by this tool.

#### 5.3.1 HLT RoI Visualization

Figure 8 shows the CaloGeoView graphical interface where one can identify a level-two trigger Region of Interest (RoI) simulation. This figure represents a typical LHC collision simulation resulting in two electrons. Thanks to this kind of visualization, a reconstruction problem (Figure 9) related to the RoI border cells, in some events with a higher pseudorapidity angle, where outer calorimeter cells are used, has been found. One can see a smooth cell energy decay from the center cell (most energetic cell) after fixing the problem. This kind of problem is hard to be detected without 3D visualization.

#### 5.3.2 L2 feature extraction algorithm

The job of the L2's calorimeter baseline algorithm, named T2Calo [22], consists of evaluating a more precise interaction point using the available calorimeter granularity and, based on that, extract features of the cluster that may lead to a reasonable discrimination accuracy. This kind of algorithm is followed by a hypothesis making algorithm, which takes the extracted features from the target cluster and, with a simple set of cuts, is able to distinguish interesting objects with better accuracy than L1.

A _Ring-Like_ topological strategy has been proposed as an alternative for RoI feature extraction [28]. It consists on forming, for each calorimeter layer, concentric rings around the most energetic cell of the RoI. Then, the energy deposited in cells that belong to the same ring are added up. The algorithm implementation in Athena framework has been evaluated and tuned with the CaloGeoView, using simulation, where different ring layers can be seen applying different colors.

Figure 8: L2 RoI seen with CaloGeoView.

Figure 9: Problem in RoI border cells detected with CaloGeoView.

#### 5.3.3 Cosmic Ray Simulation in ATLAS

Figure 10 shows an example of cosmic ray simulation event without noise. One can see the perfect match between the truth track, generated by the Monte Carlo simulation, and the activated cells for both hadronic and electromagnetic calorimeters. Both track truth and activated cell list are read from the same reconstruction file. This kind of visualization has become important to attest and to get confidence with the simulation of cosmic rays in ATLAS.

#### 5.3.4 Commissioning with Cosmic Rays

This 3D visualization tool has been shown to be very important for commissioning with cosmic rays. In fact, several kind of problems has been detected, including dead and hot cell identification, wrong calibration constants for certain cells in the calorimeter and problems in the reconstruction algorithms. The visualization of a large number of real events with such tool, provided a good understanding of the whole ATLAS calorimeter acquisition process.

As an example of a detected problem in TileCal, it was noticed that for a cosmic run acquired during one day, besides the display of cells activated by the cosmic ray, a bunch of cells at the same TileCal module (LBA45, in this case) has been detected in several events. That indicates a noise problem in the module, forcing the replacement of its power-supply.

Figure 10: Cosmic simulation seen with CaloGeoView.

## 6 Architecture

The CaloGeoView is based on ROOT framework. The ROOT system is an Object Oriented (OO) framework for large scale data analysis [16]. Written in C++, ROOT contains an efficient hierarchical OO database, a C++ interpreter, advanced statistical analysis (multi dimensional histogramming, fitting, minimization, cluster finding algorithms) and visualization tools. The user interacts with ROOT via a graphical user interface, the command line or batch scripts. The scripting language is C++ (using the interpreter) and large scripts can be compiled and dynamically linked in. The OO database design has been optimized for parallel access (reading as well as writing) by multiple processes.

The presented visualization tool uses the ROOT Geometry Package [17], which is a package for building, browsing, navigating and visualizing detector geometries. The first step is to build the detector. This is done using primitive shapes like boxes, spheres, trapezoids, etc, and positioning each one according to the detector geometry. Once the geometry is assembled, the user can save it in a file for further manipulation. Figure 11 shows the whole ATLAS calorimeter cell geometry assembled with this package, where one can identify the hadronic and electromagnetic calorimeters. About \(200,000\) primitive shapes were needed to build the ATLAS calorimeter segmentation.

After loading the geometry file, one can navigate in the geometry and change colors and visibility of each primitive shape (the calorimeter cells). This is done through a Geometry Manager, the TGeoManager. Finally, the Visualization Manager (TGLViewer) is responsible to draw

Figure 11: ATLAS calorimeter cell segmentation implemented with the ROOT Geometry package.

screen. The TGLViewer uses a standard and powerful library for 3D graphical visualization, the OpenGL package [29].

Besides the Geometry Package, this event display uses other important graphical featuring in ROOT: the Graphical User Interface (GUI) Builder [30]. With this package, one can build custom windows, with buttons and text box to input user information and to control the operation of the program. Through the GUI, the user can choose the reconstructed event files, energy threshold, navigate through the events, etc.

Figure 12 shows the visualization tool architecture, where one can identify two software layers. The same architecture is used in both TileCal specific and general calorimeter tool, where the only difference is that the _Pulse Shape Drawer_ block is not present in the last module. The outer layer, the GUI, is responsible for receiving commands and send status to the user, providing an user-friendly interface. An inner layer, the Interface, translates the user commands to TGeoManager commands. The geometry file is loaded by the TGeoManager as soon as the program starts. Information from a specific event is stored in a local _Buffer_ for further accesses, increasing the tool speed response. A _Primitive Filter_ block decides if a specific calorimeter cell (a primitive shape in the geometry) will be shown on the screen, depending on the threshold. The color of the primitives is controlled by the _Energy to Color_ component, according to the cell energy and the color palette used. The communication between the TGeoManager and the TGLViewer is straightforward and the primitive shapes are drawn on the screen.

In terms of performance, the computational cost is strongly depends on the chosen energy threshold, since this value defines how many cells should be plotted. In other words, the time to read an entire event, assign the correct primitive colors and draw the desired cells grows with the number of plotted cells. Figure 13 shows the relation between the processing time and the number of drawn cells, performed on a regular Personal Computer (Processor Intel Centrino - 1.7 GHz). One can notice that up to a thousand of cells, the processing time is lower than 300 milliseconds. Most of the interesting events in the commissioning phase was under this limit. In fact, event visualization becomes useless for a big amount of drawn cells.

## 7 Conclusions

In the whole chain of an ATLAS event data processing, one of the final analyses is the reconstructed event visualization. With a simple visual inspection, one can check the agreement of all subsequent data processing steps, starting from trigger acceptance, passing trough the readout of all detector channels, up to decodification and reconstruction of the event in a readable way.

The presented 3D visualization tool has been extensively used in the commissioning phase of the ATLAS calorimeter system. Different kind of problems, either detected from real data acquisition with cosmic or simulated cosmic

Figure 12: Visualization tool architecture.

Figure 13: Processing time versus number of drawn cells (Processor Intel Centrino - 1.7 GHz).

rays and L2 RoI, have been discovered thanks to the CaloGeoView. The implementation of the remaining ATLAS sub-detectors, besides the calorimeters, is on the way, in order to have a more complete online 3D event display for ATLAS.

## Acknowledgements

The authors would like to thank CAPES, CNPq, FINEP and FAPERJ (Brazil), CERN (Switzerland) and European Union for their support to this work. We would also like to thank our colleagues from the ATLAS TileCal, LAr and Trigger collaborations for providing the data and for fruitful discussions concerning this work.

## References

* [1] L. Evans and P. Bryant (editors), _LHC Machine_, JINST 3 S08001, 2008.
* [2] The ATLAS Collaboration, G Aad et al, _The ATLAS Experiment at the CERN Large Hadron Collider_, JINST 3 S08003, 2008.
* [3] Eduardo Ros, _ATLAS Inner Detector_, Nuclear Physics B (Proc. Suppl.) 120, 235-238, 2003.
* [4] P. Puzo, _ATLAS Calorimetry_, Nuclear Instruments and Methods in Physics Research A 494, 340-345 (2002)
* [5] R. Wigmans, Calorimetry. _Energy Measurement in Particle Physics_, Oxford University Press, 2000.
* [6] S. Palestini, _The Muon Spectrometer of the ATLAS Experiment_, Nuclear Physics B (Proc. Suppl.) 125, 337-345, 2003.
* [7] S. Falciano, _The ATLAS Level-l and Level-2 trigger_, Nuclear Instruments and Methods in Physics Research A 384, 136-142, 1996.
* Commissioning with cosmic rays_, Journal of Physics: Conference Series, 119, 2008.
* [9] T. Pauly, _Commissioning of the ATLAS Level-1 Trigger with Cosmic Rays_, Journal of Physics: Conference Series, 110, 2008.
* [10] H. Hadavand, _Commissioning of the ATLAS Offline Software with Cosmic Rays_, Journal of Physics: Conference Series, 119, 2008.
* [11] G. Schlager, _The status and performance of the ATLAS hadronic tile calorimeter_, Nuclear Instruments and Methods in Physics Research A, 581, 393-396, 2007.
* [12][http://www.hep.ucl.ac.uk/atlas/atlantis](http://www.hep.ucl.ac.uk/atlas/atlantis). Accessed on December 21th, 2009.