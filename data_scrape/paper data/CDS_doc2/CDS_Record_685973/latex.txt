ATLAS Internal Note

INDET-NO-xxx

28.02.1996

**A Proposal to Overcome Time Walk Limitations in Pixel Electronics by Reference Pulse Injection**

K. Desch, P. Fischer, N. Wermes

Physikalisches Institut, Universitat Bonn, Germany

We analyze the impact of a finite rise time in the charges sensitive preamplifier and a response time dispersion in the discriminator on the spread of signal times for one bunch crossing (_time walk_ ) in the ATLAS pixel detector environment. The results of a simulation accounting for various effects which influence time walk are presented. It is shown that channel-to-channel variations of discriminator thresholds constitute the most serious limitation of the electronics performance, in particular the in-time efficiency of individual pixels. A method and a circuit to overcome this time walk problem are presented. We propose to inject "refresh" pulses during time holes in the LHC/SPS bunch structure to essentially eliminate threshold/delay variations between cells. It is shown that refresh pulses for calibration are necessary only at very low rate.

Introduction

At the LHC the short bunch crossing time of 25 ns in combination with the requirement of full bunch crossing identification of each hit requires very fast readout electronics. Especially in the ATLAS pixel detector, where the large number of channels (\(\approx 1.4\times 10^{8}\)) limits the power consumption per channel to \(\approx 50\mu\)W [1], the full bunch crossing identification is a challenging issue.

The spread of signal times for hits originating from the same bunch crossing (_time walk_ ) not only depends on the rise time of the preamplifier and the total charge collected in the pixel cell of interest, but also on channel-to-channel variations of the basic parameters of the frontend readout electronics. In fact, the latter appears to be a significant, if not the dominant, contribution to time walk.

## 2 Determination of Signal Times

There are two basic effects producing a delay between the time of first rise of the charge signal in the pixel diode \(t_{\oplus}\) and the time at which the information that the pixel was hit is available to the readout system. First, due to the finite charge collection and rise time of the charge sensitive preamplifier, the voltage signal at the input of the discriminator reaches the threshold at a time \(t_{signal}>t_{\oplus}\). Second, there is a delay between \(t_{signal}\) and the time \(t_{\oplus}\), at which the logic signal at the output of the discriminator is available (_discriminator response line_) which depends on the voltage by which the input signal overshoots the discriminator threshold.

For the input signal we assume a pulse shape according to

\[U(t)=U_{peak}\,\frac{t}{\tau}\,\exp\,(1-\frac{t}{\tau})\,\]

where \(U_{peak}\) is the amplitude of the signal and \(\tau\) is the peaking time (i.e. the time between \(t=0\) and the time of maximum amplitude. We define the rise time \(\tau_{rise}\) as the time between the amplitudes 10% of \(U_{peak}\) and 90% of \(U_{peak}\). For the assumed pulse shape \(\tau_{rise}=0.57\,\tau\). The time \(t_{signal}\) can be easily obtained by the condition

\[U(t_{signal})=U_{thr\,eshid}\,\]

where \(U_{thr\,eshid}\) is the discriminator threshold setting. The calculation of \(t_{\oplus}\) however is not so obvious since the functional behaviour of the discriminator response time depends on the details of the circuit's architecture.

### Pulse Height Distribution

The distribution of pulse heights from mips is assumed to be a Landau-distribution 1.

Footnote 1: The routine RANLAN from CERNLIB was used.

The critical question is what the most probable value of this distribution is. For fully depleted, non-irradiated, 300\(\mu\)m-thick Si-detectors, one expects a charge of \(Q_{mip}=23\,330\,e\). After irradiation there are charge losses due to various effects that might reduce the measured charge by a large factor. Furthermore the charge deposited in an individual hit pixelis less than the total charge produced by the traversing particle since, due to diffusion of the charge cloud, Lorentz angle effects and non-perpendicular incidence of particles, a part of the produced charge is detected in the neighbouring pixels. Although charge sharing is desired in order to improve spatial resolution, it sould the noted, that it also reduces the average pulse height by 30% to 50%. In this study, we assume three different scenarios for the most probable value of the charge deposited in a pixel cell:

* 2500 \(e\) as the abolute minimum at the end of a detector lifetime, i.e. 1/5 of the most probable value in 300 \(\mu\)m thick Silicon
* 5000 \(e\) as perhaps a reasonable value
* 8000 \(e\) as the maximum value to expect before irradiation using a 200 \(\mu\)m thick detector

### Electronics Parameters which Influence Signal Times

#### 2.2.1 Rise Time

Clearly, the rise time of the preamplifier is a crucial parameter in the electronics layout. Since it is closely related to the total power consumption of the pixel cell, it cannot be made infinitely small. Present designs typically show that a rise time between 30 ns and 50 ns can be achieved with the required maximum power consumption of 50 \(\mu\)W per pixel.

#### 2.2.2 Discriminator Response Time

For the same reason of limited power consumption, the dispersion in the discriminator response time cannot be made infinitely small. For present designs the difference in the response time for a very large signal and a signal just above threshold can well be in the order of 20 ns and more.

Since we do not know the functional behaviour of the discriminator response time as a function of the signal height, we regard the preamplifier and the discriminator as one system with an effective rise time \(\tau_{rise}^{eff}\) which is the sum of the preamplifier rise-time and the discriminator response time. In this study we assume three scenarios:

* \(\tau_{rise}^{eff}=0\)nsjust for comparison
* \(\tau_{rise}^{eff}=40\)nsasan optimistic case
* \(\tau_{rise}^{eff}=60\)nsasomething which is realistic for present designs.

#### 2.2.3 Noise

Electronics noise does not only produce spurious hits if the threshold is too low, but also smears the signal times of physical hits.

#### 2.2.4 Threshold Variations

Channel-to-channel variations of the discriminator thresholds play a dual role in the context of signal times. First, they smear the distribution of signal times in the same way as noise. Second, threshold variations (\(\sigma_{thr}\)) and noise (\(\sigma_{noise}\)) determine the lowest global threshold at which the system can be operated. The requirement that the rate of noise hits should stay below the rate of true hits (occupancy) from traversing particles implies that the threshold must satisfy

\[threshold\geq k\times\sqrt{\sigma_{n\,\text{\tiny{noise}}}^{2}+\sigma_{thr}^{2}} \tag{1}\]

with \(k\geq 4\) at design luminosity.

## 3 Results of the MC-Simulation

### Distribution of Signal Times

The impact of the previously explained effects on the signal times has been studied quantitatively with the help of a small stand alone Monte Carlo program. The parameters that can be set externally are:

* \(Q_{\text{\tiny{flip}}}\): most probable value for the charge detected in a hit pixel.
* \(\tau_{\text{\tiny{noise}}}^{eff}\): effective rise time of the electronics frontend (preamplifier and discriminator).
* \(\sigma_{n\,\text{\tiny{noise}}}\): equivalent noise charge of the electronics frontend (gaussian distribution assumed).
* \(\sigma_{thr}\): channel-to-channel threshold variations (in electrons, gaussian distribution assumed).

The global threshold is calculated from equation 1 using \(k=4\).

Figure 1 shows the distribution of the signal times for 4 scenarios. Figure (a) shows an over-idealized case with no noise, no threshold variations, a threshold at 1000 \(e\) and a

Figure 1: _Simulation of the signal times for various scenarios (explanation see text)_

signal of \(Q_{mip}=23300\,e\) for an effective rise time \(\tau_{rise}^{eff}=60\,\)ns. For figures (b),(c) and (d) \(\sigma_{noise}=100\,e\) and \(\sigma_{thr}=500\,e\) were assumed, resulting in a threshold of \(2040\,e\). The effective rise time was set to \(\tau_{rise}^{eff}=60\,ns\). Figure (b) is for \(Q_{mip}=8000\,e\), (c) is for \(Q_{mip}=5000\,e\), and (d) is for \(Q_{mip}=2500\,e\).

The black areas in figures (b),(c) and (d) indicate hits with signal times larger than 25 ns, i.e. hits which are registered too late to be identified with the correct bunch crossing. It can be seen, that for scenarios (c) and (d) a significant amount of hits is lost.

### The Role of Threshold Variations

The basic reason for the losses due to too late signal times lies in the fact, that for the choosen effective rise time of 60 ns, the threshold of 1650 e is too high to be passed early enough. The high threshold, on the other hand, is necessary because of large threshold variations in these scenarios. Lower threshold variations allow lower threshold settings and result in a better in-time-efficiency, i.e. the fraction of hits, which are registered within 25 ns. The impact of the threshold variations on the in-time-efficiency is shown in figure 2.

Here, the in-time-efficiency is shown as a function of \(\sigma_{thr}\) for the three cases for \(Q_{mip}\) as explained above. For each value of \(\sigma_{thr}\) the value of the threshold itself was calculated according to equation 1 using \(k=4\). While for the case of \(Q_{mip}=2500\,e\) the situation is not satisfactory even for very low threshold variations, for \(Q_{mip}\geq 5000\,e\), the in-time-efficiency is close to 100% when threshold variations are not larger than the noise, which was set to 100 e in these plots. The different lines in each plot indicate different effective rise times. For \(Q_{mip}=2500\,e\), it can be seen, that the efficiency loss already occurs for \(\tau_{rise}^{eff}=0\,ns\), which means that the threshold in this case is so high, that small signals never pass it.

Figure 3 shows the in-time-efficiency, now as a function of the threshold itself. Here \(\sigma_{thr}\) was calculated according to equation 1, again with \(\sigma_{noise}=100\,e\). For a low noise level, the threshold depends almost linearly on its variations. Therefore, figures 2 and 3 look similar.

Figure 4 shows the in-time-efficiency as a function of \(\sigma_{noise}\). Here it can be clearly seen, that the in-time-efficiency only very weakly depends on the noise level when it is varied

Figure 2: _Simulation of the \(in\)-time-efficiency for various scenarios as a function of threshold variations (explanation see text)_

within a reasonable range. For these plots \(\sigma_{thr}\) was set to 400 \(e\).

For present designs of the frontend electronics threshold variations are in the order of 500 \(e\). We conclude from these simulations that threshold variations have to be lowered down to the level of noise (\(\approx\) 100-200 e) in order to meet the requirement of a full bunch crossing identification with high efficiency. Clearly it is also desirable to make the frontend as fast as possible in order to keep timewalk small. Nevertheless, even for an infinitely fast frontend, threshold variations must be small. This is especially true in the situation where the collected charge is reduced due to radiation damage.

## 4 Continuous Calibration

Although there has been intensive work to minimize the threshold variations, the measured values are still in the order of 500 electrons (r.m.s.), so that these variations - and not the noise - determine the lowest possible global threshold setting.

Figure 4: _Simulation of the \(in\)-\(time\)-efficiency for various scenarios as a function of noise (explanation see text)_

Figure 3: _Simulation of the \(in\)-\(time\)-efficiency for various scenarios as a function of threshold (explanation see text)_

The design of a comparator with intrinsically low input offset voltage is a known problem in FET circuit design: FETs have fairly large variations in threshold voltages and transconductance, compared to bipolar devices. The matching of FETs gets better when large devices are operated at high current densities. However, this contradicts the strong requirements of small circuit area, low power and speed. It therefore seems that for given power, speed and area requirements there is a lower limit for the input offset voltage that can be reached in FET design.

The influence of voltage offsets in the comparator is decreased with increasing gain of the preamplifier. The value of the feedback capacitor should therefore be as low as possible. However, reduced circuit stability and gain variations due to capacitor mismatch at small values limit this possibility.

In order to lower the threshold variations furthermore, an individual adjustment for each comparator could be necessary. If such a channel by channel calibration is introduced, the matching requirements of the comparator can be very much relaxed which can lead to very simple, compact and fast designs.

The adjustment procedure should be simple in order to accomodate the huge number of channels in the pixel detector system and the setting found in each channel should remain stable for a time which is long enough so that regular'refresh'-cycles are possible during beam gaps.

The adjustment of a comparator threshold requires the possibility to inject a precisely known charge into a selected channel by applying a voltage step to a calibration capacitor. The matching of these capacitors must be as good as possible. A simple logic checks whether the comparator fires after the injection. If it does, the threshold is slightly increased, if it did not respond, the threshold is decreased in very small steps. After many cycles, the comparator fires for 50% of all calibration triggers: The threshold corresponds exactly to the injected charge. The long term stability of an analog storage scheme has to be tested with a prototype design. More complicated schemes with a digital storage of the correction values are also possible and are presently being discussed.

## 5 Proof of Principle: Tune Delay Chip

In the CERN/RD19 design for a pixel readout chip, the storage of hit data until the first level trigger arrives (2 \(\mu\)s) is realized through a constant delay circuit. The channel-to-channel variations of this delay must not exceed 25 ns in order to provide bunch crossing identification. The same self adjustment technique as for comparator thresholds is also applicable in this case. A simple concept for the automatic adjustment of the delay of a monoflop circuit is described in ref. [2]. With a fairly simple circuit, a jitter of \(\approx 1\)\(ns\) at a delay time of 2 \(\mu\)s is achieved. Due to the dynamic analog storage used in that circuit, the delay time drifts very slowly by only \(\approx 10\)\(ns\) per minute so that the refresh rate can be very low.

From figure 5 it can be seen that in LHC every 89 \(\mu\)s, there is a gap of 3.17 \(\mu\)s. We propose to use this gap for injection of a reference pulse. If only one pixel cell in a chip is calibrated at a time, each pixel cell could be refreshed every second (for roughly 10\({}^{4}\) pixels/chip). For this refresh rate the delay time is constant to better than 1 ns. Furthermore there are 11 bunch gaps of 950 ns duration which could also be used.

## 6 Conclusions And Proposal

A Monte Carlo study of the signal times in ATLAS pixel frontend electronics has been performed. It is shown, that time walk arises mainly due to large threshold variations. In order to meet the requirement of full bunch crossing identification, threshold variations must not be larger than 100 - 200 electrons. To us, this goal seems hard to achieve with current designs. We propose a discriminator whose threshold is externally calibrated during operation in order to reduce threshold variations to the desired value. The proof of principle has been given with a tune delay circuit which was shown to be operable at very low refresh rates (\(\approx\) 1 Hz).

## References

* [1] ATLAS Technical Proposal, CERN/LHCC/94-43 (1994)
* [2] P. Fischer, A. Jons, A self-adjustment technique minimizing channel to channel variations in VLSI readout chips, BN-HE-95-04 (1995), Submitted to Nucl.Instr.Meth.

Figure 5: _LHC/SPS bunch scheme._