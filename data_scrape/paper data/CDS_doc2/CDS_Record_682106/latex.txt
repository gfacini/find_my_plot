**ATLAS Internal Note**

**LARG-NO-087**

**November 24th, 1997**

**On the Stability of 0-T Preamplifier**

**G.Battistoni, D.V.Camin, N.Fedyakin, P.Ramaioli, R.Shuvalov \({}^{*}\)**

_INFN and Dipartimento di Fisica dell' Universita,_

_via Celoria 16, 20133, Milano, Italy_

\({}^{*}\) _permanent address: IHEP,Protvino,142284,Russia._

**Abstract**

The problem of the stability of the line receiver preamplifier (0-T) proposed to readout ionization signal from ATLAS LAr electromagnetic calorimeter is considered in the paper. The transport of detector signal to input of preamplifier via acable is analyzed on the basis of classical theory of wave propagation in transmission lines. It is shown that the analysis of stability can be reduced to the examination of zeros of the expression \(Z_{in}+Z_{DC}\), where \(Z_{in}\) is the input impedance of the 0-T and \(Z_{DC}\) is the impedance of the detector, as seen by the preamplifier. A method of experimental measurement of \(Z_{in}\) of preamplifier in a range 1 MHz\(\div\)200 MHz is described. Stability function \(Z_{in}+Z_{DC}\) was built by using the combination of experimental data (\(Z_{in}\)) and calculations (\(Z_{DC}\)) and was used to analyze the stability of two versions of 0-T preamplifier at different experimental conditions. It is illustrated that if locus of vector end of this semiempirical stability function makes a clockwise encirclement of zero, then preamplifier is definitely unstable.

## 1 Introduction.

The electrical circuit of the preamplifier designed to readout the signal from the LAr Accordion EM calorimeter is shown in Fig. 1. Detailed information on this preamplifier can be found in [1].

The purpose of this paper is to apply the general theory of stability to the 0-T under certain boundary conditions: i.e when this preamplifier operates with a cable at its input, in turn connected to a capacitive detector. We assume that the preamplifier is linear and of infinite power carrying capability. Let the output be connected to the input in such a way that the amplification ratio for one round trip (loop gain) is equal to the complex quantity \(A^{*}\cdot\beta\), where \(A^{*}\) is the gain of the open loop preamplifier and \(\beta\) is the feedback return ratio. Then the closed loop gain of the preamplifier can be presented in a form

\[A_{el}=\frac{A^{*}}{1+\beta\cdot A^{*}}. \tag{1}\]

Figure 1: _Schematic diagram of the preamplifier used to readout ionization signal from LAr EM calorimeter cell. The table on the insert shows required values of components to adapt the preamplifier to different dynamic ranges and detector capacitances._According to the original Nyquist paper [2], the linear circuit is considered to be stable if the Nyquist diagram for the loop gain \((\beta\cdot A^{*})\) or for the function \((1+\beta\cdot A^{*})\) of the element should not encircle the appropriate critical point (-1,0 or 0,0 respectively) in clockwise direction.

In next section we summarize the basic results of the analytic description of the **O-T** preamplifier connected to a capacitive detector through a lossless transmission line. In Section 3 we describe the measurement set-up, while in Section 4 the stability analysis is discussed. In Section 5 we show the relation between the frequency measurements and time domain performance, analyzing the signal waveforms at the output of the preamplifier.

## 2. Analytical description of the preamplifier connected to cable and detector

In the real experiment, the signal source, Fig. 2, \(I_{s}\), and the detector capacitance, \(C_{d}\), are coupled to the preamplifier, modelled by its input impedance \(Z_{in}\), via a transmission line with characteristic impedance \(Z_{o}\) (Fig. 2).

As shown in the Appendix, it can be demonstrated that the output signal of the preamplifier is given by:

\[U_{out}=U_{s}\cdot\frac{Z_{ol}\cdot A^{*}}{Z_{in}+Z_{DC}}. \tag{2}\]

where \(U_{s}\) in the voltage appearing at the receiving end of the preamplifier (node 2 of Fig. 2); \(Z_{ol}\) is the open loop impedance of preamplifier, linked to \(Z_{in}\) through the relation:

\[Z_{in}=Z_{ol}\cdot(1+\beta\cdot A^{*}), \tag{3}\]

and \(Z_{DC}\) is the impedance of Detector plus Cable as seen from node 2 along the cable towards the detecto \(Z_{d}\). If we assume the line and the detector to be ideal (no losses), the impedance of a cable loaded with a capacitance \(C_{d}\) can be rewritten using formula (2l) exactly as

\[Z_{DC}=Z_{o}\cdot\frac{Z_{d}+j\cdot Z_{o}\cdot\tan(\omega\cdot t_{d})}{Z_{o}+j \cdot Z_{d}\cdot\tan(\omega\cdot t_{d})}=\frac{\frac{1}{j\omega C_{d}}+j\cdot Z _{o}\tan(\omega t_{d})}{1+\frac{\tan(\omega t_{d})}{\omega Z_{o}C_{d}}}=j\cdot \frac{\frac{-1}{\omega C_{d}}+Z_{o}\tan(\omega t_{d})}{1+\frac{\tan(\omega t_{ d})}{\omega Z_{o}C_{d}}}. \tag{4}\]

The problem of stability can be reduced to the examination of zeros of the denominator of the rightmost part of eq. (25) instead of the Nyquist function \((1+A^{*}\cdot\beta)\), provided that the open-loop impedance \(Z_{ol}\) and \(A^{*}\) have no singularities. Then the criterion for stability of the 0-T preamplifier can consequently be stated in the following words:

* The system is unconditionally stable if the locus of the sum \(Z_{in}+Z_{DC}\) will not encircle critical point \((0,0)\) in a clockwise direction.

It is seen that \(Z_{DC}\) is a pure reactance, oscillating in frequency domain between inductive and capacitive, therefore, if the real part of \(Z_{in}\) is positive in the relevant frequency range, then the encirclement of the sum \(Z_{in}+Z_{DC}\) around the point (0,0) can never occur.

## 3 Measurement of preamplifier input impedance.

We have measured the dependence of the input impedance of 0-T preamplifiers on a frequency range 1 MHz\(\div\) 200 MHz using a Network/Spectrum Analyser HP4195A. The sketch of measurement setup is shown in Fig. 3.

The reflection coefficient \(S_{11}=S_{x}+j\cdot S_{y}\) is determined by the instrument by measuring the ratio of an incident signal to the reflected signal in the frequency range 1 MHz \(\div\) 200 MHz. Then the real \(R\) and imaginary \(X\) parts of the input impedance \(Z_{i\,n}\) are evaluated using the relations

\[R = Z_{o}\cdot\frac{1-S_{x}^{\,2}-S_{y}^{2}}{(S_{x}-1)^{2}+S_{y}^{\,2}}\] \[X = Z_{o}\cdot\frac{2\cdot S_{y}}{(S_{x}-1)^{2}+S_{y}^{\,2}} \tag{5}\]

The original version of a 25\(\Omega\)/10 mA preamplifier, presented in the Technical Design

Figure 2: _Transmission of a signal \(I_{s}\) from a detector of impedance \(Z_{d}\) to a preamplifier of impedance \(Z_{i\,n}\) via a cable with a characteristic impedance \(Z_{o}\). The \(U_{\pm}\) are direct and reflected waves, respectively._Report of LAr ATLAS Calorimeter ([4]) and fabricated in Italy (NeOhm, Torino), was equipped with a slow transistor 2N3906 (\(Q_{4}\), \(f_{T}\)=250 MHz) in White's follower output stage and \(L_{2}=10\) nH (see for reference Fig. 1). It exhibited very low margin of stability. The measured \(Z_{in}\) characteristics, drawn in the complex plane, as the frequency runs from 1 MHz to 200 MHz, is shown in Fig. 4 (curve PA1).

## 4. Stability analysis, based on \((Z_{DC}+Z_{in})\).

It is clearly seen that there exists a frequency range where PA1 shows Real\((Z_{in})<0\). Adding imaginary expression \(Z_{DC}\) to \(Z_{in}\) causes deformation of curve PA1 in y-direction (shown by arrow in Fig. 4). Encirclement around zero of sum \(Z_{in}+Z_{DC}\) is possible for some values of cable length and detector capacitance \(C_{d}\), which can be illustrated in Fig. 5 and 6 by simulating \((Z_{in}+Z_{DC})\) functions, built up by measured \(Z_{in}\) and computed \(Z_{DC}\) (formula (4)) characteristics.

In Fig. 5 cable connection was short (\(\approx\)2 cm) and detector capacitances were varied from 18 pF, 330 pF to 1500 pF. In Fig. 6, on the contrary, \(C_{d}=330\) pF was fixed and cable lengths were altered from 2 cm, 30 cm, 1.7 m to 4.5 m. One can see that the

Figure 3: _Schematic diagram of the set-up to measure input impedance of 0â€“T preamplifiers. The HP4195A Network/Spectrum Analyser is configured for S-parameters measurements and it is connected to the device under test (DUT) via the HP41952A transmission/reflection test box containing a power splitter and a directional coupler. The power splitter (6 dB) returns the generator signal from the S port to the reference port R, while the directional coupler is used to detect the signal reflected from DUT._

Figure 4: \(Z_{\mbox{\tiny in}}\) _diagrams of preamplifiers equipped with \(Q_{4}=2N3906\) (\(f_{T}=250\) MHz), \(L_{\,2}=10\) nH (PA1) and \(Q_{4}=\) BF \(660\) (\(f_{T}=700\) MHz), \(L_{2}=0\) nH (PA2), correspondingly. Critical point is (0,0). The frequency span is from 1 MHz to 200 MHz. Vertical arrows indicate the direction of curve deformations after adding \(Z_{DC}\)._

Figure 5: \(Z_{in}+Z_{DC}\) diagrams of preamplifier PA1, simulated using experimental \(Z_{in}\) characteristics and calculated \(Z_{DC}\) for \(C_{d}\)=18 pF, 330 pF and 1500 pF and short cable. Start and stop frequencies of frequency span are indicated in the figure. The portion of diagram at \(C_{d}\)=330 pF shows encirclement around zero in more details. The frequency of oscillations corresponds to transition through zero of imaginary part and is equal to 45 MHz.

Figure 6: \(Z_{in}+Z_{DC}\) diagrams of preamplifier PA1, but simulated at fixed \(C_{d}\)=300 pF and various cable lengths ( indicated in the figure). Plot at \(l_{cable}=\)30 cm represents a stable situation. Plots at \(l_{cable}=\)2 cm, 1.7 m and 4.5 m, on the other hand, represent an unstable situation.

curves in Fig. 5, corresponding to 18 pF and 1500 pF, do not enclose zero, but at 330 pF this point is found in the interior of the contour (zoomed portion of the 330 pF curve is reproduced in the rightmost down position of Fig. 5) and it represents an unstable situation. The directions in which the plots are traced as frequency varies from start to stop are indicated by the arrows. Fig. 6 illustrates that with a detector capacitance of 330 pF, unstable at short connection, one can find the system stable or unstable varying the cable length. Preamplifier is stable for connection length of 30 cm and it is unstable for another cable lengths (2 cm, 1.7 m, 4.5 m). Examination of the expression (4) for \(Z_{DC}\) shows that it oscillates between capacitive and inductive making an infinite series of zero transitions. Therefore it can be represented by a series resonant circuit with infinite number of resonant frequencies, corresponding to all zero transitions of \(Z_{DC}\) from capacitive path to inductive path. Moreover, in the small frequency interval around any resonant frequency, we can substitute the real detector-cable-preamplifier network with a series combination of a capacitance \(C\), an inductance \(L\) and a resistance \(R\), the last being equal to real part of \(Z_{in}\) at a given frequency \(f=\frac{1}{2\pi\sqrt{L\cdot C}}\). Negative value of \(R\) at frequency \(f\) maintains the oscillations stable at that frequency and the system is unstable. If, on the contrary, \(R(f)>0\), then this resistance dissipates the energy of the resonant network and the system is stable, although there are two kind of responses: oscillatory and aperiodic modes. Aperiodic solutions appear only when the preamplifier damps the oscillations at resonant frequency:

\[Q=\frac{2\cdot\sqrt{\frac{L}{C}}}{R(f)}=\frac{2\cdot Z_{zh}}{R(f)}<1. \tag{6}\]

In Fig. 7 we show zero transitions of total reactances (\(Z_{DC}+Imag(Z_{in})\)) at cable lengths L=30 cm, 2 cm and 1.7 m, in the frequency interval where \(Real(Z_{in})<0\).

Two transitions (at L=2 cm and L=1.7 m) occur when \(Real(Z_{in})<0\), and no damping is possible, while the transition, corresponding to L=30 cm, occurred at frequency for which \(Real(Z_{in})\approx.5\Omega\) and in that case preamplifier represents a stable system, although ringing. The characteristic impedance of resonant circuit \(Z_{zh}\) can be calculated by taking the slope of imaginary part at zerocross point, multiplied by the value of corresponding resonant frequency. From Fig. 7 we find, that \(Z_{zh}\approx 40\Omega\), and \(Q\approx 80\).

## 5. Signal waveform measurements.

To illustrate the relation between frequency measurements and time domain performance we have measured with a digital oscilloscope HP54510A the signal responses of the preamplifier, coupled via a cable of variable length (2 cm, 30 cm and 1.7 m) to a detector with capacitance 330 pF (Fig. 8) and then, directly ( cable length 2 cm) to a detector with variable capacitance \(C_{d}=18\) pF, 50 pF, 330 pF and 1500 pF (Fig. 9).

The responses of preamplifier (marked PA1) in case of direct coupling without shaper and after \((RC)^{2}-CR\) shaper with \(\tau=20\) ns are shown in left columns of Fig. 9 and Fig. 10, correspondingly.

The excitation of preamplifier in all cases has been done by the injection of exponential current source with \(\tau=400\) ns, which reduces the ringing at high frequencies. ItFigure 7: _Zero crossing of imaginary part of PA1 stability function (\(Z_{DC}+Z_{in}\)) in a frequency interval, where Real\((Z_{in}<0,\) for three values of cable length L=2 cm, 30 cm, and 1.7 m. \(C_{d}=330\) pF._

Figure 8: _The measured signal responses of the original preamplifier version (PA1) to an exponential current input signal (\(\tau=400\) ns), injected via cable of variable length: 2 cm, 30 cm and 1.7 m. \(C_{d}=300\) pF. The preamplifier PA1 is unstable at \(l_{\text{c}\text{a}\text{l}}=2\) cm and 1.7 m, but is stable at \(l_{\text{c}\text{a}\text{l}}=30\) cm._

Figure 9: _Signal waveforms of preamplifiers PA1 and PA2, taken with the digital oscilloscope HP54510A for 4 values of detector capacitances: \(C_{d}=\)18 pF, 50 pF, 330 pF and 1500 pF. The cable between detector and preamplifier is very short. The input current had an exponential wave-form with \(\tau=400\) ns. PA1 is unstable at \(C_{d}=330\) pF and has ringing at \(C_{d}=50\) pF. At \(C_{d}=18\) pF PA2 gives more ringing than PA1._

Figure 10: _PA1 and PA2 responses at the same conditions as in Fig. 11, but after \((RC)^{2}--(CR)\) sharper with \(\tau=20\) ns._

is seen that the preamplifier time domain correlates quite well with Nyquist diagrams. Making single measurements of \(Z_{in}\) it is possible to simulate later any experimental condition and to evaluate the margin of preamplifier stability. According to its specification, this preamplifier should read out calorimeter cells with high value of detector capacitance (1500 pF \(\div\) 2200 pF). To make the preamplifier more stable and to fit better the requirements of ATLAS, we have done the following modifications (in this paper we refer it as PA2): we have put as \(Q_{4}\) fast pnp-transistor BF660 (\(f_{T}\) = 700 MHz) instead of 2N3906 (\(f_{T}\) = 250 MHz) and have reduced \(L_{2}\) down to zero. The measured \(Z_{in}\) characteristics of the modified preamplifier is shown in Fig. 4 (curve PA2), which does not have negative real part in the frequency range of interest and any deformation in y-direction cannot cause unstable condition of operation. We have measured the signal waveforms of the modified preamplifier before (right column in Fig. 9) and after an \((RC)^{2}--CR\) shaper (right column in Fig. 10) under the same conditions like PA1. Looking at rightmost signal waveforms in Fig. 9 and Fig. 10 one can conclude that the modification makes the response of preamplifier PA2 much more stable and less ringing for high value of capacitances (\(C_{d}\) = 1500 pF and 330 pF), although at low capacitance values the response of PA2 is slightly more ringing than PA1. To explain it we have put in the upper part of Fig. 11 the measured frequency dependencies of real and imaginary parts of \(Z_{in}\) and in lower part we have put experimental \(Imag(Z_{in})\), where we have superimposed \(Imag(Z_{in}+Z_{DC})\) built for \(C_{d}\)=1500 nF and 18 pF.

The network (PA1 + 1500 pF) has a resonance at frequency 40 MHz, when PA1 has very small resistance (\(\approx\) 1\(\Omega\)) and its response is oscillating. Instead, network (PA2 + 1500 pF) is resonated at 60 MHz, where its resistance is much higher than that of PA1 (\(\approx\) 9\(\Omega\)), while the slope of \(Imag(Z_{in}+Z_{DC})\) is practically the same in both cases. That is why the response of PA2 is aperiodic. Decreasing the capacitance to 18 pF, the resonance is moved to higher frequencies (\(\approx\) 100 MHz) and PA1 becomes almost aperiodic, while PA2, on the contrary, oscillating. Arrows in Fig. 11 indicate the frequency ranges, when the preamplifier PA1 is unstable, oscillatory or aperiodic, respectively.

## Conclusions.

The conventional technique of studying circuit stability, implies determination of the loop gain \(\beta\cdot A^{*}\) of circuits, which requires opening of the feddback loop. In some cases this would change the circuit DC bias. In other cases, for example with monolithic preamplifiers, opening the loop is simply impossible Needless to say that to control stability in large experiments, the measurements should be done for any possible combination of detector impedance and cable length. What we need is a way to make these measurements without opening the loop or changing the internal loading of the circuit and to adapt single stability measurements to a variety of different conditions, when detector capacitance and cable length for every cell vary in very small steps.

Nyquist diagrams of \(Z_{in}+Z_{DC}\) built up from experimental \(Z_{in}\) and theoretical \(Z_{DC}\), is shown to be well correlated with the time domain performance. Then, by doing single measurement of \(Z_{in}\), one can evaluate stability for an arbitrary range of \(Z_{DC}\) values. According to an impedance measurement technique [5], the network analysis method has very good accuracy when unknown impedance is close to the characteristic impedance Figure 11: _Frequency dependencies of Real(\(Z_{in}\)) and \(Imag(Z_{in}+Z_{DC})\) of preamplifiers PA1 and PA2 in a range 1 MHz \(\div\) 200 MHz. Imaginary part is built from experimental \(Imag(Z_{in})\) (marked \(Z_{DC}=0\)) and computed \(Z_{DC}\) for \(C_{d}=1500\) pF and 18 pF. Arrows indicate the position of resonant frequencies._

of line (and it takes the place in our case) in a frequency range above 300 kHz. The measurement of impedance allows to judge the margin of stability of the preamplifier on the base of a single measurement, without altering the feedback. Finally, we conclude that by keeping positive the real part of the preamplifier input impedance, with sufficiently large margin, we have the assurance of stable operation and aperiodic response of 0-T preamplifiers for any values of cable length and detector capacitance in a large experiment.

## References

* [1] Chase R.L. and S.Rescia. A linear low power remote preamplifier for the ATLAS liquid argon EM calorimeter. Proc. of 2nd Workshop on Electronics for LHC Experiments Balatonfured, Hungary, September 23-27, 1996, CERN/LHCC/96-39,(1996),pp.58-60.
* [2] H.Nyquist. Regeneration theory. B.S.T.J., Jan.1932, pp.126-147.
* [3] Hendik W.Bode. Network analysis and Feedback Amplifier Design. N.Y. D.van Nostrand Company, Inc. 250 Fourth Avenue, 1945.
* [4] ATLAS LARG Unit. Liquid Argon Calorimeter. Technical Design Report. CERN/LHCC 96-41,(1996),p.403.
* [5] M.Honda. A Guide to measurement Technology and Techniques, Yokogawa-Hewlett-Packard LTD, 1989.

## Appendix

The voltage (current) at any point of a transmission line is a superposition of two waves travelling from detector to preamplifier \(U_{+}(I_{+})\) and back \(U_{-}(I_{-})\). For the sake of convenience we take as a starting point \(x=0\) the receiving end of cable (node 2 at Fig. 2). Then, at the sending end the phase shift will be \(exp(j\omega\cdot t_{d})\), where \(t_{d}\) is the delay time of cable. The expressions for voltages at the sending (node 1) and receiving (node 2) ends are:

\[U_{1} = U_{+}\cdot e_{+}+U_{-}\cdot e_{-} \tag{7}\] \[U_{2} = U_{+}+U_{-}, \tag{8}\]

where \(e_{\pm}=exp(\pm j\omega\cdot t_{d})\), while the currents, flowing into the same nodes, being

\[I_{1} = I_{+}\cdot e_{+}+I_{-}\cdot e_{-} \tag{9}\] \[I_{2} = I_{+}+I_{-}. \tag{10}\]

The last pair of equations (9 and 10) can be modified using the definition of characteristic impedance of cable \(Z_{o}\)

\[Z_{o}=\frac{U_{+}}{I_{+}}=-\frac{U_{-}}{I_{-}}. \tag{11}\]