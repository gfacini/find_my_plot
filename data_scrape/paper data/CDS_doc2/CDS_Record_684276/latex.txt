**Avoiding rate limitations**

**in the staging of the LArg ROD system**

Frederic Henry-Couannier, Emmanuel Monnier, CPPM - Marseille

Louis Fayard, Pierre Matricon, LAL - Orsay

Fabrice Hubaut, Bertrand Laforge, LPNHE - Paris

16 November 2001

## Introduction

Technical discussions are ongoing to finalize the LArg ROD system. In this framework, staging issues are debated. Different options are under discussion to reach the best compromise between start up performances and cost reductions. In this note, we try to summarize some of the possible choices. Then, we address important issues that should not be neglected, to our opinion, if a staging scheme has to be implemented in the LArg ROD system.

A typical LArg ROD board is designed to work at a trigger rate of 100 kHz and to receive Front-End Boards (FEB) data at a 16bits(r)80MHz rate per FEB. Processing units (PU) perform various data treatments. Then selected data are sent via S-links to the Read-Out Buffers (ROB) (32bits(r)40MHz per link). The density of PU cards (and FEB data treated) depends on the level of integration of the ROD board. Several density options are considered at present. As an example and for the simplicity of this note, only the case of the read-out of 8 FEBs (V8) will be discussed. But a V16 option is also under consideration by the LArg community and most of the concerns expressed in this note are also relevant for this option.

In the following figure, a fully populated V8 unit of the ROD system is represented:Its characteristics are:

* The ROD module receives raw events from 8 FEBs
* The events from 2 FEBs are processed in the Processing Unit (PU) by 2 DSPs (in the absence of staging)
* The processed events are sent to the ROBs through a transition board by S-Links
* The output data bandwidth is typically one half of the input bandwidth

This general schematic will be used all along the note to illustrate the discussion.

## 2 Staging implication on the hardware

Any staging scenario applied on the ROD design will have different implications in function of the staged components. Furthermore, possible staging of upstream or downstream components may as well impact the design. Before any further consideration, here is a selection of some typical staging cases applied on the V8 system. On each figure, the red (boldface) arrows are the communication paths needed in the corresponding staging phase.

### Half PUs and half ROBs are present

One PU processes the data from 4 FEBs instead of 2. It is considered that one PU is insufficient to fully process the required algorithms on these 4 FEB data. This will imply to further equip the ROD module with 4 PUs in a second stage.

At the output level, the amount of data transmitted to the ROBs has to be compatible with an output data bandwidth reduced to a quarter of input bandwidth. However, different processes may be done by the PU at the beginning of ATLAS to exercise and understand the different parts of the detector electronics. The time budget of these processes will impact the sustainable trigger rate at the input. The trigger rate can also be limited by the hardware implementation of the staging on the Mother Board. **But we do think that such a situation has to be avoided to prevent the Liquid Argon electronics from limiting the overall Atlas trigger rate.**This example shows how some flexibility can be useful if some parts of the detector (FCAL?) need more output bandwidth.

## Need for flexibility

The previous section shows that any staging complicates the hardware and therefore adds up to the project cost. In addition, further flexibility also adds up to the overall cost.

But, even at the beginning, we do consider that the following physics requirements are important whatever staging is applied:

* The LArg staging should not limit the Atlas trigger rate
* Even with insufficient processing power on the ROD modules, some tradeoffs between the trigger rate and the processing time should be possible
* It is desirable to get all the available output bandwidth

In addition, five years before the start of the LHC, the staging impact on the different parts of the detector is not yet known. So large flexibility should be required, even if, from the hardware point of view, flexibility at the input and at the output of the PU induces:

* More communication busses on the motherboard PCB
* Possible need for larger FPGA chips
* Revisited connectors

Since on the positive side, flexibility allows to:

* Implement a non-limiting motherboard
* Face several staging schemes
* Take into account PU upgrades

## Data flows and rates

For a nominal trigger rate (100 kHz), the event data saturate the communication channels both at the input and at the output of the PU. From the input to the output, a 2:1 data reduction leads to admit that the Output Controllers (OC) feed the S-Links at their full speed of 32 bits at 40 MHz.

However, the DSP has some margin on its input and output ports. It can transfer data at more than 80 MHz and it can process data during input or output transfers.

In the following figure, the DSP takes the data from the serial to parallel FPGA (S2P) to its 64-bit bus EMIFA (external memory interface A), processes the preceding data and transmits the processed data to the output FPGA on its 16-bit bus EMIFB.

Whether the DSP code can do Direct Memory Accesses (DMA) and processing in parallel or not, three action durations can overlap:

* Input DMA transfer
* Processing
* Output DMA transferIf the speed of the transfers is a limiting factor or for an increased safety margin, the use of the DSP EMIFA port as a main data bus alternatively for input and output is a very interesting and elegant solution. (Cf. the note ATL-LARG-2001-20 by F.Henry and E.Monnier, CPPM, and the note by N.Chevillot, LAPP). In addition, such a solution can allow the use of EMIFB as a spying bus to transfer data to the local DAQ.

The following figure shows the DSP acting as a coprocessor of the FPGA. The data to be processed can be transferred at the maximum rate on the EMIFA bus (up to 150 MHz) since the FPGA and the DSP can be very nearby or one over the other one, and the links are short and point-to-point. The event data samples to be transmitted to the output are already present in the FPGA.

## Conclusion

As a conclusion, we want to emphasise that the hardware of the motherboard should be designed in a flexible way as proposed in this note. In this way it will allow all staging scenarios with no limit on the trigger rate. This should reduce any possible negative impact coming from a staged ROD system. The PUs should also be designed accordingly in order to fulfil this requirement.