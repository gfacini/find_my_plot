Using Time Convolution Method to compute Optimal Filtering Coefficients for LARG electromagnetic calorimeter.

**Damien Prieur**

**LAPP - Annecy - France**

5\({}^{th}\) January 2005

###### Abstract

In this note we describe a method using time convolution to predict the physics pulse shape, starting from the calibration pulse shape, in order to compute the optimal filtering coefficients to reconstruct energy and time for electromagnetic cells of the liquid argon electromagnetic barrel calorimeter. Using this method, the uniformity of response to the cells inside a barrel module remains inside 0.6%.

Motivations

The goal of this note is to describe how a method can be provided to do an electrical calibration of the barrel part of the ATLAS electromagnetic calorimeter. The resolution of the reconstructed energy must meet the LHC physics requirements [4], i.e. the global constant term has to be smaller or equals to 0.7% over the full detector region.

In order to achieve this, the energy deposited in the electromagnetic calorimeter is reconstructed using an optimal filtering method [2]. Sets of optimal filtering coefficients have to be produced for each channel of the calorimeter. To compute these coefficients we need to have an analytical expression of the recorded physics pulses and their derivatives. If the shape of the signal can be rather well modelled when it is produced in the liquid argon, the recorded signal at the level of the readout is affected by several electrical effects which deform it so that it cannot be easily described in an analytical way.

The current work carry on the method developed in [8] in which an algorithm is proposed to predict the shape of the physics pulses from the calibration pulses so the optimal filtering coefficients can be computed. The method makes use of the fact that most of the signal path is the same for calibration and physics pulses and can therefore be factorized. This method has been evolved and the ATLAS readout chain is now described by a more refined electrical model. A simpler computation algorithm is also used to get rid of any possible numeric artefact that could lead to systematical biais at the energy reconstruction stage. All of this work has been integrated into _EMTB_ the standard testbeam reconstruction framework [7] and also into _ATHENA_, the ATLAS reconstruction software used for the analysis of the ATLAS 2004 combined run.

## 2 Electrical description of ECAL

### Readout chain

One readout channel of the electromagnetic calorimeter can be modelled as the electric circuit drawn on figure 1. A detection cell is equivalent to a capacitance of value \(C_{d}\). The physics pulse \(S_{p}\) is injected at the level of this detection capacitance.

The path followed by the signal can be modelled by:

* a cable of inductance \(L_{d}\) and a resistance \(r\) up to the motherboard
* the readout chain which does not need to be precisely modelled as it is the same for the calibration and the physics signal

The calibration signal \(S_{c}\) does not follow exactly the same path. It is injected in the readout chain at the level of the mother board and thus does not see the impedances \(L_{d}\) and \(r\). However the rest of the readout chain from the motherboard to the front-end board is common to both physics and calibration signal which are affected by the same electrical effects, such as reflections and cross-talk in the readout lines.

### Physics current

The physics pulse \(S_{p}(t)\) is induced from the drift of ionization electrons in liquid argon. The signal has a typical triangle shape that can be expressed as following:\[S_{p}(t)=I_{0}\ \theta(t)\left(1-\frac{t}{\tau_{d}}\right)\theta(t-\tau_{d}),\ \ \ I_{0}=\frac{Q_{0}}{\tau_{d}} \tag{1}\]

where \(Q_{0}\) is the total created charge and \(\tau_{d}\) is the drift time of electrons in liquid argon. The value of \(\tau_{d}\) is close to \(450\ ns\).

### Calibration current

The calibration boards have been designed so that the non-uniformity between the 128 channels is smaller than 0.2%, so that the contribution to the constant term due to the calibration is less than 0.25%. The calibration signal \(S_{c}(t)\) is produced by a pulser circuit located on the calibration board [3]. The calibration pulse is a decreasing exponential as following:

\[S_{c}(t)=I_{0}\left(e^{-\frac{t}{\tau_{c}}}\left(1-f\right)+f\right) \tag{2}\]

where \(\tau_{c}=340\) ns is the exponential decay time. This parameter has been adjusted so that the beginning of the calibration pulse is similar to the physics pulse. The parameter \(f\) is the ratio of resistors composing the pulser circuit located on the calibration board and it is fixed to 0.065.

## 3 Prediction of physics pulse

To have a complete electrical description of the electromagnetic calorimeter is not an easy task since, as said previously, the signal suffers deformations from several sources. Trying to take into account these electrical effects would lead to add a non-negligible amount of free parameters [8] that would be hard to constrain in order to provide a reliable electronic calibration. Since both the calibration and the physics pulses follow nearly the same way,

Figure 1: Electrical scheme used to model one readout channel of the electromagnetic calorimeter. This model is enhanced, w.r.t. previous models, by the addition of a resistor \(r\) in series with the self \(L_{d}\). \(C_{d}\) represents the cell capacitance, \(R_{pa}\) the preamplifier impedance and S the shaper. \(S_{p}\) shows where the physics signal is collected on the electrode and \(S_{c}\) where the calibration signal is injected on the motherboard situated on the module themselves.

this missing information can be extracted out of the calibration pulse and used to predict the shape of the physics shape.

### Description of the Method

From this point we work in Laplace domain. The Laplace transform of the physics signal after shaping \(\tilde{P}_{p}(s)\) can be expressed as the product of three functions:

\[\widetilde{P}_{p}(s) = \widetilde{H}_{ro}(s)\widetilde{D}_{p}(s)\widetilde{S}_{p}(s) \tag{3}\] \[with \widetilde{D}_{p}(s) = \frac{w_{0}^{2}}{s^{2}+w_{0}^{2}s\left(\tau_{r}+\tau\right)+w_{0} ^{2}} \tag{4}\]

where \(w_{0}\equiv 1/(L_{d}C_{d})\), \(\tau_{r}\equiv rC_{d}\) and \(\tau\equiv R_{pa}C_{d}\). The function \(\widetilde{S}_{p}(s)\) is the Laplace transform of the physics current, \(\widetilde{D}_{p}(s)\) is a transfert function which describes the injection point of the physics signal and \(\widetilde{H}_{ro}(s)\) which describes the electrical path common to both physics and calibration. The function \(\widetilde{H}_{ro}(s)\) includes all effects induced by readout cables and electronic that are not well known and hard to describe with an electrical model.

We can write down a similar relation for the calibration signal after shaping:

\[\widetilde{P}_{c}(s) = \widetilde{H}_{ro}(s)\widetilde{D}_{c}(s)\widetilde{S}_{c}(s) \tag{5}\] \[with \widetilde{D}_{c}(s) = \frac{s^{2}+w_{0}^{2}+sw_{0}^{2}\tau_{r}}{s^{2}+w_{0}^{2}s\left( \tau_{r}+\tau\right)+w_{0}^{2}} \tag{6}\]

where \(\tilde{S}_{c}(s)\) is the Laplace transform of the calibration current, \(\tilde{D}_{p}(s)\) is a transfert function which describes the injection point of the calibration signal and \(\tilde{H}_{ro}(s)\) is the same transfert function than for physics since calibration follows the same path as physics.

By taking the ratio of Eq. (3) and Eq. (5) we can eliminate the unknown function \(\tilde{H}_{ro}(s)\) and obtain the following relation between \(\widetilde{P}_{p}(s)\) and \(\widetilde{P}_{c}(s)\):

\[\widetilde{P}_{p}(s) = \widetilde{G}(s)\widetilde{P}_{c}(s) \tag{7}\] \[with \widetilde{G}(s) = \widetilde{R}_{s}(s)\widetilde{R}_{d}(s)=\frac{\widetilde{S}_{p} (s)}{\widetilde{S}_{c}(s)}\frac{\widetilde{D}_{p}(s)}{\widetilde{D}_{c}(s)} \tag{8}\]

The \(\widetilde{G}(s)\) function depends on the ratios \(\widetilde{R}_{s}(s)\) and \(\widetilde{R}_{d}(s)\). The first one represents the difference of shape between the physics signal and the injected calibration signal. The second one represents the difference of injection point between the two signals. With the current detector readout model (Fig. (1)) these last two terms are expressed as following:

\[\widetilde{R}_{s}(s)=\frac{\tau_{d}s+e^{-\tau_{d}s}-1}{s\tau_{d}}\frac{s\tau_ {c}+1}{s\tau_{c}+f} \tag{9}\]

\[\widetilde{R}_{d}(s)=\frac{w_{0}^{2}}{w_{0}^{2}+\tau_{r}w_{0}^{2}s+s^{2}} \tag{10}\]

Going back to the time domain, the relation (7) becomes:

\[P_{p}(t)=\int_{0}^{t}G(t-\theta)P_{c}(\theta)d\theta \tag{11}\]The physics pulse \(P_{p}(t)\) can be expressed as the time convolution of the calibration pulse \(P_{c}(t)\) and the function \(G(t)\).

The function \(G(t)\) is analytically computed from \(\widetilde{G}(s)\) (Eq. (8)) by doing an inverse Laplace transformation. This has been done using Mathematica [6].

With this method, by knowing the calibration pulse shape, we are able to predict the shape of the physics signal. The function \(G(t)\), and therefore the predicted signal, relies on five parameters coming from the readout model (figure 1). Theses parameters are \(\tau_{c}\), \(\tau_{d}\), f, \(w_{0}\), \(\tau_{r}\).

Not all the parameters values are well known, especially \(\tau_{d}\), \(w_{0}\) and \(\tau_{r}\). In order to constrain them and to have normalized physics pulse shape for each readout channels, we fit the predicted physics signal to real physics data taken during testbeam periods. Each physics pulse shape is a sets of 175 samples with a bin width of 1 ns. Each bin is an average value of the recorded data over all events.

### Fit procedure

Many calibration pulses have been recorded during the testbeam delay runs. Each calibration pulse is composed of 175 samples with a one nanosecond sampling step.

Physics pulses are predicted from the calibration signal using the method described previously. For each readout channels they are fit to the real physics data by minimizing the following \(\chi^{2}\):

\[\chi^{2}=\overrightarrow{y}^{2}-\frac{\left(\overrightarrow{f}^{t} \overrightarrow{y}\right)^{2}}{\overrightarrow{f}^{2}} \tag{12}\]

where \(\overrightarrow{y}\) is a vector of physics samples and \(\overrightarrow{f}\) is a vector of the predicted physics samples.

The physics pulse is distorted by reflections in the coaxial cables. These reflections affect mainly the end of the signal. As these effects are not fully taken into account in our electrical model, we limit the fit range to the first 160 nanoseconds of the recorded signal.

The \(\chi^{2}\) depends on four parameters:

* \(w_{0}^{2}\)
* \(\tau_{r}\)
* the starting time of the calibration pulse \(t_{cal}\)
* the starting time of the physics pulse \(t_{phys}\)

The signal is not always sampled at the same absolute position.?From one channel to another the timing of the incoming signal can be slightly different. These differences come from the fact that the time of flight of the particles and the total length of the electrical readout circuit change with the \(\eta\) position. For each readout channel the starting time of the calibration pulse \(t_{cal}\) is estimated by finding the 1% rising time of the pulse. The time offset \(t_{phys}\) represents the time delay that must be applied to the predicted physics pulse to superimpose it to the real physics pulse. It is a free parameter during the fit procedure. The predicted physics pulse is computed using the relation (11). The convolution between the calibration pulse and the function \(G(t)\) is evaluated either by a basic and fast trapezoid algorithm or either by using a more time consuming Simpson'salgorithm. Since no significative differences in the reconstructed energy has been observed between the two algorithms, only the first algorithm is used.

The predicted physics pulse is interpolated using ROOT [1] Tspline objects. Thus non-integer time shift \(t_{phys}\) can be applied in order to make the real and the predicted pulses match together during the fit procedure.

### Results on Module P13

The method described in this paper has been applied to the 2002 testbeam data and the results are shown here. The chosen electrical model parameters values and their status in the fit are summarized in the table 1.

The result of the fit for several cells can be seen on figures 2, 3 and 4. The global shape of the pulses change with the considered layer. This is mainly related to a significant change of cell's surface and so to a variation of capacitance between different layers. Cross-talk effects between adjacent cells and reflections in the cable lines have also some contribution to this deformation. As these effects are not taken into account in the detector model we use, this has some minor influence on the overall quality of the fit.

The P13 runs from 2002 testbeam had suffered from a data acquisition problem and the physics shape for back layer cells are not usable. As replacement of these bad physics pulses, we have used the calibration pulses. Even if it is not correct, the introduced biais is small and it is better than having no optimal filtering coefficients at all for the back layer.

The residuals at the peak location have to be as small as possible in order not to introduce important biais at the energy reconstruction stage. On the figure (5) we can see that the residuals are below 0.5% for the front layer and of the order of 1% for the middle layer.

In [8] it is showns that if the residuals are below 1% across the pulse shape and below 0.5% at the peak, the contribution to the constant term is 0.3%.

The results presented here are therefore compatible with a small contribution to the constant term.

The main physical fit parameters are \(w_{0}\) and \(\tau_{r}\). Results about the fitted product \(L_{d}C_{d}\) for each layers can be seen on figure 6. The behavior with respect to the eta cell number is strongly correlated with the geometry of the detection cell and its surface. For the middle layer, as we go higher in eta the \(L_{d}C_{d}\) value increases. A discontinuity at \(\eta=0.8\) can be seen on each layer corresponding at the change of electrode type. The presampler and the front layer do not show the same behavior depending on the feedthrough the channels are connected to (\(FT0\) or \(FT-1\)).

Indeed, the two feedthroughs are not identical: \(FT-1\) was a prototype and \(FT0\) a final element. It has been observed that \(FT-1\) degraded with time (across the three

\begin{table}
\begin{tabular}{|c||c|c|c|c|c|c|c|} \hline Parameter & \(\tau_{d}(ns)\) & \(\tau_{c}(ns)\) & \(f\) & \(t_{cal}\) & \(t_{phys}(ns)\) & \(w_{0}(ns^{-1})\) & \(\tau_{r}(ns)\) \\ \hline Initial value & 450 & 340 & 0.065 & - & 27 & 0.184 & 1 \\ \hline Fit status & fixed & fixed & fixed & fixed & free & free & free \\ \hline \end{tabular}
\end{table}
Table 1: List of the parameters used in the physics pulse prediction algorithm and their status in the fit (free or fixed)Figure 2: Fit result for several presampler cells. On each plot, one can see the predicted physics pulse (thin red line) superimposed to the data (blue dots). Below each plot are drawn the residuals in percent of the maximum of the physics pulse.

Figure 3: Fit result for several front layer cells. On each plot, one can see the predicted physics pulse (thin red line) superimposed to the data (blue dots). Below each plot are drawn the residuals in percent of the maximum of the physics pulse.

Figure 4: Fit result for several middle layer cells. On each plot, one can see the predicted physics pulse (thin red line) superimposed to the data (blue dots). Below each plot are drawn the residuals in percent of the maximum of the physics pulse.

Figure 5: Residuals at the peak location for all channels of module P13. The results are shown as a function of the eta cell number for each layers. Each dot is the average value over which of all cells with the same eta position. Results for the back layer not relevant here since, for the technical reason, predicted pulses are not fitted on physics data but on calibration data.

years of tests) and some resistive crosstalk between connector developed. The different behaviour observed in the \(LC\) distribution is probably a reflection of this crosstalk.

Impedance measurements were done for the middle and back layers channels of the module P13, while the module was being assembled. This measurements were done directly on the motherboard, at warm whereas the values extracted from the fit come from data taken after the entire electronics chain and at cold. The values taken at warm have nevertheless been corrected for the change of dielectric between air and liquid argon. The figure 7 shows the correlation between the measured and the fitted \(L_{d}C_{d}\) values for middle layer cells of module P13. This correlation is good with a dispersion below 5% and only small systematic biais are observed. This comfort us in the fact that this prediction method is consistant.

The second fit parameter, \(\tau_{r}\), is not related to a real electronics composants but is rather an effective parameter modelling a global resistance in the readout channel (figure 1). The figure 8 show the fit results of the parameter \(\tau_{r}\) as a function of the \(\eta\) cell number for the different layers. Basically \(\tau_{r}\) is of the order of few nanoseconds and so the resistor \(r\) is about few ohms. Channels connected to \(FT-1\) show again a larger dispersion than those connected through \(FT0\).

The most important quantity is the ratio between the maxima of the predicted physics pulse and the calibration pulse (\(M_{physics}/M_{calibration}\)). Because of the shape between the physics current and the injected calibration signal are different, the two pulses do not have the same amplitude after shaping. So the conversion factor from ADC to GeV has to take the ratio \(M_{physics}/M_{calibration}\) into account and must be corrected for. The figure 9 shows the value of this ratio as a function of the \(\eta\) cell number for the different layers.

## 4 Barrel uniformity

Using the previously described method, sets of optimal filtering coefficients were produced for the modules \(M10\), \(P15\) and \(P13\). The parameters we used are those of the table 1. A basic reconstruction was done using the emtb framework [7] in order to test the global uniformity of the detector response over all the readout channels with the 250 GeV electrons beam of the H8 beam line. It used \(3\times 3\) cluster size, no geometrical corrections were applied and only event in center of each cells were kept. For a more detailed and refined analysis of the overall detector performance please refer to [5].

The figure 10 shows the reconstructed energy as a function of the \(\eta\) cell number for each readout channel of the three modules \(M10\), \(P15\) and \(P13\). The results are summarized in the table 2. In this table the average energy for modules \(P15\) and \(P13\) have been corrected for the relative temperature difference of \(0.29~{}K\) of the Liquid Argon, monitored during the two data taking periods. Unfortunately we have no precise measurement of the Liquid Argon temperature for module \(M10\). The corrections to normalize both modules to \(90.05~{}K\) are \(-5.3~{}\mathrm{GeV}\) and \(-3.9~{}\mathrm{GeV}\) for \(P15\) and \(P13\) respectively. The uniformity, close to \(0.6\%\) for all of the modules, is acceptable although this value is systematically higher for \(FT-1\) due to additional crosstalk at the level of the feed-through connector. The absolute energy scale is not studied here; indeed there are known systematic effects which have not been taken into account like the finite size cluster, the effect of the fixed parameters (see figures 11, 12 and 13).

The uniformity does not appear to be dependent on the value of the model parameters we use (figures 11, 12 and 13). The small variations that we may observe are not Figure 6: Fit results of the product \(L_{d}C_{d}=w_{0}^{-2}\) for all channels of module P13. The results are shown as a function of the eta cell number for each layers. Red square are for channels connected through \(FT0\) whereas blue square are for channels connected through \(FT-1\). Change in the electrode type occurs at \(\eta=256\) for the front layer, at \(\eta=32\) for the middle layer and at \(\eta=16\) for the back layer.

significant. One can also observe on the same figures the variations of the average reconstructed energy with respect to the values of the fixed model parameters, \(\tau_{d}\), \(\tau_{c}\) and \(f\). Each are moved independently, starting from the reference values described in table 1. When \(\tau_{d}\) move from 430 ns to 470 ns, the other parameter remaining constant, the energy is decreased by 1.3%. When \(\tau_{c}\) change from 330 ns to 370 ns, the energy is increased by 1.7%. When \(f\) move from 0.05 to 0.09, the energy is increased by 0.7%.

## 5 Conclusion

In this note we have described a method to predict the physics pulse shape of the ATLAS electromagnetic calorimeter out of the calibration signal with a method involving a convolution in time domain. This simple method provides a better control of the numerical computation done. We are no longer limited to work with an only 128 samples length signal and we do not suffer anymore from systematical biais induced by the choice of a peculiar window, as it was the case with the FFT method [8]. The residuals between the predicted pulses and the data are below 2% over all the detector channels. Optimal filtering coefficients have been produced and applied to reconstruct physics data from the

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|} \cline{2-7} \multicolumn{1}{c|}{} & \multicolumn{2}{c|}{**M10**} & \multicolumn{2}{c|}{**P15**} & \multicolumn{2}{c|}{**P13**} \\ \cline{2-7} \multicolumn{1}{c|}{} & \(<E>\) (GeV) & RMS/E (\%) & \(<E>\) (GeV) & \(RMS/E\) (\%) & \(<E>\) (GeV) & \(RMS/E\) (\%) \\ \hline
**FT0** & 227.2 & 0.67 & 222.38 & 0.57 & 222.7 & 0.54 \\ \hline
**FT-1** & 226.7 & 0.75 & 226.2 & 0.60 & 225.9 & 0.58 \\ \hline \end{tabular}
\end{table}
Table 2: Reconstructed energy and dispersion per feed-through over all scanned channels for the modules M10, P15 and P13. The average energy for P15 and P13 have been corrected for temperature difference; no correction has been applied for M10 (see text for more details).

Figure 7: Correlation between the measured and the fitted product \(L_{d}C_{d}\) for middle layer channels of module P13.

Figure 8: Fit results of the parameter \(\tau_{r}\) for all channels of module P13. The results are shown as a function of the eta cell number for each layers. Red square are for channels connected through \(FT0\) whereas blue square are for channels connected through \(FT-1\). Results for the back layer not relevant here since, for technical reason, predicted pulses are fitted to calibration data.

Figure 9: Ratio \(M_{physics}/M_{calibration}\) for all channels of module P13. The results are shown as a function of the eta cell number for each layers. Red square are for channels connected through \(FT0\) whereas blue square are for channels connected through \(FT-1\). Results for the back layer not relevant here since, for technical reason, predicted pulses are fitted to calibration data.

Figure 10: Reconstructed energy as a function of the \(\eta\) position for modules M10, P15 and P13. Each symbols represent readout channels belonging to a same line in phi. Red symbols are for channels connected through \(FT0\) whereas blue symbols are for channels connected through \(FT-1\).

Figure 11: Variation of the average reconstructed energy and of the uniformity of module P13 as a function of the parameter \(\tau_{d}\).

Figure 12: Variation of the average reconstructed energy and of the uniformity of module P13 as a function of the parameter \(\tau_{c}\).

modules tested during the previous testbeam period. The results are consistant with the FFT method and we are able reach an \(\eta\) uniformity of 0.6% per feed-through.

## References

* [1] I. Antcheva, M. Ballintijn, B. Bellenot, R. Brun, P. Canal, O. Couet, G. Ganis, A. Gheata, M. Goto, E. Offermann, V. Onuchin, and Rademakers F., _Root version 3.10/02_.
* [2] W.E. Cleland and E.G. Stern, _Signal processing considerations for liquid ionization calorimeters in a high rate environment_, Nucl. Instr. and Meth. in Phys. res. A 338 (1994) 467-497.
* [3] J. Colas, J.P. Coulon, C. de La Taille, G. Martin-Chassard, M. Moynot, P. Perrodo, G. Perrot, N. Seguin-Moreau, L. Serin, and I. Wingerter-Seez, _The larg calorimeter calibration board_, ATL-AL-EN-0005.
* [4] ATLAS Collaboration, _Calorimeter performance technical design report_, CERN/LHCC 96-40 (1996).
* [5] O. Gaumer, _Analyse de l'uniformt des modules de srie du calorimtre lectromagntique tonneau d'atlas. recherche de bosons supplmentaires neutres_, These de Doctorat, Universite de Savoie 2004.
* [6] Wolfram Research Inc., _Mathematica, version 3.0_.

Figure 13: Variation of the average reconstructed energy and of the uniformity of module P13 as a function of the parameter \(f\).