EUROPEAN ORGANIZATION FOR NUCLEAR RESEARCH

Bipolar versus Unipolar Shaping

of MDT Signals

**Werner Riegler, Martin Aleksa**

Harvard University, CERN

**Abstract**

The MDT frontend electronics scheme, as presented in the TDR, was optimized for fast linear gases like \(Ar/N_{2}/CH_{4}91/4/5\)[1], but since these gases contain hydrocarbons which seem to be responsible for aging problems, the current baseline gas is \(Ar/CO_{2}93/7\) which shows nice aging properties but is slower and significantly nonlinear. The nonlinearity and reduced speed have a significant impact on the pulse shapes: the trailing edge resolution is reduced and we get multiple threshold crossings per signal with the current shaping scheme. The different pulse shapes as well the fact that trailing edge information and double track separation information were not found to be very useful made a complete review of the front end electronics specification necessary.

[MISSING_PAGE_EMPTY:2]

Introduction

At the time of the TDR [2] the baseline gas for the MDTs was \(Ar/N_{2}/CH_{4}\,91/4/5\) (550ns maximum drift time) and after detailed test beam studies of this mixture the following front end electronics specification was worked out (fig. 1):

* **Preamp peaking time of 10ns to 15ns**. Although the resolution is better for short peaking times a'slower' preamp is preferred for reasons of stability and multiple hits. The difference in resolution between a 5ns and 15ns peaking time preamp is about \(10\mu m\) and can even be reduced by performing a time slewing correction.
* **Short gate ADC encoding the charge information in a pulse width**. Measuring the signal charge with an ADC for 10-20ns after the threshold crossing time allows to correct for time slewing. It also provides very useful for monitoring purposes.
* **Unipolar Pulse shaping**. Although unipolar pulse shaping requires an active baseline restoration circuit to avoid baseline fluctuations due to high rates (up to 400kHz/wire) it is preferred to bipolar shaping since 1. We get one threshold crossing per signal.

Figure 1: MDT frontend schematic and operating parameters as presented in the TDR.

2. The trailing edge of the signal which is correlated to the bunch crossing can be measured to \(\sigma_{t}\approx 25ns\) and can be used to eliminate out of time events to increase pattern recognition efficiency and reduce fake track rate. 3. The information of a second discriminator with high threshold can be encoded in the same channel.
* **Programmable filter time constants.** In order to adjust the tail cancellation circuit for different gases the filter time constants have to be programmable.
* **Discriminator hysteresis** is important to avoid multiple threshold crossings.
* **A second discriminator with high threshold** allows to identify muon signals that are piled up to background signals. The separation efficiency was shown to be about 60% for a leading edge separation of \(>100ns\). Encoding the high threshold discriminator information in one channel with all the other hits gives on average 1.7 hits/signal.
* There are **three modes of operation:** 1. Time over threshold mode giving leading and trailing edge, one hit per signal. 2. ADC mode giving leading edge and charge, one hit per signal. 3. ADC+high threshold mode giving leading edge, charge and double track information.
* Four 24-channel TDCs are daisy chained into one front-end link.

In the meantime, many things were studied in more detail or have been changed:

* Aging problems with gases containing hydrocarbons resulted in switching to the gas \(Ar/CO_{2}93/7\) which has a maximum drift time of 700ns and is very nonlinear. Adjusting the tail cancellation time constants such that we arrive at one hit per signal, the trailing edge resolution is strongly degraded (\(\sigma_{t}\approx 80ns\)) which makes this information not very useful.
* The double track separation information was shown not to be useful for pattern recognition which is mainly due to the fact that, using the high threshold discriminator, we get multiple hits even for single tracks. Also the decreased resolution of the recuperated hit (\(\approx 160\mu m\)) is a major drawback.
* The trailing edge information (even with a resolution of \(25n\,s\)) was never used or found useful in simulation [3].

* In some high rate regions in the muon system it is not possible to daisy chain four TDCs into one front end link, but in order to keep the number of cables to the MDTs low it was important to daisy chain as many TDCs as possible into one link, which resulted in a non uniform scheme. Since the ReadOutDrivers (NMRODs) have now been moved from the cavern to the USA15 and the front end links can not be 100m long, a different scheme was adopted. A data concentrator card will gather the TDC signals from one chamber and transmit them to the NIMRODs through an optical fiber, so there is no need for daisy chaining TDCs. Each TDC is connected directly to the concentrator card. In the previous scheme, the maximum allowed data rate was 400kHz per tube with an average of 1.7 hits per signal. Using bipolar shaping for the new baseline gas results in an average of 3 hits per signal, so this solution would not be acceptable with the old readout scheme. However, the new scheme might impose different requirements on the maximum number of hits per signal, so for each front end scheme we have to study the implications on the readout.

All that made a complete review of the frontend electronics scheme necessary. Especially the question of unipolar versus bipolar signal shaping has to be reconsidered since bipolar shaping would not require an active baseline restorer as well as programmable time constants, which would simplify the whole frontend scheme drastically.

MDT performance for different shaping schemes

Most of the signals in the muon system result from background photons. These photons create high energy scattering electrons, some of them able to penetrate several tubes. The photon spectrum and other background characteristics are given in [4].

The average charge deposit per tube from a photon interaction is about 32keV which is two times more than the charge that muons leave in an MDT. This is mainly due to the fact that muon tracks are perpendicular to the wire while electrons created by the background photons are isotropic.

All the simulations were done using GARFIELD to calculate the induced current signal and a stand alone program for electronics simulation.

### Frontend electronics parameters

The transfer function for preamp+filter for bipolar shaping was assumed to be

\[g(s)=\frac{n!s\tau}{(1+s\tau)^{n+2}}\quad\rightarrow\quad f(t)=(1-\frac{t/\tau }{n+1})(t/\tau)^{n}e^{-t/\tau}\qquad t_{p}=\tau\times(n+1-\sqrt{n+1}) \tag{1}\]

Since the delta response integrates to zero

\[\int_{0}^{\infty}f(x)=\frac{e^{-x}x^{n\,+1}}{n+1}\big{|}_{0}^{\infty}=0 \tag{2}\]

every signal convoluted with this transfer function integrates to zero.

For unipolar signal shaping a preamp delta response

\[g(s)=\frac{n!}{(1+s\tau)^{n\,+1}}\quad\rightarrow\quad f(t)=(t/\tau)^{n}e^{-t/ \tau}\qquad t_{p}=\tau\times n \tag{3}\]

together with two pole zero filters

\[g(s)=\frac{s+1/\tau_{1}}{s+1/\tau_{2}}\quad\rightarrow\quad f(t)=(\frac{1}{ \tau_{1}}-\frac{1}{\tau_{2}})e^{-\frac{t}{\tau_{2}}}+\delta(t) \tag{4}\]

was assumed. Sending a signal \(s(t)=\exp{(-t/\tau_{1})}\) through a pole/zero filter with time constants \(\tau_{1}\) and \(\tau_{2}\) results in a signal \(s(t)=\exp{(-t/\tau_{2})}\). Since wire chamber signals don't have an exponential form but are \(\propto(t+t_{0})^{-1}\) one usually fits a sum of several exponentials to the signal and uses several pole/zero filters to cancel each of these exponentials [5]. Usually two filters are sufficient.

The transfer functions for both shaping schemes together with the response to a single ionization electron can be seen in fig. 2.

A photon signal together with the output of a time over threshold discriminator for both shaping schemes is shown in fig. 3.

From these figures we can infer that the standard unipolar shaping scheme neither gives appropriate trailing edge resolution nor creates a single threshold crossing per signal for this specific gas.

Introducing a large discriminator hysteresis helps to reduce the number of hits for the unipolar scheme (fig. 4). We can also cancel the signal tail 'less strongly' in order to reduce the hit number, but as shown in fig. 4, the dead time increases. However, since for bipolar shaping it takes additional time for the signal to return to the baseline from the undershoot, the dead time for both schemes turns out to be the same as shown later (fig. 8).

Figure 5 shows that the signal shape also strongly depends on the position of the muon track along the tube.

Now that we have a feeling for the problem we can start to look into the statistics of the problem i.e. we want to find the number of hits per signal for different electronics schemes and operating conditions. The hit multiplicity for both schemes was calculated by creating 1000 signals at random distances for both gases \(Ar/N_{2}/CH_{4}91/4/5\) and \(Ar/CO_{2}93/7\) with GARFIELD for photons and muons.

### Bipolar Shaping

The hit multiplicity versus threshold for different particles, gases, tube lengths and hysteresis settings is shown in figure 6. The \(Ar/CO_{2}93/7\) gas shows more hits due to the longer drift time and nonlinear space-drift time relation. Photons show a higher hit multiplicity compared to muons which is due to the increased charge deposit. Looking at the bipolar pulse in fig. 3 one can infer that for a larger charge deposit more signal spikes 'will reach up the threshold'. The fact that every spike of the signal is bipolar also explains why different hysteresis settings and tube lengths have almost no effect on the hit multiplicity.

To conclude we can say that for a threshold of 20e- we find (on average) 2.6 hits for photons for \(Ar/CO_{2}93/7\). Since the signal rate is dominated by photons we have to adjust the readout for these numbers. However the hit multiplicity increases strongly when we increase the gas gain (and keep the threshold fixed), so if we want our system to work also for a higher gas gain we even have to consider 3-4 hits on average.

### Unipolar Shaping

Although it is obvious from fig. 3 that for the _standard_ unipolar shaping scheme, i.e. using two pole/zero filters that cancel two exponentials of the signal tail according to [5], will give more than one hit per signal, it will always be possible to arrive at one hit per signal if we cancel the signal tail less strongly. Fig. 7 shows that introducing large discriminator hysteresis also helps to reduce the hit number which also can be seen in fig. 4.

It is therefore possible to have one hit per signal even for a unipolar shaping scheme, however this is only possible if all the filter constants and the hysteresis are very carefully adjusted. In a standard tail cancellation scheme with two pole/zero filters [5] one adjusts the time constants for different gases by changing the capacitors and therefore leaving the pole/zero ratios constant (this is the baseline scheme as presented in the TDR). Adjusting the filters in order to minimize the number of hits per signal requires programmable pole/zero ratios (ratio = 1 to 2.5).

Figure 3: Photon signal for \(Ar/CO_{2}93/7\). The standard unipolar shaping scheme shows a hit multiplicity very similar the bipolar scheme.

**Figure 4**: Introducing Discriminator Hysteresis and using different tail cancellation time constants one can reduce the hit number but one introduces dead time (the increase is however small).

**Figure 5**: The same muon signal for different tubes and tube lengths. The MDT transfer function affects the signal shape significantly.

Figure 6: Hit multiplicity for different gases, particles, tube lengths,thresholds and hysteresis settings for bipolar shaping. One can see that the hit multiplicity is not affected by hysteresis settings or tube lengths. The number of hits is higher for the \(Ar/CO_{2}93/7\) gas due to the longer drift time and nonlinear rt-relation. Photons cause more hits due to the increased charge deposit.

Figure 7: Hit multiplicity for unipolar shaping. The first figure shows the standard unipolar shaping scheme with a time over threshold discriminator and no hysteresis. The second figure shows that we can reduce the hit number by introducing hysteresis but we still get more that two hits for the \(Ar/CO_{2}93/7\) gas. The third and fourth figure show numbers for ’soft’ tail cancellation. We can see that soft tail cancellation and large hysteresis helps to arrive at a single hit per signal.

Bipolar versus Unipolar Shaping

It is instructive to compare our situation to the ATLAS Transition Radiation Tracker (TRT) which foresees a unipolar shaping scheme with active baseline restoration. Since the drift distances in the TRT are very short and the drift velocity is high (pressure 1bar) the signals are very short. Using a bipolar scheme would double the dead time since the signal undershoot has the same duration as the signal itself. Since in the MDT case the duration of the undershoot is short compared to the whole signal length and since we have to use'soft' tail cancellation in a unipolar scheme to avoid multiple hits the dead time is essentially equal (fig. 8).

**Figure 8**: _Deadtime spectrum for \(Ar/CO_{2}93/7\) for unipolar and bipolar shaping. The difference is insignifiant._

At this point it would seem natural that unipolar shaping would be the preferred solution, however we have to keep in mind that this requires active baseline restoration, large discriminator hysteresis and programmable time constants for different gases. Even if we have all these options they must be very carefully adjusted and we must work exactly at the defined operating point.

This is a significant complication compared to a bipolar scheme where we use only one filter with a fixed time constant, no baseline restorer and no large hysteresis and where we don't have to adjust anything.

The biggest concern for the bipolar scheme are multiple hits. An average of up to 3 hits per signal increases the data volume significantly. Simulations of the TDC behavior showed that for a rate of 400kHz with 1.7 hits per signal on average there is no loss of leading edge hits. If we have 3 hits on average, the Level1 Buffer on the TDC has to be extended. Whether the front end link can handle this rate has to be studied.

However even if we are able to read out all the hits there is a difference between the unipolar and bipolar scheme:

In case of a level one trigger all hits within the maximum drift time window (plus some propagation time) are read out. In case of unipolar shaping this window would contain background hits and muon hits, in case of bipolar shaping we would have after pulses in addition. Since we don't know whether a hit corresponds to a real leading edge or just an after pulse, the pattern recognition program has to treat all the hits with equal priority. However it was shown that this can even reduce the efficiency, so we have to find some other algorithm.

At a rate of 300kHz, the average time between two hits is \(3\mu s\), the average time between two after pulses is much smaller (\(100-200ns\)). From this we can conclude that the first hit in the drift time window is most probably a real leading edge. So the pattern recognition program would use only the first hit in the time window. However, this way we eliminate also a small number of real hits and we reduce the single tube efficiency. The impact of this is shown in the next chapter.

**Figure 9**: Using only the first hit in the drift time window introduces artificial deadtime. However using all the hits in the time window can create problems in case of bipolar shaping due to multiple hits.

In case of unipolar shaping we know that every hit corresponds to one particle, but in the bipolar scheme we don't know any more whether the hits correspond to the leading edge of a particle or whether it is just an after pulse. The point is that we lose information with the bipolar scheme. However, as shown in the next section, this effect is small.

How to decide on the shaping scheme

It is of course desired to have a scheme that guarantees the same pattern recognition performance that is advertised in the TDR and also doesn't introduce major changes to the TDC or the readout scheme. We will estimate the impact of the different options on the pattern recognition efficiency by looking at the single tube inefficiency for several schemes. The results are shown in Fig. 12 and discussed below. It is however important to perform dedicated pattern recognition studies for the different schemes.

The single tube inefficiencies were calculated by randomly overlaying photon signals to the muon signal (according the given rate) and looking if the muon leading edge was lost (single events are shown in fig. 11). To get a feeling for the difference between \(Ar/CO_{2}93/7\) and \(Ar/N_{2}/CH_{4}91/4/5\) fig. 10 shows the rt-relations and the deadtime spectra for both gases. Although the average drift time is almost equal for both gases (248ns for \(Ar/N_{2}/CH_{4}91/4/5\) and 255ns for \(Ar/CO_{2}93/7\)), the 'photon induced deadtime spectrum' differs by almost 200ns (330ns for \(Ar/N_{2}/CH_{4}91/4/5\) and 520ns for \(Ar/CO_{2}93/7\)). The reason for that is the fact that photon interactions create high energy scatter electrons that either originate from the tube walls or end in the tube walls. Therefore the deadtime is dominated by the drift velocity close to the wall which is very low for the \(Ar/CO_{2}\) mixture.

In the following we will present three different options.

### Unipolar shaping

We use a unipolar shaping scheme, widely programmable filter time constants, active baseline restoration, large discriminator hysteresis and carefully adjust all these parameters in

Figure 10: \(Rt\)-relation and dead time spectrum for both gases. The average deadtime is 330ns for \(Ar/N_{2}/CH_{4}91/4/5\) and 520ns for \(Ar/CO_{2}93/7\).

order to get on hit per signal.

The single tube inefficiency for a rate of 300kHz (Safety Factor 5) is 21% for the \(Ar/CO_{2}\) gas and 16% for the \(Ar/N_{2}/CH_{4}91/4/5\) gas (fig. 12).

### Bipolar shaping, hit reduction in the TDC

We use a bipolar shaping scheme which makes the front end electronics very simple. There are no parameters that have to be adjusted even if we change the gas. We have up to 3 hits (on average) per single signal. The TDC LVL1 buffer must be extended. The capacity of the readout scheme must be increased by a factor 3.

Assuming that the pattern recognition program can only use the first hit in the time window the single tube inefficiency for a rate of 300kHz (Safety Factor 5) is 23% for the \(Ar/CO_{2}\) gas and 20% for the \(Ar/N_{2}/CH_{4}91/4/5\) gas (fig. 12).

If the TDC would have the option to only give the first hit in the time window the readout capacity would not have to be increased.

### Bipolar shaping, artificial deadtime

We use a bipolar scheme and introduce artificial deadtime in the discriminator to reduce the number of hits. The ADC information will be appended to the deadtime pulse. It is important to notice that the deadtime has to be equal or very close to the maximum drift time. If e.g. for \(Ar/CO_{2}93/7\) (700ns maximum drift time) we use a fixed deadtime of 500ns it can happen that a late cluster, arriving at 600ns, triggers another 500ns pulse which would in that case increase the deadtime to 1.1\(\mu\)_s_.

The single tube inefficiency for a rate of 300kHz (Safety Factor 5) is 25% for the \(Ar/CO_{2}\) gas and 20% for the \(Ar/N_{2}/CH_{4}91/4/5\) gas (fig. 12).

Figure 11: Single events for a background rate of 500kHz. The solid line indicates the muon signal, the dashed lines shows the photon background. The left figures show the unipolar scheme, the right figures the same event for the bipolar scheme. In case of a trigger, the TDC would send out all the hits in the time window from -100ns to 800ns.

Figure 12: Single tube inefficiencies for \(Ar/CO_{2}93/7\) and \(Ar/N_{2}/CH_{4}91/4/5\). The 5% inefficiency at 0Hz is the inefficiency due to delta electrons created by the muon in the tube wall [4]. The ‘Bipolar Shaping, all Hits’ curve has to be interpreted carefully: the inefficiency is lower since some of the piled up hits that are lost in the unipolar scheme are recuperated (see ‘double track separation with strong tail cancellation’ [4]). However, the multiple hits and the fact that the resolution of the recuperated hits is lower leaves the pattern recognition efficiency almost unchanged.

Summary

* Because of high background rates we have to use either unipolar shaping with active baseline restoration or bipolar shaping in order to avoid baseline fluctuations.

- does not apply in our situation.
* 3 bars and low gas gain
- we have the peculiar problem of multiple hits.
* At the time of the TDR we decided on unipolar shaping because we get
* one hit per signal
* double track separation (efficiency of 60% - 80% for \(\Delta t>\) 100ns) [4]
* trailing edge resolution of 20ns.
* Double track separation was never found to be useful [3], the trailing edge was never used and in addition the trailing edge resolution for \(Ar/CO_{2}\) is only \(\approx\) 80 ns compared to 25 ns for \(Ar/N_{2}/CH_{4}91/4/5\). In addition the drift properties of \(Ar/CO_{2}\) are such that it is very hard to achieve one hit per signal.
* The background photons create high energy scattering electrons that 'look like tracks'. They deposit on average twice the energy of muons (muon tracks are perpendicular to the wire).
* The 'average' deadtime is 330ns for \(Ar/N_{2}/CH_{4}91/4/5\) and 520 ns for \(Ar/CO_{2}93/7\).
* Bipolar shaping is very'simple' (no programmable time constants, no baseline restoration circuit, no fine tuning). We get up to 3 hits on average per signal.
* The current TDC and readout can handle only two hits on average at a rate of 400kHz.
* Using bipolar shaping we lose information compared to unipolar shaping since we don't know whether a hit corresponds to a real leading edge or an after pulse (tube inefficiency goes from 21% to 23% for \(Ar/CO_{2}93/7\)). Essentially we can only use the first hit in the time window.
* If we chose unipolar shaping we have to use 'non standard' tail cancellation with programmable pole/zero ratios (not the baseline).

* There are 4 possible frontend schemes:
* Unipolar shaping ('complex'): We need large discriminator hysteresis, programmable pole/zero ratios and an active baseline restoration circuit. We get one hit per signal and a single tube inefficiency of 21% at 300kHz.
* Bipolar Shaping ('simple'): We get up to 3 hits per signal (on average) and a single tube inefficiency of 23% at 300kHz. The TDC Level 1 buffer and the readout capacity have to be extended.
* Bipolar Shaping, first hit TDC: The TDC buffers have to be extended, the additional function of a first hit readout has to be implemented. The single tube inefficiency is 23% at 300kHz.
* Bipolar Shaping, fixed deadtime ('simple'): We have to introduce programmable deadtime (0-800 ns). We get one hit per signal, the single tube inefficiency is 25% at 300kHz.
* In order to decide on the shaping scheme we still have to study pattern recognition efficiency, TDC occupancy and readout occupancy for the different schemes.

## References

* [1] M. Deile, J. Dubbert, N.P. Hessey et al., Testbeam Studies of the gas mixtures \(Ar:N_{2}:CH_{4}\)=91:4:5... ATLAS internal note MUON-NO-122 (1996), CERN.
* [2] ATLAS Muon Spectrometer Technical Design Report, CERN/LHCC/97-22, ATLAS TDR 10, (1997)
* [3] Marc Virchaux, private communication
* [4] W. Riegler: MDT Efficiency, Double Track Separation, ATLAS Muon Note 173, CERN 1997
* [5] R.A. Boie, A.T Hrisoho and P. Rehak, signal shaping and tail cancellation for gas proportional detectors at high counting rates, NIM 192 (1982).
* [6] On the Number of Layers per Multilayer in MDT chambers Part I. Laporte J.F, Chavalier L, Guyot C, Virchaux M ATLAS Muon Note 126, CERN 1996
* [7] Pattern Recognition with MDT Chambers, Shank J, Sliwa K, Taylor F, Zhou B, ATLAS Muon Note 150, CERN 1997