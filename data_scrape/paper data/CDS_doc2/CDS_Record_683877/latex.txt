# Bunch-Crossing Identification

for saturated calorimeter signals

Ulrich Pfeiffer, Wolfgang Hotzel

_Institut fur Hochenergiephysik, Universitat Heidelberg, Germany_

ATLAS note, 17. May 1999

## Abstract

This paper describes an algorithm, which will be implemented in the Preprocessor ASIC of the ATLAS Level-1 Calorimeter trigger. Its purpose is to identify the corresponding Bunch-Crossing in time for saturated trigger tower signals from the calorimeters (saturated BCID). Results presented here are combined from simulations with a PSPICE model of the Liquid Argon trigger tower electronics and the digital signal processing inside the Preprocessor. The PSPICE model describes saturation of analogue pulses in a realistic way. The digital processing allows to investigate noise effects and shifts of the digitization strobe of the FADC against the pulse position.

###### Contents

* 1 Introduction
* 2 Requirements for BCID
* 3 Saturation of Liquid Argon trigger tower signals
	* 3.1 Comparison between non-saturated and saturated signals
* 4 Digital saturated BCID algorithm
	* 4.1 Saturated pulse detection
	* 4.2 Bunch-Crossing determination
	* 4.3 Transverse energy measurement
	* 4.4 Implementation
	* 4.5 FIR-filter discussion
	* 4.6 Latency summary
* 5 Simulated performance
	* 5.1 Simulation environment
	* 5.2 PSPICE pulse generation
		* 5.2.1 Pulse shape for different shaper time constants
		* 5.2.2 Pulse shape for different detector capacitances
		* 5.2.3 Effects on pulse shape due to radiation effects
	* 5.3 Simulated noise contribution
	* 5.4 Simulated time jitter
	* 5.5 Synchronization of digitization phase to pulse maximum
	* 5.6 Simulation results
* 6 Measured integration effect of 71 m twisted-pair cable
* 7 BCID timing strategy
* 8 Summary

Introduction

The Level-1 Calorimeter trigger has to decide whether a potentially interesting interaction has occurred in ATLAS. The decision is made for each LHC Bunch-Crossing of 25 ns by extracting the following information for different calorimeter regions (trigger towers): The transverse energy deposited inside a trigger tower due to an interaction, and the corresponding Bunch-Crossing for that interaction. The pattern of energy deposition is then examined by the trigger processors to see if it corresponds to what is expected for interesting physics. From each trigger tower (about 7200 trigger towers in total) an analogue signal is sent to the Level-1 Calorimeter trigger. The signal has bipolar shape in case of the Liquid Argon Calorimeter and unipolar shape in case of the Hadronic Tile Calorimeter. The signals extend over a number of LHC Bunch-Crossings, the pulse height corresponds to the deposited transverse energy and the position of the maximum identifies the Bunch-Crossing. For energies beyond the linear transverse energy range of a trigger tower which is 0-250 GeV, saturation of trigger tower signals will occur. Saturation has two effects: it limits the digitization, which is done every 25 ns to 10 bit precision, at 250 GeV (3FF hex) and it distorts the analogue signal shape. Hence the bunch crossing identification algorithm, included in the Level-1 Calorimeter trigger, must cope with these saturation effects in a flexible way. This paper describes an algorithm which extracts the corresponding Bunch-Crossing for saturated trigger tower signals after digitization. The algorithm takes two samples from the leading edge of the saturated signal and compares their value against programmable thresholds.

## 2 Requirements for BCID

An important requirement, which is valid for non-saturated trigger tower signals, is that the pulse shape is fixed and not amplitude (energy) dependent. This requirement allows an algorithm to successfully extract the timing of the pulse peak and therefore the corresponding Bunch-Crossing. In contrast to that, the shape of saturated pulses changes with the amplitude as well as with the distribution of energy inside the summing stages of a trigger tower builder. This fact makes it necessary to have an algorithm for saturated pulses, which is able to cope with saturation effects. The proposed algorithm relies not on a fixed pulse shape, but on some stable parameters of the analogue trigger tower electronics: The rising edge of the pulse must be unaffected by saturation (at least for two samples before the pulse maximum) and the output voltage slope and bandwidth of the operational amplifiers used in the trigger tower electronics should only be as high as necessary for the transmission of non-saturated signals. Table 1 summarizes some requirements and parameters as documented in [1] and [9].

## 3 Saturation of Liquid Argon trigger tower signals

Saturation can first occur inside the analogue summing chain of the Liquid Argon trigger tower electronics. In addition to that the signal is clipped digitally. The digitization range at the Preprocessor is limited to 2.5 V at 10 bit. All signals, which reach 2.5 V or more at the Preprocessor, are represented by a maximum FADC digitization value of 3F (hex). Analogue saturation can occur at three stages of the trigger tower processing: A) At the linear mixer, including the pre-amplifier and the shaper, B) at the layer sum board, and C) at the tower builder board. The analogue saturation voltage of the simulated trigger tower electronics is 3.0 V. The distorted pulse shape received at the Preprocessor differs depending on the stage where saturation occurs. The presence of Pile-up noise and thermal (electronics) noise makes it necessary to optimize the Liquid Argon shaper time constant individually for different calorimeter regions. Because of this difference, the peaking time must be readjusted at the tower builder board before signals are summed together. This adjustment is done with a pole-zero circuit which differs for

\begin{table}
\begin{tabular}{|l|c|} \hline
**requirement/parameter** & **value** \\ \hline \hline Lar. pile-up noise & 400 MeV \\ Lar. thermal noise & 217-410 MeV \(\eta\) = 2 \(-\) 0 \\ Lar. total noise & 450-570 MeV \(\eta\) = 2 \(-\) 0 \\ Tile pile-up noise & 90 MeV \\ Tile thermal noise & 35 MeV \\ Tile total noise & 97 MeV \\ Quantization noise & 75 MeV \\ Digital saturation level & 250 GeV (2,5 V;10 bit) \\ Lar. Analogue saturation voltage level & 300 GeV (3.0 V) \\ Lar. Shaper time constant1 & 15 ns \(\pm\)0.5 ns \\ Lar. Peaking time2(pole-zero) & 51-52 ns \\ Lar. Peaking time at receiver (due to 70 m long cable3) & 63 ns \\ Trigger tower timing jitter & always within \(\pm\)3 ns \\ Calorimeter cell timing for trigger tower summing & \(\pm\)2.5 ns \\ \hline \end{tabular}
\end{table}
Table 1: Requirements and characteristic parameters for trigger tower signals from the ATLAS calorimeters (at high luminosity).

different layers and each value of pseudo-rapidity (\(\eta\)). The uniform peaking time after the pole-zero circuit is about 51-52 ns at its output. Cable integration of a 70 m twisted pair cable slows down the signal further to about 63 ns. Because of the pole-zero circuit and the cable integration the expected peaking time at the Preprocessor input is in between 55-63 ns.

Figure 1 shows a sample of simulated pulse shapes. All signal shapes were captured at the receiver station output, representing an energy of about 1 TeV. The saturation was simulated at different stages of the trigger tower electronics: at the linear mixer, the layer sum board, and the tower builder board, using a PSPICE model [7]. The model for the analogue chain allows simulation of the expected pulse shape for the middle layer at \(\eta=0\). To adjust the model to a different layer and/or \(\eta\)-segmentation the shaper circuit must have a different shaper time constant, the pole-zero circuit and the cable length has to be changed.

Saturation of the linear mixer has little effect on the pulse maximum. The peak is still well located and it does not get broader with higher energies. The integrated area is no longer zero because of a delayed start of the undershoot. The starting point of the undershoot moves with larger energies to the right. This shape corresponds with measurements carried out with the module-0 Liquid Argon Trigain shaper [3]. Saturation inside the layer sum board results in a large flat top at the maximum, which gets broader for higher energies. Due to the symmetrical power supply, the undershoot does not saturates at 1/5 of the positive saturation voltage. It is amplified up to -3.0 V and therefore the integrated area is no longer zero. The tower builder circuit affects the signal shape by giving the saturated signal

Figure 1: Pulse shape of saturated trigger tower signals. Saturation was simulated at different stages of the analogue trigger tower electronics. The vertical dashed lines are spaced 25 ns apart to indicate the LHC Bunch-Crossing. The horizontal dashed line at 2.5 V is the FADC saturation level (3FF hex).

a hump on the falling edge and it has by far the widest extension to later times. The distortion of the signal shape, as a consequence of saturation, affects mainly the falling edge of the shape and has little effect on the rising edge. The signal slope for the rising edge increases first for higher energies, but later is limited by the output voltage slope of the operational amplifiers used. This fact is used by the digital saturated algorithm to efficiently identify the corresponding Bunch-Crossing even when the signal shape changes due to the saturation stage in the analogue chain. Variations between the origin of the pulses occur, because of different propagation delays between an ideal PSPICE model for the linear mixer, which was recently replaced by a more realistic one. The pulse shape for the ideal model is included here, since all simulations which follow were done with it. Because of the ideal linear mixer circuit, its simulated saturation is equivalent to saturation in the following stage, the layer sum board.

### Comparison between non-saturated and saturated signals

The performance of a previous option for saturated pulses, lookup table BCID ([1], [5]), was based on an 'ideal' analytic shaper function described in [8]. This function calculates the shaped waveform at the shaper output as a response to a triangular detector current. Figure 2 shows a comparison of signals calculated with the 'ideal' function against signals simulated with a PSPICE model of the trigger tower electronics [7]. The PSPICE pulses were simulated to saturate inside the layer sum board. Apart from those effects, an important difference between 'ideal' and simulated pulses is the time at which saturation (250 GeV) is reached. This is limited for PSPICE pulses because of the limited output voltage slope of the operational amplifiers. The problem for the previously investigated lookup table algorithm is that it uses not only the leading edge, but also the falling edge of the pulse, and therefore it might not cope with pulses saturated at different stages of the trigger tower electronic. The lookup table content must rely on a stable pulse shape. Further simulation of that lookup table algorithm will follow to show its performance using more realistic PSPICE pulses.

## 4 Digital saturated BCID algorithm

The motivation to use a discriminator on the leading edge of the pulse shape arises from the fact that the pulse origin is the only fixed attribute of the pulse defining the interaction time point. Once the origin of a pulse is located, it is just a matter of adding the peaking time to identify the correct Bunch-Crossing in time. In this case the signal shape can be distorted in various ways without affecting the identified Bunch-Crossing. An analogue discriminator BCID described in [1] is one possible realization of that idea. The drawback of this solution is the additional analogue electronics and cost needed for the implementation in the Preprocessor system. It would be much preferred if a digital saturated algorithm could instead be included in the Preprocessor ASIC. Looking at the digitized pulse shape, one can see that the second sample before the peak is close to the origin of the pulse (the peaking time is about twice a LHC Bunch-Crossing of 25 ns). Setting a digital threshold for the digitized data is therefore quite similar to applying an analogue threshold before digitization. To optimize the accuracy of the measured transverse energy a digitization at the maximum of the pulse is preferred. This is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for the Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for the Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe. The requirement for Level-1 trigger is that the Pulse is not a requirement for Level-1 trigger, but the Preprocessor can do so because it is able to adjust the relative timing of analogue trigger-tower signals to the FADC strobe.

ment for the step size for the FADC strobe is 2.5 ns [9] and the proposed one for the Preprocessor is 1 ns [1]. Starting at the peak maximum and going 50 ns (about one peaking time) back in time gives two samples on the rising edge. The first sample is sitting close to the origin of the pulse and the second one is in between the baseline and the saturation of the FADC. The following section describes the working of a digital saturated BCID algorithm, which applies two thresholds to both samples before saturation.

### Saturated pulse detection

The algorithm has a programmable saturation level, which triggers its execution. When a 10 bit value from the FADC reaches or goes beyond that level the algorithm is performed once. It is only rearmed with the next FADC sample which is lower. To maximize the available threshold range for the algorithm this value should be identical to the FADC saturation of 3FF. It may be useful to lower this value in order to increase the overlap region between saturated and non-saturated algorithm.

### Bunch-Crossing determination

Minor logic is required to determine the correct Bunch-Crossing for saturated signals. The algorithm is fully defined by the logic given in Table 2 and its validity can be seen from pulse examples shown in Figure 3 and 4.

Figure 3: Pulse example (250 GeV) which just has saturated the FADC is shown in a). Because of the sample at \(t_{sat-1}\) which is above the threshold \(s_{high}\), the algorithm identifies the sample at \(t_{sat}\) as the correct Bunch-Crossing. A larger pulse which saturates 25 ns earlier is shown in b). In this case the sample at \(t_{sat-1}\) is below \(s_{high}\) and therefore the algorithm identifies the sample at \(t_{sat+1}\) as the correct one.

The algorithm is triggered with the first occurrence of saturation, at (\(t_{sat}\)). Two samples before saturation which are held inside of a FIFO buffer, are then compared against programmable thresholds stored in registers. Depending on the crossing of thresholds, either the first occurrence of saturation at \(t_{sat}\) is identified as the correct Bunch-Crossing or the next time slice which follows at \(t_{sat+1}\). Figure 3 a) gives an example of a trigger tower signal which just has triggered the saturated algorithm at \(t_{sat}\). Sample points which are used as input to the algorithm are drawn as dots sampled at \(t_{sat-2}\), \(t_{sat-1}\) and \(t_{sat}\). This figure is also valid for larger signals where the sampled FADC values are increased further until the sample at \(t_{sat-1}\) has reached saturation too. In this case the algorithm would trigger and take its input sample points 25 ns earlier (see Figure 3 b)). For very large pulses in Figure 4 a) the influence of a limited output voltage slope of the operational amplifier used is shown. The sample at \(t_{sat-1}\) cannot cross the \(s_{high}\) threshold any more because of the fact that the output voltage cannot reach saturation from 0 V to 2.5 V in infinite time.

So far the threshold \(s_{low}\), which gives further robustness against a misplaced FADC strobe, was not needed. Its role can be seen from Figure 4 b), which one can get from Figure 4 a) just by introducing a phase offset between pulse and FADC digitization strobe. Now the sample at \(t_{sat-1}\) has crossed \(s_{high}\) which would cause a misidentified Bunch-Crossing. In contrast to Figure 3 a) the sample at \(t_{sat-2}\) is now below \(s_{low}\) and therefore it can correct the decision.

Figure 4: The effect of the limited output voltage slope of the operational amplifiers is shown in a). The sample at \(t_{sat-1}\) will not cross the \(s_{high}\) threshold for any further increased energy. For a misplaced FADC strobe a crossing of \(s_{high}\) might be possible as shown in b). This case can be distinguished from the one shown in a) of Figure 3 by the \(s_{low}\) threshold.

### Transverse energy measurement

The saturated digital BCID algorithm identifies the corresponding Bunch-Crossing only, it does not measure the energy. The setting of the measured transverse energy is up to the programming of the BCID decision logic, which collects the results for non-saturated and saturated BCID algorithms. Possible values are 3FF, the saturation level if it differs from 3FF, or the output result from the FIR filter lookup table for non-saturated pulses. The later case might differ from 3FF for signals which just have reached the saturation level. For a further explanation of the processing chain of the Pre-Processor see [1].

### Implementation

The algorithm can be described with Verilog by implementing the logic shown in Table 2. A possible schematic implementation is shown in Figure 5. It consists of three programmable registers, a 10 bit FIFO with a depth of three and three 10 bit comparators applied to FADC samples before saturation. The result is sent to a programmable BCID decision logic, which collects results for the non-saturated and saturated algorithm. The synchronization of the result bits and the re-arming of the algorithm is not shown in this schematic. Another solution would be to compare each FADC sample in parallel against both thresholds and to pipeline the resulting bits only.

### FIR-filter discussion

The inclusion of a finite impulse response filter (FIR filter) in the algorithm was investigated. The coefficients were chosen to perform different algorithms: a matched filter, which calculates the most likelihood for the samples inside the FIR-filter, a differentiation, and a peak-sharpening algorithm. A matched filter, which uses the convolution of the pulse samples with a noise covariance matrix as coefficients [6], relies on a fixed saturated pulse shape. For very large pulses the distortion of the

\begin{table}
\begin{tabular}{|c c c||c c|} \hline \(t_{sat}\geq 3FF\) & \(t_{sat-2}>s_{low}\) & \(t_{sat-1}>s_{high}\) & \(t_{sat}\) & \(t_{sat+1}\) \\ \hline \hline
0 & X & X & 0 & 0 \\
1 & 1 & 1 & 1 & 0 \\
1 & 0 & 1 & 0 & 1 \\
1 & X & 0 & 0 & 1 \\ \hline \end{tabular}
\end{table}
Table 2: Logic table to be implemented in the Preprocessor ASIC. Fulfilled threshold conditions are indicated by a logic ‘1’, the identified Bunch-Crossing has a logic ‘1’ at \(t_{sat}\) or \(t_{sat+1}\).

falling edge precipitates mis-identified Bunch-Crossings. A peak-sharpening algorithm seems to work better. It extends the timing stability, but again for very large pulses the falling edge affects the efficiency, which is not acceptable. Only if one could avoid more than two saturated samples it it an attractive option. A differentiation of the pulse has a large uncertainty for the threshold settings. This is the reason why the simulation results presented here are limited to thresholds applied to the raw FADC data only.

### Latency summary

Without a FIR-filter the latency of the digital saturated algorithm is one bunch-crossing (25 ns). Including a FIR-filter in the circuit would increase the latency to 5 Bunch-Crossings (125 ns).

## 5 Simulated performance

This section describes the simulation results for the digital saturated BCID algorithm. The simulation is a combined simulation of the analogue trigger tower electronics and a simulation of the digital signal processing in the Preprocessor.

### Simulation environment

Figure 6 shows the simulation chain. It is divided into two simulators: a MicroSim PSPICE-V 8 simulator for the analogue part and PTOLEMY 0.7.1 from University

Figure 5: Possible schematic implementation of the saturated BCID logic. The logic sets thresholds on raw FADC data stored inside a FIFO-buffer. The identified time slice is indicated to the BCID decision logic. Timing synchronization of the result bits and the re-arming of the algorithms are not shown.

of California at Berkeley, which combines a synchronous data flow simulation (SDF) and a discrete event (DE) driven simulation for the digital signal processing. The PSPICE schematic [7] includes a circuit for the linear mixer, the layer sum board, and the tower builder. It has an ideal model for a 70 m twisted pair cable included as well as a schematic of the receiver station. The input for that circuit is a triangular Liquid Argon drift current, with a drift time of \(t_{dr}=400\) ns and a peak current of \(3.2\;\mu\)A/GeV (middle layer at \(\eta=0\)). The pole-zero circuit is chosen for the middle layer at \(\eta=0\). The circuit is supposed to have a peaking time of 51-52 ns after the tower builder. At the receiver station output the peaking time is about 63 ns.

The output of that PSPICE simulation is interfaced to a PTOLEMY schematic. The PTOLEMY simulation adds first electronic and pile-up noise to the PSPICE waveform (RMS = 440 MeV). The whole signal is than delayed to simulate time jitter with a Gaussian distribution of \(\sigma=1\) ns. An ideal model of a FADC digitizes the signal to 10 bits, where the FADC digitization strobe can be moved in steps of 1 ns against the peak maximum. The FIR filter that follows is included here, but it is used in bypass mode. The saturation logic can be described in C++ within PTOLEMY. As a result of the simulation the exact position of the peak maximum is compared to the result from the saturated BCID logic.

### PSPICE pulse generation

The PSPICE pulses which were used as input to the PTOLEMY simulation were generated for discrete drift currents equivalent to energies ranging from 100 GeV up to 10 TeV. The saturation took place inside the tower builder board.

Figure 6: Simulation chain used to simulate analogue trigger tower signals and the digital signal processing inside the Preprocessor system.

#### 5.2.1 Pulse shape for different shaper time constants

In order to simulate the effect of different peaking times at the Preprocessor input the shaper time constant was varied. Pulses were generated for shaper time constants of 5 ns, 10 ns and 15 ns (\(t_{pk}\)=43 ns, 50 ns, 63 ns). Figure 7 shows examples for non-saturated 100 GeV pulses. Due to the longer integration time invoked by a longer shaper time constant the peak height changes as well as the peak position. The peak energy at this point was not readjusted for the simulation.

Because of an expected4 peaking time at the Preprocessor input of about 42 ns to 50 ns these sets of peaking times should be sufficient to test the flexibility of the algorithm against changes of the peaking time. Once an exact measurement of the cable characteristics is done, the expected variation of peaking times can be estimated more precisely.

Footnote 4: The expected shaper time constant has just recently changed to 15 ns. This is the reason why larger peaking times were not investigated. The expected peaking time at the Preprocessor input is now in between 55 - 63 ns dependent on the cable length. Longer peaking times should be explored to give confidence that the algorithm is valid also for extreme values.

#### 5.2.2 Pulse shape for different detector capacitances

Figure 8 shows the pulse shape is affected by changes made to the detector capacitance. Changes of the detector capacitances between 800 pF up to 1200 pF have only a small effect on the pulse shape and to the peaking time, as can be seen from the figure.

Figure 7: Simulated pulse shape (100 GeV) for different shaper time constants. The corresponding peaking time is given in brackets. The dashed lines represent the FA DC digitization strobe of 40 MHz.

#### 5.2.3 Effects on pulse shape due to radiation effects

Preliminary irradiation results for the backup version of the Liquid Argon TRI-gain shaper [3] has shown that the peaking time is stable within \(\pm 0.5\) ns for 10 times the expected dose at LHC. It shifts to a faster peaking time for long term irradiation. Instant changes of the peaking time or a distortion of the shape were not looked at.

### Simulated noise contribution

The noise which was added to the signal waveform was generated as described in [1]. It contains the pile-up spectrum taken from ATRIG at high luminosity and the expected noise spectrum for the Liquid Argon electronics, followed by a fourth-order low-pass Butterworth filter with a cut-off frequency of 20 MHz. Figure 9 shows the amplitude distribution of that noise. The RMS value taken from that distribution is equivalent to 440 MeV.

### Simulated time jitter

All PSPICE simulated signals were delayed by a value taken out from a Gaussian distribution with a standard deviation of 1 ns. The maximum values from that distribution were limited to \(\pm 2\) ns. This should simulate unexpected movements of the signal origin caused by short term effects which cannot be calibrated for.

Figure 8: Simulated pulse shape (100 GeV) for different detector capacitances (800pF - 1200pF). The dashed lines represent the FADC digitization strobe of 40 MHz.

### Synchronization of digitization phase to pulse maximum

The threshold settings of the algorithm are programmable and should be optimized for each position of the FADC digitization strobe relative to the peak maximum. However, the simulation described here changes the timing of the FADC digitization strobe without loading new thresholds. This is done to test the timing stability and robustness of the algorithm.

### Simulation results

For each simulation two plots were generated. The top plot a) contains a result bit for each simulated pulse amplitude. The entry is '1' for those events which were identified with the correct Bunch-Crossing. For amplitudes, which are below saturation (2.5 V), and for those, which were miss-identified, the entry is '0'. Plot b) underneath shows the value of the FADC sample before the first occurrence of saturation. This is the sample at \(t_{sat-1}\) with is compared to the threshold \(s_{high}\). A dashed line indicates the threshold setting which is a parameter for that simulation. Entries below the threshold have identified the Bunch-Crossing with the pulse sample at \(t_{sat+1}\), entries above to \(t_{sat}\). The sample at \(t_{sat}\) is the one, which first triggers the saturated algorithm and the sample at \(t_{sat+1}\) follows one time slice (25 ns) after the first saturation.

Figure 10 shows the effect of only noise applied to the signal. The pulse maximum was exactly synchronized to the FADC digitization strobe and no time jitter was

Figure 9: Expected amplitude distribution of the LAr calorimeter noise, including electronics noise and pile-up noise taken from ATRIG at high luminosity [1]. The RMS noise is 4.4 mV (440 MeV)5.

included. The top 'efficiency' plot has a sharp transition region at the saturation level of the FADC (2.5 V). All events were identified correctly up to simulated pulse energies of 10 TeV. The plot underneath, which shows the sampled FADC value before saturation, is smeared out because of the noise effect on the signal. From this plot one can see that the separation for the samples which must be discriminated at the threshold (\(s_{high}\)) is about 350 FADC counts. Within that region the threshold can be set to any desired value, but an optimized position would be the center of that region. Theoretically, that region would be about 400 FADC counts (about 1 V) without any noise.

Figure 11 includes the simulated time jitter, as described in section 5.4. There is no effect on the efficiency of the algorithm, and the threshold of 550 is still well separated from the sampled values. If the FADC digitization strobe were now to be

Figure 10: Efficiency plot a), and sampled FADC value before first occurrence of saturation at \(t_{sat-1}\) b). Shaper time constant is 10 ns (\(t_{pk}=50ns\)), the digital discriminator threshold is set to 550 and the RMS noise is 4.4 mV. The strobe of the FADC is exactly synchronized to the pulse maximum and no time jitter was included.

moved away from the peak maximum position, the samples shown inside the bottom diagram would move up for a sampling point moved toward the falling edge, and they would move down for a sampling point moved toward the rising edge of the pulse. In such a case the threshold is not centered anymore and should be re-optimized with respect to the FADC strobe. A worst case simulation, which includes noise, time jitter and a misplaced FADC digitization strobe of \(\pm 3\)ns without changing the threshold setting is shown in Figure 12. The algorithm still identifies the correct Bunch-Crossing up to simulated saturated signals of 10 TeV, but the safety margin to set the threshold is reduced. The simulation in Figure 13 was done as described before, but the noise was increased by a factor of three. One can see that the samples are smeared out further, but all events were still identified correctly.

The algorithm identifies the wrong Bunch-Crossing as soon as sample points move across the threshold (see Figure 12 b)). That would first happen at the FADC

Figure 11: Efficiency plot a) and sampled FADC value before first occurrence of saturation at \(t_{sat-1}\) b). Shaper time constant is 10 ns (\(t_{pk}=50ns\)), the digital discriminator threshold is set to 550, the RMS noise is 4.4 mV and a time jitter to the pulse is \(\pm\) 2 ns. The strobe of the FADC is synchronized to the pulse maximum.

saturation level for samples coming from above the threshold and at the far energy end for those samples coming from beneath the threshold. If the FADC strobe is moved further away from the peak without changing the threshold level, then we expect samples which cross the threshold. A mis-identified Bunch-Crossing at the FADC saturation level would lower the overlap region for non-saturated and saturated BCID, whereas mis-identified samples at very high energies are of cause not acceptable. Figure 15 has miss-identified events at the mentioned energies because of a further increase of the FADC strobe range to \(\pm\) 4 ns. In addition to the plots shown before, a histogram which contains the simulated time jitter and a histogram showing the phase variation between pulse maximum and the FADC digitization strobe, were included. It should be mentioned here, that so far only the threshold \(s_{high}\) was used. The timing can be extended to \(\pm\)4 ns using the threshold \(s_{low}\).

To prove the flexibility of the algorithm it was tested with pulses having a dif

Figure 12: Efficiency plot a) and sampled FADC value before first occurrence of saturation at \(t_{sat-1}\) b). Shaper time constant is 10 ns (\(t_{pk}=50ns\)), the digital discriminator threshold is set to 550, the RMS noise is 4.4 mV, the time jitter is \(\pm\)2 ns and the the strobe of the FADC is moved within \(\pm\)3 ns.

ferent pulse peaking time. The shaper time constants were changed to 5 ns in the simulation shown in Figure 16. For that simulation the variety of generated pulses at lower energies were reduced, but in the more important range at higher energies it is still large. For these pulses the FADC digitization strobe can be changed within \(\pm 4\) ns without any misidentified event. A rather large peaking time of 63 ns (see Figure 17) reduces the range for the FADC strobe. It can only be changed without a wrong identified event in a region from 1 ns up to -2 ns. An extension of that region can be achieved by including the sample at \(t_{sat-2}\) of the rising edge of the peak. This was already described in section 4, but it was not used in the simulations described so far. The second threshold \(s_{low}\) (set to 20 FADC counts) extends the range to \(\pm 3\) ns (see Figure 18).

Figure 13: Efficiency plot a) and sampled FADC value before first occurrence of saturation at \(t_{sat-1}\) b). Shaper time constant is 10 ns (\(t_{pk}=50ns\)), the digital discriminator threshold is set to 550, the RMS noise is 13.2 mV, the time jitter is \(\pm 2\) ns and the the strobe of the FADC is moved within \(\pm 3\) ns.

Measured integration effect of 71 m twisted-pair cable

Since the cable integration is the only effect, which causes a peaking time variation on the Preprocessor input signal, one needs confidence, that the cable simulation is close to reality. Therefore a laboratory test setup was used to measure the influence of a twisted-pair cable (type: Kerpen MegaLine 627 flex-4p). This cable has a bandwidth of 300 MHz and a propagation delay of 4.26 ns/m. Figure 14 shows the peaking time versus pulse amplitude of a trigger tower signal generated by an arbitrary function generator (AFG). The AFG waveform is used as input to a cable driver, which contains clipping operational amplifiers (CLC 502/CL) in the same way as the PSPICE schematic. The input peaking time (45 ns) of the AFG signal is independent from its amplitude. A short cable of 0.86 m and the transmitter and the receiver electronics increases the peaking time by 10-15 ns. A long 71 m cable increases the peaking time further by 8-12 ns for signals below the FADC saturation level. This corresponds to the length independent value (12 ns) introduced by the simulation model of a 70 m long cable.

Figure 14: Peaking time versus tower builder output voltage [10]. The curves are drawn for different cable length (71 m, 0.86 m), to give confidence for the cable integration effect.

BCID timing strategy

For each channel an automatic process is needed to set the position of the FADC digitization to the pulse maximum and to estimate the optimized threshold values for the saturated algorithm. One possible strategy is to use the Liquid Argon calibration system to generate a non-saturated pulse which is digitized with a default setting of the FADC strobe. A multi-pole fit function of the bipolar shaping is then applied to readout data of the calibration pulse. From that fit one can calculate the correct FADC strobe setting and the optimized thresholds. Thresholds are calculated from two scaled versions of the fit function. One is scaled to a pulse that just has reached saturation, and one is large enough to give an estimation of a saturated pulse. From those functions one can calculate the thresholds by looking at the fictitous sampling points at \(t_{sat-1}\) and \(t_{sat-2}\).

## 8 Summary

This paper has described a simulation of a digital algorithm used for Bunch-Crossing identification of saturated trigger tower signals. Table 3 summarizes investigated parameters for which the digital saturated algorithm has shown 100% efficiency. Table 4 gives a comparison with analogue-threshold BCID as described in [1] and the digital algorithm described here. Measurement of the integration effect of a 71 m long twisted pair cable has proven the cable model used for simulation.

\begin{table}
\begin{tabular}{|l|c|} \hline
**investigated parameter** & **value** \\ \hline \hline shaper time constant & 5 ns, 10 ns, 15 ns \\ peaking time & 43 ns, 50 ns, 63 ns \\ noise & 4.4 mV, 13.2 mV \\ time jitter & \(\sigma\) = 1 \(ns\) of a Gaussian distribution (\(\pm\)2 \(ns\)) \\ mis-aligned FADC dig. strobe & 6 ns (\(\pm\)3 \(ns\)) \\ energy range & 256 GeV - 10 GeV \\ saturation stages & lin. mixer, tower builder, layer sum \\ \hline \end{tabular}
\end{table}
Table 3: Investigated parameters for which the algorithm has shown 100% efficiency.

## References

* [1] ATLAS First-Level Trigger Technical Design Report. _ATLAS Level-1 Trigger Group, ATLAS TDR-12, CERN/LHCC/98-14, 24 June 1998, [http://atlasinfo.cern.ch/Atlas/GROUPS/DAQTRIG/TDR/tdr.html_](http://atlasinfo.cern.ch/Atlas/GROUPS/DAQTRIG/TDR/tdr.html_)
* [2] ATLAS Liquid Argon Calorimeter Technical Design Report. _ATLAS LAr Group, ATLAS TDR-2, CERN/LHCC/96-41, 15 December 1996 [http://atlasinfo.cern.ch/Atlas/GROUPS/LIQARGON/TDR/Welcome.html_](http://atlasinfo.cern.ch/Atlas/GROUPS/LIQARGON/TDR/Welcome.html_)
* [3] The LAr Tri-Gain Shaper, _J. Collot et al, ATLAS Internal Note, LArG-No-92, 11 March 1998 [http://preprints.cern.ch/archive/electronic/cern/others/atlnot/Note/](http://preprints.cern.ch/archive/electronic/cern/others/atlnot/Note/) larg/larg/larg-092.ps.gz_
* [4] Beam Test of a Single-Channel Bunch-Crossing Identification Module for the Level-1 Trigger, _I. P. Brawn et al, RD-27 note 31, October 1994 [http://www1.cern.ch/RD27/note31.ps_](http://www1.cern.ch/RD27/note31.ps_)
* [5] Bunch Crossing Identification Design, _David L. Rees, Discussion, 16 May 1997_
* [6] Bunch Crossing Identification for the ATLAS Level-1 Calorimeter Trigger, _Ian Paul Brawn, Thesis, Faculty of Science University of Birmingham, June 1996_
* [7] PSPICE model of the ATLAS LAr. analogue trigger tower chain, _Bill Cleland, private communication, University of Pittsburgh, July 1998_
* [8] A fast monolithic shaper for ATLAS e.m. calorimeter, _R.L. Chase et al, ATLAS internal Note, LARG-NO-10, 1 March 1995_

\begin{table}
\begin{tabular}{|l|c|c|} \hline  & **sat. analogue BCID** & **sat. digital BCID** \\ \hline \hline latency & no additional latency & no (parallel to non-sat. B CID) \\ chip count on PPrMCM & additional analogue chip & included inside PPrAsic \\ bonds per PPrMCM & increases & not increased \\ efficiency overlap & overlap (20 GeV - 256 GeV) & no \\ timing stability & 17.5 ns & 8 ns \\ energy range & \(>\) 20 \(GeV\) & \(>\) 256 \(GeV\) \\ X-talk & sensitive to giga bit signals & no \\ noise immunity & insensitive & insensitive \\ time independent & independent of 40 MHz clock & tied to the 40 MHz clock \\ cost & extra chip & no additional costs \\ \hline \end{tabular}
\end{table}
Table 4: Comparison between analogue and digital saturated algorithm.