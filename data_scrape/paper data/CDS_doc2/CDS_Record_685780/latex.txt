**ATLAS Internal Note**

**DAQ-NO-060**

**November 1995**

**TRIGger ALGORITHMS IN ATRIG**

**VERSION 1.30**

**ATLAS Trigger Performance Working Group**

**TABLE OF CONTENTS**

1. Introduction

2. Physics Requirements

3. Detector Description

3.1 Muon detector system

3.2 Calorimeter detector system

3.3 Transition radiation tracker

3.4 Precision tracker

4. LVL1 Trigger Algorithms

4.1 LVL1 muon trigger

4.2 LVL1 e/gamma trigger

4.3 LVL1 hadron trigger

4.4 LVL1 jet trigger

4.5 LVL1 missing-\(E_{t}\) trigger

4.6 LVL1 global trigger

5. LVL2 Feature-Extraction Algorithms

5.1 Muon system feature extraction

5.2 Calorimeter feature extraction

5.2.1 Electromagnetic calorimeter features

5.2.2 Hadronic calorimeter features

5.2.3 Preshower features

5.2.4 Transverse energy (\(E_{t}\))

5.3 TRT feature extraction

5.4 Precision tracker feature extraction in the barrel

5.5 Precision tracker feature extraction in the forward region

6. LVL2 Trigger Objects

6.1 LVL2 muons

6.2 LVL2 gammas

6.3 LVL2 electrons

6.4 LVL2 single charged hadrons

6.5 LVL2 jets

6.6 LVL2 missing-\(E_{t}\)

7. LVL2 Global Decision

8. LVL2 B-physics Trigger Algorithms

8.1 Confirmation of the trigger muon8.2 Full tracking scan

8.3 B-physics selection criteria

**APPENDIX: ATRIG IMPLEMENTATION**

A1. ATRIG Calling Sequences

A1.1 LVL1 muon trigger (T1MU)

A1.2 LVL1 calorimeter trigger (T1CA)

A1.3 LVL2 muon trigger (T2MU)

A1.4 LVL2 calorimeter trigger (T2CA)

A1.5 LVL2 preshower trigger (T2PS)

A1.6 TRT trigger (T2TR)

A1.7 Precision tracker in barrel region (T2SI)

A1.8 Precision tracker in forward region (T2MS)

A1.9 Global LVL2 trigger (T2GL)

A2. ATRIG Feature Banks

A2.1 Muon feature bank (T2MF)

A2.2 Calorimeter feature bank (T2CF)

A2.3 Preshower feature bank (T2PF)

A2.4 TRT feature bank (T2TF)

A2.5 Precision tracker feature bank in barrel (T2SF)

A2.6 Precision tracker feature bank in forward region (T2YF)

A2.7 Global RoI feature bank (T2GR)

A3. ATRIG ntuples

A4. ATRIG data cards

A4.6 Data cards for global LVL2 trigger

A5. Benchmarking of feature extraction algorithms

A5.1 Stand-alone muon FEX benchmarking

A5.2 Calorimeter FEX benchmarking

A5.3 TRT FEX benchmarking

A5.4 Precision-tracker FEX benchmarking

A5.5 Benchmarking the full TRT scan for B physics 

## 1 Introduction

The purpose of this note is to describe the ATLAS LVL1 and LVL2 trigger algorithms used in the current version of the ATLAS trigger simulation program[1], ATRIG version 1.30. This note is a summary of individual documents describing the muon triggers, the \(e/\gamma\) triggers, the jet triggers, and the missing-\(E_{t}\) triggers. Most of the text in this note was copied directly from these source documents.

## 2 Physics Requirements

### Detector Description

#### Muon Detector System

The ATLAS muon spectrometer is based on an 8-coil air- core toroidal magnet, with a field integral of 2.7 Tm in the barrel region. The trigger chambers are Resistive Plate Chambers (RPC) in the barrel region and Thin Gap Chambers (TGC) in the endcaps[9]. The high-precision chambers in the barrel and endcap regions are Monitored Drift Tubes (MD T's)[2]. A transverse view of the design is shown in Fig. 1. Each of the three layers of chambers contains 'large' and'small' chambers.

#### Calorimeter Detector System

The calorimeter algorithms in the current version of ATRIG were written for the analysis of the \(10^{6}\) jet production run produced in 1994[3]. This calorimeter layout is quite different from the layout described in the Technical Proposal.

The preshower detector[4] is taken as an independent preshower within the liquid Argon volume, after the solenoid coil. The preshower consists of two preshower planes: \(\phi\) strips after two radiation lengths, and \(\eta\) strips after three radiation lengths. The granularity of the \(\phi\) strips is \(\delta\eta\times\delta\phi=.10\times.002\) in the barrel region, and \(.10\times.003\) in the endcaps. The granularity of the \(\eta\) strips is \(\delta\eta\times\delta\phi=.002\times.10\) in the barrel and \(.003\times.10\) in the endcaps. The barrel/endcap transition is at \(\mid\eta\mid=1.4\), and the preshower detector ends at \(\mid\eta\mid=2.2\).

The electromagnetic liquid-Argon accordion calorimeter is modelled as a parallel-plate liquid-Argon calorimeter with three layers. All three layers have constant granularity of \(.025\times.025\). The inner radius of the barrel EM calorimeter is 146.7 cm, and the outer radius is 209.8 cm; it extends from \(\mid Z\mid=0.5\) cm to a maximum \(\mid Z\mid\) of 321 cm. The endcap EM calorimeter extends from \(\mid Z\mid=364.6\) cm to \(\mid Z\mid=427.0\) cm, with a maximum radius of 200 cm. The barrel/endcap transition is at \(\mid\eta\mid=1.4\), and the endcap ends at \(\mid\eta\mid=3.2\).

The barrel hadronic tile calorimeter is modelled as a cylinder with projective towers extending from \(Z=-295\) cm to \(Z=+295\) cm. The inner radius is 225 cm, and the outer radius is 420 cm. It has four longitudinal layers, all with \((\eta,\phi)\) granularity of \(0.10\times 0.10\).

The extended barrel hadronic tile calorimeter, which has the same cylindrical form as the barrel tile calorimeter, is separated from it by a 50 cm gap. The two sections of the extended barrel begin at \(\mid Z\mid=345\) cm and end at \(\mid Z\mid=610\) cm. It has four longitudinal layers, modelled as projective towers with granularity \(0.10\times 0.10\).

The hadronic liquid- Argon endcap calorimeter is a parallel-plate liquid- Argon calorimeter with projective towers which extend from \(\mid\eta\mid=3.2\) out to a maximum radius of 200 cm. The front and back planes are perpendicular to the beam axis at \(\mid Z\mid=427\) cm and \(\mid Z\mid=617\) cm, respectively. The hadronic endcap calorimeter has four layers, with constant granularity of \(0.10\times 0.10\).

The forward calorimeter was not used in this analysis.

### Transition Radiation Tracker

The Transition Radiation Tracker (TRT) is a tracking device consisting of stacked straw drift tubes interleaved with radiator material. A charged particle track leaves typically more than 30 hits in the detector, enabling a fast track search using a histogramming method. Transition radiation produced by electrons with \(P_{t}>0.5\)\(GeV/c\) can be used for electron/hadron separation. [5]

The transition radiation tracker used in the present code is the Cosener's House design, with 4 TRT modules in the barrel region and 14 in each endcap. The inner barrel modules are cylinders with inner radius 31.8 cm and outer radius 50.2 cm, extending from \(\mid Z\mid=45\) cm to \(\mid Z\mid=95\) cm; these short modules were not used in the TRT algorithms presented here. The middle and outer barrel modules are full cylinders extending from \(Z=-95\) cm to \(Z=+95\) cm. The middle module has an inner radius of 55.3 cm and an outer radius of 76.7. The outer module has an inner radius of 82.3 cm and an outer radius of 103.7 cm. These two full cylinders are readout separately from each end; they are grouped into two TRT parts, each covering a half-barrel with \(0.0<\mid\eta\mid<1.3\). The straw drift tubes in the barrel TRT are parallel to the beam axis, with a diameter of 4 mm.

The forward TRT modules are wheels with inner radius 49.8 cm and outer radius 104.0 cm. The 14 forward modules in each hemisphere are contained in the region 109 cm \(<\mid Z\mid<324\) cm. Their extent in \(Z\) increases from 7 cm for the inner three modules to 21 cm for the outer two modules on each side. The straw drift tubes in the forward wheels are radial, with a diameter of 4 mm.

Two thresholds are applied to the energy deposit in the TRT straws. The low-energy threshold at 0.2 keV removes electronic noise. The high-energy threshold at 5.5 keV selects transition-radiation signals.

### Precision Tracker

Trigger algorithms have been implemented in ATRIG for several precision trackers.[6] The analysis of the million jets generated for the Technical Proposal trigger studies was restricted to the central part of the inner tracker. It was based on the Cosener's House design, which has silicon strip layers before and after the TRT detectors. Four layers of \(R\)-\(\phi\) strips (\(R=30,52,79.5,105\) cm) and two layers of \(Z\) strips (\(R=53,80.5\) cm) were used for the silicon tracking trigger. The layers at \(R=30\) cm are crossed strip double layers with adjacent strips summed for the trigger (effective pitch 100 \(\mu\)m); they extend to \(\mid Z\mid=72\) cm. The other 5 layers are single layer strips with pitch 200 \(\mu\)m for the \(R\)-\(\phi\) strips and 1000 \(\mu\)m for the \(Z\) strips; they extend to \(\mid Z\mid=95\) cm.

In the Technical Proposal layout of the inner detector, all of the precision tracking elements are inside the TRT. There are four silicon layers in the barrel SCT, extending from \(Z=-82\) cm to \(Z=+82\) cm. Each layer has \(R\)-\(\phi\) strips with zero stereo angle on one side and stereo strips with stereo angles alternatively \(+40\) and \(-40\) mrad on the other side. The silicon layers are evenly spaced at radii of 30, 40, 50, and 60 cm. The silicon strips are 12 cm long with a 75 \(\mu\)m pitch.

The forward precision tracker has been studied using the Technical Proposal layout.[7] The MSGC detectors are arranged in 12 small wheels and one large wheel in each endcap. The small wheels are positioned inside the TRT between \(\mid Z\mid=90.0\) cm and \(\mid Z\mid=265.6\) cm. The large wheel is located between the TRT and the endcap calorimeter at \(Z=334.5\) cm. Each wheel consists of three layers of detectors: a \(\phi\) layer and two U,V stereo layers at \(+1\) degree and \(-1\) degree. The layers are overlapped so as to give full coverage for at least 2 of the 3 layers. The large wheel has three concentric rings of detectors 16 cm long extending from R = 44 cm to R = 96 cm; the small wheels consist of single rings covering R = 44 cm to R = 60 cm (see Fig. 2). The strips are all 16 cm long with a 200 \(\mu\)m pitch; the \(R\)-\(\phi\) resolution is 35 \(\mu\)m.

## 4 LVL1 Trigger Algorithms

### LVL1 muon trigger

The first-level muon trigger is based on fast, finely-segmented detectors to identify penetrating particles pointing to the interaction region.[8] The trigger chambers[9] are RPC's (Resistive Plate Chambers) in the barrel region (\(\mid\eta\mid<1.05\)) and TGC's (Thin Gap Chambers) in the endcaps (\(1.05<\mid\eta\mid<2.2\)). In both types of trigger chambers the signal is readout on electrodes segmented into logical strips with an intrinsic time resolution of \(<2\) ns for the RPC's and \(<5\) ns for the TGC's. The trigger is implemented in two projections, in the bend plane (\(R,Z\)) and in the non-bend plane (\(R,\phi\)).

The trigger scheme for the barrel region[10] is illustrated in Fig. 3. There are two RPC planes on each side of the middle muon station, and three RPC planes just before the outer muon station. The low-\(P_{t}\) trigger requires a threefold majority coincidence of the four middle planes, while the high-\(P_{t}\) trigger requires a twofold majority coincidence of the three outer planes and the low-\(P_{t}\)

The trigger scheme for the endcaps[8] is illustrated in Fig. 4. Here the three trigger stations are located outside the toroid. The first two stations, each made of two TGC planes, are spaced by about 0.3 m and select muons with a low-\(P_{t}\) threshold. The third station, made of three TGC planes, is located at a distance of about 1.5 m and selects muons with a high-\(P_{t}\) threshold. The trigger algorithms for the muon endcaps are still in preparation.[11]

The trigger logic will be implemented with a dedicated coincidence matrix circuit based on an ASIC developed within the RD27 collaboration.[12] The X-Y inputs to the coincidence matrix are given by the discriminated and shaped signals from the RPC/TGC strips of different planes. The \(P_{t}\) threshold is defined by a road in the matrix, and a signal is generated when there is a valid coincidence within the road. The combination of trigger planes and the size of the road are fully programmable. Three threshold settings can be used simultaneously in the coincidence matrix, as illustrated in Fig. 5. The high-\(P_{t}\) trigger is done using a second identical matrix, as shown in Fig. 6.

The identification of the bunch-crossing is done by latching the main clock with the coincidence matrix output. Programmable delays will be used to keep all coincidence matrices in phase.

The trigger segmentation in the barrel region will have 24 \(\phi\) sections (each of the 'large' chambers is split in two) and 11 \(\eta\) sections, defining regions of interest with \(\delta\phi\times\delta\eta\) roughly 0.25 \(\times\) 0.10. The endcaps will have 32 \(\phi\) sections and RoI'swith \(\delta\phi\times\delta\eta\) roughly 0.20 \(\times\) 0.10. The whole trigger system will be divided into four regions, two half-barrels and two end-caps, and into \(2\times 24+2\times 32=112\) sectors. The output of the LVL1 trigger will contain the bunch-crossing number, the \(P_{t}\) threshold, and the RoI location, for a maximum of two tracks in each of the 112 sectors.

For each bunch crossing, each of the 112 local sector triggers will generate a 32-bit word with the following information:

- number of trigger tracks in sector (2 bits, maximum two tracks)

- \(P_{t}\) threshold for each track (2 \(\times\) 2 bits each for low- and high-\(P_{t}\))

- \(T0\) counter (8 bits)

- additional information (6 bits)

Typical thresholds for the low-\(P_{t}\) and high-\(P_{t}\) muon triggers are 6 GeV/c and 20 GeV/c, respectively, although three thresholds can be used for each of these triggers. The trigger planes are segmented into strips of 3-4 cm width in the barrel and 1 cm width in the endcaps, somewhat smaller than the expected spread in the displacement. The trigger coincidence efficiency (ignoring roughly 4% of dead area) is shown in Fig. 7.

The inclusive muon trigger rate for a 6 GeV/c \(P_{t}\) threshold at a luminosity of \(10^{33}/cm2/s\) is about 4 kHz from charm and beauty semileptonic decays and about 4 kHz from in-flight pi and K decays and punchthrough muons. For a 20 GeV/c \(P_{t}\) threshold at a luminosity of \(10^{34}\), the trigger rate due to heavy quarks and W and Z decays is about 4 kHz. The signal rates and the expected background rates are shown in Fig. 8 for the low-\(P_{t}\) trigger and in Fig. 9 for the high-\(P_{t}\) trigger.

### LVL1 e/gamma trigger

The LVL1 \(e/\gamma\) trigger[13] is based on electromagnetic clusters in the EM calorimeter. The EM cluster algorithm contains two elements: a threshold applied to a narrow cluster of energy in the EM calorimeter, and 'isolation' requirements which veto clusters with significant energy deposits nearby in the EM or hadronic calorimeters.

The EM calorimeter cells are grouped into 'trigger cells' with the same granularity as the hadronic calorimeter, \(\delta\eta\times\delta\phi=0.1\times 0.1\). Depth samples are summed to give EM and hadronic \(E_{t}\) for each of the trigger cells. A threshold of 1 GeV is applied to the trigger cell \(E_{t}\) before the calculation of the cluster energies in order to reduce the effects of electronic noise and pile-up. (The electronic noise in an EM trigger cell at \(|\ \eta\ |=0\) will be in the range 0.3-0.4 GeV.) All calculations are done in integer arithmetic in units of 1 GeV in \(E_{t}\).

The cluster-finding algorithm is illustrated in Fig. 10. A grid of windows of 4 \(\times\) 4 trigger cells is considered, sliding in both coordinates in units of one trigger cell. A cluster threshold is applied to the \(E_{t}\) in pairs of adjacent EM cells within the 2 \(\times\) 2 cell area at the center of each window; all four possible two- cell clusters are considered. Figure 11 shows the efficiency as a function of threshold for 40 GeV electrons at \(|\ \eta\ |=0\) with the selected cluster algorithm (2 \(\times\) 1 cell cluster) and with two alternative cluster definitions (single cell and 2 \(\times\) 2 cell cluster). The two- cell efficiency is almost as sharp as the four-cell efficiency, which should contain all EM showers, whereas the trigger rate for the two-cell cluster is about half that of the four-cell cluster.

Isolation criteria can be used to reject much of the dominant jet background to the \(e/\gamma\) triggers, since in most of the physics processes of interest the electrons or photons are not part of a jet. The isolation criteria require that the \(E_{t}\) in the 12 EM cells around the 2 \(\times\) 2 cell area be less than the EM isolation threshold, and that the \(E_{t}\) in the 16 hadronic cells behind the 4 \(\times\) 4 cell area be less than the hadronic isolation threshold.

Additional logic is necessary to avoid multiple-counting of clusters found in overlapping windows and to uniquely identify the location of the \(e/\gamma\) Rol's. This can be accomplished by requiring that, in addition to being part of a cluster passing the trigger conditions, an Rol candidate trigger cell must also contain more \(E_{t}\) than its neighbors. (Asymmetric algorithms are necessary to handle the rare cases where \(E_{t}\) is shared equally between neighboring cells.)

Eight sets of thresholds are available for the \(e/\gamma\) trigger. Each set specifies thresholds for the EM cluster \(E_{t}\), the EM isolation, and the hadronic isolation. This allows different thresholds to be used for single cluster and multi-cluster triggers. It also allows relaxation of the isolation cuts for higher-\(P_{t}\ e/\gamma\) candidates. The pseudorapidity acceptance of the \(e/\gamma\) trigger is \(|\ \eta\ |<2.5\).

**4.3 LVL1 hadron trigger**

The LVL1 hadron trigger granularity has not yet been chosen.

**4.4 LVL1 jet trigger**

Jet production will be the dominant high-\(P_{t}\) process at the LHC. Consequently, unlike the \(e/\gamma\) trigger, jet triggers will be largely background-free. Optimization of the jet trigger algorithm\({}^{13,14}\) requires sharpening the threshold curve to minimize the trigger rate for a given physics requirement.

A significant improvement in the jet trigger sharpness can be obtained by adjusting the relative weighting of the \(E_{t}\) measured in the EM and hadronic calorimeters (i.e., the relative calibration). Since the \(e/\pi\) response ratio of the EM calorimeter will be approximately 1.3, and jets are a mixture of EM and hadronic energy, the optimum calibration for the jet \(E_{t}\) would be to weight the EM calorimeter more than would be required for accurate EM \(E_{t}\) measurement, but less than would be needed for optimal hadronic measurement.

The jet trigger[14] is based on an \(E_{t}\) sum in a square window in the EM and hadronic calorimeters. The window size must be at least as large as the core of the jet, and the windows should overlap. The window size in the current code is \(0.8\times\,0.8\), sliding by 0.4 in \(\eta\) and in \(\phi\). The algorithm is implemented by summing groups of trigger cells into 'jet cells' with granularity 0.4 \(\times\) 0.4, then forming a simple sum over 2 \(\times\) 2 'jet cells'. (Studies are continuing on the performance of a smaller window size of 0.6 \(\times\) 0.6, sliding by 0.2 to avoid wrap-around problems in \(\phi\). In this case, the 'jet cells' would have granularity 0.2 \(\times\) 0.2, and the sums would cover 3 \(\times\) 3 'jet cells'.)

A declustering algorithm is once again required to resolve multiple counting of overlapping jet triggers and to determine the RoI coordinates. In the system used here, jet trigger hits are generated for each 2 \(\times\) 2 jet window above threshold. These hits are associated with the bottom-left 'jet cell' of the window (an arbitrary choice). The declustering algorithm operates on a bitmap of yes/no flags for each 'jet cell'. A hit is accepted if there is no hit in the neighboring'veto' region shown in Fig. 12. The RoI coordinates are taken as the coordinates of the accepted 'jet cell'.

### LVL1 missing-\(E_{t}\) trigger

The principle of the missing-\(E_{t}\) trigger[13] is simple. All input calorimeter data (\(E_{t}\)) are resolved into \(E_{x}\) and \(E_{y}\) components, and these components are summed to form global \(E_{x}\) and \(E_{y}\) for the event. The quadratic sum of these components gives the missing \(E_{t}\).

The optimum weighting of the \(E_{t}\) from the EM and hadronic calorimeters should be the same as that used for the jet trigger. All calorimeter data should be included in the missing-\(E_{t}\) calculation, including the forward calorimeter for \(|\)\(\eta\)\(|\)\(<\) 5.0. A \(\phi\) granularity of 0.4 is used for the conversion of \(E_{t}\) to its \(E_{x}\) and \(E_{y}\) components.

Recent work[15] has shown that the missing-\(E_{t}\) resolution can be improved significantly by including proper pulse shaping, thresholds, and beam-crossingidentification for the calorimeter data.

**4.6 LVL1 global trigger**

The LVL1 trigger hardware provides for a menu of 96 trigger items formed from 128 input bits. The input bits include trigger bits from the muon and calorimeter trigger ASIC's, special trigger bits controlling calibration or test data, and control bits such as SUSY signals. The central LVL1 trigger processor accepts programmed combinations of the trigger bits in coincidence or as vetos.

The global LVL1 trigger in the present ATRIG simulation program does not allow combination of trigger bits from different trigger types. Thus, multiple-object triggers are only implemented for multiple objects of the same type (\(\mu\mu,\gamma\gamma\), \(jet\ jet\), etc.). Mixed-type triggers (\(\gamma\ jet\), etc.) will be implemented in a future version of ATRIG.

**5. LVL2 FEATURE EXTRACTION ALGORITHMS**

**5.1 Muon system feature extraction**

The purpose of the LVL2 muon trigger [16, 17] is the identification of the muon tracks in the muon spectrometer, the accurate calculation of the muon transverse momentum (\(P_{t}\)), and the extrapolation of the muon track to the calorimeter and to the inner tracker. The LVL2 trigger algorithm consists of pattern recognition in the Monitored Drift Tubes (MDT's), followed by a \(P_{t}\) fit.

The pattern recognition in the MDT's is initiated in the fast chambers used for the LVL1 trigger (RPC's in the barrel and TGC's in the endcaps) because of the high background rate in the MDT's. The pattern recognition is performed in two phases: [18] the selection of MDT hits within a road defined by the hits in the trigger chambers, followed by the removal of background hits using a contiguity algorithm.

Muon roads are defined along the trajectory in each muon chamber. Three points are used to define the muon trajectory, as shown in Fig. 13. For the high-\(P_{t}\) trigger, points in the three trigger chambers (SP1, SP2, SP3) are used; for the low-\(P_{t}\) trigger, SP3 is not available, so the nominal interaction point is used for the third point. Each point is an average of the RPC hits on all layers of the given trigger station. The muon trajectories are parameterized as a circle for the high-\(P_{t}\) trigger, or as a circle in the spectrometer region and a straight line tangent to the circle for the low-\(P_{t}\) trigger. Straight segments (the chords of the arcs of the muon trajectory) are defined in each of the MDT's. Hits are selected if the residual with respect to the straight segment is less than the road size for that layer of that muon chamber. The road size is defined, using simulated muon tracks, such that 90% of the muon hits are on the road.

Background hits remaining in the muon roads are dropped using an iterative procedure in which contiguous hits in each muon chamber are preferred to spreadout hits. In each chamber, hits with the largest deviation from the average residual are dropped until the number of points is less than or equal to 8 (the number of layers) and the improvement in the spread of the residuals is less than a predefined value. Then the hit with the residual closest to the final average residual is selected for each muon chamber layer. This pattern recognition procedure defines clean muon tracks with a maximum of eight hits in each muon chamber.

The algorithm[19] for the muon \(P_{t}\) measurement in the barrel region is based on a sagitta measurement in the magnetic field, as shown in Fig. 14. 'Superhits' are calculated in the bending plane of each MDT station as the average of the (at most 8) hits found in the pattern recognition stage. The three superhits in the three MDT stations determine the \((\eta,\phi)\) position of the muon track and its effective sagitta. Then the sagitta is related to \(P_{t}\) by a function that has been evaluated for each \((\eta,\phi)\) position using detailed simulations.

Sagitta maps are stored in look-up-tables as shown in Fig. 15. Average sagitta values for each \((\eta,\phi)\) position in the barrel magnetic field region are stored in the look-up-tables for a defined set of \(P_{t}\) values (from 6 to 50 GeV/c). Separate look-up-tables are used for each muon charge in the large-chamber regions and in the small-chamber regions. The \((\eta,\phi)\) partitions use a 3-cm step for the large chambers and a 1-cm step for the small chambers. The \(P_{t}\) values are scanned in 1 GeV/c steps from 6 to 10 GeV/c, in 2 GeV/c steps from 10 to 20 GeV/c, and in 5 GeV/c steps from 20 to 50 GeV/c. The total size of the four look-up-tables is about 1 Mbyte.

Linear interpolation in the sagitta interval is used to calculate the final muon \(P_{t}\). For \(P_{t}>50\)\(GeV/c\), the muon \(P_{t}\) is determined from a linear extrapolation in the inverse value of the sagitta, starting from the sagitta entry in the look-up-table for a 50 GeV/c muon at that \((\eta,\phi)\) position.

### Calorimeter feature extraction

The LVL2 calorimeter trigger[20, 21] uses data from the EM and hadronic calorimeters as well as data from the stand-alone preshower detector. The transverse energy includes contributions from all three of these detectors.

The size of the calorimeter RoI is defined in the T2 supervisor: for \(e/\gamma\) RoI's, the RoI size is 0.3 \(\times\) 0.3; for jet RoI's, the RoI size is 1.2 \(\times\) 1.2; and for muon RoI's, the RoI size is 0.2 \(\times\) 0.2.

**5.2.1 Electromagnetic Calorimeter Features**

The EM calorimeter features depend on the type of RoI. Cluster energies are determined for an EM core, an inner ring, and an outer ring. The window parameters can be controlled by data cards. The windows are symmetric for jet and muon RoI's, but they may be asymmetric for \(e/\gamma\) RoI's. The default parameters are identical for \(e/\gamma\) and muon RoI's, a 9 \(\times\) 9 cell window, with a 5 \(\times\) 5 cell core and single- cell inner and outer rings. Jet RoI's have a 32 \(\times\) 32 cell EM window (0.8 \(\times\) 0.8) with a 16 \(\times\) 16 cell core and 4-cell inner and outer rings. (In fact, the EM data for jet RoI's will be preprocessed\({}^{22}\) into 0.1 \(\times\) 0.1 bins. The trigger code will be modified to include this preprocessing step.)

The EM core is determined by scanning all windows in the RoI, with single-cell steps in \(\eta\) and in \(\phi\), to find the core with the highest \(E_{t}\). A very nominal threshold (0.1 GeV) is imposed to protect against erroneous data. The core \(E_{t}\) in each of the three EM layers, and the cluster position, calculated as the geometrical center of the EM core, are stored in the feature bank.

For the special case of \(e/\gamma\) RoI's, the feature banks and ntuples contain additional asymmetric \(E_{t}\) sums for use in the optimization of the electron algorithms, with 3 \(\times\) 5, 3 \(\times\) 7, 5 \(\times\) 7, 5 \(\times\) 9, and 7 \(\times\) 9 EM cells. These asymmetric clusters are wider in \(\phi\) than in \(\eta\) because of the spread in \(\phi\) due to bremsstrahlung. The present \(e/\gamma\) algorithms use two shape factors to reduce the jet backgrounds, QF77 = (7 \(\times\) 7)/(9 \(\times\) 9) EM cells, and QF37 = (3 \(\times\) 7)/(5 \(\times\) 7) EM cells.

**5.2.2 Hadronic Calorimeter Features**

The hadronic calorimeter features include the \(E_{t}\) in a hadronic window chosen according to the RoI type. The hadronic \(E_{t}\) is obtained by adding the \(E_{t}\) measured in the barrel tile calorimeter, the extended barrel calorimeter, and the endcap liquid Argon hadronic calorimeter. The window parameters can be controlled by data cards. The default windows are 2 \(\times\) 2 hadronic cells (0.2 \(\times\) 0.2) for the \(e/\gamma\) and muon RoI's, and 8 \(\times\) 8 hadronic cells (0.8 \(\times\) 0.8) for jet RoI's.

For \(e/\gamma\) RoI's, the hadronic window is taken directly behind the selected EM window. Hadronic isolation requires that the \(E_{t}\) in the hadronic window be below the hadronic isolation threshold. The hadronic cluster position is not calculated for the \(e/\gamma\) Rol's.

For muon and jet Rol's, the hadronic window position is found by scanning all hadronic windows in the Rol, with single-cell steps in \(\eta\) and \(\phi\), to find the cluster with the highest \(E_{t}\). The cluster position in \(\eta\) and \(\phi\) is calculated as the geometric center of the window selected. The jet \(E_{t}\) is the sum of the \(E_{t}\) in the selected hadronic and EM windows.

#### 5.2.3 Preshower Features

The preshower features consist of the preshower \(E_{t}\) and the preshower 'profile' for each of the two preshower layers (\(\eta\) and \(\phi\)), and the \(\eta\) and \(\phi\) positions measured in the preshower detectors by the center-of-gravity method. The preshower \(E_{t}\) is a weighted sum of all the energy deposited in the Rol; the weights used to calibrate the preshower \(E_{t}\) depend on \(|\)\(\eta\)\(|\), with three \(|\)\(\eta\)\(|\) regions in each half-barrel, and three \(|\)\(\eta\)\(|\) regions in each endcap. The preshower profile in \(\eta\) or \(\phi\) is defined as

\[{\rm Profile}=\Delta E(\delta=0.006)/\Delta E(\delta=0.048)\]

where \(\Delta E\) is the energy deposit in \(\delta\eta\) or \(\delta\phi\) of 0.006 and 0.048, as indicated. This definition corresponds to 3 strips out of 24 in the barrel region, and 2 strips out of 16 in the endcaps.

#### 5.2.4 Transverse Energy (\(E_{t}\))

The best estimate of the transverse energy is obtained by combining the \(E_{t}\) measured in the calorimeters with the \(E_{t}\) measured in the preshower detectors. For muon and jet Rol's, the 'jet' \(E_{t}\) (EM + hadronic) is added to the preshower \(E_{t}\). For the \(e/\gamma\) Rol's, only the EM \(E_{t}\) is added to the preshower \(E_{t}\).

### TRT feature extraction

The original pattern recognition algorithm for the TRT was written by I. Gavrilenko.[23] It exploits the two essential qualities of the TRT: the large number of hits per track, which reduces the number of fake tracks, and the low occupancy for hits with energy above 5 keV, which enhances the capability to identify electrons. The LVL2 TRT trigger algorithm described here was developed by P. Eerola:[5] it allows the reconstruction of high-\(P_{t}\) tracks in the TRT originating from the beam interaction point.

The drift tube straws are axial in the barrel TRT and radial in the endcaps. Tracks originating from the vertex appear as straight lines in the (\(\phi\), \(Z\)) plane in the endcaps, and almost straight lines in the (\(\phi\),R) plane for the barrel and in the \((R,Z)\) plane in the endcaps, as shown in Fig. 16. Note that points in the \((R,Z)\) plane in the endcaps are given indirectly through the particle entrance and exit positions in the detector, determined by the first and last hit straws on the trajectory; [24] they are necessary to obtain a stand-alone \(P_{t}\) estimation in the TRT. The equations for the particle trajectories in the barrel are given by [23]

\[q\times C_{t}\times R=sin\bigl{(}\phi-\phi_{0}\bigr{)}\]

\[\phi=\phi_{0}+q\times C_{t}\times R\times(1+((C_{t}\times R)^{2})/6)+...\]

The equations for the endcaps are given by [23]

\[\phi=\phi_{0}+q\times C_{l}\times(Z-Z_{0})\]

\[C_{t}\times R=sin\bigl{(}C_{l}\times(Z-Z_{0})\bigr{)}=C_{l}\times(Z-Z_{0})+...\]

\[R=(Z-Z_{0})\times C_{l}/C_{t}+...=(Z-Z_{0})\times tan\theta+...\]

Here \(q\) is the particle charge, \(R\) is the radius, \(Z\) is the coordinate along the beam direction, \(Z_{0}\) is the vertex position, \(\phi_{0}\) and \(\theta\) are the initial azimuthal and polar coordinates, \(C_{t}=\alpha/P_{t},C_{l}=\alpha/P_{l}\), and \(\alpha=H(Telsa)/(666~{}GeV)\) when \(R\) and \(Z\) are measured in cm.

The slope of the track in the \((\phi,R)\) plane yields \(P_{t}\) (for the barrel). The slope in the \((\phi,Z)\) plane yields the longitudinal momentum (for the endcaps). The slope in the \((R,Z)\) plane is needed to estimate \(P_{t}\) in the endcaps.

The pattern recognition and track fitting is performed in several steps. The number of slopes to be scanned is chosen such that each step is smaller than the straw diameter in any of the TRT layers. The default parameters are set for a minimum \(P_{t}\) of 5 GeV/c, requiring 13 different slopes to scan for both positive and negative particles. (121 slopes would be required for a minimum \(P_{t}\) of 0.5 GeV/c.)

The initial search for track candidates in the barrel TRT is carried out by scanning the roads defined by

\[q\times Ct\times R=sin\bigl{(}\phi-\phi_{0}\bigr{)}\]

with each of the selected slopes, starting successively from the \(\phi_{0}\) position of each hit straw in the RoI, as shown in Fig. 17. The roads have a total width of 4 mm, matching the granularity of the straws. For each starting position (each hit straw), the slope yielding the maximum number of hits is retained if that number exceeds a certain limit, unless there are more hits for the next starting position for the same slope. (The default value for the limit requires that the number of hits in the RoI plus the number of hits within this narrow road be at least 15.)The roads used in the initial search for track candidates are expanded from a full width of 4 mm to 28 mm in the second processing step, for the default parameters. Track candidates with the largest number of hit straws in the initial search are processed first in this second step. Hits within the 4-mm road are counted as 'unique' hits unless they were already assigned to another track candidate.

Fine tuning is performed on track candidates with more than three 'unique' hits. The drift-time information is used for the fine-tuning. Three intervals are calculated for each straw in the wide (28 mm) road: one interval covers the full straw, and the two other intervals correspond to the right-left ambiguity for the position indicated by the drift-time measurement (and its uncertainty). All three intervals are included in a new set of histograms based on the narrow roads (4 mm) selected in the initial search. Hits with drift-time measurements inside the narrow road have their weight doubled; hits previously assigned to another track candidate have their weight divided by two.

The circle fits are performed in conformal space. Circle parameters are first determined using a simplex fit in the linear approximation. Then parabolic fits are performed with and without the vertex information. Only information from the parabolic fit using the vertex information is retained for the TRT trigger feature bank.

Track candidates are rejected at this point if the measured \(P_{t}\) is less than a required minimum value (default 5 GeV/c) or if the track quality is poor: ratio of hits to crossed straws less than 75% (default), ratio of time hits to total hits less than 50% (default), \(\chi^{2}>100\) (default), or number of hits on the track less than 20 (default).

Normally 'ghost' tracks with less than 50% (default) unique hits are removed in a final selection process, but this selection has been deactivated for the LVL2 trigger so that the final track selection can use information not available in the TRT system, such as parameters from the muon or calorimeter systems.

The trigger code for the forward TRT has not yet been installed in ATRIG.

**5.4 Precision tracker feature extraction in the barrel**

R. Hawkings has written algorithms for the silicon tracker in the barrel region for the Cosener's House layout, the Panel layout, and the Technical Proposal layout. [6] He has also studied means of extending the barrel tracker trigger algorithm into the transition region between the barrel tracker and the forward tracker.

The first step in the silicon processing is the definition of the RoI in each plane of the silicon detector. (This is typically a job for the preprocessor.) The LVL2 supervisor provides RoI limits in \(\phi\) and \(\eta\) at the entrance to the calorimeter. The \(\phi\) limits provided by the supervisor can be used in the silicon tracker for high-\(P_{t}\) tracks coming from the vertex. This is not true for the \(\eta\) limits, however, because of the longitudinal spread in the vertex position. The silicon tracker instead uses \(Z\) limits, \(Z_{i}^{min}\) and \(Z_{i}^{max}\) for layer \(i\),

\[Z_{i}^{min} = (Z_{c}^{min}+V)\times R_{i}/R_{c}-V\] \[Z_{i}^{max} = (Z_{c}^{max}-V)\times R_{i}/R_{c}+V\]

where \(Z_{c}^{min}\) and \(Z_{c}^{max}\) are the \(Z\) positions at the calorimeter corresponding to the \(\eta\) limits given by the supervisor, \(R_{i}\) and \(R_{c}\) are the radii at silicon layer \(i\) and at the calorimeter, and \(V\) is half the longitudinal vertex spread. These limits are illustrated in Fig. 18.

The trigger algorithm considers tracks as straight lines in the \((R,\phi)\) plane, using the form

\[\phi=\phi_{0}+R/(2\times r)\]

where \(r\) is the radius of curvature of the track and \(R<<r\). The track \(P_{t}\) can be deduced from the slope in \((R,\phi)\) space, using

\[P_{t}(GeV/c)=0.3\times B(Tesla)\times r(m)\]

The algorithm divides the RoI into \(Z\) slices, which are then further divided into \(\phi\) subslices. All combinations of hits within the subslice are then considered for a straight line fit, requiring 1 hit per layer on either 3 or 4 layers. For each fit, the RMS distance of the fit points from the track is calculated, and a cut is used to select good trigger tracks. The gradient of the track is then used to calculate the \(P_{t}\), and it is retained if it is above the trigger threshold. A quality algorithm is then used to decide which of any candidate tracks to return as the trigger tracks. In the Cosener's House layout, the \(Z\) layers can also be used to make a subsidiary fit in \(Z\) after the \(\phi\) track-finding.

The division of the RoI into smaller subslices reduces the number of hit combinations that have to be considered. In \(Z\), each wafer in the highest \(R\) layer is considered separately, but the road becomes wider because of the vertex spread as the origin is approached, so that each wafer in the first layer is considered with several of the wafers in the last layer. Each \(Z\) subslice is divided into several overlapping \(\phi\) subslices (16 for the Cosener's House layout, and 8 for the Panel and Technical Proposal layouts). The 'width' of the overlap in \(\phi\) is taken somewhat larger than \(\Delta R/(2\times r)\), where \(\Delta R\) is the difference in radius between the first and last silicon layers.

Tracks candidates are searched for in each \((Z,\phi)\) subslice. For each valid combinations of hits, including at most one'missing' layer, a linear least squares fit is performed. If the fit RMS is acceptable, \(P_{t}\) and \(\phi\) values extrapolated to the vertex \((\phi_{0})\) and to the calorimeter are calculated. The candidate track is retained if \(P_{t}\) is above the appropriate threshold (default 5 GeV/c).

In the special case of the Cosener's House design, the two \(Z\) strip ('pad') layers are used to set limits on the minimum and maximum \(Z\) position at the calorimeter, consistent with the hits in the \(Z\) pads and consistent with the vertex spread.

Finally, the 'best' track candidate is chosen. Tracks with four hits (no missing layers) are selected in preference to tracks with only three hits, then the track with the smallest RMS is selected.

**5.5 Precision tracker feature extraction in the forward region**

The MSGC tracker has been studied by J. Baines, R. Dankers and S. Sivokolov. [7] The feature extraction algorithm searches for tracks in \((\phi,Z)\) space. High-\(P_{t}\) tracks are straight lines in this space; hits are transformed by Hough transformation into histograms in \((\alpha,\phi_{0})\), where \(\alpha\) is the slope and \(\phi_{0}\) the intercept in \((\phi,Z)\) space. The \(P_{t}\) of the track is inversely proportional to \(\alpha\) for a uniform magnetic field:

\[P_{t}=1.5\times B\times tan(2\times tan^{-1}(e^{-\eta}))/\alpha\]

The first step in the MSGC trigger implementation is the preprocessing of the hit information into a representation in the \((\phi,Z)\) plane. Hits on \(\phi\) strips are represented as a single point. A pair of hits from crossing \(U,V\) strips are represented by a pair of points at the \(\phi\) of the crossing point; in the case of ambiguities, all possible pairs of points are used. Hits on \(U(V)\) strips which do not have associated hits on a \(V(U)\) strip are represented by several points at intervals of 0.5 mrad in \(\phi\), corresponding to positions at intervals along the strip.

The Hough transform to a two-dimensional \((\alpha,\phi_{0})\) histogram is then defined. The maximum slope is determined by the minimum \(P_{t}\) for the search (default 10 GeV/c) and the \(\eta\) of the LVL1 RoI. The full range for both signs of the slope is divided into 90 bins. At \(\eta\)=2, the bin width corresponds to \(\Delta P_{t}\)) of about 3 GeV/c for a track with \(P_{t}=30\) GeV/c. The range of \(\phi_{0}\) is defined by the size of the RoI (0.3). The \(\phi\) bin size is 0.5 mrad, equivalent to the granularity of the strips. The number of \(\phi\) bins is about 600.

The number of hits in a given bin of the histogram represents the number of hits along the track candidate characterized by the \((\alpha,\phi_{0})\) of that bin. The bin with the most hits (minimum 8 hits) is chosen as the best track. In case of ambiguity, the highest \(P_{t}\) candidate is chosen. The \(\eta\) value at the center of the RoI is used for the \(P_{t}\) calculation.

## 6 IvL2 Trigger Objects

### LVL2 Muons

The muon algorithm combines data from the stand-alone muon system, the tracking systems (TRT plus precision trackers), and the calorimeter. A match is required between the track parameters \((P_{t},\phi,\eta)\) found in the muon system and a track candidate in the tracking system. The best \(P_{t}\) estimate is used to test the muon \(P_{t}\) thresholds. For the lower-\(P_{t}\) muon thresholds, isolation criteria can be imposed using the calorimeter data in the muon trigger RoI. The possibility also exists to require a minimum- ionization signal from the muon in the calorimeter system.

### LVL2 Gammas

The gamma algorithms[25] use only the data from the calorimeter system (preshower and EM and hadronic calorimeters). Electromagnetic and hadronic isolation criteria are applied. A match is required between the signals in the preshower detectors and the signals in the EM calorimeter. Because nearly 15% of the photons convert only after the independent preshower detector, the algorithm requires that the energy deposit in the preshower detector be small, or that the preshower profile be large (corresponding to a narrow energy cluster), or both. For events with sufficient energy deposit in the preshower detectors, a match is also required between the position in \(\eta\) and \(\phi\) measured in the preshower detector and the position measured in the EM calorimeter.

### LVL2 Electrons

The electron algorithms[25, 26] combine data from the calorimeter system and the tracking systems (TRT plus precision trackers). Electromagnetic and hadronic isolation criteria are applied, similar to those used for the gamma candidates. The preshower algorithm requires a non-zero preshower energy deposit, a large value for the preshower profiles (narrow clusters), and a match between the \(\eta\) and \(\phi\) positions measured in the preshower and in the EM calorimeter. Electron candidates are distinguished from gamma candidates by requiring a match between the parameters \((E_{t},\eta,\phi)\) found in the calorimeter system and the parameters \((P_{t},\eta,\phi)\) of a track candidate in the tracking system.

**6.4 LVL2 Single Charged Hadrons**

The charged hadron algorithm combines data from the calorimeter system and the tracking system. Selection criteria include isolation in the EM and hadronic calorimeters, a small fraction of EM energy, and a matching track in the tracking system. This algorithm cannot be implemented until the LVL1 and LVL2 calorimeter features are defined for the hadron RoI's.

**6.5 LVL2 jets**

The jet trigger algorithm uses only the data from the calorimeter system (including the preshower). Selection depends only on \(E_{t}\) and \(\eta\).

**6.6 LVL2 missing-E\({}_{t}\)**

The missing-\(E_{t}\) resolution could be quite important for the LVL2 trigger. Missing-\(E_{t}\) will be an important part of the signature in SUSY particle searches. [15] Selection of leptonic W decays could be improved by better missing-\(E_{t}\) resolution; it would be useful to be able to trigger at LVL2 on a low-\(P_{t}\) lepton plus missing-\(E_{t}\), with the nominal missing-\(E_{t}\) threshold at about 20 GeV. The current ATRIG code takes the missing-\(E_{t}\) from LVL1 without recalculation and without correction for the muon \(E_{t}\) measured in the muon system.

**7. LVL2 GLOBAL DECISION**

The basic idea of the global L2 trigger [27] is to use a matrix of trigger conditions, with the number of trigger objects required on the columns and the six basic trigger objects on the rows. The trigger conditions become looser (lower \(P_{t}\) thresholds, looser isolation, etc.) as the number of objects required increases. A single matrix with the six trigger objects generates a trigger menu with six single-object triggers, 20 double-object triggers, and 50 triple-object triggers (considering that the missing-\(E_{t}\) cannot appear more than once in a given menu item).

More flexibility is required than that allowed by the simple matrix described above. In particular, trigger conditions are required both for isolated and for non-isolated muons, electrons, and photons. These triggers can be accommodated simply by adding more trigger objects in the rows of the matrix.

The global trigger menu is implemented in ATRIG using data cards (see section A4.6 in the Appendix). The data cards define trigger conditions for each of the basic trigger objects. Each set of trigger conditions includes thresholds for each of the features in the global Rol feature bank (T2GR) as well as the number of objects required for that set of trigger conditions. The present ATRIG code allows for a maximum of 15 sets of trigger conditions for each basic trigger object (muon, electron, photon, hadron, jet, and missing-\(E_{t}\)).

## 8 LVL2 B-Physics Trigger Algorithms

For B physics triggers[5, 28] at low luminosity, the LVL1 trigger is based on a single muon above 6 GeV, and the LVL2 trigger algorithms are considerably different from those described above. The trigger muon must be verified in the stand-alone muon system, then matched to a track in the inner tracker (TRT plus precision tracker). If the trigger muon is confirmed, a full scan of the TRT system is used to find all track candidates with \(P_{t}>0.5\ GeV\) (nominal \(P_{t}>1\ GeV\)). These tracks are tested against selection criteria specific to different B-physics channels. In some cases, the tracks found in the full TRT scan will be used to define new Rol's for the precision tracker, and possibly for the calorimeter.

### Confirmation of the trigger muon

The trigger muon defines an Rol at LVL1. This RoI will be processed as a normal muon RoI at LVL2, with feature extraction in the stand-alone muon system, in the trackers, and in the calorimeter. A track-match will be required between the stand-alone muon and the track parameters found in the tracking system, and the refined value of \(P_{t}\) will be tested against the 6 GeV/c \(P_{t}\) threshold. Isolation in the calorimeter will not be required, but the energy loss in the calorimeter may be used to sharpen the energy match between the trigger muon and the track found in the inner tracker. It is estimated that confirmation of the trigger muon will reduce the trigger rate for this channel by 50%, from the 8 kHz LVL1 rate to about 4 kHz.

### Full tracking scan

The full TRT track scan[29] is performed in the same way as described above for TRT feature extraction, except that tracks are searched for in the full tracking volume, and not just in limited Rol's, and the minimum allowed \(P_{t}\) is reduced to 0.5 GeV/c.

This full scan is slow, and it can probably be speeded up by adding a prescan step with larger roads to determine track parameters (ranges for \(\phi_{0}\) and the slope in the (\(\phi\),R) or (\(\phi\),Z) planes) for the pattern recognition process described above. Further gain may be possible if the drift time is ignored for the slower track candidates.

### B-physics selection criteria

Tracks found in the full TRT scan are tabulated and compared to the B-physics trigger requirements shown in Table 1. At the track level, these requirements correspond to any of the following track combinations (in addition to confirmation of the LVL1 trigger muon with \(P_{t}>6\ GeV/c\)):

\[\begin{array}{ll}\mbox{One muon}&P_{t}>5\ GeV/c\\ \mbox{One electron}&P_{t}>5\ GeV/c\\ \mbox{Two electrons}&P_{t}>1+1\ GeV/c\\ \mbox{Two hadrons}&P_{t}>6+15\ GeV/c\\ \mbox{Three hadrons}&P_{t}>1.5\ GeV/c\end{array}\]

The search for electrons with nominal \(P_{t}>1\ GeV/c\) requires accepting electrons with measured \(P_{t}>0.5\ GeV/c\), because of the possibility of important loss of energy due to bremsstrahlung. On the other hand, the measured \(P_{t}\) should be very close to the nominal value for hadrons and muons. The electrons must be identified as electrons in the TRT. Recent work[30] has shown that electrons from B decays can be identified in the calorimeter for \(P_{t}>2\ GeV/c\); more work is needed to extend this work down to nominal \(P_{t}\) of 1 \(\ GeV/c\). Work is also needed on the identification of low-\(P_{t}\) muons in the calorimeter by measurement of their characteristic energy-loss distribution.

Identification of the single electrons or muons should be enough to reduce these individual trigger rates to acceptable values (less than about 100 Hz).[24] Further reduction is necessary for the multiple-track trigger items, as shown in Table 2.

Mass cuts are required to reduce the hadronic trigger rates. Cuts in transverse mass, which do not require the full track momentum vector, give trigger rates which are still uncomfortably high. If the pixel data are used to obtain track trajectories in space, acceptable hadronic trigger rates can be obtained for the two-hadron and three-hadron triggers described above.

For electron pairs, the signal comes mainly from leptonic \(J/\psi\) decays, and the principal background comes from gamma conversions in the tracking volume.

Most of the gamma conversions can be eliminated by requiring that the tracks be confirmed in the precision tracker. The rate remains rather high (400 Hz), but it can be reduced if space points are available for the calculation of the di-lepton mass.

===========================

APPENDIX: ATRIG IMPLEMENTATION

===========================

A1. ATRIG Calling Sequences

A1.1 LVL1 muon trigger (T1MU)

T1MUON called from TrigL1; LVL1 muon steering routine

T1MURPC steering routine for LVL1 trigger in muon barrel

T1MUFAKE steering routine for fake muon trigger

T1MUTRUE steering routine for true muon trigger

SLDETN reads 'T1MU' card

T1MUPRPC called once; sets default RPC parameters

SEGETBA reads 'DETD' card for 'RPCS'

RPCUNP called once; unpacks digits

SEGETDP called once; reads 'RPCS' card

RPCGETG called once

GFDIGI get digitizations

loop

RPCCREF

end loop

T1MUINTR

SEGETDP called once; reads 'RPCS' card

RPCGETG called once; gets geometry

T2MULEO called once; initiates MLA geometry

SLDETN reads 'MUON' card

SEGETDP reads 'MUCH' card

GFPPARA

MLACREF

RPCCREF

loop

RPCCREFend loop T1MUPRIH print out RPC barrel hits T2MUUNCO add uncorrelated noise GLOOK loop over chambers MLACREF loop over hits GDMOM GSAHIT end loop (hits) end loop (chambers) T1MUHITS GFMHIT T1MUUCH MLACREF GUFLD T1MUDISP displays muon hits T1MUDINT sets up histograms loop over chambers T1MULOWZ steering for low-\(P_{t}\) algorithm T1MUUINZ finds window size SLGETDP called once; reads 'RPCS' card T1MUWZ T1MUSAYZ finds low-\(P_{t}\) strip assignments T1MULOWY steering for low-\(P_{t}\) algorithm T1MUWINY finds window size SLGETDP called once; reads 'RPCS' card T1MUWY T1MUSAY finds low-\(P_{t}\) strip assignments T1MUHIGH steering for high-\(P_{t}\) algorithm T1MUST2Z associates strips and coordinates SLGETDP reads 'RPCS' card T1MUST2Y associates strips and coordinates SLGETDP reads 'RPCS' card T1MUUSUMM print muon trigger summary RBPUT creates RoI bank (T1MR*) end loop (chambers) T1MUNTUP creates ntuples from KINE and RoI banks GFKINE gets KINE information RBGET gets RoI bank (T1MR*)

**T1MUTGC**: steering routine for TGC trigger in endcap system
**A1.2 LVL1 calorimeter trigger (T1CA)**:

**T1CALO**: called from TrigL1; LVL1 calorimeter steering routine
**T1CAINI**: once per run; reads 'T1CA','ECAL' data cards
**T1CAINPU**: fills trigger matrices from calo matrices; adds noise
**T1CACHIP**: fills hit maps (simulates trigger ASIC)
**T1CABROI**: builds RoI info from hit maps (simulates RoI builder)
**T1CAEMIS**: calculates missing-\(E_{t}\)
**T1CAHIS**: makes ntuples: /T1CA/ ID=5000 (global), 5001 (RoI)
**A1.3 LVL2 muon trigger (T2MU)**:

**T2MUINI**: called from T2ZZINI; initializes LVL2 muon parameters
**T2MUGET**: called from T2ZZGET; creates banks (T2MR*,T2MD*)
**GFDIG1**: source of digitizations
**T2MUFEX**: called from T2ZZFEX; performs feature extraction
**T2MUHIS**: called from T2ZZHIS; creates ntuple /T2MU/ ID=5006
**T2MUPIK**: generates a T2 muon RoI picture
**N.B. The above calling sequence calls dummy routines.**: The true LVL2 muon trigger must be called from T2MUPATR.
**A1.4 LVL2 calorimeter trigger (T2CA)**:

**T2CAINI**: called from T2ZZINI; initializes LVL2 calo parameters
**T2CAFIL**: called from T2SUPER; formats HCAL data for RoI
**T2CAGET**: called from T2ZZGET; interface to T2 calo RoI bank
**T2CAROI**: creates LVL2 calorimeter RoI bank (T2CR*)
**T2CAFEX**: called from T2ZZFEX; creates feature bank (T2CF*)
**T2CAWIN**: analyses energy cluster in a calorimeter window
**T2CAHIS**: called from T2ZZHIS; creates ntuples /T2CA/ ID=5000
**T2CAPIK**: generates T2 calorimeter RoI picture
**A1.5 LVL2 preshower trigger (T2PS)**:

**T2PSINI**: called from T2ZZINI; initializes preshower parameters
**T2PSGET**: called from T2ZZGET; gets supervisor bank (T2ZD*)
**T2PCOPSGET**: creates COPS preshower banks (T2PR*,T2PD*)
**GFDIG1**: source of data
**T2PCOPSADD**: adds energy to preshower cell
**T2PSFEX**: called from T2ZZFEX; gets RoI definition bank (T2PR*)

**T2PCOPSFEX**: does feature extraction; fills feature bank (T2PF*)
**T2PCOPSREAD**: returns cell energy for requested cell indices
**T2PSHIS**: called from T2ZZHIS (dummy)
**A1.6 TRT trigger (T2TR)**:
**T2TRINI**: called from T2ZZINI; initializes TRT parameters
**T2TRSTART**: sets parameters for TRT track search: CONB(I)
**XTRDPAR**:
**XMYGEO**:
**T2FP12**: takes care of wrap-around in \(\phi\)
**T2FCOR**: calculates slope parameters (FCOR,DCOR)
**T2TRGET**: called from T2ZZGET; sets up TRT manager (T2TM*)
**T2TRROI**: steers RoI bank creation (T2TR*,T2TD*)
**T2TREND**: creates RoI banks for endcap (T2TR*,T2TD*)
**T2TRBAR**: creates RoI banks for barrel (T2TR*,T2TD*)
**XMYGEO**:
**T2ZETATOR**: converts \((Z,\eta)\) to \(R\) coordinate
**GFDIG1**: source of TRT data
**T2TRPIKA**: generates RoI picture in straws
**T2TRPIKB**: generates RoI picture in \(Z/R\cdot\phi\) coordinates
**T2TRFEX**: called from T2ZZFEX; gets TRT manager and RoI banks
**T2TRREC**: does feature extraction; fills feature bank (T2TF*)
**T2FILSTR**: fills ITRAW (drift time) and K TRAW (energy)
**T2FCOR**: calculates slope parameters for maximum slope
**loop**: over data (size)
**T2BUFFII**: fills in \(\phi\) for maximum slope (FHIT)
**end loop (size)
**T2SORT**: sorts hits according to corrected \(\phi\) values (FHIT)
**T2TRRAW**: creates raw data histograms (inactive)
**loop**: over slopes (NCOR)
**T2TRAN**: makes azimuth angle corrections for this slope
**T2SORT**: sorts hits according to corrected \(\phi\) values
**T2PRESL**: selects slope with most hits if \(>\) 15
**end loop (NCOR)
**T2FTRK**: steers track fit
**T2SORT**: sorts track candidates according to number of hits
**loop**: over track candidates (NHIT1)
**T2FIIT**: selects hits in wide road; prepares array UV
**loop**: over all rows (NROW)
**T2TAB**: finds the position in the 1D array FSTRAW

**T2DFM** selects \(\phi\) between \(-\pi\) and \(+\pi\) end loop (NROW)

**T2TUN** performs fine tuning (see Ref. 32)

**T2SIMP** performs simplex fit to circle (linear approx.)

**T2RMAP** maps coordinates to conformal space

**T2STBL** prepares data for circle fit; steers fit routine

**T2STB0** selects 'best' track for circle fit

**T2SORT** sorts hits according to \(\mbox{DY/DX}\approx\delta\phi\)

**T2POLIG** gets circle parameters (A,B)

**T2POLIT** performs parabolic fit with vertex

**T2POLIT** performs parabolic fit without vertex

end loop (NHIT1)

**T2FTRK** fills track arrays PTRK(I,NTRK); checks limits

loop over track candidates (NTRK1)

**T2RDTR** gets hit information for tracks

**T2FCOR**

**T2TAB**

end loop (NTRK1)

**T2CORL** removes ghost tracks

**T2TRFIG** plots histograms (inactive)

loop over tracks found (NTRK)

**T2KICRC** intersects track with reference surface

end loop (NTRK)

**T2TRHIS** called from T2ZZHIS; makes ntuples (5003,5004)

**A1.7 Precision tracker in barrel region (T2SI)

**T2SINI** called from T2ZZINI; initializes geometry and trigger

**SLDETN** reads 'INNE' data card to select layout

**SLSGETBA** reads 'DETA' data cards for 'T2SI' trigger parameters

**SLDETN** reads 'SITV' data card

**SLSGETBA** reads 'DETP','DETG', 'DETD' data for 'SITV'

**SLSGETBA** reads 'DETP','DETG', 'DETD' data for 'SIT'

**T2SIGET** from T2ZZGET; creates RoI, hit banks (T2SR*,T2SH*)

**HBOOK1** creates histos if IHIST \(>\) 1

**GPDIGI** prints digitizations if IPRINT \(>\) 2

**GFDIG1** source of digitizations

**T2SIFEX** called from T2ZZFEX; creates feature bank (T2SF*)

**T2SIHIS** called from T2ZZHIS; creates ntuples /T2SI/ ID=5002

**A1.8 Precision tracker in forward region (T2MS)**

\begin{tabular}{l l}
**T2MSINI** & called from T2ZZINI; initializes MSGC parameters \\
**SLDETN** & reads 'INNE' data card to select layout \\
**SLGETBA** & reads 'DETA' data cards for 'T2MS' parameters \\
**T2MSGET** & from T2ZZGET; creates RoI, hit banks (T2YR*,T2YD*) \\
**GFDIG1** & source of digtizations \\
**T2MSCLS** & forms clusters from hits \\
**T2MSFEX** & called from T2ZZFEX; sets up track search parameters \\
**T2MSCAN** & uses histogram technique to find track candidates \\
**T2MSFEX** & chooses 'best' track; creates feature bank (T2MF*) \\
**T2MSHIS** & called from T2ZZHIS; creates ntuples /T2MS/ ID=5504 \\
**A1.9 Global LVL2 trigger (T2GL)** & \\
**T2GLINI** & called by T2SUINI; initiates global LVL2 parameters \\
**T2GLOBAL** & called by T2SUPER when feature extraction complete \\
**T2GLIND** & steering routine for global LVL2 trigger \\
**loop** & over all RoI's in the event (NROI) \\
**T2GLROI** & creates global RoI feature bank (T2GR*) \\
**T2GRHIS** & creates ntuples for this RoI: /T2GR/ ID=5280 \\
**end loop** (NROI) \\
**T2GLEVT** & selects RoI's; fills banks (T2GA*,T2GE*,T2GM*) \\
**T2GLVOTE** & makes LVL2 decision; fills bank (T2GT*) \\
**T2GLHIS** & creates global event ntuples: /T2GL/ ID=5290-5292 \\
**A2. ATRIG Feature Banks** \\
**A2.1 Muon feature bank (T2MF)** & \\

The muon feature bank (T2MF) is based on the stand-alone muon system. The bank contents are as follows:

\begin{tabular}{l l} T2MF_Et & \(P_{t}\) in muon system \\ T2MF_Et Rms & track quality variable \\ T2MF_PhiC & \(\phi\) extrapolated to calorimeter \\ T2MF_EtaC & \(\eta\) extrapolated to calorimeter \\
**A2.2 Calorimeter feature bank (T2CF)** & \\ \end{tabular}

The calorimeter feature bank (T2CF) includes features for \(e/\gamma\), jet, and muonRol's. The following basic features are relevant to all three Rol types:

T2CF_EM_etacor \(\eta\) of EM core center

T2CF_EM_phicor \(\phi\) of EM core center

T2CF_EM_ewin \(E_{t}\) in EM cluster window

T2CF_EM_ecor \(E_{t}\) in EM cluster core

T2CF_EM_einn \(E_{t}\) in EM inner ring

T2CF_EM_eout \(E_{t}\) in EM outer ring

T2CF_EM_ecfront \(E_{t}\) in core in EM sample 1

T2CF_EM_ecback1 \(E_{t}\) in core in EM sample 2

T2CF_EM_ecback2 \(E_{t}\) in core in EM sample 3

plus 8 constants defining the \(\eta\) and \(\phi\) sizes of the EM window, core, and inner and outer rings, and one variable describing the size of the hadronic window.

For \(e/\gamma\) Rol's, the following energy sums are included in the feature banks:

T2CF_EM_e35 \(E_{t}\) in central 3 \(\times\) 5 EM cells

T2CF_EM_e57 \(E_{t}\) in central 5 \(\times\) 7 EM cells

T2CF_EM_e37 \(E_{t}\) in central 3 \(\times\) 7 EM cells

T2CF_EM_e59 \(E_{t}\) in central 5 \(\times\) 9 EM cells

T2CF_EM_e77 \(E_{t}\) in central 7 \(\times\) 7 EM cells

T2CF_EM_e79 \(E_{t}\) in central 7 \(\times\) 9 EM cells

T2CF_HA_ewin \(E_{t}\) in hadronic window

For jet Rol's and for muon Rol's, the following features are added to the basic set of features:

T2CF_EM_ejet EM \(E_{t}\) in jet window

T2CF_HA_etajet \(\eta\)

T2CF_HA_phijet \(\phi\)

T2CF_HA_ejet hadronic \(E_{t}\) in jet window

T2CF_ejet total jet \(E_{t}\) (EM + HAC)

In addition to these Rol features, the calorimeter feature bank transmits the following global calorimeter values:

T2CF_missEt missing-\(E_{t}\)

T2CF_missEx missing-\(E_{x}\)

T2CF_missEy missing-\(E_{y}\)T2CF_missEz missing-\(E_{z}\)

**A2.3**: **Preshower feature bank (T2PF)**

The preshower feature bank (T2PF) contains the following features:

T2PF_EClus energy in cluster

T2PF_EtClus \(E_{t}\) in cluster

T2PF_RMS RMS width of cluster

T2PF_EtaClus \(\eta\) of cluster

T2PF_PhiClus \(\phi\) of cluster

T2PF_EtaProfile energy deposit profile in \(\eta\)

T2PF_PhiProfile energy deposit profile in \(\phi\)

**A2.4**: **TRT feature bank (T2TF)**

The TRT feature bank (T2TF) contains the following discrete (integer) variables for each of the TRT track candidates:

T2TF_MODULE TRT module number

T2TF_SIGN sign of the track charge

T2TF_LOWHIT number of hits above low threshold

T2TF_HIGHHT number of hits above high threshold

T2TF_EMPTY number of empty straws

T2TF_UNIQUE number of hits on this track alone

T2TF_TIMEHIT number of hits within drift-time road

The TRT feature bank (T2TF) also contains the following real variables for each TRT track candidate:

T2TF_PT estimated \(P_{t}\) of track

T2TF_INVPTERR error in \(1/P_{t}\)

T2TF_PHIERR error in \(\phi\)

T2TF_COVPTPHI error correlation

T2TF_CHI2 \(\chi^{2}\) of track fit

T2TF_PHIV \(\phi\) at vertex

T2TF_PHIC \(\phi\) at calorimeter

T2TF_ETAMIN minimum value of \(\eta\)T2TF_ETAMAX maximum value of \(\eta\)

T2TF_MINZV minimum \(Z\) at vertex

T2TF_MAXZV maximum \(Z\) at vertex

T2TF_MINZC minimum \(Z\) at calorimeter

T2TF_MAXZC maximum \(Z\) at calorimeter

T2TF_MINRC minimum radius at calorimeter

T2TF_MAXRC maximum radius at calorimeter

**A2.5 Precision tracker feature bank in barrel (T2SF)**

The silicon tracker feature bank (T2SF) contains the following features for each silicon track candidate:

T2SF_Region region of tracker containing track

T2SF_Threshold threshold passed

T2SF_Sign sign of track

T2SF_MissLay missing layer

T2SF_NCombP number of \(\phi\) combinations considered

T2SF_NCombZ number of \(Z\) combinations considered

T2SF_Pt estimated \(P_{t}\) of track

T2SF_RMS RMS deviation from straight line

T2SF_InvPtErr estimated error in \(1/P_{t}\)

T2SF_PhiV \(\phi\) of track at vertex

T2SF_PhiC \(\phi\) of track at calorimeter

T2SF_MinZV minimum \(Z\) of track at vertex

T2SF_MaxZV maximum \(Z\) of track at vertex

T2SF_MinZC minimum \(Z\) of track at calorimeter

T2SF_MaxZC maximum \(Z\) of track at calorimeter

**A2.6 Precision tracker feature bank in forward region (T2YF)**

The MSGC feature bank (T2YF) contains the following features for the best MSGC track candidate:

T2YF_Pt estimated \(P_{t}\) of track

T2YF_InvtPtErr estimated error in \(1/P_{t}\)T2YF_RMSRMS deviation from straight line T2YF_PhiC \(\phi\) of track at calorimeter T2YF_MinZC minimum \(Z\) of track at calorimeter T2YF_MaxZC maximum \(Z\) of track at calorimeter T2YF_MinRC minimum radius of track at calorimeter T2YF_MaxRC maximum radius of track at calorimeter

### A2.7 Global LVL2 RoI Feature Bank (T2GR)

The global RoI routine T2GLROI collects data from the individual detector feature banks described above to fill the global RoI feature bank T2GR. Three entries come from the L2 supervisor RoI bank (T2ZD) and define the RoI: T2GR_SuperRoi RoI number T2GR_RoiObjType RoI object type (mu, e, \(\gamma\), h, jet, missing-\(E_{t}\)) T2GR_ThrNum threshold number passed at Level 1 (Note that the threshold number is not, in fact, available from Level 1.) Another series of 7 entries define the position of the event in the subsystem feature banks.

Four global features give the best value of \(E_{t}\), RMS, \(\eta\), and \(\phi\) for each RoI type:

T2GR_Et estimated \(P_{t}\) (muon) or \(E_{t}\) (calo. triggers) T2GR_Rms RMS for \(P_{t}\) estimate (0. for calo. triggers) T2GR_Eta estimated \(\eta\) at calorimeter T2GR_Phi estimated \(\phi\) at calorimeter The \(E_{t}\) estimated for the calorimeter RoI's (\(e/\gamma\), hadron, jet) is the sum of the \(E_{t}\) estimate from the calorimeter and the \(E_{t}\) estimate from the preshower detector. The features described above are the only global features defined for the jet RoI's.

Two EM quality factors are derived from the calorimeter feature bank (T2CF) for the \(e/\gamma\) and hadron triggers: T2GR_QF (\(E_{t}\) in 7 \(\times\) 7 EM cells)/(\(E_{t}\) in 9 \(\times\) 9 EM cells) T2GR_QF2 (\(E_{t}\) in 5 \(\times\) 5 EM cells)/(\(E_{t}\) in 7 \(\times\) 7 EM cells) In addition, 6 energy sums are transferred to the global RoI bank from the calorimeter feature bank (T2CF), only for the \(e/\gamma\) triggers: T2GR_E35 \(E_{t}\) in 3 \(\times\) 5 EM cells and similarly for E59, E79, E37, E57, and E77.

The rest of the features are defined in the same way for the muon, \(e/\gamma\), and hadron triggers. Eight of these features are derived from the calorimeter feature bank (T2CF):

T2GR_EmEt \(E_{t}\) in EM cluster window T2GR_EmEtFront \(E_{t}\) in core in EM sample 1 T2GR_EmEtBack1 \(E_{t}\) in core in EM sample 2 T2GR_EmEtBack2 \(E_{t}\) in core in EM sample 3 T2GR_HaEt \(E_{t}\) in hadronic window T2GR_HaOverEm (\(E_{t}\) in EM window)/(\(E_{t}\) in hadron window) T2GR_CaDeltaEta ABS(T2CF_EM_etacor - T2GR_Eta) T2GR_CaDeltaPhi ABS(T2CF_EM_phicor - T2GR_Phi) Six features are derived from the preshower feature bank (T2PF):

T2GR_PsEt \(E_{t}\) estimation from preshower energy deposit T2GR_PsProfile preshower profile in \(\eta\) T2GR_PsDEta T2PF_EtaClus - T2GR_Eta T2GR_PsDPhi T2PF_PhiClus - T2GR_Phi T2GR_PsDeltaEta ABS(T2PF_EtaClus - T2GR_Eta) T2GR_PsDeltaPhi ABS(T2PF_PhiClus - T2GR_Phi) Features taken from the TRT feature bank (T2TF) are:

T2GR_TrLowHits number of hits above low threshold (\(N_{low}\)) T2GR_TrHighHits number of hits above high threshold (\(N_{high}\)) T2GR_TrEmpty number of empty straws (\(N_{empty}\)) T2GR_TrUnique number of hits on this track alone T2GR_TrTimeHits number of hits within drift-time road T2GR_TrPt estimated \(P_{t}\) of TRT track T2GR_TrChiSq \(\chi^{2}\) of track fit T2GR_TrQf quality factor for best TRT track candidate T2GR_TrDEta ABS((\(\eta\) measured in TRT) - T2GR_Eta) T2GR_TrDPhi ABS((\(\phi\) measured in TRT) - T2GR_Phi) The TRT quality factor is calculated in T2GLROI and used to select the 'best' TRT track for this RoI. This quality factor depends on the \(E_{t},\eta,\emph{andphi}\) estimated for this RoI (T2GR_Et, T2GR_Eta, and T2GR_Phi); these estimates are derived from the muon data for muon Rol's or from the calorimeter (plus preshower) data for \(e/\gamma\) and hadron Rol's. (Note that the data from these subsystems will not be available for the tracking algorithms if parallel feature extraction is used for the different subsystem detectors.) The quality factor used for the TRT track candidates is defined as follows:

\[\begin{array}{l}\mbox{TRT QF}=\ N_{hits}\ -\ (1-E_{t}/P_{t})^{2}\ -\ (\delta \phi/0.025)^{2}\ -\ \chi^{2}/N_{hits}\ -\ 2\times N_{empty}\\ \\ \hskip 14.226378pt+\ N_{high}\hskip 42.679134pt\mbox{[for $e/\gamma$ Rol's only]}\end{array}\]

where \(N_{hits}=N_{low}+N_{high}\) and \(\delta\phi=(\mbox{T2TF\_PHIC}\ -\ \mbox{T2GR\_Phi})\). If at least one TRT track candidate was found in the RoI, the track features are retained for the TRT track with the largest value for this quality factor.

Features derived from the silicon feature bank (T2SF) are:

\[\begin{array}{l}\mbox{T2GR\_SiMissLay}\hskip 14.226378pt\mbox{missing layer in silicon track fit}\\ \mbox{T2GR\_SiPt}\hskip 14.226378pt\mbox{estimated $P_{t}$ of silicon track}\\ \mbox{T2GR\_SiRms}\hskip 14.226378pt\mbox{RMS deviation from straight line}\\ \mbox{T2GR\_SiQf}\hskip 14.226378pt\mbox{quality factor for best silicon track candidate}\\ \mbox{T2GR\_SiDEta}\hskip 14.226378pt\mbox{ABS}((\eta\ \mbox{measured in SCT})\ -\ \mbox{T2GR\_Eta})\\ \mbox{T2GR\_SiDPhi}\hskip 14.226378pt\mbox{ABS}((\phi\ \mbox{measured in SCT})\ -\ \mbox{T2GR\_Phi})\end{array}\]

The quality factor used for the silicon track candidates is defined as follows:

\[\begin{array}{l}\mbox{SIT QF}=\ 100.\ -\ (1-E_{t}/P_{t})^{2}\ -\ (\delta \phi/0.025)^{2}\ -\ \chi^{2}/\chi^{2}_{max}\ -\ N_{miss}\end{array}\]

The number of missing layers (\(N_{miss}\)) cannot be greater than one. If at least one silicon track candidate was found in the RoI, the track features are retained for the SIT track with the largest value for this quality factor.

Six more features give the best tracking information available for this RoI:

\[\begin{array}{l}\mbox{T2GR\_TkFlag}\hskip 14.226378pt\mbox{track flag}\ (1=\mbox{ SCT},\ 2=\mbox{MSGC},\ 4=\mbox{TRT})\\ \mbox{T2GR\_TkPt}\hskip 14.226378pt\mbox{$P_{t}$ measurement from tracking}\\ \mbox{T2GR\_TkRms}\hskip 14.226378pt\mbox{RMS of $P_{t}$ measurement}\\ \mbox{T2GR\_PtOverEt}\hskip 14.226378pt\mbox{(T2GR\_TkPt)/(T2GR\_Et)}\\ \mbox{T2GR\_TkDeltaEta}\hskip 14.226378pt\mbox{ABS}((\eta\ \mbox{measured in tracking})\ -\ \mbox{T2GR\_Eta})\\ \mbox{T2GR\_TkDeltaPhi}\hskip 14.226378pt\mbox{ABS}((\phi\ \mbox{measured in tracking})\ -\ \mbox{T2GR\_Phi})\end{array}\]

The track flag contains one bit for each of the tracking subsystems (SIT, MSGC, TRT,...) indicating whether any track candidate satisfied minimum track-match requirements. For the precision trackers, there are two requirements: the ratio of the track \(P_{t}\) to the estimated \(E_{t}\) for this Rol (T2GR_Et) must be sufficiently high (\(P_{t}/E_{t}>\) threshold), and the measured \(\phi\) of the track must be sufficiently close to the phi estimated for this Rol (T2GR_Phi). For the TRT, the number of high-E hits must also be larger than some minimum, and the number of empty straws must be smaller than some maximum number. The choice of the 'best' track gives first priority to tracks satisfying these minimum requirements, then silicon tracks in the same category are given priority over TRT tracks.

Note that an \(e/\gamma\) trigger is called an electron trigger if an acceptable track candidate is found, and a gamma trigger, if not.

## A3. ATRIG Ntuples

### A4. ATRIG Data Cards

#### A4.6.1 Data Cards for Global LVL2 Trigger

The global L2 parameters bank (T2GP) is filled in the subroutine T2GLINI, which is called once per run. The present code allows 15 sets of trigger conditions for each of the six basic trigger objects: muons (M), electrons (E), gammas (G), hadrons (H), jets (J), and missing-\(E_{t}\) (X).

The parameters each correspond to one of the trigger conditions (the symbol Z in T2GP_Z_* should be replaced by M, E, G, H, J, or X as indicated):

T2GP_Z_NumObj number of objects required M,E,G,H,J,X

T2GP_Z_TrHighHitsMin minimum # of high-E TRT hits E

T2GP_Z_TrEmptyMax maximum # of empty TRT straws M,E,H

T2GP_Z_EtThr minimum \(E_{t}\) M,E,G,H,J

T2GP_Z_RmsMax maximum RMS M

T2GP_Z_QfMin minimum quality factor 1 E,G,H,J

T2GP_Z_Qf2Min minimum quality factor 2 E,G,H

T2GP_Z_EtaMax maximum \(\eta\) M,E,G,H,J

T2GP_Z_TkPtMin minimum track \(P_{t}\) M,E,H

T2GP_Z_TkRmsMax maximum track RMS M,E,H

T2GP_Z_PtOverEtMin minimum \(P_{t}/E_{t}\) ratio M,E,H

T2GP_Z_PtOverEtMax maximum \(P_{t}/E_{t}\) ratio M,E,HT2GP_Z_TkDeltaEtaMax maximum \(\delta\eta\) | for track M,E,H T2GP_Z_TkDeltaPhilMax maximum \(\delta\phi\) | for track M,E,H T2GP_Z_EmEtMin minimum EM \(E_{t}\) M T2GP_Z_EmEtMax maximum EM \(E_{t}\) M T2GP_Z_HaEtMin minimum hadronic \(E_{t}\) M T2GP_Z_HaEtMax maximum hadronic \(E_{t}\) M,E,G T2GP_Z_HaOverEmMax maximum HAC/EM ratio E,G T2GP_Z_CaDeltaEtaMax maximum \(\delta\eta\) | for calc M,H T2GP_Z_CaDeltaPhiMax maximum \(\delta\phi\) | for calc M,H T2GP_Z_PsEtMin minimum preshower \(E_{t}\) M,E,G,H T2GP_Z_PsProfileMin minimum preshower profile M,E,G,H T2GP_Z_PsDeltaEtaMax maximum \(\delta\eta\) | M,E,G,H T2GP_Z_PsDeltaPhiMax maximum \((\delta-\phi)\) | M,E,G,H T2GP_Z_MissEtThr minimum missing-\(E_{t}\) X A global L2 trigger menu data card can be used to control the number of trigger condition sets for each of the 6 basic trigger objects. The following card limits the number of trigger condition sets to 1 for the muons, 3 for electrons, 2 for gammas, 4 for jets, and 3 for missing-\(E_{t}\):

*DETA 'T2GT' 2=1. 3=3. 4=2. 6=4. 7=3.

The trigger conditions for each of the trigger objects can be controlled by data cards. As an example, the following two data cards define a single jet trigger with an \(E_{t}\) threshold at 400 GeV and a dijet trigger with a threshold at 300 GeV, with QF greater than or equal to 0.0 and \(\eta\) less than or equal to 3.0:

\[\begin{array}{ccccc}\mbox{Num\,Obj}&\mbox{EtThr}&\mbox{QfMin}&\mbox{EtaMax} \\ \mbox{*DETA 'T2GJ' 2=1.}&\mbox{3=400.}&\mbox{4=0.0}&\mbox{5=3.0}\\ \mbox{*DETA 'T2GJ' 6=2.}&\mbox{7=300.}&\mbox{8=0.0}&\mbox{9=3.0}\\ \end{array}\]

The second card sets the conditions for dijet triggers, but it also defines the jet conditions for other two-object triggers such as (mu + jet ) or (jet + missing-\(E_{t}\)).

It is important to know the number of parameters for each trigger object:

\begin{tabular}{l l l} muon trigger & 21 parameters & data cards 'T2GM' \\ electron trigger & 19 parameters & data cards 'T2GE' \\ gamma trigger & 11 parameters & data cards 'T2GG' \\ hadron trigger & 18 parameters & data cards 'T2GH' \\ jet trigger & 4 parameters & data cards 'T2GJ' \\ missing-\(E_{t}\) trigger & 2 parameters & data cards 'T2GX' \\ \end{tabular}

These parameters are listed above for each of the trigger objects; they must be listed on the data cards in the order shown. The first parameter for each parameter list is reserved, so the parameters on the data cards start at position 2.

## Appendix A5 Benchmarking of feature extraction algorithms

R. Hauser and I. Legrand measured feature extraction and global algorithm execution times on several available processors, including the PowerPC, as members of the RD11 collaboration. All of their algorithms were written in the form of C programs. A summary of their results and the C code for all of their algorithms are available in Ref. [31] and on WWW under

\[\mbox{\small{[http://www.cern.ch/RD11/benchmarks/benchmarks.html](http://www.cern.ch/RD11/benchmarks/benchmarks.html)}}\]

These algorithms should be quite similar to the algorithms in the current version of ATRIG. Their results serve as a benchmark to compare with results obtained from C versions based on the actual ATRIG code.

## Appendix A5.1 Stand-alone muon FEX benchmarking

L. Zanello has reported on benchmarking of the stand-alone LVL2 muon algorithms. Using a 40 MIPS Motorola model 96002 DSP, with optimized Fortran code, she found execution times of 30 microsec (50 microsec) for the high-\(P_{t}\) (low-\(P_{t}\)) pattern-recognition code, and 170 microsec for the muon momentum measurement [16].

## Appendix A5.2 Calorimeter FEX benchmarking

The calorimeter feature extraction algorithm execution time has been measured by Bruno Thooris using a PowerPC. He found an average execution time of 210 microsec per RoI on a SUN Sparc20. Preprocessing was not included in the algorithm, and granularity changes were ignored.

The preshower feature extraction algorithm execution time has not yet been measured.

**A5.3 TRT FEX benchmarking**

TRT algorithm benchmarking has been carried out by R. Hauser and I. Legrand31 assuming an RoI containing 16 straws in \(\phi\) (\(\delta\phi\) roughly 0.10) and 10% occupancy. The feature extraction algorithm required 707 microsec on a PowerPc. The algorithm used by Hauser and Legrand has not yet been compared with the algorithm used in the current ATRIG code.

**A5.4 Precision-tracker FEX benchmarking**

Reinier Dankers performed benchmarking studies using forward precision tracker code written for the MSGC tracker in the Technical Proposal layout.7 Benchmarking was performed on general-purpose processors with a stand-alone version of the algorithm written in C and timed on a HP 9000/750. The algorithm used for benchmarking first selects the maximum bin in the histogram in the Hough-transform space, then performs a least-squares fit. The results are given in Table 3:

**Table 3**. Measurements of MSGC feature extraction algorithm execution times on a HP 9000/750. (Table 2 of Ref. 7.)

\begin{tabular}{|c|c|c|c|c|c|} \hline Granularity & Occupancy & Preprocessing & Hough Transform & LS fit & Total \\ (Strips) & (\%) & Time (\(\mu\)s) & Time (\(\mu\)s) & Time (\(\mu\)s) & Time (\(\mu\)s) \\ \hline
1 & 0.2 & 230 & 1500 & 190 & 1920 \\
1 & 1.8 & 6200 & 106700 & 650 & 113550 \\
10 & 0.2 & 230 & 90 & 190 & 510 \\
10 & 1.8 & 6200 & 1500 & 750 & 8450 \\ \hline \end{tabular}

**A5.5 Benchmarking the full TRT scan for B physics**

Maria Smizanska29 has timed the various operations in the LVL2 B-physics algorithms. Converting the TRT hits to digits takes 1.6 seconds in XTRDIG, including the simulation of the primary ionization clusters, their energy distribution and their drift times. The initial TRT track finding (THPRESL) requires 400 ms and the fine tuning (especially THSIMP) requires 280 ms. Constructingthe RoI RawData bank for the silicon tracker (T2SIGET) requires 5.8 sec, but the SCT track-finding algorithm requires only 26 ms. The time required to build the RoI's must be confirmed (or, hopefully, infirmed) using the preprocessing algorithms. On the other hand, the time required for the TRT track finding and fine tuning must be reduced; work has begun on alternative TRT track-finding and track-fitting algorithms.

## References

* [1] J. Baines, J. Carter, P. Eerola, F. Gianotti, T. Hansl-Kozanecka, R. Hawkings, R. Hubbard, O. Palamara, S. Petrera, S. Sivoklokov, M. Smizanska, and A. Watson, "ATRIG 1.00, ATLAS Trigger Simulation User Guide, Revision 0.00", 2 December 1994.
* [2] The ATLAS Muon Group, "Monitored Drift Tubes Chambers for Muon Spectroscopy in ATLAS", ATLAS note MUON-NO-44, 28 June 1994.
* [3] D. Froidevaux, M. Nessi, and A. Henriques, "Our Proposal for Jet Generation for ATLAS", ATLAS note DAQ-TR-201, 6 December 1993.
* [4] F. Gianotti, "Calorimeter/Preshower Scenari in ATLAS", ATLAS note DAQ-TR-197, 2 November 1993.
* [5] P. Eerola, "Description of the TRT Track Trigger Simulation in ATRIG", ATLAS note DAQ-NO-050, 22 February 1966.
* [6] R. Hawkings, "The Level-2 Silicon Track Trigger (T2SI) Implementation in ATRIG", ATLAS note DAQ-NO-047.
* [7] S. Sivoklokov, R. Dankers, and J. Baines, "Second Level Trigger in the Forward Region of the ATLAS Inner Tracker", ATLAS note INDET-NO-111, 8 September 1995.
* [8] E. Barberio, R. Cardarelli, F. Ceradini, N. Ellis, T. Kobayashi, G. Mikenberg, A. Nisati, M. Nomachi, E. Petrolo, R. Santonico, and S. Veneziano, "Implementation of the First Level Muon Trigger", ATLAS note DAQ-NO-39, 27 December 1994.

* 9) JINR Dubna, Kobe University, Univ. of Lecce and INFN, M.I.T., Unvi. of Naples and INFN, IHEP Protvino, Univ. of Rome "La Spienza" and INFN, Univ. of Rome "Tor Vergata" and INFN, Technion Haifa, Univ. of Tokyo, and Weizmann Inst., "An Integrated RPC and TGC Detector for the ATLAS Muon Trigger", ATLAS note MUON-NO-42, 3 June 1994.
* 10) A. Dell'Acqua, A. Rimoldi, and V. Vercesi, "Level-1 Muon Trigger Simulation in the Barrel Region", ATLAS note DAQ-NO-38, 20 December 1994.
* 11) Y. Hasegawa, et al., ATLAS DAQ note in preparation.
* 12) RD27 Status Report, First-Level Trigger Systems for LHC Experiments, CERN/DRDC/93-32, 11 August 1993.
* 13) I.P. Brawn, R.E. Carney, J. Garvey, D. Rees, R. Staley, P. Watkins, A.T. Watson, N. Ellis, C. Geweniger, P. Hanke, E.-E. Kluge, A. Putzer, B. Rensch, K. Tittel, M. Wunsch, E. Eisenhandler, M Landon, J.M. Pentney, G. Thompson, J. Edwards, C.N.P. Gee, A.R. Gillman, R. Hatley, J. Leake, V. Perera, T.P. Shah, R. Sundblad, G. Appelquist, C. Bohm, M. Engstrom, S. Hellman, S.-O. Holmgren, E. Johansson, N. Yamdagni, and X. Zhao, "The Level-1 Calorimeter Trigger System for ATLAS", ATLAS note DAQ-NO-30, 17 January 1995.
* 14) J. Bystricky, "Jet Trigger Rates from Fast Simulations", ATLAS note DAQ-NO-29, 15 January 1995.
* 15) M. Wunsch, "The Missing-Et Trigger for ATLAS", ATLAS DAQ note in preparation.
* 16) S. Falciano, A. Nisati, O. Palamara, S. Petrera, and L. Zanello, "The ATLAS Muon Trigger Algorithm for Level-2 Feature Extraction", ATLAS DAQ note in preparation.

* [17] E. Barberio, et al., ATLAS DAQ note in preparation.
* [18] O. Palamara and S. Petrera, "Pattern Recognition at the Second Level Muon Trigger in the ATLAS Barrel Region", ATLAS note DAQ-NO-17, 27 December 1994.
* [19] G. Ambrosini, S. Falciano, A. Nisati, O. Palamara, S. Petrera, and L. Zanello, "A Proposal for the ATLAS Level-2 Muon Trigger in the Barrel Region", ATLAS note MUON-NO-61, 15 January 1995.
* [20] J. Bystricky, T. Hansl-Kozanecka, R. Hubbard, and B. Thooris, "Level-2 Calorimeter Algorithms in ATRIG", ATLAS DAQ note in preparation.
* [21] J. Carter, Z. Hajduk, K. Korcyl, and J. Strong, "A Second Level Calorimeter Trigger Algorithm", ATLAS note DAQ-NO-009, 12 January 1993.
* [22] R. Bock and P. Le Du, "Detector and Readout Specifications for the Level-2 Trigger Demonstrator Program", ATLAS note DAQ-NO-053, 17 June 1996.
* [23] I. Gavrilenko, "Pattern Recognition in TRD/Tracker", ATLAS note INDET-NO-16, 21 October 1992.
* [24] ATLAS Technical Proposal, CERN/LHCC/94-43, 15 December 1994.
* [25] J. Bystricky, T. Hansl-Kozanecka, R. Hubbard, and B. Thooris, "ATLAS Trigger Performance: Electron/Photon Triggers at Level 2", ATLAS note DAQ-NO-28, 15 January 1995.
* Second Level Electron Triggering in the ATLAS Inner Detector", ATLAS note INDET-NO-52, 24 June 1994.
* [27] J. Bystricky, T. Hansl-Kozanecka, R. Hubbard, and B. Thooris, "Global Level-2 Algorithms in ATRIG", ATLAS DAQ note in preparation.

* [28] P. Eerola, N. Ellis, I. Gavrilenko, S. Gadomski, M. Smizanska, Ll.M. Mir, P. Sherwood, W. Murray, and M.A. Sanchis-Lozano, "B Physics in ATLAS", ATLAS note PHYS-NO-41, 15 July 1994.
* [29] Maria Smizanska, "The Level 2 B-Physics Trigger Implementation in ATRIG", ATLAS DAQ note in preparation.
* [30] F. Gianotti, "Tagging of Low-Pt Electrons fro B dDecays with the ATLAS Electromagnetic Calorimeter", ATLAS note PHYS-NO-49, 10 March 1995.
* [31] R. Hauser and I. Legrand, "Algorithms in Second-Level Triggers for ATLAS and Benchmark Results", ATLAS note DAQ-NO-27, 14 December 1994.
* [32] M. Hansroul, H. Jeremie, and D. Savard, "Fast Circle Fit with the Conformal Mapping Method", NIM A270 (1988), 498.

TABLE CAPTIONS

**1.** Trigger rates for B physics at \(L=10^{33}/cm2/s\). The lefthand column of rates (A) assumes a LVL1 muon trigger acceptance \(\mid\eta\mid<2.2\), corresponding to the full system, while the righthand column (B) assumes an initial acceptance \(\mid\eta\mid<1.6\). The rapidity acceptance for all tracks other than the LVL1 trigger muon is \(\mid\eta\mid<2.5\). (Table 5.3 of Ref. 24.)
**2.** Three types of B-physics second-level triggers. The rates are calculated assuming a 4 kHz single-muon trigger rate. ( Table 1 of Ref. 29.)
**3.** Measurements of MSGC feature extraction algorithm execution times on a HP 9000/750. (Table 2 of Ref. 7.)FIGURE CAPTIONS

**1.** Transverse view of the muon spectrometer. (Fig. 1 of Ref. 10.)

**2.** The ATLAS forward tracker in the Technical Proposal layout. (Fig. 1 of Ref. 7.)

**3.** Concept of the level-1 muon trigger. (Fig. 3 of Ref. 10.)

**4.** Scheme of the first level muon trigger in the endcap. (Fig. 2 of Ref. 8.)

**5.** The coincidence matrix for the first level muon trigger. (Fig. 3 of Ref. 8.)

**6.** Scheme of implementation of the low- and high-\(P_{t}\) first level muon trigger. (Fig. 6 of Ref. 8.)

**7.** First-level muon trigger acceptance as a function of \(P_{t}\). (Fig. 10 of Ref. 8.)

**8.** Low-\(P_{t}\) muon trigger rate in the barrel as a function of luminosity. (Fig. 12 of Ref. 8.)

**9.** High-\(P_{t}\) muon trigger rate in the barrel as a function of luminosity. (Fig. 13 of Ref. 8.)

**10.** View of the 4 \(\times\) 4 area of the calorimeter at LVL1. (Fig. 2.3 of Ref. 13.)

**11.** Electron/gamma LVL1 trigger threshold sharpness for three different cluster definitions. (Fig. 2.2 of Ref. 13.)

**12.** Global cluster-counting algorithm for the LVL1 calorimeter trigger. A hit in the ASIC 'R' is counted provided there are no hits in the shaded ASIC's. (Fig. 2.4 of Ref. 13.)

**13**: Definition of the muon trajectory through three points. The trajectory is a circle through SP1, SP2 (RPC superpoints in the middle station) and SP3 (RPC superpoint in the outer station) in the case of a high-\(P_{t}\) LVL1 trigger, whereas it is a circle through SP1 and SP2 and a straight line tangent to it originating from the p-p nominal crossing point O in the case of a low-\(P_{t}\) trigger. (Fig. 2 of Ref. [16].)
**14**: The sagitta measured in the magnetic field region of the barrel muon spectrometer. (Fig. 4 of Ref. [16].)
**15**: Look-up table (sagitta map) to determine the muon \(P_{t}\). ( Fig. 5 of Ref. [16].)
**16**: Track representation in the TRT. (Fig. 2 of Ref. [23].)
**17**: Initial track finding in the TRT. (Fig. 3 of Ref. [23].)
**18**: Projection of RoI onto the silicon tracker in the longitudinal and transverse planes. (Fig. 1 of Ref. [6].)