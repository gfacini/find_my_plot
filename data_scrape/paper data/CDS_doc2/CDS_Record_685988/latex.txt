**ATLAS Internal Note**

**MUON-NO-057**

**5 October 1994**

**The mathematical approach to the design of the 2nd level muon trigger for MDT and algorithm construction strategy**

_V.Kotov, I.Alexandrov, Yu.Yatsunenko_

Muon trigger group,JINR, Dubna

The parabolic approximation of \(\mu\) tracks in the barrel of the muon detector for level 2 ATLAS muon trigger with \(P_{t}\) calculation for further corrections in inhomogeneous magnetic field and a strategy for the construction of the trigger algorithm is submitted. The DICE simulations in 2 dimensional magnetic field show that this approximation worked as well even without any corrections in inhomogeneous magnetic field. Suggested approach to construct an algorithm in the way of the separation few stages of calculation initialy on the center of MDT tubes level data and then inside MDT tubes that permeate us work with integer variables through approximations in tube level show well possibility of flexible hardware realization of L2 \(\mu\) track recognition with large level of parallelism in calculations. The RoIs from L1 \(\mu\) trigger will be used for choice route along tracks and for the calculation of \(P_{t}\) can be used as output data for look up table corrections in inhomogeneous magnetic field.

The mathematical approach to the design of the 2nd level muon trigger for MDT

The JINR's design of the level 2 muon trigger uses parabolic approximation of the \(\mu\) trajectory in the barrel \(z(r)=A\cdot r^{2}+B\cdot r+C\), where \(A=const/(2\cdot P_{\rm t})\), \(B=cot(Theta0)\) (polar angle of emission), \(C=Z_{v}\) (the vertex, approximately due to some distortion of the trajectory in the solenoid). This representation has high level of reliability, additional level for the redundancy (i.e. possible attaching to the known vertex) and seems to be well suitable for the flexible hardware realization. The algorithm is simple enough: 3 hits define the basic parabola (i.e. A,B,C); these coefficients are used for the calculation of the full "length of the trajectory" - \(F(A,B,C)\) that is the number of hits within the "sigma-corridor" (accuracy of data measurements). The trigger is "ON" if \(F(A,B,C)>F_{threshold}\), i.e.when real trajectory should have significant number of MDT responses- hits (for instance 24 - total number of muon system layers) in the opposition to combinatorial track which has a few hits only. The parameters \(F_{threshold}\), "sigma-corridor" are determined mainly by the degree of the parabolic approximation accuracy, the magnetic field homogeneity and are the objects for the design of reasonable amount of corrections (look-up-tables).

The simulation of this trigger in 2-DIM magnetic field (present version of DICE in JINR gave the next results for Theta(80-130) and Phi(-12+18): the statistical distribution of the "length of the trajectory" \(F(A,B,C)\) is shown in fig.1; the efficiency vs \(P_{\rm f}\) is shown in fig.2 and the \(P_{\rm t}\)-accuracy is shown in fig.3. The probability of the correlated noise was 0.1, incorrelated - 0.2; average occupancy is 3.7 hits/layer (NB that due to the left-right ambiguity this value should be considered in twice grate).

These results look optimistic enough because there were no any corrections in magnetic field.

## 2 Algorithm construction strategy

We have the parabolic curve that approximate muon images as well. Any parabola is fixed by means of three points. We fix parabola through the basic layers which we select ourselves (for instance p,k,l) and for all triples of points in the basic layers (one point from one basic layer) inside level 1 trigger ROI we must calculate: (see appendix 1, fig.4)

a) A,B,C

\(\Longrightarrow\) A - for calculation of \(P_{\rm t}\)=const/A

b) F, Arg

\(\Longrightarrow\) The aid is to check have we such parabola inside our level-1 ROI (within the parabola sigma-wide passage) or no.

We need to take into account the large capacity of data, sign plus-minusambiguity of drift times, noise and so on.

The main idea in the strategy of the algorithm's construction is as follows:

1. To converse drift times to the values of points inside tube where parabola is crossed center of layer along z-axis. (the purpose to perform calculation with radiuses coordinates only as with constants for each layer and as result to make calculation simpler)
2. To converse data into a convenient coordinates systems through a tubes numbers only (reason: have not sign ambiguity in this level. The aid: to fulfil calculations with z-coordinate variables for inside-tube range only, the size of RoI given from L1 trigger will be decrease)
3. To approximate coefficients of conversion drift times on the level of tubes (for their drift-sign independence)

THE RESULT will be in:

* Possibility to apply the systematic approach to the synthesis of like-systolic architecture with largest advantages [1]
* Possibility of the flexible implementation of the algorithm in the architecture ( applying of DSPs, FLEX ALTERA coprocessors for DSPs, Look-up-tables; possibility of applying such methods as residue system and so on)[2-3].

For realization of item 1 aids we have to fulfil such conversion for each drift time \(S_{1}\) in any layer n (see fig.5): \(S_{2}=S_{1}\times k_{n}\), where \(S_{2}\) - distance between center of according tube and track's point,in which track and line jointing centers of tubes along z-axis layer are crossed.

\(k_{n}=\sqrt{1+ctg^{2}(\theta)}=\sqrt{1+(2\cdot A\cdot r_{n}+B)^{2}}\).

Thus radiuses in formulas for calculation \(A,B,z_{m}\) are the constant within layer. In other words

\[A=f_{1}(z_{l}-z_{k},z_{l}-z_{p})\]

\[B=f_{2}(z_{l}-z_{k},z_{l}-z_{p})\]

\[C=f_{3}(z_{l}-z_{k},z_{l}-z_{p},z_{k})\]

\[z_{m}=A\cdot r_{n}^{2}+B\cdot r_{n}+C=ff_{n}(A,B,C)\]

All \(r_{i}\) are constants.

The basis for realization of item 2 aids is a linear dependence of the variables \(A,B,C\) in equation of parabola \(z=A\cdot r^{2}+B\cdot r+C\). We can represent \(z\) as \(z=z^{(0)}+\Delta z^{(1)}\), where \(z^{(0)}\) - \(z\)-coordinates of tube's centers the points are inside of which. Thus from system

\[\left\{\begin{array}{rcl}z_{p_{\pi}}&\equiv&z_{p_{\pi}}^{(0)}+\Delta z_{p_{ \pi}}^{(1)}&=&A\cdot r_{p}^{2}+B\cdot r_{p}+C\\ z_{k_{\lambda}}&\equiv&z_{k_{\lambda}}^{(0)}+\Delta z_{k_{\lambda}}^{(1)}&=&A \cdot r_{k}^{2}+B\cdot r_{k}+C\\ z_{l_{q}}&\equiv&z_{l_{q}}^{(0)}+\Delta z_{l_{q}}^{(1)}&=&A\cdot r_{l}^{2}+B \cdot r_{l}+C\end{array}\right.\]\(\left\{\begin{array}{ccc}z_{p_{e}}^{(0)}&=&A_{0}\cdot r_{p}^{2}+B_{0}\cdot r_{p}+ C_{0}\\ z_{k_{b}}^{(0)}&=&A_{0}\cdot r_{k}^{2}+B_{0}\cdot r_{k}+C_{0}\\ z_{l_{q}}^{(0)}&=&A_{0}\cdot r_{l}^{2}+B_{0}\cdot r_{l}+C_{0}\\ &&\big{\downarrow}\end{array}\right.\)\(\left\{\begin{array}{ccc}\begin{array}{ccc}\big{\downarrow}\\ \Delta z_{p_{e}}^{(1)}&=&\Delta A_{1}\cdot r_{p}^{2}+\Delta B_{1}\cdot r_{p}+ \Delta C_{1}\\ \Delta z_{k_{b}}^{(1)}&=&\Delta A_{1}\cdot r_{k}^{2}+\Delta B_{1}\cdot r_{k}+ \Delta C_{1}\\ \Delta z_{l_{q}}^{(1)}&=&\Delta A_{1}\cdot r_{l}^{2}+\Delta B_{1}\cdot r_{l}+ \Delta C_{1}\\ &&\big{\downarrow}\end{array}\right.\)\(\left\{\begin{array}{ccc}\big{\downarrow}\\ \Delta z_{p_{e}}^{(1)}&=&\Delta A_{1}\cdot r_{p}^{2}+\Delta B_{1}\cdot r_{p}+ \Delta C_{1}\\ \Delta z_{k_{b}}^{(1)}&=&\Delta A_{1}\cdot r_{k}^{2}+\Delta B_{1}\cdot r_{k}+ \Delta C_{1}\\ \Delta z_{l_{q}}^{(1)}&=&\Delta A_{1}\cdot r_{l}^{2}+\Delta B_{1}\cdot r_{l}+ \Delta C_{1}\\ &&\big{\downarrow}\end{array}\right.\)

\(\left\{\begin{array}{ccc}\big{\downarrow}\\ z_{p_{e}}^{(0)}&=&A_{0}\cdot r_{p}^{2}+B_{0}\cdot r_{p}+C_{0}\\ z_{k_{b}}^{(0)}&=&A_{0}\cdot r_{k}^{2}+B_{0}\cdot r_{k}+C_{0}\\ z_{l_{q}}^{(0)}&=&A_{0}\cdot r_{l}^{2}+B_{0}\cdot r_{l}+C_{0}\\ &&\big{\downarrow}\end{array}\right.\)\(\left\{\begin{array}{ccc}\big{\downarrow}\\ \Delta z_{p_{e}}^{(1)}&=&\Delta A_{1}\cdot r_{p}^{2}+\Delta B_{1}\cdot r_{p}+ \Delta C_{1}\\ \Delta z_{k_{b}}^{(1)}&=&\Delta A_{1}\cdot r_{k}^{2}+\Delta B_{1}\cdot r_{k}+ \Delta C_{1}\\ \Delta z_{l_{q}}^{(1)}&=&\Delta A_{1}\cdot r_{l}^{2}+\Delta B_{1}\cdot r_{l}+ \Delta C_{1}\\ &&\big{\downarrow}\end{array}\right.\)

\(\left\{\begin{array}{ccc}\big{\downarrow}\\ z_{p_{e}}^{(1)}&=&A_{0}\cdot r_{p}^{2}+B_{0}\cdot r_{p}+C_{0}\\ z_{k_{b}}^{(0)}&=&A_{0}\cdot r_{k}^{2}+B_{0}\cdot r_{k}+C_{0}\\ z_{l_{q}}^{(0)}&=&A_{0}\cdot r_{l}^{2}+B_{0}\cdot r_{l}+C_{0}\\ &&\big{\downarrow}\end{array}\right.\)\(\left\{\begin{array}{ccc}\big{\downarrow}\\ \Delta z_{p_{e}}^{(1)}&=&\Delta A_{1}\cdot r_{p}^{2}+\Delta B_{1}\cdot r_{p}+ \Delta C_{1}\\ \Delta z_{k_{b}}^{(1)}&=&\Delta A_{1}\cdot r_{k}^{2}+\Delta B_{1}\cdot r_{k}+ \Delta C_{1}\\ \Delta z_{l_{q}}^{(1)}&=&\Delta A_{1}\cdot r_{l}^{2}+\Delta B_{1}\cdot r_{l}+ \Delta C_{1}\\ &&\big{\downarrow}\endConclusion

* The parabolic fit of muon tracks is convenient for triggering and work as well
* The approach has a parse of stability due to full geometric fixation of parabola
* Tube-level calculations are the natural continuation of refinement ROI determinated in level 1 trigger and can be fulfilled by means of logic operations
* The calculation with drift times are fulfilled independently and with the same coefficients
* Algorithm is very flexible. DSP and FLEX ALTERA coprocessors for them, Look-up-table, operations in residue system can be implemented combined
* The systematic approach to the synthesis of like-systolic architecture that realized this algorithm can be applied with large efficiency

The DICE simulations in real 3-dimensional magnetic field with incoherent, coherent (soft tracks which crossed up to 4 layers) and correlated (electrons and photons produced in the em showers) background will be fulfilled in nearest time (important point for checking the stability of L2 trigger due the waited significant background of neutrons and \(\gamma\)-quanta) [4].

The authors are grateful to A.Nisati for his help in initial study of work and useful remarks during ATLAS week discussions concerning suggested approach to L2 algorithm and design.

**References**

1. V.Kotov, I.Alexandrov,N.Likhoded, R.Pose, A.Tiounchik. On a systematic approach to the programming of the systolic structures for fast trigger pipe-processing. To be printed in reports of "Real Time Data 94" conference.

2. V.Kotov, I.Aleksandrov, R.Pose, and Yu.Yatsunenko. Pipe- processing on systolic structures of homogeneous calculating systems for fast processing of track information. Communication of the Joint Institute for Nuclear Research E10-93-191, Dubna, 1993.

3. V.Kotov, I.Alexandrov, N.Nikityuk. The systolic calculations in residue systems for fast triggering. To be printed in reports of "Real Time Data 94" conference.

4. A.Nisati, ATLAS Internal Note MUON-NO-027, 7 September 1993.

Appendix 1. Parabolic approximation of muon track images,

\[\left\{\begin{array}{rcl}z_{p\pi}&=&A\cdot r_{p}^{2}+B\cdot r_{p}+C\\ z_{k_{q}}&=&A\cdot r_{k}^{2}+B\cdot r_{k}+C\\ z_{l_{\lambda}}&=&A\cdot r_{l}^{2}+B\cdot r_{l}+C\end{array}\right..\]

\[A=\frac{\left(z_{l_{\lambda}}-z_{p_{\pi}}\right)\cdot\left(r_{k}-r_{l}\right) +\left(z_{l_{\lambda}}-z_{k_{q}}\right)\cdot\left(r_{l}-r_{p}\right)}{\left(r_ {p}-r_{l}\right)\cdot\left(r_{p}-r_{k}\right)\cdot\left(r_{l}-r_{k}\right)}\]

\[B=\frac{\left(z_{l_{\lambda}}-z_{p_{\pi}}\right)\cdot\left(r_{l}^{2}-r_{k}^{2 }\right)+\left(z_{l_{\lambda}}-z_{k_{q}}\right)\cdot\left(r_{p}^{2}-r_{l}^{2 }\right)}{\left(r_{p}-r_{l}\right)\cdot\left(r_{p}-r_{k}\right)\cdot\left(r_{ l}-r_{k}\right)}\]

\[C=\frac{z_{k_{q}}\cdot r_{l}\cdot r_{k}\cdot\left(r_{l}-r_{p}\right)+z_{l_{ \lambda}}\cdot r_{p}\cdot r_{k}\cdot\left(r_{k}-r_{p}\right)+z_{k_{q}}\cdot r _{p}\cdot r_{l}\left(r_{p}-r_{l}\right)}{\left(r_{p}-r_{l}\right)\cdot\left(r _{p}-r_{k}\right)\cdot\left(r_{l}-r_{k}\right)}\]

For each \(\pi=\overline{1,M_{p}};\ \lambda=\overline{1,M_{l}};\ q=\overline{1,M_{k}}\) for level-1 trigger ROI, where \(M_{p},M_{l},M_{k}\) are multiplicity for appropriate layer:

\[F=\sum_{n=1}^{N}\sum_{m=1}^{M_{n}}G[Arg;\sigma],\]

\[Arg=\left\{\begin{array}{ll}1\ if\ |\ z_{m}-A\cdot r_{n}^{2}-B\cdot r_{n}-C \ |<\sigma\\ 0\ otherwise\end{array}\right.\]

\(F\geq F_{threshold}\) (up to max number of layers in muon detector)

[MISSING_PAGE_EMPTY:7]

_Fig.4 (r,z) projection muon-image.__Fig.5 Coefficient of conversion.__Fig.6 Using of linear dependence of A, B, C.__Fig.7 Partitioning of parabola's representation._

_Tube level range._Fig.8 Conversion coefficient \(k_{\star}\) approximation error in mkm