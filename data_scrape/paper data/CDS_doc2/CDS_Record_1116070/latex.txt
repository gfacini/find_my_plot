**ATLAS NOTE**

ATL-COM-INDET-2008-010

July 21, 2008

**ATLAS Detector Paper Back-Up Note: Electrons and Photons**

M. Elsing\({}^{1}\), I. Gavrilenko\({}^{2}\), G. Gorfine\({}^{3}\), V. Kartvelishvili\({}^{4}\), T. Koffas\({}^{1}\),

V. Kostyukhin\({}^{5}\), J.S.H Lee\({}^{6}\), W. Liebig\({}^{7}\), A. Morley\({}^{8}\),

N.G. Piacquadio\({}^{9}\), K. Prokofiev\({}^{10}\), A. Wildauer\({}^{1}\), H. Zhu\({}^{10}\)

\({}^{1}\) _CERN, PH department, Geneva, Switzerland_

\({}^{2}\) _P.N. Lebedev Institute of Physics (FIAN), Russian Academy of Sciences, Russia_

\({}^{3}\) _FB C, University of Wuppertal, Germany_

\({}^{4}\) _Lancaster University, United Kingdom_

\({}^{5}\) _Universita \(\&\) INFN, Genova, Italy_

\({}^{6}\) _University of Sydney, Australia_

\({}^{7}\) _NIKHEF, Amsterdam, the Netherlands_

\({}^{8}\) _University of Melbourne, Australia_

\({}^{9}\) _Physikalisches Institut, Albert-Ludwigs-Universitaet Freiburg, Germany_

\({}^{10}\) _University of Sheffield, United Kingdom_

**Abstract**

This is the supporting note to the ATLAS Detector paper [1] for electron and photon reconstruction with the Inner Detector. It describes the software used to produce the results presented in the ATLAS Detector paper.

Introduction

Track reconstruction in modern particle physics experiments is a complex task which needs to account for imperfections in the tracking environment. The design luminosity of the Large Hadron Collider (LHC) at \(10^{34}\) cm\({}^{-2}s^{-1}\), results in multiple overlying proton-proton collisions on timescales characteristic of the detector response time. These collisions produce high numbers of charged particles which register high hit densities inside the tracking detector components. This complicates the particle track pattern recognition procedure, introducing fake track candidates. As the particles transverse through the detector, it can interact with detector material via scattering, bremsstrahlung radiation (especially for electrons), photon conversions (also from the bremsstrahlung photons) and nuclear interactions. Short-lived particles decay within the ATLAS Inner Detector producing kinks along tracks, adding further complications to the situation. All these factors present a difficult environment for track reconstruction and the software needs to be able to handle these challenges to maximise the potential discoveries in the ATLAS experiment [1].

The ATLAS Inner Detector faces greater problems for tracking than previous experiments due to the large amount of material within the tracking detectors, resulting in electrons and photons traversing more radiation lengths of material before reaching the calorimeters. This increases the likelihood of electrons losing significant amounts of energy to bremsstrahlung radiation and photons converting within the Inner Detector. Bremsstrahlung recovery track fitting algorithms and vertex reconstruction of converted photons that are employed by ATLAS are described in the following sections, followed by their performance.

## 2 Track Reconstruction

New Tracking [2] is the standard tracking strategy employed by ATLAS. It is composed of common tools (AlgTool) and interfaces following the ATLAS Event Data Model (EDM) [3]. It is flexible, enabling multiple tracking strategies to be implemented under a general framework. The current track reconstruction process consists of two main sequences, the primary _inside-out_ track reconstruction for charged particle tracks originating from the interaction region and a consecutive _outside-in_ track reconstruction for tracks originating later inside the tracker. Both methods reconstruct tracks that have both silicon (Si) and transition radiation tracker (TRT) hits and place these tracks in two distinct track collections. A third track category contains those tracks that have only TRT hits and no Si hits; these TRT-only tracks are placed in their own distinct track collection. All three track collections are then examined to remove ambiguities and double counting and are finally merged into a global track collection to be used later during the vertex-reconstruction phase. For a track to be reconstructed by any of these methods a minimum transverse momentum \(p_{T}>0.5\) GeV is required throughout. In the following section, a brief description of the _inside-out_ and _outside-in_ tracking algorithm is provided.

Electron tracks are efficiently found by the _inside-out_ tracking strategy. However, because the non-Gaussian energy loss is not accounted for by the default Kalman Filter [4] track fitting algorithm, two dedicated electron track fitting algorithms are implemented, the Dynamic Noise Adjustment and the Gaussian Sum Filter. These are described in Sect 3.

Photons suffer from a different issue. Tracks from photons do not originate from the interaction point and the later the conversion, the fewer number of silicon hits for the _inside-out_ tracking. To recover the late conversions, an _outside-in_ tracking strategy is used after the initial _inside-out_ tracking procedure.

### Inside-out Track Reconstruction

The main tracking strategy in New Tracking is the inside-out track reconstruction, starting with silicon (Pixel and SCT) detector measurements to form track candidates and extending these tracks into the TRT. This process is split into five main modules which are represented by dedicated algorithms starting with the formation of space point measurements in the Inner Detector. Once space points are formed, the pattern recognition process begins with straight line fits of a few space points (track seeds) which are extrapolated outwards, accumulating other space points along the trajectory.

This collection is sorted by the Ambiguity Processor to remove fake track candidates and outputs a fitted track (Kalman Fitter [4] is default).

The TRT extension finder looks for potential TRT track segments for the tracks in the \(ResolvedTrack\) collection. Finally the TRT extension processor determines if the added TRT segments improves the overall fit of the track, thus creating the final track collected called the \(ExtendedTracks\).

### Outside-In Track Reconstruction

The primary _inside-out_ track reconstruction is a very powerful technique for reconstructing tracks, especially in busy environments where the high granularity of the silicon sub-detectors (and in particular that of the pixel detector) can provide the necessary resolution for recovering the track-hit pattern. However, it may also lead to fake tracks if not carefully implemented. In order to reduce the number of fake reconstructed tracks, a minimum number of silicon hits is required for a track to be reconstructed; in the present implementation of the algorithm this number is seven. This requirement immediately leads to an increased inefficiency in reconstructing tracks that originate late inside the tracker, i.e. in the SCT. Furthermore, tracks which are present only inside the TRT will not be reconstructed at all. These tracks can appear in the cases of secondary decays inside the tracker (e.g. \(K_{s}\) decays) or during photon conversions. The _outside-in_ track reconstruction (also referred to as back-tracking) can offer a remedy to the inefficiency in reconstructing tracks which originate after the pixel detector.

The starting point for this type of track reconstruction is the TRT, where initial track segments are formed using a histogramming technique. In the \(R-\phi\) plane of a TRT barrel region or the \(R-z\) plane of a TRT end cap section, tracks that originate roughly at the primary interaction region appear to follow straight lines (this is an even better approximation in the second case). These straight-line patterns can be characterized by applying the Hough transform [5], which is based on the simple idea that in the \(R-\phi(R-z)\) plane, a straight line can be parametrized using two variables: \((\phi_{0},c_{T})\) or \((\phi_{0},c_{z})\) respec

Figure 1: Track reconstruction efficiency for conversions from 20 \(\mathrm{GeV}\)\(p_{T}\) photons as a function of the conversion radius.

tively, where \(c_{T}\) and \(c_{z}\) are the corresponding azimuthal and longitudinal curvatures and \(\phi_{0}\) is the initial azimuthal angle. As a result, in a two-dimensional histogram formed by these two parameters, TRT straw hits lying on the same straight line will fall within a single cell. Straight lines can therefore be detected by scanning for local maxima in these histograms. To improve the accuracy in the longitudinal direction, the TRT is divided into 12 pseudorapidity slices on either side of the \(\eta\)=0 plane. The two-variable approximate track parameters can then be used to define a new set of geometric divisions inside the TRT, within which all straws that could possibly be crossed are included. Using the transformation described in [6], the curved trajectory suggested by the straw hits may be transformed into a straight line in a rotated coordinate system. This is the initial step for a "local" pattern recognition process, in which the best TRT segment may be chosen as the one that crosses the largest number of straws in this straight-line representation. A cut on the minimum number of straw hits necessary to consider the segment as valid is applied during this step. A final Kalman-filter smoother procedure is then applied to determine as accurately as possible the final track parameters of the segment. The above TRT-segment reconstruction procedure has been adopted from the original ATLAS track reconstruction algorithm _xKalman_ as described in the references [7].

The reconstructed TRT segments are then fed into the second step of the back-tracking algorithm in which extensions are added to them from the silicon sub-detectors. Space point seeds are searched for in narrow \(R-\phi\) wedges of the Si tracker, indicated by the transverse TRT-segment track parameters derived in the previous step. A minimum of two space points is required in this case, the search being confined to the last three SCT layers. To reduce the number of space-point combinations cuts on the curvature are then applied, with the third measurement point provided by the first hit in the initial TRT segment. As soon as seeds with pairs of space points are formed, the initial-segment track parameters can then be significantly improved, especially the longitudinal components. A new geometric section through the Si-detector elements is then constructed and a combinatorial Kalman-fitter/smoother technique, as in the case of the _inside-out_ tracking, is applied to produce Si-track extension candidates. The Si-track extensions provide a much improved set of track parameters, which can be used to find new TRT extensions to be assigned to every Si-track candidate, thus creating once more a "global" track. Ambiguity resolving and track refitting follow afterwards in the appropriate manner. The final set of resolved tracks from this process is stored in a dedicated track collection. In order to reduce the time required for the reconstruction and minimize double counting, the _outside-in_ tracking procedure excludes all the TRT-straw hits and Si-detector space points that have already been assigned to _inside-out_ tracks. The enhancement of the track reconstruction efficiency after the _outside-in_ reconstructed tracks are included is shown in Figure 1. Here the track reconstruction efficiency for photon conversions is plotted as a function of the radial distance of the conversion for the case of 20 GeV \(p_{T}\) single photons, before and after the _outside-in_ tracking is performed. The bulk of the gain in tracking efficiency is, as expected, at larger radii. The inefficiencies of this method as a function of radius are discussed further in Sect 2.3 and again in Sect 4.3 and 4.4. Due to the more limited pseudorapidity coverage of the TRT tracker, the _outside-in_ tracking can be used to efficiently reconstruct tracks up to a pseudorapidity value of \(|\eta|=2.1\). All the results presented here therefore, have been restricted within this pseudorapidity range.

### Standalone TRT Tracks and Final Track Collection

After the _outside-in_ track collection has been formed, all TRT segments that have not been assigned any silicon extensions are then used as the basis of one more distinct track collection. These segments are first transformed into tracks, and the segment local parameters are used as the basis for producing the corresponding track parameters assigned to the surface of the first straw hit. Perigee parameters are also computed, but no overall track refitting is performed. These new TRT tracks are then scored and arranged accordingly and a final ambiguity resolving is performed in order to reject any tracks that share too many straw hits. Finally, these standalone TRT tracks are then stored in a special track collection.

At the end of the track reconstruction process, and before any primary or secondary vertex fitters are called or other post-processing tasks are executed, the two track collections described above, along with the track collection produced by the _inside-out_ tracking, are merged. No further ambiguity resolving is performed, since the straw hits and silicon space points associated with the _inside-out_ tracks have already been excluded before the _outside-in_ track reconstruction. This merged track collection is then used by the photon conversion reconstruction algorithm.

The overall tracking efficiency after all three track collections discussed above are merged, is shown in Figure 2 for both the case of a 20 GeV \(p_{T}\) single photon sample, and also for a 5 GeV single photon sample, which is more indicative of the case of low track momenta. Two competing effects become apparent as one observes these two plots. The overall track reconstruction efficiency for conversions that happen early inside the tracker, i.e. in \(R<150\) mm, is higher in the case of the 20 GeV \(p_{T}\) photons than that for the 5 GeV \(p_{T}\) ones. This is a clear indication of the larger effect that bremsstrahlung losses have on low \(p_{T}\) tracks, especially on those that originate early inside the tracker. Furthermore it is possible that, depending on the amount of the incurred losses, only part of the track will be reconstructed, i.e. its TRT component, with the pattern recognition failing to recover the corresponding silicon clusters. The small fraction of standalone TRT tracks that enhance the track reconstruction efficiency from early

Figure 3: Track reconstruction efficiency for conversions from 20 GeV photons (left) and 5 GeV photons (right) as a function of pseudorapidity.

Figure 2: Track reconstruction efficiency for conversions from 20 GeV \(p_{T}\) converted photons (left) and 5 GeV \(p_{T}\) converted photons (right).

conversions, is primarily due to this effect. On the other hand the overall track reconstruction efficiency at higher radii is much better for the case of the 5 GeV \(p_{T}\) photons. This is due to the fact that the radius of curvature, being much larger for those tracks, enables them to separate from each other faster as they traverse the tracker under the influence of the applied magnetic field. It is therefore easier in this case to distinguish the two tracks and reconstruct them during the pattern recognition stage. Figure 3 shows the track reconstruction efficiency as a function of pseudorapidity, for both 20 GeV and 5 GeV \(p_{T}\) photons. The overall track reconstruction efficiency is very uniform along the whole pseudorapidity range, starting only to significantly fall off as one approaches the limit of the TRT pseudorapidity extent (\(|\eta|=2.1\)). The reduction in efficiency observed around \(|\eta|=1\), is due to the gap at the transition from the barrel to the end cap TRT.

## 3 Track Fitting

Track based bremsstrahlung recovery algorithms can be used to improve electron track measurements. ATLAS has two algorithms, the Dynamic Noise Adjustment and the Gaussian Sum Filter, both of which are adaptions of the Kalman method.

Energy loss of electrons due to bremsstrahlung has been described by Bethe and Heitler [8].

\[f(z)=\frac{(-\ln(z))^{c-1})}{\Gamma(c)},\ \ c=\frac{t}{\ln(2)}, \tag{1}\]

where \(z\) is the ratio of the energy of the electron after bremsstrahlung \((E_{f})\) to the initial energy \((E_{i})\):

\[z=\frac{E_{f}}{E_{i}} \tag{2}\]

The amount of material traversed by the particle, \(t\), is described by a fraction of the material's radiation length \((x_{0})\):

\[t=\frac{x}{x_{0}} \tag{3}\]

According to the description of the bremsstrahlung process, the electron retains its direction of propagation and a fraction \(z\) of its energy, with the probability density given by the Bethe-Heitler distribution,

Figure 4: Bethe-Heitler distribution of the fraction \(z\) of energy retained by the radiating electron.

shown in Figure 4. This probability density \(f(z)\) depends on the amount of traversed material and has a singularity at \(z\to 1\) and a long tail extending to very small \(z\).

Figures 5 and 6 shows the energy loss of electrons due to the bremsstrahlung process within the Inner Detector. The increase in material at high \(|\eta|\) in the silicon detector results in the greater average energy loss for electrons when entering the TRT.

Figure 7 shows a radiating track in the magnetic field. If an electron suffers an act of bremsstrahlung at point \(C\), its track will have a smaller radius of curvature after that point, hitting layer \(S5\) at point \(F\) instead of point \(G\) (while the photon follows the tangent \(C-E-H\)). A tracking algorithm which does not take the possibility of such changes into account will, in such cases, return a track with an underestimated momentum value and unacceptable fit quality.

### Kalman Filtering

The default track reconstruction method in ATLAS [3] uses a Kalman Filter (KF) [4, 9]. This is a recursive procedure and is able to account for multiple scattering and certain energy loss. The optimal way for the Kalman Filter to deal with radiative energy is to correct the mean energy of energy loss and increase the variance of the energy loss distribution. This will lead to a unbiased estimates of the track parameters and the associated uncertainties.

Figure 5: Average fraction of electron energy loss as a function of \(|\eta|\), when exiting the pixel, the SCT and the Inner Detector tracking volumes.

Figure 6: Probability distribution of the total fraction of initial electron energy (\(E_{e}\)) emitted by bremsstrahlung radiation (\(E_{brem}\)).

Figure 7: A track changing its curvature at point \(C\) due to bremsstrahlung. This track has lost 35% of its momentum at that point.

The Kalman Filter is used to determine the vector of track parameters, \(y\), and its covariance matrix, \(C\), taking into account the measurement \(m\) (and its respective covariance matrix \(V\)) at each detector layer \(k\). In a slightly simplified notation, the procedure includes three steps:

1. Extrapolate \(y\) and \(C\) from layer \(k-1\) to layer \(k\): \[y_{k-1}\to y_{k}^{-},\qquad C_{k-1}+Q_{k-1}\to C_{k}^{-}\] Here \(Q_{k}\) is the covariance matrix of the system noise at layer \(k\), which can take into account things like multiple scattering and bremsstrahlung.
2. Calculate Kalman gain \(K\) at layer \(k\): \[K_{k}=\frac{C_{k}^{-}}{C_{k}^{-}+V_{k}}\]
3. Do measurement update: \[y_{k}=y_{k}^{-}+K_{k}(m_{k}-y_{k}^{-}),\qquad C_{k}=(1-K_{k})C_{k}^{-}\]

It can be shown (see e.g. [9] and references therein) that this procedure only works properly if both measurement uncertainty \(V\) and the process noise \(Q\) are well described by Gaussian distributions. While this is usually the case for measurement errors and multiple scattering, it's certainly not true for bremsstrahlung, which causes problems during electron track reconstruction. As mentioned above, when applied to a radiating electron track similar to the one shown in Figure 7, the default KF fit is likely to result in a bad fit quality with an underestimated reconstructed momentum.

### Dynamic Noise Adjustment

A quick and efficient method of dealing with electron tracks has been developed and implemented in ATLAS. It is based on the Dynamic Noise Adjustment (DNA) [10] during Kalman filtering.

At each silicon layer, a simple single-parameter fit is performed to flag hits which may be associated with bremsstrahlung. This fit tries to estimate the increase in curvature due to possible bremsstrahlung at the current detector layer. If no bremsstrahlung was flagged, the track fitter reverts to the default Kalman filtering procedure. Otherwise, the result of the single parameter fit -- the estimated fraction of energy retained by the electron, \(z\) -- is used to calculate the additional effective "system noise" term, which is then fed to the Kalman Filter.

The effective "system noise" variance calculation is illustrated by Figure 8, which shows how the Bethe-Heitler distribution is mapped onto the Gaussian distribution of unit width. The deviation \(\Delta z\) of the estimated \(z\) from the median \(z_{0}\) is mapped onto the Gaussian to find the corresponding deviation \(\Delta x\). The effective noise \(\sigma\) is then calculated as \(\sigma_{\rm DNA}(z)=\Delta z/\Delta x\).

This procedure is equivalent to representing the random variable \(z\), distributed according to the Bethe-Heitler probability density, in the form

\[z=z_{0}+x\sigma_{\rm DNA}(z)\]

where \(x\) is a random variable with Gaussian probability distribution.

So, in this approach bremsstrahlung is legitimately treated as a source of Gaussian noise, but only in those cases when bremsstrahlung-like behaviour of the track has been detected. The proper Gaussian probability distribution of this "system noise" is now guaranteed by construction.

Figure 8: Mapping of the probability distributions used to calculate the variance of the effective noise term.

Figure 9: Effective \(\sigma_{\rm DNA}(z)\) for various values of material thickness in the detector layer.

Of course, \(\sigma_{\text{DNA}}\) also depends on the thickness of material associated with the corresponding layer, as illustrated by Fig.8.

The variance \(\sigma_{\text{DNA}}^{2}\) is added to the appropriate term of the Kalman covariance matrix used during the fit, similarly to the treatment of any other source of system noise. However, this particular noise term is adjusted dynamically according to the estimated \(z\) and the thickness of the layer, thus justifying the name of the method.

### Gaussian Sum Filter

The Gaussian Sum Filter (GSF) [11] is a non-linear generalisation of the Kalman Filter. It requires that all probability density functions (PDF's) be described by Gaussian mixtures.

In the Bethe-Heitler model, the PDF, \(f(z)\), of the energy loss is very non Gaussian. If you approximate the energy loss due bremsstrahlung to by a single Gaussian it is quite a crude approximation. A nonlinear estimator would yield better results (taking into account the actual shape of the distribution). Estimating the Bethe-Heitler distribution with a weighted sum of Gaussians can prove to be quite accurate given enough Gaussians (see Figure 10). It is this estimate that is used in the GSF to estimate energy loss at each material surface. A detailed description of the GSF can be found [12].

Optimisation of the GSF is detailed in [12] and the default setting for the main parameters of the GSF are detailed in Table 1.

### Bremsstrahlung Recovery Performance

Figures 11 and 12 shows the comparisons of inverse momentum and momentum divided by truth for the default Kalman fitter and for two bremsstrahlung recovery algorithms, Gaussian Sum Filter and Dynamic

\begin{table}
\begin{tabular}{c c} \hline \hline Parameter & Setting \\ \hline Maximum number of Gaussians in the PDF & 12 \\ Number of Gaussian describing the Bethe-Heitler distribution & 6 \\ Bethe-Heilter Approximation method & CDF distance minimisation \\ Component Reduction Method & Close Components \\ \hline \hline \end{tabular}
\end{table}
Table 1: Default Settings for the Gaussian Sum Filter

Figure 10: PDF’s of the Gaussian mixtures (blue-solid) obtained by minimising the cumulative distribution function distance. The Bethe-Heitler PDF is shown in red (dashed). The sum of the number of Gaussian mixtures is shown in blue (solid). The thickness of material traversed is \(x/x_{0}=0.02\).

Noise Adjustment, in different \(|\eta|\) sections. The Dynamic Noise Adjustment was tuned for aggressive bremsstrahlung recovery.

The tracks from the barrel region of the detector (\(|\eta|<0.8\)) are least effected by bremsstrahlung radiation as shown Figure 5, and thus, the default tracking fitting algorithm produces comparable results with the dedicated electron fitters. However, tracks in the end-cap region of the detector suffer from large energy losses. Track precision measurements come from the silicon detector hits and the greater average energy loss in the high \(|\eta|\) region produces the tails. The dedicated electron fitters clearly improve measurements in this region. The tails for the dedicated electron fitters are due electrons losing large fractions of its energy very early. These case provide insufficient information for the track fitters as majority of the track hits are produced by the reduced energy electron.

Figure 11: Probability distribution for the ratio of the true to reconstructed momentum for electrons in different \(|\eta|\) bins. The results are shown as probabilities per bin for the default Kalman fitter, Gaussian Sum Filter and Dynamic Noise Adjustment.

Figure 12: Probability distribution for the ratio of the measured to true momentum for electrons in different \(|\eta|\) bins. The results are shown as probabilities per bin for the default Kalman fitter, Gaussian Sum Filter and Dynamic Noise Adjustment.

[MISSING_PAGE_EMPTY:14]

Figure 13: Probability for reconstructed invariant mass of electron pairs from \(J/\psi\to ee\) decays in events with \(B_{d}^{0}\to J/\psi(ee)K_{S}^{0}\). The results are shown for the default Kalman fitter, Gaussian Sum Filter and Dynamic Noise Adjustment. The true \(J/\psi\) mass is shown by the solid line.

Vertex Fitting

Track finding is only the first step in reconstructing photon conversions; the next step is being able to reconstruct the conversion vertex using the pair of tracks produced by the converted photon. Reconstruction of the conversion vertex is quite different from finding the primary interaction vertex, since for conversions additional constraints can be applied that directly relate to the fact that the invariant mass of the electron-positron pair from a converted photon is strongly peaked at zero. A specific vertex algorithm, appropriately modified in order to take into account the massless nature of the conversion vertex, has been developed for use by the photon conversion algorithm.

The vertex fit itself is based on the fast-Kalman filtering method; different robust versions of the fitting functional can also be set up in order to reduce the sensitivity to outlying measurements. The vertex fitting procedure uses the full 3D information from the input tracks including the complete error matrices [13].

### Algorithm Description

The goal of a full 3D vertex fit is to obtain the vertex position and track momenta at the vertex for all tracks participating in the fit as well as the corresponding error matrices. From the input tracks, the helix perigee parameters defining the particle trajectory along with their weight matrix are extracted as described in the references [14, 15]. If one assumes that the particle is created at the vertex \(\vec{V}\), then the trajectory parameters \(q_{i}\) may be expressed as a function of the vertex position and the particle momentum at this vertex \(q_{i}=T(\vec{V},\vec{p}_{i})\). A vertex is then obtained by minimizing:

\[\chi^{2}=\sum_{i=1}^{2}(q_{i}-T(\vec{V},\vec{p}_{i}))^{\top}w_{i}(q_{i}-T( \vec{V},\vec{p}_{i})), \tag{4}\]

where \(w_{i}\) is the \(5\times 5\) weight matrix from the track fit. In order to find the \(\vec{V}\) and \(\vec{p}_{i}\) which minimize the above \(\chi^{2}\), Equation 4 can be linearized at some convenient point close to the vertex as:

\[\chi^{2}=\sum_{i=1}^{2}(\delta q_{i}-D_{i}\delta\vec{V}-E_{i}\delta\vec{p}_{i })^{\top}W_{i}(\delta q_{i}-D_{i}\delta\vec{V}-E_{i}\delta\vec{p}_{i}), \tag{5}\]

where \(D_{i}=(\partial T(\vec{V},\vec{p}_{i}))/(\partial\vec{V})\) and \(E_{i}=(\partial T(\vec{V},\vec{p}_{i}))/(\partial\vec{p}_{i})\) are matrices of derivatives. A fast method to find a solution that minimizes Equation 5 has been proposed in the references [14, 15]. It can be shown that this method is completely equivalent to a Kalman-filter based approach [4], where the vertex position is recalculated after every new track addition.

If the initial estimation of the vertex position is far from the fitted vertex, then the track perigee parameters and the error matrix are extrapolated to the fitted point, all derivatives are recalculated and the fitting procedure is repeated. The official tracker extrapolation engine, along with a realistic magnetic field description, is used in this case.

### Vertex Fit Constraints

Constraints are included in the vertex fit algorithm via the Langrange multiplier method. A constraint can be viewed as a function

\[A_{j}(\vec{V},\vec{p}_{1},\vec{p}_{2},...,\vec{p}_{n})=const \tag{6}\]

which is added to the fitting function of Equation 4 as

\[\chi^{2}=\chi_{0}^{2}+\sum_{j=1}^{N_{center}}\lambda_{j}\cdot A_{j}^{2} \tag{7}\]Here \(\chi^{2}_{0}\) is the function without constraints, \(\lambda_{j}\) is a Lagrange multiplier and \(j\) is the constraint number. \(A^{2}_{j}(...)\) can be linearized around some point \((\vec{V}_{0},\vec{p}_{0i})\) to obtain

\[\chi^{2}=\chi^{2}_{0}+\sum_{j=1}^{N_{const}}\lambda_{j}\cdot(A^{2}_{j0}+H_{j}^{ \top}\delta V+\delta V^{\top}H_{j}+F_{ij}^{\top}\delta p_{i}+\delta p_{i}^{\top }F_{ij}) \tag{8}\]

where \(H_{j}=(\partial A_{j})/(\partial\vec{V}),F_{ij}=(\partial A_{j})/(\partial \vec{p}_{i}),A_{j0}\) is an _exact_ value of \(A_{j}\) at the \((\vec{V}_{0},\vec{p}_{0i})\) point, \(\delta\vec{V}=\vec{V}-\vec{V}_{0}\) and \(\delta\vec{p}_{i}=\vec{p}_{i}-\vec{p}_{0i}\).

The solution of Equation 8 then has the form \(\vec{V}=\vec{V}_{0}+\vec{V}_{1}\), \(\vec{p}_{i}=\vec{p}_{0i}+\vec{p}_{1i}\), where \(\vec{V}_{0},\vec{p}_{0i}\) is the solution of the corresponding problem without the constraint \(\chi^{2}=\chi^{2}_{0}\). The second component \(\vec{V}_{1},\vec{p}_{1i}\) of the above solution is obtained through the normal Lagrange multiplier system of equations. In the case of the conversion vertex, a single angular constraint needs to be implemented. This requires that the two tracks produced at the vertex should have an initial difference of zero in their azimuthal angles \(\delta\phi_{0}=0\). This is equivalent to requiring an initial massless particle, but it has the advantage of being much easier to implement.

The right-hand plot in Figure 14 shows the reconstructed photon inverse transverse momenta \(p_{T}\) after vertex fitting for conversions where neither of the emitted electrons suffered significant bremsstrahlung (\(<20\%\) of each electron's energy is lost), while the left shows the transverse momenta for the cases where significant bremsstrahlung was present. Similarly the corresponding radial position resolution for conversions with/without significant losses due to bremsstrahlung is shown in Figure 15. Single converted 20 GeV \(p_{T}\) photons were used for the plots above and the emitted electron tracks were required to have at least two silicon space points. The angular constraint \(\delta\phi=0\), implemented as described earlier, has been used throughout. The overall vertex reconstruction efficiency will be discussed in the following section. It is evident that the presence of bremsstrahlung significantly deteriorates the performace of the vertex fitter. Further studies on \(K_{s}\rightarrow\pi^{+}\pi^{-}\) decays, have confirmed this.

Figure 14: The reconstructed inverse transverse momenta from 20 GeV \(p_{T}\) converted photons with (left) and without (right) significant losses due to bremsstrahlung.

## 5 Conversion Reconstruction

With the three track collections and the vertex fitting algorithm described in the previous two sections, we now have all the necessary tools in place in order to fully reconstruct photons which convert as far as 800 mm away from the primary interaction point in the transverse plane. Beyond that radius, the track reconstruction efficiency drops off dramatically due to the lack of a sufficient number of hits in any sub-detector to reliably reconstruct the particle trajectory and accurately determine its track parameters. The conversion reconstruction algorithm is run within the framework of the overall Inner Detector reconstruction software; it is one of the last algorithms run during the post-processing phase. The basic components of the conversion reconstruction are: the track selection and subsequent track classification, the formation of pairs of tracks with opposite charge, the vertex fitting and reconstruction of photon conversion vertex candidates, and finally the reconstruction of single track conversions. The conversion candidates are then stored in a separate vertex collection, to be retrieved and further classified through matching with electromagnetic clusters during the next level of the event reconstruction. In the results presented in this section, the reconstruction efficiency is estimated for those photon conversions that happen as far as 800 mm away from the primary interaction point, emit daughter electrons with each having at least \(p_{T}\ =\)0.5GeV and are within the \(|\eta|\leq 2.1\) pseudorapidity range. This amounts to \(\sim\) 77% of the total photons converted inside the ATLAS tracker volume. For further details on the conversion reconstruction strategy, including several application studies, see [16].

### Track Selection

Only a fraction of the possible track pairs reconstructed by the tracking algorithms and included in the final track collection come from converted photons. Although the wrong-track combinations may be rejected later during the conversion reconstruction process or by physics specific analysis, it is important

Figure 15: The reconstructed vertex radial positions in mm for conversions from 20 GeV \(p_{T}\) photons as compared to their truth values. The left-hand plot is for conversions with significant bremsstrahlung losses and the right-hand one without.

to remove them as efficiently as possible at an early stage, not least because of the large amount of CPU time involved in processing every possible track pair. Cuts on the perigee impact and longitudinal track parameters, as well as the transverse momentum, are first applied. Tracks that are most probably associated to electrons are then selected by cutting on the probability reconstructed by using the ratio of high threshold TRT hits over the total number of TRT hits in each track, known as the \(TRratio\)[17]. These cuts have been tuned using simulated \(H\rightarrow\gamma\gamma\) events, with background present due to the underlying event. All the efficiencies and rejection factors due to track selection cuts which are quoted in this note refer to this physics sample. Table 2 shows the performance of these cuts in accepting tracks produced by converted photons and rejecting non-conversion related tracks. The inverse of the rejection factor is the fraction of fakes surviving. After applying these cuts, the surviving tracks are then arranged into two groups with opposite charges.

### Track Pair Selection

At this point in the reconstruction process, all possible pairs of tracks with opposite signs are formed and further examined. There are three possible types of track pairs:

1. Pairs in which both tracks have silicon hits;
2. Pairs in which one of the two tracks is a standalone TRT track;
3. Pairs in which both tracks are standalone TRT tracks.

In order to reduce the combinatorial background, a series of cuts are applied during the pair formation. These are common to all three track pair types described above, although their actual values may differ. Table 3 lists those cuts along with the corresponding efficiencies and rejection factors for selecting the correct track pairs and discarding fakes resulting from wrong track combinations. The first criterion for accepting a track pair is that the difference in polar angles between the two daughter tracks in a conversion should be small, based on the fact that the photon is massless. Furthermore, the distance between the first hits of the two tracks in the pair should be reasonably close (First Hit \(\delta R\)); this is particularly true in the case where both of them are standalone TRT tracks. Finally, the distance of minimum approach between the two tracks in the pair is checked. An iterative method has been implemented that uses the Newton approach to find the set of two points (one on each track) which are closest to each other (Min Distance). Other other method relies on the \(CTVMFT\) vertex fitting algorithm [18] to calculate the \(\delta XY\), which another measure on the minimum distance between two helices. The distance of minimum approach between the two tracks is then calculated and a cut is applied to reject those cases where the tracks fail to come within a specified distance from each other.

In order to enhance the performance of the constrained vertex fitter, it is important to begin with a reasonable initial estimate of the vertex position. Using the perigee parameters of the two tracks in the pair, the corresponding radius of curvature and the center of curvature of the track-helix projection on the \(R-\phi\) plane can be derived. As this track-helix projection is circular in the case of a homogeneous

\begin{table}
\begin{tabular}{|c|c|c|} \hline Cut & Efficiency & Rejection \\ \hline No Cuts & 0.7378 & 1.00 \\ Impact d0 & 0.7334 & 1.16 \\ Impact z0 & 0.7316 & 1.18 \\ TR ratio & 0.7119 & 2.12 \\ \hline \end{tabular}
\end{table}
Table 2: Sequential track selection cuts (described in text) with corresponding efficiencies and rejection factors.

magnetic field such as that of the ATLAS tracker, the estimated vertex position can be identified as either the point of intersection of two circles, or in the case of non intersecting circles, as the point of minimum approach between two circles. If the two circles do not intersect or approach each other closer than a set minimum distance then the pair is discarded. In principle, two circles may intersect at two points. The difference in the distance traversed by the two helices along the \(z\)-axis \(\delta z\) is then computed for each one of the two intersection points. Only solutions in which the value \(\delta z\) is below a specified cut-off value are kept. A cut is also applied on the arc length of the \(R-\phi\) plane projection of the two track helices between the line connecting the centers of curvature of the two circles and the actual intersection points. This arc length is required to fall within a specific range. Finally, the distance from the track origin (the candidate conversion vertex location) and the actual points of intersection should also be small. Only track pairs with intersection or minimum approach points that satisfy the above criteria are further examined. If, after all of these considerations, there still remain two intersection points, the one which corresponds to the smallest distance traversed along the \(z\)-axis is selected. Estimating the initial vertex position allows for a larger number of quality criteria of the track pair to be used in the overall selection process. All the cuts applied during this step have been tested using the 120 GeV\(H\rightarrow\gamma\gamma\) physics sample; the cuts are tuned so that at least two orders of magnitude of the combinatorial background can be rejected at this point. In general, the position of the initially estimated vertex falls within a few millimeters of the actual conversion vertex for the correct pair combinations, all deviations being due to at least one of the two tracks in the pair being a TRT-only track.

### Vertex fitting

The original track perigee assigned during the track reconstruction process is set at the primary interaction point and for the case of photon conversions, especially those that happen far inside the tracker, this is a rather poor assignment. Using the initial estimate for the vertex position described previously, we can redefine the perigee at this point. The new perigee parameters need to be recomputed by carefully extrapolating from the first hit of each track in the pair to this new perigee, taking into account all the material encountered on the way. It is these tracks with their newly computed perigee parameters that are passed to the vertex fitter. This also has the desirable effect of avoiding long extrapolations during the various iterations of the vertex fitting process, which might lead to distortions due to unaccounted-for material effects. At the end of the process the new vertex position along with an error matrix and a \(\chi^{2}\) value for the fit are computed. A vertex candidate is then reconstructed that also contains the track parameters as they are redefined at the fitted conversion vertex. The fit is always successful in the case of the correct track pairs, and it often fails otherwise. After the fit is executed, post-selection cuts on the \(\chi^{2}\) of the fit, on the reconstructed photon invariant mass and on the reconstructed photon \(p_{T}\) can be applied,

\begin{table}
\begin{tabular}{|c|c|c|} \hline Cut & Efficiency & Rejection \\ \hline Polar Angle & 0.7070 & 10.8 \\ First Hit \(\delta R\) & 0.7049 & 12.5 \\ Min Distance & 0.6994 & 16.3 \\ \(\delta XY\) & 0.6970 & 16.5 \\ Vertex R & 0.6959 & 16.6 \\ Min Arc L & 0.6935 & 40.3 \\ Max Arc L & 0.6890 & 111.6 \\ \(\delta z\) & 0.6870 & 111.9 \\ \hline \end{tabular}
\end{table}
Table 3: List of sequential cuts (defined in text) employed during the track pair selection for the three possible types of track pairs with corresponding efficiencies and rejection factors.

Figure 16: Transverse momentum distribution of reconstructed photon conversions for both correct and wrong track pairs for all three types of pairs: silicon-silicon (left column), silicon-TRT (center column), and TRT-TRT (right column). In the top row all electron tracks regardless of bremsstrahlung energy losses are considered for the case of the correct track pairs. In the bottom row only track pairs where both electrons have lost less than 20% of their energy due to bremsstrahlung are shown. For comparison the truth \(p_{T}\) of the converted photon is also shown.

to reduce even further the wrong pair combinations. These are listed in Table 4.

The track pair selection and the vertex fitting process result in a reduction in the combinatorial background rate by more than 2 orders of magnitude, with only a rather small (\(\sim 8\%\)) loss in overall conversion reconstruction efficiency, in the case of the 120 GeV \(H\rightarrow\gamma\gamma\) physics sample. At this stage of the conversion vertex reconstruction, fake vertices which come from the combinatorial background outnumber the correct conversion vertices by almost a factor of six. The main part of this remaining background consists of reconstructed vertices where at least one of the participating tracks is not an electron at all. This is primarily due to the rather weak particle identification capabilities of the tracker without any access to the electromagnetic calorimeter information. It is expected to be effectively remedied during the subsequent stages of the photon conversion reconstruction, when the calorimeter information will be present. Figure 16 shows the \(p_{T}\) distribution of the reconstructed conversion vertices along with the distribution for fake vertices resulting from wrong combinations. It is clear that the latter tend to concentrate at the lower \(p_{T}\) region. Nevertheless a final cut on the reconstructed photon \(p_{T}\) will not be as efficient as expected, due to the limited ability at present to correct the reconstructed track momentum for losses due to bremsstrahlung. This is evident in the figure when comparing the reconstructed converted photon \(p_{T}\) distribution with (top row) and without (bottom row) significant bremsstrahlung losses. It becomes even more striking once it is compared to the truth \(p_{T}\) distribution of the converted photon. In the remaining part of this section, the overall performance of the conversion reconstruction software, without utilising the electromagnetic calorimeter information, is examined in the case of single 20 GeV \(p_{T}\) photons, where the combinatorial background is minimal.

Figure 17 shows the track, track pair, and vertex reconstruction efficiencies for conversions coming from 20 GeV \(p_{T}\) photons as a function of both conversion radius and pseudorapidity. Both the track and track pair efficiencies shown in the figure, are before any of the selection criteria described above are applied. The large drop in the efficiency at \(R>400\) mm is primarily due to the inefficiency of reconstructing both tracks in the track pair from the photon conversion. It is also noteworthy that both the track and the conversion vertex reconstruction efficiency are essentially constant as a function of pseudorapidity, except for a gap at \(|\eta|=0.8\) due to the crack between the barrel and the end-cap.

### Single Track Conversions

Due to conversions which decay asymmetrically, as well as cases where the conversion happens so late that the two tracks are essentially merged, there are a significant number of conversions where only one of the two tracks from the photon conversion is reconstructed. Depending on the photon momentum scale, these "single track" conversions become the majority of the cases for conversions that happen late in the tracker and especially inside the TRT. The ability of the TRT to resolve the hits from the two tracks is limited, especially if those tracks do not traverse a long enough distance inside the tracker for them to become fully separated. As a result, only one track is reconstructed, but it may still be highly desirable to recover these photon conversions.

At the end of the vertex fitting process, all of the tracks that have been included in a pair that successfully resulted in a new photon conversion vertex candidate, are marked as "assigned" to a vertex. The

\begin{table}
\begin{tabular}{|c|c|c|} \hline Cut & Efficiency & Rejection \\ \hline Fit Convergence & 0.6870 & 171.5 \\ Fit \(\chi^{2}\) & 0.6710 & 288.9 \\ Invariant Mass & 0.6626 & 353.9 \\ Photon \(p_{T}\) & 0.6625 & 377.1 \\ \hline \end{tabular}
\end{table}
Table 4: Post-vertex fit sequential selection cuts with associated efficiencies and rejection factors.

Figure 17: Conversion reconstruction efficiency for conversions from 20 GeV \(p_{T}\) photons as a function of conversion radius (left) and pseudorapidity (right). The solid histogram shows the track reconstruction efficiency, the dashed histogram shows the track-pair reconstruction efficiency, and the points with error bars show the conversion vertex reconstruction efficiency.

Figure 18: The left hand plot shows the conversion reconstruction efficiency for conversions from 20 GeV \(p_{T}\) photons as a function of conversion radius. The points with error bars show the total reconstruction efficiency, the solid histogram shows the conversion vertex reconstruction efficiency, and the dashed histogram shows the single-track conversion reconstruction efficiency. The right hand plot shows the same efficiencies as a function of pseudorapidity.

remaining tracks are then examined once more on an individual basis in order to determine whether or not they can be considered as products of a photon conversion. For a track to be considered, it should have its first hit beyond the pixel vertexing layer. Furthermore, the track should be electron-like, where again the probability reconstructed by using the ratio of the high threshold TRT hits over the total number of TRT hits (as in the initial track selection described earlier in this section, but requiring a much higher value) is used to select likely electron tracks. At the end of this selection, tracks wrongly identified as emerging from photon conversions outnumber the actual photon conversion electron tracks by almost a factor of two. These are misidentified electron tracks as the particle identification process is not ideal without the presence of any information from the electromagnetic calorimeter.

A conversion vertex candidate is then reconstructed at the position of the first track hit. It is clear that, especially in the case where the first hit is inside the silicon part of the tracker, the position of the conversion vertex reconstructed in this way can be off by as much as a detector layer. This discrepancy is normally much smaller in the case of a vertex inside the TRT due to the higher straw density. On the technical side, this type of reconstruction requires a careful transformation of the local track parameters and error matrix into global ones that are directly assigned to the newly defined vertex. A new vertex candidate is then stored, identical in structure to the one derived from a vertex fit with the important difference that it has only one track assigned to it. The effect of including the single track conversions into the overall conversion reconstruction efficiency is significant as is shown in Figure 18. The plot shows the conversion reconstruction efficiency for 20 GeV \(p_{T}\) photons as a function of both radial distance and pseudorapidity. As expected, the single-track conversions become more and more dominant at higher radial positions, and single-track conversions are fairly uniformly distributed across the full pseudorapidity range.

## 6 Changes with release

### Dynamic Noise Adjustment

The code of the DNA fit has been stable for quite a while now, and its performance can be fine-tuned through jobOptions file using the parameters described above.

The primary design purpose of a special electron fitting algorithm is to use this type of fit for refitting tracks belonging to identified electrons. This, however, excludes those electron tracks which, due to an early strong bremsstrahlung radiation, do not have TRT extensions and/or cannot be associated with the corresponding ECAL cluster. The speed and efficiency of the DNA fit allows for the possibility of using this fit for all tracks in the event by default, thus recovering such electrons. In order to avoid significant biases on non-electron tracks, a more conservative tuning of the DNA fit needs to be used in such case, together with the special Separator tool, specificly designed for this purpose.

Starting from release 13.2.0, whenever KalmanDNAFitter is invoked, the DNA fit is applied to all tracks in the event, and the Separator tool is called at the end of each iteration. If Dynamic Noise Adjustment has been applied to the track, the Separator attempts to establish whether the DNA intervention was successful. If deemed successful, the correction stands and a flag is passed to the electron identification processor (?). Otherwise, a refit is done without DNA adjustment, thus reverting to the standard KF. Hence, after 13.2.0 the DNA fit is optimised for this type of application and uses a more conservative tuning, recovering only most significant bremsstrahlung radiation losses and leaving the vast majority of non-electron tracks intact.

### Gaussian Sum Filter

The performance of the GSF has been quite consistent between version 12 and 14 of Athena. The one major change, which occurred between versions 12 and 13 of Athena, has been the use of the mode of the PDF that describes the perigee parameter \(q/p\) instead of the mean of the distribution. This significantly reduced the width of the core the distribution while increasing the tails of the distribution (see Table 5. The tails of the distribution consists of tracks from electrons that have emitted bremsstrahlung radiation earlier in the detector. Only very small changes can be seen in the other perigee parameters when comparing the results in different versions of Athena.

From version of 12 to 14 there has been small but not insignificant reduction in the the number of primary electron tracks found (\(\sim 0.6\%\)). This drop can be accounted by a minor change to fitter that required that all tracks fitted have a valid set of perigee parameters.

Due to the nature of the GSF it is very computationally intensive and as such efforts have been made to reduce the time required to fit track. As a results of the GSF is approximately 12% quicker per track improving from \(\sim 400\) ms per track to \(\sim 350\) ms per track.

### Photon Conversion Reconstruction

Unlike the tracking algorithms, the photon conversions reconstruction algorithm is a rather new development. In its full power it has been implemented for the first time only within the release 14.X framework. The preformance results presented in the ATLAS Detector Paper have essentially been reproduced using an "early" form of release 14.0. Since then the photon conversions reconstruction code remains an integral part of the Inner Detector reconstruction software, turned on by default and executed at the very end of the Inner Detector reconstruction process. It is not possible therefore to have a realistic comparison of its performance with any ATLAS software releases that have appeared before release 14.0.

## 7 Acknowledgements

We are deeply embedded in the ATLAS Inner Detector and e/gamma software groups and we like to thanks our colleagues for the useful discussions and for their help in producing the results.

## References

* [1] ATLAS Collaboration, The ATLAS Experiment at the Large Hadron Collider, 2007, ATL-COM-PHYS-2007-042.
* [2] T. Cornelissen et al., Concepts, Design and Implementation of the ATLAS New Tracking (NEWT), 2007, ATL-SOFT-PUB-2007-007.
* [3] F. Akesson et al., ATLAS Tracking Event Data Model, 2007, ATLAS Public Note, ATL-SOFT-2006-004.
* [4] R. Fruhwirth et al., Nucl. Inst. Meth. **A262** (1987) 444.

\begin{table}
\begin{tabular}{c c c c c} \hline Version of Athena & 25\% & 50\% & 68\% & 95\% \\ \hline
12.0.7 & 0.065 \(\pm\) 0.002 & 0.123 \(\pm\) 0.003 & 0.203 \(\pm\) 0.005 & 2.815 \(\pm\) 0.058 \\
13.0.40 & 0.030 \(\pm\) 0.001 & 0.080 \(\pm\) 0.002 & 0.211 \(\pm\) 0.005 & 3.754 \(\pm\)