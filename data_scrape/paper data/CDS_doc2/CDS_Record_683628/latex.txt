**ATLAS Internal Note**

**MUON-NO-240**

**25 May 1998**

**MDT Track Fitting with the Maximum Likelihood Method**

M. Deile, N.P. Hessey, A. Staude

University of Munich

**Abstract**

Conventional MDT tracking and autocalibration are based on track fits with the least squares method. This assumes that the errors of the r-t relationship are gaussian which is correct far from the anode wire. For impact distances \(r\) from the wire smaller than about 2 mm however the gaussian approximation doesn't hold: The statistical distribution of the ionisation electrons along the particle track leads to considerable non-gaussian tails in the drift time spectra for a given track distance. The consequences are biased tracks and a bad reconstruction efficiency near the wires.

We present a solution to these problems which is based on maximum likelihood track fits taking into account the 2-dimensional probability distribution \(P(t,r)\) as measured in a test beam.

The improvement of the reconstruction efficiency for the new method is shown.

[MISSING_PAGE_EMPTY:2]

Introduction

The ionisation charge produced by a muon passing through a drift tube is stochastically distributed along the track. The statistics of energy deposit are characterized by two aspects [1]:

* The interactions of the muon with gas particles being independent, the number of ionisation clusters per unit length is governed by a Poisson distribution. In Argon at 3 bar the mean number of clusters per cm of track is about 105 corresponding to a mean cluster distance of 95 \(\mu\)m.
* The number of electrons in a cluster depends on the details of the various contributing ionisation mechanisms and cannot be expressed in a closed form. It can however be simulated with HEED [2], a program for computing energy loss of particles in gases, which not only involves the cross-sections for muon collisions with gas atoms, but also takes into account secondary ionisation processes and delta-ray production. Figure 1 shows the cluster size distribution for Ar(91) / N\({}_{2}\)(4) / CH\({}_{4}\)(5) [3]. Ignoring clusters above 500 e the mean number of electrons per cluster is about 3.

This statistical behaviour has consequences for the drift time distribution at a given distance of a particle track from the anode wire.

As a simple example for the clustering effect let's consider a muon track passing exactly through the anode wire (\(r=0\), track 1 in figure 2). Although the track distance to the wire is zero in this case, we will in general measure a non-zero drift time, because we have to wait for a certain number of primary electrons (e.g. 25) before the signal crosses the discriminator threshold. In a rare extreme case we can get a cluster at the wire surface with more than 25 electrons, leading to a zero drift time. On the other hand the cluster

Figure 1: Cluster Size Distribution for Ar / N\({}_{2}\) / CH\({}_{4}\) = 91 / 4 / 5 at 3 bar calculated with HEED by [3]

containing the 25th electron can also be far away from the wire, which is much more frequent for our particular case where the 25th electron is most likely to be produced at a distance of about 600 \(\mu\)m from the wire (figure 3a).

The strong maximum of the cluster size distribution at 1 electron per cluster yields a long tail in the distribution of the creation position of the 25th electron. Passing from this position spectrum (figure 3a) to the corresponding drift time spectrum (figure 3b) the asymmetry is even enhanced by the high drift velocity near the wire which shifts the peak towards earlier times but doesn't affect the tail at late times.

Figure 3: Simulation of the clustering effects. For the simulated time spectrum in (b) only the clustering effect is taken into account (no diffusion, noise etc.)

Figure 2: Ionisation along a track through the anode wire (track 1) and far from the wire (track 2)

The asymmetry is most important for track radii smaller than the typical distance of the 25th electron. For tracks further away than about 2 mm the clustering effect becomes less important, because all the electron clusters arrive practically at the same time (figure 2, track 2). Here diffusion dominates the time distribution which becomes gaussian.

What is the impact of this well-known physical effect on tracking and autocalibration?

* The first problem arises from the asymmetry of the drift time distributions for fixed radii (= the cross-sections of the r-t relationship) near the wire. Conventional methods used to "squeeze" a Gauss function over the central parts of these distributions. This leads to difficulties in the determination of a gaussian resolution, which strongly depends on the range around the maximum where the Gaussian is fitted. If this badly defined resolution is then used for a \(3\sigma\) cut, discarding all events in the tails, the reconstruction efficiency will be bad.
* If the track passes closer to the wire than the typical distance of the trigger electron, the mean arrival time of this electron is practically the same as for a track through the wire. In the function \(r(t)\) this shows up as an almost infinite "effective drift velocity" \(v_{\rm eff}=\frac{dr}{dt}\). In this domain \(v_{\rm eff}\) has nothing to do with the drift velocity of the 25th electron, because \(r\) is the shortest distance between the track and the wire but no longer the drift distance of the 25th electron. The consequence of the almost infinite \(v_{\rm eff}\) is a very bad track position sensitivity.
* Near \(r=0\) it is not very helpful to define a functional dependence \(t(r)\). If we take for example the maximum of the measured TDC time distribution at \(r=0\) as \(t_{0}\) (corresponding to zero drift time), times \(t<t_{0}\) have to be artificially set to \(t_{0}\) in order to avoid non-physical "negative drift times". By doing so however we lose most of the information contained in the measured time.

To avoid these problems, instead of defining a function \(r(t)\) with gaussian errors we use the full information contained in the time distributions for given \(r\). For this purpose we measured the shape of the r-t distribution in a test beam using a Silicon microstrip beam telescope as external reference system. Then we parametrized the conditional probability distribution \(P(t|r)\)1) for small radial slices. \(P(t|r)\) was then used for the construction of a likelihood function. The maximum likelihood method then replaced the usual least \(\chi^{2}\) method for track fitting. Thus a measured drift time is no longer directly converted into a hit radius. The likelihood fit gets the **time** as an input and yields the track radius as a result taking correctly into account the tails in the probability distributions.

Footnote 1: \(P(t|r)\) is the probability density for measuring a time \(t\) at a given track radius \(r\).

Experimental Setup

Our studies have been done with data taken in the H8 test beam in spring 1997. Figure 4 shows our setup. We used a 30 cm long bundle of 16 drift tubes, which was built by MPI Munich. The tubes were operated with "Datcha Gas" (Ar / N\({}_{2}\) / CH\({}_{4}\) = 91 / 4 / 5) at 3 bar pressure and with a gain of \(2\cdot 10^{4}\). As front-end electronics we used BNL preamplifiers and shapers with a peaking time of 15 ns and a Lecroy discriminator with an effective threshold of 25 primary electrons. For the data readout and recording the RD13 DAQ system [4] was used.

As external reference system we used ODYSSEUS [5], a beam telescope consisting of 6 Silicon microstrip detectors with 7 \(\mu\)m resolution each. 4 out of the 6 planes measure the precision coordinate perpendicular to the MDT wires, the other 2 detectors give us the second coordinate parallel to the wires. The silicon telescope resolution for the track position at the chamber is 5 \(\mu\)m, somewhat greater than \(\frac{\eta_{\mu}\mathrm{m}}{\sqrt{4}}\) due to multiple scattering.

The silicon detectors cover an area of 5.1 \(\times\) 5.1 cm\({}^{2}\). Thus 8 MDTs lie partly within the window defined by ODYSSEUS.

In order to measure the r-t distributions with sufficient statistics, about 900 k events have been taken.

Figure 4: Experimental Setup

## 3 **arametrisation of the r-t Relationship**

The starting point of our work is an r-t relationship as shown in figure 5. The main band represents the conventional r-t relationship. The entries below the main band are \(\delta\)-rays. The background above comes from inefficiencies where we miss the first hit (it is an effect at the per-mille level which is visually exagerated relative to the saturated main band in this form of PAW display).

Figure 6: Conditional time distributions near the wire (\(r<0.3\) mm). The histograms are the data, the curves are fits of the function (2).

Figure 7: Conditional time distributions far from the wire (5.1 mm \(<r<\) 5.4 mm). The histograms are the data, the curves are fits of the function (2). The left-hand tails are \(\delta\)-rays.

For track fitting we need a phenomenological parametrisation of \(P(t|r)\) which provides a smooth transition from the asymmetric domain at small \(r\) to the gaussian domain far from the wire. For simplicity and robustness of the fit the number of free parameters should not be too big. Furthermore one would like parameters with an intuitive meaning.

After several attempts we finally found that the following function serves very well:

\[P(t|r)=\underbrace{p_{1}(r)\cdot\frac{1}{p_{3}(r)}e^{\frac{p_{2}(r)\to t}{p_{2}(r) }-e^{\frac{p_{2}(r)\to t}{p_{3}(r)}}}}_{\text{asymmetric part ("Extreme Value Function")}}+\underbrace{[1-p_{1}(r)]\cdot\frac{1}{\sqrt{2\pi}\,p_{3} (r)}e^{-\frac{\frac{\hbar}{2}-p_{2}(r)|^{2}}{2|p_{3}(r)|^{2}}}}_{\text{gaussian part}} \tag{2}\]

The parameters have the following significance:

\(p_{1}(r)\): Amount of asymmetric contribution.

\(p_{2}(r)\): Peak position (corresponding to the conventional \(t(r)\) function).

It is not the mean of the distribution!

\(p_{3}(r)\): Quantity characterizing the width of the distribution (time resolution).

It is not the rms!

By normalisation the Gaussian contribution is fixed to \(1-p_{1}(r)\). Therefore our parametrisation has 3 degrees of freedom, one more than for the conventional gaussian method. In addition to the information about the peak position and the resolution we have a quantity \(p_{1}\) characterizing the asymmetry of the time distribution.

Figures 6 and 7 show that our parametrization fits the data very well. From these fits we get the parameters \(p_{1}\), \(p_{2}\) and \(p_{3}\) as a function of the track radius \(r\). These dependencies are presented in figure 8. The solid lines represent the fit functions:

\[p_{1}(r) =e^{-a_{1}(r-a_{1})} \tag{3}\] \[p_{2}(r) =\text{polynomial}\,\text{$\mathrm{J}_{7}$}(r)\] (4) \[p_{3}(r) =e^{-b_{2}(r-b_{1})}+b_{3}r+b_{4} \tag{5}\]

with constants \(a_{i},b_{i}\). For completeness figure 8 also shows the Gaussian contribution

\[1-p_{1}(r)=1-e^{-(a_{1}+a_{2}r)}\quad. \tag{6}\]

The wide spread of the points for \(p_{1}\) comes from the similarity of the Gauss and the Extreme Value Function: The anticorrelation between the amounts of each makes \(\chi^{2}\) rather insensitive to this parameter.

**Figure Captions**

[MISSING_PAGE_POST]

The Maximum Likelihood Tracking Method

### Principle

So far we have explained how to derive the conditional probability distribution \(P(t|r)\) from a measured r-t relationship. In this chapter we will show how this is used for the reconstruction of muon tracks through the 4 \(\times\) 4 \(\mathrm{MDT}\) chamber.

For this first study we only accept so-called "golden events", i.e. events with exactly 1 hit in each of the 4 layers of tubes. Thus every accepted event provides a quadruple \(\{t_{1},t_{2},t_{3},t_{4}\}\) of drift times.

The principle of track fitting with the maximum likelihood method is the following [8]:

**Maximize the likelihood of the observation \(\{t_{1},t_{2},t_{3},t_{4}\}\) by varying offset \(c\) and slope \(m\) of the track \(y=mz+c\).**

The likelihood function \(L\) that has to be maximized is given by the product of the conditional time distributions for the tubes through which the track passes:

\[L=\prod_{i=1}^{4}P(t_{i}|r_{i}(m,c))\quad, \tag{7}\]

where \(r_{i}(m,c)\) is the distance between the wire \(i\) and the track \(y=mz+c\). To avoid correlations between \(m\) and \(c\), the origin \(z=0\) has been chosen in the center of the chamber.

### Technical Procedure

To assure convergence of the likelihood fit we have to provide start values for the fit parameters, i.e. the track offset \(c\) and the slope \(m\). For this purpose we guess on the hit radii in the first and the last layer by applying a linear function \(r(t)=v_{0}t\) (with \(v_{0}\approx 30\mu\)m/ns for the Datcha Gas) to the measured drift times. These 2 hit radii however leave a 4-fold ambiguity about the track candidates (figure 9). Therefore each of the 4 sets of initial values \((m_{0},c_{0})\) is used as a starting point for the maximization of \(L\) (or minimization of \(-\ln\,L\) as is done in practice). At the end there are 4 optimized tracks, out of which the one with the least \(-\ln\,L\) is selected as the real track. Usually this selection is very unambiguous because the likelihood of the second best track is worse by several orders of magnitude.

Hits resulting from delta-rays far from the muon track give a very bad likelihood for the fit. If it is smaller than the machine precision (\(10^{-308}\) in our case), the event is discarded in the present analysis. It was verified that for these events the \(\chi^{2}\) method with the "golden event" requirement also gives very bad fits. The handling of such events (about 20 % in a 4-layer chamber) can be improved in the future.

## 5 Comparison of Likelihood Tracking with \(\chi^{2}\) Tracking

We now want to judge the quality of our tracking method and compare it with conventional \(\chi^{2}\) track fitting based on a functional r-t relationship.

After reconstructing a track as described in the previous section, a second track fit is done by minimization of

\[\chi^{2}=\sum_{i=1}^{4}\frac{(r_{\mathrm{hit}}^{(i)}-r_{\mathrm{track}}^{(i)})^ {2}}{\sigma_{i}^{2}}\quad, \tag{8}\]

where the hit radii \(r_{\mathrm{hit}}^{(i)}\) are calculated from an r-t relationship which is obtained using the silicon telescope information, and \(r_{\mathrm{track}}^{(i)}\) is the shortest distance between the track and the \(i\)th wire. \(\sigma_{i}\) is the gaussian resolution of the \(i\)th tube at the radius \(r_{\mathrm{hit}}^{(i)}\).

Now both MDT tracks (from likelihood and \(\chi^{2}\) method) are compared with the reference track given by the silicon telescope. To quantify the deviations from the reference track we introduce three criteria:

* Offset difference: \(\Delta c=c_{\mathrm{MDT\ track}}-c_{\mathrm{Sill\ track}}\)
* Slope difference: \(\Delta m=m_{\mathrm{MDT\ track}}-m_{\mathrm{Sill\ track}}\)
* Track radius difference in tube \(i\): \(\Delta r^{(i)}=r_{\mathrm{MDT\ track}}^{(i)}-r_{\mathrm{Sill\ track}}^{(i)}\)

Figure 9: Determination of the initial fit parameters \((m_{0},c_{0})\)Since improvements are mostly expected near the wires we distinguish two classes of tracks:

1. Tracks with all radii \(r^{(i)}>2\) mm.

2. Tracks with at least one radius \(r^{(i)}<2\) mm.

As an example the offset difference \(\Delta c\) is plotted versus the reference offset \(c_{\rm{SIII\ track}}\) in figure 10. Apparently the least squares method (upper plot) has difficulties with class 2 tracks: There are steps (evidence for biases) and big tails in the band pattern. For the maximum likelihood method (lower plot) these problems are much reduced.

For a better quantitative comparison we project the 2-dimensional histograms in figure 10 on the \(\Delta c\) axis, separately for class 1 and 2. Figures 11 and 12 show the result for class 1 and 2 respectively.

Maximum likelihood tracking reduces not only the width of the distribution (the tracking resolution), but also the tails. As expected the improvement is most remarquable for class 2, because it is mainly near the wire where we changed tracking by taking into account the correct r-t distributions.

Figure 11: Projection of figure 10 on the \(\Delta c\) axis for class 1

A numerical summary of the comparison for each class can be found in tables 1 and 2. The compared quantities are \(\Delta c\), \(\Delta m\) and \(\Delta r\) for tube no. 2. To characterize the widths of their distributions we give the rms and the \(\sigma\) of a Gauss curve fitted to the central part of the distributions. The tails are quantified by the \(3\sigma\)-efficiency \(\eta_{3\sigma}\) with

\[\eta_{3\sigma}=\frac{\mbox{number of entries within 3 $\sigma$ around the peak}}{\mbox{total number of entries}} \tag{9}\]

Figure 12: Projection of figure 10 on the \(\Delta c\) axis for class 2

Note that for class 2 the 3\(\sigma\)-inefficiencies are reduced by more than 50 % (40 % for class 1). The gaussian resolution in \(c\) (\(\sigma_{\Delta c}\) in table 2) is improved by about 5 \(\mu\)m for class 2.

What is the statistical importance of the 2 classes? By simple geometry one can derive the fraction of tracks in class 2 as a function of the track angle. The result for 4-tube layers and an angular range from 0\({}^{0}\) to 45\({}^{0}\) is drawn in figure 13. It shows that up to 54 %, but at least 27 % of all tracks pass near the wire in at least one tube. Hence for a rather big fraction of tracks the reconstruction can be improved.

\begin{table}
\begin{tabular}{|c|c c|c c|c c|} \hline  & \multicolumn{2}{c|}{rms} & \multicolumn{2}{c|}{\(\sigma\)} & \multicolumn{2}{c|}{\(3\sigma\)-Efficiency} \\  & \(\chi^{2}\) Method & ML Method & \(\chi^{2}\) Method & ML Method & \(\chi^{2}\) Method & ML Method \\ \hline \(\Delta c\) & 88.2 \(\mu\)m & 68.7 \(\mu\)m & 57.0 \(\mu\)m & 56.8 \(\mu\)m & 95.9 \% & 97.7 \% \\ \(\Delta m\) & 3.78 \(\times 10^{-3}\) & 3.06 \(\times 10^{-3}\) & 1.97 \(\times 10^{-3}\) & 1.97 \(\times 10^{-3}\) & 95.3 \% & 97.1 \% \\ \(\Delta r\,^{(2)}\) & 142.7 \(\mu\)m & 134.3 \(\mu\)m & 86.9 \(\mu\)m & 85.5 \(\mu\)m & 96.8 \% & 97.0 \% \\ \hline \end{tabular}
\end{table}
Table 1: Numerical comparison for class 1 tracks (\(\Delta r^{(2)}\) is defined on page 11)

Figure 13: The percentage of tracks with at least one radius \(<2\) mm as a function of the track angle from 0\({}^{0}\) to 45\({}^{0}\).

Conclusions

Track fitting with the maximum likelihood method naturally incorporates a correct treatment of the non-gaussian errors of the r-t relationship near the wire.

We have shown that compared with least squares fitting the tracking precision is improved and the tails are reduced. The effect is particularly important for tracks passing near a wire where the prediction of the track offset is improved by about 5 \(\mu\)m and the 3\(\sigma\)-inefficiencies are reduced by about 50 %.

Since maximum likelihood tracking doesn't need a functional \(t(r)\)- or \(r(t)\)-dependence, no absolute \(t_{0}\) needs to be introduced and "negative drift times" no longer occur.

For describing the rt-relationship the new method requires an additional parameter, which characterizes the asymmetry of the time distribution for a given track radius. As a consequence new techniques for autocalibration have to be developed. This challenge will be tackled in the near future.

## References

* [1] W. Blum, L. Rolandi: Particle Detection with Drift Chambers, Springer Verlag, 1957
* [2] Igor Smirnov: HEED, program to compute energy loss of particles in gases, Version 1.01, CERN
* [3] W. Riegler: Limits to Drift Chamber Resolution, PhD Thesis at the TU Wien, 1997
* [4] G. Polesello: DAQ shift guide for H8 Muon testbeam, modified rd13 note 169, July 1996
* a Silicon Telescope for Test Beam Experiments, System Description and User Manual for the Data Analysis, Draft 3, LMU Munich 1998, available on the WWW-page: [http://www.etp.physik.uni-muenchen.de/atlas/testbeam.html](http://www.etp.physik.uni-muenchen.de/atlas/testbeam.html)
* [6] A. Biscossa et al.: The First Full-Scale Prototype of a BIL MDT Chamber for the ATLAS Muon Spectrometer, ATLAS Muon Note 136
* [7] T. Sammer: Autokalibration von