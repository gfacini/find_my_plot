# Techniques for the Measurement of Common Mode Noise in Binary Read Out Systems

P.J. Bell

Corresponding author: pjb@hep.ph.bham.ac.uk

J. Grosse-Knetter

Now at University of Bonn, Bonn, Germany. University of Birmingham, Birmingham, UK CERN, Geneva, Switzerland

###### Abstract

Methods have been developed to measure the amount of common mode noise present in binary read-out systems. It is demonstrated how the correlation in the occupancies of groups of channels provides a measure of the magnitude of the common mode noise they are susceptible to. At high thresholds the occupancy per event is found to yield a more sensitive test for common mode noise. The functionality of the methods is demonstrated by application to the ATLAS SCT silicon microstrip detectors.

keywords: binary readout, common mode noise, correlated noise +
Footnote â€ : Now at University of Bonn, Bonn, Germany.

## 1 Introduction

Common mode noise is of particular concern in the analysis of binary data obtained from analogue signals that may have been affected by coherent distortions. The ATLAS SCT [1] silicon microstrip detectors are an example of such a system. These detectors are read-out using a scheme in which the signals are compared to a threshold and converted to binary information on the front end chip. Common mode noise originating from any external source in the proximity of the detectors leads to coherent variations in the signals across groups of channels. If the read-out was analogue, this common mode noise contribution could easily be deduced from the pedestal heights and subtracted from the signals on an event by event basis. However, in binary read-out systems such corrections cannot be made, demanding that the common mode noise pick-up be negligible.

Methods to detect and measure common mode noise have been reported elsewhere [2]. In this work they have been extended and applied to ATLAS SCT detector modules operated at the barrel system test [3]. A single module comprises 1 536 detector channels, the signals from which are amplified and digitised in groups of 128 by 12 ABCD readout chips [4]. It is assumed throughout this work that the common mode source has a Gaussian distribution which adds coherently to the Gaussian random noise on a group of channels. It is natural to consider coherent effects to extend over the 128 channels of any single chip sub-system.

## 2 Methods for Detection and Measurement of Common Mode Noise

All noise levels are normalised to the single channel random noise, \(\sigma\). The threshold, \(\tau\), is also in units of \(\sigma\). The distribution of the random noise in any strip is given by

\[P(x)=\frac{1}{\sqrt{2\pi}}\exp\left(-\frac{x^{2}}{2}\right),\]

and the common mode noise by

\[P(z)=\frac{1}{\sqrt{2\pi\,s^{2}}}\exp\left(-\frac{z^{2}}{2s^{2}}\right),\]

where \(s\) is the magnitude of the common mode noise. These are convoluted to give a total noise distribution

\[P(a)=\frac{1}{\sqrt{2\pi(1+s^{2})}}\exp\left(-\frac{a^{2}}{2(1+s^{2})}\right),\]

where \(a=x+z\). The observed occupancy above some threshold \(\tau\) is then given by

\[O(\tau)=\int_{\tau}^{\infty}P(a)da\]

which evaluates to the complementary error function

\[O(\tau)=\frac{1}{2}\mathrm{erfc}\left(\frac{\tau}{\sqrt{2(1+s^{2})}}\right).\]

The conventional method of measuring the noise performance employs a threshold scan yielding the occupancy of a strip as a function of its discriminator threshold, known as the "S-curve" for that strip [5]. In the Gaussian approximation, the width of the S-curve is the sum in quadrature of the random noise on that channel with any common mode noise that the channel is sensitive to; \(1+s^{2}\) in this notation. In principal, \(s\) can be determined by comparing to a similar measurement taken in an environment free of common mode noise, though such a method is insensitive to small \(s\) due to the extra errors introduced by the change in operating conditions. More sophisticated techniques are therefore required to measure \(s\) when the common mode pick-up is small.

Although the common mode noise is generally not expected to have a Gaussian distribution, it may still be approximated by a Gaussian when it represents a small component of the total noise and the complementary error function remains a close fit to the S-curves. If the common mode noise leads to a non-Gaussian behaviour of the total noise it can be detected employing less refined methods than those described here, for example by looking for non-linear deviations in a plot of the log of the occupancy as a function of the threshold squared [2].

### The Correlation Matrix Method

Any common mode noise pick-up across the channels of one chip leads to a correlation between their occupancies. The correlation matrix for all channels of a chip therefore gives an immediate indication of the presence of common mode noise. The amount of correlation gives a measure of the magnitude of the common mode noise.

The correlation between two channels \(A\) and \(B\) at some threshold \(\tau\) is given by [2]

\[C_{AB}(\tau)=\frac{O_{A\,B}(\tau)-O_{A}(\tau)O_{B}(\tau)}{\sqrt{O_{A}\,(\tau)- O_{A}(\tau)^{2}}\sqrt{O_{B}(\tau)-O_{B}(\tau)^{2}}}\]

where \(O_{A\,(B)}(\tau)\) is the occupancy of channel A (B) and \(O_{A\,B}(\tau)\) refers to the occupancy of channels A and B together, given by the number of common hits divided by the number of events.

The distributions of the (uncorrelated) random noise in strips A and B are given by the Gaussians

\[P_{A}(x) = \frac{1}{\sqrt{2\pi}}\exp\left(-\frac{x^{2}}{2}\right)\] \[P_{B}(y) = \frac{1}{\sqrt{2\pi}}\exp\left(-\frac{y^{2}}{2}\right)\]where it is assumed that the size of the random noise is the same in each channel. 1 From these it is possible to define a two dimensional noise distribution, \(P(x,y)\), given by the product of the Gaussians associated with each channel:

Footnote 1: Measurements demonstrate that for SCT modules this assumption is a good ap

#### 2.1.1 Correlations Between Chips

In addition to the correlations between the strips of one chip, it is also possible to measure the correlations between pairs of chips with in or between detector modules. The correlation between any two chips \(C_{1}\) and \(C_{2}\) is found by averaging the correlations between each strip \(i\) in chip \(C_{1}\) and its counterpart \(i^{\prime}\) in chip \(C_{2}\),

\[C_{C_{1}C_{2}}=\frac{1}{128}\sum_{i,i^{\prime}=128}^{i,i^{\prime}=128}C_{ii^{ \prime}},\]

such that each chip with itself gives a correlation of unity as required. However, if the two chips can be represented by two channels \(A\) and \(B\), with the occupancies of the channels taking on the respective chip-averagad values, then the expected correlation between the two chips assuming they are both susceptible to the same source of common mode noise is given by

\[C_{C_{1}C_{2}}=\frac{1}{2\pi\sqrt{(1+2s^{2})}}\exp\left(-\frac{1}{2(1+2s^{2})} ((1+ns^{2})a^{2}+(1+s^{2})b^{2}-2abs^{2})\right),\]

where \(n\) is the ratio of the noise pick-up in chip \(A\) to that in chip \(B\). Thus, once the size of the common mode noise in each chip is known, the correlation between them is predicted and is generally non-zero if the amount of noise pick-up is not identical. In a matrix of correlations between two chips, then, there is no new information that is not concealed in the unit entries along the diagonal.

Figure 1: _The correlation between two strips as a function of common mode noise, \(s\), for thresholds 0, 1, 2, 3\(\sigma\)._

[MISSING_PAGE_EMPTY:6]

with

\[\alpha=2\pi\frac{\mathrm{Var}(N_{e})-\overline{N_{e}}(1-\frac{\overline{N_{e}}}{n} )}{n(n-1)}.\]

If the observed variance is equal to that expected from binomial statistics then \(\Gamma\) and the common mode noise contribution are zero, no matter how many channels there are or how the threshold is set. Figure 2 shows \(\Gamma\) plotted as a function of \(s\) for several different thresholds. Defined in this way, \(\Gamma\) has the useful property of approximating the ratio of common mode noise over single channel random noise when operating at the 50% occupancy point (\(\tau=0\)). However, this is not the operating regime of the SCT modules, where sensitivity to common mode noise at high thresholds is more important (see next section). This motivates the definition of an alternative observable \(\Omega\), given by

\[\Omega=\frac{n}{(n-1)}\left(\frac{\mathrm{Var}(N_{e})}{N_{e}^{2}}-\frac{1}{N_{ e}}+1\right)-1.\]

Again, in the absence of common mode noise \(\Omega\) is zero, but defined in this way the sensitivity actually increases with threshold, as shown in figure 3.

## 3 Application of Methods to an SCT Module

The two methods described in the previous section have been applied to six modules operated on the sector at the system test. The results for one of the modules are discussed here though similar results were obtained using the others. It is known that coherent noise effects in this system are small and so common mode noise was created by injecting a 10 MHz sine wave signal into the shield that surrounds the system. It is assumed that the noise measured without this injection is purely random. The S-curve for every channel of each of the twelve chips was measured with and without the noise injection and the results averaged by chip, to give the total noise \(\sigma_{T}\) and the random noise \(\sigma_{R}\) for each chip respectively. The quadratic difference between these noise measurements gives a measure of the size of the common mode noise pick-up in each chip, \(\sigma_{C}\), from \(\sigma_{C}^{2}=\sigma_{T}^{2}-\sigma_{R}^{2}\). These three quantities are plotted by chip in figure 4. The error bars reflect an estimated \(\pm 25\) ENC error on the measured S-curve noise values.

The correlation matrices obtained for each of the 12 chips with noise injection are shown in figure 5. Bands of anti-correlation elements can be seen either side of the diagonal in these plots, which are thought to result from charge sharing between a strip and its neighbour. It is immediately obvious that the chips which showed the greatest noise pick-up have the greatest strip-strip correlations in occupancy.

The theory outlined in section 2 considers only a two-strip system. To obtain a figure for the noise pick-up within one chip therefore requires some average of the correlations between all the strip-pairs of that chip. This was obtained by measuring \(\overline{O_{A}(\tau)}(=\overline{O_{A}(\tau)})\) and \(\overline{O_{A\,B}(\tau)}\) and then calculating \(\overline{C_{A\,B}(\tau)}\) from

\[\overline{C_{A\,B}(\tau)}=\frac{\overline{O_{A\,B}(\tau)}-\overline{O_{A}( \tau)O_{B}(\tau)}}{\sqrt{\overline{O_{A}(\tau)}-O_{A}(\tau)^{2}}\sqrt{ \overline{O_{B}(\tau)}-\overline{O_{B}(\tau)^{2}}}}.\]

The theory predicts how the correlation should vary with the ratio of common

Figure 3: _The observable \(\Omega\) as a function of common mode noise, \(s\), for thresholds 0, 1, 2, 3\(\sigma\)_

Figure 5: _Correlation matrices seen with noise injection for all chips. The z- and y-axes indicate the channel number from 0 to 127 and the colour scale shows the amount of correlation._

and the statistical errors on the measurements of \(\overline{O_{A}}\) and \(\overline{O_{AB}}\), which worsen at higher thresholds requiring larger sample sizes as \(\tau\) is increased.

As with the correlation method, an iterative technique has to be employed to convert the measured values of \(\Omega\) into common mode noise values by chip, given the chip-averaged measured values of \(\sigma_{T}\). The results at thresholds up to 0.8 fC (1 000 000 events) are shown in figure 7.

Figure 6: _Common mode noise by chip from the correlation matrix method at 0.2, 0.4, 0.6 fC threshold._

Figure 7: _Common mode noise by chip from the \(\Omega\) method at 0.2, 0.4, 0.6, 0.8 fC threshold._

Results and Summary

Common mode noise in a system where the data is read out using a binary scheme can be measured in several ways. It leads to measurable correlations between the occupancies of groups of channels. Alternatively, the effect of coherent noise pick-up on the \(N_{e}\) distribution for a group of strips may be used to measure its magnitude. Either method relies only on information taken from the considered system in the presence of common mode noise; no bench mark \(s=0\) measurements are necessary for comparison.

The mathematical assumptions of both methods require that the thresholds for all channels in the chip under consideration be identical. This is achieved through a "trimming" procedure [5] in which the offsets for all channels within a chip are equalised. Since this is performed at the 1 fC nominal operating threshold for the SCT, and the gain is not precisely the same for all channels, the further the threshold is moved from 1 fC the less reliable the threshold becomes. Some variation of the results with threshold is therefore to be expected, with best estimate for the common mode noise being obtained with the threshold set as close as possible to 1 fC.

The correlation matrix method discussed here requires slow data taking and analysis routines, due to the need to read out the full hit pattern on an event by event basis. Above 0.6 fC the large number of events required to measure \(\overline{O_{AB}}\) with reasonable accuracy becomes prohibitive. Methods based on the occupancy per event, however, are much faster since they require only the total number of hit strips per event to be recorded. At high thresholds the \(\Omega\) method is therefore the most appropriate. Good agreement is seen between

Figure 8: _Input noise obtained from \(S\)-curves as a function of injected charge (averaged over whole module)._

the two methods and the shape of the distribution of the common mode noise across the chips is in agreement with that seen from the direct comparison of the random and total noises in each chip taken from their respective S-curves. However, the results from both methods tend to underestimate the common mode noise compared to this direct measurement. This may be explained by the different ways in which noise is measured. The S-curves whose widths give the total noise \(\sigma_{T}\) are obtained using 2 fC signals injected into the amplifiers, whereas no charge is deliberately injected when measuring \(\sigma_{C}\). Figure 8 shows the dependence of input noise on injected charge from S-curve measurements indicating a decrease in measured \(\sigma_{T}\) with smaller injected charge. This effect is not yet understood but can explain the difference between the common mode noise methods and the S-curve measurements.

## 5 Acknowledgements

Useful discussions with Shaun Roe are gratefully acknowledged.

## References

* Inner Detector, CERN/LHCC/97-16 and CERN/LHCC/97-17 (1997).
* [2] L. Feld et al., Nuclear Intr. Meth. A487 (2002) 557.
* [3] P. Bell et al, _The ATLAS Semiconductor Barrel System Test_, to be submitted as ATLAS note.
* ASICs, SCT-BM-FRD-5.4 (2001).
* [5] P. W. Phillips, _Operation of Barrel Modules_, to be submitted to EDMS.
* [6] T. Kondo for the ATLAS SCT Collaboration, Nuclear Instr. Meth. A485 (2002) 27.