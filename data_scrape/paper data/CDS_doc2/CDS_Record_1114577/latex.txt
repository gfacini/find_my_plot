**Treatment of energy loss and multiple scattering in the context of track parameter and covariance matrix propagation in continuous material in the ATLAS experiment**

E. Lund\({}^{*,1}\), L. Bugge\({}^{1}\), E. W. Hughes\({}^{2}\),

D. Lopez Mateos\({}^{2,3}\), A. Salzburger\({}^{4,5}\), A. Strandlie\({}^{1,6}\)

\({}^{1}\) _University of Oslo, Oslo, Norway_

\({}^{2}\) _Columbia University, New York, USA_

\({}^{3}\) _California Institute of Technology, Pasadena, USA_

\({}^{4}\) _CERN, Geneva, Switzerland_

\({}^{5}\) _Leopold-Franzens Universitat, Innsbruck, Austria_

\({}^{6}\) _Gjovik University College, Gjovik, Norway_

\({}^{*}\) corresponding author (esben.lund@fys.uio.no)

**Abstract**

In this paper we study the energy loss, its fluctuations, and the multiple scattering of particles passing through matter, with an emphasis on muons. In addition to the well-known Bethe-Bloch and Bethe-Heitler equations describing the mean energy loss from ionization and bremsstrahlung respectively, new parameterizations of the mean energy loss of muons from the direct \(e^{+}e^{-}\) pair production and photonuclear interactions are presented along with new estimates of the most probable energy loss and its fluctuations in the ATLAS calorimeters. Moreover, a new adaptive Highland/Moliere approach to finding the multiple scattering angle is taken to accomodate a wide range of scatterer thicknesses. Furthermore, tests of the muon energy loss, its fluctuations, and multiple scattering are done in the ATLAS calorimeters. The material effects described in this paper are all part of the _simultaneous track and error propagation_ (STEP) algorithm of the common ATLAS tracking software.

Introduction

Experimental particle physics is on the verge of a new era, heralded by the Large Hadron Collider being commissioned at the European Organization for Nuclear Research -- CERN -- located just outside Geneva, Switzerland. The LHC accelerator will collide protons at a center of mass energy of 14 TeV, opening up a new window for particle discoveries and precision measurements of existing theories. Particle detectors are located at four beam crossings along the LHC, one of which houses the ATLAS detector [1]. This is the largest of the LHC experiments, employing a great variety of detector and magnetic field technologies to identify a wide range of particles. The complex magnetic field and high collision rate, however, make the reconstruction of particle tracks very challenging. Things are complicated further by the relatively big amount of material within the 7000-ton ATLAS detector, generating considerable disturbances to the particle tracks through material interactions such as energy loss and multiple scattering.

Track parameter and covariance matrix propagation -- the so-called error propagation -- is an important part of any track reconstruction algorithm. Due to the high amount of material in the ATLAS detector, energy loss and multiple scattering have to be accurately accounted for in the track reconstruction. One common way of handling these material effects is by layer-based track parameter updates. This involves making point-like updates to the track parameters and covariance matrix at predefined surfaces by using parameterizations of the detector material surrounding these surfaces. This approach is especially useful when the detector material is naturally layered, such as in the ATLAS inner detector. Another strategy involves treating the material effects continuously during the propagation of the track parameters and covariance matrix. This is the approach taken by the STEP algorithm, and it is most useful in large dense volumes with a relatively uniform mass distribution, such as those found in the ATLAS calorimeters.

Since muons are the only particles exposed to a substantial energy loss in the detector without being stopped, extra care is taken when calculating their energy loss. In addition to the well-known Bethe-Bloch [2] and Bethe-Heitler [3] equations describing the mean energy loss from ionization and bremsstrahlung respectively, new parameterizations of the mean energy loss of muons from the direct \(e^{+}e^{-}\) pair production and photonuclear interactions are presented along with new estimates of the most probable energy loss and its fluctuations in the ATLAS calorimeters. Furthermore, a new adaptive Highland/Moliere [4, 5, 6] approach to finding the multiple scattering angle is taken to accomodate a wide range of scatterer thicknesses.

In Section 2 we describe the mean energy loss of particles going through matter, followed by a comparison of these values to those found by the simulation toolkit GEANT4 [7] in Section 2.4, and a short study of the mean energy loss in the ATLAS calorimeters in Section 2.5. In Section 3 and 4 we present new estimates of the most probable energy loss and energy loss fluctuations of muons in the ATLAS calorimeters. Moreover, we discuss the multiple scattering angle and contribution to the covariance matrix in Section 5. Furthermore, we perform statistical tests of the multiple scattering covariance contribution in a single volume (Section 5.3), and in the ATLAS calorimeters (Section 5.4). The additional computing cost of including the material effects is presented in Section 6. Finally, we give a brief conclusion in Section 7, followed by the properties of the STEP algorithm in Appendix A, and the derivation of the multiple scattering \(\lambda\) variance in Appendix B.

Much attention is given to the material interactions in the ATLAS calorimeter since this is the main source of such interactions in the ATLAS detector. Natural units (\(\hbar=c=1\)) are used throughout this paper, and vectors and matrices are generally given in bold italic and bold capital letters, respectively.

Mean energy loss

The energy loss drains particles of energy, possibly stopping them, and in the presence of a magnetic field, the energy loss changes the path of charged particles by reducing their momenta. Energy loss is caused by ionization of the material and radiation by the incident particle, and its fluctuations -- the so-called straggling -- might be significant, especially at low momenta and for electrons. Straggling introduces uncertainties into the covariance matrix, which are described in Section 4. At high energies, the dominant radiative effects are bremsstrahlung, direct \(e^{+}e^{-}\) pair production and the photonuclear interactions. Only the mean energy loss from ionization and bremsstrahlung is treated here, except in the case of muons.

### Mean energy loss from ionization, the Bethe-Bloch equation

The mean energy loss from ionization of the material is given by the Bethe-Bloch equation [2];

\[\left(\frac{dE}{ds}\right)_{\rm ionization}=-Kz^{2}\frac{Z\rho}{A\beta^{2}} \left(\frac{1}{2}\ln\frac{2m_{e}\beta^{2}\gamma^{2}T_{\rm max}}{I^{2}}-\beta ^{2}-\frac{\delta}{2}\right) \tag{1}\]

where \(K\) is a constant, \(z\) is the charge of the incident particle, and \(A\) and \(Z\) are the atomic mass and number of the material. The variable \(I\) is the mean excitation energy, and \(\rho\) is the density of the material. The variable \(T_{\rm max}\) is the maximum kinetic energy which can be imparted to a free electron in a single collision

\[T_{\rm max}=\frac{2m_{e}\beta^{2}\gamma^{2}}{1+2\gamma m_{e}/m+(m_{e}/m)^{2}} \tag{2}\]

with the kinematic variables \(\beta\) and \(\gamma\) given by \(\beta\equiv v=p/E\) and \(\gamma\equiv 1/\sqrt{1-\beta^{2}}=E/m\), where \(m\) is the rest mass of the incident particle and \(E=\sqrt{p^{2}+m^{2}}\). The density effect \(\delta\) is given by

\[\frac{\delta}{2}=\ln(28.816\frac{\sqrt{\rho Z/A}}{I})+\ln\beta\gamma-1/2 \tag{3}\]

for \(\gamma\) above 10, which corresponds to a momentum of around 1 GeV for muons. For momenta below this, the density effect becomes small and is therefore ignored. The mean excitation energy \(I\) is highly influenced by the internal structure of the atom, especially the number of electrons in the outer shell. Finding a good approximation, valid for all atoms, is difficult. Here we estimate \(I\) with the simple equation

\[I=16Z^{0.9} \tag{4}\]

For relativistic electrons we use a slightly different Bethe-Bloch equation [8];

\[\left(\frac{dE}{ds}\right)^{\rm electrons}_{\rm ionization}=-K\frac{Z\rho}{A} \left(\ln\frac{2m_{e}}{I}+1.5\ln\gamma-0.975\right) \tag{5}\]

### Mean energy loss from bremsstrahlung, the Bethe-Heitler equation

The mean energy loss from bremsstrahlung for relativistic particles is given by the Bethe-Heitler equation [3];

\[\left(\frac{dE}{ds}\right)_{\rm bremsstrahlung}=-\frac{E}{X_{0}}\left(\frac{m_{e}} {m}\right)^{2} \tag{6}\]

where \(X_{0}\) is the radiation length of the material traversed.

Mean energy loss from the direct \(e^{+}e^{-}\) pair production and photonuclear interactions of muons

The mean energy loss from the direct \(e^{+}e^{-}\) pair production and photonuclear interactions of muons is parameterized by using the muon tables found in Ref. [9];

\[\left(\frac{dE}{ds}\right)^{E\in(8\text{ GeV},1\text{ TeV})}_{\text{ pair prod. + ph. i.}} =0.5345\frac{1}{X_{0}}-6.803\cdot 10^{-5}\frac{E}{X_{0}}-2.278\cdot 10^{-11} \frac{E^{2}}{X_{0}}+9.899\cdot 10^{-18}\frac{E^{3}}{X_{0}} \tag{7}\] \[\left(\frac{dE}{ds}\right)^{E\in[1\text{ TeV},\rightarrow)}_{ \text{pair prod. + ph. i.}} =2.986\frac{1}{X_{0}}-9.253\cdot 10^{-5}\frac{E}{X_{0}} \tag{8}\]

with the energy given in MeV and the radiation length in mm. The linear parameterization above 1 TeV is applied to avoid any scaling problems at "infinite" momenta. The tables of Ref. [9] are based on an extensive study of the muon energy loss and contain details on all of the energy loss processes mentioned in this paper. The mean energy loss from the pair production and photonuclear interactions is exaggerated to compensate for the underestimated bremsstrahlung found by the Bethe-Heitler equation (6), and it is negligible for muon energies below 8 GeV.

### Total mean energy loss

Adding the mean energy loss from ionization, bremsstrahlung and, in the case of muons, the direct \(e^{+}e^{-}\) pair production and photonuclear interactions, we get the total mean energy loss per unit distance

\[g=\left(\frac{dE}{ds}\right)_{\text{ionization}}+\left(\frac{dE}{ds}\right)_{ \text{bremsstrahlung}}+\left(\frac{dE}{ds}\right)^{\text{ muons}}_{\text{pair production and photonuclear interactions}} \tag{9}\]

This mean energy loss causes a change in the \(\lambda\equiv q/p\) of the incident particle given by [10]

\[\frac{d\lambda}{ds}=-\frac{\lambda^{3}gE}{q^{2}} \tag{10}\]

which is used by the STEP algorithm [11] for calculating \(\lambda\) in the equation of motion

\[\frac{d^{2}\mathbf{r}}{ds^{2}}=\frac{q}{p}\left(\frac{d\mathbf{r}}{ds}\times\mathbf{B}( \mathbf{r})\right)=\lambda(\mathbf{T}\times\mathbf{B}(\mathbf{r})) \tag{11}\]

where \(\mathbf{T}=d\mathbf{r}/ds\) is the normalized tangent vector to the track and \(\mathbf{B}(\mathbf{r})\) is the magnetic field.

The total mean energy loss of muons found by STEP is compared to that of the tables found in Ref. [9] and the mean values calculated by GEANT4 in Fig. 1. The small bumps around 1 GeV are from the underestimation of the density effect (3) at momenta of a few GeV.

### Testing the mean energy loss of muons in the ATLAS calorimeters

Figure 2 shows the mean energy loss of muons in the ATLAS electromagnetic and hadronic calorimeters as a function of the absolute pseudorapidity (\(|\eta|\)) for muons of momenta 10, 100 and 1000 GeV. The histograms are simulated by GEANT4 in the full detector description, while the points are found by STEP in the dense volumes of the calorimeter tracking geometry [12] by using the test setup described in Ref. [13]. All of the \(|\eta|\) distributions presented in this paper are averaged over \(\phi\). The material in the electromagnetic calorimeter amounts to around 30 \(X_{0}\), while the hadronic calorimeter adds another 100 \(X_{0}\) to that. The holes in the STEP mean energy loss around \(|\eta|\approx 0.8\) in Fig. 2 are probably caused by an insufficient description of the inactive material -- such as the liquid Argon cryostats and the inner detector services -- in the dense volumes of the calorimeter tracking geometry in these regions, illustrated in Fig. 3.

## 3 Most probable energy loss of muons in the ATLAS calorimeters

The energy loss is Landau distributed with a relatively low most probable (peak) value and a tail going towards the higher energies, making the most probable value smaller than the mean energy loss, Fig. 4. This split between the mean and the most probable energy loss increases with the energy. A good approximation of the most probable energy loss is achieved by reducing the mean ionization and radiative energy loss by 10% and 85% respectively, Fig. 5. The mean and most probable energy loss are toggled by a property described in Appendix A, with the most probable energy loss as the default setting. Although the mean energy loss becomes three times higher than the most probable value at muon momenta of 1 TeV, the mean energy loss is still only 1.5% of the muon momentum, significantly less than the momentum resolution at this energy. At momenta below 100 GeV-- where the energy loss and its fluctuations matter most -- the difference between the mean and most probable energy loss is relatively small.

## 4 Energy loss fluctuations of muons in the ATLAS calorimeters

The energy loss of particles fluctuates considerably, especially for light particles such as electrons. These fluctuations also reduce the energy resolution of muons below 100 GeV significantly. Since the energy loss is Landau distributed, analytical calculations of the fluctuations are difficult, so here we use the following parameterization to estimate the Landau width of the energy loss fluctuations of muons going

Figure 1: Mean energy loss of muons in Iron, Silicon and liquid Argon. The photonuclear interactions are not included into the GEANT4 simulation, while they are bundled with the pair production in the STEP algorithm.

through the ATLAS calorimeters;

\[E_{\rm loss}^{\sigma}=\sqrt{\frac{as\rho KZ}{2A\beta^{2}}} \tag{12}\]

where \(s\) is the traversed distance in mm and \(a\) is given by

\[a=121+3.9\cdot 10^{-3}E+5.3\cdot 10^{-9}E^{2} \tag{13}\]

with the energy given in MeV. Figure 6 shows the Landau width of the energy loss fluctuations of muons going through the ATLAS calorimeters as given by the above parameterization and GEANT4. The Landau width can be scaled by a property described in Appendix A. Given the above Landau width, the noise contribution to the \(\lambda\) variance of the covariance matrix becomes

\[\mbox{Var}(\lambda)=\frac{(E_{\rm loss}^{\sigma})^{2}}{\beta^{2}p^{4}} \tag{14}\]

In case of large relative energy losses, the volume is sliced. This is possible because the straggling variance parameterization is proportional to the traversed distance \(s\), hence fulfilling the convolution property; the variance of the combined straggling of all of the slices of a volume is independent of the chosen number of slices. For reasons of simplicity these slices are shared with -- and described in -- the

Figure 2: Mean energy loss of muons going through the ATLAS hadronic and electromagnetic calorimeters. The points correspond to the mean values calculated by the STEP algorithm in the dense volumes of the calorimeter tracking geometry, while the histograms represent the mean energy loss simulated by GEANT4 in the full detector description.

multiple scattering calculation, Section 5. Because the real energy loss fluctuations do not scale linearly with \(s\), the above straggling estimate -- which is a fit to the energy loss fluctuations of muons going through the whole ATLAS calorimeter -- does not describe the fluctuations through the electromagnetic calorimeter very well.

## 5 Multiple scattering

The multiple scattering causes random angular deflections to the track path with an average projected deflection of zero. Because the mean projected deflection is zero, the multiple scattering does not affect the unbiased track estimate. It does, however, introduce correlations and a loss of resolution in the track parameters, which must be reflected in the covariance matrix \(\mathbf{\Sigma}\). This is done by adding the noise contribution from the multiple scattering to the transported covariance matrix. The linear error propagation [14] then becomes

\[\mathbf{\Sigma}_{\text{final}}=\mathbf{J}\cdot\mathbf{\Sigma}_{\text{initial}}\cdot \mathbf{J}^{\text{T}}+\mathbf{\Sigma}_{\text{multiple scattering}} \tag{15}\]

where \(\mathbf{J}\) is the transport Jacobian.

Figure 4: Energy loss of muons with \(|\eta|<0.15\) going through the ATLAS calorimeters, as found by GEANT4 in the full detector description. Fits to Landau distributions are also shown.

Figure 3: Schematic of the transition region between the barrel and end-cap cryostats, where additional scintillator elements are installed to provide corrections for the energy lost in the inactive material (not shown) of the gap, such as the liquid Argon cryostats and the inner detector services. (From Ref. [1]).

### Finding the scattering angle

The most widely known model of multiple scattering is due to Moliere [4, 5], giving the projected scattering angle \(\theta_{p}\) width as

\[\sigma_{M}(\theta_{p})=\frac{15}{\beta p}\sqrt{\frac{s}{X_{0}}} \tag{16}\]

where \(s\) is the traversed distance, \(X_{0}\) is the radiation length of the material and the momentum is given in MeV. The scattering angle \(\theta_{s}\) and its projection \(\theta_{p}\) are illustrated in Fig. 7. The Moliere model is based on a linear, Gaussian approach to the multiple scattering. Besides its simplicity, it also fulfills the convolution property; the variance of the combined scattering angles of all of the slices of a volume is independent of the chosen number of slices. This property is fulfilled by the Gaussian Moliere model because the variance is strictly proportional to the traversed distance \(s\). In a simulation program where the number and thickness of slices is flexible, fulfilling the convolution property becomes very important. Slicing of a volume may also be required when the energy loss becomes significant.

The popular Highland scattering model [6] is a fit to the Moliere distribution of singly charged particles, assuming \(\beta=1\). The Highland model is easily generalized [15] to allow for \(\beta\) less than one by including \(1/\beta^{2}\) in the logarithm, giving

\[\sigma_{H}(\theta_{p})=\frac{13.6}{\beta p}\sqrt{\frac{s}{X_{0}}}\left(1+0.03 8\ln\frac{s}{\beta^{2}X_{0}}\right) \tag{17}\]

Figure 5: Most probable energy loss of muons going through the ATLAS hadronic and electromagnetic calorimeters. The points correspond to the most probable values calculated by the STEP algorithm in the dense volumes of the calorimeter tracking geometry, while the histograms represent the most probable values of the Landau fits of each \(|\eta|\) bin of the GEANT4 simulations in the full detector description.

This expression is only better than the original Moliere model as long as slicing the volume is not required since the Highland formula does not fulfill the convolution property, giving a smaller combined scattering angle variance with an increasing number of slices within a given volume.

Projected scattering angle widths of both models are shown along with the width from the GEANT4 simulation in the top left plot of Fig. 8. The GEANT4 multiple scattering uses a modified Highland formula and around 100 steps (slices) for the simulation, whereas the Moliere and Highland widths are calculated for the whole volume in one go (one slice), assuming no energy loss. The Highland formula agrees well with the GEANT4 simulation for distances less than 2 \(X_{0}\), corresponding to a 5% energy loss for a muon having a momentum of 1 GeV. Going through additional material, the scattering is significantly increased by the energy loss. The only parameter of the Highland formula varying substantially during the propagation is the momentum, implying a breakdown of the single layer Highland approach at a 5% energy loss regardless of \(X_{0}\) and \(s\).

The top right plot of Fig. 8 shows different applications of the Moliere and Highland scattering. The first two lines show the widths found within STEP by using 10 slices, assuming a constant momentum in each slice. The Moliere scattering shows good agreement with GEANT4 above 2 \(X_{0}\), whereas the Highland scattering is underestimated across the whole range due to the convolution problem. The next two lines show the widths obtained by the simple simulation described in Section 5.3. The simulation slices the volume into equally thick layers before successively traversing them, while using the Moliere

Figure 6: Energy loss fluctuations of muons going through the ATLAS hadronic and electromagnetic calorimeters. The points correspond to the parameterization applied by the STEP algorithm in the dense volumes of the calorimeter tracking geometry, while the histograms represent the width of the Landau fits of each \(|\eta|\) bin of the GEANT4 simulations in the full detector description.

or Highland formula to calculate the scattering in each layer. Scattering angles are pulled randomly from Gaussian distributions of widths given by the formulae. The Moliere simulation is in good agreement with STEP, whereas the Highland simulation is underestimated. Reducing the number of layers of the Highland simulation to the same as that used by STEP (line five in the plot) brings these into agreement, clearly demonstrating how an increased number of slices within the same volume reduces the combined Highland scattering angle variance, hence violating the convolution property.

The bottom left plot of Fig. 8 shows the final solution chosen for the projected scattering angle width in STEP. This solution draws on two lessons from the above plots; the single slice Highland formula does well below a 5% energy loss, while the multiple Moliere layers perform well above. To find the width, the STEP algorithm first checks whether the energy loss is above 5%, in which case it applies multiple Moliere layers, else the width is calculated by the single layer Highland formula by using the average momentum along the track. In the first case, the number of Moliere layers is given by the energy loss (in percent) divided by 5% and rounded up, such that a 6% energy loss gives 2 layers and an 11% loss gives 3 layers. Testing shows that the combined scattering angle width converges at around 10 Moliere layers regardless of the energy loss, which is therefore the maximum number of layers used by STEP.

Figure 9 shows four examples of projected scattering angle distributions given by the GEANT4 and Moliere simulations. The Moliere models' tendency to overestimate the scattering in thin layers is clearly seen. The STEP widths are included for comparison and show good agreement with the GEANT4 simulations.

### Setting up the multiple scattering covariance contribution

Dividing the volume into layers normal to the track, the estimated multiple scattering covariance contribution from each layer [16] -- in the curvilinear coordinate system to be defined below -- by using the local track parameters \(\boldsymbol{\xi}=(l_{0},l_{1},\phi,\theta,\lambda)\) is

\[\boldsymbol{\Sigma}_{\text{ms}}^{\text{one layer}}=\text{Var}(\theta_{p}) \left[\begin{array}{cccc}\frac{s}{2}+sd+d^{2}&0&\frac{s}{2\sin\theta}+\frac{d }{\sin\theta}&0&0\\ 0&\frac{s}{3}+sd+d^{2}&0&-\frac{s}{2}-d&0\\ \frac{s}{2\sin\theta}+\frac{d}{\sin\theta}&0&\frac{1}{\sin^{2}\theta}&0&0\\ 0&-\frac{s}{2}-d&0&1&0\\ 0&0&0&0&3s^{2}(\frac{d\lambda}{ds})^{2}\text{Var}(\theta_{p})\end{array}\right] \tag{18}\]

Figure 7: The multiple scattering of a particle going through a slab of material of thickness \(s\). The particle is scattered by an angle \(\theta_{s}\) in space, which is projected into a plane to find the projected scattering angle \(\theta_{p}\).

where \(s\) is the thickness of the layer, \(d\) is the remaining distance along the track path from the end of the layer to the target surface, and \(d\lambda/ds\) is the energy loss given in Eq. (10). The local track parameters \(\mathbf{\xi}\) are defined in the ATLAS event data model [17] by the local track position at a surface (\(l_{0},l_{1}\)) and the global track momentum (\(\phi,\theta,\lambda\)), while the orthonormal right-handed curvilinear coordinate system is defined by the three axes; \(\mathbf{U}\), \(\mathbf{V}\) and \(\mathbf{T}\). The axis \(\mathbf{T}\) is parallel to the particle momentum, while the axes \(\mathbf{U}\), \(\mathbf{V}\), defined as

\[\mathbf{U}=\frac{\mathbf{Z}\times\mathbf{T}}{\|\mathbf{Z}\times\mathbf{T}\|}\quad\text{ and }\quad\mathbf{V}=\mathbf{T}\times\mathbf{U} \tag{19}\]

are normal to the momentum. The vector \(\mathbf{Z}\) is given by the global \(z\)-axis.

The multiple scattering covariance contribution is based on a linear, Gaussian approach, with all of the layers calculated in the same curvilinear system set up in the direction of the initial momentum. Therefore the \(\mathbf{\theta}\) angle in the covariance contribution is given by the initial \(\theta\) throughout all of the layers. All of the elements of the covariance contribution, except the \(\lambda\) variance, are given in Ref. [16], and their widths can be scaled by a property described in Appendix A. The small differences between some of the terms given in the reference and those presented here, are all due to the different coordinate systems used. The \(\lambda\) variance, derived in Appendix B, comes from the variation in the energy loss introduced by the variation of the path length due to the multiple scattering.

The total scattering covariance contribution is the sum of the covariance contribution matrices (18) of all of the scattering layers. Before adding the total scattering contribution -- given in the curvilinear system -- to the transported covariance (15), it is transformed into the local coordinate system given at the target surface. To account for the variation in the energy loss caused by the combination of the variation of the path length -- due to the multiple scattering -- and the tilted target surface, we add two

Figure 8: Projected scattering angle widths of 1 GeV muons passing through Iron.

elements to the cuvilinear to local Jacobian [18];

\[\frac{\partial\lambda^{\text{loc}}}{\partial l_{0}^{\text{curv}}}=-\frac{\mathbf{U} \cdot\mathbf{I}}{\mathbf{T}\cdot\mathbf{I}}\left(\frac{d\lambda}{ds}\right)\quad\text{ and}\quad\frac{\partial\lambda^{\text{loc}}}{\partial l_{1}^{\text{curv}}}=- \frac{\mathbf{V}\cdot\mathbf{I}}{\mathbf{T}\cdot\mathbf{I}}\left(\frac{d\lambda}{ds}\right) \tag{20}\]

where \(\mathbf{I}\) is the unit vector normal to the target plane, defining one axis of the local coordinate system at the target surface.

The multiple scattering is calculated separately after the propagation is done, making it independent of the error tolerance. The error tolerance is a user specified number steering the accuracy of the propagation [11], a low error tolerance giving a high accuracy, and vice versa. The multiple scattering contribution is only found once for every successful propagation, hence the computing cost is small, as seen in Fig. 16. It can be switched off by using one of the properties mentioned in Appendix A.

Statistical validation of the multiple scattering through a simple Monte Carlo simulation in a single volume

The stochastic multiple scattering process can be tested by using a Monte Carlo simulation, which is done by slicing a dense volume into equally thick layers normal to the track before successively traversing them while the momentum is deflected by a random spatial scattering angle \(\theta_{\text{s}}\) at the end of each layer, Fig. 10. This angle is picked from a Gaussian distribution with a width given by the Moliere formula (16) multiplied by \(\sqrt{2}\) to go from the projected to the spatial scattering angle

\[\sigma(\theta_{\text{s}})=\sqrt{2}\sigma_{M}=\frac{21.2132}{\beta p}\sqrt{ \frac{s}{X_{0}}} \tag{21}\]

Figure 9: Projected scattering angles found by the GEANT4 and Molière simulations (100 slices), and their Gaussian fits. The STEP widths are also given for comparison.

The test setup involves propagating muons in random directions, covering all azimuthal and polar angles at momenta ranging from 500 MeV to 500 GeV, starting off from an initial surface located at the interaction point of the ATLAS detector. The muons are propagated through Iron in the realistic ATLAS magnetic field, towards a target surface randomly placed and rotated in a cube with sides of 20 m centered in the detector. All of the propagation is done by STEP at an error tolerance of \(10^{-8}\) to assure the quality of the tracks. 100 000 muon tracks are generated to produce around 34 000 successfully simulated tracks.

In the simulation, each track is propagated twice to produce the undisturbed \(\boldsymbol{\mu}\) and scattered \(\boldsymbol{\xi}\) local track parameters at the target surface. The \(\boldsymbol{\xi}-\boldsymbol{\mu}\) residuals are then statistically compared to the total scattering contribution \(\boldsymbol{\Sigma}_{\text{ms}}\) by using the _pull values_

\[\hat{\xi_{i}}^{j}_{i}=\frac{\xi_{i}^{j}-\mu_{i}^{j}}{\sqrt{\Sigma_{\text{ms},i }^{jj}}} \tag{22}\]

and the _chi-square_

\[\chi_{i}^{2}=(\boldsymbol{\xi}_{i}-\boldsymbol{\mu}_{i})^{\text{T}}\cdot \boldsymbol{\Sigma}_{\text{ms},i}^{-1}\cdot(\boldsymbol{\xi}_{i}-\boldsymbol{ \mu}_{i}) \tag{23}\]

with \(i\) indicating the simulated tracks and \(j\) the track parameters.

Since \(\boldsymbol{\xi}\) are Gaussian distributed around \(\boldsymbol{\mu}\) in the simulation, the pull values are Gaussian distributed around zero. Moreover, if the scattering contribution is correct, the width of the pull values should be normalized to one. The pulls presented in Fig. 11 show good agreement between the total multiple scattering covariance contribution found by STEP and the simulation. The small discrepancy in the \(\lambda\) pull mostly comes from shortcuts taken in the derivation of the scattering \(\lambda\) variance (Appendix B), and from missing elements in the curvilinear to local Jacobian applied when going from the curvilinear scattering system to the local system at the target surface.

Whereas the pull values are calculated for each parameter of the simulated track, the chi-square incorporates the whole scattering contribution and all of the track parameters. Assuming that the scattered track parameters \(\boldsymbol{\xi}\) are Gaussian distributed around \(\boldsymbol{\mu}\), and that these distributions obey the variances and correlations given by the scattering contribution, the test chi-square distribution should be similar to the standard chi-square distribution corresponding to five degrees of freedom. By integrating the standard chi-square distribution from the test chi-square to infinity, we get the so-called _p-value_, or probability value of this test statistic. If the test chi-square distribution is correct, the p-value plot is flat, as seen in Fig. 11.

Figure 10: The multiple scattering is simulated by deflecting the track a random spatial angle \(\theta_{\text{s}}\) at layers normal to the track.

### Statistical validation of the multiple scattering of muons in the ATLAS calorimeters

In this Section we repeat the exercise of Section 5.3 in the ATLAS calorimeters by using the test setup described in Ref. [13]. Figure 12 and 13 show the pulls and p-values of 10 GeV muons simulated by GEANT4 in the full detector description -- including energy loss and multiple scattering -- and statistically compared to the combined STEP multiple scattering and straggling covariance contribution. Figure 12 presents muons going through the electromagnetic calorimeters, while Fig. 13 shows muons going through both the electromagnetic and hadronic calorimeters. The \(l_{0},l_{1},\phi\) and \(\theta\) pulls are related to the multiple scattering, whereas the \(\lambda\) pull is mostly related to the straggling. Because the straggling does not scale linearly with the traversed distance it is tuned to muons going through the whole calorimeter (Fig. 13), and hence does not describe the straggling of muons only passing through the electromagnetic calorimeter very well (Fig. 12).

Figure 14 and 15 show the \(l_{0},l_{1},\phi\) and \(\theta\) pulls of 100 GeV and 1 TeV muons passing through both the electromagnetic and hadronic calorimeters, including all of the material interactions. However, since the muon straggling in the calorimeters is discussed in Section 4, we choose to focus on the pulls related

Figure 11: Pulls and p-values of simulated tracks subjected to multiple scattering in a single volume, and their fits (solid lines). The plots are made by using the multiple scattering covariance contribution found by STEP.

to the multiple scattering in these figures.

The width of the elements of the multiple scattering covariance contribution and the Landau width of the straggling are scaled by 1.5 and 4.7, respectively, in Figs. 12 - 15. Both scales can be set through the properties described in Appendix A.

## 6 Additional computing cost of including the material effects

Figure 16 shows the additional computing cost -- relative to the STEP parameter propagation -- of including the energy loss, multiple scattering and straggling, as a function of the error tolerance. The energy loss per unit distance varies little within each recursion step of the integration method, hence the value found at the beginning of each step is used throughout the step. This lowers the computing cost considerably. The computing cost is increased by around 30% by the energy loss and around 10% by the multiple scattering and straggling over the whole error tolerance range.

Figure 12: Pulls and p-values of 10 GeV muons subjected to multiple scattering and energy loss fluctuations in the ATLAS electromagnetic calorimeter, and their fits (solid lines). The track residuals are simulated by GEANT4 in the full detector description, while the covariance scattering and straggling contribution is found by STEP in the dense volumes of the calorimeter tracking geometry.

## 7 Conclusion

In this paper some simple, yet precise, solutions to the energy loss, straggling and multiple scattering of particles in dense material have been presented, focusing on muons. Simulations performed with GEANT4 are in good agreement with these solutions. The computing cost increase -- relative to the STEP parameter propagation -- is around 30% by including the energy loss into the propagation, and around 10% by adding the multiple scattering and straggling contribution to the covariance matrix, over the whole error tolerance range.

All of the material interactions presented in this paper are part of the STEP algorithm, found in the TrkExtrapolation package of the ATLAS CVS repository. The properties available for steering the STEP algorithm are described in Appendix A.

Figure 13: Pulls and p-values of 10 GeV muons subjected to multiple scattering and energy loss fluctuations in the ATLAS hadronic and electromagnetic calorimeters, and their fits (solid lines). The track residuals are simulated by GEANT4 in the full detector description, while the covariance scattering and straggling contribution is found by STEP in the dense volumes of the calorimeter tracking geometry.

## 8 Acknowledgements

This work has been carried out as part of the developments of the ATLAS tracking group. We would like to thank our colleagues for their help in integrating the software and for their support in preparing this note.

## Appendix A Properties of the STEP algorithm

The STEP algorithm has 13 properties -- with the default values given in the parentheses -- accessible in the jobOptions:

**Tolerance (\(10^{-5}\))**: Double-precision floating-point number used for controlling the accuracy of the propagation, a low error tolerance giving a high accuracy. The error tolerance is described in Ref. [11]. The default value is \(10^{-5}\), corresponding to an accuracy of around \(10^{-7}\).
**EnergyLoss (true)**: Boolean switch for including the energy loss into the propagation.
**MostProbableEnergyLoss (true)**: Boolean switch for using the most probable energy loss instead of the mean value.
**Straggling (true)**: Boolean switch for adding the energy loss fluctuations to the covariance matrix. The straggling is only included in combination with the energy loss.
**StragglingScale (6)**: Double-precision floating-point number used for scaling the Landau width of the energy loss fluctuations.

Figure 14: Pulls of 100 GeV muons subjected to multiple scattering in the ATLAS hadronic and electromagnetic calorimeters, and their Gaussian fits (solid lines). The track residuals are simulated by GEANT4 in the full detector description, while the covariance scattering contribution is found by STEP in the dense volumes of the calorimeter tracking geometry.

**MultipleScattering (true)**: Boolean switch for adding the multiple scattering contribution to the covariance matrix.
**MultipleScatteringScale (1)**: Double-precision floating-point number used for scaling the width of the elements of the multiple scattering covariance contribution.
**MaterialEffects (true)**: Boolean switch for excluding the material interactions of energy loss, straggling and multiple scattering from the propagation. When false, this switch overrides the MultipleScattering, EnergyLoss and Straggling switches, setting them all to false, whereas when true, control is left to the individual switches.
**IncludeBgradients (true)**: Boolean switch for including the magnetic field gradients \(\partial B_{i}/\partial x_{j}\) into the error propagation. The magnetic field gradients are described in Ref. [14].
**IncludeGgradient (false)**: Boolean switch for including the energy loss gradient \(\partial g/\partial\lambda\) into the error propagation. The energy loss gradient is described in Ref. [14].
**MomentumCutOff (50 MeV)**: Double-precision floating-point number giving the smallest acceptable momentum of a propagated particle. If the energy loss is switched on and the momentum goes below this value, the propagation is stopped. The Bethe-Bloch calculation breaks down at low momenta, hence the default cut-off is set to 50 MeV.
**MaxPath (100 000 mm)**: Double-precision floating-point number defining the maximum allowed path length of the propagation, given in mm.

Figure 15: Pulls of 1 TeV muons subjected to multiple scattering in the ATLAS hadronic and electromagnetic calorimeters, and their Gaussian fits (solid lines). The track residuals are simulated by GEANT4 in the full detector description, while the covariance scattering contribution is found by STEP in the dense volumes of the calorimeter tracking geometry.

**MaxSteps (10 000)**: Double-precision floating-point number giving the maximum allowed number of steps during the propagation.

## Appendix B Multiple scattering \(\lambda\) variance

The \(\lambda\) variance comes from the variation in the energy loss caused by the variation of the path length due to the multiple scattering. The new path \(s^{\prime}\) and the spatial scattering angle \(\theta_{s}\) are illustrated in Fig. 17.

To calculate the \(\lambda\) variance we start by observing that

\[d\lambda=\frac{d\lambda}{ds}ds\quad\text{ with }\quad ds=s^{\prime}-s \tag{24}\]

and

\[s^{\prime 2}=s^{2}+a^{2}\approx s^{2}+(s\theta_{s})^{2}=s^{2}(1+(\theta_{s}) ^{2}) \tag{25}\]

\[s^{\prime}=s\sqrt{1+(\theta_{s})^{2}}\approx s(1+\frac{1}{2}(\theta_{s})^{2}) =s+\frac{1}{2}s(\theta_{s})^{2} \tag{26}\]

giving

\[ds=s^{\prime}-s=\frac{1}{2}s(\theta_{s})^{2}\quad\text{ and }\quad d\lambda= \frac{d\lambda}{ds}\frac{1}{2}s(\theta_{s})^{2} \tag{27}\]

The \(\lambda\) variance then becomes

\[\text{Var}(\lambda)=\langle(d\lambda)^{2}\rangle=\frac{1}{4}s^{2}\left(\frac {d\lambda}{ds}\right)^{2}\langle(\theta_{s})^{4}\rangle \tag{28}\]

Figure 16: Additional computing cost — relative to the STEP parameter propagation — of including the energy loss, multiple scattering and straggling.

Figure 17: The changed trajectory \(s^{\prime}\) caused by the multiple scattering of a particle going through a layer.

which contains the fourth central moment of \(\theta_{s}\), defined as

\[\langle(\theta_{s})^{4}\rangle=\langle(\theta_{s}-\mu)^{4}\rangle=\frac{1}{\sqrt{ 2\pi\sigma_{s}^{2}}}\int_{-\infty}^{\infty}(\theta_{s}-\mu)^{4}e^{-\frac{( \theta_{s}-\mu)^{2}}{2\sigma_{s}^{2}}}d\theta_{s} \tag{29}\]

Noting that the mean angular deflection in a plane caused by the multiple scattering is zero (\(\mu=0\)), and that the integral is symmetric, we get

\[\langle(\theta_{s})^{4}\rangle=\frac{2}{\sqrt{2\pi\sigma_{s}^{2}}}\int_{0}^{ \infty}\theta_{s}^{4}e^{-\frac{\theta_{s}^{2}}{2\sigma_{s}^{2}}}d\theta_{s} \tag{30}\]

Solving this integral gives

\[\langle(\theta_{s})^{4}\rangle=\frac{2}{\sqrt{2\pi\sigma_{s}^{2}}}\frac{1}{2 }\left(\frac{1}{2\sigma_{s}^{2}}\right)^{-\frac{5}{2}}\Gamma\left(\frac{5}{2}\right) \tag{31}\]

Putting in \(\Gamma(5/2)=3\pi/4\) and contracting, we get

\[\langle(\theta_{s})^{4}\rangle=3\sigma_{s}^{4} \tag{32}\]

Going through the same procedure to find the second central moment of \(\theta_{s}\), also known as the \(\theta_{s}\) variance, we reassuringly find that

\[\langle(\theta_{s})^{2}\rangle=\mbox{Var}(\theta_{s})=\sigma_{s}^{2} \tag{33}\]

From this, and the fact that \(\mbox{Var}(\theta_{s})=2\mbox{Var}(\theta_{p})\), where \(\theta_{p}\) is the projected scattering angle, we conclude that

\[\langle(\theta_{s})^{4}\rangle=3\sigma_{s}^{4}=3(\sigma_{s}^{2})^{2}=3(\mbox {Var}(\theta_{s}))^{2}=3(2\mbox{Var}(\theta_{p}))^{2}=12(\mbox{Var}(\theta_{p} ))^{2} \tag{34}\]

The \(\lambda\) variance (28) finally becomes

\[\mbox{Var}(\lambda)=\frac{1}{4}s^{2}\left(\frac{d\lambda}{ds}\right)^{2} \langle(\theta_{s})^{4}\rangle=3s^{2}\left(\frac{d\lambda}{ds}\right)^{2}( \mbox{Var}(\theta_{p}))^{2} \tag{35}\]

which is the expression found in the covariance contribution (18).

## References

* [1] The ATLAS Collaboration, G. Aad _et al._, JINST **3** (2008) S08003.
* [2] Particle Data Group, C. Amsler _et al._, Phys. Lett. B **667** (2008).
* [3] H. A. Bethe and W. Heitler, Proc. R. Soc. London A **146** (1934) 83.
* [4] G. Moliere, Z. Naturforsch. **3A** (1948) 78.
* [5] H. A. Bethe, Phys. Rev. **89** (1953) 1256.
* [6] V. Highland, Nucl. Instr. Meth. **129** (1975) 497.
* [7] S. Agostinelli _et al._, Nucl. Inst. and Meth. A **506** (2003) 250.
* [8] D. Stampfer _et al._, Comp. Phys. Comm. **79** (1994) 157.
* [9] D. E. Groom _et al._, Atomic Data and Nuclear Data Tables **78** (2001) 183-356.
* [10] L. Bugge and J. Myrheim, Nucl. Inst. and Meth. **179** (1981) 365.