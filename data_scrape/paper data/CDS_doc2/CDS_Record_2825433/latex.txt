# Flavour Tagging Efficiency Parametrisations with Graph Neural Networks

The ATLAS Collaboration

The identification of jets containing \(b\)-hadrons is obtained through dedicated flavour-tagging algorithms and is crucial for the physics program of the ATLAS experiment. The performance of the flavour-tagging algorithm is such that the statistical precision of the simulated samples is reduced when flavour tagging is applied, in particular when requiring many tagged jets per event. The truth-flavour tagging approach aims at increasing the statistical power of the simulated samples after the event selection. The method is based on a per-event weighting, computed according to the probability for the given event to contain tagged jets. This note describes truth-flavour tagging based on efficiency maps and a novel implementation based on Graph Neural Networks. The second approach is demonstrated to also capture correlations among jets in the same event, improving the overall performance of the truth-flavour tagging method.

## 1 Introduction

The capability to identify jets originating from \(b\)- and \(c\)-quarks is a key ingredient for many physics analyses in ATLAS [1]. The sequence of algorithms used to perform this task is known as flavour tagging. The jets are tagged with multivariate algorithms exploiting specific properties of the \(b\)-hadron such as its decay, long lifetime, high mass and high decay multiplicity. These algorithms are trained and optimised on simulated data and calibrated with data enriched in a specific jet flavour [2].

The performance of a flavour-tagging algorithm is quantified by the efficiency \(\epsilon_{f}\) to select jets of a certain flavour \(f\) by only keeping those jets with the multivariate classifier output above a certain threshold:

\[\epsilon_{f}=\frac{\text{number of jets of flavour $f$ above a threshold}}{\text{number of jets of flavour $f$}}.\]

For \(c\)- and light-flavour jets the typical performance metric is the rejection, defined as \(1/\epsilon_{f}\). Operating points (OP) are defined as thresholds on the discriminant output, designed to provide a targeted efficiency for identifying \(b\)-jets. Four OPs are designed and calibrated in ATLAS to provide a well-defined \(b\)-jet efficiency and rejection against \(c\)- and light-flavour jets when applied to a sample of inclusive \(t\overline{t}\) events [2].

Due to the high rejection power against \(c\)- and light-flavour jets, many physics analyses suffer from inadequate statistics of the simulated background events after the application of the \(b\)-tagging requirement, especially in case of background processes enriched in light-flavour jets in the final state. This creates instabilities due to the limited statistics if physics analyses make use of such samples to model the distributions of one or more variables entering into the fit to data.

An alternative approach is based on weighting jets according to their probability of being tagged. This approach preserves the statistical power of the simulated samples and is referred to as truth-flavour tagging. This note describes truth-flavour tagging in ATLAS with emphasis on a new approach based on graph neural networks (GNNs). Results are presented in terms of the capability of truth-flavour tagging to model distributions of typical interest in physics analysis conducted in the boosted regime, but the method is completely generalisable in terms of both the flavour tagging and the jet reconstruction strategies.

This note is organised as follows: Section 2 describes the event samples used and the definitions of the reconstructed physics objects. Section 3 presents an overall description of truth-flavour tagging and its implementation based on efficiency maps. Section 4 focuses on the new approach of truth-flavour tagging based on GNNs, with details on the network architecture and the training procedure. Finally Section 5 presents a comparison of distributions when flavour tagging and truth-flavour tagging are applied. Additional results are reported in Appendix A.

## 2 Simulated event samples and object definitions

The studies presented in this note are based on Monte Carlo (MC) simulated \(t\overline{t}\) events and on the reconstruction of large-\(R\) jets with flavour-tagging applied to the associated small-\(R\) jets. The associated small-\(R\) jets are track-jets with their radii dependent on their transverse momenta (\(p_{\mathrm{T}}\)).

The \(t\overline{t}\) simulated event sample is initiated by proton-proton collisions at a center-of-mass energy of \(\sqrt{s}=13\,\mathrm{TeV}\). Its generation includes the effect of multiple proton-proton interactions per bunchcrossing with an average pile-up of \(\langle\mu\rangle=40\), as well as the effect on the detector response due to interactions from bunch crossings before or after the one containing the hard interaction. The pile-up was modelled by overlaying the original hard-scattering event with simulated inelastic proton-proton collisions generated with Pythia8[3] using the NNPDF2.3LO[4] set of parton distribution functions (PDFs) and the A3 tune [5].

The production of \(t\bar{t}\) events was simulated with the PowhegBox[6, 7, 8, 9] v2 generator at next-to-leading order (NLO) accuracy for the matrix element with the NNPDF3.0NLO[10] set of PDFs and the \(h_{\rm damp}\) parameter set to 1.5 \(m_{\rm top}\)[11], with \(m_{\rm top}=172.5\,\,\mathrm{GeV}\). The events are interfaced to Pythia8.230[12] to model the parton shower, hadronisation and underlying event with the NNPDF2.3LO set of PDFs and the A14 set [13] of parameters. The EvtGen v1.6.0 program [14] was used to model the decays of \(b\)- and \(c\)-hadrons. A filtering at generator level was applied using truth information. Events were required to have at least one \(W\) boson decaying leptonically. The events were passed through a detailed simulation [15] of the ATLAS detector with Geant4[16], and reconstructed with the ATLAS reconstruction software.

The trajectories of charged particles are reconstructed as tracks from the energy depositions of the particles traversing the sensitive elements of the inner detector. The transverse and longitudinal impact parameters are measured with respect to the hard scatter primary vertex (PV), defined as the reconstructed PV with the largest sum of the transverse momenta of the associated tracks.

Large-radius jets are reconstructed from topological clusters of energy deposited in the calorimeters using the anti-\(k_{t}\) algorithm [17, 18] with radius parameter \(R=1.0\) and are trimmed [19] to improve the mass resolution and reduce dependence on pile-up. The input clusters are calibrated using the local calibration method [20]. The trimming is achieved by reclustering the constituents of the initial jet, using the \(k_{t}\) algorithm [21], into smaller \(R=0.2\) sub-jets and then by removing any sub-jet that has a \(p_{\rm T}\) less than 5% of the \(p_{\rm T}\) of the parent jet [22].

Track-jets are clustered using the variable-radius jet algorithm [23, 24] with \(\rho=30\) GeV, \(R_{\rm min}=0.02\) and \(R_{\rm max}=0.4\) on a subset of the reconstructed tracks. The \(\rho\) parameter controls the jet cone size, which scales as \(\rho/p_{\rm T}\). The \(R_{\rm min}\) and \(R_{\rm max}\) parameters control the minimum and maximum cone size respectively, preventing the jets from becoming too large at low \(p_{\rm T}\) and going beyond the detector resolution at high \(p_{\rm T}\). Only track-jets with \(p_{\rm T}>10\) GeV, \(|\eta|<2.5\), at least two track constituents and satisfying \(\Delta R/\mathrm{min}\)\(R>1\), with \(\mathrm{min}\)\(R\) the smallest radius of the track-jets and \(\Delta R\)1 the distance among any pair of them, are considered. The last requirement discards collinear track-jets to prevent anomalous response by the flavour-tagging algorithm. The reconstructed track-jets are ghost-associated to the large-\(R\) jets before trimming [25]. The track-jets are labeled as \(b\)-, \(c\)- or light-flavour jets according to which weakly-decaying hadrons with \(p_{\rm T}\geq 5\) GeV are found within \(\Delta R=0.3\) around the jet axis [2], using particle level MC generator information.

Footnote 1: ATLAS uses a right-handed coordinate system with its origin at the nominal interaction point in the centre of the detector and the \(z\)-axis along the beam pipe. The \(x\)-axis points from the interaction point to the centre of the LHC ring, and the \(y\)-axis points upwards. Cylindrical coordinates \((r,\phi)\) are used in the transverse plane, \(\phi\) being the azimuthal angle around the \(z\)-axis. The pseudorapidity is defined in terms of the polar angle \(\theta\) as \(\eta=-\ln\tan(\theta/2)\). Angular distance is measured in units of \(\Delta R\equiv\sqrt{(\Delta\eta)^{2}+(\Delta\phi)^{2}}\).

Track-jets containing \(b\)-hadrons are identified using the flavour-tagging algorithm DL1r [26, 27], a deep neural network using the impact parameter of the associated tracks as well as information about secondary vertices and reconstructed flight paths of \(b\)- and \(c\)-hadrons within the jet to perform the classification task. There are four OPs that can be adopted across the ATLAS physics analyses, which correspond to \(60\%,70\%,77\%\) and \(85\%\)\(b\)-tagging efficiency [2]. The results shown in this note refer to the 77% DL1rOP, which corresponds to an average \(c\)-jet rejection of 5 and a light-jet rejection of 148 in a sample of inclusive \(t\overline{t}\) events.

## 3 Truth-flavour tagging

An efficient statistical approach to emulate flavour tagging for samples that would suffer from high event rejection due to flavour-tagging is truth-flavour tagging. The method consists in replacing the pass-or-fail \(b\)-tagging response with a weighting procedure on each jet, based on its \(b\)-tagging probability, in order to increase the statistical power of the simulated sample. The weights are defined to preserve the overall shapes and normalisations of the kinematic distributions when compared to the same sample where pass-or-fail \(b\)-tagging is applied.

### Methodology

The tagging efficiency \(\epsilon_{f}\) can be thought as the probability \(P\), for a jet of flavour \(f\), to be tagged as \(b\)-jet by using a classifier trained on a set of input variables denoted as \(\mathbf{x}\). Typical examples of variables in \(\mathbf{x}\) are features related to the tracks or secondary vertices associated to the jet being examined. The truth-flavour tagging method assumes that \(\epsilon_{f}\) can be parametrised as a function of a set of relevant variables \(\boldsymbol{\theta}\) in such a way that the conditional probability of the input variables \(P(\mathbf{x}|\boldsymbol{\theta})\) is identical between physics processes or different regions of phase space. If this is achieved, the efficiencies become independent of the physics process, so they can be universally computed a priori on inclusive samples with a large number of simulated events and used to compute the weights for a large number of analyses. Typical examples of \(\boldsymbol{\theta}\) variables are the jet \(p_{\mathrm{T}}\) and \(\eta\) and the angular distance between other jets in the same event.

Starting from the per-jet and per-flavour efficiencies, an event weight is constructed to reflect the probability of the event to be selected by the application of the flavour-tagging algorithm. In particular, the event weight is defined as the product of the efficiency for each \(b\)-tagged jet times the inefficiency, being the complement of the efficiency \((1-\epsilon)\), for each non \(b\)-tagged jet

\[\begin{split} P(\text{event is tagged}|\boldsymbol{\theta})& =P(\text{jet}_{1}\text{ is tagged}|\boldsymbol{\theta})\cdot P(\text{jet}_{2} \text{ is tagged}|\boldsymbol{\theta})\cdot(1\text{- }P(\text{jet}_{3}\text{ is tagged}|\boldsymbol{\theta}))\cdot...\\ &=\epsilon_{j_{1}}(\mathbf{x}|\boldsymbol{\theta})\cdot\epsilon_{j_ {2}}(\mathbf{x}|\boldsymbol{\theta})\cdot(1-\epsilon_{j_{3}}(\mathbf{x}| \boldsymbol{\theta}))\cdot...\end{split} \tag{1}\]

with \(\epsilon_{j}(\mathbf{x}|\boldsymbol{\theta})\) the tagging efficiency of the jet \(j\) parametrised as a function of the set of variables \(\boldsymbol{\theta}\).

A combinatorial approach is used in case the number of jets \(m\) in the event exceeds the number of required tagged jets \(n\): all possible combinations of \(b\)-tagged and non \(b\)-tagged jets satisfying the analysis selection are considered, and the event weight is defined as the sum of weights for each single combination. Given an event with \(m\) jets and \(n\) tagged jets required, the total number of possible combinations can be denoted as \(C=\binom{m}{n}\). For a given configuration, referred to as the \(i^{th}\) combination, the set of tagged jets can be defined as \(T_{i}\), with \(|T_{i}|=n\), while the set of non-tagged jets can be defined as \(T_{i}\) with \(|T_{i}|=(m-n)\). The per-event efficiency and inefficiency products are hence:

\[\epsilon(T_{i},\mathbf{x},\boldsymbol{\theta}) = \prod_{j\in T_{i}}\epsilon_{j}(\mathbf{x}|\boldsymbol{\theta}) \tag{2}\] \[\epsilon_{in}(T_{i},\mathbf{x},\boldsymbol{\theta}) = \prod_{j\in T_{i}}(1-\epsilon_{j}(\mathbf{x}|\boldsymbol{\theta})) \tag{3}\]The notations \(j\in T_{i}\) and \(j\in\not{T}_{i}\) refer to the pool of tagged and non-tagged jets, respectively. Therefore the event weight can be written as:

\[w=\sum_{i}^{C}\epsilon(T_{i},\mathbf{x},\boldsymbol{\theta})\cdot\epsilon_{in}( \not{T}_{i},\mathbf{x},\boldsymbol{\theta}) \tag{4}\]

Physics analyses often require to define precisely which are the \(b\)-tagged jets among the selected ones, for instance to reconstruct specific event information on top of the flavour-tagging requirements, e.g. to determine the mass of the tagged di-jet system \(m_{bb}\) in a three jet event. When this is necessary, a particular permutation is chosen randomly among all the possible ones, with a probability that is proportional to its truth-flavour tagging weight. Directly following from Eq. 4, the probability to choose a specific combination can be written as

\[P_{i}=\frac{\epsilon(T_{i},\mathbf{x},\boldsymbol{\theta})\cdot\epsilon_{in}( \not{T}_{i},\mathbf{x},\boldsymbol{\theta})}{w}\,. \tag{5}\]

### Map-based truth-flavour tagging

The parametrisation of the \(b\)-tagging efficiency is the first step towards the definition of event weights used for truth-flavour tagging. The approach originally developed by ATLAS relies on binned efficiency maps. These maps are used to parametrize the flavour-tagging efficiency as a function of a set of known parameters separately for each jet flavour label and event generator. These maps would ideally need to account for a larger number of parameters to fully capture all the dependencies of the flavour-tagging efficiency. Instead, for practical reasons, the adopted parametrisation considers only the two most important variables, being the \(p_{\mathrm{T}}\) and \(|\eta|\) of the reconstructed jets. An example of an efficiency map derived for \(b\)-jets in simulated \(t\bar{t}\) events is shown in Figure 1. Truth-flavour tagging based on such maps has been used, for example, in the recent measurements of \(WH\) and \(ZH\) production in the \(H\to b\overline{b}\) and \(H\to c\overline{c}\) decay channels using proton-proton collisions with a center-of-mass energy of 13 TeV [28, 29].

This approach comes with several limitations. Different assumptions are needed to construct statistically-significant maps at the cost of introducing a discrepancy with respect to the application of the flavour-tagging requirement. The maps are in fact assumed to be independent of other kinematic variables and possible correlations between the flavour tagging efficiency and the properties of additional close-by jets in the event. Finally the optimisation of the binning is non trivial given the necessity to correctly resolve all significant variations of the underlying distributions while pertaining enough number of events in each bin.

In some cases the modelling of distributions of typical interest in physics analyses was not found adequate after the application of truth-flavour tagging. One example is discussed in Ref. [29] where differences up to 20% were observed between pass-of-fail and truth-flavour tagging in the \(V\)+ jets simulated sample, representing a dominant background of the analysis. An event-based correction was therefore derived based on the \(\Delta R\) between the tagged jet and its closest neighbouring jet, resulting in an additional systematic uncertainty.

## 4 Truth-flavour tagging with graph neural networks

Neural networks are an extremely useful tool to cope with problems of high dimensionality. To optimally account for the different variables correlated with the flavour-tagging efficiency, a new method, originally proposed in Ref. [30], is developed. In this new approach, the flavour-tagging efficiencies are estimated using a graph neural network (GNN). The GNN ensures a good flexibility in modelling the parametrisation, since adaptations with new or different input variables can be obtained without altering the architecture of the model. In addition, the GNN accounts for the high-dimensional correlation between the jets in the event and naturally leads to smooth output efficiency distributions, avoiding the need of fine tuning the binning choices as previously mentioned.

### The network architecture

The input to the network is a fully connected graph constructed from the track-jets associated to a large-\(R\) jet, where each node of the graph is represented by a track-jet. The node features are the set of track-jet and event level variables defined in Table 1. The edges in this graph represent the relation between track-jet pairs, and the only edge feature used in this case is the angular separation \(\Delta R\) between the two track-jets. This input graph then passes through several layers of message-passing networks [31] which update the representation of the nodes, representing the track-jets, while also considering the information about its neighboring nodes. A second fully-connected network receives these updated node representations as input, and returns the flavour-tagging efficiency for each track-jet. Each linear layer in the network is followed by a rectified linear activation function, except for the last layer which is followed by a normalised exponential activation function (soft-max function). A schematic sketch of the network architecture is depicted in Figure 2. In there, the second fully-connected network is named Efficiency Net and is represented on the right part of the figure.

Figure 1: Efficiency map for \(b\)-jets derived from simulated \(t\bar{t}\) events using the DL1r flavour-tagging algorithm at the 77% OP.

### The training procedure

The network is trained to predict the flavour-tagging efficiency for each considered track-jet. In particular, the GNN output runs over the binned version of the flavour-tagging discriminant, obtained subdividing the DL1r distribution into five bins delimited by the \(b\)-tagging OPs. For each track-jet, the final output information of the GNN is encoded in a a five dimensional vector output, \(\left\{v_{i}\right\}_{i=1}^{5}\), where each element of the vector represents the probability that the track-jet DL1r score falls into a given bin i.e. \(v_{i}\in(0,1)\) with \(\sum_{i}v_{i}=1\). The target is the actual bin in which the track jet DL1r value falls, and the categorical cross-entropy, comparing the predicted and actual bin value, is used as the loss function. Once these efficiencies in the five bins are obtained, they are converted into the flavour-tagging efficiencies by just summing over the bins below that given threshold. The network design can be considered as a simple extension of the well-known density ratio estimation method for two classes, for which a neural network

\begin{table}
\begin{tabular}{l} \hline
**Track-jet variables** \\ \hline Track-jet \(p_{\mathrm{T}}\) \\ Track-jet \(\eta\) \\ Track-jet \(\phi\) \\ Track-jet flavour label \\ Mass of the \(p_{\mathrm{T}}\)-leading \(b\)- or \(c\)-hadron in the track-jet \\ \(p_{\mathrm{T}}\) of the \(p_{\mathrm{T}}\)-leading \(b\)- or \(c\)-hadron in the track-jet \\ \(\eta\) of the \(p_{\mathrm{T}}\)-leading \(b\)- or \(c\)-hadron in the track-jet \\ \(\phi\) of the \(p_{\mathrm{T}}\)-leading \(b\)- or \(c\)-hadron in the track-jet \\ \hline
**Event variables** \\ \hline Average number of interactions per event, \(\left\langle\mu\right\rangle\) \\ \hline
**Jet-pair variables** \\ \hline Angular separation between two track-jets, \(\Delta R\) \\ \hline \end{tabular}
\end{table}
Table 1: The list of variables used as features of the GNN.

Figure 2: The network architecture used for truth-flavour tagging. The initial jet representation is created with the jet and the event features as described in Section 3. This representation is then updated by a fully connected graph network resulting in a jet representation which is also conditioned by its neighbours. A second fully-connected network is then applied on each of these updated jet representations independently to obtain the estimates of the flavour-tagging efficiencies.

trained to distinguish between two overlapping distributions \(p(\mathbf{\theta})\) and \(q(\mathbf{\theta})\), with binary cross entropy as a loss function, converges to the ratio \(p(\mathbf{\theta})/(p(\mathbf{\theta})+q(\mathbf{\theta}))=\epsilon(\mathbf{\theta})\)[32].

The model was trained with 15M events, with a 1M validation events and was evaluated on another 15M events. Adam optimizer was used with an initial learning rate of \(10^{-3}\) and a batch size of 5000 events. The model was trained for 30 epochs as the validation loss, computed after each epoch, was observed to usually saturate by then. After training, the best model, based on the validation loss was used for the performance studies.

## 5 Performance studies

This section summarizes the validation checks performed on the GNN-based truth-flavour tagging as well as the performance comparison with respect to the baseline approach based on the efficiency maps. In order to be deployed in physics analyses, the distributions obtained with the truth-flavour tagging approach need to match the ones obtained with pass-or-fail flavour tagging within statistical uncertainties. The latter approach is also called direct tagging in the following.

To allow for a proper and meaningful comparison, custom efficiency maps are derived using exactly the same events being used for training the GNN. Accordingly, the two approaches are compared using the same events, which have been excluded for constructing the maps and training the GNN. A basic event selection is applied mimicking the baseline selection of analyses targeting a Higgs boson, or other resonances, decaying hadronically into two \(b\)-jets. Focusing on the high-\(p_{\mathrm{T}}\) regime, the decay products are typically reconstructed within a single large-\(R\) jet. Events are required to have at least one large-\(R\) jet with \(p_{\mathrm{T}}>250\) and the two \(p_{\mathrm{T}}\)-leading track-jets \(b\)-tagged with the DL1r algorithm at 77% OP. Only the leading large-\(R\) jet is considered in both approaches. All the track-jets ghost-associated with the leading large-\(R\) jet are considered for constructing the maps and training the GNN, while the two leading ghost-associated track-jets are considered for validating the approaches and presenting the results.

### Validation on physics observables

Figure 3 shows a comparison between the large-\(R\) jet mass distribution obtained using direct tagging and both truth-flavour tagging methods. The distributions are split according to the truth-flavour label of the track-jet pair and only the statistically relevant flavour combinations are displayed.

As can be seen in all the distributions, both shapes and normalisations are equally or better reproduced when the truth-flavour tagging weights are extracted from the GNN-based approach, than the efficiency maps. Truth-flavour tagging with the efficiency maps overestimates the events passing the selection criteria by roughly 10-20%. This effect gets largely mitigated when performing truth-flavour tagging with GNN-based efficiencies.

Figure 4 shows the analogous distributions as a function of \(\Delta R\) between the two \(p_{\mathrm{T}}\)-leading track-jets. Again, the GNN approach outperforms the map-based method in terms of closure with respect to the direct tagged distribution. This is particularly evident in Figure 4(a) or towards smaller values of \(\Delta R\) in Figures 4(b) and 4(c).

Figure 3: Comparison of the large-\(R\) jet mass distribution obtained using direct and truth-flavour tagging with DL1r at the 77% OP on the first two \(p_{\mathrm{T}}\)-leading track-jets associated to the large-\(R\) jet in \(t\bar{t}\) events. The direct flavour tagging is represented by the blue filled histogram. The black error bands represent the statistical error in direct flavour tagging. The truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. The bottom pad shows the ratio with respect to the direct flavour tagging distribution. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

Figure 4: Comparison of the \(\Delta R\) distributions obtained using direct and truth-flavour tagging with DL1r at the 77% OP on the first two \(p_{\rm T}\)-leading track-jets associated to the large-R jet in \(t\overline{t}\) events. The direct flavour tagging is represented by the blue filled histogram. The black error bands represent the statistical error in direct flavour tagging. The truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. The bottom pad shows the ratio with respect to the direct flavour tagging distribution. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

### Small \(\Delta R\) effects

The improvements at small \(\Delta R\) can be better appreciated in Figure 5, which shows a comparison of the flavour tagging efficiencies for the two leading track-jets ghost-associated with the leading large-\(R\) jet as a function of \(\Delta R\) in the three approaches. This enhances the effects on the tails and partially smooths the statistical fluctuations as each bin is now normalised to the total number of jets in that bin. As discussed above, the modelling of the flavour-tagging efficiency shows very good agreement within uncertainties when adopting the GNN approach. The efficiency maps method on the contrary shows a clear dependence on the flavour combination of the close-by jets, which is particularly enhanced in case of heavy-flavour combinations (\(bb\), \(bc\), \(cc\)). Motivating the differences among the flavour combinations is not trivial. Track mis-association or track-sharing among the two close-by jets can lead to suboptimal definitions of the track-jet cones and thus to differences in the input variables to DL1r with respect to fully isolated jets. These differences are not accounted for by the efficiency maps, which are implemented per-jet and make no distinctions between isolated and non-isolated jets, leading to a poor closure with respect to the direct flavour tagging. This is particularly enhanced in \(bb\) topologies, where the presence of two displaced vertices with high-jet multiplicity in the decay makes the track association particularly delicate.

On the contrary, the light-flavour combinations (\(cc\), \(cl\), \(ll\)) show the opposite behavior. In fact the efficiency maps are now underestimating the close-by effects at small \(\Delta R\). these effects are more enhanced when one of the two jets is a heavy flavoured jet (\(bl\), \(cl\)) than in case of \(ll\) and below \(\Delta R\sim 0.2\). A possible explanation in this case is that the efficiency maps are mostly driven by the bulk of the distribution, where these close-by effects are not present. The GNN on the contrary, thanks to its architecture that also considers the geometrical relations of the track-jets associated to the leading large-\(R\) jet, is able to better capture these effects.

## 6 Conclusion

This note describes for the first time truth-flavour tagging in ATLAS and presents a new approach based on graph neural networks. Truth-flavour tagging is a way to mimic the flavour tagging decision by reweighting the event for the probability to contain a certain number of tagged jets. The event weights are defined starting from a parametrisation of the per-jet flavour-tagging efficiencies. This methodology allows physics analyses suffering from the high rejection power against light-flavour jets to increase the statistics of their simulated samples without altering the background modelling.

A new approach based on a graph neural network to obtain the flavour tagging efficiencies of each jet in the event is presented. This approach allows to capture the dependencies of the flavour-tagging efficiency better than the current parametrisation method based on two-dimensional efficiency maps that has limitations especially in dense environments. Performance comparison studies are presented in the context of physics analyses conducted in the boosted regime and considering a set of characteristic observables, highlighting the superior performance of the graph neural network to parametrise the flavour-tagging efficiency in particular in the presence of near-by jets. The graph neural network can be re-optimised for other use cases easily, thanks to the flexible training infrastructure.

Figure 5: Comparison of the flavour tagging efficiencies as a function of \(\Delta R\) using direct and truth-flavour tagging with DL1r at the 77% OP on the first two \(p_{\rm T}\)-leading track-jets associated to the large-R jet in \(t\bar{t}\) events. The direct flavour tagging is in blue, the truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

[MISSING_PAGE_FAIL:13]

## 6 Conclusion

Figure 7: Comparison of the flavour tagging efficiencies as a function of \(\Delta R\) using direct and truth-flavour tagging with DL1r at the 60% OP on the first two \(p_{\mathrm{T}}\)-leading track-jets associated to the large-R jet in \(t\overline{t}\) events. The direct flavour tagging is in blue, the truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

Results for tighter large-\(R\) jet \(p_{\mathrm{T}}\)

This appendix shows the results for a tighter event selection in terms of the boost of the large-\(R\) jet system. A large-\(R\) jet transverse momentum of \(p_{\mathrm{T}}>400\) GeV is required for constructing the performance comparison plots depicted in Figure 8, using the map-based and GNN-based truth-flavour tagging approaches described in the note. These distributions demonstrate that even if the GNN has been trained on a more inclusive sample, its ability to parametrise the flavour-tagging efficiency is unchanged when tested in a subset of its sample, where close-by effects between jets are expected to be more pronounced than in the bulk of the distribution.

Figure 8: Comparison of the \(\Delta R\) distributions obtained using direct and truth-flavour tagging with DL1r at the 77% OP on the first two \(p_{\mathrm{T}}\)-leading track-jets associated to the large-R jet in \(t\overline{t}\) events requiring the large R-jet transverse momentum to be \(p_{\mathrm{T}}>400\) GeV. The direct flavour tagging is represented by the blue filled histogram. The black error bands represent the statistical error in direct flavour tagging. The truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. The bottom pad shows the ratio with respect to the direct flavour tagging distribution. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

Results for charm and light combinations

This appendix shows the performance comparison distributions in case the first two \(p_{\mathrm{T}}\)-leading track-jets associated to the large-\(R\) jet are both light-flavour jets or a pair of light-flavour and \(c\)-jet. These cases are the ones suffering the most from the highest rejection and where the use of truth-flavour tagging is the most advantageous. At the same time, the very low number of events passing the direct flavour-tagging requirement makes these cases very difficult to use for validation purposes as in this note. Figure 9 shows the performance comparison as a function of the large-\(R\) jet mass and of the \(\Delta\)R between the two track-jets for the charm-light and light-light flavour combinations. Figure 10 shows the corresponding b-tagging efficiency plot as a function of the \(\Delta\)R between the two track-jets.

## 6 Conclusions

Figure 9: Comparison of the large-\(R\) jet mass and \(\Delta R\) distributions obtained using direct and truth-flavour tagging with DL1r at the 77% OP on the first two \(p_{\mathrm{T}}\)-leading track-jets associated to the large-\(R\) jet for the \(t\overline{t}\) sample. The direct flavour tagging is represented by the blue filled histogram. The black error bands represent the statistical error in direct flavour tagging. The truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. The bottom pad shows the ratio with respect to the direct flavour tagging distribution. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

Figure 10: Comparison of the flavour tagging efficiencies as a function of \(\Delta R\) using direct and truth-flavour tagging with DL1r at the 77% OP on the first two \(p_{\mathrm{T}}\)-leading track-jets associated to the large-R jet for the \(t\overline{t}\) sample. The direct flavour tagging is in blue, the truth-flavour tagging obtained parametrising the efficiencies with the map method is in grey, while the GNN method is in red. Each plot refers to a different truth-flavour combination of the track-jets associated to the large-\(R\) jet and used for flavour tagging.

## References

* [1] ATLAS Collaboration, _The ATLAS Experiment at the CERN Large Hadron Collider_, JINST **3** (2008) S08003 (cit. on p. 2).
* [2] ATLAS Collaboration, _ATLAS \(b\)-jet identification performance and efficiency measurement with \(t\bar{t}\) events in \(pp\) collisions at \(\sqrt{s}=13\) TeV_, Eur. Phys. J. C **79** (2019) 970, arXiv: 1907.05120 [hep-ex] (cit. on pp. 2, 3).
* [3] T. Sjostrand, S. Mrenna and P. Skands, _A brief introduction to PYTHIA 8.1_, Comput. Phys. Commun. **178** (2008) 852, arXiv: 0710.3820 [hep-ph] (cit. on p. 3).
* [4] R. D. Ball et al., _Parton distributions with LHC data_, Nucl. Phys. B **867** (2013) 244, arXiv: 1207.1303 [hep-ph] (cit. on p. 3).
* [5] ATLAS Collaboration, _The Pythia 8 A3 tune description of ATLAS minimum bias and inelastic measurements incorporating the Donnachie-Landshoff diffractive model_, ATL-PHYS-PUB-2016-017, 2016, url: [https://cds.cern.ch/record/2206965](https://cds.cern.ch/record/2206965) (cit. on p. 3).
* [6] P. Nason, _A new method for combining NLO QCD with shower Monte Carlo algorithms_, JHEP **11** (2004) 040, arXiv: hep-ph/0409146 (cit. on p. 3).
* [7] S. Frixione, G. Ridolfi and P. Nason, _A positive-weight next-to-leading-order Monte Carlo for heavy flavour hadroproduction_, JHEP **09** (2007) 126, arXiv: 0707.3088 [hep-ph] (cit. on p. 3).
* [8] S. Frixione, P. Nason and C. Oleari, _Matching NLO QCD computations with parton shower simulations: the POWHEG method_, JHEP **11** (2007) 070, arXiv: 0709.2092 [hep-ph] (cit. on p. 3).
* [9] S. Alioli, P. Nason, C. Oleari and E. Re, _A general framework for implementing NLO calculations in shower Monte Carlo programs: the POWHEG BOX_, JHEP **06** (2010) 043, arXiv: 1002.2581 [hep-ph] (cit. on p. 3).
* [10] R. D. Ball et al., _Parton distributions for the LHC run II_, JHEP **04** (2015) 040, arXiv: 1410.8849 [hep-ph] (cit. on p. 3).
* [11] ATLAS Collaboration, _Studies on top-quark Monte Carlo modelling for Top2016_, ATL-PHYS-PUB-2016-020, 2016, url: [https://cds.cern.ch/record/2216168](https://cds.cern.ch/record/2216168) (cit. on p. 3).
* [12] T. Sjostrand et al., _An introduction to PYTHIA 8.2_, Comput. Phys. Commun. **191** (2015) 159, arXiv: 1410.3012 [hep-ph] (cit. on p. 3).
* [13] ATLAS Collaboration, _ATLAS Pythia 8 tunes to 7 TeV data_, ATL-PHYS-PUB-2014-021, 2014, url: [https://cds.cern.ch/record/1966419](https://cds.cern.ch/record/1966419) (cit. on p. 3).
* [14] D. J. Lange, _The EvtGen particle decay simulation package_, Nucl. Instrum. Meth. A **462** (2001) 152 (cit. on p. 3).
* [15] ATLAS Collaboration, _The ATLAS Simulation Infrastructure_, Eur. Phys. J. C **70** (2010) 823, arXiv: 1005.4568 [physics.ins-det] (cit. on p. 3).
* a simulation toolkit_, Nucl. Instrum. Meth. A **506** (2003) 250 (cit. on p. 3).
* [17] M. Cacciari, G. P. Salam and G. Soyez, _The anti-\(k_{t}\) jet clustering algorithm_, JHEP **04** (2008) 063, arXiv: 0802.1189 [hep-ph] (cit. on p. 3).