**ATLAS Internal Note**

**LARG-NO-085**

**7 Nov 1997**

**Slow Control for the ATLAS Hadronic End-Cap Calorimeter Test Beam Experiment**

**Valeri Sytnik**

Institute for High Energy Physics, Protvino, Russia

(software development)

**Helmut M. Braun**

University of Wuppertal, Wuppertal, Germany

**Sergey Los**

Institute for High Energy Physics, Protvino, Russia

_November 1997_

**Abstract**

A slow control software system (SC) for the Liquid Argon (LAr) Hadronic End-Cap Calorimeter (HEC) test beam setup is described in this article. The system includes High Voltage (HV) control and monitoring, LAr vapour pressure monitoring and also the TCP/IP data transfer between the slow control components and the central DAQ machine.

Introduction

The slow Control software system for the HEC test beam experiment [1] is implemented using Labview 4.1. The following components of this system are currently in use:

* High Voltage control and monitoring (HV) for several detector subsystems.
* Monitoring of the LAr vapour pressure in the test cryostat.
* Acquisition of all slow control data blocks via TCP, building a full slow control event and ist transmission to the central DAQ machine (HP-UNIX platform).

All applications run on an IBM-PC compatible under Windows 95. The HV application controls the HV hardware by means of Ethernet (exploiting the Telnet protocol), whereas the pressure application communicates with the pressure meter using the RS-232 serial interface. The general slow control scheme is shown in figure 1.

## 2 High Voltage (HV) control.

The High Voltage control is the dominant component of the slow control for the HEC test beam experiment. The HV application operates with the following HV modules inserted in the LeCroy 1458 intelligent (80486 processor) mainframe crate:

* Three LeCroy 1469P HV modules that supply the HEC electrodes, (up to 3.5 kV, 72 HV channels) [2];
* Four LeCroy 1461N HV modules that supply the beam trigger system photomultipliers (PM), (up to 3 kV, 48 HV channels) [3];
* Three LeCroy 1468N HV modules that supply the beam multiwire proportional chambers (MWPC), (up to 6 kV, 18 HV channels) [4].

Thus, taking into account that each HV channel is described on average by 10 parameters, called properties, we have in total about fifteen hundred HV parameters for the current HV hardware configuration.

The 1458 HV Mainframe provides three different remote interfaces: RS-232, ARC-NET and Ethernet (1450-ET). The latter one supports access via FTP, Telnet and BSD Socket protocols. The HV modules are controlled using a special list of commands, that is nearly common for all three interfaces mentioned above. As the result of comparison of the Telnet TCP/IP and BSD Socket protocols the first one was chosen, as it makes it easier to implement high-level programming and it provides approximately the same throughput as the second one. It turns out that the measured 500 ms data transfer latency per HV command is about equal for both.

Figure 1: Slow control system organisation

### The HV Application.

Almost all application features, except some internal details, are reflected in the user interface. The user interface at its top level allows for the operator to select from four modes:

* The main regime (which is described separately).
* The user terminal. This is a remote terminal emulation. It looks like a common line oriented terminal: The HV mainframe responds on commands issued by the operator.
* The configuration mode. It allows for experts to adjust the software parameters to the hardware requirements, for example: adding, removing or replacing HV modules.
* The option mode. The operator can tune various software parameters by means of the following tools:
* knob to set time intervals between the readings of the measured values from the mainframe;
* knob to set the number of points on plots;
* knob to set the time interval between the points on plots;
* switch to turn on/off receiving of the data from the other slow control subsystems via TCP;
* switch to turn on/off transmission of the data to the central DAQ machine via TCP;
* button to select the algorithm for the data taking from the HV Mainframe (details in the next paragraph)

#### 2.1.1 The main regime

Once the main regime is selected from the menu, the program begins to load the initial values of the HV properties from the HV Database into the mainframe. It takes about 33 stload all the parameters for the current HV hardware configuration. Hereafter the periodical control of the HV properties starts. There are two approaches implemented in the HV application to control the HV parameters. The first one consists in reading all read-only HV properties using a single (SRC) command [5]. The second one is sequential and allows reading of only those parameter values, which have changed (issuing a GS,LS,PS,CE sequence of HV commands) [5].

In both cases the results of measurements (like measured current MC, measured voltage MV) and the control parameters (like demand voltage DM, channel enable CE, which can be changed by operator) are shown on the screen in tables. The operatormay bring to screen the parameter tables for the selected HV module type and module number. New control parameters set by the operator are loaded directly into both, the HV mainframe and the HV Database. One can see on the screen time dependency plots for voltage and current for any number of selected channels. There are three different plots corresponding to three types of HV modules. A special screen can be chosen which contains the compressed HV status, the user terminal and all the software options described in 2.1, which can be set dynamically.

#### 2.1.2 HV applications features.

* Error processing. The HV application processes the error code obtained eventually from the HV 1458 mainframe and suggests to the operator either to stop the process or to continue the operation. The second choice is followed by some recoveries.
* The application is able to restore its previous state after unexpected interruption of it or after loosing the network connection.
* Various warnings prevent the operator from performing wrong actions, which are specified for the LeCroy HV modules.
* The application is provided with online help and manual.

## 3 The Liquid Ar vapour pressure application.

The test cryostat pressure application obtains the LAr vapour pressure values from a Membranovac DM11 meter via a RS-232 serial interface. Every measurement is send in the response of a program request (polling mode). The operator can watch on the screen the time dependence of the pressure, error diagnostics and two knobs allowing to set appropriate time intervals between the measurements and the number of points on the plot respectively.

## 4 The slow control network communications.

The slow control network is arranged as follows. The HV application contains a slow control TCP server that provides several functions:

* Acquisition of all slow control data via Ethernet from the slow control TCP clients. Currently there is only one TCP client, the pressure application, implemented.
* Building of a slow control event from the HV data plus data blocks received from the other TCP clients.

* Transmission of the slow control events to the central DAQ machine on request or in the case of an abnormal HV status. Any other network device may also request for these data.

The TCP client built in the pressure application transmits the measured pressure on request from the slow control TCP server. Both server and client restore a lost network connection automatically. The described network structure can be extended to integrate new slow control applications with its TCP client implemented.

## 5 Conclusion.

The HV application seems to be sufficiently universal and can be quickly adapted to other conditions (other experiments for instance). But such an adjustment requires its modification. The main step to be done in the future is the complete automation of the configuration procedure that adjusts the application settings to the changes in the hardware setup. In order to increase the flexibility and ease of use the following steps are necessary :

* Development of a detailed documentation.
* Standardisation of Labview libraries for the LeCroy HV mainframe.
* Time optimisation.
* Extension of HV Database for the new types of HV modules.
* Utilisation of the RS-232 serial port for the hardware connection to the HV mainframe, and BSD Sockets protocol for the Ethernet communications.
* Development of the program versions for the Windows- NT and LINUX platform.

This work is partly supported with a grant of Russian Foundation for Basic Research (# 96-02-16856) and the Bundesministerium fuer Bildung, Wissenschaft, Forschung und Technology, 53170 Bonn, Germany.

## References

* [1] Liquid Argon Calorimeter, Technical Design Report, CERN/LHCC 96-41, p.279.
* [2] Model 1469 High Voltage Module, Operators Manual, LeCroy Corp.
* [3] Model 1461 High Voltage Module, Operators Manual, LeCroy Corp.
* [4] Model 1468 High Voltage Module, Operators Manual, LeCroy Corp.
* [5] 1454 / 1458 HV Mainframe, User's Guide V3.04, LeCroy Corp.