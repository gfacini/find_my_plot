First Implementation of Calorimeter FEX Algorithms in the Level 2 Reference Software

**S. Gonzalez University of Wisconsin**

**B. Gonzalez Pineiro Michigan State University**

**T. Shears University of Liverpool**

**Abstract**

The calorimetric electron/photon, tau/hadron and jet feature extraction algorithms, as implemented in version 01-04-00 of the Level 2 Trigger Reference Software, are described. First algorithm execution time results and comparisons with ATRIG are given where appropriate. A plan for future work on performance issues is included.

## 1 Introduction

The level 2 Reference Software [1] is a suite of programs which control all aspects of the level 2 trigger process, from ROB read in to the formation of the level 2 decision. The physics control is menu driven, and allows a set of level 2 trigger objects (a high \(p_{\mathrm{T}}\) electron, or a jet, for example) to be specified as desired. Feature extraction (FEX) algorithms, whose purpose is to identify level 2 trigger objects, are run if the appropriate menu item is specified. This note documents the FEX algorithms used to identify electrons, photons, taus, hadrons and jets in the electromagnetic and hadronic calorimetry.

The algorithms described in this note correspond to those available in version 01-04-00 of the Reference Software. The purpose of these algorithms is to provide representative (realistic) timings within the Reference Software so that the entire level 2 process can be benchmarked. We have attempted to make the algorithms equivalent to their ATRIG [1] equivalent, where these exist. It should be noted that we have assumed an input data format for the moment, and that further studies on both this and the performance of the algorithms will be carried out in the future.

Section 2 describes the salient features of the ATLAS calorimetry and motivates the quantities used in the FEX algorithms to identify level 2 trigger objects. The data samples used in this note are described in Section 3. The data format and preprocessing, which currently forms part of the FEX, is described in Section 4. Section 5 explains the structure of the algorithms, compares results with ATRIG implementations where appropriate, and gives benchmarking results. Finally, section 6 concludes with a list of planned future work.

## 2 Calorimeter Data at level 2

The ATLAS level 2 calorimeter trigger takes as an input the RoIs selected by the level 1 trigger. After refining the energy, position and (possibly) isolation of the input RoI, the trigger forms a level 2 RoI which corresponds to one of the level 1 input types: electron/photon; tau/ hadron; jet. The full granularity information from the calorimeter contained in this refined RoI is then used by the feature extraction algorithms to derive quantities that are used to form the trigger decision.

### The ATLAS Calorimeters

The ATLAS calorimeter system consists of a liquid argon (LAr) electromagnetic calorimeter, a scintillating tile hadronic calorimeter, an electromagnetic barrel presampler, and a barrel/endcap crack scintillator. A detailed description of the ATLAS calorimeters can be found in References [2] and [3]; here only a brief summary of the features relevant to the level 2 trigger is given.

The electromagnetic calorimeter consists of three samplings. The first, innermost, sampling has a very fine strip segmentation of \(\Delta\eta\times\Delta\phi=0.003\times 0.1\)  which yields detailed information on the early lateral development of a calorimeter cluster. This strip information is used by the trigger to distinguish energetic \(\pi^{0}\) s from photons or electrons. The second sampling of the electromagnetic calorimeter has cells of size \(\Delta\eta\times\Delta\phi=0.025\times 0.025\)  and typically contains the bulk of the energy of a high-\(p_{\mathrm{T}}\) photon or electron. The third sampling contains theremainder of the electromagnetic clusters. The presampler is a thin barrel layer just inside the first sampling that compensates for energy lost in front of the calorimeter (e.g., in the cryostat).

The ATLAS hadronic calorimeter consists of three samplings of tile barrel segments (barrel \(|\eta|<1.0\)  and extended barrel \(0.8<|\eta|<1.7\) ) and a LAr endcap (\(1.5<|\eta|<3.2\) ). Since jets have a much larger lateral extent than electromagnetic clusters, the hadronic cell sizes vary from \(\Delta\eta\times\Delta\phi=0.1\times 0.1\)  to \(\Delta\eta\times\Delta\phi=0.2\times 0.2\). In order to improve the ATLAS calorimeter hermiticity, very coarsely segmented scintillators have been placed in the region \(1.0<|\eta|<1.55\). These scintillators should compensate for energy lost in the problematic barrel/endcap crack region.

### The level 2 Calorimeter Quantities

The level 2 calorimeter triggers in ATLAS will use the full granularity information in the pseudo-rapidity region \(|\eta|<2.5\). Since the Inner Detector is not used in forming a jet trigger, the level 2 jet trigger coverage extends to \(|\eta|<3.2\). More details of the level 2 aspects of the ATLAS calorimeter can be found in [3].

The quantities used to select RoIs at level 2 are described in detail in References [4], [5], [6], [7] and [8]. The measurement of the transverse energy, \(E_{\mathrm{T}}\), in the calorimeter is the most effective method of controlling the level 2 trigger rate. In addition to the rate reduction from \(E_{\mathrm{T}}\), electromagnetic clusters and single hadron clusters are distinguished from jets by examining the shape of the energy depositions in the calorimeter. A description of the quantities implemented in the Reference Software for the three calorimeter algorithms follows. Implementation details of these quantities in the FEX algorithms are given in Section 5.

#### 2.2.1 Electron/photon Algorithm

The aim of the electron/photon algorithm is to reject jets while selecting high-\(p_{\mathrm{T}}\)  electromagnetic clusters. The following quantities, detailed in [6], achieve this goal:

* \(E_{\mathrm{T}}\) : calculated from the sum of the cell energies in the presampler, the three electromagnetic calorimeter samplings, and the crack scintillators in a \(\Delta\eta\times\Delta\phi=0.075\times 0.175\)  region around the cluster seed;
* \(E_{\mathrm{T}}^{\mathrm{had}}\) : calculated from the sum of the cell energies in the first sampling of the hadronic calorimeter within \(\Delta\eta\times\Delta\phi=0.075\times 0.175\)  of the cluster seed;
* \(R_{37}\) : calculated as \(R_{37}=E_{37}/E_{77}\), the ratio of energy contained in \(3\times 7\) to \(7\times 7\)  cells in the second sampling of the electromagnetic calorimeter;

\begin{table}
\begin{tabular}{|c|c|c|} \hline Level-1 RoI Type & \(\eta\)-region & RoI size (\(\Delta\eta\times\Delta\phi\) ) \\ \hline \hline _electron/photon_ & \(|\eta|<2.5\) & \(0.4\times 0.4\) \\ \hline _tau/hadron_ & \(|\eta|<2.5\) & \(0.4\times 0.4\) \\ \hline _jet_ & \(|\eta|<3.2\) & \(0.8\times 0.8\) \\ \hline \end{tabular}
\end{table}
Table 1: Calorimetric level 1 ROI sizes.

* \(R_{\eta}^{\rm strip}\) : calculated as \(R_{\eta}^{\rm strip}\ =\ (E_{1}-E_{2})/(E_{1}+E_{2})\), where \(E_{1}\) is the energy of the strip with the maximum energy within the RoI and \(E_{2}\) is the energy of the second maximum strip.

In addition to the above quantities, the following quantities, used in the photon trigger, are calculated:

* \(\omega_{\eta}\) : the energy-weighted shower width in the second electromagnetic sampling, calculated from \(\omega_{\eta}^{2}\ =\ \langle\eta^{2}\rangle-\langle\eta\rangle^{2}\) ;
* \(R_{\eta}^{\rm shape}\) : calculated as \(R_{\eta}^{\rm shape}\ =\ (E_{7}-E_{3})/E_{3}\), where \(E_{7}\) and \(E_{3}\) are the energies in seven and three strips, respectively, in the first sampling.

#### 2.2.2 Jet Algorithm

The performance of jet algorithms, in the context of ATRIG, has been studied in [9]. At present, the Reference Software uses a cone algorithm within the Level 1 RoI area to define a Level 2 jet. The jet selection is based on:

* \(E_{\tau}\) : calculated from the sum of the cell energies in the presampler, the electromagnetic calorimeter, the hadronic calorimeter and the crack scintillators. The cell energies are summed within a cone of \(\Delta R\!=\!\left(\Delta\eta^{2}+\Delta\varphi^{2}\right)^{1/2}\,<0.4\) around the jet seed.

#### 2.2.3 Tau/hadron Algorithm

The aim of the tau/hadron trigger is to select narrow isolated jets. To this end, the following quantities [8] are built by the tau/hadron FEX algorithm:

* \(E_{\tau}\) : calculated from the sum of the cell energies within \(\Delta\eta\times\Delta\phi\ =\ 0.15\times 0.15\)  of the presampler, the three layers of the electromagnetic calorimeter, and within \(\Delta\eta\times\Delta\phi\ =\ 0.2\times 0.2\)  of the three layers of the hadronic calorimeter;
* Electromagnetic Isolation: calculated as the sum of the cell energies of cells that lie outside the \(\Delta\eta\times\Delta\phi\ =\ 0.15\times 0.15\)  core in the electromagnetic calorimeter and within the RoI boundary;
* Hadronic Isolation: calculated as the sum of the cell energies of cells that lie outside the \(\Delta\eta\times\Delta\phi\ =\ 0.2\times 0.2\)  core in the hadronic calorimeter and within the RoI boundary;
* Fraction of core energy: calculated as the ratio of the \(E_{\tau}\)  in the electromagnetic calorimeter within the \(\Delta\eta\times\Delta\phi\ =\ 0.15\times 0.15\)  core and the \(E_{\tau}\)  in the electromagnetic calorimeter within the RoI boundary.

## 3 Data Samples

All measurements described in this note have been carried out on ASCII data files produced by ATRIG. All events in the files contain at least one level 1 RoI. The RoI type, truth information, calorimeter, TRT and SCT digitisation information, and the results of ATRIG level 2 processing are given for each RoI.

Samples of events with electrons and jets, with and without pileup, were generated and are available in **[http://www-wisconsin.cern.ch/](http://www-wisconsin.cern.ch/)\(\_\)atsaul/refsw/data/**. Each data sample contains a mixture of electron/photon, tau/hadron and jet RoIs as produced by the level 1 simulation of ATRIG. In general an event contains more than one RoI of different types. The relative mixture of RoI types depends not only on the physics data file used to generate the ASCII file, but also on the level 1 cuts used in the ATRIG trigger simulation. The samples used here have been generated with level 1 cuts that reproduce the level 1 rates presented in reference [4]. The values of the level 1 cuts can be found in the ATRIG log files available at the above web address.

Each particular FEX algorithm takes as an input the appropriate level 1 RoI type. Therefore, benchmarking results are representative for a FEX algorithm given a particular physics input. The format of the data in the samples is described below in section 4.

## 4 Data Format

The FEX algorithms take a collection of calorimetric cells as input. Each cell is uniquely identified by the calorimeter type, the sampling and the \(\eta\) and \(\phi\) coordinates it occcupies, and stores the transverse energy deposited in that region. Cells are ordered by calorimeter, within each calorimeter by sampling and within each sampling by \(\eta\) and finally \(\phi\).

The order in which data is given to the FEX algorithm obviously has important implications for the efficiency of the algorithms. For the moment the data ordering described above is taken as a starting point, and limited preprocessing is performed at the start of the algorithm. This consists of determining a "seed cell" (i.e. that with greatest energy deposition), which forms the basis of all feature extraction calculations. In the future data ordering will be examined in greater detail: studies on how reconstruction efficiency, rate and algorithm timing are affected by energy ordering, applying an energy threshold to cells, and changing the RoI size or only sending a subset of the data, will be carried out. Such studies are not described in this note.

## 5 The Feature Extraction Algorithms

The feature extraction algorithm calculates the quantities that characterise an RoI in the context of a particular physics hypothesis. The ATLAS level 2 calorimeter trigger foresees three high-\(p_{\mathrm{T}}\) hypotheses: electromagnetic RoI, tau/hadron RoI, and jet RoI. Each aims to reproduce the calorimeter algorithms described in Reference [4], and is implemented in the Reference Software using the same basic structure. As shown in Figure 1, each FEX algorithm is contained in a single routine with a single input and output interface. The algorithm itself has three or four stages of processing. All but the last stage, as currently implemented, require a loop over all of the calorimeter cells in the RoI. At this point, no attempt has been made to implement an OO design or to optimize the algorithms for minimal data flow or execution speed.

The files which compose the Reference Software implementation of the calorimeter algorithms are shown in Table 2. All files belong to the "physics/calo" package. Each algorithm type has its own cluster class where the FEX quantities described in Section 2.2 are stored on output. Each algorithm also has a corresponding test program. The test programs serve as steering modules that read in the data, execute the FEX algorithms, and generate and store diagnostic histograms and ntuples. Special care was taken to document the functionality of the code within the code itself.

More details of each of the calorimeter algorithms, as currently implemented in the Reference Software, follow.

The data preparation step in the electron/photon algorithm consists of finding a cluster seed within the RoI, in this case defined to be the most energetic cell in the second sampling of the electromagnetic calorimeter. The seed position is then used as the reference point for calculating the cluster energy-weighted \(\eta\) and \(\phi\) position and the cluster \(E_{\mathrm{T}}\). The variables given in section 2.2.1 are then calculated, first for the second sampling and then for the first sampling. Corrections are applied to the energy-weighted shower width to allow for the relative position of the cluster centroid within a cell. This correction is identical to that applied in ATRIG. Finally, all quantities are input to the EmCluster.

#### 5.0.2 Jet algorithm

The first step in the jet algorithm is to find the most energetic cell in the jet RoI, which is defined as the jet cluster seed. After this data preparation step the tranverse energy within a

\begin{table}
\begin{tabular}{|c|c|c|c|} \hline RoI hypothesis & algorithm file & output class files & test program \\ \hline \hline _Electromagnetic_ & _EmAlgorithm.cxx_ & _EmCluster (.h,.cxx)_ & _EmFexquality.cxx_ \\ \hline _tau/hadron_ & _TauAlgorithm.cxx_ & _TauCluster (.h,.cxx)_ & _tauFexquality.cxx_ \\ \hline _jet_ & _JetAlgorithm.cxx_ & _JetCluster (.h,.cxx)_ & _jeffexquality.cxx_ \\ \hline \end{tabular}
\end{table}
Table 2: Components of the level 2 calorimeter FEX code in the “physics/calo” package.

Figure 1: Schematic of the level 2 calorimeter FEX algorithms.

cone (see section 2.2.2) is calculated using information from all calorimeters. A global jet calibration is then applied to the jet RoI in order to normalise calorimeter energies to a single jet energy scale. The energy is then written to the JetCluster.

#### 5.0.3 Tau/hadron algorithm

The data preparation step in the tau/hadron algorithm consists of the application of a global jet calibration to the calorimeter cell energies. The cluster centroid is then calculated from all calorimeter cells in the RoI. This centroid is then used as a reference point to calculate the \(E_{\mathrm{T}}\), the electromagnetic isolation, and the hadronic isolation as described in section 2.2.3. The results are then written to the TauCluster.

### Performance: Comparison to ATRIG

In order to validate the algorithms implemented in the Reference Software, FEX quantities have been compared to the same quantities obtained with ATRIG. In order to study possible event-to-event differences, the same data files have been used.

Figure 2: Comparison between ATRIG and Reference Software implementations of a selection of electron/ photon FEX quantities. In this study 50 single electron events were used to calculate the FEX quantities on an event-by-event basis. Similar agreement is observed for jet events.

Figure 2 shows, as an example of the agreement obtained in the electron/photon algorithm, the correlation between variables calculated from the reference software and calculated from ATRIG for 20 GeV single electrons. The quantities shown are: cluster \(\eta\) position; hadronic energy deposition; electromagnetic energy deposition; core energy fraction; corrected cluster width; \(R_{\eta}^{\text{shape}}\). The lines shown on each plot are not fits, but lines of unit gradient. There is good agreement between both implementations.

Another way to study the level of agreement between both packages is to investigate, for example, the achievable jet rejection of the electromagnetic trigger [5]. The four-dimensional space spanned by the quantities used to select electron/photon clusters at level 2 is scanned for an optimal set of cuts. Here, optimal is defined to be the set of cuts that gives the best efficiency for accepting electron RoIs for a given jet RoI acceptance rate. The resultant efficiency-rejection curve, shown in Figure 3, quantifies the optimal rejection power of the algorithm. Good agreement between both implementations is evident from the figure.

Even though the ATRIG and the Reference Software calorimeter algorithms give good agreement in the calculated quantities, there are a few differences that are worth noting. The corrected width, \(\alpha_{\eta}\), shows disagreement for the region \(|\eta|>2.0\), consistent with an unaccounted change in cell size. There are also other minor differences in the absolute value of the some of the quantities, which may be due to slight differences in cell sizes or to an incorrect decoding of the calorimeter cell information in difficult regions of the detector. The origin of these minor discrepancies is under investigation.

At the moment the level 2 ATRIG jet and tau/hadron FEX results are not written to the output ASCII file. Therefore, similar comparisons are not available for these algorithms.

Figure 3: Comparison of ATRIG (dashed) and Reference Software (solid) implementations of the electron/ photon algorithm in terms of optimal performance. The optimisation procedure used is described in Reference [4]. Although the data samples used in the comparison are the same, the jet event sample used in obtaining the Reference Software results contains half the number of events of the ATRIG sample.

All timing measurements described in this section have been carried out on a 300 MHz Pentium II PC under the Linux operating system (atlas20.cern.ch). The -O flag has been used in compilation. Note that in order to obtain the desired accuracy the cpu real time (rather than process time) is used. Obviously this is dependent on the load of the machine, so each measurement is repeated 50 times. The minimum measurement from this set is quoted. Note that the intrinsic performance of the FEX algorithm is probably a little better than these results, as some CPU load contributes to all measurements.

Figure 1 shows that the FEX algorithms in this release incorporate some basic data preprocessing besides the FEX variable determination. However, only the time taken to perform the feature extraction calculations is quoted here. It is assumed that data preprocessing will take place and be optimised elsewhere in the final level 2 system, therefore no timings for this step are included.

Note that two timing measurements are given for the electron/photon algorithm feature extraction stage; the first corresponds to the calculation of quantities which use information from the second sampling and the second to those which use the fine segmentation of the first sampling. Note also that results are quoted for both the intrinsic performance of the electron/photon FEX algorithm (i.e. using electron RoIs in the electron sample), and the performance of the algorithm in a jet environment (i.e. using the electron RoIs in the jet sample). The latter will dominate the level 2 trigger rate. All results are given in table 3.

In the current implementation the jet algorithm takes the longest time for FEX determination. As the FEX calculation considers all RoI cells in turn, and there are a factor of four more cells in a jet level 1 RoI than an electromagnetic level 1 RoI, this is hardly surprising. Future studies will concentrate on preprocessing methods to pack this data more efficiently, for example into towers.

\begin{table}
\begin{tabular}{|c|c|c|} \hline Feature extraction algorithm & Timing measurement \(\upmu\)s \\ \hline \hline _Em FEX (em sample), no pileup_ & _53_ & _89_ \\ \hline _Em FEX (jet sample), no pileup_ & _101_ & _109_ \\ \hline _Em FEX (em sample), with pileup_ & _109_ & _159_ \\ \hline _Em FEX (jet sample), with pileup_ & _207_ & _302_ \\ \hline _Jet FEX, no pileup_ & _663_ \\ \hline _Tau/hadron FEX, no pileup_ & _45_ \\ \hline \end{tabular}
\end{table}
Table 3: Benchmarking results for the calorimeter FEX algorithms.

## 6 Conclusions and Workplan

### Conclusions

The high \(p_{\mathrm{T}}\) calorimeter electromagnetic, tau/hadron and jet feature extraction algorithms have been implemented in the Reference Software framework. This implementation is a replica of the calorimeter algorithms of ATRIG and should have similar physics performance as documented in Reference [4]. First benchmarking measurements are given and look encouraging.

### Workplan

The present implementation of the algorithms could be improved in ways that would potentially yield improvements in processing times and data transfer requirements. The data preparation step of Figure 1 could be expanded into a full preprocessing step to reduce the number of cells that need to be examined in the feature extraction algorithm. This could be achieved by applying a threshold to RoI cell energies, or by reducing the size of the RoI information that is transferred to level 2. A preliminary investigation of these studies is documented elsewhere [9]. For feature extraction algorithms which are insensitive to shape information, such as the jet algorithm, calorimeter cells could be pre-summed into larger cells or towers during the pre-processing stage. The use of correction functions (implemented in ATRIG) that correct for shape and eta dependencies should be investigated to determine if the additional execution time incurred yields measureable background rejection. Additionally, feature extraction sensitivity to calibration uncertainties and noise must be evaluated.

The use of sequential processing could improve performance. In this scheme, RoIs are rejected as soon as possible so that unnecessary data transfers are avoided. Although the FEX algorithms described in this note do not have accept/reject decision steps, the modularity necessary to provide that functionality should be implemented and the improvement in performance evaluated.

Finally, a full redesign of the calorimeter FEX algorithms should be made using the experience gained in this first implementation. The aim of this redesign will be to use, wherever possible, algorithms that profit from the recurring features inherent in a calorimeter system. For example, a common cluster class could be defined to hold the output of all FEX algorithms. Common seed finding routines could be implemented that take collections of towers, cells or other groupings of data as input. The redesign should be the final step once the investigations listed above have been completed.

## References

* [1] Reference to Reference Software Document (in preparation)
* [2] ATLAS Trigger Simulation Version 1.00 User's Guide.
* [3] Liquid Argon Calorimeter Technical Design Report, CERN/LHCC/96-41, Dec. 1996.
* [4] Tile Calorimeter Technical Design Report, CERN/LHCC/96-42, Dec. 1996.
* [5] Trigger Performance Status Report, CERN/LHCC/98-15, Aug. 1998.
* [6] S. Gonzalez et al., "Selection of high \(p_{\rm T}\) Electromagnetic Clusters by the Second Level Trigger of ATLAS", ATL-DAQ-2000-002, April 1999.
* [7] J. Baines et al., "Identification of high \(p_{\rm T}\) electrons by the Second Level Trigger of ATLAS", ATL-DAQ-2000-003, April 1999.
* [8] B. Gonzalez-Pineiro, "Tau Identification in the Second Level Trigger", ATL-DAQ-98-127, August 1998.
* [9] S. Tapprogge, "Jet reconstruction at the ATLAS Second Level Trigger", ATL-DAQ-98-115, June 1998.
* [10]T. Shears, "Further Studies and Optimisation of the Level 2 trigger electron/photon FEX Algorithm", note in progress...